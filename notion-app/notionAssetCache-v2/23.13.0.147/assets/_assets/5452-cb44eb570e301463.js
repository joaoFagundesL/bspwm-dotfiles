"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[5452],{99342:(e,t,s)=>{s.d(t,{J:()=>_e});var o=s(67294),i=s(74725),n=s(480),a=s(86628),r=s(24405),l=s(66897),d=s(7057),c=s(42875),u=s(45238),p=s(85893);const m=(0,u.IU)("commentSidebarZero",{viewBox:"0 0 56 56",svg:(0,p.jsx)("path",{d:"M13.1289 47.6641C13.9297 47.6641 14.4961 47.3516 15.4141 46.5508L21.8984 40.5938C23.0703 42.4297 25.1602 43.4258 27.9922 43.4258H36.3516L42.6602 48.8164C43.5195 49.5586 44.0273 49.9492 44.7305 49.9492C45.7461 49.9492 46.332 49.2266 46.332 48.0938V43.4258H47.4453C51.8398 43.4258 54.6328 40.8281 54.6328 36.2969V24.1289C54.6328 19.5977 51.8398 17 47.4453 17H43.9688V14.793C43.9688 9.83203 41.0781 7 36.0977 7H8.87109C4.00781 7 1 9.83203 1 14.793V32.4297C1 37.4102 4.00781 40.2422 8.87109 40.2422H11.4492V45.7695C11.4492 46.9609 12.0742 47.6641 13.1289 47.6641ZM13.7539 39.2461C13.7539 38.3867 13.2266 37.9766 12.543 37.9766H9.08594C5.43359 37.9766 3.42188 36.043 3.42188 32.293V14.9492C3.42188 11.2188 5.45312 9.26562 9.08594 9.26562H35.8828C39.5156 9.26562 41.5469 11.2188 41.5469 14.9492V17H27.9922C23.4414 17 20.8047 19.5977 20.8047 24.1289V36.3164C20.8047 36.9805 20.8438 37.6055 20.9609 38.1719L13.7539 44.9883V39.2461ZM44.0859 47.2148L38.1289 41.9023C37.4844 41.3359 37.0938 41.1602 36.2344 41.1602H28.168C25.0039 41.1602 23.207 39.4805 23.207 36.1797V24.2656C23.207 20.9648 25.0039 19.2656 28.168 19.2656H47.25C50.4336 19.2656 52.2305 20.9648 52.2305 24.2656V36.1602C52.2305 39.4609 50.4336 41.1602 47.25 41.1602H45.2383C44.5938 41.1602 44.0859 41.5312 44.0859 42.3711V47.2148Z"})});var g=s(80503),f=s(9291),x=s(53965),y=s(37810),h=s(54564),v=s(33767),b=s(17707),S=s(10417),j=s(43250),M=s(33929),C=s(60709),w=s(65598),Z=s(77546),F=s(77907),T=s(5971),k=s(74948),P=s(24646),I=s(36391),_=s(34859),B=s(80444),V=s(24229),A=s(29798),O=s(78140),R=s(32163),K=s(40721),U=s(53336),D=s(77080),E=s(56666),N=s(21197),H=s(98519),L=s(26774),z=s(1898),$=s(52275),W=s(31945),Y=s(89728),G=s(53437),q=s(72495),X=s(26388),Q=s(97680);const J=[I.F7.Unresolved,I.F7.Resolved],ee={[I.F7.Unresolved]:j.FSd,[I.F7.Resolved]:j.boI},te=(0,f.defineMessages)({[I.F7.Unresolved]:{id:"updateSidebar.comments.mode.unresolvedOption",defaultMessage:"Open"},[I.F7.Resolved]:{id:"updateSidebar.comments.mode.resolvedOption",defaultMessage:"Resolved"}}),se=(0,f.defineMessages)({filterLabel:{id:"updateSidebar.comments.filter.label",defaultMessage:"Filter"}});function oe(e,t,s,o,i){if(t)return e;const{items:n}=e;if(n.length<=6)return e;const a=[...n.slice(0,5),{key:"show more",render:e=>(0,p.jsx)($.Z,{...e,icon:(0,E.o)(i.showMoreResultsButton),title:(0,p.jsx)("span",{style:i.showMoreResultsButtonTitle,children:(0,p.jsx)(f.FormattedMessage,{defaultMessage:"{numberMore} more results",id:"updateSidebar.comments.filter.byPerson.showMoreResultsButton.title",values:{numberMore:n.length-5}})})}),action:()=>{s(!0)}}];return{...e,items:a}}function ie(e){let{numCommenters:t,userActorsForDisplay:s,actorForFilter:o,setActorForFilter:i,onMobileClose:a,currentCommentsMode:l,popupOpen:d,setPopupOpen:c,peopleFilterExpanded:u,setPeopleFilterExpanded:m}=e;const g=(0,n.O7)(),x=g.device.isMobile?(0,p.jsx)(f.FormattedMessage,{defaultMessage:"By status",id:"commentFilterMenu.statusSectionMobile.title"}):(0,p.jsx)(f.FormattedMessage,{defaultMessage:"Filter by status",id:"commentFilterMenu.statusSectionDesktop.title"}),y=g.device.isMobile?(0,p.jsx)(f.FormattedMessage,{defaultMessage:"By person",id:"commentFilterMenu.personFilterSectionMobile.title"}):(0,p.jsx)(f.FormattedMessage,{defaultMessage:"Filter by person",id:"commentFilterMenu.personFilterSectionDesktop.title"}),h=(0,r.yK)((e=>({personIcon:{width:g.device.isMobile?24:20,fill:e.mediumIconColor},showMoreResultsButton:{width:16,fill:e.mediumTextColor},showMoreResultsButtonTitle:{color:e.mediumTextColor}})),[g.device.isMobile]),v={key:"commentFilter",render:e=>(0,p.jsx)(q.Z,{...e,title:x}),items:J.map((e=>({key:e,render:t=>(0,p.jsx)($.Z,{...t,className:ee[e],title:M.default.formatMessage(te[e]),right:(0,p.jsx)("div",{style:{width:14,opacity:l===e?1:0},children:(0,H.k)()})}),action:()=>{k.setUpdateSidebarCommentsMode(e),g.device.isMobile||c(!1)}})))},b={key:"anyone",render:e=>(0,p.jsx)($.Z,{...e,title:(0,p.jsx)(f.FormattedMessage,{defaultMessage:"Anyone",id:"commentFilterMenu.anyoneItem.title"}),icon:(0,L.O)(h.personIcon),right:(0,p.jsx)("div",{style:{width:14,opacity:void 0===o?1:0},children:(0,H.k)()})}),action:()=>{i(void 0),g.device.isMobile||c(!1)}},S=s.map((e=>{const t=e.getActorUserId();if(t){return{key:t,render:s=>(0,p.jsx)(Q.Z,{...s,actor:e,useEmailAsTooltip:!0,right:(0,p.jsx)("div",{style:{width:14,opacity:(null==o?void 0:o.getActorUserId())===t?1:0},children:(0,H.k)()})}),action:()=>{i(e),g.device.isMobile||c(!1)}}}})).filter(z.$K),j={key:"personFilter",render:e=>(0,p.jsx)(q.Z,{topBorder:!0,...e,title:y}),items:g.device.isMobile?[b,...S]:1===t?S:[b,...S]},w=(0,p.jsx)(R.Z,{type:R.i.Vertical,initialFocus:void 0,sections:[v,g.device.isMobile?j:oe(j,u,m,0,h)]});return g.device.isMobile?(0,p.jsx)(O.Z,{menuType:C.og.Modal,scrollerStyle:{paddingBottom:0},title:(0,p.jsx)(f.FormattedMessage,{defaultMessage:"Filter",id:"commentFilterMenu.title"}),right:(0,p.jsx)(K.DoneMenuText,{}),onClickRight:()=>{a(),c(!1)},children:w}):w}function ne(e){let{userActors:t,actorForFilter:s,setActorForFilter:i}=e;const d=(0,n.O7)(),c=(0,f.useIntl)(),u=(0,a.VK)((()=>I.ZP.state.expanded),[]),m=(0,a.VK)((()=>{let e=[...t];return s&&!e.find((e=>e.getActorUserId()===s.getActorUserId()))&&(d.device.isMobile?i(void 0):e=[s,...e]),e.sort(((e,t)=>{const s=(0,l.$4)(c,e),o=(0,l.$4)(c,t);return s&&o?s.localeCompare(o):0})),e}),[c,s,t,d.device.isMobile,i]),[g,x]=(0,o.useState)(!1),[y,h]=(0,o.useState)(!1),v=(0,a.VK)((()=>I.ZP.state.commentsMode),[]),b=(0,r.yK)((e=>({container:{display:"flex",flexDirection:"column"},commentsHeader:{display:"flex",justifyContent:"space-between",borderBottom:`1px solid ${e.regularDividerColor}`,alignItems:"center",pointerEvents:"auto"},toggleButton:{justifyContent:"center",display:"flex",color:e.mediumTextColor},toggleButtonContainer:{paddingRight:d.device.isMobile?0:8,display:"flex"},filterIcon:{width:d.device.isMobile?18:16,fill:s||v===I.F7.Resolved?e.icon.uiBluePrimary:e.mediumIconColor}})),[s,v,d.device.isMobile]),S=M.default.formatMessage(se.filterLabel);return(0,a.VK)((()=>{u||(k.setUpdateSidebarCommentsMode(I.F7.Unresolved),i(void 0),h(!1))}),[i,u]),(0,p.jsx)(W.ZP,{open:g,originGap:0,popupType:d.device.isMobile?G.ZP.PopupType.SlideUp:G.ZP.PopupType.Popup,renderOrigin:e=>(0,p.jsx)(X.ZP,{...e,placement:X.ug.Bottom,renderTooltip:()=>S,render:e=>(0,p.jsx)("div",{style:b.toggleButtonContainer,className:j.qSF,children:(0,p.jsx)(Y.Z,{...e,style:b.toggleButton,onClick:()=>{x(!0)},children:(0,N.Q)(b.filterIcon)})})}),placementToOrigin:G.ZP.Placement.Bottom,alignmentToOrigin:G.ZP.Alignment.Center,render:e=>(0,p.jsx)(ie,{userActorsForDisplay:m,actorForFilter:s,setActorForFilter:i,onMobileClose:()=>e.close(),currentCommentsMode:v,popupOpen:g,setPopupOpen:x,peopleFilterExpanded:y,setPeopleFilterExpanded:h,numCommenters:t.length}),onClose:()=>{x(!1)}})}var ae=s(36591),re=s(42853),le=s(64921);function de(){const e=(0,a.VK)((()=>I.ZP.state.commentsMode),[]),t=(0,r.yK)((e=>({container:{background:e.buttonHoveredBackground,width:"calc(100% - 32px)",height:36,borderRadius:10,display:"flex",margin:"10px 16px 6px 16px",marginTop:20,padding:4,gap:2,pointerEvents:"auto"},defaultButton:{borderRadius:8,fontSize:13,fontWeight:y.Z.fontWeight.medium,textAlign:"center",width:"100%",display:"flex",justifyContent:"center",alignItems:"center",lineHeight:1.8,color:e.regularTextColor,letterSpacing:-.08},selectedButton:{fontWeight:y.Z.fontWeight.semibold,background:e.segmentedControlActiveBackground,border:`0.5px solid ${e.outlineButtonBorder}`}})),[]);return(0,p.jsxs)("div",{style:t.container,className:j.rG8,children:[(0,p.jsx)(le.Z,{style:{...t.defaultButton,...e===I.F7.Unresolved?t.selectedButton:{}},onClick:()=>{k.setUpdateSidebarCommentsMode(I.F7.Unresolved)},children:(0,p.jsx)("span",{children:(0,p.jsx)(f.FormattedMessage,{id:"updateSidebarTabCommentsSegmentedControl.option.open",defaultMessage:"Open"})})}),(0,p.jsx)(le.Z,{style:{...t.defaultButton,...e===I.F7.Resolved?t.selectedButton:{}},onClick:()=>{k.setUpdateSidebarCommentsMode(I.F7.Resolved)},children:(0,p.jsx)("span",{children:(0,p.jsx)(f.FormattedMessage,{id:"updateSidebarTabCommentsSegmentedControl.option.resolved",defaultMessage:"Resolved"})})})]})}const ce=[I.F7.Unresolved,I.F7.Resolved],ue={[I.F7.Unresolved]:j.FSd,[I.F7.Resolved]:j.boI},pe=(0,f.defineMessages)({[I.F7.Unresolved]:{id:"updateSidebar.comments.mode.unresolvedOptionSimple",defaultMessage:"Open"},[I.F7.Resolved]:{id:"updateSidebar.comments.mode.resolvedOptionSimple",defaultMessage:"Resolved"}}),me=(0,f.defineMessages)({[I.F7.Unresolved]:{id:"updateSidebar.comments.filter.button.unresolvedModeSimple",defaultMessage:"Open"},[I.F7.Resolved]:{id:"updateSidebar.comments.filter.button.resolvedModeSimple",defaultMessage:"Resolved"}});function ge(){return(0,n.O7)().device.isMobile?(0,p.jsx)(de,{}):(0,p.jsx)(xe,{})}function fe(e){let{currentCommentsMode:t,setPopupOpen:s}=e;return(0,p.jsx)(R.Z,{type:R.i.Vertical,initialFocus:void 0,sections:[{key:"commentFilter",render:e=>(0,p.jsx)(q.Z,{...e}),items:ce.map((e=>({key:e,render:s=>(0,p.jsx)($.Z,{...s,className:ue[e],title:M.default.formatMessage(pe[e]),right:(0,p.jsx)("div",{style:{width:14,opacity:t===e?1:0},children:(0,ae.e)()})}),action:()=>{k.setUpdateSidebarCommentsMode(e),s(!1)}})))}]})}function xe(){const[e,t]=(0,o.useState)(!1),s=(0,a.VK)((()=>I.ZP.state.commentsMode),[]),i=(0,r.yK)((e=>({toggleButton:{justifyContent:"center",display:"flex",color:e.mediumTextColor},toggleButtonContainer:{paddingLeft:12,paddingRight:8,display:"flex"},chevronIcon:{width:10,marginLeft:4,fill:e.lightIconColor}})),[]);return(0,p.jsx)("div",{style:i.toggleButtonContainer,className:j.qSF,children:(0,p.jsx)(G.ZP,{popupType:G.ZP.PopupType.Popup,open:e,origin:(0,p.jsxs)(Y.Z,{style:i.toggleButton,onClick:()=>{t(!0)},children:[M.default.formatMessage(me[s]),(0,re.i)(i.chevronIcon)]}),placementToOrigin:G.ZP.Placement.Bottom,alignmentToOrigin:G.ZP.Alignment.Center,originGap:4,render:()=>(0,p.jsx)(fe,{currentCommentsMode:s,setPopupOpen:t}),onDismiss:()=>{t(!1)}})})}const ye=["commentsAndSuggestions","comments","suggestions"],he={commentsAndSuggestions:j.hHI,comments:j.J_U,suggestions:j.ok8},ve=(0,f.defineMessages)({commentsAndSuggestions:{id:"updateSidebar.comments.type.commentsAndSuggestionsOption",defaultMessage:"Comments & suggestions"},comments:{id:"updateSidebar.comments.type.commentsOption",defaultMessage:"Comments only"},suggestions:{id:"updateSidebar.comments.type.suggestionsOption",defaultMessage:"Suggestions only"}});function be(){const e=(0,f.useIntl)(),t=(0,n.O7)().device.isMobile,[s,i]=(0,o.useState)(!1),l=(0,a.VK)((()=>I.ZP.state.expanded),[]),d=(0,a.VK)((()=>I.ZP.state.commentsTypeMode),[]),c=(0,T.E)("human_suggested_edits");(0,a.VK)((()=>{l||k.setUpdateSidebarCommentsTypeMode(c?"commentsAndSuggestions":"comments")}),[c,l]);const u=(0,r.yK)((e=>({toggleButton:{justifyContent:"center",display:"flex",color:e.regularTextColor,fontWeight:y.Z.fontWeight.medium,fontSize:t?16:14},toggleButtonContainer:{padding:8,display:"flex"},chevronIcon:{width:10,marginLeft:4,fill:e.lightIconColor}})),[t]),m=(0,o.useCallback)((()=>(0,p.jsx)(R.Z,{type:R.i.Vertical,initialFocus:void 0,sections:[{key:"commentTypeFilter",render:e=>(0,p.jsx)(q.Z,{...e}),items:ye.map((e=>({key:e,render:t=>(0,p.jsx)($.Z,{...t,className:he[e],title:M.default.formatMessage(ve[e]),right:(0,p.jsx)("div",{style:{width:14,opacity:d===e?1:0},children:(0,H.k)()})}),action:()=>{k.setUpdateSidebarCommentsTypeMode(e),i(!1)}})))}]})),[d]);return(0,p.jsx)("div",{style:u.toggleButtonContainer,className:j.Wyp,children:(0,p.jsx)(G.ZP,{popupType:t?G.kQ.SlideUp:G.kQ.Popup,open:s,origin:(0,p.jsxs)(Y.Z,{style:u.toggleButton,onClick:()=>{i(!0)},children:[e.formatMessage(ve[d]),(0,re.i)(u.chevronIcon)]}),placementToOrigin:G.ZP.Placement.Bottom,alignmentToOrigin:G.ZP.Alignment.Center,originGap:4,render:m,onDismiss:()=>{i(!1)}})})}function Se(e){let{userActors:t,actorForFilter:s,setActorForFilter:o}=e;const i=(0,a.VK)((()=>D.default.checkGate("human_suggested_edits")),[]),n=(0,a.VK)((()=>D.default.checkGate("comments_pane_improvements")),[]),l=(0,r.yK)((e=>({container:{display:"flex",flexDirection:"column"},commentsHeader:{display:"flex",justifyContent:"space-between",borderBottom:`1px solid ${e.regularDividerColor}`,alignItems:"center",pointerEvents:"auto"},label:{fontSize:14,color:e.regularTextColor,fontWeight:y.Z.fontWeight.medium,display:"flex",alignItems:"center",padding:"12px 12px 12px 16px"}})),[]);return(0,p.jsx)(p.Fragment,{children:(0,p.jsx)("div",{style:l.container,children:(0,p.jsxs)("div",{style:l.commentsHeader,className:j.I9j,children:[i?(0,p.jsx)(be,{}):(0,p.jsx)("div",{style:l.label,children:(0,p.jsx)(f.FormattedMessage,{id:"updateSidebar.header.commentsLabel",defaultMessage:"Comments"})}),n?(0,p.jsx)(ne,{userActors:t,actorForFilter:s,setActorForFilter:o}):(0,p.jsx)(ge,{})]})})})}var je=s(21202),Me=s(92120),Ce=s(6258),we=s(28992);const Ze=o.forwardRef((function(e,t){const{currentBlockStore:s,discussion:i,showAllRepliesAfterTimestamp:l,focused:d,isLast:c,location:u}=e,m=(0,a.VK)((()=>V.Z.state.open&&V.Z.state.discussionIds||[]),[]),g=(0,a.VK)((()=>D.default.checkGate("comments_density_image_handling")),[]),f=(0,n.O7)();(0,o.useEffect)((()=>{var e;if(d){Me.Z.setState({source:"update_sidebar",discussionIds:[i.id]});const e=setTimeout((()=>{var e;(null===(e=Me.Z.state)||void 0===e||null===(e=e.discussionIds)||void 0===e?void 0:e[0])===i.id&&b.AM([i.id])}),1500);return()=>{clearTimeout(e)}}(null===(e=Me.Z.state)||void 0===e||null===(e=e.discussionIds)||void 0===e?void 0:e[0])===i.id&&Me.Z.setState({discussionIds:[]})}),[d,i,f]);const x=(0,a.VK)((()=>{var e;return(null===(e=Me.Z.state)||void 0===e?void 0:e.discussionIds)||[]}),[]),y=i.id,{parentId:h,currentSpaceId:S}=(0,a.VK)((()=>({parentId:i.getParentId(),currentSpaceId:i.getSpaceId()})),[i]),M=h?Ce.G.createChildStore(i,{table:je.iU,id:h}):void 0,C=m.includes(y),w=x.includes(y),Z=(0,r.yK)((e=>({discussionContainer:{paddingTop:f.device.isMobile?4:10,borderBottom:c||f.device.isMobile?void 0:`1px solid ${e.regularDividerColor}`,transition:"background 300ms ease",...g?{paddingTop:f.device.isMobile?4:6}:{}},replyButton:{color:e.blueColor,marginLeft:23,fontSize:14},hoveredStyle:{background:"sidebar"===u?e.hoveredDiscussionBackground:void 0},pressedStyle:{background:"sidebar"===u?e.focusDiscussionBackground:void 0}})),[f.device.isMobile,c,g,u]),{value:T}=(0,F.useDependency)(v.Av);if(!T)return null;if(!M||!S)return null;const k=(0,p.jsx)("div",{className:`sidebar-discussion-${y} ${j.s$o}`,onClick:e.onClick,onMouseEnter:e.onMouseEnter,ref:t,style:{...Z.discussionContainer,...d||w?Z.hoveredStyle:{},...C?Z.pressedStyle:{}},children:(0,p.jsx)(v.gU,{store:i,blockStore:s,format:T.discussionHelpers.DiscussionFormat.Sidebar,isFirst:!1,isOnly:!1,showResolveButtonByDefaultIfPossible:!1,discussionLocation:"updates_sidebar",showAllRepliesAfterTimestamp:l})});return(0,p.jsx)(we.Z,{allowTextSelection:!0,title:k,style:{marginLeft:-14,marginRight:-14,width:"calc(100% + 28px)",lineHeight:void 0,cursor:"pointer"}})}));function Fe(e){const{firstItemId:t}=e,s=(0,a.VK)((()=>{var e;return null===(e=Me.Z.state)||void 0===e?void 0:e.discussionIds.some((e=>e===t))}),[t]),o=(0,a.VK)((()=>V.Z.state.open&&V.Z.state.discussionIds&&V.Z.state.discussionIds.some((e=>e===t))),[t]),i=(0,r.yK)((t=>({hoveredStyle:{background:"sidebar"===e.location?t.hoveredDiscussionBackground:void 0},pressedStyle:{background:"sidebar"===e.location?t.focusDiscussionBackground:void 0},basicDesktopTitleStyle:{paddingLeft:16,paddingTop:16,marginBottom:0,marginTop:0,fontSize:12,transition:"background 300ms ease"},mobileTitleStyle:{fontSize:13,fontWeight:y.Z.fontWeight.medium,paddingBottom:0,textTransform:"unset",marginTop:-12}})),[e.location]);return(0,p.jsx)(q.Z,{desktopTitleStyle:{...i.basicDesktopTitleStyle,...s?i.hoveredStyle:{},...o?i.pressedStyle:{}},mobileTitleStyle:i.mobileTitleStyle,disableDesktopPadding:!0,disableMobileBorders:!0,...e})}var Te=s(70268);const ke=new A.Z,Pe=50;function Ie(e){let{commentsMode:t,commentsType:s,actorForFilter:o}=e;const i=(0,f.useIntl)();return(0,p.jsx)(p.Fragment,{children:((e,t)=>{if(e===I.F7.Unresolved){if("commentsAndSuggestions"===t)return o?(0,p.jsx)(f.FormattedMessage,{id:"updateSidebar.commentContainer.emptyUnresolvedCommentsAndSuggestionsForUser",defaultMessage:"No open comments or suggestions from {userName}",values:{userName:(0,l.$4)(i,o)}}):(0,p.jsx)(f.FormattedMessage,{id:"updateSidebar.commentContainer.emptyUnresolvedCommentsAndSuggestions",defaultMessage:"No open comments or suggestions"});if("comments"===t)return o?(0,p.jsx)(f.FormattedMessage,{id:"updateSidebar.commentContainer.emptyUnresolvedCommentsForUser",defaultMessage:"No open comments from {userName}",values:{userName:(0,l.$4)(i,o)}}):(0,p.jsx)(f.FormattedMessage,{id:"updateSidebar.commentContainer.emptyUnresolvedComments",defaultMessage:"No open comments"});if("suggestions"===t)return o?(0,p.jsx)(f.FormattedMessage,{id:"updateSidebar.commentContainer.emptyUnresolvedSuggestionsForUser",defaultMessage:"No open suggestions from {userName}",values:{userName:(0,l.$4)(i,o)}}):(0,p.jsx)(f.FormattedMessage,{id:"updateSidebar.commentContainer.emptyUnresolvedSuggestions",defaultMessage:"No open suggestions"})}else{if("commentsAndSuggestions"===t)return o?(0,p.jsx)(f.FormattedMessage,{id:"updateSidebar.commentContainer.emptyResolvedCommentsAndSuggestionsForUser",defaultMessage:"No resolved comments or suggestions from {userName}",values:{userName:(0,l.$4)(i,o)}}):(0,p.jsx)(f.FormattedMessage,{id:"updateSidebar.commentContainer.emptyResolvedCommentsAndSuggestions",defaultMessage:"No resolved comments or suggestions"});if("comments"===t)return o?(0,p.jsx)(f.FormattedMessage,{id:"updateSidebar.commentContainer.emptyResolvedCommentsForUser",defaultMessage:"No resolved comments from {userName}",values:{userName:(0,l.$4)(i,o)}}):(0,p.jsx)(f.FormattedMessage,{id:"updateSidebar.commentContainer.emptyResolvedComments",defaultMessage:"No resolved comments"});if("suggestions"===t)return o?(0,p.jsx)(f.FormattedMessage,{id:"updateSidebar.commentContainer.emptyResolvedSuggestionsForUser",defaultMessage:"No resolved suggestions from {userName}",values:{userName:(0,l.$4)(i,o)}}):(0,p.jsx)(f.FormattedMessage,{id:"updateSidebar.commentContainer.emptyResolvedSuggestions",defaultMessage:"No resolved suggestions"})}})(t,s)})}function _e(e){const{timeViewed:t,location:s}=e,l=(0,n.O7)(),[u,A]=(0,o.useState)(!1),[D,E]=(0,o.useState)(void 0),N=(0,a.VK)((()=>B.default.state.mainEditorCurrentBlockStore),[]),H=(0,a.VK)((()=>l.currentUser.id),[l]),L=(0,T.E)("human_suggested_edits"),z=(0,T.E)("comments_pane_improvements");(0,a.VK)((()=>{L||k.setUpdateSidebarCommentsTypeMode("comments")}),[L]);const{value:$}=(0,F.useDependency)(v.Av),W=(0,a.VK)((()=>$?$.discussionHelpers.getDiscussionsForSidebar({blockStore:N,currentUserId:H,ignoreAfterTime:t}):[]),[$,N,t,H]),Y=(0,a.VK)((()=>I.ZP.state.commentsMode),[]),G=(0,a.VK)((()=>I.ZP.state.commentsTypeMode),[]),q=(0,a.VK)((()=>(0,P._c)(l)),[l]),X=(0,a.VK)((()=>V.Z.state.open&&V.Z.state.discussionIds||[]),[]),Q=(0,a.VK)((()=>{const e="commentsAndSuggestions"===G?W:W.filter((e=>e.getType()===I.IT[G])),{resolved:t,unresolved:s}=(0,w.bB)(e);return Y===I.F7.Unresolved?s:t}),[W,G,Y]),J=Q.map((e=>e.id)),ee=(0,a.VK)((()=>D?Q.filter((e=>(0,w.D4)(e).map((e=>e.getCreatedById())).some((e=>e===D.getActorUserId())))):Q),[Q,D]),te=(0,a.VK)((()=>(0,S.getSetOfUsersInDiscussions)(Q)),[Q]);(0,o.useEffect)((()=>{if("popup"===s&&u)return()=>{b.AM(J)}}),[s,J,u]);const se=(0,r.yK)((e=>({commentsEmptyStyle:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",textAlign:"center",color:e.mediumTextColor,fontSize:14,position:"relative",background:e.contentBackground,marginRight:q?2:0,pointerEvents:"auto",paddingTop:10},commentsContentStyle:{position:"relative",minHeight:0,display:"flex",flexDirection:"column",background:e.contentBackground,marginRight:q?2:0,pointerEvents:"auto",height:"100%"},commentsIconStyle:{height:54,width:54,marginBottom:12,fill:e.mediumIconColor}})),[q]),oe=(0,o.useRef)(null),ie=(0,a.VK)((()=>(0,P.Sx)(l)),[l]);(0,i.O)({active:ie,closeHandler:h.LZ,ref:oe});const ae=(0,a.VK)((()=>{if(!$)return{};const e=x.vM(ee,(e=>{const s=$.discussionHelpers.getLatestRelevantComment({recordStore:e,currentUserId:H,timestamp:t});return s?(0,d.$6)(s.getCreatedTime()):""}));return delete e[""],e}),[$,ee,t,H]),re=(0,a.VK)((()=>!$||$.discussionHelpers.anyDiscussionCommentsLoading(ee)),[$,ee]);if((0,o.useEffect)((()=>{u||re||A(!0)}),[u,re]),!N||!ae||!u)return(0,p.jsx)(Te.B,{areaHeight:window.innerHeight});const le=Object.keys(ae).sort().reverse(),de=le.map(((e,o)=>{const i=(0,d.ZV)({value:{type:"date",start_date:e},date_format:"relative",userTimeZone:(0,c.r)(),intl:M.default.getIntl(),allowRelativeDates:!0}),n=ae[e],a=n.map(((e,i)=>{const a={key:e.id,render:a=>(0,p.jsx)(Ze,{...a,currentBlockStore:N,discussion:e,isFirstInSection:0===i,location:s,isLast:i===n.length-1&&o===le.length-1,showAllRepliesAfterTimestamp:t}),action:()=>{b.Ri({discussionStore:e,currentBlockStore:N,environment:l,analyticsFrom:"updates_sidebar",currentEl:oe.current})}};return a}));return{key:e,render:e=>(0,p.jsx)(Fe,{title:i,firstItemId:n[0].id,location:s,...e}),items:a}})),ce=de.flatMap((e=>e.items)).findIndex((e=>X.includes(e.key.toString()))),ue=0===ee.length?(0,p.jsx)("div",{style:se.commentsContentStyle,children:(0,p.jsxs)("div",{style:se.commentsEmptyStyle,children:[m(se.commentsIconStyle),(0,p.jsx)("div",{style:{fontWeight:y.Z.fontWeight.semibold,marginBottom:4},children:(0,p.jsx)(Ie,{commentsMode:Y,commentsType:G,actorForFilter:D})})]})}):(0,p.jsx)(U.Z,{type:_.Z.Y,style:{flexGrow:1,minHeight:0,transform:"translateZ(0px)",zIndex:1,overflow:"hidden auto",marginBottom:0},className:j.Xsh,children:(0,p.jsx)(R.Z,{disableKeyboard:!0,store:ke,type:R.i.Vertical,initialFocus:ce>=0?ce:void 0,scrollElIntoView:e=>{if(e instanceof Element){const t=e.getBoundingClientRect(),s=g.R6(l.device.isElectronMac),o=window.innerHeight,i=s+Pe,n=o-i;if(t.height>=n)return;const a=t.top>=i&&t.top<=o,r=a&&t.bottom>=o,d=t.bottom>=i&&t.bottom<=o,c=d&&t.top-i<0,u=a||d,p=.4*t.height;r&&Math.abs(t.top-o)<p?(0,Z.Wr)(e,{edgeDist:o-t.height-i,animate:!0}):c&&Math.abs(t.bottom-i)<p?(0,Z.Wr)(e,{edgeDist:0,animate:!0}):u||(0,Z.Wr)(e,{edgeDist:0,animate:!0})}},sections:de})});return l.device.isMobile?(0,p.jsxs)(O.Z,{menuType:C.og.Modal,scrollerStyle:{paddingBottom:0},title:L?(0,p.jsx)(be,{}):(0,p.jsx)(f.FormattedMessage,{defaultMessage:"Comments",id:"topbarMobile.commentsMenu.title"}),left:z?(0,p.jsx)(ne,{userActors:te,actorForFilter:D,setActorForFilter:E}):void 0,leftOuterStyle:{position:"relative",marginLeft:-4,paddingRight:4},right:(0,p.jsx)(K.DoneMenuText,{}),onClickRight:e.onMobileClose,children:[z?void 0:(0,p.jsx)(ge,{}),ue]}):(0,p.jsxs)("div",{style:se.commentsContentStyle,ref:oe,children:[(0,p.jsx)(Se,{userActors:te,actorForFilter:D,setActorForFilter:E}),ue]})}},3712:(e,t,s)=>{s.d(t,{Z:()=>y});var o=s(67294),i=s(480),n=s(24405),a=s(18442),r=s(9291),l=s(1898),d=s(19719),c=s(97799),u=s(92083),p=s(62820),m=s(73063),g=s(26388),f=s(85893);function x(e){let{location:t}=e;const s=(0,r.useIntl)(),x=(0,i.O7)(),y=(0,o.useCallback)((()=>{const{device:e}=x;d.FR(x),e.isMobile?c.Z.setState({open:!0,source:c.Y.Updates}):(p.Z.setState({...p.Z.state,open:!1}),u.Z.setState({...u.Z.state,currentTab:"notifications",defaultSubtab:void 0}),u.Z.setState({...u.Z.state,open:!0}))}),[x]),h=(0,n.yK)((e=>({mobileTopBarIcon:{height:18,width:18,fill:e.regularTextColor},webUpdatesModalIcon:{width:16,height:16}})),[]);let v;switch(t){case"mobileTopBar":v=h.mobileTopBarIcon;break;case"webUpdatesModal":v=h.webUpdatesModalIcon;break;default:(0,l.t1)(t)}return(0,f.jsx)(g.ZP,{renderTooltip:()=>(0,f.jsx)(r.FormattedMessage,{defaultMessage:"Open notifications settings",id:"updatesModal.openNotifications.tooltip"}),render:e=>(0,f.jsx)(m.Z,{icon:a.H,iconStyle:v,onClick:y,ariaLabel:s.formatMessage({id:"updatesModal.openNotifications.tooltipAriaLabel",defaultMessage:"Open notifications settings button"}),...e})})}const y=o.memo(x)},67579:(e,t,s)=>{s.d(t,{f:()=>y});var o=s(67294),i=s(24405),n=s(69651),a=s(73123),r=s(45257),l=s(33929),d=s(60709),c=s(52275),u=s(78140),p=s(32163),m=s(53437),g=s(72495),f=s(91642),x=s(85893);function y(e){const t=(0,i.yK)((e=>({popup:{width:125,marginLeft:5},pillStyle:{display:"flex",alignItems:"center"}})),[]),{currentFilter:s,hideAllTime:y}=e,[h,v]=(0,o.useState)(!1),b=a.Hz.filter((e=>!y||"all_time"!==e)).map((t=>{const s=()=>{e.onChangeFilter(t),v(!1)};return{key:t,action:()=>{},render:()=>(0,x.jsx)(c.Z,{focused:!1,onClick:s,title:l.default.formatMessage(a.Rh[t])})}})),S=(0,x.jsx)(r.Z,{on:Boolean(s),wrapStyle:t.pillStyle,icon:(0,n.C)({width:16,marginRight:6,fill:"currentColor"}),title:l.default.formatMessage(a.Rh[s]),onClick:()=>{v(!0)}}),j=[{key:"filters",items:b,render:e=>(0,x.jsx)(g.Z,{...e,title:null,loading:!1})}],M=(0,x.jsx)(u.Z,{menuType:d.og.Popup,header:null,children:(0,x.jsx)(p.Z,{type:p.i.Vertical,initialFocus:0,sections:j})});return(0,x.jsx)(f.Z,{marginAfter:!1,children:(0,x.jsx)(m.ZP,{popupType:m.ZP.PopupType.Popup,placementToOrigin:m.ZP.Placement.Bottom,alignmentToOrigin:m.ZP.Alignment.Start,open:h,render:()=>M,onDismiss:()=>v(!1),keepFocus:!0,origin:S,preventScaleTransition:!0,style:t.popup})})}},48603:(e,t,s)=>{s.r(t),s.d(t,{PageAnalyticsPageOptOut:()=>y,TopbarPageAnalyticsOptOutMenu:()=>x,TopbarPageAnalyticsOptOutMenuStore:()=>f});s(67294);var o=s(480),i=s(86628),n=s(49085),a=s(9291),r=s(10259),l=s(18514),d=s(80444),c=s(73420),u=s(53437),p=s(42402),m=s(55422),g=s(85893);const f=n.default.createValue({isOpen:!1,rect:void 0});function x(){const e=(0,o.O7)(),t=(0,i.VK)((()=>f.state.isOpen),[]),s=(0,i.VK)((()=>f.state.rect),[]),n=(0,i.VK)((()=>d.default.state.mainEditorCurrentBlockStore),[]);return n?(0,g.jsx)(u.ZP,{popupType:e.device.isMobile?u.ZP.PopupType.SlideUp:u.ZP.PopupType.Popup,alignmentToOrigin:u.ZP.Alignment.Center,open:t,render:()=>(0,g.jsx)("div",{style:{minWidth:360,padding:16},children:(0,g.jsxs)(c.sg,{gap:16,children:[(0,g.jsx)("div",{style:{fontSize:16,fontWeight:500},children:(0,g.jsx)(a.FormattedMessage,{id:"TopbarPageAnalyticsOptOutMenu.heading",defaultMessage:"Privacy settings"})}),(0,g.jsx)(y,{store:n})]})}),originRect:s,onDismiss:()=>f.setState({isOpen:!1,rect:void 0})}):null}function y(e){const t=(0,o.O7)(),s=(0,i.VK)((()=>{const e=d.default.state.currentSpaceViewStore;return null==e?void 0:e.getSettings()}),[]),n=(0,i.VK)((()=>{const t=null==s?void 0:s.page_analytics_opt_out_list;return null==t?void 0:t.includes(e.store.id)}),[s,e.store.id]);return(0,g.jsx)(m.Z,{type:"dropdown",currentOption:n?"do_not_record":"record",options:[{key:"record",label:(0,g.jsx)(a.FormattedMessage,{id:"page_analytics.opt_out.record",defaultMessage:"Record"})},{key:"do_not_record",label:(0,g.jsx)(a.FormattedMessage,{id:"page_analytics.opt_out.do_not_record",defaultMessage:"Don't record"})}],onSelectOption:s=>{"do_not_record"===s?r.kY(t,e.store.id):r.pu(t,e.store.id)},isMobile:t.device.isMobile,title:(0,g.jsx)(a.FormattedMessage,{id:"page_analytics.opt_out.title",defaultMessage:"My view history"}),caption:(0,g.jsx)(a.FormattedMessage,{id:"page_analytics.opt_out.caption",defaultMessage:"Page editors can see my view history for this page. <inlinelink>Learn more</inlinelink>.",values:{inlinelink:e=>(0,g.jsx)(p.Z,{external:!0,href:(0,l.UY)("guides.pageAnalytics"),children:e})}}),captionStyle:{maxWidth:270}})}},10642:(e,t,s)=>{s.r(t),s.d(t,{GetNotifiedFor:()=>C,MobileInboxPopup:()=>It,TopbarUpdatesMenu:()=>V,UpdateSidebar:()=>lt});var o=s(67294),i=s(86628),n=s(24405),a=s(9291),r=s(37810),l=s(480),d=s(90792),c=s(42853),u=s(62967),p=s(19719),m=s(48019),g=s(31945),f=s(78140),x=s(89728),y=s(72495),h=s(60709),v=s(98742),b=s(24764),S=s(57538),j=s(85893);function M(e){var t;const{blockStore:s,from:a,buttonPopupStore:M}=e,C=e.moreProminentStyling??!1,w=(0,l.O7)(),Z=(0,i.VK)((()=>s.isPageBlock()),[s]),F=(0,i.VK)((()=>s.getFollowSettingsKey()),[s]),T=(0,o.useCallback)((()=>{p.Z8({environment:w,pageId:s.pointer.id,isCurrentlyFollowing:(0,S.Z)(F).following,from:a})}),[s.pointer.id,w,F,a]),k=(0,i.VK)((()=>b.Z({followSettingsKey:F,environment:w,blockStore:s,from:a})),[F,w,s,a]),P=(0,n.yK)((e=>({buttonContainer:{display:"flex",alignItems:"center",color:e.mediumTextColor,padding:C?"4px 10px":4,borderRadius:4,marginRight:C?0:4,fontSize:r.Z.fontSize.UIRegular.desktop},bellIcon:{width:14,height:14,marginRight:4},chevronIcon:{marginLeft:4,width:10,height:10},spacer:{flexGrow:1},footerLabel:{padding:12,backgroundColor:e.sidebarSecondaryBackground,boxShadow:`0 -1px 0 ${e.regularDividerColor}`,marginTop:1}})),[C]),I=null===(t=k.find((e=>b.t({key:e.action.analyticsName,userSelectedKey:F}))))||void 0===t?void 0:t.title;return Z?(0,j.jsx)(g.ZP,{popupType:g.Z4.Popup,alignmentToOrigin:g.vR.End,placementToOrigin:g.pO.Bottom,sameWidthAsOrigin:C,buttonPopupStore:M,render:e=>(0,j.jsx)(f.Z,{menuType:h.og.Popup,minWidth:290,maxHeight:"50vh",children:(0,j.jsx)(m.Z,{context:{blocks:[],environment:w,publicEditMode:void 0},sections:[(0,u.$J)({key:"in-app-notifications-section",render:e=>(0,j.jsx)(y.Z,{...e}),actions:k.map((e=>e.action))})],initialFocus:void 0,onAccept:()=>e.close()})}),renderOrigin:e=>(0,j.jsxs)(x.Z,{...(0,v.Z)(e,{onClick:T}),style:P.buttonContainer,children:[(0,d.t)(P.bellIcon),I,C&&(0,j.jsx)("div",{style:P.spacer}),(0,c.i)(P.chevronIcon)]})}):null}function C(e){const{navigableBlock:t,from:s,buttonPopupStore:o}=e,l=(0,i.VK)((()=>t.isPageBlock()),[t]),d=(0,n.yK)((e=>({label:{fontSize:r.Z.fontSize.UIRegular.desktop,color:e.regularTextColor,fontWeight:r.Z.fontWeight.medium},border:{border:`1px solid ${e.outlineButtonBorder}`,borderRadius:4,marginTop:8}})),[]);return l?(0,j.jsxs)("div",{children:[(0,j.jsx)("div",{style:d.label,children:(0,j.jsx)(a.FormattedMessage,{id:"UpdateSidebarTabUpdatesHeader.pageNotificationSettings.label",defaultMessage:"Page notification settings"})}),(0,j.jsx)("div",{style:d.border,children:(0,j.jsx)(M,{blockStore:t,moreProminentStyling:!0,from:s,buttonPopupStore:o})})]}):null}var w=s(84708),Z=s(80503),F=s(43250),T=s(36391),k=s(81258);const P=new(s(61766).Z);var I=s(66957);function _(){return(0,j.jsx)(a.FormattedMessage,{id:"updateSidebar.header.updatesLabel",defaultMessage:"Updates"})}function B(e){const t=(0,l.O7)(),{enablePageAnalytics:s,popOutMode:o,navigableBlock:d,inPeekView:c}=e,u=(0,n.yK)((e=>({updatesHeaderStyle:{position:"relative",pointerEvents:"auto",marginTop:o?0:Z.R6(t.device.isElectronMac),paddingTop:4,width:o&&!c?"calc(100% - 2px)":"100%",background:c?e.popoverBackground:e.contentBackground,padding:"12px 12px 12px 16px",borderBottom:`1px solid ${e.regularDividerColor}`},getNotifiedFor:{...s?{padding:8}:{paddingBottom:14}},label:{fontSize:14,color:e.regularTextColor,fontWeight:r.Z.fontWeight.medium}})),[o,t,c,s]),p=(0,i.VK)((()=>T.ZP.state.currentSubTab),[]),m=c?P:k.Z;return(0,j.jsxs)("div",{style:{...u.updatesHeaderStyle,...s?{padding:"0 6px"}:{}},className:F.cFM,children:[(0,j.jsx)("div",{style:u.getNotifiedFor,children:(0,j.jsx)(C,{navigableBlock:d,from:"page_updates",buttonPopupStore:m})}),s?(0,j.jsx)(I.Z,{tabs:[(0,j.jsx)(_,{},"updates"),(0,j.jsx)(a.FormattedMessage,{id:"updateSidebar.header.analyticsLabel",defaultMessage:"Analytics"},"analytics")],selectedIndex:p,onChange:e.onTabChange,style:{...u.label,padding:0,boxShadow:"none"},tabStyle:{padding:"12px 0"}}):(0,j.jsx)("div",{style:u.label,children:(0,j.jsx)(_,{})})]})}function V(e){const{blockStore:t,spaceStore:s}=e,o=function(e){const{spaceStore:t,blockStore:s}=e,o=(0,i.VK)((()=>{var e,t;return(null==s||null===(e=s.getModel())||void 0===e?void 0:e.isCollectionView())?null===(t=s.getCollectionPointer())||void 0===t?void 0:t.id:void 0}),[s]);if(!t)return;const n=s.id,a=t.id;return{navigableBlockId:n,collectionId:o,spaceId:a}}({blockStore:t,spaceStore:s});return o?(0,j.jsx)(f.Z,{menuType:h.og.Popup,className:F.KLh,header:(0,j.jsx)(B,{navigableBlock:t,enablePageAnalytics:!1,popOutMode:!0,inPeekView:!0}),children:(0,j.jsx)(w.Z,{empty:()=>(0,j.jsx)(A,{}),source:"updates_sidebar",navigableBlock:t,...o},t.id)}):null}function A(){const e=(0,n.yK)((e=>({container:{marginTop:64,textAlign:"center",paddingLeft:18,paddingRight:18,marginBottom:64},content:{fontSize:14,color:e.mediumTextColor,marginTop:4}})),[]);return(0,j.jsx)("div",{style:e.container,children:(0,j.jsx)("div",{style:e.content,children:(0,j.jsx)("span",{children:(0,j.jsx)(a.FormattedMessage,{defaultMessage:"No edits in this page yet.",id:"topbar.updatesButton.emptyState"})})})})}var O=s(74725),R=s(92996),K=s(70475),U=s(43119),D=s(51454),E=s(1898),N=s(66324),H=s(23063),L=s(77907);const z=(0,L.lazyComponent)(L.deps.UpdateSidebarTabAiContext,(e=>e.default));var $=s(3553),W=s(55064),Y=s(70268),G=s(99342),q=(s(21703),s(30120)),X=s(45010),Q=s(24646),J=s(34859),ee=s(80444),te=s(53336),se=s(30251),oe=s(13991),ie=s(7057),ne=s(53877),ae=s(83176),re=s(82855),le=s(16880),de=s(84169),ce=s(18442),ue=s(23512),pe=s(54368),me=s(77420),ge=s(19889),fe=s(53965),xe=s(26249),ye=s(16287),he=s(54642),ve=s(25320),be=s(83420),Se=s(20095),je=s(65598),Me=s(18514),Ce=s(35314),we=s(44904),Ze=s(6258),Fe=s(88893),Te=s(73420),ke=s(68785),Pe=s(63296),Ie=s(70301),_e=s(64369),Be=s(45653),Ve=s(67579),Ae=s(48603);const Oe=Date.now();function Re(e){let{store:t,spaceId:s,isDisabledForWorkspace:r}=e;const[d,c]=(0,o.useState)("last_28_days"),[u,p]=(0,o.useState)({state:r?"disabled-for-workspace":"loading"}),m=(0,l.O7)(),x=(0,n.Fg)(),y=(0,i.VK)((()=>{const{currentSpaceStore:e}=ee.default.state;return null==e?void 0:e.getName()}),[]),v=(0,i.VK)((()=>{switch(d){case"last_7_days":return 7;case"last_28_days":return 28;case"last_90_days":return 90;case"all_time":return}}),[d]);(0,o.useEffect)((()=>{r||async function(){const e=await he.getPageAnalytics(m,{pageId:t.id,spaceId:s,days:v});if("failed"===e.type)return void p({state:"empty"});const o=e.data.map((e=>{let{ds:t,total_views:s,unique_views:o}=e;return{ds:t,values:{total_views:s,unique_views:o}}}));o.filter((e=>{let{ds:t}=e;return ne.OQ.isoToUnixMs(t,"UTC")??Oe<=Oe})).every((e=>{let{values:t}=e;return 0===t.total_views}))?p({state:"empty"}):p({state:"loaded",data:o})}()}),[m,t.id,r,s,v]);const b=(0,n.yK)((e=>({fullHeight:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},spinner:{width:32,height:32}})),[]);return"loading"===u.state?(0,j.jsx)("div",{style:b.fullHeight,children:(0,j.jsx)(ke.Z,{style:b.spinner})}):"empty"===u.state?(0,j.jsx)("div",{style:b.fullHeight,children:(0,j.jsx)(Ge,{heading:(0,j.jsx)(a.FormattedMessage,{id:"page_analytics.empty.heading",defaultMessage:"No page analytics yet"}),description:(0,j.jsx)(a.FormattedMessage,{id:"page_analytics.empty.description",defaultMessage:"It may take some time for page view information to appear."})})}):"disabled-for-workspace"===u.state?(0,j.jsx)("div",{style:b.fullHeight,children:(0,j.jsx)(Ge,{heading:(0,j.jsx)(a.FormattedMessage,{id:"page_analytics.disabled.heading",defaultMessage:"Page viewership tracking is disabled"}),description:(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16},children:[y?(0,j.jsx)(a.FormattedMessage,{id:"page_analytics.disabled.description",defaultMessage:"Page viewership and analytics is turned off for all pages in {name}",values:{name:y}}):(0,j.jsx)(a.FormattedMessage,{id:"page_analytics.disabled.description.unnamed",defaultMessage:"Page viewership and analytics is turned off for all pages in your space"}),(0,j.jsxs)("a",{href:(0,Me.UY)("guides.pageAnalytics"),target:"_blank",style:{display:"flex",gap:4,color:x.regularTextColor,alignItems:"center",textDecoration:"none",cursor:"pointer"},children:[(0,de.m)({width:14,height:14}),(0,j.jsx)(_e.Z,{isSmall:!0,children:(0,j.jsx)(a.FormattedMessage,{id:"page_analytics.disabled.learnMore",defaultMessage:"Learn more"})})]})]})})}):(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%"},children:[(0,j.jsxs)(Te.sg,{grow:1,gap:16,children:[(0,j.jsx)(De,{store:t,data:u.data,currentFilter:d,onChangeFilter:c}),(0,j.jsx)(Ne,{store:t}),(0,j.jsx)(Ye,{spaceId:s,store:t})]}),(0,j.jsxs)("div",{style:{borderTop:`1px solid ${x.regularDividerColor}`,padding:"12px 16px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,j.jsx)(g.ZP,{renderOrigin:e=>{let{onClick:t}=e;return(0,j.jsx)(Pe.Z,{onClick:t,icon:ce.H,children:(0,j.jsx)(a.FormattedMessage,{id:"page_analytics.timeseries.settings",defaultMessage:"Settings"})})},popupType:m.device.isMobile?g.Z4.SlideUp:g.Z4.Popup,render:()=>(0,j.jsx)(f.Z,{menuType:h.og.Popup,width:460,children:(0,j.jsx)("div",{style:Ue,children:(0,j.jsx)(Ae.PageAnalyticsPageOptOut,{store:t})})})}),(0,j.jsxs)("a",{href:(0,Me.UY)("guides.pageAnalytics"),target:"_blank",style:{display:"flex",gap:4,color:x.regularTextColor,alignItems:"center",textDecoration:"none",cursor:"pointer"},children:[(0,de.m)({width:14,height:14}),(0,j.jsx)(_e.Z,{isSmall:!0,children:(0,j.jsx)(a.FormattedMessage,{id:"page_analytics.timeseries.learnMore",defaultMessage:"Learn more"})})]})]})]})}const Ke=175,Ue={margin:"8px 16px",pointerEvents:"auto",cursor:"default"};function De(e){const[t,s]=(0,Ce.e)(),{blueLayer:i,yellowLayer:n}=(0,se.useTimeSeriesPalette)(),r=(0,o.useMemo)((()=>{if(0===e.data.length)return Oe;const t=ne.OQ.isoToUnixMs(e.data[0].ds,"UTC")??Oe;return Math.min(t,Oe)}),[e.data]);return(0,j.jsxs)("div",{children:[(0,j.jsx)(Ee,{store:e.store,data:e.data,currentFilter:e.currentFilter,onChangeFilter:e.onChangeFilter}),(0,j.jsx)("div",{ref:t,style:{...Ue,marginBottom:0},children:(0,j.jsx)(L.LazyTimeSeries,{startDate:(0,ie.$6)(r,!0),endDate:(0,ie.$6)(Oe,!0),width:s,height:Ke,data:e.data,layers:[{key:"total_views",...i,renderLabel:e=>(0,j.jsx)(a.FormattedMessage,{id:"page_analytics.timeseries.total_views",defaultMessage:"{views, plural, one {1 total view} other {{views} total views}}",values:{views:e}})},{key:"unique_views",...n,renderLabel:e=>(0,j.jsx)(a.FormattedMessage,{id:"page_analytics.timeseries.unique_views",defaultMessage:"{uniqueViews, plural, one {1 unique view} other {{uniqueViews} unique views}}",values:{uniqueViews:e}})}]})})]})}function Ee(e){const t=(0,a.useIntl)(),s=(0,o.useMemo)((()=>e.data.reduce(((e,t)=>{let{values:s}=t;return e+s.total_views}),0)),[e.data]);return(0,j.jsx)("div",{style:{margin:"14px 16px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,j.jsxs)(Te.X2,{justifyContent:"space-between",alignItems:"center",grow:1,children:[(0,j.jsxs)(Te.X2,{gap:4,children:[(0,j.jsx)(_e.Z,{style:{fontWeight:500},children:(0,j.jsx)(a.FormattedMessage,{id:"page_analytics.timeseries.title",defaultMessage:"Views"})}),(0,j.jsx)(_e.Z,{isSecondaryColor:!0,children:(0,j.jsx)(a.FormattedMessage,{id:"page_analytics.timeseries.totalViews",defaultMessage:"({totalViews} total)",values:{totalViews:(0,ue.uf)(s,"number_with_commas",t)}})})]}),(0,j.jsx)(Ve.f,{currentFilter:e.currentFilter,onChangeFilter:e.onChangeFilter})]})})}function Ne(e){const{store:t}=e,{pageVisitStore:s,presenceStore:n}=(0,i.Kw)(ee.default),r=(0,l.O7)();(0,o.useEffect)((()=>{ve.Ri(r,{block:t,pageVisitStore:s,incremental:!1,limit:ve.s4})}),[r,t,s]);const d=(0,i.VK)((()=>(0,Se.AQ)(s,n)),[s,n]);if(0===d.length)return null;const c=d.map((e=>{let{userId:s,activityTimestampNearestMinuteMs:o}=e;return{actorStore:Ze.U6.createChildStore(t,{id:s,table:ge.KJ}),timestamp:o}}));return(0,j.jsxs)("div",{style:{...Ue,display:"flex",flexDirection:"column",gap:12},children:[(0,j.jsx)(_e.Z,{style:{fontWeight:500},children:(0,j.jsx)(a.FormattedMessage,{id:"page_analytics.viewers.title",defaultMessage:"Viewers"})}),(0,j.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:10},children:(0,j.jsx)(Le,{store:t,actorStores:c,collapsedLabel:(0,j.jsx)(a.FormattedMessage,{id:"page_analytics.viewers.expand",defaultMessage:"Show more viewers"}),expandedLabel:(0,j.jsx)(a.FormattedMessage,{id:"page_analytics.viewers.collapse",defaultMessage:"Show less viewers"})})})]})}const He=5;function Le(e){const{store:t,actorStores:s,collapsedLabel:i,expandedLabel:n}=e,[a,r]=(0,o.useState)(!0),l=a?s.slice(0,He):s;return(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[l.map((e=>{let{actorStore:s,timestamp:o}=e;return(0,j.jsx)(ze,{store:t,actorStore:s,timestamp:o},s.id)})),s.length>He&&(0,j.jsx)("button",{onClick:e=>{e.preventDefault(),r(!a)},style:{background:"none",border:"none",textAlign:"left",padding:0,marginTop:4},children:(0,j.jsxs)(_e.Z,{isSecondaryColor:!0,isSmall:!0,style:{display:"flex",gap:3,alignItems:"center"},children:[a?i:n,a?(0,re.E)({width:12}):(0,le.R)({width:12})]})},"toggle")]})}function ze(e){const{actorStore:t,timestamp:s}=e,n=(0,a.useIntl)(),r=(0,o.useMemo)((()=>{const e=Date.now();return(0,ie.tv)(Math.min(s??e,e),oe.SP)}),[s]),l=(0,i.VK)((()=>t.getDisplayName(n)),[t,n]);return(0,j.jsxs)(Te.X2,{alignItems:"center",justifyContent:"space-between",children:[(0,j.jsxs)(Te.X2,{gap:4,children:[(0,j.jsx)($e,{actorStore:t}),(0,j.jsx)(_e.Z,{style:{fontWeight:500},children:l})]}),(0,j.jsx)(_e.Z,{isSecondaryColor:!0,children:s?(0,j.jsx)("span",{title:(0,ie.Yx)(s,"medium_with_time",oe.SP),children:r}):r})]})}function $e(e){const{actorStore:t}=e;return t.table===me.cZ?(0,j.jsx)(Ie.Z,{botStore:t,size:18}):t.table===ge.KJ?(0,j.jsx)(Be.Z,{userStore:t,size:18}):t.table===pe.y0?(0,j.jsx)(Be.Z,{userStore:void 0,size:18}):void(0,E.t1)(t)}function We(e){const{environment:t,store:s,spaceId:n,hasAccessToEditors:a}=e,[,,r]=(0,i.AF)(void 0,we.o),[l,d]=(0,o.useState)([]);(0,o.useEffect)((()=>{a&&ye.h(t,{store:r,activityIds:l,spaceId:n,filterActivityTypes:[],filterDateRange:{starting:void 0,ending:void 0},navigableBlockId:s.id})}),[l,r,n,s.id,t,a]);return(0,i.VK)((()=>{if(!a)return[];const e=r.state.activityIds;(0,xe.Z)(l,e)||d(e);const{currentSpaceStore:t}=ee.default.state;if(!t)return[];const o=l.map((e=>(0,je.No)(t,e,t.id))).flatMap((e=>{const t=e.getValue();return t?"top-level-block-created"!==t.type&&"top-level-block-deleted"!==t.type&&"block-edited"!==t.type?[]:function(e,t){var s;return fe.oA(null===(s=e.edits)||void 0===s?void 0:s.flatMap((e=>{var s;return null===(s=e.authors)||void 0===s?void 0:s.map((s=>({actorStore:(0,be.nc)({parentStore:t,pointer:s,debugSrc:"getEditActivityActorsAndTimestamps"}),timestamp:e.timestamp})))})))}(t,s):[]})),i=fe.MR(o,"timestamp").reverse();return fe.mN(i,"userId")}),[l,r,a,s])}function Ye(e){const{spaceId:t,store:s}=e,o=(0,l.O7)(),n=(0,i.VK)((()=>(0,Fe.qb)(o,"business")||(0,Fe.qb)(o,"enterprise")),[o]),r=We({environment:o,hasAccessToEditors:n,spaceId:t,store:s}),d=(0,i.VK)((()=>{const e=s.getCreatedByPointer(),t=s.getCreatedTime();if(e&&t)return{actorStore:(0,be.nc)({parentStore:s,pointer:e,debugSrc:"PageAnalyticsEditors.creator"}),createdTime:t}}),[s]);return(0,j.jsxs)("div",{style:{...Ue,display:"flex",flexDirection:"column",gap:12},children:[(0,j.jsx)(_e.Z,{style:{fontWeight:500},children:(0,j.jsx)(a.FormattedMessage,{id:"page_analytics.editors.title",defaultMessage:"Editors"})}),d&&(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:10,marginBottom:6},children:[(0,j.jsx)(_e.Z,{isSmall:!0,isSecondaryColor:!0,style:{fontWeight:500},children:(0,j.jsx)(a.FormattedMessage,{id:"page_analytics.editors.createdBy",defaultMessage:"Created by"})}),(0,j.jsx)(ze,{store:s,actorStore:d.actorStore,timestamp:d.createdTime})]}),n&&r.length>0&&(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[(0,j.jsx)(_e.Z,{isSmall:!0,isSecondaryColor:!0,style:{fontWeight:500},children:(0,j.jsx)(a.FormattedMessage,{id:"page_analytics.editors.editedBy",defaultMessage:"Recently edited by"})}),(0,j.jsx)(Le,{actorStores:r,store:s,collapsedLabel:(0,j.jsx)(a.FormattedMessage,{id:"page_analytics.editors.expand",defaultMessage:"Show more editors"}),expandedLabel:(0,j.jsx)(a.FormattedMessage,{id:"page_analytics.editors.collapse",defaultMessage:"Show less editors"})})]})]})}function Ge(e){const t=(0,n.yK)((e=>({column:{display:"flex",flexDirection:"column"},row:{display:"flex"},centered:{textAlign:"center",alignItems:"center",width:250},analyticsIcon:{position:"relative",top:-8,left:-4},secondaryIcon:{fill:e.mediumTextColor},settingsButton:{padding:"7.5px 10px",alignSelf:"center"},link:{cursor:"pointer",justifyContent:"center",alignItems:"center",padding:8,alignSelf:"center"}})),[]);return(0,j.jsx)("div",{style:{...t.column,gap:24},children:(0,j.jsxs)("div",{style:{...t.column,...t.centered,gap:4},children:[(0,ae.z)({...t.secondaryIcon,...t.analyticsIcon,width:62,height:62}),(0,j.jsx)(_e.Z,{isSecondaryColor:!0,style:{fontSize:16,fontWeight:500},children:e.heading}),(0,j.jsx)(_e.Z,{isSecondaryColor:!0,style:{whiteSpace:"normal",overflow:"visible"},children:e.description})]})})}function qe(e){let{enablePageAnalytics:t}=e;const s=(0,i.VK)((()=>ee.default.state.mainEditorCurrentBlockStore),[]),o=(0,i.VK)((()=>{const e=q.ou.now().minus({years:1}).valueOf();return!!s&&s.getCreatedTime()<e}),[s]),r=(0,i.VK)((()=>ee.default.state.currentSpaceStore),[]),d=(0,i.VK)((()=>!(null!=s&&s.canRead())),[s]),c=(0,l.O7)(),u=(0,i.VK)((()=>(0,Q._c)(c)),[c]),p=(0,i.VK)((()=>{var e;const t=null==s?void 0:s.getModel();return s&&null!=t&&t.isCollectionView()?null===(e=s.getCollectionPointer())||void 0===e?void 0:e.id:void 0}),[s]),m=(0,i.VK)((()=>Boolean(null==r?void 0:r.getSettings().disable_page_analytics)),[r]),g=(0,n.yK)((e=>({updatesEmptyStyle:{flex:1,display:"flex",justifyContent:"center",flexDirection:"column",textAlign:"center",color:e.mediumTextColor,fontSize:14,background:e.contentBackground,marginRight:u?2:0,pointerEvents:"auto",height:"100%"},updatesNotEmptyStyle:{display:"flex",flexDirection:"column",flex:"1 1 0%",background:e.contentBackground,marginRight:u?2:0,pointerEvents:"auto",marginTop:1,height:"100%"}})),[u]),f=(0,i.VK)((()=>T.ZP.state.currentSubTab),[]);if(d)return(0,j.jsx)(te.Z,{type:J.Z.Y,style:g.updatesEmptyStyle,children:(0,j.jsx)("div",{style:{width:200,alignSelf:"center"},children:(0,j.jsx)(a.FormattedMessage,{id:"updateSidebar.commentContainer.restricted",defaultMessage:"You don't have permission to view the updates of this restricted page."})})});if(r&&s)return(0,j.jsxs)(te.Z,{type:J.Z.Y,ref:e=>{X.Z.UpdateSidebarScroller=e},style:g.updatesNotEmptyStyle,children:[t&&(0,j.jsx)("div",{style:{display:f===T.uF.Analytics?"block":"none",height:"100%"},children:(0,j.jsx)(Re,{spaceId:r.id,store:s,isDisabledForWorkspace:m})}),(0,j.jsx)("div",{style:{display:f===T.uF.Updates?"block":"none"},children:(0,j.jsx)(w.Z,{collectionId:p,navigableBlock:s,spaceId:r.id,source:"updates_sidebar",empty:e=>(0,j.jsx)(te.Z,{type:J.Z.Y,style:g.updatesEmptyStyle,ref:e=>{X.Z.UpdateSidebarScroller=e},children:(0,j.jsx)("div",{style:{width:200,alignSelf:"center"},children:e.hasFiltersOn?(0,j.jsx)(a.FormattedMessage,{id:"updateSidebar.updatesContainer.emptyAfterSearch",defaultMessage:"No updates match the requested filters."}):o?(0,j.jsx)(a.FormattedMessage,{id:"updateSidebar.updatesContainer.emptyMaybePurged",defaultMessage:"There are no recent updates on this page. Page updates are retained for one year."}):(0,j.jsx)(a.FormattedMessage,{id:"updateSidebar.updatesContainer.empty",defaultMessage:"No updates on this page yet."})})})},s.id)})]});throw new Error("Loaded sidebar without AppStore initialized.")}var Xe=s(48779),Qe=s(74948),Je=s(33784),et=s(77080),tt=s(38302),st=s(82136),ot=s(88923);function it(e){const{currentTab:t}=e,s=(0,i.VK)((()=>ee.default.state.mainEditorCurrentBlockStore),[]),n=(0,i.VK)((()=>ee.default.state.currentSpaceStore),[]),a=(0,i.VK)((()=>ee.default.state.renderPhase),[]),[r,l]=(0,o.useState)(!1),d=(0,o.useMemo)((()=>Date.now()),[]),c=(0,i.VK)((()=>T.ZP.state.timeOpenedComments),[]),u=void 0!==c?Math.max(d,c):d,p=(0,i.VK)((()=>{var e,t;if(!s)return null;return Boolean(et.default.checkGate("enable_transcript_tab")&&(null===(e=s.getCollectionStore())||void 0===e?void 0:e.getDatabaseType())===R.Fi&&(null===(t=s.getFormatStore().getKeyStore("content_tabs"))||void 0===t?void 0:t[K.Z]))?U.Tf.page_info_layout_schema:U.bl.page_info_layout_schema}),[s]);if((0,o.useEffect)((()=>{r||"rendered"!==a||l(!0)}),[null==s?void 0:s.id,r,a]),!s||!n||!r)return(0,j.jsx)(Y.B,{areaHeight:window.innerHeight});switch(t){case T.gY.Comments:return(0,j.jsx)(G.J,{timeViewed:u,location:"sidebar"});case T.gY.Updates:return(0,j.jsx)(qe,{enablePageAnalytics:e.enablePageAnalytics});case T.gY.AiContext:return(0,j.jsx)(z,{});case T.gY.Info:return(0,j.jsx)(L.LazyUpdateSidebarTabInfo,{infoLayoutSchema:p,store:s,context:st.S.Frame,disabled:!1});default:(0,E.t1)(t)}}function nt(e){const t=(0,i.VK)((()=>({width:T.ZP.state.width,isAnimating:T.ZP.state.isAnimating})),[]),s=(0,l.O7)(),{shouldLoadSidebarComponents:a,isExpanded:r,popOutMode:d,closeSidebar:c}=e,u=(0,i.VK)((()=>r&&d&&!tt.Z.state.isOpen&&!Je.Z.state.open),[r,d]),p=(0,o.useRef)(null),m=(0,o.useMemo)((()=>[`.${F.zar}`,`.${F.hzx}`,`.${F.G6g}`,`.${F.K3y}`,`.${F.p0b}`,`.${F.mJW}`]),[]);(0,O.O)({active:u,closeHandler:c,ref:p,excludedSelectors:m});const g=Z.R6(s.device.isElectronMac),f=(0,n.yK)((e=>({container:{flexGrow:0,flexShrink:0,zIndex:D.XB,borderLeft:(d?"unset":!r&&"1px solid rgba(0,0,0,0)")||`1px solid ${e.regularDividerColor}`,alignSelf:"flex-end",position:"absolute",right:0,top:0,height:"100vh",pointerEvents:"none"},popOutContainer:{boxShadow:e.mediumBoxShadow,background:e.popoverBackground,borderRadius:4,border:r?`1px solid ${e.regularDividerColor}`:void 0,height:`calc(100% - 20px - ${g}px)`,marginTop:g+10,marginRight:r?10:0},wrap:{height:"100%"},content:{position:"absolute",top:0,bottom:0,display:r?"flex":"none",flexDirection:"column",overflow:"visible",zIndex:D.XB,width:t.width}})),[t.width,g,d,r]);return a?(0,j.jsx)("aside",{"aria-hidden":!r||void 0,ref:p,style:{...f.container,...d?f.popOutContainer:{}},onMouseMove:()=>{t.isAnimating||T.ZP.setState({...T.ZP.state,mouseEntered:!0})},onMouseLeave:()=>{t.isAnimating||T.ZP.setState({...T.ZP.state,mouseEntered:!1})},children:(0,j.jsx)("div",{style:f.wrap,children:(0,j.jsx)("div",{style:f.content,children:(0,j.jsx)(rt,{...e})})})}):null}function at(e){let{enablePageAnalytics:t,navigableBlock:s,onTabChange:o}=e;const a=(0,l.O7)(),{popOutMode:r}=(0,i.VK)((()=>({popOutMode:(0,Q._c)(a)})),[a]),d=(0,i.VK)((()=>T.ZP.state.currentTab),[]),c=(0,n.yK)((()=>({commentsHeaderStyle:{position:"relative",pointerEvents:"auto",marginTop:r?0:Z.R6(a.device.isElectronMac)}})),[a,r]);switch(d){case T.gY.Comments:return(0,j.jsx)("div",{style:c.commentsHeaderStyle});case T.gY.Updates:return(0,j.jsx)(B,{popOutMode:r,navigableBlock:s,enablePageAnalytics:t,onTabChange:o});case T.gY.AiContext:case T.gY.Info:return(0,j.jsx)("div",{style:c.commentsHeaderStyle});default:(0,E.t1)(d)}}function rt(e){const{isResizerHovered:t,isResizing:s,currentTab:a,expanded:r}=(0,i.VK)((()=>{const{isResizerHovered:e,isResizing:t,currentTab:s,expanded:o}=T.ZP.state;return{isResizerHovered:e,isResizing:t,currentTab:s,expanded:o}}),[]),{currentBlockStore:d}=e,c=(0,l.O7)(),{currentTabToRender:u,popOutMode:p}=(0,i.VK)((()=>({currentTabToRender:d.isCollectionView()&&!d.isCollectionViewPageWithContent()?T.gY.Updates:a,popOutMode:(0,Q._c)(c)})),[d,a,c]),m=(0,i.VK)((()=>{const{currentSpaceStore:e}=ee.default.state;return!(0,Xe.Cx)(e)}),[]),g=o.useCallback((e=>{N.Zm(c,{tab:e===T.uF.Updates?"updates":"analytics",origin:ot.default.state.open?"peek_view":"page"}),T.ZP.setState({...T.ZP.state,currentSubTab:e})}),[c]),f=(0,n.yK)((e=>({pane:{display:"flex",flexDirection:"column",height:"100%",position:"relative",pointerEvents:"none",maxHeight:"100%",backgroundColor:a===T.gY.Comments?void 0:"inherit"},resizerStyle:{position:"absolute",top:0,left:-3,bottom:0,right:0,height:"100vh",width:3,zIndex:-1,display:"block",transition:"box-shadow 300ms ease-in",...(t||s)&&r?{boxShadow:e.sidebarResizerBoxShadow}:{}},controlsHeaderStyle:{position:"relative",pointerEvents:"auto",marginTop:p?0:Z.R6(c.device.isElectronMac),paddingTop:4,width:p?"calc(100% - 2px)":"100%",background:e.contentBackground,borderRadius:4,paddingBottom:1}})),[a,t,s,c,r,p]);return(0,j.jsxs)("div",{style:f.pane,className:F.zar,children:[(0,j.jsx)("div",{style:f.resizerStyle}),(0,j.jsx)(at,{enablePageAnalytics:m,navigableBlock:d,onTabChange:g}),(0,j.jsx)(it,{currentTab:u,enablePageAnalytics:m}),r&&(0,j.jsx)(W.Z,{type:"update"})]})}function lt(e){const{isElectronMac:t,currentBlockStore:s}=e,n=(0,i.VK)((()=>({width:T.ZP.state.width,isAnimating:T.ZP.state.isAnimating,canRender:T.ZP.state.canRender})),[]),a=(0,i.VK)((()=>ee.default.state.currentSpaceStore),[]),r=(0,o.useMemo)((()=>null==a?void 0:a.clone()),[a]),d=(0,l.O7)(),c=(0,i.VK)((()=>d.currentUser.isLoggedIn()&&(0,Q.Sx)(d)),[d]),{isExpanded:u,popOutMode:p,closeSidebar:m}=(0,i.VK)((()=>({isExpanded:(0,Q.Sx)(d),popOutMode:(0,Q._c)(d),closeSidebar:()=>Qe.setUpdateExpand({environment:d,isExpanded:!1,from:"close_for_space"})})),[d]),[g,f]=(0,o.useState)(!1),[x,y]=(0,o.useState)(void 0);return(0,o.useEffect)((()=>{(void 0===x||x===s.id)&&u&&(f(!0),y(s.id))}),[x,s,u]),n.canRender&&r?(0,j.jsx)(H.Z,{isVisible:!0,useCompositeLayer:!0,animationStyle:{width:c?n.width:0},render:()=>(0,j.jsx)($.Z,{store:r,droppable:!0,render:()=>(0,j.jsx)(nt,{isElectronMac:t,isFullyExpanded:!n.isAnimating,currentBlockStore:s,isExpanded:u,popOutMode:p,closeSidebar:m,shouldLoadSidebarComponents:g})},r.id),onAnimationStart:()=>{T.ZP.setState({...T.ZP.state,isAnimating:!0})},onAnimationEnd:()=>{T.ZP.setState({...T.ZP.state,isAnimating:!1})}}):null}var dt=s(83355),ct=s(49085),ut=s(17693),pt=s(1464),mt=s(37850),gt=s(17659),ft=s(11066),xt=s(36488),yt=s(43145),ht=s(30506),vt=s(83785),bt=s(3712),St=s(12457),jt=s(51811),Mt=s(5162),Ct=s(4761),wt=s(41549),Zt=s(90797),Ft=s(76386),Tt=s(66160),kt=s(5758);const Pt=[{tab:"mentions"},{tab:"archive"},{tab:"allPages",showSeparatorBefore:!0}];class It extends dt.Z{constructor(){super(...arguments),this.storeTypes={refreshCountStore:ct.default.createClass(0)},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRefreshAll=()=>{var e;(e=this.stores.refreshCountStore).setState(e.state+1)},this.handleRefreshAllThrottled=fe.Ds(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRefreshAll,1e3,{leading:!0})}willUnmount(){var e;e=this.environment,p.nI(e),gt.G7({environment:e,newTab:"mentions",shouldTrack:!1})}renderComponent(){const{device:e}=this.environment;let t;if(e.isMobile){const s="mobileTopBar";t={menuType:h.og.Modal,title:(0,j.jsx)(g.ZP,{style:{...e.isMobile&&{borderTopLeftRadius:12,borderTopRightRadius:12,overflow:"hidden"}},popupType:g.Z4.SlideUp,alignmentToOrigin:g.vR.Start,placementToOrigin:g.pO.Bottom,renderOrigin:e=>(0,j.jsxs)(ft.Z,{style:{display:"flex",alignItems:"center",gap:6,borderRadius:4,paddingTop:2,paddingBottom:2,paddingLeft:6,paddingRight:6},...e,children:[(0,j.jsx)(kt.Qy,{filter:wt.Fz()}),(0,ut.A)({width:16,height:16,fill:this.theme.mediumIconColor})]}),render:e=>(0,j.jsx)(Ft.J,{closePopup:e.close})}),width:this.props.format===jt.EX.RenderAsPage?"100vw":void 0,renderAsPage:this.props.format===jt.EX.RenderAsPage,right:[(0,j.jsx)(Zt.p,{},"InboxEllipsisButton"),(0,j.jsx)("span",{style:{width:8}},"paddingSpan"),(0,j.jsx)(bt.Z,{location:s},"InboxNotificationSettingsButton")],left:[Vt(),e.isPhone&&(0,Mt.Y)("supportsNativeHome")&&this.props.format===jt.EX.RenderAsPage&&!(0,Mt.Y)("supportsNativeInbox")?void 0:(0,pt.k)({fill:this.theme.regularTextColor,width:26,height:26})],onClickLeft:this.props.onClose,whiteBackground:!0,disableHeaderShadow:!0}}else t={menuType:h.og.Popup,height:"auto"};return(0,j.jsx)(ht.Z,{onSwipeLeft:()=>function(e){const t=Pt.findIndex((e=>e.tab===Ct.ZP.state.currentTab)),s=Pt[t+1].tab;void 0!==s&&gt.G7({environment:e,newTab:s,shouldTrack:!0})}(this.environment),onSwipeRight:()=>function(e){const t=Pt.findIndex((e=>e.tab===Ct.ZP.state.currentTab)),s=Pt[t-1].tab;void 0!==s&&gt.G7({environment:e,newTab:s,shouldTrack:!0})}(this.environment),render:e=>(0,j.jsxs)(f.Z,{...t,...e,className:F.C18,children:[(0,j.jsx)(yt.Z,{onChange:(e,t)=>{let{offsetFromTop:s}=t;Ct.n_.setState(s<=0)}}),(0,j.jsx)(xt.Z,{capture:!0,allowUndo:!0,allowEsc:!0,allowMobileAutoScroll:!0,render:()=>this.props.format===jt.EX.RenderAsPage?(0,j.jsx)(Bt,{}):(0,j.jsx)(_t,{})})]})})}}function _t(){const e=(0,i.VK)((()=>{var e;return null===(e=ee.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),t=(0,i.VK)((()=>wt.Fz()),[]),s={emptyState:{marginTop:100,cursor:"auto"}};return(0,j.jsx)(j.Fragment,{children:"all_updates"!==t?(0,j.jsx)(Tt.Z,{type:"archived_only"===t?"archive":"mentions",source:"notifications_tab",tab:"inbox",empty:(0,j.jsx)("div",{style:s.emptyState,children:(0,j.jsx)(kt.u_,{filter:t})})},t):e&&(0,j.jsx)(w.Z,{spaceId:e,source:"notifications_tab",empty:()=>(0,j.jsx)("div",{style:s.emptyState,children:(0,j.jsx)(kt.u_,{filter:t})})},t)})}function Bt(){const e=(0,l.O7)();return(0,j.jsx)(vt.Z,{fetch:async()=>{await mt.Vs(0),await ee.default.waitUntil((()=>void 0!==ee.default.state.currentSpaceStore))},loading:()=>(0,j.jsx)(o.Fragment,{}),willRender:()=>{var t;null===(t=e.mobileNative)||void 0===t||t.markTransitionReady({type:"updates"})},render:()=>(0,j.jsx)(H.Z,{isVisible:!0,enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},blockRenderQueueOnEnter:!0,render:()=>(0,j.jsx)(_t,{})})})}function Vt(){if((0,Mt.Y)("supportsNativeHome"))return(0,j.jsx)(St.Z,{show:void 0!==Ct.ZP.state.loadingId,showDelay:400,showHold:0,render:e=>e?(0,j.jsx)(ke.Z,{style:{width:14}}):(0,j.jsx)("div",{style:{width:14}})})}It.displayName="MobileInboxPopup"},47054:(e,t,s)=>{s.d(t,{AD:()=>d});s(57658);var o=s(30120),i=s(19584),n=s(59730);const a=7;function r(e){if(void 0===e)return o.ou.utc();const t={zone:"utc"};return"number"==typeof e?o.ou.fromMillis(e,t):o.ou.fromISO(e,t)}function l(e,t){const s=t?r(t):o.ou.utc(),i=r(e??function(e){const{days:t,endDate:s,startDate:i}=e;if(t<=0)throw new n.p8("Days must be greater than 0");const a=s?r(s):o.ou.utc();if(!a.isValid)throw new n.p8(`endDate ${s} is in an invalid format`);const l=i?r(i).toMillis():0,d=a.minus({days:t-1}).toMillis();return Math.max(d,l)}({days:a,endDate:t}));if(!i.isValid)throw new n.p8(`startDate ${e} is in an invalid format`);if(!s.isValid)throw new n.p8(`endDate ${t} is in an invalid format`);if(i>s)throw new n.p8(`startDate ${e} => ${i.toISO()} is after endDate ${t} => ${s.toISO()}`);return{startTimestamp:i.toMillis(),endTimestamp:s.toMillis()}}function d(e,t){const{startTimestamp:s,endTimestamp:o}=l(e,t),n=[];for(var a=s;a<=o;)n.push(r(a).toISODate()),a+=i.A0;return n}},16880:(e,t,s)=>{s.d(t,{R:()=>n});s(67294);var o=s(45238),i=s(85893);const n=(0,o.IU)("chevronUpRounded",{viewBox:"0 0 15 9",svg:(0,i.jsx)("path",{d:"M1.258 6.5L7.203.422a.946.946 0 01.719-.32.99.99 0 01.726.32L14.586 6.5a.89.89 0 01.266.648c0 .524-.407.93-.922.93a.921.921 0 01-.672-.281L7.93 2.32 2.586 7.797a.926.926 0 01-.672.281.915.915 0 01-.922-.93c0-.25.094-.476.266-.648z"})})},21197:(e,t,s)=>{s.d(t,{Q:()=>n});s(67294);var o=s(45238),i=s(85893);const n=(0,o.IU)("filter",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M1.63574 5.17969H14.3643C14.7197 5.17969 15.0068 4.88574 15.0068 4.53027C15.0068 4.1748 14.7197 3.8877 14.3643 3.8877H1.63574C1.27344 3.8877 0.993164 4.1748 0.993164 4.53027C0.993164 4.88574 1.28027 5.17969 1.63574 5.17969ZM3.05078 8.71387H12.9766C13.332 8.71387 13.6191 8.41992 13.6191 8.06445C13.6191 7.70215 13.3389 7.41504 12.9766 7.41504H3.05078C2.68848 7.41504 2.4082 7.70898 2.4082 8.06445C2.4082 8.41309 2.69531 8.71387 3.05078 8.71387ZM4.43848 12.2412H11.5889C11.9512 12.2412 12.2314 11.9473 12.2314 11.5918C12.2314 11.2363 11.9512 10.9492 11.5889 10.9492H4.43848C4.07617 10.9492 3.7959 11.2363 3.7959 11.5918C3.7959 11.9473 4.07617 12.2412 4.43848 12.2412Z"})})}}]);