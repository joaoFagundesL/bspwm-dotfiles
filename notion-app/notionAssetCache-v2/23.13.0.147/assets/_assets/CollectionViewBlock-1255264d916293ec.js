"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[3190],{95193:(e,t,o)=>{o.d(t,{F:()=>l,U:()=>s});var r=o(480),i=o(86628),n=o(60709);function s(e){return e.device.isPhone||"actionSheet"===e.tabletBehavior&&e.device.isTablet?{menuType:n.og.ActionSheet}:{menuType:n.og.Popup,maxHeight:e.maxHeight,maxWidth:e.maxWidth,paddingTop:e.paddingTop,paddingBottom:e.paddingBottom,width:e.width,minWidth:e.minWidth}}function l(e){const t=(0,r.Fy)();return(0,i.VK)((()=>s({device:t,maxHeight:null==e?void 0:e.maxHeight,maxWidth:null==e?void 0:e.maxWidth,paddingTop:null==e?void 0:e.paddingTop,paddingBottom:null==e?void 0:e.paddingBottom,width:null==e?void 0:e.width,minWidth:null==e?void 0:e.minWidth,tabletBehavior:null==e?void 0:e.tabletBehavior})),[t,null==e?void 0:e.maxHeight,null==e?void 0:e.maxWidth,null==e?void 0:e.paddingTop,null==e?void 0:e.paddingBottom,null==e?void 0:e.width,null==e?void 0:e.minWidth,null==e?void 0:e.tabletBehavior])}},35294:(e,t,o)=>{o.d(t,{d:()=>s});var r=o(480),i=o(86628),n=o(53437);function s(e){const t=(0,r.Fy)();return(0,i.VK)((()=>t.isPhone||"slideUp"===(null==e?void 0:e.tabletBehavior)&&t.isTablet?n.kQ.SlideUp:n.kQ.Popup),[t,null==e?void 0:e.tabletBehavior])}},32628:(e,t,o)=>{o.d(t,{S:()=>R,Z:()=>F});o(57658);var r=o(67294),i=o(480),n=o(86628),s=o(24405),l=o(49085),a=o(56666),c=o(44495),d=o(6287),u=o(9291),p=o(26249),h=o(8406),m=o(73657),S=o(52275),g=o(68894),C=o(32163),f=o(11470),y=o(72495),v=o(26388),x=o(78948),b=o(23586),w=o(33929),k=o(77907),_=o(75822),T=o(80444),O=o(29798),V=o(6258),P=o(85893);let R=function(e){return e[e.Source=0]="Source",e[e.Relation=1]="Relation",e[e.Automation=2]="Automation",e}({});const M=(0,u.defineMessages)({linkedInputPlaceholder:{defaultMessage:"Link to a database…",id:"database.viewSettings.searchCollections.linkedInputPlaceholder"},linkedOrSourceInputPlaceholder:{defaultMessage:"Link or create a database…",id:"database.viewSettings.searchCollections.linkedOrSourceInputPlaceholder"},automationInputPlaceholder:{id:"automations.databasePicker.automationInputPlaceholder",defaultMessage:"Select a database…"}}),j=l.default.createClass("");function I(e){let{collectionContextStore:t,selectedCollectionStore:o,context:l,parentStore:c,onAccept:p,requireEditPermissions:v,searchSessionId:I,inputStore:F}=e;const N=(0,i.O7)(),D=(0,n.qz)(F,j),L=(0,n.qz)(void 0,O.Z),[E,A]=(0,r.useState)(5),H=(0,n.VK)((()=>D.state),[D]),Z=(0,n.VK)((()=>null==t?void 0:t.getCollectionViewBlockSourceState()),[t]),z=(0,s.yK)((e=>({showMoreButton:{color:e.mediumTextColor,fill:e.mediumIconColor}})),[]),G="linked"===Z||l===R.Relation?M.linkedInputPlaceholder:l===R.Source?M.linkedOrSourceInputPlaceholder:M.automationInputPlaceholder,K=(0,r.useCallback)((e=>{const{collectionStore:o,totalResults:r,clickedIndex:i}=e;t&&h.wd({environment:N,collectionContextStore:t,action:"select_existing_collection"}),p(o),h.tW({environment:N,eventName:"select_search_item",totalResults:r,clickedIndex:i,sessionId:I,source:l,queryLength:H.length})}),[t,l,N,H,p,I]);return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(y.Z,{children:(0,P.jsx)(g.ZP,{focusInitial:!N.device.isMobile||void 0,value:H,onChange:e=>{D.setState(e.target.value),A(e.target.value?20:5),L.setState({focus:{section:0,indexLocal:0,indexGlobal:0}})},placeholder:w.default.formatMessage(G),showClearButton:!0})}),(0,P.jsx)(b.Z,{request:{query:H,limit:E},performRequest:e=>async function(e,t,o,r,i,n){const{query:s,limit:l}=e,{currentSpaceStore:a}=T.default.state,c=null==i?void 0:i.collectionViewBlockStore(),d=await k.deps.searchActions.loader(),u=await d.searchCollectionsWithRecents({environment:o,collectionViewBlockStore:c,parentStore:t,spaceStore:a,query:s,limit:l,requireEditPermissions:n,searchSessionId:r});return{results:u.results,showMore:Math.max(0,u.total-u.results.length)}}(e,c,N,I,t,v),debounce:_.vp,render:(e,r,i)=>{if(!r)return(0,P.jsx)(y.Z,{children:(0,P.jsx)(x.Z,{})});const{results:n,showMore:s}=r,p=n.map((e=>{const r=V.NW.createChildStore(c,{table:d.vF,id:e});return{key:e,render:i=>{var n;return(0,P.jsx)(f.Z,{...i,checkState:o&&o.id===e,store:r,right:l===R.Relation&&(null==t||null===(n=t.collectionStore())||void 0===n?void 0:n.id)===e&&(0,P.jsx)(B,{})})},action:e=>{const{index:t}=e;K({collectionStore:r,totalResults:n.length,clickedIndex:t})}}}));if(s>0){const e={key:"showMore",render:e=>(0,P.jsx)(S.Z,{...e,buttonStyle:z.showMoreButton,icon:(0,a.o)({width:16,height:16}),title:(0,P.jsx)(u.FormattedMessage,{defaultMessage:"Show {showMore} more",id:"database.viewSettings.searchCollections.showMore.title",values:{showMore:Math.min(s,20)}})}),action:()=>{A(E+20)}};p.push(e)}return(0,P.jsxs)(P.Fragment,{children:[n.length>0&&(0,P.jsx)(C.Z,{type:C.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,P.jsx)(y.Z,{...e}),items:p}],store:L}),0===n.length&&(0,P.jsx)(m.Z,{caption:(0,P.jsx)(u.FormattedMessage,{defaultMessage:"No results",id:"database.viewSettings.searchCollections.noResultsTitle"})})]})}})]})}const F=r.memo(I,p.Z);function B(){return(0,P.jsx)(v.ZP,{renderTooltip:()=>(0,P.jsx)(u.FormattedMessage,{defaultMessage:"This database",id:"database.viewSettigs.searchCollections.thisDatabase.tooltip"}),render:e=>(0,P.jsx)("div",{...e,children:(0,c.D)({width:14,height:14})})})}},59827:(e,t,o)=>{o.d(t,{Q:()=>a});o(67294);var r=o(37810),i=o(65183),n=o(85893);const s={...r.Z.textOverflowStyle,position:"absolute",left:0,right:0,top:0,bottom:0},l={marginLeft:4,fontWeight:r.Z.fontWeight.semibold};function a(e){const{prefix:t,viewName:o,viewType:r}=e;return(0,n.jsxs)("div",{style:{position:"relative",width:"100%"},children:[" ",(0,n.jsxs)("div",{style:s,children:[t,r&&i.aW[r]({marginLeft:8,marginRight:2,width:"1em",display:"inline",verticalAlign:"bottom"}),(0,n.jsx)("span",{style:l,children:o})]})]})}},73657:(e,t,o)=>{o.d(t,{Z:()=>n});o(67294);var r=o(28992),i=o(85893);const n=function(e){return(0,i.jsx)(r.Z,{...e,style:{background:"none",borderBottom:"none",boxShadow:"",marginTop:2,marginBottom:6,paddingTop:4,paddingBottom:4,minHeight:"none",...e.style}})}},10912:(e,t,o)=>{o.d(t,{Z:()=>_});o(57658),o(67294);var r=o(83355),i=o(27531),n=o(86628),s=o(24405),l=o(41432),a=o(80951),c=o(95538),d=o(21202),u=o(1898),p=o(10906),h=o(12457),m=o(17311),S=o(35328),g=o(6258),C=o(9672),f=o(12981),y=o(43568),v=o(81865),x=o(35541),b=o(85893);function w(e){return"number"==typeof e}class k extends r.Z{constructor(){super(...arguments),this.renderContentBlock=e=>{const{store:t,renderAdditionalBlocks:o,rendererBlockStyle:r}=this.props,n=g.G.createChildStore(t,{table:d.iU,id:e}),s=n.getType(),l=o&&void 0!==s,a=this.blockIdsToRenderStore.state,c="table_row"===s?n.getParentBlockStore():n,u=l?c&&(0,x.u)({store:c,restrictedBlockIds:a,tableRenderMode:this.getTableRenderMode()}):(0,C.h)(n);if(u)return(0,b.jsx)(i.D,{value:this.restrictedContentStore,children:(0,b.jsx)(u,{store:n,disabled:!0,disableCommentMenu:!0,disableHoverMenu:!0,hideContent:(0,S.BX)(n),style:{fontSize:12,opacity:.8,pointerEvents:"none",...r},isQuickFind:!0,numberedListCounterStore:this.createComputedStore((()=>({depth:0,numberedListBlockIdsWithFormat:z(e,this.numberedLists)})))})},e)},this.coverStore=this.createComputedStore((()=>{const{store:e,renderAdditionalBlocks:t=!1,startBlockId:o}=this.props,{ThemeStore:r}=this.environment,i=o?(0,p.wK)({rootStore:e,renderAdditionalBlocks:t,startBlockId:o,tableRenderMode:this.getTableRenderMode()}):(0,p.NU)({rootStore:e,renderAdditionalBlocks:t,theme:r.state.mode});return i.image?i.image:!(this.props.showLoadingShimmer&&0===i.blockIds.length&&!i.isDefined)&&i.blockIds})),this.restrictedContentStore=this.createComputedStore((()=>{const{store:e,renderAdditionalBlocks:t=!1,startBlockId:o}=this.props,r=(0,p.wK)({rootStore:e,renderAdditionalBlocks:t,startBlockId:o,tableRenderMode:this.getTableRenderMode()});return r.image?void 0:r.blockIds})),this.blockIdsToRenderStore=this.createComputedStore((()=>{const e=this.coverStore.state,t=this.restrictedContentStore.state;return e&&Array.isArray(e)?e.filter((e=>!t||t.includes(e))):[]})),this.numberedLists=this.createComputedStore((()=>{const{store:e}=this.props,t=this.coverStore.state,o=[];if(Array.isArray(t)){let r=0;for(;r<t.length;){let i=t[r],n=g.G.createChildStore(e,{table:d.iU,id:i});if(n.getType()===l.Ti.numberedList){const s=[{blockId:i,idx:1}],a=[{id:i,format:void 0,depth:s.length-1,index:s[0].idx}];for(r+=1;r<t.length&&(i=t[r],n=g.G.createChildStore(e,{table:d.iU,id:i}),n.getType()===l.Ti.numberedList);){{const e=n.getParentId();if(n.getParentId()===s[s.length-1].blockId)s.push({blockId:i,idx:1});else{let t=s[s.length-1].idx;for(;s.length>0&&s[s.length-1].blockId!==e;)t=s[s.length-1].idx,s.pop();s.push({blockId:i,idx:t+1})}a.push({id:i,format:void 0,depth:s.length-1,index:s[s.length-1].idx})}r+=1}o.push(a)}else r+=1}}return o}))}didUpdate(e){this.props.coverFormat.type!==e.coverFormat.type&&this.props.onLoadProxiedImage()}renderComponent(){const{coverFormat:e}=this.props;return"page_cover"===e.type?(0,b.jsx)(A,{store:this.props.store,coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,imageCoverWrapStyle:this.props.imageCoverWrapStyle,coverWidth:this.props.coverWidth,onLoadProxiedImage:this.props.onLoadProxiedImage,style:this.props.style,variant:this.props.variant,coverAspectFormat:this.props.coverAspectFormat,coverPosition:this.props.coverPosition,showEmptyGalleryCover:this.props.showEmptyGalleryCover,emptyGalleryCoverStyle:this.props.emptyGalleryCoverStyle}):"page_content"===e.type?this.renderPageContent():"property"===e.type?(0,b.jsx)(H,{store:this.props.store,coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,imageCoverWrapStyle:this.props.imageCoverWrapStyle,onLoadProxiedImage:this.props.onLoadProxiedImage,coverWidth:this.props.coverWidth,style:this.props.style,variant:this.props.variant,coverAspectFormat:this.props.coverAspectFormat,coverPosition:this.props.coverPosition,showEmptyGalleryCover:this.props.showEmptyGalleryCover,emptyGalleryCoverStyle:this.props.emptyGalleryCoverStyle,property:e.property}):void 0}renderPageContent(){const e=this.coverStore.state,t=this.restrictedContentStore.state,o=this.props.renderAdditionalBlocks&&this.props.store.isCollectionView();if(!1===e)return(0,b.jsx)(I,{coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,loadingShimmerStyle:this.props.loadingShimmerStyle});if(e){if(!Array.isArray(e))return o?(0,b.jsxs)("div",{style:L(this.props.variant,this.environment,this.theme,this.props.coverHeight,this.props.coverSizeFormat,this.props.coverContentFadedOverlay,this.props.contentWrapStyle,this.props.isCompactView),children:[(0,b.jsx)(v.Z,{url:e.url,onFinishedLoadingProxyUrl:e=>this.props.onLoadProxiedImage(e),isAuthenticated:!0,permissionRecord:e.pointer,width:P(),render:(e,t)=>{if(t)return(0,b.jsx)(f.Z,{style:{...O(),...Z({renderCollectionImage:!0},this.props.variant,this.theme,this.props.coverHeight,this.props.coverSizeFormat),...R(),objectPosition:`center ${100*(1-T(this.props.store,this.props.coverPosition))}%`},placeholderLoadedStyle:{display:"flex",justifyContent:"center",alignItems:"end"},src:t})}}),(0,b.jsx)(D,{variant:this.props.variant}),(0,b.jsx)("div",{style:B(this.theme,this.props.coverContentFadedOverlayStyle)})]}):(0,b.jsxs)("div",{style:M(this.props.coverHeight,this.props.coverSizeFormat,this.props.imageCoverWrapStyle),children:[(0,b.jsx)(v.Z,{url:e.url,onFinishedLoadingProxyUrl:e=>this.props.onLoadProxiedImage(e),isAuthenticated:!0,permissionRecord:e.pointer,width:P(this.props.coverWidth,this.props.coverSizeFormat),render:(e,t)=>{if(t)return(0,b.jsx)(f.Z,{style:{...O(this.props.style),...Z({renderCollectionImage:!1},this.props.variant,this.theme,this.props.coverHeight,this.props.coverSizeFormat),...R(this.props.coverAspectFormat),objectPosition:`center ${100*(1-T(this.props.store,this.props.coverPosition))}%`},src:t,loading:"lazy"})}}),(0,b.jsx)(D,{variant:this.props.variant})]});if(e.length>0)return(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)("div",{style:L(this.props.variant,this.environment,this.theme,this.props.coverHeight,this.props.coverSizeFormat,this.props.coverContentFadedOverlay,this.props.contentWrapStyle,this.props.isCompactView),children:[t?e.filter((e=>t.indexOf(e)>=0)).map(this.renderContentBlock):e.map(this.renderContentBlock),this.props.coverContentFadedOverlay&&(0,b.jsx)("div",{style:B(this.theme,this.props.coverContentFadedOverlayStyle)})]})});if(this.props.showEmptyGalleryCover)return(0,b.jsx)(j,{coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,emptyGalleryCoverStyle:this.props.emptyGalleryCoverStyle??L(this.props.variant,this.environment,this.theme,this.props.coverHeight,this.props.coverSizeFormat,this.props.coverContentFadedOverlay,this.props.contentWrapStyle,this.props.isCompactView)})}else if(this.props.showEmptyGalleryCover)return(0,b.jsx)(j,{coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,emptyGalleryCoverStyle:this.props.emptyGalleryCoverStyle})}getTableRenderMode(){return this.props.renderAdditionalBlocks&&this.props.startBlockId?"table":"image"}}k.displayName="CollectionItemCover";const _=k;function T(e,t){if(w(t))return t;if(e.getFormatStore().isDefined()){const{page_cover_position:t,card_cover_position:o}=e.getFormat();if(w(o))return o;if(w(t))return t}return.5}function O(e){return e||{}}function V(e,t){if(e)return e;switch(t){case"large":return m.Z.card.desktop.large.height;case"small":return m.Z.card.desktop.small.height;default:return m.Z.card.desktop.medium.height}}function P(e,t){return e||(0,p.rD)(t)}function R(e){return{objectFit:void 0===e?"cover":e}}function M(e,t,o){return{height:V(e,t),position:"relative",pointerEvents:"none",overflow:"hidden",...o}}function j(e){let{coverHeight:t,coverSizeFormat:o,emptyGalleryCoverStyle:r}=e;return(0,b.jsx)("div",{style:{height:V(t,o),...r}})}function I(e){let{coverHeight:t,coverSizeFormat:o,loadingShimmerStyle:r}=e;return(0,b.jsx)("div",{style:{height:V(t,o),...r},children:(0,b.jsx)(h.Z,{show:!0,showDelay:100,showHold:0,render:e=>e?(0,b.jsx)(y.Z,{paragraphs:[{lineHeight:12,lineMargin:6,sectionWidths:[100,100,50],repeat:1,sectionMargin:0}]}):void 0})})}function F(e,t,o,r,i){const{ThemeStore:n}=t,s="dark"===n.state.mode,l=i?o.lightDividerColor:o.regularDividerColor;switch(e){case"default":return{};case"gallery":return{background:o.collectionGalleryPreviewCardCover,padding:"8px 8px 0",boxShadow:s?"transparent":`inset 0 -1px 0 0 ${l}`,...r};default:(0,u.t1)(e)}}function B(e,t){return{width:"100%",height:40,position:"absolute",bottom:0,left:0,background:`linear-gradient(to bottom, transparent, ${e.accentColors.gray[30]} 100%)`,...t}}function N(e,t){switch(e){case"default":return{border:`1px solid ${t.stroke.regular}`,borderTopLeftRadius:4,borderTopRightRadius:4,borderBottomRightRadius:4,borderBottomLeftRadius:4};case"gallery":return{borderRadius:0,borderTopLeftRadius:1,borderTopRightRadius:1};default:(0,u.t1)(e)}}function D(e){let{variant:t}=e;const o=(0,s.Fg)();switch(t){case"default":return null;case"gallery":return(0,b.jsx)("div",{style:{position:"absolute",left:0,right:0,bottom:0,borderBottom:`1px solid ${o.regularDividerColor}`}});default:(0,u.t1)(t)}return null}function L(e,t,o,r,i,n,s,l){return{height:V(r,i),pointerEvents:"none",overflow:"hidden",position:n?"relative":"static",...F(e,t,o,s,l),...s}}function E(e,t,o,r){return{width:"100%",height:V(o,r),...N(e,t),objectPosition:"center"}}function A(e){let{store:t,coverHeight:o,coverSizeFormat:r,imageCoverWrapStyle:i,coverWidth:l,onLoadProxiedImage:a,style:c,variant:d,coverAspectFormat:u,coverPosition:p,showEmptyGalleryCover:h,emptyGalleryCoverStyle:m}=e;const S=(0,s.Fg)(),g=(0,n.VK)((()=>{var e;return null===(e=t.getCover())||void 0===e?void 0:e.cover}),[t]),C=(0,n.VK)((()=>t.pointer),[t]),y=(0,n.VK)((()=>T(t,p)),[p,t]);return g?(0,b.jsxs)("div",{style:M(o,r,i),children:[(0,b.jsx)(v.Z,{url:g,isAuthenticated:!0,permissionRecord:C,width:P(l,r),onFinishedLoadingProxyUrl:e=>a(e),render:(e,t)=>{if(t)return(0,b.jsx)(f.Z,{style:{...O(c),...E(d,S,o,r),...R(u),objectPosition:`center ${100*(1-y)}%`},src:t,loading:"lazy"})}}),(0,b.jsx)(D,{variant:d})]}):h?(0,b.jsx)(j,{coverHeight:o,coverSizeFormat:r,emptyGalleryCoverStyle:m}):null}function H(e){let{property:t,store:o,coverHeight:r,coverSizeFormat:i,imageCoverWrapStyle:l,onLoadProxiedImage:d,coverWidth:u,style:p,variant:h,coverAspectFormat:m,coverPosition:S,showEmptyGalleryCover:g,emptyGalleryCoverStyle:C}=e;const y=(0,s.Fg)(),x=(0,n.VK)((()=>(0,a.g)(o.getPropertyValue(t)).find((e=>(0,c.SR)({url:e.url})))),[t,o]),w=(0,n.VK)((()=>o.pointer),[o]),k=(0,n.VK)((()=>T(o,S)),[S,o]);return x?(0,b.jsxs)("div",{style:M(r,i,l),children:[(0,b.jsx)(v.Z,{onFinishedLoadingProxyUrl:e=>d(e),url:x.url,isAuthenticated:!0,permissionRecord:w,width:P(u,i),render:(e,t)=>{if(t)return(0,b.jsx)(f.Z,{style:{...O(p),...E(h,y,r,i),...R(m),objectPosition:`center ${100*(1-k)}%`},src:t,loading:"lazy"})}}),(0,b.jsx)(D,{variant:h})]}):g?(0,b.jsx)(j,{coverHeight:r,coverSizeFormat:i,emptyGalleryCoverStyle:C}):null}function Z(e,t,o,r,i){const{renderCollectionImage:n}=e;return{...E(t,o,r,i),objectPosition:"center center",...n&&{height:void 0,border:`1px solid ${o.lightDividerColor}`,borderBottom:"none",borderBottomLeftRadius:0,borderBottomRightRadius:0}}}function z(e,t){const o=t.state;for(const r of o)if(r.find((t=>t.id===e)))return r;return[]}},81870:(e,t,o)=>{o.d(t,{Z:()=>d});o(67294);var r=o(480),i=o(24405),n=o(84169),s=o(25888),l=o(73063),a=o(16354),c=o(85893);const d=function(e){const t=(0,r.O7)(),o=(0,i.Fg)();return(0,c.jsx)(a.Z,{href:e.href,external:!0,onClick:()=>s.Fs(t,{from:e.helpButtonContext}),children:(0,c.jsx)(l.Z,{icon:n.m,style:{height:24,width:24,marginRight:-6,fill:o.mediumIconColor}})})}},57260:(e,t,o)=>{o.d(t,{Z:()=>G});var r=o(67294),i=o(480),n=o(86628),s=o(24405),l=o(15145),a=o(58573),c=o(47453),d=o(35840),u=o(9291),p=o(53965),h=o(81193),m=o(98834),S=o(8055),g=o(13447),C=o(59827),f=o(66890),y=o(66213),v=o(27105),x=o(92658),b=o(14976),w=o(75079),k=o(84210),_=o(60709),T=o(18514),O=o(80444),V=o(29798),P=o(6258),R=o(81023),M=o(13401),j=o(81870),I=o(40071),F=o(79131),B=o(68894),N=o(78140),D=o(28992),L=o(32163),E=o(40721),A=o(72495),H=o(59658),Z=o(85893);const z=(0,u.defineMessages)({filterPlaceholder:{id:"collectionPicker.searchBarFilter.text",defaultMessage:"Filter…"}});const G=function(e){let{collectionStore:t,isOverlay:o,onEmptyEnter:r,onEmptyPageClick:l,onCancelClick:c,canConfigureCollection:d,locked:p,onTemplateClick:h}=e;const m=(0,s.Fg)(),S=(0,i.Fy)(),g=(0,n.qz)(void 0,x.Z),C=(0,n.qz)(void 0,V.Z),f=(0,n.VK)((()=>t.getTemplatePageStores().filter((e=>e.getAlive()))),[t]),y=(0,n.VK)((()=>f.every((e=>e.isReady()))),[f]),v=(0,n.VK)((()=>g.state.inputValue),[g]),b=(0,n.VK)((()=>o&&v.length?(0,a.ZP)(v,f,(e=>String(e.getProperties().title)??"")):f),[f,v,o]);if(!y)return null;let w=(0,Z.jsx)(q,{collectionStore:t,onEmptyEnter:r,onEmptyPageClick:l,onCancelClick:c,canConfigureCollection:d,isOverlay:o,locked:p,onTemplateClick:h,menuListStore:C,templateInputStore:g,filteredTemplatePageStores:b,draggable:!0});const k=(0,Z.jsx)($,{templateInputStore:g});if(o){let e;return e=S.isMobile?{menuType:_.og.Modal,title:(0,Z.jsx)(u.FormattedMessage,{defaultMessage:"Database templates",id:"database.mobileTemplatesMenu.title"}),left:(0,Z.jsx)(E.CancelMenuText,{}),onClickLeft:c}:{menuType:_.og.Popup,width:360},f.length>6&&v&&(w=(0,Z.jsx)(q,{collectionStore:t,onEmptyEnter:r,onEmptyPageClick:l,onCancelClick:c,canConfigureCollection:d,isOverlay:o,locked:p,onTemplateClick:h,menuListStore:C,templateInputStore:g,filteredTemplatePageStores:b,draggable:!1})),(0,Z.jsxs)(N.Z,{...e,header:(0,Z.jsx)(K,{collectionStore:t}),children:[0===f.length&&(0,Z.jsx)(A.Z,{children:(0,Z.jsx)("div",{style:{fontSize:14,padding:S.isMobile?"12px 16px":"0 14px 3px 14px",color:m.lightTextColor,wordBreak:"keep-all",...S.isMobile&&{background:m.contentBackground,boxShadow:`0 1px 0 ${m.regularDividerColor}`,marginBottom:1}},children:(0,Z.jsx)(u.FormattedMessage,{defaultMessage:"Replicate page formats inside this database with templates.",id:"database.emptyTemplatesList.info"})})}),f.length>6?k:void 0,w]})}return w};function K(e){let{collectionStore:t}=e;const o=(0,i.O7)(),r=(0,n.VK)((()=>t.getNameStore().getValue()),[t]);if(o.device.isMobile)return null;const s=r?(0,Z.jsx)(Z.Fragment,{children:(0,b.Xh)(r,t)}):(0,Z.jsx)(u.FormattedMessage,{defaultMessage:"Untitled",id:"database.templateList.UntitledDatabaseTitle"});return(0,Z.jsx)(D.Z,{style:{marginTop:6},title:(0,Z.jsx)(C.Q,{prefix:(0,Z.jsx)(u.FormattedMessage,{id:"database.templatesList.templatesFor",defaultMessage:"Templates for"}),viewName:s}),right:(0,Z.jsx)(j.Z,{helpButtonContext:"collection_templates_menu",href:(0,T.UY)("guides.databaseTemplates")})})}function U(e){let{props:t,isOverlay:o,locked:r}=e;const n=(0,s.Fg)(),l=(0,i.O7)(),a=(0,Z.jsx)(u.FormattedMessage,{defaultMessage:"New template",id:"database.templateView.newTemplateButton"});return o?(0,Z.jsx)(M.Z,{isBlue:l.device.isDesktop,title:a,...t}):(0,Z.jsx)(H.Z,{title:a,icon:(0,c.R)({width:18,fill:n.lightIconColor,marginLeft:1,marginRight:11}),type:"new_template",format:o?"collection-overlay":"page-menu-item",locked:r,...t})}function W(e,t,o){const{mainEditorCurrentBlockStore:r}=O.default.state;!function(e,t,o){o?o(e):S.c4({environment:t,url:e})}(r?(0,k.ZP)({store:r,peekViewBlockId:e.id,fullyQualified:!1,pageVisitSource:l.tY.Create}):(0,k.ZP)({store:e,fullyQualified:!1,pageVisitSource:l.tY.Create}),t,o)}function $(e){let{templateInputStore:t}=e;const o=(0,u.useIntl)(),s=(0,i.O7)(),l=(0,r.useCallback)((e=>function(e,t){t.setState({...t.state,inputValue:e.currentTarget.value})}(e,t)),[t]),a=(0,n.VK)((()=>t.state),[t]),{device:c}=s,p=!c.isMobile||void 0;return(0,Z.jsx)("div",{style:{margin:c.isMobile?0:"10px 0"},children:(0,Z.jsx)(B.ZP,{value:a.inputValue,focusInitial:p,placeholder:o.formatMessage(z.filterPlaceholder),showClearButton:!0,inputLeft:(0,Z.jsx)(B.f_,{icon:d.R}),onChange:l,style:{...c.isAndroid&&{borderBottom:"none"}}})})}function q(e){let{filteredTemplatePageStores:t,draggable:o,collectionStore:s,onEmptyEnter:l,onEmptyPageClick:a,onCancelClick:c,canConfigureCollection:d,isOverlay:u,locked:S,onTemplateClick:C,menuListStore:x,templateInputStore:b}=e;const k=(0,i.O7)(),_=(0,r.useContext)(f.cu),T=(0,r.useContext)(y.ZO),O=(0,r.useCallback)((e=>function(e,t,o,r){r.unsetFocus(),g.createAndCommit({userAction:"CollectionTemplatePicker.handleCollectionTemplatesReorder",environment:t,perform:t=>m.$p({collectionStore:o,newTemplateIds:e,transaction:t})})}(e,k,s,x)),[k,s,x]),V=(0,r.useCallback)((()=>function(e,t,o,r){var i;R.M_(e)&&(o(),h.rN(e,{template_name:"empty",is_keyboard:!0,collection_id:t.id,collection_view_id:null==r||null===(i=r.collectionViewStore())||void 0===i?void 0:i.id}))}(k,s,l,_)),[k,s,l,_]),M=(0,r.useCallback)((e=>function(e,t,o,r){R.M_(t)&&(o(e.event),h.rN(t,{template_name:"empty",is_keyboard:"keydown"===e.event.type,...r&&(0,w.Pn)(r)}))}(e,k,a,_)),[_,k,a]),j=(0,r.useCallback)((e=>function(e,t,o,r,i,n,s){if(R.M_(t)){var l;const{performResult:i}=g.createAndCommit({userAction:"CollectionTemplatePicker.newPage",environment:t,perform:i=>m.nx({environment:t,collectionStore:o,transaction:i,title:r?r.state.inputValue:void 0,useCrdt:(0,v.SL)({event:e.event,source:"collection_instantiate_template"})})});i&&W(i,t,n),h.dZ(t,{collection_id:o.id,collection_view_id:null==s||null===(l=s.collectionViewStore())||void 0===l?void 0:l.id})}null==i||i()}(e,k,s,b,c,T,_)),[k,s,b,c,T,_]),{device:B}=k,N=(0,r.useMemo)((()=>({key:"create-template",render:(e,t)=>(0,Z.jsx)(U,{isOverlay:u,locked:S,props:e}),action:j})),[j,u,S]),D=(0,n.VK)((()=>null==_?void 0:_.defaultPageTemplateStore.state),[_]),E=(0,n.VK)((()=>({key:"empty",render:(e,o)=>{if(0!==t.length&&""===b.state.inputValue)return(0,Z.jsx)(I.Z,{collectionStore:s,canConfigureCollection:d,isOverlay:u,templateStore:void 0,isMobile:k.device.isMobile,locked:S||!d,draggable:!0,isDefault:void 0===(null==D?void 0:D.id),onCancelClick:c,...e})},action:M})),[d,s,null==D?void 0:D.id,k.device.isMobile,M,u,S,c,b,t.length]),H=(0,n.VK)((()=>{const e=t.map((e=>e.id));return p.oA([0!==t.length&&{key:"templates",render:t=>{const i=t.children.slice(0,t.children.length-1),n=t.children[t.children.length-1];return(0,Z.jsx)(A.Z,{...t,disableDesktopPadding:!u,disableMobileBorders:!0,children:(0,Z.jsxs)(r.Fragment,{children:[B.isMobile||S||!d?i.map(((e,t)=>i[t])):(0,Z.jsx)(F.ZP,{direction:"vertical",keys:e,disabled:!o,renderKey:(t,o)=>i[e.indexOf(t)],onDrop:O}),n]})})},items:[...t.map((e=>function(e,t,o,i,n,s,l,a,c,d){const{device:u}=e,p=null==d?void 0:d.defaultPageTemplateStore.state,h=P.Mz.fromBlockStore(t),m=null!=h&&h.isActive()?h.getRecurrence():void 0,S="disabled"===(null==h?void 0:h.getStatus());return{key:t.id,render:e=>(0,r.createElement)(I.Z,{...e,key:t.id,isOverlay:l,collectionStore:i,canConfigureCollection:n,templateStore:t,isMobile:u.isMobile,locked:s,onCancelClick:a,draggable:o,isDefault:(null==p?void 0:p.id)===t.id,recurrence:m,recurrenceDisabled:S}),action:o=>{R.M_(e)&&c({templateStore:t,isKeyboard:"keydown"===o.event.type,useCrdt:(0,v.SL)({event:o.event,source:"collection_instantiate_template",contextualDefault:t.useCrdt()})})}}}(k,e,o,s,d,S,u,c,C,_))),E]},d?{key:"create-template",render:e=>(0,Z.jsx)(A.Z,{topBorder:u,disableDesktopPadding:!u,disableMobileBorders:!0,...e}),items:[N]}:void 0])}),[d,_,s,N,B.isMobile,o,E,k,O,u,S,c,C,t]);return(0,Z.jsx)(L.Z,{type:L.i.Vertical,store:x,initialFocus:void 0,disableInitialScroll:!0,disableCommandEnter:!0,onEmptyEnter:V,sections:H})}},99630:(e,t,o)=>{o.r(t),o.d(t,{CollectionViewBLockErrorBoundaryWithRef:()=>WC,FULL_SCREEN_PADDING_BOTTOM:()=>ZC,MaybeDeletedCollectionBanner:()=>YC,default:()=>$C});o(21703);var r=o(30120),i=o(67294),n=o(73935),s=o(83355),l=o(1302),a=o(480),c=o(6740),d=o(86628),u=o(24405),p=o(49085),h=o(15145),m=o(92996),S=o(3865),g=o(42509),C=o(32566),f=o(65422),y=o(49019),v=o(21197),x=o(45238),b=o(85893);const w=(0,x.IU)("folderUnknownLarge",{viewBox:"0 0 48 48",svg:(0,b.jsx)("path",{d:"M39.1702 25.1855C43.1252 25.1855 46.4504 21.8896 46.4504 17.9053C46.4504 13.9062 43.1692 10.625 39.1702 10.625C35.1858 10.625 31.8899 13.9209 31.8899 17.9053C31.8899 21.9189 35.1858 25.1855 39.1702 25.1855ZM11.6604 37.5195H36.1379C38.7014 37.5195 40.1663 36.0547 40.1663 33.2422V26.8408C39.6829 26.9141 38.9504 26.9141 38.3498 26.8408V33.1543C38.3498 34.8389 37.427 35.7178 35.801 35.7178H11.6897C10.0491 35.7178 9.15551 34.8389 9.15551 33.1543V21.1133H30.7327C30.5276 20.5713 30.3811 20 30.3079 19.3994H9.15551V15.3125C9.15551 13.7598 9.94652 12.9834 11.4553 12.9834H14.8391C15.9084 12.9834 16.4797 13.2031 17.2707 13.9062L18.1057 14.6387C19.0286 15.4443 19.761 15.708 21.2405 15.708H30.4543C30.6008 15.0635 30.7766 14.5215 31.0842 13.8916H21.6799C20.5666 13.8916 19.9807 13.6865 19.219 13.0127L18.3694 12.2803C17.4172 11.4307 16.7434 11.1963 15.2786 11.1963H11.1038C8.67211 11.1963 7.3391 12.5293 7.3391 15.21V33.2422C7.3391 36.084 8.80395 37.5195 11.6604 37.5195ZM39.053 19.6924C38.5989 19.6924 38.3352 19.4287 38.3352 18.9746V18.916C38.3352 18.0811 38.76 17.6416 39.4485 17.1582C40.2248 16.6162 40.7375 16.2793 40.7375 15.5615C40.7375 14.9023 40.1955 14.4775 39.3606 14.4775C38.6575 14.4775 38.1741 14.8145 37.8664 15.166C37.6174 15.4297 37.4416 15.6934 37.0608 15.6934C36.6653 15.6934 36.4016 15.4297 36.4016 15.0195C36.4016 14.0088 37.8079 13.1299 39.3606 13.1299C41.133 13.1299 42.2463 14.1699 42.2463 15.4883C42.2463 16.5869 41.6164 17.0557 40.7815 17.6709C40.1077 18.1689 39.844 18.4473 39.7854 19.0479C39.7414 19.4434 39.5071 19.6924 39.053 19.6924ZM39.053 22.5195C38.4817 22.5195 38.0129 22.0508 38.0129 21.4795C38.0129 20.9229 38.4817 20.4541 39.053 20.4541C39.6243 20.4541 40.093 20.9229 40.093 21.4795C40.0784 22.0508 39.6243 22.5195 39.053 22.5195Z"})});var k=o(58810),_=o(75071),T=o(94110),O=o(37612),V=o(82138),P=o(15157),R=o(44615),M=o(21202),j=o(13493),I=o(12139),F=o(51454),B=o(9291),N=o(53965),D=o(37810),L=o(36610),E=o(8406),A=o(54642),H=o(26797),Z=o(54569),z=o(5149),G=o(98834),K=o(32603),U=o(87420),W=o(52989),$=o(21862),q=o(61045),Q=o(87531),Y=o(24677),X=o(36821),J=o(98104),ee=o(13447),te=o(91851),oe=o(40663),re=o(14714),ie=o(47453),ne=o(952),se=o(75754),le=o(26999),ae=o(8055),ce=o(10906),de=o(37989),ue=o(56666),pe=o(75330),he=o(75079),me=o(12534),Se=o(77546),ge=o(6258),Ce=o(81023),fe=(o(57658),o(99036)),ye=o(45453),ve=o(9056),xe=o(31701),be=o(47307),we=o(92918),ke=o(60709),_e=o(93405),Te=o(78140),Oe=o(32163),Ve=o(40721),Pe=o(72495),Re=o(9050);const Me="color";const je=function(e){let{parent:t,groupFormat:o,collectionContextStore:r,groupsFormatKey:n,currentGroups:s,groupsLimitStore:l,schema:c}=e;const u=(0,a.O7)(),p=(0,B.useIntl)(),{device:h}=u,m=(0,d.VK)((()=>N.oA([Ne(u,o,r,n,s,l,p),Fe(u,c,o,r)])),[u,o,r,n,s,l,p,c]),S=(0,i.useCallback)((e=>{"string"==typeof e.key&&e.key.includes(Me)||t.close()}),[t]);let g;return g=h.isMobile?{menuType:ke.og.Modal,title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Action",id:"database.collectionGroupActionMenu.title"}),right:(0,b.jsx)(Ve.DoneMenuText,{}),onClickRight:t.close}:{menuType:ke.og.Popup},(0,b.jsx)(Te.Z,{...g,children:(0,b.jsx)(Oe.Z,{type:Oe.i.Vertical,initialFocus:0,sections:m,onAccept:S})})};function Ie(e){const t=e.getViewType();if(!t)throw new Error("View type was not defined.");return t}function Fe(e,t,o,r){const i=o.value;if(void 0===i.value)return;const n=t[o.property];if(!n)return;if("select"!==n.type&&"multi_select"!==n.type)return;if(i.type!==n.type)return;const s=(n.options||[]).find((e=>e.value===i.value));if(!s)return;const l=xe.AP.map((i=>{const n={key:`${Me}_${i}`,render:e=>(0,b.jsx)(Re.Z,{...e,color:i,checkState:s.color===i}),action:()=>{!function(e,t,o,r,i){const n=r[o.property];if(!n)return;if(!fe.cu(n))return;const s=i.collectionStore();if(!s)return;const l=o.value;if(l.type!==n.type)return;const a=(n.options||[]).map((t=>t.value===l.value?{...t,color:e}:t)),c={...n,options:a},d={...r,[o.property]:c};ee.createAndCommit({userAction:"CollectionGroupActionMenu.handleSelectPropertyColorPickerChange",environment:t,perform:e=>{pe.Rm({environment:t,collectionStore:s,update:{schema:d},transaction:e})}}),L.wd(t,{view_type:Ie(i),action:"group_change_color"})}(i,e,o,t,r)}};return n}));return{key:"collection color section",render:e=>(0,b.jsx)(Pe.Z,{...e,title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Colors",id:"database.collectionGroupActionMenu.colorSectionTitle"}),topBorder:!0}),items:l}}function Be(e,t,o,r,i,n){be.showDialog({message:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Are you sure? All pages inside this group will be deleted.",id:"database.collectionGroupActionMenu.deleteDialogMessage"}),showCancel:!0,keepFocus:!1,items:[{label:"Delete",color:"red",onAccept:()=>async function(e,t,o,r,i,n){const s=t.collectionStore();if(!s)return;const l=r.value;if("relation"===l.type&&(0,re.RA)(l.value)){const e=ge.G.createChildStore(s,{id:l.value.id,table:M.iU});await e.load();const t=e.getAssociatedCollectionStore();await(null==t?void 0:t.load())}ee.createAndCommit({userAction:"CollectionGroupActionMenu.handleDelete",environment:e,perform:l=>{Z.iE({environment:e,collectionStore:s,property:r.property,groupFormat:r,currentGroups:o,groupsFormatKey:i,collectionContextStore:t,transaction:l,intl:n})}}),L.wd(e,{view_type:Ie(t),action:"delete_group"})}(e,t,o,r,i,n)}]})}function Ne(e,t,o,r,i,n,s){const l=[],a=t.value,c=o.permissionScopes.state;(0,re.eF)(t)?l.push({key:"show",render:e=>(0,b.jsx)(_e.Z,{...e,title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Show",id:"database.collectionGroupActionMenu.showButtonTitle"}),svg:ve.g}),action:()=>function(e,t,o,r,i,n){const s={...t,hidden:!1},l=(0,we.nr)(i,s,n.state);ee.createAndCommit({userAction:"CollectionGroupActionMenu.handleShow",environment:e,perform:e=>{Z.A6({collectionContextStore:o,newGroups:l,groupsFormatKey:r,transaction:e})}}),L.wd(e,{view_type:Ie(o),action:"show_group"})}(e,t,o,r,i,n)}):l.push({key:"hide",render:e=>(0,b.jsx)(_e.Z,{...e,title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Hide",id:"database.collectionGroupActionMenu.hideButtonTitle"}),svg:ye.p}),action:()=>function(e,t,o,r,i){const n={...t,hidden:!0},s=(0,we.ar)(i,n);ee.createAndCommit({userAction:"CollectionGroupActionMenu.handleHide",environment:e,perform:e=>{Z.A6({collectionContextStore:o,newGroups:s,groupsFormatKey:r,transaction:e})}}),L.wd(e,{view_type:Ie(o),action:"hide_group"})}(e,t,o,r,i)}),void 0!==a.value&&c.canEditContent&&!c.isSyncedCollection&&"collectionTypedView"!==o.contextType&&l.push({key:"delete",render:e=>(0,b.jsx)(_e.Z,{...e,title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Delete pages",id:"database.collectionGroupActionMenu.deleteButtonTitle"}),svg:O.y}),action:()=>Be(e,o,i,t,r,s)});return{key:"collection group",render:e=>(0,b.jsx)(Pe.Z,{...e}),items:l}}var De=o(2032),Le=o(14248),Ee=o(42875),Ae=o(47853),He=o(16187),Ze=o(98742),ze=o(75498),Ge=o(68785);function Ke(e,t){const{calculating:o,aggregation:r}=e.asyncAggregationStatus.state;return r?o&&(0,N.Xy)(t,r):o}function Ue(e){let{collectionContextStore:t,aggregation:o,children:r}=e;const{isCalculating:n,changingType:s}=(0,d.VK)((()=>({isCalculating:Ke(t,o),changingType:t.asyncAggregationStatus.state.changingType})),[t,o]),l=function(e,t){const o=(0,i.useRef)(e);return(0,i.useEffect)((()=>{t||void 0===e&&"-"===e||(o.current=e)}),[t,e]),o.current}(r,n);return n?s?(0,b.jsx)(Ge.Z,{}):(0,b.jsx)("span",{style:{opacity:.5},children:l??r}):(0,b.jsx)(b.Fragment,{children:r})}const We=(0,B.defineMessages)({propertyAggregation:{id:"collection.aggregation.propertyType",defaultMessage:"{aggregationType} in {propertyName}{calculating, select, true { (Calculating…)} other {}}"},aggregationType:{id:"collection.aggregation.aggregationType",defaultMessage:"{aggregationType}{calculating, select, true { (Calculating…)} other {}}"},aggregationCalculating:{id:"collection.aggregation.calculating",defaultMessage:"Calculating…"}});var $e=o(52275),qe=o(31945),Qe=o(89728),Ye=o(53437),Xe=o(26388),Je=o(42782);function et(e){let{schema:t,groupFormat:o,format:r,groupAggregationKey:i,collectionContextStore:n,disabled:s}=e;const l=(0,u.Fg)(),c=(0,a.Fy)(),p=(0,d.VK)((()=>r[i]||{aggregator:"count"}),[r,i]),h=(0,d.VK)((()=>({type:"aggregation",filter:(0,Le.zk)({schema:t,group:o,propertyMapping:void 0,timeZone:(0,Ee.r)()}),aggregation:p})),[t,o,p]);return(0,b.jsx)(Xe.ZP,{renderTooltip:()=>(0,b.jsx)(ct,{schema:t,collectionContextStore:n,aggregation:p}),render:e=>(0,b.jsx)(qe.ZP,{popupType:c.isMobile?qe.Z4.SlideUp:qe.Z4.Popup,renderOrigin:r=>(0,b.jsx)(Qe.Z,{disabled:s,style:{fontWeight:D.Z.fontWeight.medium,color:l.lightTextColor,height:24},...(0,Ze.Z)((0,Ze.Z)(e,r),{onClick:me.Wi}),children:(0,b.jsx)(at,{schema:t,collectionContextStore:n,groupFormat:o,aggregation:p,reducer:h})}),disabled:s,render:e=>(0,b.jsx)(lt,{parent:e,collectionContextStore:n,format:r,groupAggregationKey:i,schema:t})})})}function tt(e){const t=e.collectionViewStore(),o=null==t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}function ot(e){let{aggregationType:t,label:o,props:r}=e;const i=He.Sn[t];return(0,b.jsx)(Xe.ZP,{placement:Ye.GI.Placement.Right,delayThreshold:0,render:e=>(0,b.jsx)($e.Z,{title:o,...(0,Ze.Z)(e,r)}),renderTooltip:()=>(0,b.jsxs)("div",{style:{width:140,whiteSpace:"normal"},children:[i&&(0,b.jsx)("img",{src:(0,Ae.D)(i),style:{borderRadius:4,width:140,marginTop:4}}),He.BG[t]]})},r.key)}function rt(e,t,o,r,i){const n=o.collectionViewStore();n&&(o.isLoading.state||o.loadingDetails.setState({type:"load_aggregation"}),o.isClientModeEnabled.state||o.asyncAggregationStatus.setState({calculating:!0,aggregation:e,changingType:!0}),ee.createAndCommit({userAction:"CollectionGroupAggregation.handleChangeAggregation",environment:t,perform:t=>{pe.iG({collectionViewStore:n,update:{format:{...r,[i]:e}},transaction:t})}})),L.wd(t,{view_type:tt(o),action:"change_aggregation"})}function it(e,t,o,r,i){const n=He.VN[e];return{key:e,render:t=>(0,b.jsx)(ot,{aggregationType:e,label:n,props:t}),action:()=>{rt({aggregator:e},t,o,r,i)}}}function nt(e,t,o,r,i,n,s){const{device:l}=o,a=He.VN[e],c=N.oA(t.map((t=>function(e,t,o,r,i,n,s){const l=r[e];if(!l)return;const a=l.name;return{key:`${e} ${t}`,render:e=>(0,b.jsx)(ot,{aggregationType:t,label:a,props:e}),action:()=>{rt({aggregator:t,property:e},o,i,n,s)}}}(t,e,o,r,i,n,s))));return{key:e+a,render:(e,t)=>(0,b.jsx)(Je.Z,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,b.jsx)($e.Z,{...e,ref:t,title:a}),renderExtension:(e,o)=>{let r;return r=l.isMobile?{menuType:ke.og.Modal,title:a,right:l.isPhone?(0,b.jsx)(Ve.DoneMenuText,{}):void 0,onClickRight:o.close,...e}:{menuType:ke.og.Popup,width:200,...e},(0,b.jsx)(Te.Z,{...r,children:(0,b.jsx)(Oe.Z,{type:Oe.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,b.jsx)(Pe.Z,{...e}),items:c}],onAccept:t.onAccept})})}}),action:()=>null}}function st(e,t,o,r,i){const n=[];for(const d of De.o5)n.push(it(d,e,t,o,r));const s=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,De.iV)(o)&&!("rollup"===o.type&&"status"===o.target_property_type)}))}(i);if(s.length>0)for(const d of De.Sy)"show_unique"!==d&&n.push(nt(d,s,e,i,t,o,r));const l=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,De.O4)(o)}))}(i);if(l.length>0)for(const d of De.k$)n.push(nt(d,l,e,i,t,o,r));const a=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,De.dN)(o)}))}(i);if(a.length>0)for(const d of De.f8)n.push(nt(d,a,e,i,t,o,r));const c=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,De.Mv)(o)}))}(i);if(c.length>0)for(const d of De.gC)n.push(nt(d,c,e,i,t,o,r));return n}function lt(e){let{parent:t,collectionContextStore:o,format:r,groupAggregationKey:i,schema:n}=e;const s=(0,a.O7)(),{device:l}=s;let c;return c=l.isMobile?{menuType:ke.og.Modal,title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Aggregation",id:"database.collectionGroupAggregation.title"}),right:(0,b.jsx)(Ve.DoneMenuText,{}),onClickRight:t.close}:{menuType:ke.og.Popup,width:200},(0,b.jsx)(Te.Z,{...c,children:(0,b.jsx)(Oe.Z,{type:Oe.i.Vertical,initialFocus:0,sections:[{key:"aggregation section",render:e=>(0,b.jsx)(Pe.Z,{...e}),items:st(s,o,r,i,n)}],onAccept:t.close})})}function at(e){let{schema:t,collectionContextStore:o,groupFormat:r,aggregation:i,reducer:n}=e;return n?(0,b.jsx)(ze.Z,{id:`group_aggregation:${(0,re.mD)(r)}`,collectionContextStore:o,reducer:n,groupsPointer:[r],render:e=>{const r=e.state;let n;if((0,De.pK)(i)){const e=t[i.property];!e||"formula"!==e.type&&"number"!==e.type||(n=e.number_format)}return(0,b.jsx)(Ue,{aggregation:i,collectionContextStore:o,children:r?(0,He.Ol)({numberFormat:n,dateFormat:void 0,aggregationType:i.aggregator,userTimeZone:(0,Ee.r)(),value:r.aggregationResult,roundDecimal:5}):"-"})}}):null}function ct(e){let{schema:t,collectionContextStore:o,aggregation:r}=e;const i=(0,B.useIntl)(),n=He.VN[(0,De.OV)(r)],s=(0,d.VK)((()=>Ke(o,r)),[o,r]);if((0,De.pK)(r)){const e=t[r.property];if(e){const t=e.name;return(0,b.jsx)(b.Fragment,{children:i.formatMessage(We.propertyAggregation,{aggregationType:n,propertyName:t,calculating:s})})}}return(0,b.jsx)(b.Fragment,{children:i.formatMessage(We.aggregationType,{aggregationType:n,calculating:s})})}var dt=o(38769),ut=o(1898),pt=o(61931),ht=function(e){return e[e.Top=0]="Top",e[e.Bottom=1]="Bottom",e[e.IGNORE=2]="IGNORE",e}(ht||{});const mt=ht;var St=o(34859),gt=o(45589),Ct=o(53336);function ft(e){return e?mt.IGNORE:mt.Top}function yt(e){const{style:t,children:o}=e,r=(0,d.qz)(void 0,gt.Z),i=(0,d.VK)((()=>0===r.state.scrollTop),[r]),n=(0,u.yK)((()=>({scroller:{height:"100%",maxHeight:"inherit",...i?{}:{maskImage:pt.Wx,WebkitMaskImage:pt.Wx},...t}})),[i,t]);return(0,b.jsx)(Ct.Z,{store:r,type:St.Z.Y,style:n.scroller,children:o})}var vt=o(45697),xt=o.n(vt),bt=o(55010),wt=o(4926);function kt(e){const{element:t,container:o}=e,r=function(e){for(;;){const t=Vt(e);if(!t)return e;e=t}}(o),{store:i}=r.stores,{containerMap:n}=i.state,s=n.get(o);s?s.add(t):n.set(o,new Set([t])),i.emit()}function _t(e,t,o,r){return e<-r||e>t?0:e>=t-o-1?t-o+r-1:e+r}function Tt(e,t,o,r){return e-r<0||e>t?0:e<o?o-t:e-t}function Ot(e){const t=[];for(;;){const o=Vt(e);if(!o)break;e=o,t.push(e)}return t}function Vt(e){if(e.context.computedStickyContainer&&!e.props.ignoreAncestorContainer)return e.context.computedStickyContainer}function Pt(e,t){for(const o in t)e.style[o]=t[o]||""}o(95477);class Rt extends s.Z{constructor(){super(...arguments),this.element=void 0}didMount(){const{computedStickyContainer:e}=this.context;e&&kt({element:this,container:e});const t=n.findDOMNode(this);if(t){this.element=t;const e=this.props.getComputedStyle?this.props.getComputedStyle(!1):void 0;e&&Pt(t,e)}}willUnmount(){const{computedStickyContainer:e}=this.context;e&&function(e){const{element:t,container:o}=e,{store:r}=o.stores,{containerMap:i}=r.state,n=i.get(o);n&&n.delete(t),r.emit()}({element:this,container:e}),this.element=void 0}renderComponent(){if(this.props.children)return i.Children.only(this.props.children)}}Rt.displayName="ComputedStickyElement",Rt.contextTypes={computedStickyContainer:xt().any,...s.w};const Mt=Rt;var jt=o(73063),It=o(79954),Ft=o(5210);class Bt extends s.Z{constructor(){super(...arguments),this.handleToggleButtonClick=()=>{const{groupFormat:e,collectionContextStore:t}=this.props,o=t.groupsStore.getGroupState(e);if(!o)return;Y.ZH(this.environment);const r=!o.toggleStateStore.state;if(Z.uo({environment:this.environment,groupFormat:e,toggleStateStore:o.toggleStateStore,newValue:r,collectionContextStore:t}),!r){const e=n.findDOMNode(this),o=null==e?void 0:e.parentElement;o&&l.default.afterNextFlush((()=>{(0,Se.Oc)({el:o,windowHeight:this.environment.WindowSizeStore.state.height,minEdgeDist:50}),t.renderEmitter.emit()}))}},this.handleDrop=e=>{const{droppedStores:t,duplicate:o}=e,{collectionContextStore:r,groupFormat:i}=this.props,s=n.findDOMNode(this);s&&s instanceof Element&&ee.createAndCommit({userAction:"CollectionGroupHeader.handleDrop",environment:this.environment,perform:e=>Z.BO({environment:this.environment,collectionContextStore:r,groupsPointer:[i],droppedStores:t,duplicate:o,transaction:e})})}}UNSAFE_willMount(e){super.UNSAFE_willMount(e);const t=e.collectionContextStore.collectionViewBlockStore();t&&(this.selectableBlockStore=new ge.G(this.environment,{table:M.iU,id:t.id}))}didMount(){var e,t;null===(e=(t=this.props).onMount)||void 0===e||e.call(t)}renderComponent(){var e;const{disabled:t,getComputedStickyStyle:o,groupFormat:r,collectionContextStore:i}=this.props,n=i.groupsStore.getGroupState(r);if(!n)return;const s=n.toggleStateStore.state,l=i.permissionScopes.state,a=i.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}),c=i.isCompactView.state,d=c?"transparent":(null===(e=i.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||void 0;return(0,b.jsx)(Mt,{position:ft(c),getComputedStyle:o,children:(0,b.jsxs)("div",{style:Zt(this.props.isInPeekRenderer,this.theme,d,this.props.style),children:[(0,b.jsx)("div",{style:Et(s,this.props.isFullScreen,this.props.isRootChild,this.props.paddingLeft,this.props.paddingTop,this.props.toggleClosedMarginBottom,this.props.height,this.props.stickyLeft),children:(0,b.jsx)("div",{style:{display:"flex",alignItems:"center",position:this.props.stickyLeft?"sticky":void 0,left:this.props.paddingLeft,overflow:"hidden"},children:(0,b.jsxs)(It.Z,{store:this.selectableBlockStore,canDropOnto:!t&&!s,onSelectableDrop:this.handleDrop,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,groupsPointer:[r],style:{display:"flex",alignItems:"center",height:"100%",overflow:"hidden"},children:[this.renderToggleButton(n.toggleStateStore),(0,b.jsx)(zt,{collectionGroupHeaderProps:this.props}),(0,b.jsx)(At,{disabled:this.props.disabled,format:this.props.format,schema:this.props.schema,collectionContextStore:this.props.collectionContextStore,groupFormat:this.props.groupFormat,groupAggregationKey:this.props.groupAggregationKey}),!t&&l.canConfigureBlock&&(0,b.jsx)(Ht,{groupFormat:this.props.groupFormat,currentGroups:this.props.currentGroups,format:this.props.format,schema:this.props.schema,collectionContextStore:this.props.collectionContextStore,groupsFormatKey:this.props.groupsFormatKey,isGroupHoveredStore:this.props.isGroupHoveredStore}),a&&(0,b.jsx)(Gt,{collectionGroupHeaderProps:this.props,isGroupHoveredStore:this.props.isGroupHoveredStore})]})})}),this.props.children]})})}renderToggleButton(e){const t=e.state;return(0,b.jsx)(Ft.Z,{isSidebar:!1,open:t,fill:!0,onClick:this.handleToggleButtonClick,onMouseDown:me.$0,style:{flexShrink:0}})}}Bt.displayName="CollectionGroupHeader";const Nt=Bt;function Dt(e){const t=e.getViewType();if(!t)throw new Error("View type was not defined.");return t}function Lt(e){return e||33}function Et(e,t,o,r,i,n,s,l){return{display:"flex",alignItems:"center",height:Lt(s),paddingTop:i,...l&&{position:"sticky",left:t||o?r:0},...!e&&{marginBottom:n}}}function At(e){let{disabled:t,format:o,schema:r,collectionContextStore:i,groupFormat:n,groupAggregationKey:s}=e;const l=(0,d.VK)((()=>i.permissionScopes.state.canConfigureBlock),[i]);return(0,b.jsx)(et,{groupFormat:n,disabled:t||!l,groupAggregationKey:s,format:o,schema:r,collectionContextStore:i})}function Ht(e){let{groupFormat:t,currentGroups:o,format:r,schema:i,collectionContextStore:n,groupsFormatKey:s,isGroupHoveredStore:l}=e;const c=(0,a.Fy)(),p=(0,d.VK)((()=>n.groupsLimit),[n]),h=(0,d.VK)((()=>l.state),[l]),[m,S]=(0,de.Z)(),g=(0,u.yK)((()=>({button:{transition:c.isMobile?void 0:"opacity 100ms ease-in-out",opacity:c.isMobile?void 0:h||S?1:0}})),[c.isMobile,S,h]);return(0,b.jsx)(qe.ZP,{popupType:c.isMobile?qe.Z4.SlideUp:qe.Z4.Popup,renderOrigin:e=>(0,b.jsx)(jt.Z,{ref:m,icon:ue.o,style:g.button,...e}),onClick:me.Wi,render:e=>(0,b.jsx)(je,{parent:e,groupFormat:t,currentGroups:o,format:r,schema:i,collectionContextStore:n,groupsFormatKey:s,groupsLimitStore:p})})}function Zt(e,t,o,r){const i=e?t.cardContentBackground:t.contentBackground;return{position:"relative",zIndex:F.sL+2,width:"100%",background:void 0===o?i:o,fontSize:14,...r}}function zt(e){let{collectionGroupHeaderProps:t}=e;const o=(0,a.O7)(),{groupFormat:r,schema:i,disabled:n,currentGroups:s,groupBy:l,collectionContextStore:c}=t,u=(0,d.VK)((()=>c.permissionScopes.state),[c]);return(0,b.jsx)(dt.Z,{groupBy:l,groupFormat:r,currentGroups:s,schema:i,disabled:n||!u.canConfigureCollection||u.isSyncedCollection,isHiddenGroup:!1,onChange:e=>function(e,t,o){const{collectionContextStore:r}=o,i=r.collectionStore();i&&(Z.w$({...e,environment:t,collectionStore:i,...o}),L.wd(t,{view_type:Dt(r),action:"rename_group"}))}(e,o,t),style:{maxWidth:400,lineHeight:"24px"},uncategorizedIconStyle:{marginLeft:2},collectionContextStore:c})}function Gt(e){let{collectionGroupHeaderProps:t,isGroupHoveredStore:o}=e;const r=(0,a.Fy)(),i=(0,a.O7)(),n=(0,d.VK)((()=>o.state),[o]),[s,l]=(0,de.Z)(),c=(0,u.yK)((()=>({button:{transition:r.isMobile?void 0:"opacity 100ms ease-in-out",opacity:r.isMobile?void 0:n||l?1:0}})),[r.isMobile,l,n]);return(0,b.jsx)(Xe.ZP,{renderTooltip:()=>(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Create new",id:"database.collectionGroupHeader.actions.addNewPage.tooltip"}),render:e=>(0,b.jsx)(jt.Z,{ref:s,icon:ie.R,onClick:()=>function(e,t){const{groupFormat:o,collectionContextStore:r,isFullScreen:i,onGroupHeaderAddItem:n}=t;r.groupsStore.getGroupState(o)&&Ce.M_(e)&&(r.searchQuery.state&&pe.Ug({searchQuery:"",collectionContextStore:r,isFullScreen:i}),ee.createAndCommit({userAction:"CollectionGroupHeader.handleAddItemClick",environment:e,perform:i=>{const s=Z.IW({environment:e,collectionContextStore:r,groupsPointer:[o],insertAtIndex:0,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:i,from:"group_header"});s&&(n(s.newStore,s.coercionSucceeded,t),ne.W(e,{from:"group_add_item_top",type:"page",new_page_id:s.newStore.id,creating_block_id:s.newStore.id,...(0,he.Pn)(r)}))}}))}(i,t),style:c.button,...e})})}var Kt=o(40745),Ut=o(49902);function Wt(e){const{collectionContextStore:t,groupsPointer:o,hasPartialResults:r}=e,i=t.shouldShowSpinner.state,n="load_general"===t.loadingDetails.state.type&&!r||"load_more_blocks"===t.loadingDetails.state.type&&N.Xy(t.loadingDetails.state.group,o);return i&&n}function $t(e){const{collectionContextStore:t,displayState:o}=e;return t.shouldShowSpinner.state&&0===o.visibleGroups.length}function qt(e){const{collectionContextStore:t,isForColumnGroups:o}=e,r=o?"load_more_columns":"load_more_groups";return t.isLoading.state&&t.loadingDetails.state.type===r}function Qt(e){const{collectionContextStore:t,groupsPointer:o}=e;return t.shouldShowSpinner.state&&"load_more_blocks"===t.loadingDetails.state.type&&N.Xy(t.loadingDetails.state.group,o)}var Yt=o(64921),Xt=o(6695),Jt=o(96802);const eo=(0,B.injectIntl)((function(e){const{limit:t}=e;return(0,b.jsx)(B.FormattedMessage,{defaultMessage:"{limit} pages",values:{limit:t.limit},id:"database.FirstLoadLimitSelectOption.limitPagesTitle"})}));const to=(0,B.injectIntl)((function(e){const t=(0,a.O7)(),{device:o}=t,{currentLimit:r,onAccept:i,onClose:n,showTitle:s}=e,l=[{key:0,render:e=>(0,b.jsx)(Pe.Z,{enableActionSheetTitle:!0,title:s&&(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Show on first load",id:"database.firstLoadLimitSelectMenu.firstLoadLimitSetting"}),...e}),items:N.oA(Xt.jk.map(((e,t)=>{const o={key:t,render:t=>(0,b.jsx)($e.Z,{...t,disabled:!1,title:(0,b.jsx)(eo,{limit:e}),checkState:N.Xy(r,e)}),action:()=>i(e)};return o})))}];let c;return c=o.isMobile?{menuType:ke.og.ActionSheet}:{menuType:ke.og.Popup,width:200},(0,b.jsx)(Te.Z,{...c,children:(0,b.jsx)(Oe.Z,{type:Oe.i.Vertical,sections:l,onAccept:n,initialFocus:void 0})})}));const oo=function(e){let{format:t,collectionContextStore:o}=e;const r=(0,a.O7)(),{device:i}=r;return(0,b.jsx)(qe.ZP,{popupType:i.isMobile?Ye.kQ.SlideUp:Ye.kQ.Popup,renderOrigin:e=>(0,b.jsx)(jt.Z,{icon:ue.o,style:{marginLeft:4,marginRight:4},...e}),alignmentToOrigin:qe.vR.End,placementToOrigin:qe.pO.Bottom,originGap:8,render:e=>(0,b.jsx)(io,{parent:e,format:t,collectionContextStore:o})})};function ro(e){return(0,Xt.rx)(e.inline_collection_first_load_limit,Boolean(e.collection_group_by))}function io(e){let{parent:t,format:o,collectionContextStore:r}=e;const i=(0,a.O7)();return(0,b.jsx)(to,{currentLimit:ro(o),onAccept:e=>function(e,t,o){const r=t.collectionViewStore();if(!r)return;const i=r.getType();i&&(ee.createAndCommit({userAction:"FirstLoadLimitActionButton.handleFirstLoadLimitAccept",environment:o,perform:t=>{Jt.FH({stores:[r],update:{inline_collection_first_load_limit:e},transaction:t})}}),t.groupsStore.resetAllLimits(),L.wd(o,{view_type:i,action:"set_first_load_limit"}))}(e,r,i),onClose:t.close,showTitle:!0})}const no=function(e){let{style:t,store:o,format:r,collectionContextStore:i,groupsPointer:n,incrementLimitsInRelatedGroups:s,isFullScreen:l}=e;const c=(0,u.Fg)(),p=(0,a.O7)(),m=(0,d.VK)((()=>i.groupsStore.getGroupState(n)),[i,n]),S=(0,d.VK)((()=>Qt({collectionContextStore:i,groupsPointer:n})),[i,n]),g=(0,d.VK)((()=>i.isCompactView.state),[i]),C=(0,d.VK)((()=>o.canEdit()),[o]);return m?g?(0,b.jsx)(Yt.Z,{onClick:e=>function(e,t,o){const r=e.metaKey||e.ctrlKey;r?se._c({environment:t,store:o,pageVisitSource:h.tY.PersonalHomeTileTasks,openInNew:"tab"}):se._c({environment:t,store:o,pageVisitSource:h.tY.PersonalHomeTileTasks})}(e,p,o),onMouseDown:me.$0,style:{display:"flex",alignItems:"center",height:30,borderRadius:4,whiteSpace:"break-spaces",fontSize:14,paddingLeft:8,marginBottom:8,...t},children:(0,b.jsx)("div",{style:{color:c.lightTextColor},children:(0,b.jsx)(B.FormattedMessage,{id:"database.viewAllButtonTitle",defaultMessage:"View all"})})}):(0,b.jsxs)(Yt.Z,{onClick:e=>function(e,t,o,r,i,n){const s=o.groupsStore.getGroupState(r);if(!s)return;const l=s.reducerResultStore.state;(0,me.Wi)(e),Y.ZH(t),l&&Z.ID({collectionContextStore:o,environment:t,incrementLimitArgs:{isFullScreen:n,currentResultCount:l.blockIds.length,groupsPointer:s.groupsPointer,incrementLimitsInRelatedGroups:i}});Ut.j({name:"collection_load_more"}),L.uD(t)}(e,p,i,n,s,l),onMouseDown:me.$0,disabled:S,hoveredStyle:S?{background:c.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",height:30,borderRadius:4,whiteSpace:"break-spaces",fontSize:14,...t},children:[(0,Kt.M)(so(c)),(0,b.jsx)("div",{style:{color:c.lightTextColor},children:(0,b.jsx)(B.FormattedMessage,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),S?(0,b.jsx)("div",{style:{marginTop:1,marginLeft:8,marginRight:8},children:(0,b.jsx)(Ge.Z,{style:{width:12,height:12}})}):C&&(0,b.jsx)(oo,{collectionContextStore:i,format:r})]}):null};function so(e){return{width:14,height:14,marginLeft:4,marginRight:6,fill:e.lightIconColor}}var lo=o(98953),ao=o(97004),co=o(77080),uo=o(7032),po=o(26249),ho=o(33929),mo=o(61766),So=o(70203);function go(e){var t;const{transaction:o,environment:r,collectionContextStore:i,isFullScreen:n,groupsPointer:s,insertAtIndex:l,from:a,transient:c,useCrdt:d}=e,u=null===(t=i.groupsStore.getGroupState(s))||void 0===t?void 0:t.resultsStore;if(!u)return;i.searchQuery.state&&pe.Ug({searchQuery:"",collectionContextStore:i,isFullScreen:n});const p=Z.IW({environment:r,collectionContextStore:i,groupsPointer:s,insertAtIndex:l,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:o,from:a,useCrdt:d});if(!p)return;const m=p.coercionSucceeded,S=p.newStore;if(r.device.isMobile)se._c({environment:r,store:S,pageVisitSource:h.tY.Create});else if(m){const e=S.getBlockTitleStore();Y.eP({environment:r,store:S}),J.NX({store:e}),pe.Z5({store:S,transient:c})}else{const e="collectionTypedView"===i.contextType;le.CH({environment:r,store:S,peekMode:(0,ce.kr)(i),showMoveTo:e,resultsStore:u,collectionContextStore:i,pageVisitSource:h.tY.Create})}ne.W(r,{from:a,type:"page",new_page_id:S.id,creating_block_id:S.id,...(0,he.Pn)(i)})}var Co=o(27105),fo=o(43250),yo=o(65183),vo=o(77556);const xo=function(e){let{shouldShowSpinner:t,color:o,collectionContextStore:r,isFullScreen:i,groupsPointer:n}=e;const s=(0,u.Fg)(),l=(0,a.O7)(),c=s.lightTextColor;return(0,b.jsxs)(Qe.Z,{icon:e=>(0,ie.R)({...e,fill:o||c}),isLightGray:!0,isLarge:!0,style:{width:"100%",color:o||c},onClick:e=>function(e,t,o,r,i){if(!Ce.M_(r))return;ee.createAndCommit({userAction:"BoardGroupAddItemButton.handleClick",environment:r,perform:n=>{go({transaction:n,environment:r,collectionContextStore:e,isFullScreen:t,groupsPointer:o,from:"board_group_add_item_bottom",transient:!1,useCrdt:i})}})}(r,i,n,l,(0,Co.SL)({event:e,source:"collection_non_table_view"})),onMouseDown:me.$0,children:[(0,b.jsx)(B.FormattedMessage,{defaultMessage:"New",id:"database.boardView.addItemButtonTitle"}),t&&(0,b.jsx)("div",{style:{margin:"0 0 0 auto"},children:(0,b.jsx)(Ge.Z,{style:{width:12,height:12}})})]})};var bo=o(25651),wo=o(95855),ko=o(54497),_o=o(6404),To=o(51365),Oo=o(9953),Vo=o(87636),Po=o(10912),Ro=o(97039),Mo=o(78030),jo=o(65089),Io=o(44831),Fo=o(41137),Bo=o(3386),No=o(84076),Do=o(31278),Lo=o(27016),Eo=o(65187),Ao=o(88940),Ho=o(95645),Zo=o(28651),zo=o(49616),Go=o(77181),Ko=o(84210),Uo=o(68056),Wo=o(65598),$o=o(80444),qo=o(19511),Qo=o(96049),Yo=o(22294),Xo=o(88923),Jo=o(27724),er=o(24666);const tr=(0,B.defineMessages)({untitledBlock:{defaultMessage:"Untitled",id:"collectionViewCardItem.untitledBlock"},typeAName:{defaultMessage:"Type a name…",id:"collectionViewCardItem.itemName.placeholder"}});class or extends Ho.Z{constructor(){super(...arguments),this.lastProxiedUrl=void 0,this.storeTypes={mouseStore:Zo.Z,editModeStore:p.default},this.subitemCountIndicatorWrapStyle={display:"flex",alignItems:"center"},this.parentItemIndicatorWrapStyle={paddingRight:4,paddingTop:8,paddingBottom:0,paddingLeft:6,maxWidth:"100%"},this.renderControl=e=>{let{isVisible:t,isRepositioning:o,handleCancelClick:r,handleRepositionClick:i,handleSavePositionClick:n}=e;const{store:s,coverFormat:l,coverAspectFormat:a,collectionContextStore:c}=this.props,{device:d}=this.environment,{isMobile:u}=d,p=this.lastProxiedUrl&&l&&"contain"!==a,h=c.permissionScopes.state,m=s.canEdit()&&("collectionTypedView"===c.contextType||s.canEdit());if(t&&!this.shouldShowActionButton.state)return;const S=Xo.default.state.open&&Xo.default.state.target.id===s.id,g=ce.kr(c),C=(0,zo.X9)(g,!1);return(0,b.jsxs)(Vo.Z,{isVisible:t,position:"top",children:[p&&!o&&!u&&(0,b.jsx)(Yt.Z,{style:Lo.ar,onClick:e=>i(e,this.lastProxiedUrl),children:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Reposition",id:"collectionViewCardItem.action.reposition"})}),p&&o&&!u&&(0,b.jsx)(Yt.Z,{style:Lo.ar,onClick:n,children:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Save position",id:"collectionViewCardItem.action.savePosition"})}),p&&o&&!u&&(0,b.jsx)(Yt.Z,{style:Lo.ar,onClick:r,children:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Cancel",id:"collectionViewCardItem.action.cancel"})}),this.shouldShowEditButton.state&&m&&!this.normalizedCardSelectionStore.state&&!h.isSyncedCollection&&(0,b.jsx)(Xe.ZP,{renderTooltip:()=>(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Edit",id:"collectionCardItem.edit.tooltip"}),render:e=>(0,b.jsx)(Yt.Z,{style:Lo.ar,onClick:()=>{Cr(this.environment,this.props.store,this.props.collectionContextStore,this.stores.editModeStore,"click")},...e,children:(0,bo.R)({width:16,height:16})})}),this.normalizedCardSelectionStore.state&&!S&&(0,b.jsx)(Xe.ZP,{renderTooltip:()=>C.tooltip,render:e=>(0,b.jsx)(Yt.Z,{style:Lo.ar,onClick:()=>{this.peekUrl.state&&(ae.c4({environment:this.environment,url:this.peekUrl.state}),yr(this.stores.editModeStore))},...e,children:C.icon({width:14,height:14})})}),!o&&(0,b.jsx)(Xe.ZP,{renderTooltip:()=>(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Rename, delete, move to and more…",id:"collectionViewCardItem.repositionAction.tooltip"}),render:e=>(0,b.jsx)(Yt.Z,{style:Lo.ar,onClick:e=>function(e,t,o,r){Y.Ys({environment:t,store:r}),_o.Qn({environment:t,stores:Jo.default.state.stores,left:e.clientX,top:e.clientY,showInput:!0,actionSectionGroupKey:"default",analyticsFrom:"block_more_menu",optionalAnalyticsProperties:{collectionContextStore:o}})}(e,this.environment,this.props.collectionContextStore,this.props.store),...e,children:(0,ue.o)({width:14,height:14})})})]})},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderProperty=e=>(0,b.jsx)(Ir,{store:this.props.store,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,schema:this.props.schema,format:this.props.format,collectionContextStore:this.props.collectionContextStore,disabled:this.props.disabled,editModeStore:this.stores.editModeStore,normalizedCardSelectionStore:this.normalizedCardSelectionStore,propertyFormat:e}),this.renderFooterIcons=()=>{const{store:e}=this.props,t=Wo.Xp(e,{recursivelyLoadAllDiscussions:!1}),o=function(e,t){return(0,Go.wI)({collectionContextStore:e,blockStore:t})}(this.props.collectionContextStore,this.props.store),r=t>0;var i;if(r||o)return(0,b.jsxs)("div",{style:Mr(this.environment,this.props.collectionContextStore,this.props.store,this.props.schema,this.props.format,this.props.shouldShowTitle,this.normalizedCardSelectionStore),children:[o&&(0,b.jsx)("div",{style:this.subitemCountIndicatorWrapStyle,children:(0,b.jsx)(Fo.B,{blockStore:e,collectionContextStore:this.props.collectionContextStore})}),r&&(0,b.jsxs)("div",{style:(i=this.theme,{display:"flex",alignItems:"center",color:i.lightTextColor,fill:i.lightTextColor,fontWeight:D.Z.fontWeight.medium,fontSize:12,paddingRight:10}),children:[(0,wo.z)({width:14,height:14,marginRight:4,fill:this.theme.mediumIconColor}),t]})]})},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleBlockSpace=()=>{return e=this.environment,t=this.props.store,o=this.props.collectionContextStore,r=this.stores.editModeStore,void Cr(e,t,o,r,"space");var e,t,o,r},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleEditButtonClick=e=>Cr(this.environment,this.props.store,this.props.collectionContextStore,this.stores.editModeStore,e),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleClick=e=>function(e,t,o,r){if(r.state)return void e.preventDefault();t(),yr(o)}(e,this.props.handleOpenPeekPage,this.stores.editModeStore,this.normalizedCardSelectionStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTextEnter=()=>vr(this.environment,this.props.store,this.props.onTextEnter,this.props.onTextEsc,this.props.collectionContextStore,this.stores.editModeStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTextEsc=()=>xr(this.environment,this.props.store,this.props.onTextEsc,this.props.collectionContextStore,this.stores.editModeStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTextTab=()=>Or(this.environment,this.props.store,this.props.blockPropertyValueOverlayStore,this.props.schema,this.props.format,this.props.collectionContextStore,this.stores.editModeStore,this.normalizedCardSelectionStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTrackTitlePropertyEdit=()=>br(this.environment,this.props.collectionContextStore,this.props.store,this.stores.editModeStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTextUntab=()=>Vr(this.environment,this.props.store,this.props.schema,this.props.format,this.props.collectionContextStore,this.props.blockPropertyValueOverlayStore,this.stores.editModeStore,this.normalizedCardSelectionStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleBlockPropertyEsc=()=>wr(this.environment,this.props.blockPropertyValueOverlayStore,this.props.store,this.stores.editModeStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleBlockPropertyTab=()=>Pr(this.environment,this.props.store,this.props.blockPropertyValueOverlayStore,this.props.schema,this.props.format,this.props.collectionContextStore,this.stores.editModeStore,this.normalizedCardSelectionStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleBlockPropertyUntab=()=>Rr(this.environment,this.props.store,this.props.blockPropertyValueOverlayStore,this.props.schema,this.props.format,this.props.collectionContextStore,this.stores.editModeStore,this.normalizedCardSelectionStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseMove=()=>{return e=this.stores.mouseStore,void(Qo.Z.state||e.setState({...e.state,mouseEntered:!0}));var e},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseLeave=()=>{var e;(e=this.stores.mouseStore).setState({...e.state,mouseEntered:!1})},this.handleMouseMoveThrottled=N.P2(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseMove,100),this.handleMouseLeaveDebounced=N.Ds(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseLeave,100),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRecordIconChange=e=>kr(e,this.environment,this.props.store,this.stores.editModeStore),this.tryDeleteEmptyOnBlur=()=>{const{store:e,onTextEsc:t,collectionContextStore:o}=this.props,{editModeStore:r}=this.stores;"new_empty"!==r.state||this.normalizedCardSelectionStore.state||o.defaultPageTemplateStore.state||(t(e),this.normalizedCardSelectionStore.removeListener(this.tryDeleteEmptyOnBlur))},this.normalizedCardSelectionStore=this.createComputedStore((()=>{const e=qo.Z.state;return e.isActive&&e.store===this.props.store})),this.isItemSelectedStore=this.createComputedStore((()=>Jo.default.state.stores.includes(this.props.store))),this.shouldShowEditButton=this.createComputedStore((()=>{const e=this.isEditingTitle.state,t=ur(this.props.format,this.props.collectionContextStore),o=_r(this.environment,this.props.store,this.props.schema,this.props.format,this.props.collectionContextStore,this.normalizedCardSelectionStore);return!e&&(this.props.shouldShowTitle||t.length>0&&t.length!==o.length)})),this.isEditingTitle=this.createComputedStore((()=>{var e;const{blockPropertyValueOverlayStore:t}=this.props,o=er.default.state;return"editing"===o.mode&&(null===(e=(0,Uo.QY)(o.multiSelection))||void 0===e?void 0:e.store)===(0,yo.JI)(this.props.store)&&!t.state.isOpen})),this.peekUrl=this.createComputedStore((()=>{const{store:e,collectionContextStore:t}=this.props,{mainEditorCurrentBlockStore:o}=$o.default.state;return ce.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})})),this.pageUrl=this.createComputedStore((()=>{const{store:e}=this.props;return(0,Ko.ZP)({store:e,fullyQualified:!1,pageVisitSource:h.tY.LinkInPage})})),this.shouldShowActionButton=this.createComputedStore((()=>{const{device:e}=this.environment,{isKeyboardMode:t}=Yo.Z.state;return!e.isMobile&&this.canEdit()&&!t})),this.mouseIsEntered=this.createComputedStore((()=>this.stores.mouseStore.state.mouseEntered&&!Qo.Z.state))}activate(){const e=this.peekUrl.state;e&&(this.props.handleOpenPeekPage(),ae.c4({environment:this.environment,url:e}))}UNSAFE_willMount(){var e;const{editModeStore:t}=this.stores,o=er.default.state,r="editing"===o.mode&&(null===(e=(0,Uo.QY)(o.multiSelection))||void 0===e?void 0:e.store)===(0,yo.JI)(this.props.store),i=qo.Z.state,n=i.isActive&&i.transient;r&&n?t.setState("new_empty"):r?t.setState("new"):t.setState("existing")}didMount(){const{editModeStore:e}=this.stores;super.didMount(),this.normalizedCardSelectionStore.state&&"new_empty"===e.state&&this.normalizedCardSelectionStore.addListener(this.tryDeleteEmptyOnBlur)}willUnmount(){super.willUnmount(),this.normalizedCardSelectionStore.removeListener(this.tryDeleteEmptyOnBlur)}renderComponent(){const{device:e}=this.environment,{collectionContextStore:t,store:o,coverFormat:r,coverAspectFormat:n,coverWidth:s,coverHeight:l,coverSizeFormat:a,shouldShowTitle:c,colorStyle:d,onShiftEnter:u}=this.props,p=this.pageUrl.state,h=this.peekUrl.state,m=this.mouseIsEntered.state,S=this.normalizedCardSelectionStore.state,g=dr(this.props.collectionContextStore),C=(0,i.createRef)(),f=(0,b.jsxs)(No.Z,{ref:C,style:{...hr(d,t,this.theme),position:m?"relative":"static",..."gallery"===g&&{height:"100%"}},innerStyle:{userSelect:S?void 0:"none",WebkitUserSelect:S?void 0:"none",height:"100%",..."board"===g&&{minHeight:40},..."gallery"===g&&{display:"flex",flexDirection:"column"}},hoveredStyle:S?{background:pr(d,t,this.theme)}:mr(d,t,this.theme),pressedStyle:S?{background:pr(d,t,this.theme)}:Sr(d,t,this.theme),href:p,metaHref:e.isMobile?p:h,onMouseEnter:this.handleMouseMoveThrottled,onMouseMove:this.handleMouseMoveThrottled,onMouseLeave:this.handleMouseLeaveDebounced,onClick:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleClick,children:[(0,b.jsx)(Ao.Z,{mouseStore:this.stores.mouseStore,onFlushTemporaryPosition:e=>function(e,t,o){const{imagePosition:r,reset:i}=e;ee.createAndCommit({userAction:"CollectionViewCardItem.handleFlushTemporaryPosition",environment:t,perform:e=>{Jt.bf({store:o,coverPosition:r,transaction:e}),i()}})}(e,this.environment,this.props.store),source:g,small:"small"===a,store:this.props.store,renderControl:this.renderControl,render:e=>{let{imagePosition:i}=e;return r&&(0,b.jsx)(Po.Z,{variant:"gallery",store:o,coverWidth:s,coverHeight:l,coverFormat:r,coverAspectFormat:n,coverSizeFormat:a,coverPosition:i,showEmptyGalleryCover:"gallery"===g,onLoadProxiedImage:e=>{this.lastProxiedUrl=e},isCompactView:t.isCompactView.state})}}),fr(this.props.collectionContextStore,this.props.store)&&(0,b.jsx)("div",{style:this.parentItemIndicatorWrapStyle,children:(0,b.jsx)(Io.O,{blockStore:o,collectionContextStore:this.props.collectionContextStore})}),c&&(0,b.jsx)(jr,{collectionContextStore:this.props.collectionContextStore,store:this.props.store,schema:this.props.schema,format:this.props.format,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,onTextEsc:this.props.onTextEsc,onTextEnter:this.props.onTextEnter,editModeStore:this.stores.editModeStore,normalizedCardSelectionStore:this.normalizedCardSelectionStore}),this.renderProperties(),this.renderFooterIcons()]}),y=this.isItemSelectedStore.state;return(0,b.jsx)(Bo.Z,{debugName:"CollectionViewCardItem",capture:S,onEsc:()=>{pe.MO(),yr(this.stores.editModeStore)},onEnter:()=>function(e,t){t&&t(e)}(this.props.store,this.props.onTextEnter),onSpace:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleBlockSpace,onTab:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleBlockPropertyTab,onUntab:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleEditButtonClick,children:(0,b.jsxs)(Bo.Z,{debugName:"CollectionViewCardItem",capture:y,onShiftEnter:()=>{ee.createAndCommit({userAction:"CollectionViewCardItem.handleFlushTemporaryPosition",environment:this.environment,perform:e=>{u({blocks:Jo.default.state.stores,transaction:e})}})},children:[f,cr(this.props.store,this.props.collectionContextStore)&&(0,b.jsx)(jo.bZ,{origin:C})]})})}renderProperties(){const e=_r(this.environment,this.props.store,this.props.schema,this.props.format,this.props.collectionContextStore,this.normalizedCardSelectionStore);if(0!==e.length)return(0,b.jsx)("div",{style:gr(this.props.shouldShowTitle,this.props.collectionContextStore),children:e.map(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderProperty)})}}or.displayName="CollectionViewCardItem";const rr=or,ir={float:"left",marginTop:2,marginRight:4,marginLeft:-2},nr={float:"left",marginTop:0,marginRight:4,marginLeft:-2},sr={fontSize:14,lineHeight:1.5,minHeight:21,fontWeight:D.Z.fontWeight.medium,width:"auto"},lr={fontSize:16,lineHeight:1.5,minHeight:24,fontWeight:D.Z.fontWeight.medium,width:"auto"};function ar(e,t){const o=t[e];return Boolean(o&&!fe.uk.includes(o.type))}function cr(e,t){var o,r,i;return!(e.getSpaceId()!==(null===(o=$o.default.state.currentSpaceStore)||void 0===o?void 0:o.id))&&((null===(r=t.collectionViewStore())||void 0===r?void 0:r.getFormat().app_config_uri)===m.g3&&e.getFormat().app_config_uri===m.z3&&"sprint_board"===(null===(i=$o.default.state.mainEditorCurrentBlockStore)||void 0===i?void 0:i.getFormat().special_page_for_pm_launch))}function dr(e){const t=e.collectionViewStore();return null==t?void 0:t.getType()}function ur(e,t){return(("board"===dr(t)?e.board_properties:e.gallery_properties)||[]).filter((e=>e.visible))}function pr(e,t,o){return"board"===dr(t)?(null==e?void 0:e.cardBackgroundColor)||o.boardItemDefaultBackground:o.collectionGalleryPreviewCardBackground}function hr(e,t,o){const r=dr(t),i=t.isCompactView.state;return{...i?{boxShadow:o.homeShadow.card.base}:{boxShadow:e?o.selectTypeBoardBoxShadow:o.lightBoxShadow},borderRadius:i?6:"board"===r?4:3,background:pr(e,t,o),overflow:"hidden",transition:"background 100ms ease-out",..."board"===r&&{marginBottom:ui}}}function mr(e,t,o){return t.isCompactView.state?{background:pr(e,t,o),boxShadow:o.homeShadow.card.hovered}:{background:(null==e?void 0:e.cardHoveredBackgroundColor)||o.cardHoveredBackground}}function Sr(e,t,o){return t.isCompactView.state?{background:pr(e,t,o),boxShadow:o.homeShadow.card.hovered}:{background:(null==e?void 0:e.cardPressedBackgroundColor)||o.cardPressedBackground}}function gr(e,t){const o=dr(t),r=t.isCompactView.state;return{paddingTop:e?0:8,paddingBottom:10,..."board"===o&&{lineHeight:1.5,paddingBottom:4,display:"flex",flexDirection:"column"},..."gallery"===o&&r&&{display:"flex",flexWrap:"wrap"}}}function Cr(e,t,o,r,i){const n=(0,yo.JI)(t);Y.eP({environment:e,store:t}),J.NX({store:n}),pe.Z5({store:t}),i&&L.sd(e,"board_item_edit_mode_enter",{...(0,he.Pn)(o),block_id:t.id,from:i,view_type:dr(o)}),r.setState("existing")}function fr(e,t){return(0,Go.Cr)({collectionContextStore:e,blockId:t.id,blockStore:t})}function yr(e){"new_empty"===e.state&&(e.setState("new"),qo.Z.state.isActive&&qo.Z.setState({...qo.Z.state,transient:!1}))}function vr(e,t,o,r,i,n){pe.MO(),J.ZH(e);t.canEdit()&&i.permissionScopes.state.canEditContent&&("new_empty"===n.state?r(t):"new"===n.state?o(t):Y.Ys({environment:e,store:t}),yr(n))}function xr(e,t,o,r,i){pe.MO();t.canEdit()&&r.permissionScopes.state.canEditContent&&("new_empty"===i.state?o(t):Y.Ys({environment:e,store:t}),yr(i))}function br(e,t,o,r){const i=dr(t);i&&(E.rv({environment:e,collectionContextStore:t,block_id:o.id,property:"title",property_type:"text",from:i}),yr(r))}function wr(e,t,o,r){To.xv({environment:e,blockPropertyValueOverlayStore:t}),Y.Ys({environment:e,store:o}),yr(r)}async function kr(e,t,o,r){const i=o.getIconStore();if(i){const{serverCommitResult:o}=ee.createAndCommit({userAction:"PageViewBlock.handleRecordIconChange",environment:t,perform:t=>{Oo.sO({store:i,value:e,transaction:t})}});await o}yr(r)}function _r(e,t,o,r,i,n){const s=ur(r,i);if(!t.isDefined())return[];return s.filter((r=>{const i=n.state&&"title"!==r.property;return Xt.XU({block:t.getModel(),property:r.property,schema:o,getRecordModel:t.getRecordModel,userId:e.currentUser.id,userTimeZone:(0,Ee.r)(),intl:ho.default.getIntl()})||i}))}function Tr(e,t,o,r,i,n){return 0===_r(e,t,o,r,i,n).length}function Or(e,t,o,r,i,n,s,l){const a=_r(e,t,r,i,n,l).map((e=>e.property));a.length>0&&To.bA({environment:e,blockPropertyValueOverlayStore:o,store:t,property:a[0],format:Mo.C.Page,collectionContextStore:n}),yr(s)}function Vr(e,t,o,r,i,n,s,l){const a=_r(e,t,o,r,i,l).map((e=>e.property)),c=N.dF(a,((e,t)=>ar(e,o)));c&&To.bA({environment:e,blockPropertyValueOverlayStore:n,store:t,property:c,format:Mo.C.Page,collectionContextStore:i}),yr(s)}function Pr(e,t,o,r,i,n,s,a){const c=o.state,d=_r(e,t,r,i,n,a).map((e=>e.property)),u=c.isOpen?d.findIndex((e=>e===c.property)):-1,p=d.find(((e,t)=>t>u&&ar(e,r)))||d.find(((e,t)=>!a.state&&ar(e,r)));p?l.default.afterNextFlush((()=>{To.bA({environment:e,blockPropertyValueOverlayStore:o,store:t,property:p,format:Mo.C.Page,collectionContextStore:n})})):a.state&&l.default.afterNextFlush((()=>{Cr(e,t,n,s)})),To.xv({environment:e,blockPropertyValueOverlayStore:o}),yr(s)}function Rr(e,t,o,r,i,n,s,a){const c=o.state;if(!c.isOpen)return;const d=_r(e,t,r,i,n,a).map((e=>e.property)),u=d.findIndex((e=>e===c.property)),p=N.dF(d,((e,t)=>t<u&&ar(e,r)))||N.dF(d,((e,t)=>!a.state&&ar(e,r)));p?l.default.afterNextFlush((()=>{To.bA({environment:e,blockPropertyValueOverlayStore:o,store:t,property:p,format:Mo.C.Page,collectionContextStore:n})})):a.state&&l.default.afterNextFlush((()=>{Cr(e,t,n,s)})),To.xv({environment:e,blockPropertyValueOverlayStore:o}),yr(s)}function Mr(e,t,o,r,i,n,s){return{display:"flex",alignItems:"center",paddingLeft:10,paddingRight:10,paddingBottom:8,..."gallery"===dr(t)&&{paddingTop:Tr(e,o,r,i,t,s)&&!n?8:0}}}const jr=i.memo((function(e){let{collectionContextStore:t,store:o,schema:r,format:n,blockPropertyValueOverlayStore:s,onTextEsc:l,onTextEnter:c,editModeStore:p,normalizedCardSelectionStore:h}=e;const m=(0,u.Fg)(),S=(0,a.O7)(),g=(0,B.useIntl)(),C=(0,i.useCallback)((()=>br(S,t,o,p)),[S,t,o,p]),{collectionViewBlockId:f,collectionViewId:y}=(0,d.VK)((()=>{var e,o;return{collectionViewId:null===(e=t.collectionViewStore())||void 0===e?void 0:e.id,collectionViewBlockId:null===(o=t.collectionViewBlockStore())||void 0===o?void 0:o.id}}),[t]),v=(0,i.useCallback)((()=>Vr(S,o,r,n,t,s,p,h)),[S,o,r,n,t,s,p,h]),x=(0,i.useCallback)((()=>Or(S,o,s,r,n,t,p,h)),[S,o,s,r,n,t,p,h]),w=(0,i.useCallback)((()=>xr(S,o,l,t,p)),[S,o,l,t,p]),k=(0,i.useCallback)((()=>vr(S,o,c,l,t,p)),[S,o,c,l,t,p]),_=(0,i.useCallback)((e=>kr(e,S,o,p)),[S,o,p]),{device:T}=S,O=(0,d.VK)((()=>(0,yo.JI)(o)),[o]),V=(0,d.VK)((()=>(o.hasIcon()||!o.isEmptyPage())&&t.shouldShowPageIcon()),[o,t]),P=(0,d.VK)((()=>o.hasError()),[o]),R=(0,d.VK)((()=>o.canEdit()&&t.permissionScopes.state.canEditContent),[o,t]),M=(0,d.VK)((()=>h.state),[h]),j=(0,d.VK)((()=>dr(t)),[t]),I=(0,d.VK)((()=>function(e){return{..."board"===dr(e)&&{marginTop:1,marginLeft:0,marginRight:2,borderRadius:5,padding:2,width:24,height:24}}}(t)),[t]),F=(0,d.VK)((()=>o.getIcon()),[o]),N=(0,d.VK)((()=>o.isEmptyPage()),[o]),D=(0,d.VK)((()=>function(e,t,o,r,i,n){const s=dr(t);return{..."gallery"===s&&{width:"100%"},display:"flex",paddingTop:fr(t,o)?4:8,paddingLeft:"board"===s?6:10,paddingRight:10,paddingBottom:"gallery"===s&&Tr(e,o,r,i,t,n)?10:6,position:"relative"}}(S,t,o,r,n,h)),[S,t,o,r,n,h]),L=R?(0,b.jsx)(Do.Z,{disabled:!1,bucket:"secure",style:{...I,...T.isMobile?nr:ir,..."board"===j&&{marginTop:1,marginLeft:0,marginRight:2,borderRadius:5,padding:2,width:24,height:24}},progressContainerStyle:{top:14,bottom:"unset",right:"unset",fontSize:12},icon:F,store:o,onChange:_,size:T.isMobile?24:20,isEmptyPage:N}):(0,b.jsx)(Do.Z,{disabled:!0,bucket:"secure",style:{...I,...T.isMobile?nr:ir},progressContainerStyle:{top:14,bottom:"unset",right:"unset",fontSize:12},icon:F,store:o,size:T.isMobile?24:R?20:18,isEmptyPage:N}),E=(0,b.jsx)(Eo.Z,{store:O,disabled:!M,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableEmbedMenu:!0,onEnter:k,onEsc:w,onTab:x,onUntab:v,onChange:C,placeholder:M?g.formatMessage(tr.typeAName):g.formatMessage(tr.untitledBlock),style:{...T.isMobile?lr:sr,..."board"===j&&{flexGrow:1,padding:2},pointerEvents:M?void 0:"none",cursor:M?"text":void 0,..."gallery"===j&&{whiteSpace:"pre-wrap"}},disableSelectAllBlocks:!0,pasteBehavior:"inline",inPageFind:{type:"collection_child_page",propertyId:"title",collectionViewId:y,collectionViewBlockId:f}});return(0,b.jsxs)("div",{style:D,children:[(V||M)&&!P&&L,P&&(0,ko.t)({fill:m.accentColors.orange[500],width:T.isMobile?20:16,marginLeft:T.isMobile?2:4,marginRight:T.isMobile?4:6,paddingBottom:6,paddingTop:6,display:"inline-block",verticalAlign:"bottom"}),E]})})),Ir=i.memo((function(e){let{propertyFormat:t,store:o,blockPropertyValueOverlayStore:r,schema:n,format:s,collectionContextStore:l,disabled:c,editModeStore:u,normalizedCardSelectionStore:p}=e;const h=(0,a.O7)(),m=(0,i.useCallback)((()=>Rr(h,o,r,n,s,l,u,p)),[h,o,r,n,s,l,u,p]),S=(0,i.useCallback)((()=>Pr(h,o,r,n,s,l,u,p)),[h,o,r,n,s,l,u,p]),g=(0,i.useCallback)((()=>wr(h,r,o,u)),[h,r,o,u]),C=(0,d.VK)((()=>o.getAssociatedCollectionStore()),[o]),f=(0,d.VK)((()=>p.state),[p]),y="gallery"===(0,d.VK)((()=>dr(l)),[l])?Mo.C.GalleryView:Mo.C.Board,v=(0,d.VK)((()=>Boolean(l.normalizedFormatStore.state.table_wrap)),[l]),x=(0,d.VK)((()=>o.canEdit()),[o]),w=(0,d.VK)((()=>l.collectionViewStore()),[l]),k=(0,d.VK)((()=>l.permissionScopes.state.isLocked),[l]);return C?(0,b.jsx)(Ro.Z,{store:o,property:t.property,disabled:c||!x,locked:k,format:y,tableWrap:v||Boolean(t.wrap),blockPropertyValueOverlayStore:r,collectionStore:C,showIfEmpty:f,onEnter:g,onEsc:g,onBgClick:g,onTab:S,onUntab:m,collectionViewStore:w},t.property):null}));const Fr=function(e){let{store:t,disabled:o,isFirstItem:r,isLastItem:i,hideContent:n,blockResizerStore:s,isQuickFind:l,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:h,format:m,schema:S,coverFormat:g,coverAspectFormat:C,coverSizeFormat:f,shouldShowTitle:y,colorStyle:v,onTextEnter:x,onTextEsc:w,onShiftEnter:k,blockPropertyValueOverlayStore:_,isLast:T,handleOpenPeekPage:O,collectionContextStore:V}=e;return(0,b.jsx)(rr,{store:t,disabled:o,isFirstItem:r,isLastItem:i,hideContent:n,blockResizerStore:s,isQuickFind:l,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:h,format:m,schema:S,coverFormat:g,coverAspectFormat:C,coverSizeFormat:f,coverHeight:void 0,coverWidth:void 0,shouldShowTitle:y,colorStyle:v,onTextEnter:x,onTextEsc:w,onShiftEnter:k,blockPropertyValueOverlayStore:_,isLast:T,handleOpenPeekPage:O,collectionContextStore:V})};var Br=o(34232),Nr=o(36596);function Dr(e){const t=e.minHeight||us,o=(0,u.yK)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:4,backgroundColor:e.largeShimmerColor,minHeight:t,width:"100%",marginBottom:4}})),[t]);return(0,b.jsx)(Nr.Z,{style:o.card})}function Lr(){return(0,Br.Z)(!0,0,100)?(0,b.jsx)(Dr,{}):null}var Er=o(30077),Ar=o(45010),Hr=o(18245),Zr=o(76205),zr=o(59054),Gr=o(95371),Kr=o(37524),Ur=o(73807),Wr=o(20144),$r=o(92973),qr=o(48543),Qr=o(55367);function Yr(e){const{store:t,resultProps:o,resultComponent:r,collectionContextStore:n,canDrag:s,canDrop:c,getItemSelectableStyle:p,belowDropZoneMargin:h,analyticsName:m,disabled:S,direction:g,onSelectableEnter:C,disableScrollToRevealHorizontal:f,touchDragOnly:y,isLast:v,groupsPointer:x,toggleButton:w,subitemPath:k,disableSelectable:_,itemSelectableHaloStyle:T,passesFilter:O,onSelectableInsertRow:V,blockPropertyValueOverlayStore:P,dropzoneGap:R}=e,M=(0,a.O7)(),j=(0,d.VK)((()=>t.canEdit()),[t]),I=(0,d.VK)((()=>t.getAssociatedCollectionStore()),[t]),F=(0,d.VK)((()=>"collectionTypedView"===n.contextType),[n]),N=(0,d.VK)((()=>{const e=n.groupsStore.getGroupState(x);return null==e?void 0:e.resultsStore}),[n,x]),D=(0,d.VK)((()=>ce.Sc(t)),[t]),L=(0,d.VK)((()=>{const e=qo.Z.state;return e.isActive&&e.store===t}),[t]),E=(0,d.VK)((()=>!S&&j),[S,j]),A=(0,d.VK)((()=>e.shouldShowHoverMenu&&E),[e.shouldShowHoverMenu,E]),H=g!==oi.Vertical&&c,z=g!==oi.Vertical&&c,G=g===oi.Vertical&&c,K=(0,u.yK)((e=>({haloStyle:{...ce.pB(D,e),...T}})),[T,D]),W=(0,i.useCallback)((e=>{const{insertStores:o,transaction:r}=e;return I?Z.$T({environment:M,collectionStore:I,collectionContextStore:n,groupsPointer:x,insertStores:o,store:t,before:!1,transaction:r}):[]}),[I,n,M,x,t]),$=(0,i.useCallback)((e=>{const{insertStores:o,transaction:r}=e;return I?Z.$T({environment:M,collectionStore:I,collectionContextStore:n,groupsPointer:x,insertStores:o,store:t,before:!0,transaction:r}):[]}),[I,n,M,x,t]),q=(0,i.useCallback)((e=>{const{droppedDirection:o,duplicate:r}=e;if(!I)return[];const i=Hr.default.mark("collections.drop_item_lag");Hr.default.measureAfterNextFlush(i,{environment:M,getData:()=>he.yr({collectionContextStore:n,is_native_drop:!1,is_empty:!1})});const s=o!==Qr.vh.Onto?(0,we.F6)({stores:e.droppedStores,collectionContextStore:n}):e.droppedStores;0===s.length&&F?be.showErrorMessage((0,b.jsx)(B.FormattedMessage,{...we.nX.unsupportedGroupAction})):ee.createAndCommit({userAction:"CollectionGroupResultsItem.handleDrop",environment:M,perform:e=>{!Z.by({environment:M,collectionStore:F?void 0:I,targetStore:t,droppedDirection:o,collectionContextStore:n,groupsPointer:x,droppedStores:s,duplicate:r,transaction:e,subitemPath:k})&&F&&be.showErrorMessage((0,b.jsx)(B.FormattedMessage,{...we.nX.unsupportedGroupAction}))}})}),[I,n,M,x,F,t,k]),Q=(0,i.useCallback)((e=>{const{files:o,droppedDirection:r}=e;if(!I)return[];const i=Hr.default.mark("collections.drop_item_lag");Hr.default.measureAfterNextFlush(i,{environment:M,getData:()=>he.yr({collectionContextStore:n,is_native_drop:!0,is_empty:!1})}),ee.createAndCommit({userAction:"CollectionGroupResultsItem.handleNativeDrop",environment:M,perform:e=>{Z.tQ({environment:M,collectionStore:I,targetStore:t,droppedDirection:r,collectionContextStore:n,groupsPointer:x,files:o,transaction:e})}})}),[I,n,M,x,t]),Y=(0,i.useCallback)((e=>o=>{let{transaction:r}=o;if(!I)return[];const i=Z.yk({environment:M,collectionContextStore:n,groupsPointer:x,store:t,before:"above"===e,collectionStore:I,transaction:r,subitemPath:k,subitemInsertDirection:"below"});ne.W(M,{...he.Pn(n),type:"page",from:"below"===e?"table_insert_below":"table_insert_above",new_page_id:null==i?void 0:i.id,creating_block_id:null==i?void 0:i.id}),i&&V&&V(t,i),i&&P&&l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{To.bA({isNewBlock:!0,environment:M,blockPropertyValueOverlayStore:P,store:i,property:"title",format:Mo.C.Table,collectionContextStore:n})}))}))}),[I,P,n,M,x,V,t,k]),X=e.handleOpenPeekPage,J=(0,i.useCallback)((()=>{const e=n.collectionViewStore();Hr.default.mark("collections.open_item_page_lag"),X&&X(),U.Xd({collectionContextStore:n,resultsStore:N});const t=null==e?void 0:e.getType();if(t){const e=n.normalizedFormatStore.state.collection_peek_mode,o=e||qr.Ls[t];$r.hy(M,{is_peek:!0,from:t,peek_mode:o})}}),[n,M,X,N]),te=(0,d.VK)((()=>p?p(v):void 0),[p,v]);(0,i.useEffect)((()=>{n.onItemMount()}),[n]);const oe=i.createElement(r,{handleOpenPeekPage:J,collectionContextStore:n,...o,store:t,key:t.id,isLast:v,toggleButton:w,subitemPath:k,passesFilter:O});return _?oe:(0,b.jsx)(It.Z,{style:te,store:t,canSelect:E,shouldShowHalo:!L,shouldForceRenderSelectionHalo:D,haloStyle:K.haloStyle,canDrag:s,canDropBelow:G,canDropLeft:H,canDropRight:z,canNativeDropBelow:G&&!F,canNativeDropLeft:H&&!F,canNativeDropRight:z&&!F,canDropOnto:c,canTriggerContextMenu:E,showBlockMenuInput:!0,shouldShowHoverMenu:A,shouldShowCommentMenu:!1,onSelectableDrop:q,onNativeDrop:Q,onInsertBelow:W,onInsertAbove:$,onRemove:e=>function(e,t,o,r,i){const{transaction:n}=e;i.length>0&&Z.BN({store:o,transaction:n,groupsPointer:i,collectionContextStore:r,environment:t});Z.Od({store:o,transaction:n})}(e,M,t,n,x),canInsertAbove:c,canInsertBelow:c,onInsertRowBelow:Y("below"),onInsertRowAbove:Y("above"),belowDropZoneMargin:h,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:m,shouldShowDropZone:c,dropzoneGap:R,onEnter:C,className:fo.K4T,disableScrollToRevealHorizontal:f,touchDragOnly:y,groupsPointer:x,children:oe})}const Xr=i.memo(Yr,po.Z);function Jr(e){const{store:t,collectionContextStore:o,subitemPath:r,titleColumnIndex:n,nestedCreateSubitemButton:s,getItemSelectableStyle:l}=e,{currentSubitemFormatStoreForUiDisplay:c,subitemExpandedStore:p,subitemTreeStore:h}=o,m=(0,d.VK)((()=>ce.Bm({store:t,collectionContextStore:o})),[o,t]),S=(0,d.VK)((()=>r&&r.length>0?r:(0,Gr.DY)(h.state.children,(e=>e.value.store===t))),[r,h,t],{useDeepEqual:!0}),g=(0,i.useMemo)((()=>S?(0,Go.Af)(S.map((e=>e.value.store))):""),[S]),C=(0,d.VK)((()=>p.state.get(g)),[p,g]),f=Boolean(null==C?void 0:C.isExpanded),y=(0,a.O7)(),v=(0,d.VK)((()=>{const e=c.state;if(!e||!m)return;const t=m.getSchema()[e.property];return void 0!==t&&(0,fe.p_)(t)?t:void 0}),[c,m]),x=(0,d.VK)((()=>{var e;return v&&"relation"===v.type&&(0,fe.F0)(v)===(null===(e=o.collectionStore())||void 0===e?void 0:e.id)&&v.property}),[o,v]),w=(0,d.VK)((()=>{var e;return null===(e=o.collectionViewStore())||void 0===e?void 0:e.getType()}),[o]),k=(0,d.VK)((()=>{const e=!x||w&&(0,Go.Av)(w)?void 0:{property:x,filter:{operator:"is_empty"}};return!(!c.state||!m)&&(0,Go.kC)({store:t,collectionStore:m,subitemFormat:c.state,subitemPathKey:g,collectionContextStore:o,propertyFilters:[...e&&x?[{id:x,filter:e}]:[],...o.currentPropertyFiltersStore.state],combinatorFilter:o.currentCombinatorFilterStore.state,currentUserId:y.currentUser.id}).length>0}),[o,w,c,y.currentUser.id,x,m,g,t]),_=(0,d.VK)((()=>{var e;if(!c.state||!m)return!1;const t=null===(e=o.collectionViewStore())||void 0===e?void 0:e.getType();return k||f||y.device.isMobile||"timeline"===t}),[c,y.device.isMobile,m,k,f,o]),T=(0,d.VK)((()=>Wr.Z.getState().hoveredStore===t),[t]),O=(0,d.VK)((()=>{const e=(0,ao.m1)({collectionContextStore:o,collectionStore:m,environment:y});if(e)return(0,Zr.q)(e)}),[o,m,y]),V=(0,i.useCallback)((()=>{const e=p.state;if(f)e.delete(g),L.a_(y,{...(0,he.Pn)(o),depth:(null==S?void 0:S.length)||0}),p.emit();else{e.set(g,{isExpanded:!0,limit:20}),L._k(y,{...(0,he.Pn)(o),depth:(null==S?void 0:S.length)||0});const r=c.state;O&&e&&v&&r?(0,Go.fd)({blockStore:t,subitemExpandedStore:p,subitemFormat:r,propertySchema:v,compiledFilter:O,pathKey:g,forceStoresToLoad:!1,visitedIds:new Set}).then((()=>{p.emit()})):p.emit()}}),[O,p,f,g,o,c,y,S,t,v]),P=(0,d.VK)((()=>{const o=h.state;return o&&S?(0,Go.Ns)(o).value.store===t:e.isLast}),[h,e.isLast,t,S]),R=(0,Ur._)(),M=(0,d.VK)((()=>{var e;const o=t.getModel(),r=t.getRecordModel;if(!O||!o)return!0;const i=null===(e=t.getAssociatedCollectionStore())||void 0===e?void 0:e.getPropertyMapping();return O({block:o,getRecordModel:r,propertyMapping:i,formulaTimeoutTimestampMs:Date.now()+R,resultCache:new Map})}),[t,O,R]),j=(0,d.VK)((()=>l&&!M?()=>({...l?l(P):{},...M?{}:{opacity:.5}}):l),[l,M,P]);(0,zr.r5)((async()=>{const e=t.getModel();await t.load();const o=t.getRecordModel,r=c.state;if(!_||!e||!O||!v||!o||!r||M)return;(0,Go.xb)({store:t,subitemFormat:r,propertySchema:v}).length>0||(await(0,Go.fd)({blockStore:t,subitemExpandedStore:p,subitemFormat:r,propertySchema:v,compiledFilter:O,pathKey:g,forceStoresToLoad:!0,visitedIds:new Set}),p.emit())}),[_,O,c,M,g,t,p,v]);const I=(0,u.Fg)(),F=(0,b.jsx)(Xr,{...e,passesFilter:M,isLast:P,getItemSelectableStyle:j,subitemPath:S,toggleButton:(_||T)&&(0,b.jsx)(Ft.Z,{isSidebar:!1,open:f,fill:!0,onClick:V,color:k||f?I.regularIconColor:I.mediumIconColor,disabled:S&&S.length>=Go.F0})});if(!f||!S||0===S.length||S.length>=Go.F0)return F;const B=S[S.length-1].children;return(0,b.jsxs)(b.Fragment,{children:[F,B.map((t=>{const o=t.value.store;return(0,i.createElement)(Jr,{...e,key:o.id,store:o,subitemPath:[...S,t]})})),m&&s&&s({store:t,parentStore:m,subitemPath:S,indentLevel:S.length,titleColumnIndex:n}),C&&B.length>0&&B.length===C.limit&&(0,b.jsx)(ei,{collectionContextStore:e.collectionContextStore,pathKey:g,titleColumnIndex:n,limit:C.limit,indentLevel:S.length})]})}const ei=i.memo((function(e){const{collectionContextStore:t,pathKey:o,titleColumnIndex:r,limit:n,indentLevel:s}=e,l=(0,i.useCallback)((()=>{const{subitemExpandedStore:e}=t;e.state.set(o,{isExpanded:!0,limit:n+20}),e.emit()}),[t,n,o]),c=(0,a.O7)(),p=(0,d.VK)((()=>ce.fk({environment:c,collectionContextStore:t})),[t,c]),h=(0,d.VK)((()=>{var e;return"title"===(null===(e=t.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[t]),m=(0,u.yK)((e=>({button:{display:"flex",alignItems:"center",height:32,width:"100%",paddingLeft:8+(0,Kr.f2)({columnIndex:0,titleColumnIndex:r,shouldShowBulkActionsToolbar:p,indentLevel:s+1,isSubitemToggleOnTitleColumn:h}),fontSize:14,lineHeight:D.Z.lineHeight.UIRegular.desktop,borderTop:`1px solid ${e.tableDividerColor}`,borderBottom:`1px solid ${e.tableDividerColor}`,background:e.cardContentBackground},icon:{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.lightIconColor},label:{color:e.lightTextColor}})),[s,p,r,h]);return(0,b.jsxs)(Yt.Z,{onClick:l,onMouseDown:me.$0,style:m.button,children:[(0,Kt.M)(m.icon),(0,b.jsx)("span",{style:m.label,children:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Load more",id:"database.loadMoreButtonTitle"})})]})})),ti=i.memo(Jr);let oi=function(e){return e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal",e}({});class ri extends s.Z{constructor(){super(...arguments),this.instanceCollectionViewBlockStore=void 0,this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleEmptyDroppableDrop=e=>function(e,t,o,r,i){const{droppedDirection:n,duplicate:s}=e,l=i.state,a=o.collectionViewBlockStore();if(!a)return;const c=Hr.default.mark("collections.drop_item_lag");Hr.default.measureAfterNextFlush(c,{environment:t,getData:()=>he.yr({collectionContextStore:o,is_native_drop:!1,is_empty:!0})});const d="collectionTypedView"===o.contextType,u=(0,we.F6)({stores:e.droppedStores,collectionContextStore:o});if(0===u.length&&d)return void be.showErrorMessage(ho.default.formatMessage(we.nX.unsupportedGroupAction));ee.createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableDrop",environment:t,perform:e=>{!Z.by({environment:t,collectionStore:l,targetStore:a,droppedDirection:n,collectionContextStore:o,groupsPointer:r,droppedStores:u,duplicate:s,transaction:e})&&d&&be.showErrorMessage(ho.default.formatMessage(we.nX.unsupportedGroupAction))}})}(e,this.environment,this.props.collectionContextStore,this.props.groupsPointer,this.emptyDroppableIntoStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleEmptyDroppableNativeDrop=e=>function(e,t,o,r,i){const{files:n,droppedDirection:s}=e,l=i.state;if(!l)return;const a=o.collectionViewBlockStore();if(!a)return;const c=Hr.default.mark("collections.drop_item_lag");Hr.default.measureAfterNextFlush(c,{environment:t,getData:()=>he.yr({collectionContextStore:o,is_native_drop:!0,is_empty:!0})}),ee.createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableNativeDrop",environment:t,perform:e=>{Z.tQ({environment:t,collectionStore:l,targetStore:a,droppedDirection:s,collectionContextStore:o,groupsPointer:r,files:n,transaction:e})}})}(e,this.environment,this.props.collectionContextStore,this.props.groupsPointer,this.emptyDroppableIntoStore),this.resultsReducerStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupsPointer:t,loadContentCover:o}=this.props,r=e.groupsStore.getGroupState(t);if(!r)return;const i=r.currentLimit.state,n=e.normalizedSchemaStore.state,s=N.oA(t.map((e=>(0,Le.Ko)({schema:n,propertyMapping:void 0,group:e,timeZone:(0,Ee.r)()}))));return{type:"results",filter:s.length>0?{operator:"and",filters:s}:void 0,limit:i,loadContentCover:o}})),this.resultStores=this.createComputedStore((()=>{const{collectionContextStore:e,groupsPointer:t}=this.props,o=e.groupsStore.getGroupState(t);return(null==o?void 0:o.resultsStore.state)??[]})),this.emptyDroppableIntoStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return"collectionTypedView"===e.contextType?void 0:e.collectionStore()}))}getNode(){return super.getNode()}UNSAFE_willMount(e){super.UNSAFE_willMount(e);const t=e.collectionContextStore.collectionViewBlockStore();t&&(this.instanceCollectionViewBlockStore=new ge.G(this.environment,t.pointer))}didMountOrUpdate(){this.props.collectionContextStore.renderEmitter.emit()}renderComponent(){const{emptyDroppableStyle:e,direction:t,collectionContextStore:o,groupsPointer:r,virtualizeResults:i}=this.props,n=this.props.emptyDroppableSize||"none",s=t===oi.Vertical;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{style:{...s?{height:n}:{width:n},...e},children:this.renderEmptyDroppable()}),i&&co.default.checkGate("collections_virtualization")?(0,b.jsx)(si,{collectionContextStore:o,groupsPointer:r,resultComponentProps:this.props}):this.resultStores.state.map(((e,t,o)=>(0,b.jsx)(ai,{store:e,isLast:t===o.length-1,...this.props},e.id))),(0,b.jsx)(ci,{collectionContextStore:this.props.collectionContextStore,groupsPointer:this.props.groupsPointer,disableRequest:this.props.disableRequest,resultsReducerStore:this.resultsReducerStore})]})}renderEmptyDroppable(){const{collectionContextStore:e,disabled:t,analyticsName:o,direction:r,onSelectableEnter:i,canDrop:n,groupsPointer:s}=this.props;if(this.instanceCollectionViewBlockStore){const l=r!==oi.Vertical&&(!t&&0===this.resultStores.state.length),a=r===oi.Vertical&&!t,c="collectionTypedView"===e.contextType,d=e.isCompactView.state;return(0,b.jsx)(It.Z,{store:this.instanceCollectionViewBlockStore,canSelect:!1,canEditText:!1,shouldShowHalo:!d,canDrag:!1,canDropLeft:n&&l,canNativeDropLeft:n&&l&&!c,canDropBelow:n&&a,canNativeDropBelow:n&&a&&!c,canTriggerContextMenu:!1,showBlockMenuInput:!1,shouldShowHoverMenu:!1,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleEmptyDroppableDrop,onNativeDrop:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleEmptyDroppableNativeDrop,analyticsName:o,shouldShowDropZone:n,onEnter:i,groupsPointer:s,style:r===oi.Vertical?void 0:{width:"100%",height:"100%"}})}}}ri.displayName="CollectionGroupResults";const ii=ri;function ni(e){let{collectionContextStore:t,groupsPointer:o,resultComponentProps:r}=e;const n=(0,i.useRef)(null),s=(0,d.VK)((()=>{const e=t.groupsStore.getGroupState(o);return(null==e?void 0:e.resultsStore.state)??[]}),[t,o]),l=(0,i.useRef)(0);(0,i.useLayoutEffect)((()=>{var e;0===l.current&&(l.current=(null===(e=n.current)||void 0===e||null===(e=e.getBoundingClientRect())||void 0===e?void 0:e.top)??0)}));const a=(0,Er.MG)({count:s.length,estimateSize:()=>34,scrollMargin:l.current,getScrollElement:()=>{var e;return null===(e=Ar.Z.PageScroller)||void 0===e?void 0:e.getNode()}});return(0,b.jsx)("div",{ref:n,style:{height:a.getTotalSize(),width:"100%",position:"relative"},children:a.getVirtualItems().map((e=>{const t=s[e.index],o=s.length-1===e.index;return(0,b.jsx)("div",{"data-index":e.index,ref:a.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${(e.start??0)-a.options.scrollMargin}px)`},children:(0,b.jsx)(ai,{store:t,isLast:o,...r},t.id)},e.key)}))})}const si=i.memo(ni,po.Z);function li(e){const{isLast:t,collectionContextStore:o,dropzoneGap:r,resultProps:n,resultComponent:s,groupsPointer:l,shouldShowHoverMenu:a,canDrag:c,disabled:u,format:p,getItemSelectableStyle:h,handleOpenPeekPage:m,belowDropZoneMargin:S,analyticsName:g,direction:C,onSelectableEnter:f,canDrop:y,disableScrollToRevealHorizontal:v,touchDragOnly:x,blockPropertyValueOverlayStore:w,onSelectableInsertRow:k,disableSelectable:_,titleColumnIndex:T,nestedCreateSubitemButton:O,itemSelectableHaloStyle:V}=e,P=(0,d.VK)((()=>ce.Bm({store:e.store,collectionContextStore:o})),[o,e.store]),R=(0,i.useMemo)((()=>[]),[]);return P?(0,b.jsx)(ti,{getItemSelectableStyle:h,itemSelectableHaloStyle:V,store:e.store,canDrag:c,resultProps:n,resultComponent:s,collectionContextStore:o,groupsPointer:l,shouldShowHoverMenu:a,canDrop:y&&!u,format:p,handleOpenPeekPage:m,belowDropZoneMargin:S,analyticsName:g,disabled:u,direction:C,dropzoneGap:r,onSelectableEnter:f,disableScrollToRevealHorizontal:v,touchDragOnly:x,isLast:t,subitemPath:R,titleColumnIndex:T,blockPropertyValueOverlayStore:w,onSelectableInsertRow:k,disableSelectable:_,nestedCreateSubitemButton:O}):null}const ai=i.memo(li,po.Z);function ci(e){let{collectionContextStore:t,groupsPointer:o,disableRequest:r,resultsReducerStore:i}=e;const n=(0,d.VK)((()=>i.state),[i]),s=(0,d.VK)((()=>t.groupsStore.getGroupState(o)),[t,o]);return!r&&n&&s?(0,b.jsx)(ze.Z,{id:o.length>0?`results:${(0,re.KW)(o)}`:"collection_group_results",reducer:n,groupsPointer:o,collectionContextStore:t,resultStore:s.reducerResultStore}):null}var di=o(43145);const ui=5,pi=5,hi=5,mi=8,Si=8;function gi(e,t){return t?0:e?8:12}const Ci=function(e){let{groupsPointer:t,schema:o,format:r,collectionContextStore:i,store:n,disabled:s,blockPropertyValueOverlayStore:l,isFullScreen:c,anyGroupHasResults:p,isInPeekRenderer:h,hoveredGroupStore:m}=e;const S=(0,u.Fg)(),g=(0,a.O7)(),C=(0,d.VK)((()=>{const e=N.Z$(t);return(0,we.II)({environment:g,groupFormat:e,schema:o,format:r,theme:S,useDarkerColors:i.isInHomeWidget.state})}),[t,o,r,i,g,S]),f=(0,d.VK)((()=>{const e=i.groupsStore.getGroupState(t);return Boolean(null==e?void 0:e.reducerResultStore.state)}),[t,i]),y=(0,d.VK)((()=>i.groupsStore.getGroupState(t)),[i,t]),v=(0,d.VK)((()=>(0,ce.az)(i,c)),[i,c]),x=(0,d.VK)((()=>null==y?void 0:y.reducerResultStore.state),[y]),w=(0,d.VK)((()=>i.permissionScopes.state),[i]),k=(0,d.VK)((()=>i.isInHomeWidget.state),[i]),_=(0,d.VK)((()=>!s&&f&&i.shouldAllowNewItemCreation({overrideAllowForTypedViews:!k})),[s,f,i,k]),T=(0,d.VK)((()=>(0,ce.VM)({reducerResult:x,collectionContextStore:i,isFullScreen:c})),[x,i,c]),O=(0,d.VK)((()=>Wt({collectionContextStore:i,groupsPointer:t,hasPartialResults:p})),[i,t,p]),V=(0,d.VK)((()=>p&&i.shouldShowSpinner.state&&"load_general"===i.loadingDetails.state.type),[i,p]),P=(0,d.VK)((()=>i.isCompactView.state),[i]);if(!y)return null;const R=function(e){return e?e.board_cover:void 0}(r),M=!s&&!w.isSyncedCollection,j=Boolean(r.collection_group_by),I=!p&&j&&O;return(0,b.jsxs)("div",{style:_i(r,P,h,f,C),onMouseDown:e=>function(e,t){const{device:o}=t,{target:r}=e;!o.isMobile&&r instanceof HTMLElement&&(0,me.ZP)({event:e,context:me.Af.EditorMouseDown,callback:()=>{e.preventDefault(),W.AI({environment:t,target:r,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,g),onClick:bi,className:fo.GfL,onMouseMove:()=>function(e,t){const o=N.Z$(e);o&&t.state!==o&&t.setState(o)}(t,m),children:[(0,b.jsx)(ii,{collectionContextStore:i,groupsPointer:t,format:r,canDrag:M,onSelectableEnter:e=>wi(e,t,i,c,g),resultProps:{format:r,schema:o,onTextEnter:e=>function(e,t,o,r,i,n){if(!Ce.M_(n)||!o.collectionStore())return ki(e,o,i,t,n);const s=xi(t,o);if(!s)return;const l=s.state.findIndex((t=>t===e))+1;ee.createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:n,perform:e=>{go({transaction:e,environment:n,collectionContextStore:o,isFullScreen:r,groupsPointer:t,insertAtIndex:l,from:"board_group_enter_add_item",transient:!0,useCrdt:(0,Co.dy)({source:"collection_non_table_view"})})}})}(e,t,i,c,n,g),onShiftEnter:e=>wi(e,t,i,c,g),coverFormat:R,coverAspectFormat:fi(r),coverSizeFormat:yi(r),shouldShowTitle:yo.K8(r,"board"),colorStyle:C,onTextEsc:e=>ki(e,i,n,t,g),disabled:s,blockPropertyValueOverlayStore:l,collectionContextStore:i},canDrop:!0,resultComponent:Fr,disabled:s,direction:oi.Vertical,shouldShowHoverMenu:!1,belowDropZoneMargin:2,emptyDroppableSize:j?ui:3,analyticsName:"board",loadContentCover:R&&"page_content"===R.type}),I&&(0,b.jsx)(Lr,{}),T&&(0,b.jsx)(no,{groupsPointer:t,store:n,collectionContextStore:i,format:r,isFullScreen:c,incrementLimitsInRelatedGroups:!0}),_&&(0,b.jsxs)(b.Fragment,{children:[T&&(0,b.jsx)("div",{style:{width:"100%",borderTop:`1px solid ${S.tableDividerColor}`,marginTop:4,marginBottom:4}}),(0,b.jsx)(xo,{groupsPointer:t,collectionContextStore:i,isFullScreen:c,color:null==C?void 0:C.textColor,shouldShowSpinner:V})]}),!v&&(0,b.jsx)(di.Z,{onChange:e=>function(e,t,o,r,i){const n=t.isLoading.state,s=t.groupsStore.getGroupState(r),l=null==s?void 0:s.reducerResultStore.state;e<vo.Z.incrementScrollOffset&&!n&&l&&l.hasMore&&(Z.ID({collectionContextStore:t,environment:i,incrementLimitArgs:{isFullScreen:o,currentResultCount:l.blockIds.length,groupsPointer:r,incrementLimitsInRelatedGroups:!1}}),t.loadingDetails.setState({type:"load_general"}))}(e,i,c,t,g)})]})};function fi(e){return e?e.board_cover_aspect:void 0}function yi(e){return e?e.board_cover_size:void 0}function vi(e){const t=e.board_cover_size;return(0,ce.rD)(t)}function xi(e,t){const o=t.groupsStore.getGroupState(e);return null==o?void 0:o.resultsStore}function bi(e){(0,me.ZP)({event:e,context:me.Af.EditorClick,callback:()=>{}})}function wi(e,t,o,r,i){const{blocks:n,transaction:s}=e;if(0===n.length)return;const l=n[0];if(!Ce.M_(i)||!o.collectionStore()||!o.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const a=xi(t,o);if(!a)return;go({transaction:s,environment:i,collectionContextStore:o,isFullScreen:r,groupsPointer:t,insertAtIndex:a.state.findIndex((e=>e===l))+1,from:"board_group_enter_add_item",transient:!0,useCrdt:(0,Co.dy)({source:"collection_non_table_view"})})}function ki(e,t,o,r,i){const n=t.collectionStore(),s=e.getTitleStore();if(!s)return;if(So.QaF(s.getValue()))Y.Ys({environment:i,store:e});else if(n){const n=xi(r,t);if(!n)return;const s=n.state.findIndex((t=>t===e))-1,l=t.collectionViewStore(),a=t.collectionViewBlockStore();if(l&&a&&L.sG(i,{...(0,he.Pn)(t),block_id:o.id}),ee.createAndCommit({userAction:"BoardGroupResults.handleItemTextEsc",environment:i,perform:t=>{Z.Od({store:e,transaction:t})}}),s>=0){const e=n.state[s];Y.Ys({environment:i,store:e})}}}function _i(e,t,o,r,i){const n=Boolean(e.collection_group_by),s=t?mi:ui,l=t?Si:pi;return{flex:"none",paddingLeft:s,paddingRight:s,paddingBottom:s,marginRight:2*hi,boxSizing:"content-box",width:vi(e),height:n?void 0:"max-content",...i&&r&&{backgroundColor:o?i.peekBackgroundColor:i.backgroundColor,...n?{borderRadius:l}:{borderBottomLeftRadius:l,borderBottomRightRadius:l}}}}var Ti=o(68500);const Oi=28,Vi=4,Pi=(0,B.defineMessages)({iconAriaLabel:{defaultMessage:"Add a group",id:"database.collectionAddGroupButton.ariaLabel"}});function Ri(e){let{type:t,style:o,groupBy:r,currentGroups:n,schema:s,groupsLimitStore:l,collectionContextStore:c,parentStore:p,onAccept:h,paddingLeft:m,stickyLeft:S}=e;const g=(0,a.O7)(),C=(0,u.Fg)(),f=(0,d.qz)(void 0,mo.Z),y=s[r.property],v=(0,d.VK)((()=>(0,we.II)({environment:g,groupFormat:void 0,schema:s,format:c.normalizedFormatStore.state,theme:C,useDarkerColors:c.isInHomeWidget.state})),[c,g,s,C]),x=(0,u.yK)((e=>({plusIcon:{fill:e.mediumTextColor},iconButton:{width:35,background:null==v?void 0:v.backgroundColor,paddingLeft:10,paddingRight:10,paddingTop:ui,paddingBottom:ui,marginRight:hi,borderRadius:pi,height:33,...o}})),[v,o]),w=(0,i.useCallback)((e=>{!function(e){let{schema:t,groupBy:o,currentGroups:r,groupsLimitStore:i,collectionContextStore:n,onAccept:s,environment:l,buttonPopupStore:a,update:c}=e;const{newGroupValue:d}=c,u=t[o.property],p=i.state;if(!u||!(0,re.LG)(u))return;if(E.wd({environment:l,collectionContextStore:n,action:"board_add_group"}),a.reset(),fe.cu(u)){if(u.type!==d.type)return;if(void 0===d.value)return;const e=u.options||[],i={id:(0,uo.ZP)(),value:d.value,color:(0,fe.TL)(e)},n=[...e,i],l={...u,options:n},a={...t,[o.property]:l},c={property:o.property,value:d,hidden:!1};return void s({newGroups:(0,we.nr)(r,c,p),newSchema:a})}if("person"===u.type||"relation"===u.type||(0,re.HB)(u.type)){const e={property:o.property,value:d,hidden:!1};return void s({newGroups:(0,we.nr)(r,e,p),newPage:c.newPage})}if((0,re.A1)(u.type)||"status"===u.type||"number"===u.type||"created_by"===u.type||"last_edited_by"===u.type||"formula"===u.type||"checkbox"===u.type||"location"===u.type)return;(0,ut.t1)(u.type)}({schema:s,groupBy:r,currentGroups:n,groupsLimitStore:l,collectionContextStore:c,onAccept:h,environment:g,buttonPopupStore:f,update:e})}),[f,c,n,g,r,l,h,s]),k=(0,i.useCallback)((()=>{!function(e){e.reset()}(f)}),[f]),_=(0,i.useCallback)((()=>(0,b.jsx)(Ti.Z,{groupFormat:void 0,groupBy:r,currentGroups:n,schema:s,onChange:w,onClose:k,parentStore:p})),[n,r,w,k,p,s]);return y&&(0,re.LG)(y)?(0,b.jsx)(qe.ZP,{render:_,buttonPopupStore:f,popupType:g.device.isMobile?qe.Z4.SlideUp:qe.Z4.Popup,renderOrigin:e=>"default"===t?(0,b.jsx)(Qe.Z,{isLightGray:!0,icon:ie.R,style:{display:"flex",height:Oi,marginTop:12,marginBottom:Vi,width:"max-content",position:S?"sticky":void 0,left:S&&m?m:0,...o},...e,children:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Add a group",id:"database.boardView.addGroupButtonTitle"})}):(0,b.jsx)(jt.Z,{ariaLabel:ho.default.formatMessage(Pi.iconAriaLabel),icon:e=>(0,ie.R)({...e,...x.plusIcon}),style:x.iconButton,...e})}):null}const Mi=i.memo(Ri,po.Z);var ji=o(73744);class Ii extends p.default{getInitialState(){return{containerMap:new Map}}}const Fi=Ii;class Bi extends s.Z{constructor(){super(...arguments),this.element=void 0,this.scrollableAncestor=void 0,this.resizingAncestor=void 0,this.callbackQueued=!1,this.resizeObserver=new ResizeObserver((()=>{this.handleScroll()})),this.storeTypes={store:Fi},this.handleScroll=()=>{this.callbackQueued||(this.callbackQueued=!0,window.requestAnimationFrame((()=>{this.callbackQueued=!1,this.mutateDOM((()=>{!function(e){const{environment:t,container:o}=e,{device:r}=t,{store:i}=o.stores,{containerMap:n}=i.state,s=Array.from(n.keys()).sort(((e,t)=>{if(e.element&&t.element)return(0,bt.Z)(e.element,t.element);throw new Error("Element not found")})),l=new Map;for(const a of s){const{element:e,scrollableAncestor:t}=a,o=n.get(a);if(!e||!t||!o)continue;const i=Ot(a).reduce(((e,t)=>e+(l.get(t)||0)),0),s=t.getBoundingClientRect(),c=e.getBoundingClientRect(),d=s.height,u=Math.floor(s.top-c.top),p=Math.floor(s.top+d-c.top),h=Math.floor(c.height)+(a.props.isFullScreen&&!r.isSafari?wt.Z.state:0),m=Array.from(o.values()).sort(((e,t)=>{if(e.element&&t.element)return(0,bt.Z)(e.element,t.element);throw new Error("Element not found")}));let S=i,g=0;for(const r of m){if(!r.element)continue;const e=r.element.getBoundingClientRect(),t=S+e.height;r.props.position===mt.Top&&(g+=e.height);const o=_t(u,h,t,i),n=Tt(p,h,t,g);if(r.props.position===mt.Top){const e=0!==o,t=r.props.getComputedStyle?r.props.getComputedStyle(e):void 0;e?(r.element.style.transform=`translate3d(0, ${o}px, 0)`,r.element.style.bottom=""):(r.element.style.transform="",r.element.style.bottom=""),t&&Pt(r.element,t)}else if(r.props.position===mt.Bottom){const e=0!==n,t=r.props.getComputedStyle?r.props.getComputedStyle(e):void 0;if(e?(r.element.style.transform=`translate3d(0, ${n}px, 0)`,r.element.style.top=""):(r.element.style.transform="",r.element.style.top=""),t)for(const o in t)r.element.style[o]=t[o]||""}S=t}l.set(a,S)}}({environment:this.environment,container:this})}))})))},this.handleResizeThrottled=N.P2(this.handleScroll,100)}didMount(){!function(e){const{container:t,parentContainer:o}=e,r=o?o.stores.store:t.stores.store;r.state.containerMap.has(t)||r.state.containerMap.set(t,new Set),r.emit()}({container:this,parentContainer:Vt(this)}),(0,Se.Gf)(this.environment)&&this.attachEvents()}willUnmount(){!function(e){const{container:t,parentContainer:o}=e,r=o?o.stores.store:t.stores.store;r.state.containerMap.delete(t),r.emit()}({container:this,parentContainer:Vt(this)}),(0,Se.Gf)(this.environment)&&this.removeEvents(),this.element=void 0,this.scrollableAncestor=void 0}getChildContext(){return{...this.context,computedStickyContainer:this}}renderComponent(){if(this.props.children)return this.props.children}attachEvents(){const e=Vt(this),t=n.findDOMNode(this);if(t){this.element=t;const o=(0,Se.VW)(t);o&&(this.scrollableAncestor=o,e||((0,ji.lj)(o,"scroll",this.handleScroll),(0,ji.lj)(window,"resize",this.handleResizeThrottled),this.resizeObserver.observe(this.element)));const r=(0,Se.Ez)(this.element);r&&(this.resizingAncestor=r,this.resizeObserver.observe(this.resizingAncestor))}this.props.renderEmitter&&this.props.renderEmitter.addListener(this.handleScroll)}removeEvents(){this.scrollableAncestor&&((0,ji.ZV)(this.scrollableAncestor,"scroll",this.handleScroll),(0,ji.ZV)(window,"resize",this.handleResizeThrottled),this.element&&this.resizeObserver.unobserve(this.element)),this.resizingAncestor&&this.resizeObserver.unobserve(this.resizingAncestor),this.props.renderEmitter&&this.props.renderEmitter.removeListener(this.handleScroll)}}Bi.displayName="ComputedStickyContainer",Bi.contextTypes={computedStickyContainer:xt().any,...s.w},Bi.childContextTypes={computedStickyContainer:xt().any,...s.w};const Ni=Bi,Di=p.default.createClass(!1);function Li(e){let{renderGroup:t,groupFormat:o,groupsDisplayState:r,disabled:n,groupsFormatKey:s,groupAggregationKey:l,format:c,schema:u,collectionContextStore:p,onGroupHeaderAddItem:h,renderHeader:m,getGroupStyle:S,stickyLeft:g,ignoreAncestorStickyContainer:C,paddingLeft:f,isFullScreen:y,index:v,isRootChild:x,isInPeekRenderer:w,groupBy:k,isLast:_}=e;const T=(0,a.O7)();(0,i.useEffect)((()=>{Z.V$({environment:T,collectionContextStore:p,groupFormat:o})}),[]);const O=(0,d.qz)(void 0,Di),[V,P,R,M,j,I]=(0,d.VK)((()=>{const e=p.groupsStore.getGroupState(o),i=e?e.toggleStateStore:null,a=!!i&&i.state?t(o):null,d={groupFormat:o,currentGroups:r.currentGroups,disabled:n,groupsFormatKey:s,groupAggregationKey:l,format:c,schema:u,collectionContextStore:p,isFullScreen:y,isInPeekRenderer:w,onGroupHeaderAddItem:h,stickyLeft:g,index:v,paddingLeft:f,isRootChild:x,groupBy:k,isGroupHoveredStore:O},C=m?m(d):(0,b.jsx)(Nt,{...d});return[e,i,p.renderEmitter,S&&i?S({groupFormat:o,...r,index:v,isLast:_,toggleStateStore:i}):void 0,a,C]}),[p,n,c,S,l,k,o,r,s,v,y,w,_,x,h,f,t,m,u,g,O]),F=(0,i.useCallback)((()=>{O.setState(!0)}),[O]),B=(0,i.useCallback)((()=>{O.setState(!1)}),[O]);return V&&P?(0,b.jsx)(Ni,{ignoreAncestorContainer:C,renderEmitter:R,isFullScreen:y,children:(0,b.jsxs)("div",{style:{width:"100%",position:"relative",...M},onMouseEnter:F,onMouseLeave:B,children:[I,j]})}):null}Li.displayName="CollectionGroup";const Ei=i.memo(Li),Ai=30,Hi=4;function Zi(e){let{type:t,visibleGroups:o,hiddenGroups:r,total:i,groupsLimitStore:n,schema:s,collectionContextStore:l,style:c}=e;const p=(0,a.O7)(),h=(0,u.Fg)(),m=(0,d.VK)((()=>l.normalizedFormatStore.state),[l]),S=(0,d.VK)((()=>qt({collectionContextStore:l,isForColumnGroups:"board"===t})),[l,t]),g=(0,d.VK)((()=>"board"===t?(0,we.II)({environment:p,groupFormat:void 0,schema:s,format:m,theme:h,useDarkerColors:l.isInHomeWidget.state}):void 0),[l,p,m,s,h,t]),C=(0,u.yK)((e=>({hovered:{background:e.whiteButtonBackground},dots:{width:14,fill:e.mediumTextColor,marginLeft:4,marginTop:1,..."default"===t?{marginRight:8}:{}},..."board"===t?{button:{background:null==g?void 0:g.backgroundColor,color:e.mediumTextColor,fontWeight:D.Z.fontWeight.medium,paddingLeft:8,paddingRight:8,height:33,marginRight:2*hi,borderRadius:pi,width:90,...c}}:{}})),[g,c,t]),f=Math.min(we.kW,i-r.length-o.length);return"default"===t?(0,b.jsxs)(Qe.Z,{onClick:()=>function(e,t,o){o.setState(o.state+we.kW),t.loadingDetails.setState({type:"load_more_groups"}),E.tf(e)}(p,l,n),onMouseDown:me.$0,disabled:S,hoveredStyle:S?C.hovered:{},style:{display:"flex",alignItems:"center",fontSize:14,borderRadius:4,height:Ai,marginTop:Hi,marginBottom:Hi,paddingLeft:2,paddingTop:2,paddingBottom:2,paddingRight:8,...c},children:[(0,ue.o)(C.dots),(0,b.jsx)(B.FormattedMessage,{id:"database.groups.loadMoreButtonDefault.text",defaultMessage:"Show {loadMoreAmount, plural, one {{loadMoreAmount} more group} other {{loadMoreAmount} more groups}}",values:{loadMoreAmount:f}}),S&&(0,b.jsx)("div",{style:{marginTop:1,marginLeft:8},children:(0,b.jsx)(Ge.Z,{style:{width:12,height:12}})})]}):(0,b.jsxs)(Qe.Z,{onClick:()=>function(e,t,o){o.setState(o.state+we.kW),t.loadingDetails.setState({type:"load_more_columns"}),E.tf(e)}(p,l,n),onMouseDown:me.$0,disabled:S,hoveredStyle:S?C.hovered:{},style:C.button,children:[(0,b.jsx)("span",{style:{flexGrow:1},children:(0,b.jsx)(B.FormattedMessage,{id:"database.groups.loadMoreButton.text",defaultMessage:"{loadMoreAmount} more",values:{loadMoreAmount:f}})}),S?(0,b.jsx)("div",{style:{marginLeft:4},children:(0,b.jsx)(Ge.Z,{style:{width:12,height:12}})}):(0,ue.o)(C.dots)]})}const zi=i.memo(Zi,po.Z);var Gi=o(42853);const Ki=30,Ui=4;function Wi(e){const t=(0,d.VK)((()=>e.hiddenGroupsVisible.state),[e.hiddenGroupsVisible]);return(0,b.jsx)(Qe.Z,{onClick:function(){e.hiddenGroupsVisible.setState(!e.hiddenGroupsVisible.state)},onMouseDown:me.$0,style:{height:Ki,marginBottom:Ui,...e.style},icon:e=>(0,Gi.i)({...e,...t&&{transform:"rotate(180deg)"}}),isLightGray:!0,children:(0,b.jsx)(B.FormattedMessage,{id:"collectionHiddenGroupsButton.hiddenGroupsButton.text",defaultMessage:"{numberOfHiddenGroups, plural, one {{numberOfHiddenGroups} hidden group} other {{numberOfHiddenGroups} hidden groups}}",values:{numberOfHiddenGroups:e.hiddenGroups.length}})})}const $i=(0,x.IU)("collectionGroupAccordion",{svg:(0,b.jsx)("path",{d:"M6.741 0a1 1 0 01.875 1.485l-2.742 4.94a1 1 0 01-1.748 0L.384 1.485A1 1 0 011.26 0h5.48z"}),viewBox:"0 0 8 7"});function qi(e){const t=e.minHeight||us,o=(0,u.yK)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:4,background:e.largeShimmerColor,minHeight:t}})),[t]);return(0,b.jsx)(Nr.Z,{style:o.card})}function Qi(e){const{width:t}=e,o=(0,a.O7)(),r=(0,d.VK)((()=>o.WindowSizeStore.state.width<=ds),[o]),i=(0,u.yK)((e=>({container:{display:"flex",flexDirection:"column",alignItems:"flexStart",alignSelf:"stretch",paddingBottom:12,height:t},groupContainer:{display:"flex",height:46,alignItems:"center",alignSelf:"stretch"},itemsContainer:{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${r?"100%":`${t}px`}, 1fr))`,gap:16,paddingTop:1,paddingBottom:4,width:"100%",height:"100%"},iconContainer:{display:"flex",width:22,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,marginLeft:8,borderRadius:12,backgroundColor:e.lightDividerColor}})),[t,r]);return(0,b.jsxs)("div",{style:i.container,children:[(0,b.jsxs)("div",{style:i.groupContainer,children:[(0,b.jsx)("div",{style:i.iconContainer,children:$i(i.icon)}),(0,b.jsx)(Nr.Z,{style:i.groupShimmer})]}),(0,b.jsxs)("div",{style:i.itemsContainer,children:[(0,b.jsx)(qi,{}),(0,b.jsx)(qi,{}),(0,b.jsx)(qi,{})]})]})}function Yi(e){const{isFullScreen:t,galleryCoverSize:o}=e,r=t?2:1,i=(0,ce.rD)(o),n=N.DZ(r,(e=>(0,b.jsx)(Qi,{width:i},e)));return(0,b.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:n})}function Xi(){const e=(0,u.yK)((e=>({container:{padding:"8px 0px",width:"100%"},groupContainer:{display:"flex",height:36,paddingRight:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",paddingLeft:16,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},rowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch",borderBottom:`1px solid ${e.regularDividerColor}`},lastRowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor},circleShimmer:{width:16,height:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:100,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:60,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerLong:{width:200,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},firstColumn:{display:"flex",width:360,height:34,padding:"7px 8px",alignItems:"center",gap:6},column:{display:"flex",width:200,height:34,padding:"6px 8px",alignItems:"center",gap:6}})),[]);return(0,b.jsxs)("div",{style:e.container,children:[(0,b.jsxs)("div",{style:e.groupContainer,children:[(0,b.jsx)("div",{style:e.iconContainer,children:$i(e.icon)}),(0,b.jsx)(Nr.Z,{style:e.groupShimmer})]}),(0,b.jsxs)("div",{style:e.rowsContainer,children:[(0,b.jsxs)("div",{style:e.rowContainer,children:[(0,b.jsxs)("div",{style:e.firstColumn,children:[(0,b.jsx)(Nr.Z,{style:e.circleShimmer}),(0,b.jsx)(Nr.Z,{style:e.rowShimmerShort})]}),(0,b.jsx)("div",{style:e.column,children:(0,b.jsx)(Nr.Z,{style:e.rowShimmerShort})}),(0,b.jsx)("div",{style:e.column,children:(0,b.jsx)(Nr.Z,{style:e.rowShimmerShort})}),(0,b.jsx)("div",{style:e.column,children:(0,b.jsx)(Nr.Z,{style:e.rowShimmerShort})})]}),(0,b.jsxs)("div",{style:e.rowContainer,children:[(0,b.jsxs)("div",{style:e.firstColumn,children:[(0,b.jsx)(Nr.Z,{style:e.circleShimmer}),(0,b.jsx)(Nr.Z,{style:e.rowShimmerLong})]}),(0,b.jsx)("div",{style:e.column,children:(0,b.jsx)(Nr.Z,{style:e.rowShimmer})}),(0,b.jsx)("div",{style:e.column,children:(0,b.jsx)(Nr.Z,{style:e.rowShimmer})}),(0,b.jsx)("div",{style:e.column,children:(0,b.jsx)(Nr.Z,{style:e.rowShimmer})})]}),(0,b.jsxs)("div",{style:e.lastRowContainer,children:[(0,b.jsxs)("div",{style:e.firstColumn,children:[(0,b.jsx)(Nr.Z,{style:e.circleShimmer}),(0,b.jsx)(Nr.Z,{style:e.rowShimmerLong})]}),(0,b.jsx)("div",{style:e.column,children:(0,b.jsx)(Nr.Z,{style:e.rowShimmer})}),(0,b.jsx)("div",{style:e.column,children:(0,b.jsx)(Nr.Z,{style:e.rowShimmer})}),(0,b.jsx)("div",{style:e.column,children:(0,b.jsx)(Nr.Z,{style:e.rowShimmer})})]})]})]})}function Ji(e){const{isFullScreen:t}=e,o=t?2:1,r=N.DZ(o,(e=>(0,b.jsx)(Xi,{},e)));return(0,b.jsx)("div",{style:{display:"flex",paddingTop:8,paddingLeft:4,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",width:"100%"},children:r})}function en(){const e=(0,u.yK)((e=>({rowsContainer:{paddingTop:8},rowContainer:{display:"flex",height:28,alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0"},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:"50%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor}})),[]);return(0,b.jsxs)("div",{style:e.rowsContainer,children:[(0,b.jsx)("div",{style:e.rowContainer,children:(0,b.jsx)(Nr.Z,{style:e.rowShimmerShort})}),(0,b.jsx)("div",{style:e.rowContainer,children:(0,b.jsx)(Nr.Z,{style:e.rowShimmer})})]})}var tn=o(66890);function on(e){const{widthPercentage:t}=e,o=(0,tn.DK)(),r=(0,d.VK)((()=>null==o?void 0:o.isCompactView.state),[o]),i=(0,u.yK)((e=>({rowContainer:{display:"flex",height:30,alignItems:"center",gap:1,alignSelf:"stretch"},circleShimmer:{width:r?12:16,height:r?12:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:t||"35%",height:10,flexShrink:0,borderRadius:12,marginLeft:2,backgroundColor:e.lightDividerColor},column:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,flex:"1 0 0"}})),[t,r]);return(0,b.jsx)("div",{style:i.rowContainer,children:(0,b.jsxs)("div",{style:i.column,children:[(0,b.jsx)(Nr.Z,{style:i.circleShimmer}),(0,b.jsx)(Nr.Z,{style:i.rowShimmer})]})})}function rn(){const e=(0,u.yK)((e=>({container:{display:"flex",padding:"8px 0px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},groupContainer:{display:"flex",height:36,paddingRight:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor}})),[]),t=["50%","30%","40%"].map(((e,t)=>(0,b.jsx)(on,{widthPercentage:e},t)));return(0,b.jsxs)("div",{style:e.container,children:[(0,b.jsxs)("div",{style:e.groupContainer,children:[(0,b.jsx)("div",{style:e.iconContainer,children:$i(e.icon)}),(0,b.jsx)(Nr.Z,{style:e.groupShimmer})]}),(0,b.jsx)("div",{style:e.rowsContainer,children:t})]})}function nn(e){const{isFullScreen:t}=e,o=t?2:1,r=N.DZ(o,(e=>(0,b.jsx)(rn,{},e)));return(0,b.jsx)("div",{style:{display:"flex",padding:"8px 4px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},children:r})}function sn(e){const{viewType:t,isFullScreen:o,galleryCoverSize:r}=e;if(!(0,Br.Z)(!0,0,100))return null;switch(t){case"table":return(0,b.jsx)(Ji,{isFullScreen:o});case"list":return(0,b.jsx)(nn,{isFullScreen:o});case"gallery":return(0,b.jsx)(Yi,{isFullScreen:o,galleryCoverSize:r});case"timeline":return(0,b.jsx)(en,{});default:return null}}class ln extends s.Z{constructor(){super(...arguments),this.storeTypes={reducerResultStore:p.default.createClass(void 0),hiddenGroupsVisible:p.default.createClass(!1)},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderGroup=(e,t,o)=>(0,b.jsx)(hn,{renderGroup:this.props.renderGroup,disabled:this.props.disabled,groupsFormatKey:this.props.groupsFormatKey,groupAggregationKey:this.props.groupAggregationKey,format:this.props.format,schema:this.props.schema,collectionContextStore:this.props.collectionContextStore,isFullScreen:this.props.isFullScreen,onGroupHeaderAddItem:this.props.onGroupHeaderAddItem,renderHeader:this.props.renderHeader,getGroupStyle:this.props.getGroupStyle,stickyLeft:this.props.stickyLeft,ignoreAncestorStickyContainer:this.props.ignoreAncestorStickyContainer,paddingLeft:this.props.paddingLeft,isRootChild:this.props.isRootChild,groupBy:this.props.groupBy,isInPeekRenderer:this.props.isInPeekRenderer,groupsDisplayStateStore:this.groupsDisplayStateStore,groupFormat:e,index:t,allGroups:o}),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleGroupsChange=()=>function(e,t,o,r,i){const n=i.state.currentGroups;if(""!==r.searchQuery.state)return;if((0,ao.yU)(r))return;Z.$D({environment:e,format:t,groupsFormatKey:o,collectionContextStore:r,currentGroups:n})}(this.environment,this.props.format,this.props.groupsFormatKey,this.props.collectionContextStore,this.groupsDisplayStateStore),this.handleGroupsChangeDebounced=N.Ds(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleGroupsChange,5e3),this.reducerStore=this.createComputedStore((()=>{const{groupBy:e,disableReducerRequest:t,schema:o,format:r,groupsFormatKey:i,collectionContextStore:n}=this.props,s=n.remoteRequestStore.state;if(t)return;const l=co.default.checkGate("use_collection_reducer_request_hook")?(0,ao.ze)(n,!0):null==s?void 0:s.loader.filter;return(0,we.ej)({groupBy:e,schema:o,format:r,filter:l,groupsFormatKey:i,limit:n.groupsLimit.state})})),this.schemaGroupsStore=this.createComputedStore((()=>{const{schema:e,groupBy:t}=this.props;return(0,re.Qq)({schema:e,groupBy:t})}),!0),this.groupsDisplayStateStore=this.createComputedStore((()=>{var e;const{groupBy:t,groupsFormatKey:o,format:r,schema:i,collectionContextStore:n}=this.props,s=n.groupsLimit.state,l=n.collectionViewBlockStore();if(!l)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const a=this.schemaGroupsStore.state,c=this.stores.reducerResultStore.state,d=c?c.results:void 0,u=c?c.total:0,p=(0,we.Cz)({groupBy:t,schema:i,formatGroups:r[o]||[],schemaGroups:a,reducerResults:d,getRecordModel:l.getRecordModel,relativeVariableResult:n.relativeVariableStore.state,viewAppConfigUri:null===(e=n.collectionViewStore())||void 0===e?void 0:e.getFormat().app_config_uri,allowedCollectionStores:n.collectionStoresStore.state}),h=p.filter((e=>!(0,re.eF)(e))).slice(0,s),m=p.filter((e=>(0,re.eF)(e)));return{currentGroups:[...h,...m],visibleGroups:h,hiddenGroups:m,total:u}}),!0)}UNSAFE_willMount(e){const{disableReducerRequest:t}=this.props;t||this.groupsDisplayStateStore.addListener(this.handleGroupsChangeDebounced)}willUnmount(){this.groupsDisplayStateStore.removeListener(this.handleGroupsChangeDebounced),this.handleGroupsChangeDebounced.cancel()}renderComponent(){const e=this.reducerStore.state,t=this.groupsDisplayStateStore.state;return e?(0,b.jsx)(ze.Z,{id:this.props.id,reducer:e,collectionContextStore:this.props.collectionContextStore,resultStore:this.stores.reducerResultStore,render:()=>(0,b.jsx)(Sn,{disabled:this.props.disabled,collectionContextStore:this.props.collectionContextStore,groupBy:this.props.groupBy,isFullScreen:this.props.isFullScreen,shouldSurpressShimmer:this.props.shouldSurpressShimmer,format:this.props.format,renderGroupsLoadMoreButton:this.props.renderGroupsLoadMoreButton,schema:this.props.schema,renderGroup:this.props.renderGroup,groupsFormatKey:this.props.groupsFormatKey,groupAggregationKey:this.props.groupAggregationKey,onGroupHeaderAddItem:this.props.onGroupHeaderAddItem,renderHeader:this.props.renderHeader,getGroupStyle:this.props.getGroupStyle,stickyLeft:this.props.stickyLeft,ignoreAncestorStickyContainer:this.props.ignoreAncestorStickyContainer,paddingLeft:this.props.paddingLeft,isRootChild:this.props.isRootChild,isInPeekRenderer:this.props.isInPeekRenderer,renderHiddenGroupsButton:this.props.renderHiddenGroupsButton,renderAddGroupButton:this.props.renderAddGroupButton,store:this.props.store,hiddenGroupsVisibleStore:this.stores.hiddenGroupsVisible,groupsDisplayStateStore:this.groupsDisplayStateStore,displayState:t})}):(0,b.jsx)(Sn,{disabled:this.props.disabled,collectionContextStore:this.props.collectionContextStore,groupBy:this.props.groupBy,isFullScreen:this.props.isFullScreen,shouldSurpressShimmer:this.props.shouldSurpressShimmer,format:this.props.format,renderGroupsLoadMoreButton:this.props.renderGroupsLoadMoreButton,schema:this.props.schema,renderGroup:this.props.renderGroup,groupsFormatKey:this.props.groupsFormatKey,groupAggregationKey:this.props.groupAggregationKey,onGroupHeaderAddItem:this.props.onGroupHeaderAddItem,renderHeader:this.props.renderHeader,getGroupStyle:this.props.getGroupStyle,stickyLeft:this.props.stickyLeft,ignoreAncestorStickyContainer:this.props.ignoreAncestorStickyContainer,paddingLeft:this.props.paddingLeft,isRootChild:this.props.isRootChild,isInPeekRenderer:this.props.isInPeekRenderer,renderHiddenGroupsButton:this.props.renderHiddenGroupsButton,renderAddGroupButton:this.props.renderAddGroupButton,store:this.props.store,hiddenGroupsVisibleStore:this.stores.hiddenGroupsVisible,groupsDisplayStateStore:this.groupsDisplayStateStore,displayState:t})}}ln.displayName="CollectionGroups";const an=ln;function cn(e){let{displayState:t,loadMoreButtonOverride:o,collectionContextStore:r,schema:i,style:n}=e;const{groupsLimit:s}=r;return o?(0,b.jsx)(b.Fragment,{children:o}):(0,b.jsx)("div",{style:{display:"flex"},children:(0,b.jsx)(zi,{visibleGroups:t.visibleGroups,hiddenGroups:t.hiddenGroups,total:t.total,groupsLimitStore:s,type:"default",schema:i,collectionContextStore:r,style:n})})}function dn(e,t,o,r,i,n){const s=o.collectionStore();s&&Z.tH({update:e,collectionContextStore:o,groupsFormatKey:r,collectionStore:s,environment:t,groupBy:i,schema:n})}function un(e){let{hiddenGroups:t,renderHiddenGroupsButton:o,stickyLeft:r,paddingLeft:i,hiddenGroupsVisibleStore:n}=e;return o?(0,b.jsx)(b.Fragment,{children:o({hiddenGroupsVisible:n,hiddenGroups:t})}):(0,b.jsx)("div",{style:{display:"flex"},children:(0,b.jsx)(Wi,{style:{marginTop:10,...r?{position:"sticky",left:i}:{}},hiddenGroupsVisible:n,hiddenGroups:t})})}function pn(e){let{schema:t,groupBy:o,renderAddGroupButton:r,collectionContextStore:i,paddingLeft:n,groupsFormatKey:s,store:l,currentGroups:c}=e;const u=(0,a.O7)(),p=(0,d.VK)((()=>i.groupsLimit),[i]);return r?(0,b.jsx)(b.Fragment,{children:r({groupBy:o,schema:t,currentGroups:c,onAccept:e=>dn(e,u,i,s,o,t),groupsLimitStore:p,parentStore:l,type:"default",collectionContextStore:i})}):(0,b.jsx)(Mi,{groupBy:o,schema:t,currentGroups:c,onAccept:e=>dn(e,u,i,s,o,t),groupsLimitStore:p,parentStore:l,type:"default",collectionContextStore:i,paddingLeft:n,stickyLeft:!0})}function hn(e){let{groupFormat:t,index:o,allGroups:r,renderGroup:i,disabled:n,groupsFormatKey:s,groupAggregationKey:l,format:a,schema:c,collectionContextStore:u,isFullScreen:p,onGroupHeaderAddItem:h,renderHeader:m,getGroupStyle:S,stickyLeft:g,ignoreAncestorStickyContainer:C,paddingLeft:f,isRootChild:y,groupBy:v,isInPeekRenderer:x,groupsDisplayStateStore:w}=e;const k=o===r.length-1,_=(0,d.VK)((()=>u.groupsStore.getGroupState(t)),[u,t]),T=(0,d.VK)((()=>w.state),[w]);return _&&T?(0,b.jsx)(Ei,{groupBy:v,groupFormat:t,groupsDisplayState:T,disabled:n,groupsFormatKey:s,groupAggregationKey:l,format:a,schema:c,collectionContextStore:u,isFullScreen:p,isRootChild:y,renderGroup:i,onGroupHeaderAddItem:h,renderHeader:m,getGroupStyle:S,stickyLeft:g,ignoreAncestorStickyContainer:C,paddingLeft:f,index:o,isLast:k,isInPeekRenderer:x},(0,re.mD)(t)):null}function mn(e){let{groups:t,renderGroup:o,disabled:r,groupsFormatKey:n,groupAggregationKey:s,format:l,schema:a,collectionContextStore:c,isFullScreen:d,onGroupHeaderAddItem:u,renderHeader:p,getGroupStyle:h,stickyLeft:m,ignoreAncestorStickyContainer:S,paddingLeft:g,isRootChild:C,groupBy:f,isInPeekRenderer:y,groupsDisplayStateStore:v}=e;const x=(0,i.useCallback)(((e,t,i)=>(0,b.jsx)(hn,{renderGroup:o,disabled:r,groupsFormatKey:n,groupAggregationKey:s,format:l,schema:a,collectionContextStore:c,isFullScreen:d,onGroupHeaderAddItem:u,renderHeader:p,getGroupStyle:h,stickyLeft:m,ignoreAncestorStickyContainer:S,paddingLeft:g,isRootChild:C,groupBy:f,isInPeekRenderer:y,groupsDisplayStateStore:v,groupFormat:e,index:t,allGroups:i})),[o,r,n,s,l,a,c,d,u,p,h,m,S,g,C,f,y,v]);return(0,b.jsx)(b.Fragment,{children:t.map(x)})}function Sn(e){let{displayState:t,disabled:o,collectionContextStore:r,groupBy:i,isFullScreen:n,shouldSurpressShimmer:s,format:l,renderGroupsLoadMoreButton:a,schema:c,renderGroup:u,groupsFormatKey:p,groupAggregationKey:h,onGroupHeaderAddItem:m,renderHeader:S,getGroupStyle:g,stickyLeft:C,ignoreAncestorStickyContainer:f,paddingLeft:y,isRootChild:v,isInPeekRenderer:x,renderHiddenGroupsButton:w,renderAddGroupButton:k,store:_,hiddenGroupsVisibleStore:T,groupsDisplayStateStore:O}=e;const{visibleGroups:V,hiddenGroups:P,total:R}=t,M=P.slice(0,we.ew),j=(0,d.VK)((()=>O.state),[O]),I=(0,d.VK)((()=>r.groupsLimit),[r]),F=(0,d.VK)((()=>I.state),[I]),B=(0,d.VK)((()=>r.permissionScopes.state),[r]),N=(0,d.VK)((()=>!s&&$t({collectionContextStore:r,displayState:t})),[r,t,s]),D=(0,d.VK)((()=>{var e;return null===(e=r.collectionViewStore())||void 0===e?void 0:e.getType()}),[r]),L=(0,d.VK)((()=>0===V.length&&!r.shouldShowSpinner.state||V.length>0),[V,r]),E=(0,d.VK)((()=>F<R-P.length&&L||qt({collectionContextStore:r,isForColumnGroups:!1})),[F,R,P,L,r]),A=(0,d.VK)((()=>r.contextType),[r]),H=!o&&!B.isLocked&&B.canConfigureBlock&&!N&&(0,re.Wz)(i,B.canConfigureCollection)&&"collectionTypedView"!==A&&!(0,lo.w)(i.property)&&L,Z=(0,d.VK)((()=>null==a?void 0:a({visibleGroups:t.visibleGroups,hiddenGroups:t.hiddenGroups,total:t.total,groupsLimitStore:I,type:"default",schema:c,collectionContextStore:r})),[t,a,I,c,r]),{currentGroups:z=[]}=j??{},G=(0,d.VK)((()=>T.state),[T]);return(0,b.jsxs)("div",{style:{position:"relative"},children:[(0,b.jsx)(mn,{renderGroup:u,disabled:o,groupsFormatKey:p,groupAggregationKey:h,format:l,schema:c,collectionContextStore:r,isFullScreen:n,onGroupHeaderAddItem:m,renderHeader:S,getGroupStyle:g,stickyLeft:C,ignoreAncestorStickyContainer:f,paddingLeft:y,isRootChild:v,groupBy:i,isInPeekRenderer:x,groupsDisplayStateStore:O,groups:t.visibleGroups}),N&&(0,b.jsx)(sn,{viewType:D,isFullScreen:n,galleryCoverSize:l.gallery_cover_size}),E&&(0,b.jsx)(cn,{loadMoreButtonOverride:Z,collectionContextStore:r,schema:c,displayState:t,style:C?{position:"sticky",left:y}:void 0}),M.length>0&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(un,{renderHiddenGroupsButton:w,stickyLeft:C,paddingLeft:y,hiddenGroupsVisibleStore:T,hiddenGroups:M}),G&&(0,b.jsx)(mn,{renderGroup:u,disabled:o,groupsFormatKey:p,groupAggregationKey:h,format:l,schema:c,collectionContextStore:r,isFullScreen:n,onGroupHeaderAddItem:m,renderHeader:S,getGroupStyle:g,stickyLeft:C,ignoreAncestorStickyContainer:f,paddingLeft:y,isRootChild:v,groupBy:i,isInPeekRenderer:x,groupsDisplayStateStore:O,groups:M})]}),H&&(0,b.jsx)(pn,{schema:c,groupBy:i,renderAddGroupButton:k,collectionContextStore:r,paddingLeft:y,groupsFormatKey:p,store:_,currentGroups:z})]})}class gn extends p.default{getInitialState(){return!1}}const Cn=gn;class fn extends p.default{getInitialState(){}}const yn=fn;var vn=o(51592),xn=o(66213);const bn=function(e){let{aggregation:t,schema:o,groupFormat:r,collectionContextStore:i,disabled:n,color:s,onChange:l}=e;const c=(0,u.Fg)(),d=(0,a.O7)(),{device:p}=d;return(0,b.jsx)(Xe.ZP,{renderTooltip:()=>(0,b.jsx)(wn,{aggregation:t,schema:o,collectionContextStore:i}),render:e=>(0,b.jsx)(qe.ZP,{popupType:p.isMobile?qe.Z4.SlideUp:qe.Z4.Popup,renderOrigin:l=>(0,b.jsx)(Qe.Z,{disabled:n,style:{fontWeight:D.Z.fontWeight.regular,color:s||c.lightTextColor,paddingTop:4,paddingBottom:4,height:void 0,lineHeight:void 0},...(0,Ze.Z)(e,l),children:(0,b.jsx)(Rn,{schema:o,aggregation:t,collectionContextStore:i,groupFormat:r})}),disabled:n,render:e=>(0,b.jsx)(Pn,{parent:e,onChange:l,collectionContextStore:i,schema:o})})})};function wn(e){let{aggregation:t,schema:o,collectionContextStore:r}=e;const i=(0,d.VK)((()=>!!t&&Ke(r,t)),[r,t]);if(t){const e=He.VN[(0,De.OV)(t)];if((0,De.pK)(t)){const r=o[t.property];if(r){const t=r.name;return(0,b.jsx)(b.Fragment,{children:ho.default.formatMessage(We.propertyAggregation,{aggregationType:e,propertyName:t,calculating:i})})}}return(0,b.jsx)(b.Fragment,{children:ho.default.formatMessage(We.aggregationType,{aggregationType:e,calculating:i})})}return(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Aggregate",id:"database.boardAggregation.tooltip"})}function kn(e){let{aggregationType:t,label:o,props:r}=e;const i=He.Sn[t];return(0,b.jsx)(Xe.ZP,{placement:Ye.GI.Placement.Right,delayThreshold:0,render:e=>(0,b.jsx)($e.Z,{title:o,...(0,Ze.Z)(e,r)}),renderTooltip:()=>(0,b.jsxs)("div",{style:{width:140,whiteSpace:"normal"},children:[i&&(0,b.jsx)("img",{src:(0,Ae.D)(i),style:{borderRadius:4,width:140,marginTop:4}}),He.BG[t]]})})}function _n(e,t,o,r){o.isLoading.state||o.loadingDetails.setState({type:"load_aggregation"}),o.isClientModeEnabled.state||o.asyncAggregationStatus.setState({calculating:!0,aggregation:e,changingType:!0}),t(e),E.wd({environment:r,collectionContextStore:o,action:"board_change_aggregation"}),Ut.j({name:"collection_change_aggregation"})}function Tn(e,t,o,r){const i=He.VN[e];return{key:e,render:t=>(0,b.jsx)(kn,{aggregationType:e,label:i,props:t}),action:()=>{_n({aggregator:e},t,o,r)}}}function On(e,t,o,r,i,n){const{device:s}=o,l=He.VN[e],a=N.oA(t.map((t=>function(e,t,o,r,i,n){const s=o[e];if(!s)return;const l=s.name;return{key:`${e} ${t}`,render:e=>(0,b.jsx)(kn,{aggregationType:t,label:l,props:e}),action:()=>{_n({aggregator:t,property:e},r,i,n)}}}(t,e,r,i,n,o))));return{key:e+l,render:(e,t)=>(0,b.jsx)(Je.Z,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,b.jsx)($e.Z,{...e,ref:t,title:l}),renderExtension:(e,o)=>{let r;return r=s.isMobile?{menuType:ke.og.Modal,title:l,right:(0,b.jsx)(Ve.DoneMenuText,{}),onClickRight:o.close,...e}:{menuType:ke.og.Popup,width:200,...e},(0,b.jsx)(Te.Z,{...r,children:(0,b.jsx)(Oe.Z,{type:Oe.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,b.jsx)(Pe.Z,{...e}),items:a}],onAccept:t.onAccept})})}}),action:()=>null}}function Vn(e,t,o,r){const i=[];for(const c of De.o5)i.push(Tn(c,t,o,e));const n=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,De.iV)(o)&&!("rollup"===o.type&&"status"===o.target_property_type)}))}(r);if(n.length>0)for(const c of De.Sy)"show_unique"!==c&&i.push(On(c,n,e,r,t,o));const s=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,De.O4)(o)}))}(r);if(s.length>0)for(const c of De.k$)i.push(On(c,s,e,r,t,o));const l=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,De.dN)(o)}))}(r);if(l.length>0)for(const c of De.f8)i.push(On(c,l,e,r,t,o));const a=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,De.Mv)(o)}))}(r);if(a.length>0)for(const c of De.gC)i.push(On(c,a,e,r,t,o));return i}function Pn(e){let{parent:t,onChange:o,collectionContextStore:r,schema:i}=e;const n=(0,a.O7)(),{device:s}=n;let l;return l=s.isMobile?{menuType:ke.og.Modal,title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Aggregation",id:"database.mobileBoardAggregationMenu.title"}),right:(0,b.jsx)(Ve.DoneMenuText,{}),onClickRight:t.close}:{menuType:ke.og.Popup,width:200},(0,b.jsx)(Te.Z,{...l,children:(0,b.jsx)(Oe.Z,{type:Oe.i.Vertical,initialFocus:0,sections:[{key:"aggregation section",render:e=>(0,b.jsx)(Pe.Z,{...e}),items:Vn(n,o,r,i)}],onAccept:t.close})})}function Rn(e){let{schema:t,aggregation:o,collectionContextStore:r,groupFormat:i}=e;const n=(0,d.VK)((()=>{if(o){return{type:"aggregation",filter:(0,Le.zk)({schema:t,group:i,propertyMapping:void 0,timeZone:(0,Ee.r)()}),aggregation:o}}}),[o,t,i]);return o&&n?(0,b.jsx)(ze.Z,{id:`board:${(0,re.mD)(i)}`,collectionContextStore:r,reducer:n,groupsPointer:[i],render:e=>{const i=e.state;let n;if((0,De.pK)(o)){const e=t[o.property];!e||"formula"!==e.type&&"number"!==e.type||(n=e.number_format)}return(0,b.jsx)(Ue,{aggregation:o,collectionContextStore:r,children:i?(0,He.Ol)({numberFormat:n,dateFormat:void 0,aggregationType:o.aggregator,userTimeZone:(0,Ee.r)(),value:i.aggregationResult,roundDecimal:5}):"-"})}}):null}class Mn extends s.Z{constructor(){super(...arguments),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleAddItemClick=()=>En(this.environment,this.props.format,this.props.groupFormat,this.props.collectionContextStore,this.props.isFullScreen,this.context.overrideLinkClick),this.colorStore=this.createComputedStore((()=>{const{groupFormat:e,schema:t,format:o,collectionContextStore:r}=this.props;return(0,we.II)({environment:this.environment,groupFormat:e,schema:t,format:o,theme:this.theme,useDarkerColors:r.isInHomeWidget.state})})),this.isHoveredStore=this.createComputedStore((()=>!!this.environment.device.isMobile||(0,re.ZH)(this.props.hoveredGroupStore.state,this.props.groupFormat)))}renderComponent(){const{disabled:e,collectionContextStore:t}=this.props,o=t.permissionScopes.state,r=t.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0});return(0,b.jsxs)("div",{style:Nn(this.environment,this.props.hidden,this.props.format,this.props.collectionContextStore,this.props.isPopup,this.props.isInPeekRenderer,this.colorStore),onMouseMove:()=>{return e=this.props.hoveredGroupStore,t=this.props.groupFormat,void(e.state!==t&&e.setState(t));var e,t},children:[(0,b.jsx)(Bn,{boardGroupHeaderProps:this.props}),(0,b.jsx)(An,{disabled:this.props.disabled,query:this.props.query,schema:this.props.schema,collectionContextStore:this.props.collectionContextStore,groupFormat:this.props.groupFormat,hidden:this.props.hidden,colorStore:this.colorStore}),(0,b.jsx)("div",{style:{flexGrow:1}}),!e&&o.canConfigureBlock&&(0,b.jsx)(Hn,{hidden:this.props.hidden,groupFormat:this.props.groupFormat,currentGroups:this.props.currentGroups,format:this.props.format,schema:this.props.schema,collectionContextStore:this.props.collectionContextStore,colorStore:this.colorStore,isHoveredStore:this.isHoveredStore}),r&&(0,b.jsx)(Zn,{format:this.props.format,groupFormat:this.props.groupFormat,collectionContextStore:this.props.collectionContextStore,isFullScreen:this.props.isFullScreen,hidden:this.props.hidden,isHoveredStore:this.isHoveredStore,colorStore:this.colorStore,overrideLinkClick:this.context.overrideLinkClick})]})}}function jn(e){return(0,ce.rD)(e.board_cover_size)}Mn.displayName="BoardGroupHeader",Mn.contextTypes={...xn.wK,...s.w};const In=Mn;function Fn(e){let{parent:t,groupFormat:o,currentGroups:r,format:i,schema:n,collectionContextStore:s}=e;const l=s.boardColumnsLimitStore;return(0,b.jsx)(je,{parent:t,groupFormat:o,currentGroups:r,format:i,schema:n,collectionContextStore:s,groupsFormatKey:"board_columns",groupsLimitStore:l})}function Bn(e){let{boardGroupHeaderProps:t}=e;const{groupFormat:o,schema:r,disabled:i,currentGroups:n,format:s,groupBy:l,collectionContextStore:c}=t,u=(0,a.O7)(),p=jn(s),h=(0,d.VK)((()=>c.permissionScopes.state),[c]);return(0,d.VK)((()=>c.groupsStore.getGroupState(o)),[c,o])?(0,b.jsx)(dt.Z,{groupBy:l,groupFormat:o,currentGroups:n,schema:r,disabled:i||!h.canConfigureBlock,isHiddenGroup:!1,onChange:e=>function(e,t,o){const{collectionContextStore:r}=o,i=r.collectionStore();i&&(Z.w$({...e,environment:t,groupsFormatKey:"board_columns",collectionStore:i,...o}),E.wd({environment:t,collectionContextStore:r,action:"rename_group"}))}(e,u,t),style:{maxWidth:p-70},collectionContextStore:c}):null}function Nn(e,t,o,r,i,n,s){const{device:l}=e,a=jn(o),c=s.state,d=Boolean(o.collection_group_by),u=r.isCompactView.state,p=u?mi:ui,h=u?Si:pi;return{display:"flex",alignItems:"center",fontSize:14,width:a,paddingLeft:p,paddingRight:p,marginRight:2*hi,marginBottom:t?4:0,boxSizing:"content-box",flexShrink:0,...i&&{padding:l.isMobile?"6px 16px":"8px 12px 4px",width:"none",minWidth:a},...c&&!t&&{backgroundColor:n?c.peekBackgroundColor:c.backgroundColor,...d?{borderRadius:h}:{borderTopLeftRadius:h,borderTopRightRadius:h}}}}function Dn(e,t,o){const r=o.state;return!t&&r?r.textColor:e.lightTextColor}function Ln(e,t){if(!e)return{transition:"opacity 100ms ease-in-out",opacity:t.state?1:0}}function En(e,t,o,r,i,n){const{device:s}=e;if(!Ce.M_(e))return;const l="collectionTypedView"===r.contextType,a=Boolean(t.collection_group_by);r.searchQuery.state&&pe.Ug({searchQuery:"",collectionContextStore:r,isFullScreen:i});const c=r.groupsStore.getGroupState(o);if(!c)return;const d=c.resultsStore;ee.createAndCommit({userAction:"BoardGroupHeader.handleAddItemClick",environment:e,perform:t=>{const i=Z.IW({environment:e,collectionContextStore:r,groupsPointer:[o],insertAtIndex:0,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:t,from:"board_group_header"});if(!i)return;const c=i.coercionSucceeded,u=i.newStore;if(s.isMobile){!function(e,t,o){o?o(e):ae.c4({environment:t,url:e})}((0,Ko.ZP)({store:u,pageVisitSource:h.tY.Create}),e,n)}else if(c&&!a){const t=u.getBlockTitleStore();Y.eP({environment:e,store:u}),J.NX({store:t}),pe.Z5({store:u})}else le.CH({environment:e,store:u,peekMode:(0,ce.kr)(r),showMoveTo:l,resultsStore:d,collectionContextStore:r,pageVisitSource:h.tY.Create});ne.W(e,{from:"board_group_add_item_top",type:"page",new_page_id:u.id,creating_block_id:u.id,...(0,he.Pn)(r)})}})}function An(e){let{disabled:t,query:o,schema:r,collectionContextStore:i,groupFormat:n,hidden:s,colorStore:l}=e;const c=(0,u.Fg)(),p=(0,a.O7)(),h=o.aggregations?o.aggregations[0]:void 0,m=(0,d.VK)((()=>i.permissionScopes.state),[i]),S=(0,d.VK)((()=>Dn(c,s,l)),[c,s,l]);return(0,b.jsx)(bn,{groupFormat:n,disabled:t||!m.canConfigureBlock,aggregation:h,schema:r,collectionContextStore:i,color:S,onChange:e=>function(e,t,o,r){const i=t.collectionViewStore(),n={...o,aggregations:e?[e]:[]};i&&ee.createAndCommit({userAction:"BoardGroupHeader.handleAggregationChange",environment:r,perform:e=>{pe.iG({collectionViewStore:i,update:{query2:n},transaction:e})}})}(e,i,o,p)})}function Hn(e){let{hidden:t,groupFormat:o,currentGroups:r,format:i,schema:n,collectionContextStore:s,colorStore:l,isHoveredStore:c}=e;const p=(0,u.Fg)(),h=(0,a.O7)(),{device:m}=h,S=(0,d.VK)((()=>Dn(p,t,l)),[p,t,l]),g=(0,d.VK)((()=>Ln(t,c)),[t,c]);return(0,b.jsx)(qe.ZP,{popupType:m.isMobile?qe.Z4.SlideUp:qe.Z4.Popup,renderOrigin:e=>(0,b.jsx)(jt.Z,{icon:ue.o,iconStyle:{fill:S},style:g,...e}),render:e=>(0,b.jsx)(Fn,{parent:e,groupFormat:o,currentGroups:r,format:i,schema:n,collectionContextStore:s})})}function Zn(e){let{format:t,groupFormat:o,collectionContextStore:r,isFullScreen:n,hidden:s,isHoveredStore:l,colorStore:c,overrideLinkClick:p}=e;const h=(0,u.Fg)(),m=(0,a.O7)(),S=(0,i.useCallback)((()=>En(m,t,o,r,n,p)),[m,t,o,r,n,p]),g=(0,d.VK)((()=>{var e;return null===(e=r.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri}),[r]),C=(0,d.VK)((()=>Dn(h,s,c)),[h,s,c]),f=(0,d.VK)((()=>Ln(s,l)),[s,l]),y=(0,vn.sN)(g);return(0,b.jsx)(Xe.ZP,{renderTooltip:()=>(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Create new {newItemName}",values:{newItemName:y},id:"database.boardView.actions.addNewItem.tooltip"}),render:e=>(0,b.jsx)(jt.Z,{icon:ie.R,onClick:S,style:f,iconStyle:{fill:C},...e})})}function zn(e){const t=(0,d.VK)((()=>e.columnsDisplayState.visibleGroups.length*(jn(e.format)+2*ui+2*hi)),[e.columnsDisplayState.visibleGroups,e.format]);return(0,b.jsx)("div",{style:{display:"flex",minWidth:t},children:(0,b.jsx)(Wi,{...e})})}var Gn=o(4430);function Kn(e){const{format:t,isFullScreen:o,paddingLeft:r,isRootChild:i}=e,n=(0,a.O7)(),s=(0,d.VK)((()=>(0,Gn.C1)({environment:n,format:t,isFullScreen:o,isRootChild:i})),[n,t,o,i]),l=(0,d.VK)((()=>"collectionTypedView"===e.collectionContextStore.contextType),[e.collectionContextStore]),c=(0,d.VK)((()=>(0,Gn.fj)({environment:n,isRootChild:i,isFullScreen:o,format:t})?Gn.Qw:r),[n,t,o,i,r]);return s||l?null:(0,b.jsx)("div",{style:{width:"100%",height:Oi+Vi,display:"flex"},children:(0,b.jsx)(Mi,{type:"default",groupBy:e.groupBy,currentGroups:e.currentGroups,schema:e.schema,groupsLimitStore:e.groupsLimitStore,collectionContextStore:e.collectionContextStore,onAccept:e.onAccept,parentStore:e.parentStore,style:{position:"sticky",left:e.isFullScreen?c:3,width:"max-content",paddingLeft:4,paddingRight:8}})})}function Un(e){const{format:t,isFullScreen:o,isRootChild:r,paddingLeft:i}=e,n=(0,a.O7)(),s=(0,d.VK)((()=>(0,Gn.C1)({environment:n,format:t,isFullScreen:o,isRootChild:r})),[n,t,o,r]),l=(0,d.VK)((()=>(0,Gn.fj)({environment:n,isRootChild:r,isFullScreen:o,format:t})?Gn.Qw:i),[n,t,o,r,i]);return s?null:(0,b.jsx)("div",{style:{width:"100%",height:Ki+Ui,display:"flex"},children:(0,b.jsx)(Wi,{...e,style:{position:"sticky",left:o?l:3,width:"max-content",paddingLeft:4,paddingRight:8}})})}function Wn(e){const{format:t,isFullScreen:o,isRootChild:r}=e,i=(0,a.O7)(),n=(0,d.VK)((()=>(0,Gn.C1)({environment:i,format:t,isFullScreen:o,isRootChild:r})),[i,t,o,r]),s=(0,d.VK)((()=>(0,Gn.fj)({environment:i,isRootChild:r,isFullScreen:o,format:t})?Gn.Qw:e.paddingLeft),[i,t,o,r,e.paddingLeft]);return n?null:(0,b.jsx)("div",{style:{width:"100%",height:Ai+2*Hi,display:"flex"},children:(0,b.jsx)(zi,{type:"default",visibleGroups:e.visibleGroups,hiddenGroups:e.hiddenGroups,total:e.total,groupsLimitStore:e.groupsLimitStore,schema:e.schema,collectionContextStore:e.collectionContextStore,style:{position:"sticky",left:o?s:3,width:"max-content",paddingLeft:4,paddingRight:8}})})}const $n=new Set(["dropzone","table"]),qn=new Set(["item","table"]),Qn=new Set(["table"]);function Yn(e){const{collectionContextStore:t,timelineProps:o}=e,r=(0,a.O7)(),n=(0,d.VK)((()=>t.collectionViewBlockStore()),[t]),s=(0,d.VK)((()=>t.permissionScopes.state),[t.permissionScopes]),l=(0,d.VK)((()=>{var e;return null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType()}),[t]),c=(0,d.VK)((()=>t.normalizedFormatStore.state),[t.normalizedFormatStore]),u=null==c?void 0:c.app_config_uri,p=null==c?void 0:c.collection_group_by,h=null==c?void 0:c.board_columns_by,m=(0,d.VK)((()=>t.groupsLimit.state),[t]),S=(0,d.VK)((()=>t.boardColumnsLimitStore.state),[t]),g=(0,d.VK)((()=>t.normalizedSchemaStore.state),[t.normalizedSchemaStore]),C=(0,d.VK)((()=>{if(p)return(0,re.Qq)({schema:g,groupBy:p})}),[p,g]),f=(0,d.VK)((()=>t.relativeVariableStore.state),[t.relativeVariableStore]),y=(0,d.VK)((()=>t.remoteRequestStore.state),[t.remoteRequestStore]),v=(0,d.VK)((()=>{if(!p||!c)return;if(null!=o&&o.type&&$n.has(null==o?void 0:o.type))return;const e=co.default.checkGate("use_collection_reducer_request_hook")?(0,ao.ze)(t,!0):null==y?void 0:y.loader.filter;return(0,we.ej)({groupBy:p,schema:g,format:c,filter:e,groupsFormatKey:re.Uh,limit:m})}),[p,c,o,t,null==y?void 0:y.loader.filter,g,m]),x=(0,d.qz)(null==o?void 0:o.reducerResultStore,yn),w=(0,d.qz)(null==o?void 0:o.hiddenGroupsVisible,Cn),k=(0,d.VK)((()=>w.state),[w]),_=(0,d.SI)((()=>{if(!n)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const e=x.state,o=e?e.results:void 0,r=(0,we.Cz)({groupBy:p,schema:g,schemaGroups:C,formatGroups:(null==c?void 0:c[re.Uh])||[],reducerResults:o,getRecordModel:n.getRecordModel,relativeVariableResult:f,viewAppConfigUri:u,allowedCollectionStores:t.collectionStoresStore.state}),i=r.filter((e=>!(0,re.eF)(e))).slice(0,m),s=r.filter((e=>(0,re.eF)(e))),l=e?e.total:0;return{currentGroups:[...i,...s],visibleGroups:i,hiddenGroups:s,total:l}}),[n,t,c,p,m,x,f,g,C,u],{useDeepEqual:!0}),T=(0,d.Kw)(_,{debugName:"groupsDisplayState"}),O=(0,d.VK)((()=>{if(!n||!h)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const e=x.state,o=e?e.results:void 0,r=(0,we.Cz)({groupBy:p,schema:g,schemaGroups:C,formatGroups:(null==c?void 0:c.board_columns)||[],reducerResults:o,getRecordModel:n.getRecordModel,relativeVariableResult:f,viewAppConfigUri:u,allowedCollectionStores:t.collectionStoresStore.state}),i=r.filter((e=>!(0,re.eF)(e))).slice(0,S),s=r.filter((e=>(0,re.eF)(e))),l=e?e.total:0;return{currentGroups:[...i,...s],visibleGroups:i,hiddenGroups:s,total:l}}),[S,n,t,c,p,h,x,f,g,C,u],{useDeepEqual:!0}),V=i.useCallback((()=>{const e=t.normalizedFormatStore.state;if(""!==t.searchQuery.state)return;(0,ao.yU)(t)||Z.$D({environment:r,format:e,groupsFormatKey:re.Uh,collectionContextStore:t,currentGroups:_.state.currentGroups})}),[t,r,_]),P=N.Ds(V,5e3);i.useEffect((()=>{if(null==o||!o.type||!$n.has(null==o?void 0:o.type))return _.addListener(P),()=>{_.removeListener(P),P.cancel()}}),[_,P,o]);const R=(0,d.VK)((()=>_.state.hiddenGroups.slice(0,we.ew)),[_]),M=(0,d.VK)((()=>!(null!=o&&o.type&&qn.has(null==o?void 0:o.type))&&$t({collectionContextStore:t,displayState:T})),[t,T,o]),j=(0,d.VK)((()=>{const{visibleGroups:e}=T;return 0===e.length&&!t.shouldShowSpinner.state||e.length>0}),[t,T]),I=(0,d.VK)((()=>{const{total:e,hiddenGroups:o}=T;return m<e-o.length&&j||qt({collectionContextStore:t,isForColumnGroups:!1})}),[j,t,T,m]),F=(0,d.VK)((()=>!e.disabled&&!s.isLocked&&s.canConfigureBlock&&!M&&p&&(0,re.Wz)(p,s.canConfigureCollection)&&"collectionTypedView"!==t.contextType&&!(0,lo.w)(p.property)&&j),[j,t,s.canConfigureBlock,s.canConfigureCollection,s.isLocked,e.disabled,p,M]);if(!c)return null;const B=(0,b.jsxs)("div",{style:{position:"relative"},children:[(0,b.jsx)(Jn,{groups:T.visibleGroups,groupBy:p,groupsDisplayState:T,format:c,schema:g,reducerId:e.reducerId,store:e.store,collectionContextStore:e.collectionContextStore,disabled:e.disabled,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,renderGroup:e.renderGroup,getGroupStyle:e.getGroupStyle,renderHeader:e.renderHeader,onGroupHeaderAddItem:e.onGroupHeaderAddItem,timelineProps:o}),M&&(0,b.jsx)(sn,{viewType:l,isFullScreen:e.isFullScreen,galleryCoverSize:c.gallery_cover_size}),I&&(0,b.jsx)(es,{timelineType:null==o?void 0:o.type,collectionContextStore:e.collectionContextStore,schema:g,format:c,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,groupsDisplayState:T}),R.length>0&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(os,{reducerId:e.reducerId,timelineType:null==o?void 0:o.type,format:c,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,columnsDisplayState:O,hiddenGroups:R,hiddenGroupsVisible:w}),k&&(0,b.jsx)(Jn,{groups:R,groupBy:p,groupsDisplayState:T,format:c,schema:g,reducerId:e.reducerId,store:e.store,collectionContextStore:e.collectionContextStore,disabled:e.disabled,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,renderGroup:e.renderGroup,getGroupStyle:e.getGroupStyle,renderHeader:e.renderHeader,onGroupHeaderAddItem:e.onGroupHeaderAddItem,timelineProps:o})]}),F&&(0,b.jsx)(ts,{timelineType:null==o?void 0:o.type,store:e.store,collectionContextStore:e.collectionContextStore,schema:g,format:c,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,groupsDisplayState:T,groupBy:p})]});return v?(0,b.jsx)(ze.Z,{id:e.reducerId,reducer:v,collectionContextStore:e.collectionContextStore,resultStore:x,render:()=>B}):B}const Xn=i.memo(Yn,po.Z);function Jn(e){const t=(0,d.VK)((()=>e.collectionContextStore.groupsStore.getGroupState),[e.collectionContextStore.groupsStore]),o=(0,d.VK)((()=>e.collectionContextStore.isInPeekRenderer.state),[e.collectionContextStore]);return(0,b.jsx)(b.Fragment,{children:e.groups.map(((r,i)=>{var n,s;return t&&e.groupBy?(0,b.jsx)(Ei,{collectionContextStore:e.collectionContextStore,groupsDisplayState:e.groupsDisplayState,groupFormat:r,groupBy:e.groupBy,disabled:e.disabled,groupsFormatKey:re.Uh,groupAggregationKey:re.dQ,format:e.format,schema:e.schema,isInPeekRenderer:o,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,renderGroup:e.renderGroup,renderHeader:e.renderHeader,onGroupHeaderAddItem:e.onGroupHeaderAddItem,getGroupStyle:e.getGroupStyle,ignoreAncestorStickyContainer:(null===(n=e.timelineProps)||void 0===n?void 0:n.type)&&Qn.has(null===(s=e.timelineProps)||void 0===s?void 0:s.type),index:i,isLast:i===e.groups.length-1},(0,re.mD)(r)):null}))})}function es(e){const t=(0,d.VK)((()=>e.collectionContextStore.groupsLimit),[e.collectionContextStore]);return"dropzone"===e.timelineType?null:"item"===e.timelineType?(0,b.jsx)(Wn,{type:"default",schema:e.schema,collectionContextStore:e.collectionContextStore,groupsLimitStore:t,visibleGroups:e.groupsDisplayState.visibleGroups,hiddenGroups:e.groupsDisplayState.hiddenGroups,total:e.groupsDisplayState.total,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft}):(0,b.jsx)("div",{style:{display:"flex"},children:(0,b.jsx)(zi,{type:"default",schema:e.schema,collectionContextStore:e.collectionContextStore,groupsLimitStore:t,visibleGroups:e.groupsDisplayState.visibleGroups,hiddenGroups:e.groupsDisplayState.hiddenGroups,total:e.groupsDisplayState.total,style:e.stickyLeft?{position:"sticky",left:e.paddingLeft}:void 0})})}function ts(e){const t=(0,a.O7)(),o=(0,d.VK)((()=>e.collectionContextStore.groupsLimit),[e.collectionContextStore]),r=i.useCallback(((e,t,o,r,i)=>{const n=o.collectionStore();n&&Z.tH({update:e,collectionContextStore:o,groupsFormatKey:re.Uh,collectionStore:n,environment:t,groupBy:r,schema:i})}),[]);return"dropzone"!==e.timelineType&&e.groupBy?"item"===e.timelineType?(0,b.jsx)(Kn,{type:"default",collectionContextStore:e.collectionContextStore,parentStore:e.store,groupsLimitStore:o,groupBy:e.groupBy,currentGroups:e.groupsDisplayState.currentGroups,schema:e.schema,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,onAccept:o=>{e.groupBy&&r(o,t,e.collectionContextStore,e.groupBy,e.schema)}}):(0,b.jsx)(Mi,{type:"default",collectionContextStore:e.collectionContextStore,parentStore:e.store,groupsLimitStore:o,groupBy:e.groupBy,currentGroups:e.groupsDisplayState.currentGroups,schema:e.schema,paddingLeft:e.paddingLeft,stickyLeft:!0,onAccept:o=>{e.groupBy&&r(o,t,e.collectionContextStore,e.groupBy,e.schema)}}):null}function os(e){return"board_collection_groups"===e.reducerId?(0,b.jsx)(zn,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisible:e.hiddenGroupsVisible,format:e.format,columnsDisplayState:e.columnsDisplayState}):"dropzone"===e.timelineType?null:"item"===e.timelineType?(0,b.jsx)(Un,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisible:e.hiddenGroupsVisible,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft}):(0,b.jsx)("div",{style:{display:"flex"},children:(0,b.jsx)(Wi,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisible:e.hiddenGroupsVisible,style:{marginTop:10,...e.stickyLeft?{position:"sticky",left:e.paddingLeft}:{}}})})}var rs=o(17504);class is extends p.default{getInitialState(){return{}}}const ns=is;const ss=function(e){let{store:t,disabled:o,isFirstItem:r,isLastItem:i,hideContent:n,blockResizerStore:s,isQuickFind:l,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:h,format:m,schema:S,coverFormat:g,coverAspectFormat:C,coverSizeFormat:f,coverHeight:y,coverWidth:v,shouldShowTitle:x,onTextEnter:w,onTextEsc:k,onShiftEnter:_,blockPropertyValueOverlayStore:T,isLast:O,handleOpenPeekPage:V,collectionContextStore:P}=e;return(0,b.jsx)(rr,{store:t,disabled:o,isFirstItem:r,isLastItem:i,hideContent:n,blockResizerStore:s,isQuickFind:l,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:h,format:m,schema:S,coverFormat:g,coverAspectFormat:C,coverSizeFormat:f,coverHeight:y,coverWidth:v,shouldShowTitle:x,colorStyle:void 0,onTextEnter:w,onTextEsc:k,onShiftEnter:_,blockPropertyValueOverlayStore:T,isLast:O,handleOpenPeekPage:V,collectionContextStore:P})},ls=i.memo((function(e){let{collectionContextStore:t,groupFormat:o,format:r,schema:n,disabled:s,store:l,blockPropertyValueOverlayStore:c,collectionGalleryViewStore:u,isSingleColumn:p}=e;const h=(0,a.O7)(),m=(0,i.useMemo)((()=>o?[o]:[]),[o]),S=(0,d.VK)((()=>t.permissionScopes.state),[t.permissionScopes]),g=(0,d.VK)((()=>l.canEdit()&&("collectionTypedView"===t.contextType||S.canEditContent)),[t,S.canEditContent,l]),C=(0,i.useCallback)((e=>{const t=e.blocks;if(t.length>0){const e=t[0],o=e.getBlockTitleStore();Y.eP({environment:h,store:e}),J.NX({store:o}),pe.Z5({store:e})}}),[h]),f=(0,i.useCallback)((e=>{const o=t.collectionStore(),r=e.getTitleStore();if(!r)return;So.QaF(r.getValue())?Y.Ys({environment:h,store:e}):o&&ee.createAndCommit({userAction:"CollectionGalleryView.handleItemTextEsc",environment:h,perform:t=>{Z.Od({store:e,transaction:t})}})}),[t,h]),y=(0,i.useMemo)((()=>p?{position:"absolute",top:6,left:0,right:0,height:4}:{position:"absolute",top:16,bottom:4,width:4,height:"none"}),[p]),{gallery_cover:v,gallery_cover_aspect:x,gallery_cover_size:w}=r,k=!s&&g&&!S.isSyncedCollection,{coverHeight:_,coverWidth:T}=(0,d.VK)((()=>u.state),[u]),O=(0,i.useMemo)((()=>({format:r,schema:n,onTextEnter:f,onTextEsc:f,onShiftEnter:C,disabled:s,coverFormat:v,coverAspectFormat:x,coverSizeFormat:w,coverHeight:_,coverWidth:T,shouldShowTitle:yo.K8(r,"gallery"),blockPropertyValueOverlayStore:c,collectionContextStore:t})),[c,t,_,T,x,v,w,s,r,C,f,n]);return(0,b.jsx)(ii,{collectionContextStore:t,groupsPointer:m,format:r,canDrag:k,onSelectableEnter:C,resultProps:O,resultComponent:ss,canDrop:!0,disabled:s,shouldShowHoverMenu:!1,direction:p?oi.Vertical:oi.Horizontal,belowDropZoneMargin:6,emptyDroppableSize:4,dropzoneGap:10,analyticsName:"gallery",emptyDroppableStyle:y,loadContentCover:v&&"page_content"===v.type})}));var as=o(17311);function cs(e){const{hasPartialResults:t}=e;if(!(0,Br.Z)(!0,0,100))return null;const o=e.coverHeight??as.Z.card.desktop.medium.height,r=t?void 0:o+40,i=t?1:3,n=N.DZ(i,(e=>(0,b.jsx)(qi,{minHeight:r},e)));return(0,b.jsx)(b.Fragment,{children:n})}const ds=480,us=40;class ps extends s.Z{constructor(){super(...arguments),this.storeTypes={collectionGalleryViewStore:ns},this.selectableContainer=null,this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderGroup=e=>(0,b.jsx)(ws,{store:this.props.store,format:this.props.format,disabled:this.props.disabled,collectionContextStore:this.props.collectionContextStore,schema:this.props.schema,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,isFullScreen:this.props.isFullScreen,collectionGalleryViewStore:this.stores.collectionGalleryViewStore,isSingleColumnStore:this.isSingleColumnStore,isReadyStore:this.isReady,groupFormat:e}),this.handleResize=()=>{const{collectionGalleryViewStore:e}=this.stores,t=this.getGalleryCardCoverHeight(),o=this.getGalleryCardActualWidth();e.state.coverHeight!==t&&this.setCardCoverHeight(t),e.state.coverWidth!==o&&ys(this.props.format,this.stores.collectionGalleryViewStore,o)},this.handleResizeDebounced=(0,N.Ds)(this.handleResize,1e3),this.handleResizeThrottled=(0,N.P2)(this.handleResize,100),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem=e=>fs(e,this.environment,this.props.collectionContextStore),this.isSingleColumnStore=this.createComputedStore((()=>this.environment.WindowSizeStore.state.width<=ds)),this.isReady=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return e.groupsStore.anyGroupHasResults()}))}didUpdate(e){(e.format||{}).gallery_cover_size!==(this.props.format||{}).gallery_cover_size&&(this.setCardCoverHeight(),ys(this.props.format,this.stores.collectionGalleryViewStore))}didMount(){ys(this.props.format,this.stores.collectionGalleryViewStore),this.setCardCoverHeight(),(0,ji.lj)(window,"resize",this.handleResizeThrottled),this.environment.device.isMobile&&(0,ji.lj)(window,"orientationchange",this.handleResizeDebounced)}willUnmount(){(0,ji.ZV)(window,"resize",this.handleResizeThrottled),this.environment.device.isMobile&&(0,ji.ZV)(window,"orientationchange",this.handleResizeDebounced)}renderComponent(){const{store:e,format:t,paddingBottom:o,paddingLeft:r,paddingRight:i,isFullScreen:n,collectionContextStore:s}=this.props,l=ce.az(s,n),a=t.collection_group_by,c=s.isCompactView.state;return(0,rs.Z)((t=>(0,b.jsxs)("div",{style:{paddingBottom:o,paddingLeft:r,paddingRight:i,minWidth:this.props.minWidth},className:fo.sbt,children:[(0,b.jsx)(It.Z,{store:e,shouldShowHalo:!n&&!c,canSelect:!n,analyticsName:"gallery",...t,ref:e=>this.selectableContainer=e,children:a?(0,b.jsx)(ks,{collectionContextStore:this.props.collectionContextStore,store:this.props.store,format:this.props.format,disabled:this.props.disabled,schema:this.props.schema,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,isFullScreen:this.props.isFullScreen,paddingLeft:this.props.paddingLeft,isRootChild:this.props.isRootChild,isInPeekRenderer:this.props.isInPeekRenderer,collectionGalleryViewStore:this.stores.collectionGalleryViewStore,isSingleColumnStore:this.isSingleColumnStore,isReadyStore:this.isReady,groupBy:a}):(0,b.jsx)(ws,{store:this.props.store,format:this.props.format,disabled:this.props.disabled,collectionContextStore:this.props.collectionContextStore,schema:this.props.schema,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,isFullScreen:this.props.isFullScreen,collectionGalleryViewStore:this.stores.collectionGalleryViewStore,isSingleColumnStore:this.isSingleColumnStore,isReadyStore:this.isReady,groupFormat:void 0})}),!l&&(0,b.jsx)(di.Z,{onChange:e=>function(e,t,o,r){var i;const n=o.isLoading.state,s=null===(i=function(e){var t;return null===(t=e.groupsStore.getGroupState([]))||void 0===t?void 0:t.reducerResultStore}(o))||void 0===i?void 0:i.state;e<vo.Z.incrementScrollOffset&&s&&!n&&null!=s&&s.hasMore&&Z.ID({collectionContextStore:o,environment:t,incrementLimitArgs:{isFullScreen:r,currentResultCount:s.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}(e,this.environment,this.props.collectionContextStore,this.props.isFullScreen)})]})))}setCardCoverHeight(e){const{collectionGalleryViewStore:t}=this.stores;t.setState({...t.state,coverHeight:e||this.getGalleryCardCoverHeight()})}getGalleryCardActualWidth(){if(this.selectableContainer){const e=this.selectableContainer.getNode();if(e){const t=e.querySelector(`.${fo.K4T}`);if(t)return t.offsetWidth}}return ms(this.props.format)}getGalleryCardCoverHeight(){return this.getGalleryCardActualWidth()*(9/16)}}ps.displayName="CollectionGalleryView",ps.contextTypes={...xn.wK,...s.w};const hs=ps;function ms(e){const t=e.gallery_cover_size;return ce.rD(t)}function Ss(e){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.lightIconColor}}function gs(e,t){return 0===e.index?{}:{borderTop:`1px solid ${t.tableDividerColor}`}}function Cs(e){let{args:t}=e;const o=(0,u.Fg)(),r=(0,d.VK)((()=>t.collectionContextStore.isCompactView.state),[t.collectionContextStore]);return(0,b.jsx)(Nt,{...t,height:r?yo.yZ:48,getComputedStickyStyle:e=>function(e,t){return{boxShadow:e?`0 -1px 0 ${t.contentBackground}`:void 0}}(e,o)})}function fs(e,t,o){if(t.device.isMobile)se._c({environment:t,store:e,pageVisitSource:h.tY.Create});else{const r="collectionTypedView"===o.contextType;le.CH({environment:t,store:e,peekMode:ce.kr(o),showMoveTo:r,resultsStore:void 0,collectionContextStore:o,pageVisitSource:h.tY.Create})}}function ys(e,t,o){t.setState({...t.state,coverWidth:o||ms(e)})}function vs(e,t,o){const r=e.collection_group_by;return{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${o?"100%":`${ms(e)}px`}, 1fr))`,gridRowGap:16,gridColumnGap:16,paddingTop:r?1:16,paddingBottom:4,...t?{paddingLeft:8,paddingRight:8}:{}}}function xs(e,t,o,r,i){if(!Ce.M_(o))return;const n=r.groupsStore.getGroupState(e);n&&ee.createAndCommit({userAction:"CollectionGalleryView.handleAddItemClick",environment:o,perform:s=>{const{mainEditorCurrentBlockStore:l}=$o.default.state,a=Z.IW({environment:o,collectionContextStore:r,groupsPointer:e,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:s,from:"gallery",useCrdt:t});if(!a)return;!function(e,t,o){o?o(e):ae.c4({environment:t,url:e})}(ce.mb({store:a.newStore,mainEditorCurrentBlockStore:l,collectionContextStore:r})??(0,Ko.ZP)({store:a.newStore,pageVisitSource:h.tY.Create}),o,i),U.Xd({collectionContextStore:r,resultsStore:n.resultsStore}),ne.W(o,{from:"gallery_view_add_item_bottom",type:"page",new_page_id:a.newStore.id,creating_block_id:a.newStore.id,...(0,he.Pn)(r)})}})}function bs(e){let{groupsPointer:t,collectionContextStore:o}=e;const r=(0,u.Fg)(),n=(0,a.O7)(),s=(0,i.useContext)(xn.ZO);return(0,b.jsx)(Yt.Z,{onClick:e=>xs(t,(0,Co.SL)({event:e,source:"collection_non_table_view"}),n,o,s),onMouseDown:me.$0,style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,borderRadius:4,boxShadow:"dark"===r.mode?`${r.darkDividerColor} 0px 0px 0px 1px inset`:`${r.regularDividerColor} 0px 0px 0px 1px inset`,minHeight:us},children:(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",marginLeft:-6},children:[(0,ie.R)(Ss(r)),(0,b.jsx)("div",{style:{color:r.lightIconColor},children:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"New",id:"database.galleryView.addItemButtonTitle"})})]})})}function ws(e){let{groupFormat:t,store:o,format:r,disabled:n,collectionContextStore:s,schema:l,blockPropertyValueOverlayStore:a,isFullScreen:c,collectionGalleryViewStore:p,isSingleColumnStore:h,isReadyStore:m}=e;const S=(0,u.Fg)(),g=(0,d.VK)((()=>h.state),[h]),C=(0,d.VK)((()=>m.state),[m]),f=(0,i.useMemo)((()=>t?[t]:[]),[t]),y=(0,d.VK)((()=>s.groupsStore.getGroupState(f)),[s,f]),v=(0,d.VK)((()=>p.state.coverHeight),[p]),x=(0,d.VK)((()=>null==y?void 0:y.reducerResultStore.state),[y]),w=void 0!==t,k=void 0!==x&&(null==x?void 0:x.blockIds.length)>0,_=(0,d.VK)((()=>Wt({collectionContextStore:s,groupsPointer:f,hasPartialResults:k})),[s,f,k]),T=(0,d.VK)((()=>ce.VM({collectionContextStore:s,reducerResult:x,isFullScreen:c})),[s,x,c]),O=(0,d.VK)((()=>s.permissionScopes.state),[s]),V=O.isSyncedCollection,P=(0,d.VK)((()=>o.canEdit()&&("collectionTypedView"===s.contextType||O.canEditContent)),[o,s,O]),R=(0,d.VK)((()=>s.isCompactView.state),[s]),M=(0,d.VK)((()=>s.isInHomeWidget.state),[s]);if(!y)return null;const j=!M&&C&&!n&&P&&!V&&(k||!_);return(0,b.jsxs)("div",{style:{paddingBottom:t?16:void 0},children:[(0,b.jsxs)("div",{style:vs(r,R,g),children:[(0,b.jsx)(ls,{collectionContextStore:s,groupFormat:t,format:r,schema:l,disabled:n,store:o,blockPropertyValueOverlayStore:a,collectionGalleryViewStore:p,isSingleColumn:g}),_&&(0,b.jsx)(cs,{hasGroups:w,hasPartialResults:k,coverHeight:v}),j&&(0,b.jsx)(bs,{collectionContextStore:s,groupsPointer:f})]}),T&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{style:{width:"100%",borderTop:t?void 0:`1px solid ${S.tableDividerColor}`,marginTop:4,marginBottom:4}}),(0,b.jsx)(no,{groupsPointer:f,store:o,collectionContextStore:s,format:r,isFullScreen:c,incrementLimitsInRelatedGroups:!1})]})]})}function ks(e){let{groupBy:t,collectionContextStore:o,store:r,format:n,disabled:s,schema:l,blockPropertyValueOverlayStore:c,isFullScreen:p,paddingLeft:h,isRootChild:m,isInPeekRenderer:S,collectionGalleryViewStore:g,isSingleColumnStore:C,isReadyStore:f}=e;const y=(0,u.Fg)(),v=(0,a.O7)(),x=(0,i.useCallback)((e=>fs(e,v,o)),[v,o]),w=(0,i.useCallback)((e=>(0,b.jsx)(ws,{store:r,format:n,disabled:s,collectionContextStore:o,schema:l,blockPropertyValueOverlayStore:c,isFullScreen:p,collectionGalleryViewStore:g,isSingleColumnStore:C,isReadyStore:f,groupFormat:e})),[r,n,s,o,l,c,p,g,C,f]);return(0,d.VK)((()=>(0,we.hJ)()),[])?(0,b.jsx)(Xn,{reducerId:"gallery_groups",store:r,collectionContextStore:o,disabled:s,isFullScreen:p,isRootChild:m,paddingLeft:h,stickyLeft:!1,renderGroup:w,getGroupStyle:e=>gs(e,y),renderHeader:e=>(0,b.jsx)(Cs,{args:e}),onGroupHeaderAddItem:x}):(0,b.jsx)(an,{store:r,id:"gallery_groups",groupBy:t,groupsFormatKey:re.Uh,groupAggregationKey:re.dQ,format:n,schema:l,collectionContextStore:o,disabled:s,isFullScreen:p,renderGroup:w,onGroupHeaderAddItem:x,renderHeader:e=>(0,b.jsx)(Cs,{args:e}),getGroupStyle:e=>gs(e,y),paddingLeft:h,isRootChild:m,isInPeekRenderer:S})}var _s=o(7801),Ts=o(34464),Os=o(97372);class Vs extends p.default{getInitialState(){return{}}}const Ps=Vs;var Rs=o(1742);function Ms(e){const t=(0,a.O7)(),{store:o,collectionContextStore:r,disabled:n,groupsPointer:s,collectionStore:l,subitemPath:c,indentLevel:p,onSubitemCreate:h}=e,m=(0,d.VK)((()=>(0,ce.fk)({environment:t,collectionContextStore:r})),[r,t]),S=(0,d.VK)((()=>{var e;return"timeline"===(null===(e=r.collectionViewStore())||void 0===e?void 0:e.getType())}),[r]),g=(0,d.VK)((()=>{var e;return"title"===(null===(e=r.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[r]),C=(0,d.VK)((()=>(0,Kr.f2)({columnIndex:0,titleColumnIndex:0,shouldShowBulkActionsToolbar:m,indentLevel:p+1,isSubitemToggleOnTitleColumn:g})),[p,g,m]),f=(0,u.yK)((t=>({newRowButton:{display:"flex",alignItems:"center",height:32,width:"100%",paddingLeft:C,fontSize:14,lineHeight:D.Z.lineHeight.UIRegular.desktop,borderBottom:`1px solid ${t.tableDividerColor}`,left:0,right:0,...S&&{borderTop:"none"},...e.styles},newRowContainer:{display:"inline-flex",alignItems:"center",position:"sticky",left:C+8,color:t.lightTextColor},newIcon:{width:14,height:14,marginLeft:-1,marginRight:6,fill:t.lightIconColor},newText:{color:t.lightTextColor}})),[C,S,e.styles]),y=(0,d.VK)((()=>{const e=r.permissionScopes.state,t=l.isSyncedCollection();return!n&&e.canEditContent&&!t}),[r,n,l]),v=(0,i.useCallback)((e=>{ee.createAndCommit({userAction:"CollectionNestedCreateSubitemButton.handleClick",environment:t,perform:i=>{const n=Z.yk({environment:t,collectionContextStore:r,groupsPointer:s,store:o,before:!1,collectionStore:l,transaction:i,subitemPath:c,subitemInsertDirection:"into",from:"cvb_new_subitem",event:e});n&&h(n)}}),L.JE(t,{...(0,he.Pn)(r)})}),[r,t,s,l,o,c,h]);return y?(0,b.jsx)(Yt.Z,{onClick:v,onMouseDown:me.$0,style:f.newRowButton,children:(0,b.jsxs)("span",{style:f.newRowContainer,children:[(0,ie.R)(f.newIcon),(0,b.jsx)("span",{style:f.newText,children:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"New sub-item",id:"database.tableView.nest.addSubitem"})})]})}):null}var js=o(73959),Is=o(73819),Fs=o(68709),Bs=o(32426),Ns=o(50959),Ds=o(23063),Ls=o(3072),Es=o(29376),As=o(4023);function Hs(e){const{disabled:t,property:o,schema:r,collectionContextStore:n,groupFormat:s,propertyFormat:l,isHovered:c,aggregation:p,onChange:h}=e,m=(0,i.useMemo)((()=>!!(null!=l&&l.width&&l.width<100)),[l]),S=(0,a.O7)(),g=(0,B.useIntl)(),{isMobile:C}=(0,a.Fy)(),[f,y]=(0,i.useState)(void 0),v=(0,d.VK)((()=>{if(!p)return;return{type:"aggregation",filter:s?(0,Le.zk)({schema:r,propertyMapping:void 0,group:s,timeZone:(0,Ee.r)()}):void 0,aggregation:p}}),[r,s,p]),x=(0,i.useCallback)((e=>{if(e){const t={aggregator:e,property:o};h(o,t),y(t),L.wd(S,{view_type:"table",action:"table_change_aggregation"}),Ut.j({name:"collection_change_aggregation"})}else h(o,void 0),L.wd(S,{view_type:"table",action:"table_remove_aggregation"})}),[S,h,o]),w=(0,u.yK)((()=>({buttonStyle:{display:"flex",alignItems:"center",justifyContent:"flex-end",width:"100%",height:32,paddingRight:8,overflow:"hidden",whiteSpace:"nowrap",userSelect:"auto",WebkitUserSelect:"auto"}})),[]),k=(0,d.VK)((()=>Ke(n,p)),[n,p]);(0,i.useEffect)((()=>{f&&!Ke(n,f)&&(0,N.Xy)(p,f)&&y(void 0)}),[k,f,n,p]);const _=m&&null!=p&&p.aggregator?He.VN[(0,De.OV)(p)]:void 0;return(0,b.jsx)(qe.ZP,{popupType:C?qe.Z4.SlideUp:qe.Z4.Popup,disabled:t,renderOrigin:e=>v?(0,b.jsx)(ze.Z,{id:Zs(s,o,v.aggregation),collectionContextStore:n,reducer:v,groupsPointer:s?[s]:void 0,render:i=>(0,b.jsx)(Xe.ZP,{alignment:m?As.v.Center:As.v.End,disableTooltip:!k&&!_,renderTooltip:()=>k?g.formatMessage(We.aggregationCalculating):_,render:n=>(0,b.jsx)(Yt.Z,{disabled:t,style:w.buttonStyle,...(0,Ze.Z)(n,e),children:(0,b.jsx)(zs,{resultStore:i,aggregation:p,schema:r,property:o,hideLabelText:m})})})}):(0,b.jsx)(Yt.Z,{disabled:t,style:w.buttonStyle,...e,children:(0,b.jsx)(Gs,{disabled:t,isHovered:c,hideLabelText:m})}),render:e=>{let{close:t}=e;return(0,b.jsx)(Ls.Z,{currentAggregation:null==p?void 0:p.aggregator,property:o,schema:r,onChange:x,onClose:t,source:"tableAggregation"})}})}function Zs(e,t,o){let r=`${o.aggregator}`;return"object"==typeof o.aggregator&&"operator"in o.aggregator&&(r=`${o.aggregator.operator}:${o.aggregator.groupName}`),`table:${(0,re.mD)(e)}:${t}:${r}`}function zs(e){const{aggregation:t,resultStore:o,schema:r,property:n,hideLabelText:s}=e,l=(0,tn.Y$)(),a=(0,u.yK)((e=>({valueStyle:{display:"flex",alignItems:"center",height:"100%"},aggregationTypeNameStyle:{fontSize:10,textTransform:"uppercase",letterSpacing:1,color:e.mediumTextColor,marginTop:2,marginRight:4,userSelect:"none",WebkitUserSelect:"none"}})),[]),c=(0,d.VK)((()=>o.state),[o]),p=(0,i.useMemo)((()=>{if(!t)return;let e=He.v6[(0,De.OV)(t)];return(0,De.en)(t.aggregator)&&(e=t.aggregator.groupName in Ns.ZA?Ns.ZA[t.aggregator.groupName]:t.aggregator.groupName),e}),[t]),h=r[n],m=(0,d.VK)((()=>{if(h&&("formula"===h.type||"number"===h.type))return h.number_format;if("rollup"===(null==h?void 0:h.type)&&h.relation_property&&h.target_property&&"number"===h.target_property_type){if(r[h.relation_property]){var e;const t=(0,Es.ny)(l,r[h.relation_property]),o=null==t||null===(e=t.getModel())||void 0===e?void 0:e.getNormalizedSchema(),i=null==o?void 0:o[h.target_property];if("number"===(null==i?void 0:i.type))return i.number_format}}}),[h,r,l]);if(p){const e=(0,b.jsx)("span",{style:a.valueStyle,children:t&&(0,b.jsx)(Ue,{aggregation:t,collectionContextStore:l,children:c?(0,He.Ol)({numberFormat:m,dateFormat:void 0,aggregationType:t.aggregator,value:null==c?void 0:c.aggregationResult,userTimeZone:(0,Ee.r)(),roundDecimal:5}):void 0})},"value");return s?e:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{style:a.aggregationTypeNameStyle,children:p},"type"),e]})}return null}function Gs(e){let{disabled:t,isHovered:o,hideLabelText:r}=e;const i=(0,u.yK)((e=>({placeholderWrapper:{display:"flex",alignItems:"center"},placeholderText:{color:e.lightTextColor},chevronIcon:{width:10,marginLeft:r?1:4,fill:e.lightIconColor},summationIcon:{width:12,fill:e.lightIconColor}})),[r]),{isMobile:n}=(0,a.Fy)();return t||!o&&!n?null:(0,b.jsx)(Ds.Z,{isVisible:!0,animationStyle:{opacity:1},enterAnimationStyle:{opacity:0},exitAnimationStyle:{opacity:0},render:()=>(0,b.jsxs)("div",{style:i.placeholderWrapper,children:[r?(0,b.jsx)("span",{style:i.placeholderText,children:(0,Bs.D)(i.summationIcon)},"placeholder"):(0,b.jsx)("span",{style:i.placeholderText,children:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Calculate",id:"database.tableView.aggregationPlaceholder"})},"placeholder"),(0,Gi.i)(i.chevronIcon)]})})}const Ks=i.memo((function(e){let{collectionContextStore:t,disabled:o,groupFormat:r,isFullScreen:n,isInPeekRenderer:s,query:l,schema:c,showHoverActionsStore:p,showPropertyFormats:h,showRightActionsSpacer:m,style:S}=e;const g=(0,a.O7)(),C=(0,u.Fg)(),[f,y]=(0,i.useState)(!1),v=(0,d.VK)((()=>t.frozoneStore.state.frozenIndex),[t.frozoneStore]),{unfrozenIndexAddendum:x,frozenPropertyFormats:w,unfrozenPropertyFormats:k}=(0,d.VK)((()=>{const e=h;let t=[],o=e;const r=(0,ce.bW)(v);return void 0!==v&&(t=e.slice(0,r),o=e.slice(r)),{unfrozenIndexAddendum:r,frozenPropertyFormats:t,unfrozenPropertyFormats:o}}),[v,h]),_=(0,d.VK)((()=>t.isCompactView.state),[t]),T=(0,d.VK)((()=>{var e;return{display:"flex",position:"absolute",background:_?void 0:(null===(e=t.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(s?C.cardContentBackground:C.contentBackground),zIndex:F.RJ,fontSize:14,height:wc+(n?wt.Z.state:0)+1,minWidth:"100%",clipPath:"polygon(0% -20%, 100% -20%, 100% 100%, 0% 100%)",left:0,...S}}),[t,n,s,S,C,_]),O=(0,d.VK)((()=>void 0!==v&&(0,Kr.oc)({environment:g,collectionContextStore:t,isPhone:g.device.isPhone,theme:C})),[v,g,t,C]),V=(0,i.useCallback)((()=>{y(!0)}),[y]),P=(0,i.useCallback)((()=>{y(!1)}),[y]),R=(0,i.useCallback)((e=>e?{borderTop:`1px solid ${C.tableDividerColor}`}:{borderTop:void 0}),[C]);function M(e,i){return(0,b.jsx)(Us,{propertyFormat:e,index:i,groupFormat:r,disabled:o,mouseEntered:f,showHoverActionsStore:p,collectionContextStore:t,schema:c,query:l},e.property)}return(0,b.jsx)(Mt,{position:_?mt.IGNORE:mt.Bottom,getComputedStyle:R,children:(0,b.jsx)(Fs.p,{allowSelectionWithin:!1,style:T,onMouseMove:V,onMouseLeave:P,onMouseDown:$s,children:(0,b.jsx)("div",{style:{display:"flex",paddingRight:!o&&m?32:0},children:(0,b.jsxs)("div",{style:{display:"flex"},children:[void 0!==v&&(0,b.jsx)("div",{style:{...O,display:"flex"},children:w.map(M)}),k.map(((e,t)=>M(e,t+x)))]})})})})}),po.Z),Us=i.memo((function(e){var t;let{propertyFormat:o,index:r,groupFormat:n,disabled:s,mouseEntered:l,showHoverActionsStore:c,collectionContextStore:u,query:p,schema:h}=e;const m=(0,a.O7)(),S=(0,d.VK)((()=>(0,ce.fk)({environment:m,collectionContextStore:u})),[m,u]),g=(0,d.VK)((()=>c.state),[c]),C=(0,i.useCallback)(((e,t)=>{const o=u.collectionViewStore();if(!o)return;let r=p.aggregations?[...p.aggregations]:[];const i=(p.aggregations||[]).findIndex((t=>t.property===e));r=i<0?N.oA([...r,t]):N.oA(r.map(((e,o)=>i===o?t:e)));const n={...p,aggregations:r};!u.isClientModeEnabled.state&&t&&u.asyncAggregationStatus.setState({calculating:!0,aggregation:t,changingType:!0}),ee.createAndCommit({userAction:"TableAggregationRow.handleTableAggregationChange",environment:m,perform:e=>{pe.iG({collectionViewStore:o,update:{query2:n},transaction:e})}})}),[u,p,m]);return(0,b.jsx)("div",{style:{display:"flex",width:void 0!==o.width?o.width+(0===r&&S?Kr.Xx:0):void 0},children:(0,b.jsx)(Hs,{groupFormat:n,propertyFormat:o,disabled:s,isHovered:(l||0===r&&!n&&g)&&!s,aggregation:null===(t=p.aggregations)||void 0===t?void 0:t.find((e=>e.property===o.property)),property:o.property,collectionContextStore:u,schema:h,onChange:C})})})),Ws=Ks;function $s(e){(0,me.ZP)({event:e,context:me.Af.EditorMouseDown,callback:()=>{}})}function qs(e){const{collectionContextStore:t,shouldShowAddRowButton:o,paddingLeft:r,handleAddRowClick:i}=e,n=(0,d.VK)((()=>Boolean(t.currentCombinatorFilterStore.state||t.currentPropertyFiltersStore.state.length>0)),[t]),s=(0,d.VK)((()=>t.isInHomeWidget.state),[t]),l=(0,u.yK)((e=>{const t=s?e.tableHomeDividerColor:e.tableDividerColor;return{button:{display:"flex",alignItems:"center",height:bc+1,width:"100%",paddingLeft:kc,fontSize:14,lineHeight:D.Z.lineHeight.UIRegular.desktop,background:s?void 0:e.contentBackground,left:0,right:0,textAlign:"center",borderBottom:`1px solid ${t}`},buttonInner:{color:e.lightTextColor,position:"sticky",left:r+kc}}}),[s,r]);return(0,b.jsx)(Yt.Z,{className:fo.Gcz,onClick:i,onMouseDown:me.$0,disabled:!o,style:l.button,children:o?(0,b.jsx)("span",{style:l.buttonInner,children:n?(0,b.jsx)(B.FormattedMessage,{defaultMessage:"No filter results. Click to add a row.",id:"database.tableView.emptyTablePlaceholderWithFilters"}):(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Empty. Click to add a row.",id:"database.tableView.emptyTablePlaceholder"})}):(0,b.jsx)("span",{style:l.buttonInner,children:n?(0,b.jsx)(B.FormattedMessage,{defaultMessage:"No filter results.",id:"database.tableView.cannotEdit.emptyTablePlaceholderWithFilters"}):(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Empty.",id:"database.tableView.cannotEdit.emptyTablePlaceholder"})})})}var Qs=o(46283),Ys=o(87085),Xs=o(73060),Js=o(79131),el=o(25962),tl=o(97466);const ol=2,rl=3;function il(e){const{passesFilter:t,isScrolled:o,isCheckbox:r,isShimmerRow:n}=e,s=(0,i.useCallback)((e=>"dark"===e.mode?"transparent":t?`linear-gradient(to right, ${(0,tl.Fq)(xe.se[e.mode].gray,.15)},\n\t\t\t\t${(0,tl.Fq)(xe.se[e.mode].gray,.1)},  transparent)`:`linear-gradient(to right, ${(0,tl.Fq)(xe.se[e.mode].gray,.35)},\n\t\t\t\t${(0,tl.Fq)(xe.se[e.mode].gray,.2)},  transparent)`),[t]),l=(0,u.yK)((e=>({border:{position:"absolute",top:-1,right:0,width:ol,height:n?35:"calc(100% + 2px)",background:t?e.tableDividerColor:e.tableFrozenFilterDividerColor},shadow:{position:"absolute",top:0,right:-rl,width:rl,height:n?34:"100%",background:s(e)}})),[n,t,s]);return(0,b.jsxs)(b.Fragment,{children:[r&&!o?null:(0,b.jsx)("div",{style:l.border}),(0,b.jsx)(Ds.Z,{isVisible:!0,animationStyle:{opacity:o?1:0},render:()=>(0,b.jsx)("div",{style:l.shadow})})]})}function nl(e){const{checkedState:t,onClick:o,checkboxType:r,collectionContextStore:n,passesFilter:s,disabled:l,frozoneProps:c}=e,p=(0,a.O7)(),h=(0,d.qz)(void 0,Zo.Z),m=(0,d.VK)((()=>h.state.mouseEntered),[h]),S=(0,i.useRef)(null);(0,i.useEffect)((()=>{S.current&&(S.current.indeterminate="indeterminate"===t)}),[t]);const g=(0,d.VK)((()=>Qr.ZP.state.isDragging),[]),C=(0,i.useCallback)((e=>{l||(o(e),E.Ac({environment:p,collectionContextStore:n,checkbox_type:r}))}),[l,r,n,p,o]),f=(0,d.VK)((()=>!1===t&&!m||g?null!=c&&c.shouldShowStickyMultiSelectColumn?.4:0:1),[t,g,m,null==c?void 0:c.shouldShowStickyMultiSelectColumn]),y=(0,u.yK)((e=>({multiSelectCheckbox:{background:null==c?void 0:c.frozenStyles.background,borderBottom:e.tableDividerColor,height:"100%"},multiSelectCheckboxInner:{background:null!=c&&c.isCollectionViewBlockSelected?xe.ZP.blueWithAlpha(.14):void 0,height:"100%"},checkBoxInput:{width:Kr.tA,height:Kr.tA,cursor:l?void 0:"pointer",accentColor:e.fill.uiBlue,position:"relative",right:2}})),[l,null==c?void 0:c.frozenStyles.background,null==c?void 0:c.isCollectionViewBlockSelected]);return(0,b.jsx)(Ds.Z,{isVisible:!0,animationStyle:{opacity:f>0?1:0},render:()=>(0,b.jsxs)("div",{style:y.multiSelectCheckbox,onMouseEnter:()=>{h.enter()},onMouseLeave:()=>{h.exit()},children:[(0,b.jsx)("div",{style:y.multiSelectCheckboxInner,children:(0,b.jsx)(Ds.Z,{isVisible:!0,animationStyle:{opacity:f},render:()=>(0,b.jsx)("label",{style:{height:"100%",alignItems:"flex-start",justifyContent:"center",display:"flex",cursor:l?void 0:"pointer",zIndex:1},onClick:me.Wi,onMouseDown:me.$0,children:(0,b.jsx)("div",{style:{width:`${Kr.bu}px`,height:Kr.bu-1+"px",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,b.jsx)("input",{type:"checkbox",style:y.checkBoxInput,ref:S,checked:!0===t,onChange:C,disabled:l})})})})}),(null==c?void 0:c.shouldFreezeMultiSelectColumn)&&(0,b.jsx)(il,{passesFilter:s,isCheckbox:!0,isScrolled:!0})]})})}var sl=o(18514),ll=o(81415),al=o(84169);function cl(e){const{href:t,style:o}=e,r=(0,u.yK)((e=>({default:{display:"flex",marginTop:7,marginBottom:7,alignItems:"center",cursor:"pointer",textDecoration:"none",pointerEvents:"auto",width:"fit-content",color:e.mediumTextColor}})),[]);return(0,b.jsxs)("a",{href:t,target:"_blank",style:{...r.default,...o},children:[(0,al.m)({width:14,marginRight:4}),(0,b.jsx)(B.FormattedMessage,{id:"LearnMoreLink.learnMore",defaultMessage:"Learn more"})]})}var dl=o(71424);function ul(e){const{origin:t,propertyType:o}=e,r=(0,a.O7)();return(0,b.jsx)(ll.U,{origin:t,placementToOrigin:"bottom",header:function(){switch(o){case"owner":return(0,b.jsx)(B.FormattedMessage,{id:"WikiPropertiesOnboardingTooltip.header.ownerProperty",defaultMessage:"Owner"});case"verification":return(0,b.jsx)(B.FormattedMessage,{id:"WikiPropertiesOnboardingTooltip.header.verificationProperty",defaultMessage:"Verification"});case"tags":return(0,b.jsx)(B.FormattedMessage,{id:"WikiPropertiesOnboardingTooltip.header.tagsProperty",defaultMessage:"Add tags and more"});default:(0,ut.t1)(o)}}(),content:function(){switch(o){case"owner":return(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Owners are responsible for keeping the page updated. By default, the owner is the page creator",id:"WikiPropertiesOnboardingTooltip.content.ownerProperty",values:{bold:e=>(0,b.jsx)("span",{style:{fontWeight:D.Z.fontWeight.semibold},children:e})}});case"verification":return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Page owners can mark a page as verified or expired, to help viewers understand whether they can trust the content",id:"WikiPropertiesOnboardingTooltip.content.verificationProperty"}),(0,b.jsx)(cl,{href:(0,sl.UY)("guides.wikis"),style:{color:xe.ZP.uiLightGray}})]});case"tags":return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Customize your wiki with tags or other database properties",id:"WikiPropertiesOnboardingTooltip.content.tagsProperty"}),(0,b.jsx)(cl,{href:(0,sl.UY)("guides.databaseProperties"),style:{color:xe.ZP.uiLightGray}})]});default:(0,ut.t1)(o)}}(),numSteps:3,currStepIndex:function(){switch(o){case"owner":return 0;case"verification":return 1;case"tags":return 2;default:(0,ut.t1)(o)}}(),onCloseClick:()=>{Xs.nX(r)},onPrimaryButtonClick:()=>Xs.Rg(r),onBackButtonClick:()=>Xs.FO(r),shouldDismissUponOutsideClick:!0,pointerLength:dl.EZ,pointerOffset:dl.FD,style:{width:dl.G5}})}class pl extends p.default{getInitialState(){return{}}}const hl=pl;var ml=o(33125),Sl=o(34078),gl=o(27948),Cl=o(97820),fl=o(43224),yl=o(19124),vl=o(67695),xl=o(80951),bl=o(12396),wl=o(79362),kl=o(8597),_l=o(88437),Tl=o(44643),Ol=o(44495),Vl=o(16184),Pl=o(20669),Rl=o(4635),Ml=o(23903),jl=o(79310),Il=o(59753),Fl=o(19889),Bl=o(34993),Nl=o(16956),Dl=o(80402),Ll=o(44866),El=o(34517),Al=o(93174),Hl=o(17095),Zl=o(27871),zl=o(71214),Gl=o(23159),Kl=o(30905),Ul=o(28992),Wl=o(74420),$l=o(86825),ql=o(42402),Ql=o(83212);class Yl extends s.Z{constructor(){super(...arguments),this.storeTypes={propertyTypeButtonPopupStore:mo.Z,inputStore:p.default.createClass(""),showPropertyDescriptionStore:p.default.createClass(!1)},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyNameSubmit=e=>oa(e,this.environment,this.props.property,this.props.schema,this.props.collectionContextStore,this.stores.inputStore),this.isRightmostFrozen=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.frozoneStore.state.frozenIndex;return Boolean(this.props.columnIndex===t)})),this.canFreezeThisColumn=this.createComputedStore((()=>{const{collectionContextStore:e,columnIndex:t}=this.props,{frozenIndex:o,scrollerWidth:r}=e.frozoneStore.state,i=this.props.collectionContextStore.collectionViewStore();if(void 0===o)return!1;return t>((null==i?void 0:i.getTableMaxFrozenColumnIndex(r,e.normalizedFormatStore.state))??-1)}))}UNSAFE_willMountOrUpdate(e){const{property:t,schema:o,collectionContextStore:r}=e,i=o[t];if(i&&"relation"===i.type){const e=Es.ny(r,i);null==e||e.load()}}renderComponent(){const{device:e}=this.environment;let t;t=e.isMobile?{menuType:ke.og.ActionSheet}:{menuType:ke.og.Popup,minWidth:220};const o=this.getMenuSections(this.props.parent);return(0,b.jsx)(Te.Z,{...t,children:(0,b.jsx)(Oe.Z,{type:Oe.i.Vertical,initialFocus:void 0,sections:N.oA(o.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>(0,b.jsx)(Pe.Z,{...e,topBorder:0!==t}),items:e}})))})})}getMenuSections(e){var t;const{property:o,schema:r,collectionContextStore:i,formatKey:n,allowHidingTitle:s,format:l,intl:a}=this.props,{environment:c,theme:d}=this,{device:u}=c,p=r[o],h=i.permissionScopes.state,m=i.isCompactView.state,S=i.settingsStore,g=i.collectionViewStore(),C=i.collectionStore();if(!g||!p)return[];const f=(0,lo.w)(o),y=Boolean((null===(t=Jl(this.props.format,this.props.formatKey,this.props.property))||void 0===t?void 0:t.wrap)||g.getFormat().table_wrap)&&"timeline"!==g.getType(),x=i.databaseType,w=Boolean(C&&x&&oe.cR((0,El.appConfigs)(),x,o,C)),k="title"===p.type,_=[];if(f&&"person"===p.type){const e=[];_.push(e),e.push({key:"synced_person",render:e=>(0,b.jsx)(Ul.Z,{...e,title:p.name||"",icon:(0,Ol.D)({width:14}),caption:(0,b.jsx)("div",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",minWidth:300,maxWidth:350},children:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"People synced from external sources may require additional set up. Visit <helpcenterlink>the help center</helpcenterlink> for more information.",id:"database.tableHeaderCell.syncedPersonPropertyCaption",values:{helpcenterlink:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return(0,b.jsx)(ql.Z,{href:(0,sl.UY)("guides.syncedContent"),children:t})}}})})}),action:()=>{}})}const T=[];if(_.push(T),h.canConfigureCollection&&!f){const t=Boolean(this.stores.showPropertyDescriptionStore.state);T.push({key:"rename",render:o=>(0,b.jsxs)(Pe.Z,{children:[(0,b.jsx)(zl.I,{...o,initialValue:p.name||"",placeholder:ho.default.formatMessage(gl.Z.inputPlaceholder),focusInitial:!0,inputStore:this.stores.inputStore,onBlur:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyNameSubmit,onSubmit:t=>{oa(t,this.environment,this.props.property,this.props.schema,this.props.collectionContextStore,this.stores.inputStore),e.close()},iconButton:{icon:e=>(0,b.jsx)(bl.ZP,{type:p.type,icon:p.icon,size:16,theme:d,style:e}),iconStyle:{fill:wl.Lr[d.mode].gray},enforceIconColor:"gray",onSubmit:(e,t)=>function(e,t,o,r,i){const n=t.collectionStore();if(!n)return;ee.createAndCommit({userAction:"TableHeaderCell.handlePropertyIconSubmit",environment:o,perform:t=>{Nl.OK({collectionStore:n,property:e,icon:r,transaction:t})}}),E.$q({environment:o,collectionContextStore:t,property:e,icon:r,from:"table",action:"change_icon"})}(this.props.property,this.props.collectionContextStore,this.environment,e)},inputRightButton:(0,b.jsx)(Hl.l,{description:p.description,showTooltip:!t,onClick:()=>this.stores.showPropertyDescriptionStore.setState(!t),addDescriptionText:a.formatMessage(fl.aB.addPropertyDescriptionTooltip),editDescriptionText:a.formatMessage(fl.aB.editPropertyDescriptionTooltip)})}),ta(this.props.property,this.props.schema,this.stores.inputStore)&&(0,b.jsx)(Gl.Z,{propertyName:this.stores.inputStore.state,styles:u.isMobile?{paddingBottom:5,paddingLeft:16,paddingRight:16,margin:0,boxShadow:`inset 0 -1px 0 ${d.regularDividerColor}`}:{}})]}),action:()=>{E.wd({environment:this.environment,collectionContextStore:i,action:"table_header_rename"}),pe.n1({collectionContextStore:i}),e.close()}}),t&&T.push({key:"description",render:e=>(0,b.jsx)(Pe.Z,{...e,desktopStyle:{paddingTop:0},title:u.isMobile?a.formatMessage(Zl.k.descriptionHeader):void 0,children:(0,b.jsx)(Zl.i,{initialDescription:p.description,handleSaveDescription:e=>function(e,t,o,r){var i;const n=o.collectionStore(),s=null==n||null===(i=n.getSchema())||void 0===i?void 0:i[r];if(!n||void 0===s||e===s.description)return;ee.createAndCommit({userAction:"CollectionSettingsProperty.handleDescriptionChange",environment:t,perform:o=>{pe.xO({environment:t,collectionStore:n,update:{[r]:{...s,description:e}},transaction:o})}}),E.$q({environment:t,collectionContextStore:o,property:r,from:"view_properties",action:"set_description"})}(e,this.environment,this.props.collectionContextStore,this.props.property),disableAutoSection:!0})}),action:N.ZT})}if(!h.canConfigureBlock||f||null!=C&&C.isNonEditableState()||T.push({key:"edit_property",render:e=>(0,b.jsx)(Xe.ZP,{placement:Xe.ug.Left,render:t=>(0,b.jsx)($e.Z,{title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Edit property",id:"database.tableHeaderCell.editProperty"}),icon:(0,Rl.W)({width:14}),...(0,Ze.Z)(e,t)}),style:{whiteSpace:"normal"},renderTooltip:()=>(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Edit property name, type, and other options...",id:"database.tableHeaderCell.editPropertyTooltip"})}),action:()=>{E.wd({environment:this.environment,collectionContextStore:i,action:"table_header_edit"}),pe.n1({collectionContextStore:i}),e.close(),z.r$({collectionContextStore:i,collectionSettingsStore:S}),z.H4({collectionSettingsStore:S,item:{type:"properties",timelineViewTab:"table"}}),z.H4({collectionSettingsStore:S,item:{type:"property",formatKey:n,property:o}})}}),h.canConfigureCollection&&!f&&C&&(0,yl.Zt)(this.environment)&&(0,fe.qQ)(p)&&("text"===p.type||(0,yl.KZ)())){const t=(0,fe.q3)(p),r=Xt.De(C.getFormat(),o),s=r.isRunning||!C||!(0,yl.mX)(c,Ql.Z.getMode(c,C),C);t?T.push({key:"fill_all_pages",render:e=>(0,b.jsx)(Xe.ZP,{placement:Xe.ug.Left,renderTooltip:()=>(0,b.jsx)(Kl.qQ,{collectionStore:C,propertySchema:p}),render:t=>(0,b.jsx)($e.Z,{titleStyle:{color:s?d.lightTextColor:void 0},disabled:s,icon:(0,b.jsx)(Kl.Xh,{updateAiInferencesTaskStatus:r,iconStyle:{marginLeft:-1,marginRight:-1},progressIconStyle:{marginTop:4,marginLeft:0,marginRight:-3}}),title:(0,b.jsx)(Kl.ZP,{updateAiInferencesTaskStatus:r}),caption:void 0!==r.numPagesFilled&&void 0!==r.numPagesRequested&&(0,b.jsx)(Kl.Y7,{updateAiInferencesTaskStatus:r}),...(0,Ze.Z)(e,t)})}),action:async()=>{await Ll.autofillPropertyForCollection({environment:c,collectionStore:C,propertySchema:p,property:o})}}):T.push({key:"autofill_with_ai",render:e=>(0,b.jsx)($e.Z,{disabled:void 0===C,title:(0,b.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Set up AI autofill",id:"database.tableHeaderCell.autofillWithAI"}),(0,b.jsx)(Wl.Z,{style:{display:"inline-block"}})]}),icon:(0,Pl.y)({width:14,fill:d.aiPurpleColor}),...e}),action:()=>{C&&(e.close(),z.r$({collectionContextStore:i,collectionSettingsStore:S}),z.H4({collectionSettingsStore:S,item:{type:"properties",timelineViewTab:"table"}}),z.H4({collectionSettingsStore:S,item:{type:"property",formatKey:n,property:o}}),"text"===p.type&&z.H4({collectionSettingsStore:S,item:{type:"propertyAiAutofill",propertySchema:p,property:o}}))}})}if(h.canConfigureBlock&&((0,xl.bA)(p)||(0,xl.Kf)(p))){const t=[];_.push(t),(0,xl.bA)(p)&&(t.push({key:"sort_asc",render:e=>(0,b.jsx)($e.Z,{...e,title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Sort ascending",id:"database.tableHeaderCell.sortAscending"}),icon:(0,kl.Z)({width:14})}),action:()=>{E.wd({environment:this.environment,collectionContextStore:i,action:"table_header_sort_asc"}),e.close(),function(e,t,o,r){Xl(!0,e,t,o,r)}(this.props.property,this.props.collectionContextStore,this.props.schema,this.environment)}}),t.push({key:"sort_desc",render:e=>(0,b.jsx)($e.Z,{...e,title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Sort descending",id:"database.tableHeaderCell.sortDescending"}),icon:(0,Kt.M)({width:14})}),action:()=>{E.wd({environment:this.environment,collectionContextStore:i,action:"table_header_sort_desc"}),e.close(),function(e,t,o,r){Xl(!1,e,t,o,r)}(this.props.property,this.props.collectionContextStore,this.props.schema,this.environment)}})),(0,xl.Kf)(p)&&t.push({key:"filter",render:e=>(0,b.jsx)($e.Z,{...e,title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Filter",id:"database.tableHeaderCell.filter"}),icon:(0,v.Q)({width:14})}),action:()=>{"collectionVirtualView"!==i.contextType&&(E.wd({environment:this.environment,collectionContextStore:i,action:"table_header_filter"}),e.close(),function(e,t,o,r){const i=t.currentPropertyFiltersStore.state,n=t.collectionViewBlockStore(),s=(null==n?void 0:n.getRecordModel)??Il.om.constant(void 0);let l=i.find((t=>{let{filter:o}=t;return o.property===e}));if(!l){const n=(0,ao.H_)({property:e,schema:o,getRecordModel:s});if(!n)return;const a={id:(0,uo.ZP)(),filter:n};t.filtersBarOpen.setState(!0),Bl.iU({environment:r,collectionContextStore:t,temporaryState:{...t.temporaryState.state,propertyFilters:{value:[...i,a]}}}),l=a}if(!l)return;const a=t.getFilterBarItemSettingsStore(l);z.wl({collectionSettingsStore:a,item:{type:"filter"}}),pe.n1({collectionContextStore:t})}(this.props.property,this.props.collectionContextStore,this.props.schema,this.environment))}})}const V=[];if(_.push(V),(s||"title"!==p.type)&&h.canConfigureBlock&&V.push({key:"hide",render:e=>(0,b.jsx)($e.Z,{...e,title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Hide in view",id:"database.tableHeaderCell.hideInView"}),icon:(0,Tl.L)({width:22,marginLeft:-4,marginRight:-4})}),action:()=>{E.wd({environment:this.environment,collectionContextStore:i,action:"table_header_hide"}),e.close(),function(e,t,o,r,i,n){const s=e.collectionViewStore();if(!s)return;const l=o[r]||[],a=l.map((e=>e.property===t?{...e,visible:!1}:e)),c={...o,[r]:a};ee.createAndCommit({userAction:"TableHeaderCell.updatePropertyFormat",environment:n,perform:t=>{pe.iG({collectionViewStore:s,update:{format:c},transaction:t}),Dl.oz({environment:n,collectionContextStore:e,currentIndex:i,entrypoint:"TableHeaderCell",transaction:t,propertyAction:"hide"})}})}(this.props.collectionContextStore,this.props.property,this.props.format,this.props.formatKey,this.props.columnIndex,this.environment)}}),h.canConfigureBlock&&!m&&!u.isPhone){const e=this.canFreezeThisColumn.state;V.push({key:"freeze_column",render:t=>(0,b.jsx)(Xe.ZP,{placement:Xe.ug.Left,disableTooltip:!e,renderTooltip:e=>(0,b.jsx)(B.FormattedMessage,{...e,defaultMessage:"Insufficient space to freeze columns",id:"database.tableHeaderCell.freezePropertyTooltip",description:"If the width of the frozen columns is wider than the screen, show the user this tooltip warning."}),render:o=>(0,b.jsx)($e.Z,{...t,...o,disabled:e,buttonStyle:{color:e?this.theme.text.quaternary:void 0},title:this.isRightmostFrozen.state?(0,b.jsx)(B.FormattedMessage,{defaultMessage:"{numberFrozenColumns, plural, one {Unfreeze column} other {Unfreeze columns}}",values:{numberFrozenColumns:this.props.columnIndex+1},id:"database.tableHeaderCell.unfreezeColumns"}):(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Freeze up to column",id:"database.tableHeaderCell.freezeUpToColumn"}),icon:this.isRightmostFrozen.state?(0,jl.A)({width:14}):(0,Ml.P)({width:12,margin:"0px 1px"})})}),action:()=>{!function(e,t,o){ee.createAndCommit({userAction:"TableHeaderCell.handleFreezeColumns",environment:o,perform:r=>{Dl.oz({environment:o,collectionContextStore:e,currentIndex:t,transaction:r,entrypoint:"TableHeaderCell",propertyAction:"toggle"})}})}(this.props.collectionContextStore,this.props.columnIndex,this.environment)}})}if(!yo.Tr.includes(p.type)||(0,fe.dx)(p)||!h.canConfigureCollection||f||k||V.push({key:"duplicate",render:e=>(0,b.jsx)($e.Z,{...e,title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Duplicate property",id:"database.tableHeaderCell.duplicateProperty"}),icon:(0,_l.a)({width:14})}),action:async()=>{E.wd({environment:this.environment,collectionContextStore:i,action:"table_header_duplicate"}),e.close(),await async function(e,t,o,r,i,n){const s=Jl(i,o,e),l=t.collectionStore(),a=t.collectionViewStore(),c=t.normalizedFormatStore.state[o]||[],d=null==l?void 0:l.getSpaceId();if(!(l&&a&&d&&s))return;const u=l.getSchema(),p=u[e];if(!p)return;const h=await(0,ce.xy)({schema:u,property:e,properties:c,parentStore:l,spaceId:d});if(!h)return;const m=n.currentUser.id,S=m?{id:m,table:Fl.KJ}:void 0,{automationActions:g}=await Al._1.loader();ee.createAndCommit({userAction:"TableHeaderCell.handleDuplicate",environment:n,perform:e=>{pe.xO({environment:n,collectionStore:l,update:{[h.newProperty]:h.newPropertySchema},transaction:e}),Dl.oz({environment:n,collectionContextStore:t,currentIndex:r,entrypoint:"TableHeaderCell",transaction:e,propertyAction:"duplicate"}),(0,ut.$K)(h.automationUpdate)&&g.duplicateAutomation({actorPointer:S,environment:n,sourceAutomationStore:h.automationUpdate.sourceAutomationStore,targetAutomationId:h.automationUpdate.targetAutomationId,transaction:e}),o&&Jt.FH({stores:[a],update:{[o]:h.newProperties},transaction:e})}}),E.wd({environment:n,collectionContextStore:t,action:"duplicate_property",original_view_type:null==a?void 0:a.getType(),property_type:p.type})}(this.props.property,this.props.collectionContextStore,this.props.formatKey,this.props.columnIndex,this.props.format,this.environment)}}),yo.Tr.includes(p.type)&&h.canConfigureCollection&&!f&&!k&&V.push({key:"delete",render:e=>(0,b.jsx)(Xe.ZP,{placement:Xe.ug.Left,disableTooltip:!w,renderTooltip:e=>(0,vn.A7)(x,e),render:t=>(0,b.jsx)($e.Z,{...e,...t,disabled:w,disabledFeedback:w,title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Delete property",id:"database.tableHeaderCell.deleteProperty"}),caption:this.environment.device.isMobile&&w?(0,vn.A7)(x):null,icon:w?(0,b.jsx)("div",{...t,children:(0,Vl.Q)({width:14})}):(0,O.y)({width:14}),isRedOnHover:!0})}),action:async()=>{e.close(),await async function(e,t,o,r,i,n){await Nl.TI({environment:i,collectionContextStore:e,property:t,handleDeleteAccept:()=>function(e,t,o,r,i){const n=o.collectionStore();if(!n)return;const s=n.getSchema()[e];ee.createAndCommitAsync({environment:i,userAction:"TableHeaderCell.handleDeleteAccept",waitForServerCommit:!1,perform:async s=>{await Nl.yV({environment:i,collectionStore:n,schema:t,property:e,transaction:s}),Dl.oz({environment:i,collectionContextStore:o,currentIndex:r,entrypoint:"TableHeaderCell",transaction:s,propertyAction:"delete"})}}),s&&E.y9({environment:i,collectionContextStore:o,property_type:s.type,from:"table_column",property:e})}(t,o,e,r,i),theme:n,from:"table_column"})}(this.props.collectionContextStore,this.props.property,this.props.schema,this.props.columnIndex,this.environment,this.theme)}}),h.canConfigureBlock&&"timeline"!==g.getType()){const e=[];_.push(e),e.push({key:"wrap_cell",render:e=>(0,b.jsx)($l.Z,{...e,title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Wrap column",id:"database.tableHeaderCell.wrapColumn"}),on:y}),action:()=>{Dl.K4({currentValue:y,environment:this.environment,property:o,collectionViewStore:g,format:l,formatKey:n}),E.wd({environment:this.environment,collectionContextStore:i,action:"table_header_wrap_column"})}})}return _}}function Xl(e,t,o,r,i){if(!r[t])return;const n=[{property:t,direction:e?"ascending":"descending"}];o.filtersBarOpen.setState(!0),Bl.iU({environment:i,collectionContextStore:o,temporaryState:{...o.temporaryState.state,sorts:{value:n}}}),pe.n1({collectionContextStore:o})}function Jl(e,t,o){var r;return null===(r=e[t])||void 0===r?void 0:r.find((e=>e.property===o))}Yl.displayName="TableHeaderCellMenu";const ea=(0,B.injectIntl)(Yl);function ta(e,t,o){const r=o.state,i=Object.keys(t).find((o=>{var i;return o!==e&&(null===(i=t[o])||void 0===i?void 0:i.name)===r}));return Boolean(i)}function oa(e,t,o,r,i,n){if(ta(o,r,n))return;const s=i.collectionStore();if(!s)return;const l=s.getSchema()[o];(null==l?void 0:l.name)!==e&&(ee.createAndCommit({userAction:"TableHeaderCell.handlePropertyNameSubmit",environment:t,perform:t=>{Nl.Bv({collectionStore:s,property:o,name:e,transaction:t})}}),E.$q({environment:t,collectionContextStore:i,property:o,from:"view_settings",action:"rename"}))}const ra={fontSize:14},ia=i.memo((function(e){let{allowHidingTitle:t,collectionContextStore:o,columnIndex:r,disableCellRightBorder:n,disabled:s,format:l,formatKey:c,isLast:p,paddingTop:h,property:m,renderSpacer:S,schema:g,width:C}=e;const f=(0,i.useRef)(null);(0,ml.c)(vl.Z,(()=>({collectionContextStore:o,property:m,getNode:()=>f.current})),[o,m]);const y=(0,a.O7)(),v=(0,a.Fy)(),[x,w]=(0,i.useState)(!1),k=(0,d.VK)((()=>o.permissionScopes.state),[o.permissionScopes]),_=(0,d.qz)(void 0,mo.Z),{isRightMostFrozenColumn:T,isScrolled:O}=(0,d.VK)((()=>{const{frozenIndex:e,isScrolled:t}=o.frozoneStore.state;return{isRightMostFrozenColumn:e===r,isScrolled:t}}),[o.frozoneStore,r]),V=(0,u.yK)((e=>({div:{display:"flex",flexShrink:0,overflow:"hidden",fontSize:14,padding:0,width:C,borderRight:n?void 0:`1px solid ${e.tableDividerColor}`},description:{color:e.mediumInvertedTextColor},aiUpdate:{color:e.mediumInvertedTextColor}})),[C,n]),P=(0,i.useCallback)((()=>{J.ZH(y),Y.ZH(y),pe.wG()}),[y]),R=(0,i.useCallback)((e=>{v.isMobile||(e.preventDefault(),(0,me.ZP)({event:e,context:me.Af.EditorContextMenu,callback:()=>{P(),_.setState({open:!0})}}))}),[v,_,P]),M=(0,i.useCallback)((e=>{w(e)}),[w]),j=g[m];return j?(0,b.jsx)("div",{ref:f,style:V.div,className:fo.VMO,onContextMenu:R,children:(0,b.jsx)(qe.ZP,{popupType:v.isMobile?Ye.kQ.SlideUp:Ye.kQ.Popup,disabled:!k.canConfigureBlock,originGap:1,alignmentToOrigin:qe.vR.Start,buttonPopupStore:_,renderOrigin:e=>(0,b.jsx)(Xe.ZP,{renderTooltip:e=>{const t=(0,fe.qQ)(j)&&("text"===j.type||(0,yl.KZ)())&&(0,fe.q3)(j);return(0,b.jsxs)("div",{...e,style:fl.F6,children:[(0,b.jsx)("div",{children:j.name}),void 0!==(null==j?void 0:j.description)&&j.description.length>0?(0,b.jsx)("div",{style:V.description,children:j.description}):null,t&&t.auto_update_on_edit&&(0,b.jsx)("div",{style:V.aiUpdate,children:(0,b.jsx)(B.FormattedMessage,{...gl.Z.keptUpToDateWithNotionAITooltip})})]})},delayThreshold:x?0:500,placement:Xe.ug.Right,render:t=>{var o;return(0,b.jsxs)(Yt.Z,{style:{display:"flex",alignItems:"center",width:"100%",height:"100%",paddingLeft:8,paddingRight:8,paddingTop:h},disabled:s,...(0,Ze.Z)(t,e),children:[S&&S(p),(0,b.jsx)(Cl.Z,{propertySchema:j,showIcon:!0,badge:(0,b.jsxs)(b.Fragment,{children:[!(null===(o=j.description)||void 0===o||!o.length)&&!v.isMobile&&(0,b.jsx)(Sl.Z,{setIsHovered:M}),(0,b.jsx)(Cl.o,{propertySchema:j})]}),style:ra,property:m}),T&&(0,b.jsx)(il,{passesFilter:!0,isScrolled:Boolean(O)})]})}}),render:e=>(0,b.jsx)(ea,{allowHidingTitle:t,collectionContextStore:o,columnIndex:r,format:l,formatKey:c,property:m,schema:g,parent:e}),onClick:P})}):null}));var na=o(35011),sa=o(6685),la=o(58299);const aa={position:"absolute",right:0,width:0,flexGrow:0,zIndex:1};function ca(e){let{leftFormat:t,height:o,onTemporaryResize:r,onAccept:n,onCancel:s,propertySchema:l,resultStore:c}=e;const d=(0,i.useRef)(void 0),u=d.current,p=(0,a.Fy)(),[h,m]=(0,i.useState)(!1),[S,g]=(0,i.useState)(!1),C=(S||h)&&!p.isPhone,f=(0,i.useCallback)((e=>{if(u&&u.width){const o=Math.max(u.width+e.diffX,ma(l,t,u.width,e.optionKey));return{...u,width:o}}}),[t,l,u]),y=(0,i.useCallback)((e=>{e.preventDefault(),d.current=t,g(!0)}),[t]),v=(0,i.useCallback)((e=>{const t=f(e);t&&r(t)}),[f,r]),x=(0,i.useCallback)((e=>{const t=f(e);t&&n(t),g(!1)}),[f,n]),w=(0,i.useCallback)((()=>{s(),d.current=void 0,g(!1)}),[s]),k=(0,i.useCallback)((e=>{const o=c.state?c.state.blockIds:[],r=N.oA(o.map((e=>{const o=la.Z.findBlockPropertyValueByBlockId(e,t.property),r=null==o?void 0:o.getNode();if(r)return function(e){const t=e.cloneNode(!0);let o=!1;"relative"===(null==e?void 0:e.style.position)&&(e.style.position="unset",o=!0);const r=getComputedStyle(e);for(let s=0;s<r.length;s++){const e=r[s],o=r.getPropertyValue(e);t.style[e]=o}o&&(e.style.position="relative");t.id="notion-table-view-cell-shadow",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.width="auto",t.style.opacity="0",t.style.display="flex",t.style.position="absolute";const i=t.querySelectorAll("*");for(const s of i)s.style&&(s.style.pointerEvents="none",s.style.width="auto");document.body.appendChild(t);const n=t.getBoundingClientRect();return t.remove(),null!=n&&n.width?Math.ceil(n.width)+1:void 0}(r)})));if(t.width){const e={...t,width:Math.min(800,Math.max(Math.max(...r),ma(l,t,t.width)))};n(e)}}),[t,n,l,c]),_=(0,i.useCallback)((e=>(0,b.jsx)("div",{style:C?ga(o):Sa(o),onDoubleClick:k,...e})),[k,o,C]);return(0,b.jsx)("div",{style:aa,onMouseMove:()=>m(!0),onMouseLeave:()=>m(!1),children:(0,b.jsx)(sa.Z,{onDraggableDragStart:y,onDraggableDragMove:v,onDraggableDragEnd:x,onDraggableDragCancel:w,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,render:_})})}const da=i.memo(ca);const ua=32,pa=64,ha=100;function ma(e,t,o){if(arguments.length>3&&void 0!==arguments[3]&&arguments[3])return ua;const r=function(e,t){if("checkbox"===(null==e?void 0:e.type))return ua;if("status"===(null==e?void 0:e.type)&&"checkbox"===t.statusShowAs)return ua;var o;if(("number"===(null==e?void 0:e.type)||"formula"===(null==e?void 0:e.type)&&"number"===(0,na.mm)(e))&&"ring"===(null==e||null===(o=e.show_as)||void 0===o?void 0:o.type))return ua;if("auto_increment_id"===(null==e?void 0:e.type))return pa;return ha}(e,t);return o&&o<r?ua:r}function Sa(e){return{width:5,marginLeft:-3,marginTop:-1,height:e,transition:"background 200ms ease-out",background:xe.ZP.blueWithAlpha(0),cursor:"col-resize"}}function ga(e){return{...Sa(e),background:xe.ZP.blueWithAlpha(.8)}}const Ca=32,fa={display:"flex",width:Ca,height:"100%",alignItems:"center",justifyContent:"center"};class ya extends s.Z{constructor(){super(...arguments),this.storeTypes={tableHeaderRowStore:hl,resultStore:p.default.createClass(void 0)},this.propertyRef=i.createRef(),this.renderHeaderRowCells=(e,t,o)=>{var r,i,n,s;const{device:l}=this.environment,{store:a,collectionContextStore:c,schema:d,query:u,disabled:p,formatKey:h,disableCellRightBorder:S,renderSpacer:g,allowHidingTitle:C,paddingTop:f,showRightActions:y}=this.props,{resultStore:v}=this.stores,x=wa(this.props.format,this.props.tableStore),w=this.props.showPropertyFormats[t],k=Xs.B1(),_=(null===(r=c.collectionStore())||void 0===r?void 0:r.getFormat().app_config_uri)===m.GZ&&a.isCollectionViewPageWithContent()&&a.id===(null===(i=c.collectionViewBlockStore())||void 0===i?void 0:i.id),T=_&&e===Qs.k.Owner&&"owner"===k,O=_&&"verification"===(null===(n=d[e])||void 0===n?void 0:n.type)&&"verification"===k,V=_&&"multi_select"===(null===(s=d[e])||void 0===s?void 0:s.type)&&"tags"===k,P=!l.isMobile&&(T||O||V),R=S||o&&!ba(p,y),M=(0,Kr.vf)({environment:this.environment,propertyFormat:w}),j=(0,b.jsxs)(b.Fragment,{children:[P&&(0,b.jsx)(ul,{origin:this.propertyRef,propertyType:k}),w&&M&&(0,b.jsx)(ia,{format:x,schema:d,query:u,property:e,width:M,collectionViewBlockStore:a,collectionContextStore:c,disabled:p,formatKey:h,isLast:o,disableCellRightBorder:R,allowHidingTitle:C,renderSpacer:g,paddingTop:f,columnIndex:t,groupsPointer:this.groupsPointerStore.state}),!p&&!l.isPhone&&(0,b.jsx)(da,{leftFormat:w,onTemporaryResize:e=>function(e,t,o,r){t.setState({...t.state,temporaryFormat:_a(e,o,r,t)})}(e,this.props.tableStore,this.props.formatKey,this.props.format),onAccept:e=>function(e,t,o,r,i,n){const s=t.collectionViewStore();if(!s)return;const l=wa(r,i),a=ka(o,r,i).map((t=>t.property===e.property?e:t)),c={...l,[o]:a};ee.createAndCommit({userAction:"TableHeaderRow.handleColumnResizeAccept",environment:n,perform:e=>{pe.iG({collectionViewStore:s,update:{format:c},transaction:e})}}),i.setState({...i.state,temporaryFormat:void 0}),E.wd({environment:n,collectionContextStore:t,action:"table_resize_columns"})}(e,this.props.collectionContextStore,this.props.formatKey,this.props.format,this.props.tableStore,this.environment),onCancel:()=>{var e;(e=this.props.tableStore).setState({...e.state,temporaryFormat:void 0})},height:this.props.height,propertySchema:d[e],resultStore:v})]});return(0,b.jsx)("div",{style:{display:"flex",position:"relative"},ref:P?this.propertyRef:void 0,children:j},e)},this.shouldShowMultiSelectCheckboxStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return(0,ce.fk)({environment:this.environment,collectionContextStore:e})})),this.groupsPointerStore=this.createComputedStore((()=>{const{groupFormat:e}=this.props;return e?[e]:[]}),!0),this.showPropertiesStore=this.createComputedStore((()=>this.props.showPropertyFormats.map((e=>e.property))),!0)}renderComponent(){const{disabled:e,showRightActions:t,disableHorizontalEdgeScroll:o,collectionContextStore:r,frozoneProps:i}=this.props,n=r.permissionScopes.state,s=null==i?void 0:i.frozenIndex,l=(0,ce.bW)(s),a=null==i?void 0:i.frozenStyles.left,c={...this.shouldShowMultiSelectCheckboxStore.state?{...null==i?void 0:i.frozenStyles,left:Kr.Xx+(a??0)}:null==i?void 0:i.frozenStyles},d=this.showPropertiesStore.state.slice(0,l),u=this.showPropertiesStore.state.slice(l),p=ba(e,t)?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(Pa,{collectionContextStore:this.props.collectionContextStore}),(0,b.jsx)(Ra,{collectionContextStore:this.props.collectionContextStore})]}):null,h=this.shouldShowMultiSelectCheckboxStore.state&&(0,b.jsx)(va,{groupsPointer:this.groupsPointerStore.state,collectionContextStore:r,frozoneProps:i}),m=ft(r.isCompactView.state);return e||!n.canConfigureBlock?(0,b.jsx)(Mt,{position:m,children:(0,b.jsxs)("div",{className:fo.kUP,style:Oa(this.props.collectionContextStore,this.props.isInPeekRenderer,this.props.height,this.props.minWidth,this.theme,this.props.isInHomeWidget,this.props.disableTopBorder),children:[h,(0,b.jsxs)("div",{style:Js.l8,children:[(0,b.jsx)("div",{style:{display:"flex",...c},children:d.map(((e,t)=>this.renderHeaderRowCells(e,t,t===this.showPropertiesStore.state.length-1)))}),u.map(((e,t)=>this.renderHeaderRowCells(e,t+l,t===this.showPropertiesStore.state.length-1)))]}),p,this.props.children]})}):(0,ce.Ql)(s)?(0,b.jsx)(Mt,{position:m,children:(0,b.jsxs)("div",{className:fo.kUP,style:Oa(this.props.collectionContextStore,this.props.isInPeekRenderer,this.props.height,this.props.minWidth,this.theme,this.props.isInHomeWidget,this.props.disableTopBorder),children:[h,(0,b.jsx)(el.Z,{style:{display:"flex"},direction:"horizontal",keys:this.showPropertiesStore.state,sectionedKeys:{frozen:d,unfrozen:u},sectionStyles:{frozen:{display:"flex",...c},unfrozen:{display:"flex"}},renderKey:this.renderHeaderRowCells,onDrop:e=>Va(e,this.props.collectionContextStore,this.props.formatKey,this.props.format,this.props.tableStore,this.environment),disableHorizontalEdgeScroll:o}),p,this.props.children]})}):(0,b.jsx)(Mt,{position:m,children:(0,b.jsxs)("div",{className:fo.kUP,style:{...Oa(this.props.collectionContextStore,this.props.isInPeekRenderer,this.props.height,this.props.minWidth,this.theme,this.props.isInHomeWidget,this.props.disableTopBorder)},children:[h,(0,b.jsx)(Js.ZP,{direction:"horizontal",keys:this.showPropertiesStore.state,renderKey:this.renderHeaderRowCells,onDrop:e=>Va(e,this.props.collectionContextStore,this.props.formatKey,this.props.format,this.props.tableStore,this.environment),disableHorizontalEdgeScroll:o}),p,this.props.children]})})}}function va(e){const{groupsPointer:t,collectionContextStore:o,frozoneProps:r}=e,n=(0,a.O7)(),s=(0,i.useCallback)((()=>(0,Go.A7)(t[0],o).filter((e=>e.canEdit()))),[o,t]),l=(0,d.VK)((()=>0===s().length),[s]),c=(0,d.VK)((()=>{const e=s(),t=e.length;if(0===t)return!1;const o=Jo.default.state.stores.filter((t=>e.includes(t))).length;return 0!==o&&(o===t||"indeterminate")}),[s]),u=(0,i.useCallback)((e=>{var t;const r=s(),i=Jo.default.state.stores,l=(0,Kr.vg)({collectionViewBlockId:null===(t=o.collectionViewBlockStore())||void 0===t?void 0:t.id})?[]:i;!1===c||"indeterminate"===c?Y.Z5({environment:n,stores:N.G0(l,r)}):!0===c&&Y.Z5({environment:n,stores:N.zu(l,...r)}),e.stopPropagation()}),[c,o,n,s]),p=(0,d.VK)((()=>({...null==r?void 0:r.frozenStyles,...-1===(null==r?void 0:r.frozenIndex)?{background:void 0}:{}})),[null==r?void 0:r.frozenIndex,null==r?void 0:r.frozenStyles]);return(0,b.jsx)("div",{style:p,children:(0,b.jsx)(nl,{passesFilter:!0,checkedState:c,onClick:u,checkboxType:"group",collectionContextStore:o,frozoneProps:r?{...r,isCollectionViewBlockSelected:!1}:void 0,disabled:l})})}ya.displayName="TableHeaderRow";const xa=(0,B.injectIntl)(ya);function ba(e,t){return!e&&t}function wa(e,t){const{temporaryFormat:o}=t.state;return o||e}function ka(e,t,o){return wa(t,o)[e]||[]}function _a(e,t,o,r){const i=wa(o,r),n=ka(t,i,r).map((t=>t.property===e.property?e:t));return{...i,[t]:n}}function Ta(e){(0,me.ZP)({event:e,context:me.Af.EditorMouseDown,callback:()=>{}})}function Oa(e,t,o,r,i,n,s){var l;const a=e.collectionViewStore();if(!a)return{};const c=n?"transparent":(null===(l=e.inheritedBlockColorStore.state)||void 0===l?void 0:l.background)||(t?i.cardContentBackground:i.contentBackground),d=n?i.tableHomeDividerColor:i.tableDividerColor;return{display:"flex",position:"absolute",background:c,zIndex:F.bF,height:o-1,color:i.mediumTextColor,borderTop:s?void 0:`1px solid ${d}`,boxShadow:`\n\t\t\t-3px 0 0 ${c},\n\t\t\t0 1px 0 ${d}\n\t\t`,minWidth:r,left:"timeline"===a.getType()?void 0:0,right:"timeline"===a.getType()?void 0:0}}function Va(e,t,o,r,i,n){const s=t.collectionViewStore();if(!s)return;const l={...wa(r,i),[o]:N.MR(ka(o,r,i),(t=>{const o=e.indexOf(t.property);return o>=0?o:1/0}))};ee.createAndCommit({userAction:"TableHeaderRow.handleColumnReorder",environment:n,perform:e=>{pe.iG({collectionViewStore:s,update:{format:l},transaction:e})}}),E.wd({environment:n,collectionContextStore:t,action:"table_reorder_columns"})}function Pa(e){let{collectionContextStore:t}=e;const o=(0,u.Fg)(),r=(0,a.O7)();return(0,b.jsx)(Yt.Z,{style:{display:"flex",justifyContent:"flex-start",width:Ca},onMouseDown:Ta,onClick:()=>function(e,t){e.collectionStore()&&(J.ZH(t),Y.ZH(t),pe.wG(),E.wd({environment:t,collectionContextStore:e,action:"click_new_property"}),z.wl({collectionSettingsStore:e.settingsStore,item:{type:"propertyType",onAccept:(o,r,i,n)=>{Ys.PW({environment:t,collectionContextStore:e,propertyType:o,isSuggestedProperty:r,propertyName:i,selectOptions:n,from:"table"})}}}))}(t,r),className:fo.V6y,children:(0,b.jsx)("div",{style:fa,children:(0,ie.R)({width:12,fill:o.mediumIconColor})})})}function Ra(e){let{collectionContextStore:t}=e;const o=(0,u.Fg)(),r=(0,a.O7)();return(0,b.jsx)(Yt.Z,{style:{display:"flex",justifyContent:"flex-start",flexGrow:1,width:Ca},onMouseDown:Ta,onClick:()=>function(e,t){z.r$({collectionContextStore:e,collectionSettingsStore:e.settingsStore}),E.wd({environment:t,collectionContextStore:e,action:"click_table_header_dot_menu"}),z.H4({collectionSettingsStore:e.settingsStore,item:{type:"properties",timelineViewTab:"timeline"}})}(t,r),className:fo.V6y,children:(0,b.jsx)("div",{style:fa,children:(0,ue.o)({width:12,fill:o.mediumIconColor})})})}function Ma(e){const{children:t,isCollectionViewBlockSelected:o,shouldFreeze:r}=e;return r?(0,b.jsx)(Ds.Z,{enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},exitAnimationStyle:{opacity:0},isVisible:!0,render:()=>(0,b.jsx)("div",{style:{display:"flex",background:o?xe.ZP.blueWithAlpha(.14):void 0},children:t})},"halo"):(0,b.jsx)(b.Fragment,{children:t})}var ja=o(86486),Ia=o(59183);function Fa(e,t){const{disabled:o,store:r,groupFormat:n,collectionContextStore:s,propertyFormats:l,showRightActionsSpacer:c,disableTableWrap:p,frozoneProps:h,passesFilter:m,shouldShowMultiSelectCheckbox:S,isLast:g,...C}=e,{handleOpenPeekPage:f}=e,y=(0,i.useRef)(null),v=(0,a.O7)(),x=(0,d.VK)((()=>!o&&r.canEdit()),[o,r]),w=(0,d.VK)((()=>(0,Go.A7)(n,s).findIndex((e=>e===r))),[s,n,r]),k=(0,d.VK)((()=>{const e=s.collectionViewBlockStore();return!(!e||s.isFullScreen.state)&&(0,js.sY)(e)}),[s]),_=(0,d.VK)((()=>s.isUnlistedView.state&&s.isCompactView.state),[s]),T=null==h?void 0:h.frozenIndex,O=void 0!==T,V=(0,d.VK)((()=>{const{collectionContextStore:t,groupFormat:o}=e,r=Ia.Z.state,i=t.collectionViewBlockStore();if(!i)return!1;if(!r.isActive||!(0,Ia.N)(r.selectionKey,{collectionViewBlockStore:i,groupFormat:o}))return!1;const{selection:n}=r,{start:s}=n;return void 0!==T&&w===s.row&&s.col<=T}),[e,T,w]),P=(0,d.VK)((()=>ce.bW(T)),[T]),R=(0,i.useMemo)((()=>O?{...null==h?void 0:h.frozenStyles,...V?{zIndex:F.mK}:{zIndex:F.IK},...-1===T?{background:void 0}:{}}:{}),[T,null==h?void 0:h.frozenStyles,O,V]),[M,j]=(0,i.useMemo)((()=>O?[l.slice(0,T+1),l.slice(T+1)]:[[],l]),[T,l,O]),I=(0,d.VK)((()=>{var e;return Boolean(!p&&(null===(e=s.collectionViewStore())||void 0===e?void 0:e.getFormatStore().getKeyStore("table_wrap").getValue()))}),[s,p]),B=(0,d.VK)((()=>{var e;return Boolean("timeline"===(null===(e=s.collectionViewStore())||void 0===e?void 0:e.getType())||!I&&!l.some((e=>e.wrap)))}),[s,l,I]),N=(0,d.VK)((()=>{const e=s.permissionScopes.state;return e.isLocked||!e.canConfigureCollection||!e.canConfigureBlock}),[s.permissionScopes]),D=(0,d.VK)((()=>s.isInHomeWidget.state),[s]),L=(0,u.yK)((e=>{const t=D?e.tableHomeDividerColor:e.tableDividerColor;return{tableViewRowStyle:{display:"flex",...g&&D?{}:{borderBottom:`1px solid ${t}`},width:"100%"}}}),[D,g]),E=(0,b.jsxs)(i.Fragment,{children:[(0,b.jsx)("div",{className:fo.zwY,style:L.tableViewRowStyle,ref:y,children:(0,b.jsxs)("div",{style:{display:"flex"},children:[(0,b.jsx)("div",{style:O?R:{},children:(0,b.jsx)(Ma,{isCollectionViewBlockSelected:k,shouldFreeze:-1!==T,children:(0,b.jsxs)(b.Fragment,{children:[S&&(0,b.jsx)(La,{store:r,passesFilter:Boolean(m),frozoneProps:h,canEdit:x}),(0,b.jsx)(Ba,{store:r,canEdit:x,propertyFormats:M,shouldSetCellHeight:B,indexAddendum:0,rowIndex:w,disabled:o,groupFormat:n,disableTableWrap:p,isLocked:N,isCollectionViewBlockSelected:k,passesFilter:Boolean(m),shouldShowMultiSelectCheckbox:S,frozoneProps:h,...C})]})})}),(0,b.jsx)(Ba,{store:r,canEdit:x,propertyFormats:j,shouldSetCellHeight:B,indexAddendum:P,rowIndex:w,disabled:o,groupFormat:n,disableTableWrap:p,isLocked:N,isCollectionViewBlockSelected:k,passesFilter:!0,shouldShowMultiSelectCheckbox:S,frozoneProps:h,...C})]})}),c&&!N&&(0,b.jsx)("div",{style:{...L.tableViewRowStyle,display:"flex",justifyContent:"flex-start",flexGrow:1,width:64}})]});return(0,Is.ez)(r,t,(0,i.useMemo)((()=>({renderedType:"table_row",getNode:()=>y.current,getBlockStore:()=>r,activate(){const{mainEditorCurrentBlockStore:e}=$o.default.state,t=ce.mb({store:r,mainEditorCurrentBlockStore:e,collectionContextStore:s,fullyQualified:!1,overridePeekMode:_?"center_peek":void 0});t&&(f(),ae.c4({environment:v,url:t}))}})),[s,v,f,_,r]),E)}function Ba(e){const{blockPropertyValueOverlayStore:t,propertyFormats:o,store:r,disableTableWrap:i,shouldSetCellHeight:n,indexAddendum:s,frozoneProps:l,...a}=e,c=(0,tn.Y$)(),u=(0,d.VK)((()=>c.collectionViewStore()),[c]),p=(0,d.VK)((()=>r.getAssociatedCollectionStore()),[r]),h=(0,d.VK)((()=>!!u&&Boolean(!i&&u.getFormatStore().getKeyStore("table_wrap").getValue())),[u,i]),m=(0,d.VK)((()=>{const e=ja.default.state;return Boolean(e.isOpen&&e.currentStore===r)}),[r]),S=(0,d.VK)((()=>!t.state.isOpen&&Jo.default.state.stores.length>0&&Jo.default.state.stores[0].id===r.id),[r.id,t]),g=(0,d.VK)((()=>c.currentSubitemFormatStoreForUiDisplay.state),[c]),C=(0,d.VK)((()=>"title"===(null==u?void 0:u.getFormat().table_subitem_toggle_column)),[u]),f=(0,d.VK)((()=>c.frozoneStore.state.frozenIndex),[c]);return(0,b.jsx)(b.Fragment,{children:o.map(((e,i)=>(0,b.jsx)(Na,{index:i+(s??0),store:r,propertyFormat:e,isLastColumn:i===o.length-1,isRightMostFrozenColumn:f===i+(s??0),collectionViewStore:u,collectionStore:p,tableWrap:h,shouldSetCellHeight:n,isShowingHoverMenu:m,shouldCaptureKeyboard:S,subitemFormat:g,isSubitemToggleOnTitleColumn:C,blockPropertyValueOverlayStore:t,isScrolled:(null==l?void 0:l.isScrolled)??!1,...a},e.property)))})}function Na(e){const{propertyFormat:t,index:o,canEdit:r,isLastColumn:n,isRightMostFrozenColumn:s,store:l,schema:c,disabled:p,disableCellBorderRight:h,disableLastCellBorderRight:m,subitemPath:S,onShiftEnter:g,tableWrap:C,subitemFormat:f,isShowingHoverMenu:y,shouldCaptureKeyboard:v,isLocked:x,toggleButton:w,onPropertyClick:k,titleColumnIndex:_,isSubitemToggleOnTitleColumn:T,onPropertyTab:O,onPropertyUntab:V,onPropertyEnter:P,onPropertyEsc:R,onPropertyBgClick:M,onPropertyContextMenu:j,collectionViewStore:I,collectionStore:F,blockPropertyValueOverlayStore:B,shouldSetCellHeight:D,onOpenProperty:L,disableHorizontalEdgeScroll:E,handleOpenPeekPage:A,groupFormat:H,rowIndex:Z,isCollectionViewBlockSelected:z,passesFilter:G,isScrolled:K,shouldShowMultiSelectCheckbox:U,isInHomeWidget:W}=e,{property:$,wrap:q}=t,Q=(0,a.O7)(),Y=(0,d.VK)((()=>(0,Kr.vf)({environment:Q,propertyFormat:t})),[Q,t]),X=(0,tn.Y$)(),J=(null==S?void 0:S.length)??0,ee=f&&(0,Kr.lO)({columnIndex:o,titleColumnIndex:_,isSubitemToggleOnTitleColumn:T}),te=(0,i.useMemo)((()=>{if(void 0!==Y)return ee?Y-(0,Kr.lZ)({columnIndex:o,indentLevel:J,titleColumnIndex:_,isSubitemToggleOnTitleColumn:T}):Y}),[J,o,T,ee,_,Y]),oe=(0,i.useMemo)((()=>ee?(0,b.jsx)(Da,{subitemFormat:f,toggleButton:w,subitemPath:S,shouldShowMultiSelectCheckbox:U,propertyIndex:o}):void 0),[ee,f,S,w,U,o]),re=(0,i.useCallback)((()=>k(l,$,c)),[k,$,c,l]),ie=p||!r,ne=(0,d.VK)((()=>{const e=Ia.Z.state,t=X.collectionViewBlockStore();if(!t)return!1;if(!e.isActive||!(0,Ia.N)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:H}))return!1;const{selection:r}=e,{start:i,end:n}=r,s=Z===i.row||Z===n.row||N.Z2(Z,i.row,n.row),l=o===i.col||o===n.col||N.Z2(o,i.col,n.col);return s&&l}),[X,H,o,Z]),se=(0,d.VK)((()=>{const e=Ia.Z.state,t=X.collectionViewBlockStore();if(!t)return!1;if(!e.isActive||!(0,Ia.N)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:H}))return!1;const{selection:r}=e,{start:i}=r;return Z===i.row&&o===i.col}),[X,H,o,Z]),le=(0,d.VK)((()=>{const e=X.frozoneStore.state.frozenIndex;return void 0!==e&&o<=e}),[X,o]),ae=(0,u.yK)((e=>{let t=e.tableDividerColor;return W?t=e.tableHomeDividerColor:z&&(t=e.tableFrozenSelectedDividerColor),{tableCell:{display:"flex",width:Y||void 0,position:"relative",borderRight:h||s||n&&m?"none":`1px solid ${t}`,boxShadow:le?`0 -1px 0 ${t}`:void 0},tableSelectionOverlay:{background:ne?xe.ZP.blueWithAlpha(.07):void 0,borderRadius:se?3:void 0,boxShadow:se?e.outlineBlueInputBoxShadow:void 0,position:"absolute",pointerEvents:"none",top:0,height:"100%",zIndex:84,...0===o&&U?{width:"calc(100% + 8px)",left:-8}:{width:"100%",left:0}},propertyValueContainer:{display:"flex",overflowX:"clip",height:"100%",width:Y||void 0}}}),[W,z,Y,h,s,n,m,le,ne,se,o,U]),ce=(0,d.VK)((()=>X.isCompactView.state&&X.isUnlistedView.state),[X]),de=(0,b.jsxs)(Bo.Z,{debugName:"TableRow",capture:v,onShiftEnter:g,children:[(0,b.jsx)(Ro.Z,{collectionStore:F,store:l,property:$,disabled:ie,locked:x,width:te,format:Mo.C.Table,forceMouseEntered:"title"!==$||!r||W||ce?void 0:y,tableWrap:Boolean(C||q),isLast:n,indentLevel:0===o&&S?S.length:void 0,onTab:O,onUntab:V,onEnter:P,onClick:re,onEsc:R,onBgClick:M,onContextMenu:j,collectionViewStore:I,shouldSetCellHeight:D,onOpenProperty:L,blockPropertyValueOverlayStore:B,disableHorizontalEdgeScroll:E,handleOpenPeekPage:A,propertyIndex:o,shouldShowMultiSelectCheckbox:U},$),s&&(0,b.jsx)(il,{passesFilter:G,isScrolled:K})]});return(0,b.jsxs)("div",{className:fo.mWS,"data-row-index":Z,"data-col-index":o,style:ae.tableCell,children:[oe,(0,b.jsx)("div",{style:ae.propertyValueContainer,children:de}),ne&&(0,b.jsx)("div",{style:ae.tableSelectionOverlay})]})}function Da(e){const{toggleButton:t,subitemPath:o,shouldShowMultiSelectCheckbox:r,propertyIndex:i}=e,n=(null==o?void 0:o.length)??0,s=Math.max((n-1)*Go.Hw,0)+Go.gY;return t?(0,b.jsxs)("div",{style:{paddingTop:4,display:"flex",...0===i&&r?{marginLeft:-8,marginRight:4}:{}},children:[(0,b.jsx)("div",{style:{width:s}}),t]}):(0,b.jsx)("div",{style:{minWidth:s+Go.Hw,...0===i&&r?{marginLeft:-8,marginRight:4}:{}}})}const La=i.memo((function(e){const{store:t,passesFilter:o,canEdit:r,frozoneProps:n}=e,s=(0,tn.Y$)(),l=(0,a.O7)(),c=(0,d.VK)((()=>Jo.default.state.stores.includes(t)),[t]),u=(0,i.useCallback)((e=>{var o;(0,Kr.vg)({collectionViewBlockId:null===(o=s.collectionViewBlockStore())||void 0===o?void 0:o.id})?Y.Z5({environment:l,stores:[t]}):Y.Ys({environment:l,store:t,toggle:!0}),e.stopPropagation()}),[s,l,t]);return(0,b.jsx)(nl,{checkedState:c,onClick:u,checkboxType:"single_row",collectionContextStore:s,frozoneProps:n,passesFilter:o,disabled:!r})})),Ea=i.memo(i.forwardRef(Fa));var Aa=o(12137),Ha=o(55061),Za=o(11302),za=o(12714),Ga=o(993),Ka=o(39865),Ua=o(11368),Wa=o(24646);const $a=function(e){const{frozenColumnRepositionStore:t,frozenIndex:o,maxFrozenIndex:r,xForFirstCellInRow:n,showPropertyFormats:s,frozenSectionWidth:l}=e,c=(0,a.O7)(),p=(0,tn.DK)(),h=(0,i.useRef)(null),m=(0,i.useRef)(null),[S,g]=i.useState({x:0,y:0,width:0,maxY:0,isEntered:!1,isMouseDown:!1}),[C,f]=i.useState(0),[y,v]=i.useState(0),x=(0,d.VK)((()=>t.state.isRepositioning||S.isMouseDown),[t,S.isMouseDown]),w=(0,d.VK)((()=>t.state.newFrozenIndex),[t]),k=(0,d.VK)((()=>!!p&&(0,ce.fk)({environment:c,collectionContextStore:p})),[c,p]),_=(0,d.VK)((()=>null==p?void 0:p.frozoneStore.state.isScrolled),[p]),T=(0,d.VK)((()=>!_&&-1===o&&k?-4:0),[o,_,k]),O=(0,d.VK)((()=>S.isEntered||x),[S.isEntered,x]),V=(0,d.VK)((()=>t.state.newFrozenColumnXPosition),[t]),P=(0,i.useContext)(Ua.Ue),R=(0,d.VK)((()=>null==P?void 0:P.horizontalScroller),[P]),M=(0,i.useCallback)((()=>{var e,t,o;if(!R||!h.current)return 0;const r=(null===(e=h.current.getBoundingClientRect())||void 0===e?void 0:e.top)??0,i=null===(t=R.scrollerEl())||void 0===t?void 0:t.getElementsByClassName(fo.kUP);return(i&&i.length>0?null===(o=i[0].getBoundingClientRect())||void 0===o?void 0:o.top:0)-r}),[R]),j=(0,i.useCallback)((()=>{var e,t,o,r,i;if(!R||!h.current)return 0;const n=(null===(e=h.current)||void 0===e||null===(e=e.getBoundingClientRect())||void 0===e?void 0:e.bottom)??0,s=null===(t=R.scrollerEl())||void 0===t?void 0:t.getElementsByClassName(fo.zwY),l=s&&s.length>0?null===(o=s[s.length-1].getBoundingClientRect())||void 0===o?void 0:o.bottom:0,a=null===(r=R.scrollerEl())||void 0===r?void 0:r.getElementsByClassName(fo.Gcz),c=a&&a.length>0?null===(i=a[a.length-1].getBoundingClientRect())||void 0===i?void 0:i.bottom:0;return Math.max(l,c)-n}),[R]),I=(0,d.VK)((()=>{var e;const t=null===(e=h.current)||void 0===e?void 0:e.getBoundingClientRect();return t&&void 0!==l?new DOMRect(t.x+l+S.x+10,t.y+S.y+10,3,3):void 0}),[l,S]),L=(0,d.VK)((()=>{const e=(null==p?void 0:p.frozoneStore.state.scrollerLeftOffset)??0,t=(0,Wa.Wk)(c),o=Math.max(t-e,0);return p&&(0,Kr.iZ)(c,p)?o:0}),[p,c]),E=(0,i.useCallback)((e=>{if(void 0===o||void 0===r||void 0===l||null===h.current||null===m.current)return;const i=h.current.getBoundingClientRect(),a=e.clientX-i.x;if(null==p||p.frozoneStore.setState({...null==p?void 0:p.frozoneStore.state,tryShowHiddenFrozenColumn:a<42}),!O)return;const c=M();f(c);const d=j();v(d);const u=2+l,S=Math.max(a-u,-u),C=e.clientY-i.y-14,y=i.bottom-i.top-14+d,b=x?c:-14,w=Math.max(Math.min(C,y),b);if(g((e=>({...e,x:x?S:0,y:w}))),x){const e=s,i=m.current.getBoundingClientRect();let c=a,d=n,u=-1,p=d,h=Math.abs(d-c);for(let t=0;t<e.length&&!(t>r);t++){const r=e[t];d+=(null==r?void 0:r.width)??0,_&&t===o+1&&(c-=i.x);const n=Math.abs(d-c);n<h&&(h=n,p=d,u=t)}t.setState({...t.state,newFrozenIndex:u,newFrozenColumnXPosition:p-l-1})}}),[o,r,l,null==p?void 0:p.frozoneStore,O,M,j,x,s,n,t,_]);(0,i.useEffect)((()=>{const e=N.P2((e=>{E(e)}),25);return window.addEventListener("mousemove",e),()=>{window.removeEventListener("mousemove",e)}}),[E]);const A=(0,i.useCallback)((e=>{x||(E(e.nativeEvent),g((e=>({...e,isEntered:!0,isMouseDown:!1}))))}),[x,E]),H=(0,i.useCallback)((e=>{x||g((e=>({...e,isEntered:!1,isMouseDown:!1})))}),[x]),Z=(0,i.useCallback)((e=>{g((e=>({...e,isMouseDown:!0})))}),[]),z=(0,i.useCallback)((e=>{x&&g((e=>({...e,isEntered:!0})))}),[x]),G=(0,i.useCallback)((e=>{g((e=>({...e,isEntered:!1,isMouseDown:!1})))}),[]),K=(0,i.useCallback)((e=>{x&&g((e=>({...e,x:0,isEntered:!1,isMouseDown:!1})))}),[x]),U=void 0!==w&&void 0!==o&&w<=o,W=(0,u.yK)((e=>({repositionerContainer:{zIndex:F.hc,display:"flex",position:"absolute",width:"100%",height:"100%",cursor:x?"grabbing":"grab",pointerEvents:x?void 0:"none"},repositionerOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)",height:"100%"},repositionerInsideStickyWrapper:{position:"sticky",left:L,height:"100%"},tooltipContainer:{position:"absolute",left:l??0,zIndex:F.xP,height:"100%"},tooltipOrigin:{position:"absolute",left:-3,top:0,width:8,pointerEvents:"auto",cursor:x?"grabbing":"grab",height:"100%"},tooltipColumn:{position:"absolute",left:x?S.x-1:-1,top:x?C:0,width:2,height:x?`calc(100% + ${y-C}px`:"100%",background:"dark"===e.mode?e.accentColors.gray[500]:e.accentColors.gray[200]},ghostColumnBase:{position:"absolute",top:x?C:0,width:1,height:x?`calc(100% + ${y-C}px`:"100%",background:e.accentColors.blue[300]},frozenGhostColumn:{left:V,opacity:x&&U?1:0},unfrozenGhostColumn:{left:(l??0)+(V??0),opacity:O&&x&&!U?1:0},tooltipDraggable:{position:"absolute",left:x?S.x-2:-2,top:S.y,width:4,height:28,background:e.accentColors.blue[400],borderRadius:4},tooltipText:{color:e.mediumInvertedTextColor,maxWidth:200,...D.Z.textOverflowStyle}})),[x,L,l,S,C,y,O,V,U]);return(0,b.jsx)("div",{className:fo.wXs,style:W.repositionerContainer,onMouseEnter:z,onMouseLeave:G,onMouseUp:K,children:(0,b.jsxs)("div",{style:W.repositionerOutsideStickyWrapper,ref:m,children:[(0,b.jsx)("div",{style:W.repositionerInsideStickyWrapper,ref:h,children:(0,b.jsx)(Xe.ZP,{renderTooltip:()=>x&&void 0!==w&&w!==o?(0,b.jsx)(B.FormattedMessage,{id:"tableView.selectionOverlay.repositioner.dynamicTooltip",defaultMessage:"Freeze {numColumns} {numColumns, select, 1 {column} other {columns}}",values:{numColumns:w+1}}):(0,b.jsx)(B.FormattedMessage,{id:"tableView.selectionOverlay.repositioner.tooltip",defaultMessage:"Drag horizontally to freeze columns"}),delayThreshold:300,forceVisibleState:x||void 0,placement:As.u.Right,originRect:I,render:e=>(0,b.jsx)(Ds.Z,{isVisible:!0,animationStyle:{translateX:T,opacity:O?1:0},render:()=>(0,b.jsxs)("div",{...e,style:W.tooltipContainer,children:[(0,b.jsx)("div",{style:W.tooltipOrigin,onMouseEnter:A,onMouseLeave:H,onMouseDown:Z}),(0,b.jsx)("div",{style:{...W.ghostColumnBase,...W.frozenGhostColumn}}),(0,b.jsx)("div",{style:W.tooltipColumn}),(0,b.jsx)("div",{style:W.tooltipDraggable})]})})})}),(0,b.jsx)("div",{style:{...W.ghostColumnBase,...W.unfrozenGhostColumn}})]})})};var qa=o(4708),Qa=o(39500),Ya=o(77907),Xa=o(95802),Ja=o(80796),ec=function(e){return e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Up=2]="Up",e[e.Down=3]="Down",e}(ec||{});class tc extends s.Z{constructor(){super(...arguments),this.rowsWrapEl=null,this.observer=void 0,this.storeTypes={dragAndFillStore:p.default.createClass(void 0),frozenColumnRepositionStore:p.default.createClass({isRepositioning:!1,newFrozenIndex:void 0,newFrozenColumnXPosition:void 0})},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDragStart=e=>function(e,t,o,r,i,n,s,l,a,c,d){if(e.preventDefault(),function(e){let t=e;for(;null!==t;){if(t.classList.contains(fo.wXs))return!0;t=t.parentElement}return!1}(e.target))l.setState({isRepositioning:!0,newFrozenIndex:a.state,newFrozenColumnXPosition:void 0}),function(e,t,o,r,i){var n;if(!t.frozoneStore.state.isScrolled)return;const s=i.state[0],l=o[0].property,a=la.Z.findBlockPropertyValue(s,l),c=t.frozoneStore.state.scrollerLeftOffset??0,d=(0,Wa.Wk)(e),u=Math.max(d-c,0),p=(0,Kr.iZ)(e,t)?u:0;null==a||null===(n=a.getContextHorizontalScroller())||void 0===n||n.scrollTo(void 0,r-p)}(t,o,r,i,c),Ja.Z.setState({...Ja.Z.state,disableHorizontalEdgeScroll:!0,disableVerticalEdgeScroll:!0});else{const t=d.state;if(t&&sc(n,o)&&function(e){let t=e;for(;null!==t;){if(t.classList.contains(fo.JR_))return!0;t=t.parentElement}return!1}(e.target))return void s.setState({...t})}pe.wG()}(e,this.environment,this.props.collectionContextStore,this.props.showPropertyFormats,this.props.paddingLeft,this.props.disabled,this.stores.dragAndFillStore,this.stores.frozenColumnRepositionStore,this.frozenIndex,this.allRowsStore,this.normalizedTableSelectionStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDragMove=e=>function(e,t,o,r,i,n,s,l,a,c){if(s.state.isRepositioning);else if(Qa.X9()){var d;const s=nc(e.target);if(!s)return;const u=n.state,p=(null==u?void 0:u.start)??(null===(d=l.state)||void 0===d?void 0:d.start)??s;if(!p)return;const h=s;if(n.state&&p.col!==h.col)return;hc({selection:{start:p,end:h},shouldNormalize:!0},t,o,r,i,a,c)}}(e,this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.showPropertyFormats,this.stores.dragAndFillStore,this.stores.frozenColumnRepositionStore,this.normalizedTableSelectionStore,this.allRowsStore,this.selectionStartRectStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDragEnd=()=>{return e=this.environment,t=this.props.collectionContextStore,o=this.props.showPropertyFormats,r=this.props.schema,i=this.stores.dragAndFillStore,n=this.stores.frozenColumnRepositionStore,s=this.normalizedTableSelectionStore,l=this.allRowsStore,function(e,t,o){const r=o.state.isRepositioning;r&&ee.createAndCommit({userAction:"TableHeaderCell.handleFreezeColumns",environment:e,perform:r=>{Dl.oz({environment:e,collectionContextStore:t,currentIndex:o.state.newFrozenIndex,transaction:r,entrypoint:"TableSelectionOverlay.FrozenColumnRepositioner"}),o.reset()}})}(e,t,n),void function(e,t,o,r,i,n,s){var l;const a=i.state;if(!a)return;const{start:c,end:d}=a;if(c.col!==d.col||c.row!==d.row)return;const u=t,p=u[c.col],h=null===(l=o[p.property])||void 0===l?void 0:l.type;if("verification"===h)return;const m=n.state;if(!m)return;ee.createAndCommit({userAction:"TableSelectionOverlay.handleDragAndFill",environment:e,perform:e=>{uc({transaction:e,selection:m,start:c},t,s)}});const S=Math.min(m.start.row,m.end.row),g=Math.max(m.start.row,m.end.row);h&&g!==S&&E.qm({environment:e,collectionContextStore:r,property_type:h,num_rows:g-S}),i.reset()}(e,o,r,t,i,s,l);var e,t,o,r,i,n,s,l},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDragCancel=()=>{return e=this.stores.dragAndFillStore,t=this.stores.frozenColumnRepositionStore,e.reset(),t.reset(),void pe.wG();var e,t},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleLeft=e=>function(e,t,o,r,i,n,s,l,a,c){e.preventDefault&&e.preventDefault();Yo.Z.setKeyboardMode(!0);const d=n.state;if(!d)return;const u=o.collectionViewBlockStore();if(!u)return;Dl.e2({environment:t,selectionKey:{collectionViewBlockStore:u,groupFormat:r},selection:d,shiftKey:"shiftKey"in e&&e.shiftKey||!1,columnCount:i.length}),dc(ec.Left,i,n,s,l,a,c)}(e,this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore,this.frozenSectionWidthStore,this.frozenIndex,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRight=e=>function(e,t,o,r,i,n,s,l,a,c){e.preventDefault&&e.preventDefault();Yo.Z.setKeyboardMode(!0);const d=n.state;if(!d)return;const u=o.collectionViewBlockStore();if(!u)return;Dl.FC({environment:t,selectionKey:{collectionViewBlockStore:u,groupFormat:r},selection:d,columnCount:i.length,rowCount:s.state.length,shiftKey:"shiftKey"in e&&e.shiftKey||!1}),dc(ec.Right,i,n,s,l,a,c)}(e,this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore,this.frozenSectionWidthStore,this.frozenIndex,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleUp=e=>function(e,t,o,r,i,n,s,l,a,c){e.preventDefault&&e.preventDefault();Yo.Z.setKeyboardMode(!0);const d=n.state;if(!d)return;const u=o.collectionViewBlockStore();if(!u)return;Dl.zJ({environment:t,selectionKey:{collectionViewBlockStore:u,groupFormat:r},selection:d,shiftKey:"shiftKey"in e&&e.shiftKey||!1}),dc(ec.Up,i,n,s,l,a,c)}(e,this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore,this.frozenSectionWidthStore,this.frozenIndex,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDown=e=>function(e,t,o,r,i,n,s,l,a,c){e.preventDefault&&e.preventDefault();Yo.Z.setKeyboardMode(!0);const d=n.state;if(!d)return;const u=o.collectionViewBlockStore();if(!u)return;Dl.DI({environment:t,selectionKey:{collectionViewBlockStore:u,groupFormat:r},selection:d,rowCount:s.state.length,shiftKey:"shiftKey"in e&&e.shiftKey||!1}),dc(ec.Down,i,n,s,l,a,c)}(e,this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore,this.frozenSectionWidthStore,this.frozenIndex,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleEnter=e=>function(e,t,o,r,i,n,s,l,a,c){e.preventDefault&&e.preventDefault();Yo.Z.setKeyboardMode(!0);const d=l.state;if(!d)return;const u=a.state,p=u[d.start.row],h=r[d.start.col].property,m=o[h];if(!m)return;if(!i)if(fe.uk.includes(m.type)){if("checkbox"===m.type){const e=p.getPropertyStore(h),o=xl.Ml(e.getValue()),r=u.slice(d.start.row,d.end.row+1);ee.createAndCommit({userAction:"TableSelectionOverlay.handleEnter",environment:t,perform:e=>{for(const i of r)Ga.sO({environment:t,editorMode:"default",store:i.getNormalizedPropertyStore(h),value:xl._I(!o),transaction:e})}})}}else To.bA({environment:t,blockPropertyValueOverlayStore:n,store:p,property:h,format:Mo.C.Table,disableHorizontalEdgeScroll:c,collectionContextStore:s}),pe.wG()}(e,this.environment,this.props.schema,this.props.showPropertyFormats,this.props.disabled,this.props.blockPropertyValueOverlayStore,this.props.collectionContextStore,this.normalizedTableSelectionStore,this.allRowsStore,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTab=e=>function(e,t,o,r,i,n,s,l,a,c){e.preventDefault(),Yo.Z.setKeyboardMode(!0);const d=n.state;if(!d)return;const u=o.collectionViewBlockStore();if(!u)return;Dl.FC({environment:t,selectionKey:{collectionViewBlockStore:u,groupFormat:r},selection:d,columnCount:i.length,rowCount:s.state.length,shiftKey:!1}),dc(ec.Right,i,n,s,l,a,c)}(e,this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore,this.frozenSectionWidthStore,this.frozenIndex,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleUntab=e=>function(e,t,o,r,i,n,s,l,a,c){e.preventDefault(),Yo.Z.setKeyboardMode(!0);const d=n.state;if(!d)return;const u=o.collectionViewBlockStore();if(!u)return;Dl.e2({environment:t,selectionKey:{collectionViewBlockStore:u,groupFormat:r},selection:d,shiftKey:!1,columnCount:i.length}),dc(ec.Left,i,n,s,l,a,c)}(e,this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore,this.frozenSectionWidthStore,this.frozenIndex,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleEsc=e=>function(e,t,o,r){const{device:i}=t;if(i.isMobile)return;e.preventDefault(),Yo.Z.setKeyboardMode(!0);const n=o.state;if(pe.wG(),n){const e=(0,Kr.AV)(n),o=r.state.slice(e.minRow,e.maxRow+1);Y.Z5({environment:t,stores:o})}}(e,this.environment,this.normalizedTableSelectionStore,this.allRowsStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMoveTo=e=>function(e,t,o,r){e.preventDefault&&e.preventDefault();Yo.Z.setKeyboardMode(!0);const i=o.state;if(pe.wG(),i){const e=(0,Kr.AV)(i),o=r.state.slice(e.minRow,e.maxRow+1);if(0===o.length)return;Y.Z5({environment:t,stores:o});const n=Xa.C.getRectFromStore(o[0]);Za.bA({environment:t,blocks:o,originRect:n,moveToContext:"action_menu"})}}(e,this.environment,this.normalizedTableSelectionStore,this.allRowsStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDelete=e=>function(e,t,o,r,i,n,s){const l=n.state,a=o.normalizedSchemaStore.state;l&&!r&&ee.createAndCommit({userAction:"TableSelectionOverlay.handleDelete",environment:t,perform:e=>{Dl.NE({selection:l,schema:a,currentPropertyFormats:i,currentRows:s.state,transaction:e})}})}(0,this.environment,this.props.collectionContextStore,this.props.disabled,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCut=e=>function(e,t,o,r,i,n,s,l){const a=s.state,c=o.normalizedSchemaStore.state,d=o.collectionViewBlockStore();if(!d)return;a&&!r&&ee.createAndCommit({userAction:"TableSelectionOverlay.handleCut",environment:t,perform:t=>{Dl.nA({selectionKey:{collectionViewBlockStore:d,groupFormat:i},schema:c,selection:a,currentPropertyFormats:n,currentRows:l.state,event:e,transaction:t})}})}(e,this.environment,this.props.collectionContextStore,this.props.disabled,this.props.groupFormat,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCopy=e=>function(e,t,o,r,i,n){const s=i.state,l=t.normalizedSchemaStore.state,a=t.collectionViewBlockStore();if(!a)return;s&&Dl.qn({selectionKey:{collectionViewBlockStore:a,groupFormat:o},schema:l,selection:s,currentPropertyFormats:r,currentRows:n.state,event:e})}(e,this.props.collectionContextStore,this.props.groupFormat,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePaste=e=>function(e,t,o,r,i,n,s,l,a,c,d){const u=c.state,p=o.collectionViewBlockStore();if(!p)return;u&&!a&&ee.createAndCommit({userAction:"TableSelectionOverlay.handlePaste",environment:t,perform:a=>{Dl.j0({environment:t,collectionContextStore:o,selectionKey:{collectionViewBlockStore:p,groupFormat:r},selection:u,currentPropertyFormats:n,currentRows:d.state,event:e,transaction:a,schema:i,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:l})}})}(e,this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.schema,this.props.showPropertyFormats,this.props.markdownLinkifyIt,this.props.tinyMceMicrosoftWordPasteFilter,this.props.disabled,this.normalizedTableSelectionStore,this.allRowsStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCommandEnter=e=>function(e,t,o,r,i,n){const{device:s}=t,l=r.state;if(s.isMobile||!l)return;const a=i.state[l.start.row],{mainEditorCurrentBlockStore:c}=$o.default.state,d=ce.mb({store:a,mainEditorCurrentBlockStore:c,collectionContextStore:o,fullyQualified:!1});d&&function(e,t,o){o?o(e):ae.c4({environment:t,url:e})}(d,t,n)}(0,this.environment,this.props.collectionContextStore,this.normalizedTableSelectionStore,this.allRowsStore,this.context.overrideLinkClick),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleShiftEnter=()=>function(e,t,o,r,i,n,s,a,c,d,u){const{device:p}=e;if(p.isMobile)return;const m=n.state;if(!m)return;if(!Ce.M_(e))return;if(!t.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const S=s.state,g=S[m.start.row],C=t.subitemTreeStore.state,f=(0,Gr.DY)(C.children,(e=>e.value.store===g)),y="table_selection_overlay_shift_enter";if(f){const n=f?(0,Go.Af)(f.map((e=>e.value.store))):"",c=t.subitemExpandedStore.state.get(n),d=Boolean(null==c?void 0:c.isExpanded),u=[...f].splice(0,f.length-1),p=u?(0,Go.Af)(u.map((e=>e.value.store))):"",C=t.subitemExpandedStore.state.get(p),v=Boolean(null==C?void 0:C.isExpanded);if(d||v)ee.createAndCommit({userAction:"TableSelectionOverlay.handleNestedItemShiftEnter",environment:e,perform:i=>{const n=t.collectionStore();if(!n)return;const s=Z.yk({environment:e,collectionContextStore:t,groupsPointer:o?[o]:[],store:g,before:!1,collectionStore:n,transaction:i,subitemPath:f,subitemInsertDirection:v&&!d?"below":"into",from:y});s&&r&&l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{To.bA({isNewBlock:!0,environment:e,blockPropertyValueOverlayStore:r,store:s,property:"title",format:Mo.C.Table,collectionContextStore:t})}))}))}});else{const r={col:m.end.col,row:t.currentViewHasSort()?S.length:m.end.row+1};ee.createAndCommit({userAction:"TableSelectionOverlay.handleShiftEnter",environment:e,perform:i=>{const n=Z.IW({environment:e,collectionContextStore:t,groupsPointer:o?[o]:[],insertAtIndex:r.row,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:i,from:y});if(n&&!n.coercionSucceeded){const r=o?[o]:[],i=t.groupsStore.getGroupState(r);le.CH({environment:e,store:n.newStore,peekMode:ce.kr(t),resultsStore:null==i?void 0:i.resultsStore,collectionContextStore:t,pageVisitSource:h.tY.Create})}}}),l.default.afterNextFlush((()=>{hc({selection:{start:r,end:r},shouldNormalize:!1},e,t,o,i,s,a)}))}}else{const r={col:m.end.col,row:t.currentViewHasSort()?S.length:m.end.row+1};ee.createAndCommit({userAction:"TableSelectionOverlay.handleShiftEnter",environment:e,perform:i=>{const n=Z.IW({environment:e,collectionContextStore:t,groupsPointer:o?[o]:[],insertAtIndex:r.row,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:i,from:y});if(n&&!n.coercionSucceeded){const r=o?[o]:[],i=t.groupsStore.getGroupState(r);le.CH({environment:e,store:n.newStore,peekMode:ce.kr(t),resultsStore:null==i?void 0:i.resultsStore,collectionContextStore:t,pageVisitSource:h.tY.Create})}}}),l.default.afterNextFlush((()=>{hc({selection:{start:r,end:r},shouldNormalize:!1},e,t,o,i,s,a)}))}dc(ec.Down,i,n,s,c,d,u),To.xv({environment:e,blockPropertyValueOverlayStore:r})}(this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.blockPropertyValueOverlayStore,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore,this.selectionStartRectStore,this.frozenSectionWidthStore,this.frozenIndex,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDuplicate=e=>function(e,t,o,r,i,n){const{device:s}=t;if(s.isMobile)return;const l=i.state;if(!l||l.start.col!==l.end.col||o)return;if(!Ce.M_(t))return;e.preventDefault(),ee.createAndCommit({userAction:"TableSelectionOverlay.handleDuplicate",environment:t,perform:e=>{uc({transaction:e,selection:l,start:l.start},r,n)}})}(e,this.environment,this.props.disabled,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCommandShiftEnter=e=>function(e,t,o,r){const{device:i}=t;if(i.isMobile)return;const n=o.state;if(n){const e=r.state[n.start.row],o=(0,Ko.ZP)({store:e,fullyQualified:!1,pageVisitSource:h.tY.LinkInPage});za.D({environment:t,url:o})}}(0,this.environment,this.normalizedTableSelectionStore,this.allRowsStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleKeypress=e=>function(e,t,o,r,i,n,s,l,a,c){if(!e.key||e.metaKey||e.ctrlKey)return;e.preventDefault(),Yo.Z.setKeyboardMode(!0);const d=l.state;if(!d)return;const u=a.state[d.start.row],p=r[d.start.col].property,h=o[p];if(!h)return;!i&&fe.ub.includes(h.type)&&e.key&&1===e.key.length&&(To.bA({environment:t,blockPropertyValueOverlayStore:n,store:u,property:p,format:Mo.C.Table,disableHorizontalEdgeScroll:c,insertChar:e.key,collectionContextStore:s}),pe.wG())}(e,this.environment,this.props.schema,this.props.showPropertyFormats,this.props.disabled,this.props.blockPropertyValueOverlayStore,this.props.collectionContextStore,this.normalizedTableSelectionStore,this.allRowsStore,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyTab=()=>function(e,t,o,r,i,n,s,l,a,c,d){const u=t.state;if(u.isOpen){const{store:p,property:h}=u,m=cc(p,h,o,n),S=o,g={col:Math.min(m.col+1,S.length-1),row:m.row};hc({selection:{start:g,end:g},shouldNormalize:!0},e,r,i,o,n,s),dc(ec.Right,o,l,n,a,c,d),To.xv({environment:e,blockPropertyValueOverlayStore:t})}}(this.environment,this.props.blockPropertyValueOverlayStore,this.props.showPropertyFormats,this.props.collectionContextStore,this.props.groupFormat,this.allRowsStore,this.selectionStartRectStore,this.normalizedTableSelectionStore,this.frozenSectionWidthStore,this.frozenIndex,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyUntab=()=>function(e,t,o,r,i,n,s,l,a,c,d){const u=t.state;if(u.isOpen){const{store:p,property:h}=u,m=cc(p,h,o,n),S={col:Math.max(m.col-1,0),row:m.row};hc({selection:{start:S,end:S},shouldNormalize:!0},e,r,i,o,n,s),dc(ec.Left,o,l,n,a,c,d),To.xv({environment:e,blockPropertyValueOverlayStore:t})}}(this.environment,this.props.blockPropertyValueOverlayStore,this.props.showPropertyFormats,this.props.collectionContextStore,this.props.groupFormat,this.allRowsStore,this.selectionStartRectStore,this.normalizedTableSelectionStore,this.frozenSectionWidthStore,this.frozenIndex,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyEnter=()=>function(e,t,o,r,i,n,s,a,c,d,u){const p=t.state;if(!p.isOpen)return;const{store:h,property:m}=p;if(e.device.isMobile){const t=r.normalizedSchemaStore.state[m],o=er.default.state;return void("text"===(null==t?void 0:t.type)&&"editing"===o.mode&&ee.createAndCommit({userAction:"TableSelectionOverlay.mobileEnter",environment:e,perform:t=>{Ga.hJ({environment:e,editorMode:"default",multiSelection:o.multiSelection,string:"\n",disableMentions:!0,disableEmojiCommands:!0,disableSlashCommands:!0,transaction:t})}}))}const S=cc(h,m,o,n),g={col:S.col,row:S.row+1};l.default.afterNextFlush((()=>{lc(t,e)&&hc({selection:{start:g,end:g},shouldNormalize:!0},e,r,i,o,n,s)})),dc(ec.Down,o,a,n,c,d,u),To.xv({environment:e,blockPropertyValueOverlayStore:t})}(this.environment,this.props.blockPropertyValueOverlayStore,this.props.showPropertyFormats,this.props.collectionContextStore,this.props.groupFormat,this.allRowsStore,this.selectionStartRectStore,this.normalizedTableSelectionStore,this.frozenSectionWidthStore,this.frozenIndex,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyClick=(e,t,o)=>function(e,t,o,r,i,n,s,l,a){var c;const{device:d}=r;if("checkbox"!==(null===(c=o[t])||void 0===c?void 0:c.type)||d.isMobile)pe.wG();else{const o=cc(e,t,i,l);hc({selection:{start:o,end:o},shouldNormalize:!0},r,n,s,i,l,a)}}(e,t,o,this.environment,this.props.showPropertyFormats,this.props.collectionContextStore,this.props.groupFormat,this.allRowsStore,this.selectionStartRectStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyBgClick=()=>{return e=this.environment,t=this.props.blockPropertyValueOverlayStore,o=this.props.showPropertyFormats,r=this.props.collectionContextStore,i=this.props.groupFormat,n=this.allRowsStore,s=this.selectionStartRectStore,l=this.normalizedTableSelectionStore,a=this.frozenSectionWidthStore,c=this.frozenIndex,d=this.props.disableHorizontalEdgeScroll,void mc(e,t,o,r,i,n,s,l,a,c,d);var e,t,o,r,i,n,s,l,a,c,d},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyEsc=()=>{return e=this.environment,t=this.props.collectionContextStore,o=this.props.blockPropertyValueOverlayStore,r=this.props.showPropertyFormats,i=this.props.groupFormat,n=this.allRowsStore,s=this.selectionStartRectStore,l=this.normalizedTableSelectionStore,a=this.frozenSectionWidthStore,c=this.frozenIndex,d=this.props.disableHorizontalEdgeScroll,void mc(e,o,r,t,i,n,s,l,a,c,d,(o=>{const{isNewBlock:r,store:i}=o;r&&i.isEmptyTitle()&&i.isEmptyPage()&&ee.createAndCommit({userAction:"TableSelectionOverlay.handlePropertyEsc",environment:e,perform:o=>{Ka.y8({environment:e,blocks:[i],transaction:o}),o.postSubmitCallbacks.push((o=>{if(!o){const o=t.collectionStore(),r=t.collectionViewBlockStore();L.dh(e,{analyticsName:"delete",from:"collection_esc_shortcut",block_id:i.id,block_type:"page",collection_id:null==o?void 0:o.id,collection_view_id:null==r?void 0:r.id})}}))}})}));var e,t,o,r,i,n,s,l,a,c,d},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyOpenProperty=e=>{!function(e,t,o,r,i){const n=t.state;if(n.isOpen){const{store:s}=n;To.bA({environment:i,blockPropertyValueOverlayStore:t,store:s,property:e,format:Mo.C.Table,disableHorizontalEdgeScroll:o,collectionContextStore:r})}}(e,this.props.blockPropertyValueOverlayStore,Boolean(this.props.disableHorizontalEdgeScroll),this.props.collectionContextStore,this.environment)},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyContextMenu=e=>function(e,t,o,r,i){e.preventDefault();const n=r.state,s=i.state,l=nc(e.target);let a=!1;if(s&&l){const r=Math.min(s.start.row,s.end.row),i=Math.max(s.start.row,s.end.row);if(l.row>=r&&l.row<=i){const s=n.slice(r,i+1);s.length>0&&(Y.Z5({environment:t,stores:s}),Y.Ys({environment:t,store:s[0]}),_o.Qn({environment:t,stores:Jo.default.state.stores,left:e.clientX,top:e.clientY,actionSectionGroupKey:"default",showInput:!0,analyticsFrom:"content_block_menu",optionalAnalyticsProperties:{collectionContextStore:o}}),a=!0)}}if(!a&&l){const r=n[l.row];r&&(Y.Ys({environment:t,store:r}),_o.Qn({environment:t,stores:Jo.default.state.stores,left:e.clientX,top:e.clientY,actionSectionGroupKey:"default",showInput:!0,analyticsFrom:"content_block_menu",optionalAnalyticsProperties:{collectionContextStore:o}}))}}(e,this.environment,this.props.collectionContextStore,this.allRowsStore,this.normalizedTableSelectionStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRowSelectableEnter=e=>function(e,t,o,r,i,n,s){const l=n.state,a=e.blocks.map((e=>l.indexOf(e))),c=N.VV(a)||0,d=N.Fp(a)||0;c>=0&&d>=0&&hc({selection:{start:{col:0,row:c},end:{col:0,row:d}},shouldNormalize:!0},t,o,r,i,n,s)}(e,this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.showPropertyFormats,this.allRowsStore,this.selectionStartRectStore),this.handleRowsWrapMount=e=>{this.rowsWrapEl=e},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRowsObserverChange=()=>{this.selectionStartRectStore.recompute()},this.allRowsStore=this.createComputedStore((()=>{const{groupFormat:e,collectionContextStore:t}=this.props;return(0,Go.A7)(e,t)})),this.normalizedTableSelectionStore=this.createComputedStore((()=>{const e=Ia.Z.state,t=this.props.collectionContextStore.collectionViewBlockStore();if(!t)return;const{groupFormat:o}=this.props;if(!e.isActive||!(0,Ia.N)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:o}))return;const{selection:r}=e;return pc(r,this.props.showPropertyFormats,this.allRowsStore)}),!0),this.selectionStartRectStore=this.createComputedStore((()=>{const e=this.normalizedTableSelectionStore.state;if(e)return this.getCellRect(e.start)}),!0),this.frozenIndex=this.createComputedStore((()=>this.props.collectionContextStore.frozoneStore.state.frozenIndex)),this.maxFrozenIndex=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore(),o=e.frozoneStore.state.scrollerWidth;return null==t?void 0:t.getTableMaxFrozenColumnIndex(o,e.normalizedFormatStore.state)})),this.frozenSectionWidthStore=this.createComputedStore((()=>{const e=this.frozenIndex.state;if(void 0!==e){let t=ac(this.props.collectionContextStore,this.environment);const{showPropertyFormats:o}=this.props,r=o;for(let i=0;i<=e&&!(i>=r.length);i++){const e=r[i];e.width&&(t+=e.width)}return t-1}}),!0),this.multiSelectCheckedStore=this.createComputedStore((()=>{const e=function(e,t){const o=t?[t]:[];return(0,Go.A7)(o[0],e)}(this.props.collectionContextStore,this.props.groupFormat),t=e.length;if(0===t)return!1;const o=Jo.default.state.stores.filter((t=>e.includes(t))).length;return 0!==o&&(o===t||"indeterminate")})),this.shouldRenderFrozenColumnRepositioner=this.createComputedStore((()=>void 0!==this.frozenIndex.state&&!this.stores.dragAndFillStore.state&&!this.multiSelectCheckedStore.state&&!Ia.Z.state.isActive&&void 0===this.props.tableStore.state.temporaryFormat&&this.props.collectionContextStore.permissionScopes.state.canConfigureBlock)),this.renderArgs={onPropertyTab:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyTab,onPropertyUntab:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyUntab,onPropertyEnter:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyEnter,onPropertyClick:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyClick,onPropertyEsc:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyEsc,onPropertyBgClick:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyBgClick,onPropertyContextMenu:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyContextMenu,onOpenProperty:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyOpenProperty,onSelectableEnter:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRowSelectableEnter}}willUnmount(){super.willUnmount(),this.observer&&this.observer.disconnect()}didMount(){super.didMount(),this.rowsWrapEl&&(this.observer=new MutationObserver(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRowsObserverChange),this.observer.observe(this.rowsWrapEl,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))}renderComponent(){const{store:e,schema:t,showPropertyFormats:o}=this.props,r=this.normalizedTableSelectionStore.state,i=sc(this.props.disabled,this.props.collectionContextStore)&&r&&(r.start.col===r.end.col&&r.start.row===r.end.row||this.stores.dragAndFillStore.state)?(0,b.jsx)(rc,{store:e,schema:t,selection:r,dragAndFillStore:this.stores.dragAndFillStore,showPropertyFormats:o,selectionStartRectStore:this.selectionStartRectStore,rowsWrapRect:this.getRowsWrapRect(),frozenIndexStore:this.frozenIndex,currentRowsStore:this.allRowsStore}):null,n=this.shouldRenderFrozenColumnRepositioner.state?(0,b.jsx)($a,{frozenColumnRepositionStore:this.stores.frozenColumnRepositionStore,frozenIndex:this.frozenIndex.state,maxFrozenIndex:this.maxFrozenIndex.state,xForFirstCellInRow:ac(this.props.collectionContextStore,this.environment),showPropertyFormats:o,frozenSectionWidth:this.frozenSectionWidthStore.state}):null,s=this.props.render(this.renderArgs);return(0,b.jsx)(Bo.Z,{debugName:"TableSelectionOverlay",capture:void 0!==this.normalizedTableSelectionStore.state,onLeft:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleLeft,onRight:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRight,onUp:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleUp,onDown:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDown,onEnter:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleEnter,onTab:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTab,onUntab:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleUntab,onEsc:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleEsc,onDelete:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDelete,onBackspace:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDelete,onCut:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCut,onCopy:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCopy,onPaste:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePaste,onCommandEnter:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCommandEnter,onShiftEnter:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleShiftEnter,onCommandShiftEnter:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCommandShiftEnter,onDuplicate:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDuplicate,onKeypress:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleKeypress,onMoveTo:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMoveTo,children:(0,b.jsx)(sa.Z,{onDraggableDragStart:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDragStart,onDraggableDragMove:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDragMove,onDraggableDragEnd:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDragEnd,onDraggableDragCancel:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDragCancel,disableHorizontalEdgeScroll:this.props.disableHorizontalEdgeScroll,render:e=>(0,b.jsxs)("div",{style:{position:"relative",minWidth:this.props.minWidth},...e,ref:this.handleRowsWrapMount,children:[n,i,s]})})})}getRowsWrapRect(){return this.rowsWrapEl?this.rowsWrapEl.getBoundingClientRect():void 0}getCellRect(e){const{rowsWrapEl:t}=this;if(!t)return;const{showPropertyFormats:o}=this.props,r=o,i=function(e,t){if(!t)return;const o=Xa.C.findSelectablesFromStore(e),r=o.map((e=>e.getNode())).find((e=>t.contains(e)));if(!r)return;return r.getBoundingClientRect()}(this.allRowsStore.state[e.row],t);if(!i)return;const n=t.getBoundingClientRect(),s=i.height,l=i.top-n.top-1,a=r[e.col].width||0,c=s+1;let d=ac(this.props.collectionContextStore,this.environment);for(let u=0;u<e.col;u++){const e=r[u];e.width&&(d+=e.width)}return new DOMRect(d-1,l,a+1,c)}}tc.displayName="TableSelectionOverlay",tc.contextTypes={...xn.wK,...s.w};const oc=10;function rc(e){var t;const{store:o,schema:r,selection:i,dragAndFillStore:n,currentRowsStore:s,showPropertyFormats:l,selectionStartRectStore:a,rowsWrapRect:c,frozenIndexStore:p}=e,h=(0,d.VK)((()=>n.state),[n]),m=(0,d.VK)((()=>{const e=(null==h?void 0:h.start)||i.start;return l[e.col]}),[h,i,l]),S=(0,B.useIntl)(),g=(0,d.VK)((()=>{if(!h||!m)return[];const{start:e}=h,t=s.state[e.row].getModel();return t?(0,Ha.v4)({property:m.property,schema:r,block:t,getRecordValue:o.getRecordValue,userTimeZone:(0,Ee.r)(),baseURL:void 0,intl:S}):""}),[s,h,S,m,r,o]),C=m?null===(t=r[m.property])||void 0===t?void 0:t.type:void 0,f=(0,d.VK)((()=>a.state),[a]),y=(0,d.VK)((()=>p.state),[p]),v=(0,d.VK)((()=>void 0!==y&&i.start.col<=y),[y,i]),x=(0,u.yK)((e=>({dragAndFillContainer:{zIndex:v?F.hc+4:void 0,display:"flex",position:"relative"},dragAndFillOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)"},dragAndFillInsideStickyWrapper:{position:v?"sticky":void 0,left:"0"},tooltipContainer:{position:"absolute",left:f?f.left+f.width-5:void 0,zIndex:F.IK},tooltipOrigin:{position:"absolute",left:0,top:f?f.bottom-7:void 0,width:oc,height:1.5*oc,pointerEvents:"auto",cursor:"ns-resize"},tooltipCircle:{position:"absolute",left:0,top:f?f.bottom-5:void 0,width:9,height:9,border:`2px solid ${xe.ZP.blueWithAlpha(.57)}`,transform:h?"scale(1.3)":void 0,transition:"transform 0.2s ease",background:e.contentBackground,borderRadius:"50%",cursor:"ns-resize"},tooltipText:{color:e.mediumInvertedTextColor,maxWidth:200,...D.Z.textOverflowStyle}})),[v,f,h]);if(!f)return null;if(!C||fe.ZY(C)||"rollup"===C||"formula"===C||"verification"===C)return null;let w;return c&&(w=new DOMRect(f.x+c.x+f.width-4,f.y+c.y+f.height-4,7,7)),(0,b.jsx)(Xe.ZP,{renderTooltip:()=>{const e=(0,b.jsx)(B.FormattedMessage,{id:"tableView.selectionOverlay.dragAndFill.tooltip",defaultMessage:"Drag vertically to fill value"});return h?(0,b.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[e,(0,b.jsx)("div",{style:x.tooltipText,children:g})]}):e},delayThreshold:300,forceVisibleState:!!h||void 0,originRect:w,placement:As.u.Right,render:e=>(0,b.jsx)("div",{...e,className:fo.JR_,style:x.dragAndFillContainer,children:(0,b.jsx)("div",{style:x.dragAndFillOutsideStickyWrapper,children:(0,b.jsx)("div",{style:x.dragAndFillInsideStickyWrapper,children:(0,b.jsxs)("div",{style:x.tooltipContainer,children:[(0,b.jsx)("div",{style:x.tooltipOrigin}),(0,b.jsx)("div",{style:x.tooltipCircle})]})})})})})}function ic(e){const{value:t}=(0,Ya.useDependency)(Ya.deps.markdownLinkifyIt),{value:o}=(0,Ya.useDependency)(Ya.deps.tinyMceMicrosoftWordPasteFilter);return(0,b.jsx)(tc,{...e,markdownLinkifyIt:t,tinyMceMicrosoftWordPasteFilter:o})}function nc(e){let t=e;for(;null!==t&&!t.classList.contains(fo.mWS);)t=t.parentElement;if(null===t)return;return{col:parseInt(t.getAttribute("data-col-index")??"0"),row:parseInt(t.getAttribute("data-row-index")??"0")}}function sc(e,t){const o=t.permissionScopes.state;return!e&&o.canEditContent}function lc(e,t){if(!(0,qa.zq)(t))return!0;const o=e.state;return!o.isOpen||0===o.additionalStores.length}function ac(e,t){return(0,ce.fk)({environment:t,collectionContextStore:e})?Kr.Xx:0}function cc(e,t,o,r){const i=r.state;return{col:o.findIndex((e=>e.property===t)),row:i.findIndex((t=>e===t))}}function dc(e,t,o,r,i,n,s){const l=o.state;if(l){let o;o=e===ec.Down?l.start.row>l.end.row?l.start:l.end:e===ec.Up?l.start.row<l.end.row?l.start:l.end:e===ec.Right?l.start.col>l.end.row?l.start:l.end:l.start.col<l.end.row?l.start:l.end;const a=r.state[o.row],c=t[o.col].property,d=la.Z.findBlockPropertyValue(a,c),u=(null==d?void 0:d.getNode())??null;if(u){const e=i.state??0,t=n.state,o=s||t&&l.start.col<=t&&l.end.col<=t;q.bx({element:u,vertical:{reveal:"closest",paddingToTopEdge:96,paddingToBottomEdge:48},horizontal:o?void 0:{reveal:"closest",paddingToLeftEdge:e},scrollers:{verticalScroller:null==d?void 0:d.getContextVerticalScroller(),horizontalScroller:null==d?void 0:d.getContextHorizontalScroller()}})}}}function uc(e,t,o){const{transaction:r,selection:i,start:n}=e,s=o.state,l=t[n.col],a=s[n.row].getPropertyValue(l.property)||[],c=Math.min(i.start.row,i.end.row),d=Math.max(i.start.row,i.end.row);s.slice(c,d+1).forEach((e=>{e.pointer!==s[n.row].pointer&&Ga.sO({environment:e.environment,editorMode:"default",store:e.getNormalizedPropertyStore(l.property),value:a,transaction:r})}))}function pc(e,t,o){const r=t.length,i=o.state.length;return{start:{col:(0,Aa.Z)(e.start.col,0,r-1),row:(0,Aa.Z)(e.start.row,0,i-1)},end:{col:(0,Aa.Z)(e.end.col,0,r-1),row:(0,Aa.Z)(e.end.row,0,i-1)}}}function hc(e,t,o,r,i,n,s){const{selection:l,shouldNormalize:a}=e,c=o.collectionViewBlockStore();c&&(Dl.Z5({environment:t,selectionKey:{collectionViewBlockStore:c,groupFormat:r},selection:a?pc(l,i,n):l}),s.recompute())}function mc(e,t,o,r,i,n,s,l,a,c,d,u){const{device:p}=e,h=t.state;if(h.isOpen){const{store:m,property:S}=h,g=cc(m,S,o,n);p.isMobile?pe.wG():lc(t,e)&&hc({selection:{start:g,end:g},shouldNormalize:!0},e,r,i,o,n,s),dc(ec.Down,o,l,n,a,c,d),To.xv({environment:e,blockPropertyValueOverlayStore:t}),null==u||u(h)}}function Sc(e){const{isFullScreen:t,hasGroups:o,propertyWidths:r,hasPartialResults:i,hasSearchQuery:n,frozoneProps:s}=e,l=(0,a.O7)(),c=(0,u.Fg)(),p=(0,a.Fy)().isPhone,h=(0,tn.DK)(),m=(0,Br.Z)(!0,0,100),S=(0,d.VK)((()=>Boolean(null==h?void 0:h.normalizedFormatStore.state.hide_table_vertical_lines)),[h]),g=(0,d.VK)((()=>!!h&&(0,ce.fk)({environment:l,collectionContextStore:h})),[h,l]),C=s.isScrolled,f=s.frozenIndex,y=void 0!==f,v=(0,d.VK)((()=>{if(!h)return!1;const e=h.collectionViewBlockStore();return!!e&&(0,js.sY)(e)}),[h]),x=(0,d.VK)((()=>h?(0,Kr.oc)({environment:l,collectionContextStore:h,isPhone:p,theme:c}):{}),[h,l,p,c]),w=(0,u.yK)((e=>({container:{display:"flex",flexDirection:"row",alignItems:"flex-start"},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%"},frozenColumnsContainer:{display:"flex",flexDirection:"row",...x,...-1===f?{background:void 0}:{}},multiselectCheckbox:{display:"flex",flexDirection:"row",pointerEvents:"none",cursor:"pointer",...x},rowContainer:{display:"flex",alignItems:"flex-start",padding:y?void 0:"0px 16px",borderBottom:`1px solid ${e.tableDividerColor}`,width:"100%"},rowShimmer:{height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor,marginLeft:y?0:8},column:{display:"flex",height:32,padding:"0px 8px",alignItems:"center",borderRight:S?void 0:`1px solid ${e.tableDividerColor}`}})),[x,f,y,S]);if(!m||!h)return null;const k=r.map(((e,t)=>(0,b.jsx)("div",{style:{...w.column,width:e},children:(0,b.jsx)(Nr.Z,{style:{...w.rowShimmer,width:.6*(e-16)}})},t)));let _=null,T=[];if(y&&void 0!==f){const e=k.slice(0,f+1);_=(0,b.jsxs)("div",{style:w.frozenColumnsContainer,children:[(0,b.jsxs)(Ma,{isCollectionViewBlockSelected:v,shouldFreeze:-1!==f,children:[g&&(0,b.jsx)("div",{style:{width:32,height:31}}),e]}),e.length>0?(0,b.jsx)(il,{passesFilter:!0,isShimmerRow:!0,isScrolled:C}):null]}),T=k.slice(f+1,k.length)}else T=k;let O=1;o||i||n||(O=t?10:3);const V=[...Array(O)].map(((e,t)=>(0,b.jsxs)("div",{style:w.rowContainer,children:[_,T]},t)));return(0,b.jsx)("div",{style:w.container,children:(0,b.jsx)("div",{style:w.rowsContainer,children:V})})}const gc=i.memo((function(e){const{groupFormat:t,store:o,format:r,schema:n,query:s,collectionContextStore:c,showHoverActionsStore:p,isFullScreen:m,isInPeekRenderer:S,disabled:g,blockPropertyValueOverlayStore:C,minWidth:f,paddingBottom:y,paddingLeft:v,tableStore:x}=e,w=(0,a.O7)(),k=(0,a.Fy)(),_=(0,i.useContext)(xn.ZO),T=(0,d.VK)((()=>{const e=t?[t]:[];return c.groupsStore.getGroupState(e)}),[t,c]),O=(0,d.VK)((()=>{const e=function(e,t){const o=yc(e,t);return o&&o.table_properties?o.table_properties:[]}(r,x).filter((e=>e.visible));return k.isMobile?e.slice(0,20):e}),[k.isMobile,r,x],{useDeepEqual:!0}),V=(0,d.VK)((()=>null==T?void 0:T.reducerResultStore.state),[T]),P=(0,d.VK)((()=>void 0!==V),[V]),R=(0,d.VK)((()=>c.permissionScopes.state),[c]),M=(0,Is.PE)(e.store,e.disabled),j=(0,d.VK)((()=>!!M&&(!R.isSyncedCollection&&R.canEditContent)),[M,R]),I=(0,d.VK)((()=>"collectionTypedView"===c.contextType),[c]),F=(0,d.VK)((()=>c.isInHomeWidget.state),[c]),N=(0,d.VK)((()=>Boolean(!F&&P&&(j||I)&&c.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))),[j,c,P,I,F]),E=(0,d.VK)((()=>O.reduce(((e,t)=>e+(t.width||0)),0)+(R.canEditContent?Ca:0)),[O,R]),A=(0,d.VK)((()=>O.map((e=>e.width||Xt.Nx))),[O]),H=(0,d.VK)((()=>O.findIndex((e=>"title"===e.property))),[O]),z=(0,d.VK)((()=>{const e=t?[t]:[],o=(0,Go.A7)(e[0],c);return Jo.default.state.stores.filter((e=>o.includes(e))).length>0}),[t,c]),G=(0,d.VK)((()=>{const{device:e,ThemeModeStore:t}=w,{isScrolled:o,frozenIndex:r,tryShowHiddenFrozenColumn:i}=c.frozoneStore.state;if(void 0===r)return{isScrolled:!1,frozenIndex:void 0,frozenStyles:{},shouldFreezeMultiSelectColumn:!1,shouldShowStickyMultiSelectColumn:!1,isCollectionViewBlockSelected:!1};const n=(0,xe.gh)({theme:t.state}),s={...(0,Kr.oc)({environment:w,collectionContextStore:c,isPhone:e.isPhone,theme:n}),display:"flex",...o&&-1===r&&{height:"calc(100% + 1px)",borderBottom:`1px solid ${n.tableDividerColor}`}},l=Boolean(o&&-1===r),a=Boolean(l&&(i||z)),d=c.collectionViewBlockStore(),u=!!d&&(0,js.sY)(d);return{isScrolled:Boolean(o),frozenIndex:r,frozenStyles:s,shouldFreezeMultiSelectColumn:l,shouldShowStickyMultiSelectColumn:a,isCollectionViewBlockSelected:u}}),[z,c,w],{useDeepEqual:!0}),K=(0,d.VK)((()=>ce.VM({collectionContextStore:c,reducerResult:V,isFullScreen:m})),[c,m,V]),U=(0,i.useMemo)((()=>t?[t]:[]),[t]),W=(0,i.useMemo)((()=>void 0!==V&&V.blockIds.length>0),[V]),$=(0,d.VK)((()=>""!==c.searchQuery.state),[c]),q=(0,d.VK)((()=>Wt({collectionContextStore:c,groupsPointer:U,hasPartialResults:W})),[c,U,W]),Q=(0,d.VK)((()=>c.viewIsFlushToTopbar()),[c]),X=(0,d.VK)((()=>Boolean(c.normalizedFormatStore.state.hide_table_vertical_lines)),[c]),J=(0,d.VK)((()=>{const e=c.collectionViewStore();return j&&k.isMobile&&!(null!=e&&e.isSyncedCollection())}),[j,c,k.isMobile]),te=(0,d.VK)((()=>Qt({collectionContextStore:c,groupsPointer:U})),[c,U]),oe=(0,d.VK)((()=>yc(r,x)),[r,x]),re=(0,d.VK)((()=>c.isCompactView.state),[c]),se=(0,i.useCallback)((()=>{if(!T)return;const e=c.collectionStore();if(!e||!c.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const t=Jo.default.state.stores[0];if(!t)return;const o=c.subitemTreeStore.state,r=(0,Gr.DY)(o.children,(e=>e.value.store===t));if(!r)return;const i=r?(0,Go.Af)(r.map((e=>e.value.store))):"",n=c.subitemExpandedStore.state.get(i);Boolean(null==n?void 0:n.isExpanded)&&ee.createAndCommit({userAction:"TableGroupResults.onItemShiftEnter",environment:w,perform:o=>{const i=Z.yk({environment:w,collectionContextStore:c,groupsPointer:T.groupsPointer,store:t,before:!1,collectionStore:e,transaction:o,subitemPath:r,subitemInsertDirection:"into",from:"table_group_results_shift_enter"});i&&C&&l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{To.bA({isNewBlock:!0,environment:w,blockPropertyValueOverlayStore:C,store:i,property:"title",format:Mo.C.Table,collectionContextStore:c})}))}))}})}),[C,c,w,T]),de=(0,i.useCallback)((e=>{const o=new Rs.sA(w,"handleAddRowClick"),r=t?[t]:[],i=c.groupsStore.getGroupState(r);Ce.M_(w)&&i?(c.searchQuery.state&&pe.Ug({searchQuery:"",collectionContextStore:c,isFullScreen:m}),ee.createAndCommit({userAction:"TableGroupResults.handleAddRowClick",environment:w,perform:r=>{var n;const s=Z.IW({environment:w,collectionContextStore:c,groupsPointer:t?[t]:[],shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:r,from:"table_group_results",tracker:o,useCrdt:(0,Co.SL)({event:e,source:"collection_table_view",contextualDefault:null===(n=c.defaultPageTemplateStore.state)||void 0===n?void 0:n.useCrdt()})});if(!s)return;const a=s.newStore;if(k.isMobile){const e=(0,Ko.ZP)({store:a,fullyQualified:!1,pageVisitSource:h.tY.Create});_?_(e):ae.c4({environment:w,url:e})}else{l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{s.coercionSucceeded?To.bA({isNewBlock:!0,environment:w,blockPropertyValueOverlayStore:C,store:a,property:"title",format:Mo.C.Table,collectionContextStore:c}):le.CH({environment:w,store:a,peekMode:ce.kr(c),resultsStore:i.resultsStore,collectionContextStore:c,pageVisitSource:h.tY.Create})}))}))}));const e=c.currentSubitemFormatStoreForCollection.state;ne.W(w,{from:e?"table_add_parent_item_bottom":"table_add_item_bottom",type:"page",new_page_id:a.id,creating_block_id:a.id,...(0,he.Pn)(c)})}}})):o.fail("invalid_state")}),[C,c,k.isMobile,w,t,m,_]),ue=(0,i.useCallback)((e=>{const o=c.groupsStore.getGroupState(t);if(!o)return;const r=o.reducerResultStore.state;(0,me.Wi)(e),Y.ZH(w),r&&Z.ID({collectionContextStore:c,environment:w,incrementLimitArgs:{isFullScreen:m,currentResultCount:r.blockIds.length,groupsPointer:o.groupsPointer,incrementLimitsInRelatedGroups:!1}}),Ut.j({name:"collection_load_more"}),L.uD(w)}),[c,w,t,m]),Se=(0,d.VK)((()=>{var e;return null===(e=c.inheritedBlockColorStore.state)||void 0===e?void 0:e.background}),[c]),ge=(0,u.yK)((e=>({iconStyle:{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.lightIconColor},viewAllButton:{borderTop:`1px solid ${e.tableDividerColor}`,paddingTop:6,paddingBottom:6},loadMoreButton:{display:"flex",alignItems:"center",height:bc+1,width:"100%",paddingLeft:kc,paddingBottom:2,fontSize:14,lineHeight:D.Z.lineHeight.UIRegular.desktop,borderBottom:`1px solid ${e.tableDividerColor}`,whiteSpace:"break-spaces"},loadMoreButtonHovered:{...te?{background:e.whiteButtonBackground}:{}},loadMoreButtonInner:{display:"flex",alignItems:"center",color:e.lightTextColor,position:"sticky",left:kc},addRowButton:{borderBottom:`1px solid ${e.tableDividerColor}`,display:"flex",alignItems:"center",height:bc,width:"100%",paddingLeft:8,fontSize:14,lineHeight:D.Z.lineHeight.UIRegular.desktop,background:Se||(S?e.cardContentBackground:e.contentBackground),left:0,right:0},addRowButtonInner:{display:"inline-flex",alignItems:"center",position:"sticky",left:8,color:e.lightTextColor},aggregationRow:{...(!P||F)&&{opacity:0,pointerEvents:"none",left:0,right:0}},aggregationRowPlaceholder:{height:F?0:wc}})),[Se,S,te,P,F]),fe=(0,d.VK)((()=>c.isUnlistedView.state&&c.isCompactView.state),[c]);if(!T)return null;const ye=P&&!q&&0===(null==V?void 0:V.blockIds.length),ve=Boolean(t),be=Q&&!ve;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(xa,{store:o,format:oe,groupFormat:t,schema:n,query:s,collectionContextStore:c,isInPeekRenderer:S,minWidth:f,paddingBottom:y,blockPropertyValueOverlayStore:C,resultStore:T.reducerResultStore,showPropertyFormats:O,showRightActions:R.canConfigureCollection&&R.canConfigureBlock&&!fe,allowHidingTitle:!1,tableStore:x,formatKey:"table_properties",disabled:g||!R.canConfigureCollection&&!R.canConfigureBlock,disableTopBorder:!be,disableCellRightBorder:!be||X,height:xc,frozoneProps:G,isInHomeWidget:F}),(0,b.jsx)("div",{style:{height:xc}}),(0,b.jsx)(ic,{store:o,format:oe,schema:n,query:s,collectionContextStore:c,minWidth:f,blockPropertyValueOverlayStore:C,showPropertyFormats:O,disabled:!j,groupFormat:t,tableStore:x,paddingLeft:v,render:e=>(0,b.jsx)(fc,{args:e,store:o,collectionContextStore:c,collectionViewFormat:oe,blockPropertyValueOverlayStore:C,groupFormat:t,propertyFormats:O,schema:n,canDrag:J,disabled:g,titleColumnIndex:H,onShiftEnter:se,frozoneProps:G,isInHomeWidget:F,isFullScreen:m})}),q&&(0,b.jsx)(Sc,{isFullScreen:m,hasGroups:void 0!==t,propertyWidths:A,hasPartialResults:W,hasSearchQuery:$,frozoneProps:G}),ye&&(0,b.jsx)(qs,{collectionContextStore:c,shouldShowAddRowButton:N,handleAddRowClick:de,paddingLeft:v}),(0,b.jsx)("div",{style:{width:E}}),K&&(re?(0,b.jsx)(no,{groupsPointer:U,store:o,collectionContextStore:c,format:r,isFullScreen:m,incrementLimitsInRelatedGroups:!1,style:ge.viewAllButton}):(0,b.jsx)(Yt.Z,{onMouseDown:me.$0,onClick:ue,disabled:te,hoveredStyle:ge.loadMoreButtonHovered,style:ge.loadMoreButton,children:(0,b.jsxs)("span",{style:ge.loadMoreButtonInner,children:[(0,Kt.M)(ge.iconStyle),(0,b.jsx)(B.FormattedMessage,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"}),te?(0,b.jsx)("div",{style:{marginTop:1,marginLeft:8,marginRight:8},children:(0,b.jsx)(Ge.Z,{style:{width:12,height:12}})}):j&&(0,b.jsx)(oo,{collectionContextStore:c,format:r})]})})),N&&(0,b.jsx)(Yt.Z,{onClick:de,onMouseDown:me.$0,style:ge.addRowButton,className:fo.tfM,children:(0,b.jsxs)("span",{style:ge.addRowButtonInner,children:[(0,ie.R)(ge.iconStyle),(0,b.jsx)(B.FormattedMessage,{defaultMessage:"New",id:"database.tableView.addRowButton"})]})}),(0,b.jsx)(Ws,{groupFormat:t,disabled:g||!R.canConfigureBlock,schema:n,query:s,collectionContextStore:c,isInPeekRenderer:S,isFullScreen:m,showPropertyFormats:O,showRightActionsSpacer:R.canConfigureCollection,showHoverActionsStore:p,style:ge.aggregationRow}),(0,b.jsx)("div",{style:ge.aggregationRowPlaceholder})]})})),Cc=gc,fc=i.memo((function(e){const t=(0,a.O7)(),{args:o,store:r,collectionContextStore:n,collectionViewFormat:s,blockPropertyValueOverlayStore:c,groupFormat:p,propertyFormats:h,schema:m,canDrag:S,disabled:g,titleColumnIndex:C,onShiftEnter:f,frozoneProps:y,isInHomeWidget:v,isFullScreen:x}=e,w=(0,i.useMemo)((()=>p?[p]:[]),[p]),k=(0,d.VK)((()=>n.permissionScopes.state),[n.permissionScopes]),_=(0,d.VK)((()=>Boolean(n.normalizedFormatStore.state.hide_table_vertical_lines)),[n.normalizedFormatStore]),T=(0,d.VK)((()=>ce.fk({environment:t,collectionContextStore:n})),[n,t]),O=(0,d.VK)((()=>r.isNonEditableState()),[r]),V=(0,u.yK)((e=>({itemSelectableHalo:{borderRadius:3,zIndex:F.iO},itemSelectableStyle:{display:"flex",height:"calc(100% + 2px)"}})),[]),P=(0,i.useCallback)((()=>V.itemSelectableStyle),[V]),R=(0,i.useCallback)((e=>{const{store:o,parentStore:r,subitemPath:i,indentLevel:s}=e;if(r)return(0,b.jsx)(Ms,{store:o,collectionStore:r,subitemPath:i,indentLevel:s,collectionContextStore:n,disabled:g,groupsPointer:w,onSubitemCreate:e=>{c&&l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{To.bA({isNewBlock:!0,environment:t,blockPropertyValueOverlayStore:c,store:e,property:"title",format:Mo.C.Table,collectionContextStore:n})}))}))}})}),[c,n,g,t,w]),M=(0,i.useMemo)((()=>({schema:m,collectionContextStore:n,propertyFormats:h,onPropertyTab:o.onPropertyTab,onPropertyUntab:o.onPropertyUntab,onPropertyEnter:o.onPropertyEnter,onPropertyClick:o.onPropertyClick,onPropertyEsc:o.onPropertyEsc,onPropertyBgClick:o.onPropertyBgClick,onPropertyContextMenu:o.onPropertyContextMenu,onOpenProperty:o.onOpenProperty,disabled:g,blockPropertyValueOverlayStore:c,showRightActionsSpacer:k.canConfigureCollection,disableCellBorderRight:_,disableHorizontalEdgeScroll:!1,disableLastCellBorderRight:!k.canConfigureCollection||O,disableTableWrap:!1,onShiftEnter:f,titleColumnIndex:C,groupFormat:p,frozoneProps:y,shouldShowMultiSelectCheckbox:T,isInHomeWidget:v})),[o.onOpenProperty,o.onPropertyBgClick,o.onPropertyClick,o.onPropertyContextMenu,o.onPropertyEnter,o.onPropertyEsc,o.onPropertyTab,o.onPropertyUntab,c,n,g,_,f,k.canConfigureCollection,h,m,C,p,y,T,O,v]);return(0,b.jsx)(ii,{collectionContextStore:n,groupsPointer:w,format:s,canDrag:S,resultProps:M,canDrop:!0,resultComponent:Ea,disabled:g,direction:oi.Vertical,getItemSelectableStyle:P,itemSelectableHaloStyle:V.itemSelectableHalo,shouldShowHoverMenu:!0,analyticsName:"table",emptyDroppableSize:0,touchDragOnly:!0,onSelectableEnter:o.onSelectableEnter,blockPropertyValueOverlayStore:c,titleColumnIndex:C,nestedCreateSubitemButton:R,virtualizeResults:0===w.length&&x})}),po.Z);function yc(e,t){const{temporaryFormat:o}=t.state;return o||e}const vc={position:"relative",float:"left",minWidth:"100%",WebkitUserSelect:"none",fontVariantNumeric:"lining-nums tabular-nums"},xc=34,bc=32,wc=32,kc=8,_c=42;class Tc extends Ho.Z{constructor(){super(...arguments),this.storeTypes={tableStore:Ps},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem=(e,t,o)=>Rc(e,t,o,this.environment,this.props.collectionContextStore),this.viewSettingsSidebarOpen=this.createComputedStore((()=>{var e;return this.props.collectionContextStore.settingsStore.state.open&&"sidebar"===(null===(e=this.props.viewSettingsPlacementStore)||void 0===e?void 0:e.state)}))}renderPersisted(){const{store:e,paddingBottom:t,paddingLeft:o,paddingRight:r,isFullScreen:i,collectionContextStore:n,format:s}=this.props,l=ce.az(n,i),a=s.collection_group_by,c=n.isCompactView.state;return(0,rs.Z)((s=>{const d=(0,b.jsx)(It.Z,{store:e,shouldShowHalo:!i&&!c,canSelect:!i,analyticsName:"table",style:{position:"relative"},...s,children:a?(0,b.jsx)(jc,{collectionContextStore:this.props.collectionContextStore,store:this.props.store,format:this.props.format,schema:this.props.schema,disabled:this.props.disabled,isFullScreen:this.props.isFullScreen,paddingLeft:this.props.paddingLeft,isRootChild:this.props.isRootChild,isInPeekRenderer:this.props.isInPeekRenderer,query:this.props.query,showHoverActionsStore:this.props.showHoverActionsStore,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,minWidth:this.props.minWidth,paddingBottom:this.props.paddingBottom,tableStore:this.stores.tableStore,groupBy:a}):(0,b.jsx)(Mc,{store:this.props.store,format:this.props.format,schema:this.props.schema,query:this.props.query,collectionContextStore:this.props.collectionContextStore,showHoverActionsStore:this.props.showHoverActionsStore,isFullScreen:this.props.isFullScreen,isInPeekRenderer:this.props.isInPeekRenderer,disabled:this.props.disabled,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,minWidth:this.props.minWidth,paddingBottom:this.props.paddingBottom,paddingLeft:this.props.paddingLeft,tableStore:this.stores.tableStore,groupFormat:void 0})});return(0,b.jsxs)("div",{style:{...vc,paddingBottom:t,paddingLeft:o,paddingRight:r+(this.viewSettingsSidebarOpen.state?Os.nJ+20:0)},className:fo._so,children:[a?d:(0,b.jsx)(Ni,{renderEmitter:n.renderEmitter,isFullScreen:i,children:d}),!l&&(0,b.jsx)(di.Z,{onChange:e=>function(e,t,o,r){const i=t.isLoading.state,n=t.groupsStore.getGroupState([]),s=null==n?void 0:n.reducerResultStore.state;e<vo.Z.incrementScrollOffset&&s&&!i&&s.hasMore&&(t.infiniteScrollLongTaskObserver.observe(),Z.ID({collectionContextStore:t,environment:r,incrementLimitArgs:{isFullScreen:o,currentResultCount:s.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}}))}(e,this.props.collectionContextStore,this.props.isFullScreen,this.environment)})]})}))}}Tc.displayName="Table";const Oc=(0,B.injectIntl)(Tc);function Vc(e,t,o){const r=t.viewIsFlushToTopbar();if(t.isCompactView.state)return{};if(0===e.index&&!r)return{};return t.shouldShowSpinner.state&&e.index>0?{}:{borderTop:`1px solid ${o.tableDividerColor}`}}function Pc(e){let{args:t,isInPeekRenderer:o}=e;const{collectionContextStore:r}=t,i=(0,u.Fg)(),n=(0,d.VK)((()=>r.isCompactView.state),[r]);return(0,b.jsx)(Nt,{...t,height:n?yo.yZ:_c,paddingTop:8,toggleClosedMarginBottom:8,getComputedStickyStyle:e=>function(e,t,o){return{boxShadow:e?`0 -1px 0 ${t?o.cardContentBackground:o.contentBackground}`:void 0}}(e,o,i)})}function Rc(e,t,o,r,i){!function(e,t,o,r){if(r.device.isMobile)se._c({environment:r,store:e,pageVisitSource:h.tY.Create});else{const{groupFormat:i}=t,n=i?[i]:[],s=o.groupsStore.getGroupState(n),l="collectionTypedView"===o.contextType;le.CH({environment:r,store:e,peekMode:ce.kr(o),showMoveTo:l,resultsStore:null==s?void 0:s.resultsStore,collectionContextStore:o,pageVisitSource:h.tY.Create})}}(e,o,i,r)}function Mc(e){let{groupFormat:t,store:o,format:r,schema:i,query:n,collectionContextStore:s,showHoverActionsStore:l,isFullScreen:a,isInPeekRenderer:c,disabled:u,blockPropertyValueOverlayStore:p,minWidth:h,paddingBottom:m,paddingLeft:S,tableStore:g}=e;const C=(0,d.qz)(g,Ps);return(0,d.VK)((()=>s.groupsStore.getGroupState(t?[t]:[])),[s,t])?(0,b.jsx)(Cc,{tableStore:C,groupFormat:t,store:o,format:r,schema:i,query:n,collectionContextStore:s,showHoverActionsStore:l,isFullScreen:a,isInPeekRenderer:c,disabled:u,blockPropertyValueOverlayStore:p,minWidth:h,paddingBottom:m,paddingLeft:S}):null}function jc(e){let{groupBy:t,collectionContextStore:o,store:r,format:n,schema:s,disabled:l,isFullScreen:c,paddingLeft:p,isRootChild:h,isInPeekRenderer:m,query:S,showHoverActionsStore:g,blockPropertyValueOverlayStore:C,minWidth:f,paddingBottom:y,tableStore:v}=e;const x=(0,u.Fg)(),w=(0,a.O7)(),k=(0,i.useCallback)(((e,t,r)=>Rc(e,0,r,w,o)),[w,o]);return(0,d.VK)((()=>(0,we.hJ)()),[])?(0,b.jsx)(Xn,{reducerId:"table_groups",store:r,collectionContextStore:o,disabled:l,isFullScreen:c,isRootChild:h,paddingLeft:p,stickyLeft:!0,renderGroup:e=>(0,b.jsx)(Mc,{store:r,format:n,schema:s,query:S,collectionContextStore:o,showHoverActionsStore:g,isFullScreen:c,isInPeekRenderer:m,disabled:l,blockPropertyValueOverlayStore:C,minWidth:f,paddingBottom:y,paddingLeft:p,tableStore:v,groupFormat:e}),getGroupStyle:e=>Vc(e,o,x),renderHeader:e=>(0,b.jsx)(Pc,{args:e,isInPeekRenderer:m}),onGroupHeaderAddItem:k}):(0,b.jsx)(an,{store:r,id:"table_groups",groupBy:t,groupsFormatKey:re.Uh,groupAggregationKey:re.dQ,format:n,schema:s,collectionContextStore:o,disabled:l,isFullScreen:c,renderGroup:e=>(0,b.jsx)(Mc,{store:r,format:n,schema:s,query:S,collectionContextStore:o,showHoverActionsStore:g,isFullScreen:c,isInPeekRenderer:m,disabled:l,blockPropertyValueOverlayStore:C,minWidth:f,paddingBottom:y,paddingLeft:p,tableStore:v,groupFormat:e}),renderHeader:e=>(0,b.jsx)(Pc,{args:e,isInPeekRenderer:m}),onGroupHeaderAddItem:k,paddingLeft:p,getGroupStyle:e=>Vc(e,o,x),isRootChild:h,isInPeekRenderer:m,stickyLeft:!0})}var Ic=o(15828),Fc=o(96310);function Bc(e){const t=(0,u.yK)((()=>({button:{display:"inline",padding:"1px 2px",borderRadius:3,textDecoration:"underline"}})),[]);return(0,b.jsx)(Yt.Z,{style:t.button,onClick:e.onClick,children:e.children})}const Nc=function(e){const{collectionContextStore:t,title:o,description:r,icon:i,style:n}=e,s=(0,d.VK)((()=>t.settingsStore.state.open),[t.settingsStore]),l=(0,u.yK)((e=>({wrapper:{paddingTop:8,minHeight:250,display:"flex",alignItems:"center",justifyContent:"center",...n},innerWrapper:{paddingLeft:16,paddingRight:s?Os.nJ+16:16},title:{fontSize:17,fontWeight:D.Z.fontWeight.medium,color:e.lightTextColor,textAlign:"center",marginBottom:-2},description:{margin:"0 auto",fontSize:14,color:e.lightTextColor},button:{display:"inline",padding:"1px 2px",borderRadius:3,textDecoration:"underline"}})),[s,n]);return(0,b.jsx)("div",{style:l.wrapper,children:(0,b.jsxs)("div",{style:l.innerWrapper,children:[i,(0,b.jsx)("div",{style:l.title,children:o}),r?(0,b.jsx)("div",{style:l.description,children:r}):void 0]})})};var Dc=o(64815),Lc=o(15723),Ec=o(29657),Ac=o(35431),Hc=o(92595),Zc=o(33147);class zc extends Ac.Z{constructor(){super(...arguments),this.eventEmitter=new Zc.Z}findCollectionTimelineViewItems(e){return this.getMembersByDOMOrder({filter:t=>e.uiContains(t.props.store)})}register(e){const t=super.register(e);return this.eventEmitter.emit(),t}unregister(e){super.unregister(e),this.eventEmitter.emit()}addListener(e){this.eventEmitter.addListener(e)}removeListener(e){this.eventEmitter.removeListener(e)}}const Gc=new zc;(0,Hc.exposeDebugValue)("GlobalCollectionTimelineViewItemRegistry",Gc);var Kc=o(20294),Uc=o(53465),Wc=o(43350);const $c=15,qc=33,Qc=12,Yc={position:"absolute",left:0,top:0,zIndex:F.Gt,width:"100%",height:"100%",pointerEvents:"none"};function Xc(e){const{startItemPosition:t,value:o}=e;return t&&o?(o&&t&&o.left<=t.left&&(o.right<t.left?o.left=o.right:(o.left=t.left+Qc,o.top=o.top-$c)),o):o}function Jc(e){const{startItem:t,endItem:o,endRelationPointer:r,timelineState:n,disabled:s,isFullScreen:c,isRootChild:p,relationType:h,isUserDrawnTemp:m,isNewSubitemPlaceholder:S,renderEmitter:g}=e,C=(0,tn.Y$)(),f=(0,a.O7)(),y=(0,Kc.k)(),[v,x]=(0,i.useState)(!1),w=(0,u.Fg)(),[k,_]=(0,i.useState)(null),[T,O]=(0,i.useState)(null),V=(0,i.useCallback)((e=>{_(e.state)}),[]),P=(0,i.useCallback)((e=>{O(e.state)}),[]),R=(0,i.useCallback)((()=>{l.default.afterNextFlush((()=>{y()}))}),[y]);(0,i.useEffect)((()=>(_(t.stores.nodeStore.state),O(o?o.stores.nodeStore.state:null),t.stores.nodeStore.addListener(V),null==o||o.stores.nodeStore.addListener(P),null==g||g.addListener(R),C.filtersBarOpenStore.addListener(R),()=>{t.stores.nodeStore.removeListener(V),null==o||o.stores.nodeStore.removeListener(P),null==g||g.removeListener(R),C.filtersBarOpenStore.removeListener(R)})),[t,o,g,V,P,R,C.filtersBarOpenStore]);const M=(0,d.VK)((()=>Qr.ZP.state.isDragging&&Qr.ZP.state.draggedStores.includes(t.props.store)),[t]),j=(0,d.VK)((()=>o&&Qr.ZP.state.isDragging&&Qr.ZP.state.draggedStores.includes(o.props.store)),[o]),I=(0,d.VK)((()=>{const e=Qr.ZP.state;return e.isDragging?e.currentY-e.startY:0}),[]),B=k&&k.getBoundingClientRect().y+(M?I:0),N=(0,d.VK)((()=>{const e=t.itemPositionStore.state;return B&&e?{left:e.left,right:"subitem"===h?e.left+Qc:e.right,top:"subitem"===h?B+$c:B}:void 0}),[h,t.itemPositionStore,B]),D=T&&T.getBoundingClientRect().y+(j?I:0),L=(0,d.VK)((()=>{const e=D&&null!=o&&o.itemPositionStore.state?{...o.itemPositionStore.state,top:D}:void 0;return"subitem"===h?Xc({startItemPosition:t.itemPositionStore.state,value:e}):e}),[o,D,h,t.itemPositionStore]),E=(0,d.VK)((()=>t.dateValueStore.state),[t]),A=(0,d.VK)((()=>null==o?void 0:o.dateValueStore.state),[o]),H=(0,d.VK)((()=>void 0!==n.dragState.state),[n]),Z=(0,d.VK)((()=>void 0!==n.drawState.state),[n]),z=(0,d.VK)((()=>n.hoveredItem.state),[n.hoveredItem]),G=v&&!H&&!Z,K=(0,i.useCallback)((()=>{r&&!s&&Ec.IL({dependency:{store:t.props.store,relationPointer:r},collectionContextStore:C,environment:f,timelineState:n,isFullScreen:c,isRootChild:p})}),[t,s,r,C,f,n,c,p]),U=(0,i.useCallback)((()=>{x(!0)}),[x]),W=(0,i.useCallback)((()=>{x(!1)}),[x]),$=(0,i.useCallback)((e=>{if(L)return(0,b.jsx)(ed,{topOffset:e,endPosition:L,handleCloseButtonClick:K})}),[L,K]),q=z===t.props.store,Q=o&&z===o.props.store,Y=q||Q||G||"subitem"===h?1:.7;let X,J=!0;"subitem"===h?(X=w.collectionUnsetDependencyArrow,J=!1):E&&A&&(X=E<=A?w.collectionValidDependencyArrow:w.collectionInvalidDependencyArrow);const ee=(0,u.yK)((()=>({svgStyle:{zIndex:"dependency"===h&&(G||Q)?F.Gt:F.wx}})),[h,G,Q]);return N?m?(0,b.jsx)(td,{startPosition:N,timelineState:n}):S?(0,b.jsx)(od,{startPosition:N,timelineState:n}):t!==o&&L?(0,b.jsx)(rd,{startPosition:N,endPosition:L,strokeOpacity:Y,strokeColorOverride:X,svgStyle:ee.svgStyle,cornerRadiusOverride:"subitem"===h?8:void 0,relationType:h,handleMouseMove:U,handleMouseLeave:W,renderChildren:J&&G?$:void 0}):null:null}function ed(e){const{topOffset:t,endPosition:o,handleCloseButtonClick:r}=e,i=(0,u.yK)((e=>({icon:{background:e.white,borderRadius:5,fill:e.accentColors.red[500],height:14,width:14}})),[]);return(0,b.jsx)(b.Fragment,{children:(0,b.jsx)("foreignObject",{width:16,height:16,x:o.left-16,y:o.top-t+8,style:{cursor:"pointer",pointerEvents:"all"},onClick:r,children:(0,Uc.X)(i.icon)})})}function td(e){const{startPosition:t,timelineState:o}=e,r=(0,d.VK)((()=>{const e=o.drawState.state;if(!e||void 0===e.xOffsetPx||void 0===e.yOffsetPx)return;return{left:t.right+e.xOffsetPx+18,top:t.top+e.yOffsetPx}}),[t,o.drawState]);return r?(0,b.jsx)(rd,{startPosition:t,endPosition:r,strokeOpacity:1,relationType:"dependency"}):null}function od(e){var t;const{startPosition:o,timelineState:r}=e,i=(0,u.Fg)(),n=(0,d.VK)((()=>r.dateRangePlaceholder.state),[r.dateRangePlaceholder]),s=(0,d.VK)((()=>null!=n&&n.active?n.date:void 0),[n]),l=null!=n&&n.active?null===(t=n.newTimelineItemProps)||void 0===t?void 0:t.subitemPath:void 0,a=l?l[l.length-1].children.length:0,c=o.top+a*qc+$c+5,p=(0,d.VK)((()=>{const e=(0,Gn.HZ)({timelineState:r,dateValue:s,placeholderDate:s,subitemPlaceholderDate:void 0}),t=c&&e?{...e,top:c}:void 0;return Xc({startItemPosition:o,value:t})}),[s,c,o,r]);return p?(0,b.jsx)(rd,{startPosition:o,endPosition:p,strokeOpacity:1,strokeColorOverride:i.collectionUnsetDependencyArrow,relationType:"subitem"}):null}function rd(e){const{startPosition:t,endPosition:o,strokeColorOverride:r,cornerRadiusOverride:n,strokeOpacity:s,relationType:l,svgStyle:a,handleMouseMove:c,handleMouseLeave:p}=e,h=(0,tn.Y$)(),m=(0,u.Fg)(),[S,g]=(0,i.useState)(0),C=t.right,f=t.top+$c-S,y=o.left-3,v=o.top+$c-S,x=(0,d.VK)((()=>{if(r)return r;return(0,Gn.H5)(h)&&t.right&&o.left?t.right<o.left?m.collectionValidDependencyArrow:m.collectionInvalidDependencyArrow:m.collectionUnsetDependencyArrow}),[h,o.left,t.right,r,m]);return(0,b.jsx)("svg",{style:{...Yc,...a},ref:e=>{e&&g(e.getBoundingClientRect().top)},children:(0,b.jsx)(Wc.Z,{startPoint:{x:C,y:f},endPoint:{x:y,y:v},style:{stroke:x,strokeWidth:Gn.lf,strokeOpacity:s},useRightAngles:"subitem"===l,showArrowHead:"dependency"===l&&!e.renderChildren,cornerRadiusOverride:n,handleMouseMove:c,handleMouseLeave:p,children:e.renderChildren&&e.renderChildren(S)})})}function id(e){const{timelineState:t,disabled:o,isReady:r,isFullScreen:n,isRootChild:s,renderEmitter:l}=e,a=(0,tn.Y$)(),c=(0,i.useCallback)((()=>{t.drawState.setState(void 0)}),[t.drawState]),u=(0,d.VK)((()=>a.collectionViewBlockStore()),[a]),p=(0,d.VK)((()=>a.settingsStore.state.open),[a]);if((0,i.useEffect)((()=>{var e;!p&&null!==(e=t.drawState.state)&&void 0!==e&&e.tryToCompleteDrawnArrow&&c()}),[p,t.drawState,c]),!r||!u)return null;const h=Gc.findCollectionTimelineViewItems(u);return(0,b.jsx)(b.Fragment,{children:h.map((e=>{const{store:r,groupFormat:a}=e.props,c=null==a?void 0:a.value,d=c?(0,re.Hd)(c):"noGroup";return(0,b.jsxs)(i.Fragment,{children:[(0,b.jsx)(nd,{startItem:e,timelineState:t,disabled:o,isFullScreen:n,isRootChild:s,renderEmitter:l,relationType:"dependency"},`${r.id}-${d}-${r.key}-dependency`),(0,b.jsx)(nd,{startItem:e,timelineState:t,disabled:o,isFullScreen:n,isRootChild:s,renderEmitter:l,relationType:"subitem"},`${r.id}-${d}-${r.key}-subitem`)]},`${r.id}-${d}-${r.key}`)}))})}function nd(e){const{startItem:t,timelineState:o,disabled:r,isFullScreen:n,isRootChild:s,relationType:l,renderEmitter:a}=e,{store:c,schema:u}=t.props,p=(0,tn.Y$)(),h=(0,d.VK)((()=>"dependency"===l?o.drawState.state:void 0),[o.drawState,l]),m=(0,d.VK)((()=>(null==h?void 0:h.startStore)===c),[c,h]),S=(0,d.VK)((()=>m&&!(null!=h&&h.tryToCompleteDrawnArrow)),[h,m]),g=(0,d.VK)((()=>"dependency"===l?m&&h?h.temporaryDependencyRelationPointers:(0,Gn.YE)(p,c,u):"subitem"===l?(0,Gn.ph)(p,c,u):[]),[l,m,h,p,c,u]),C=(0,d.VK)((()=>p.collectionViewBlockStore()),[p]),f=(0,d.VK)((()=>{var e;const r=o.dateRangePlaceholder.state;if("subitem"!==l||null==r||!r.active||!r.newTimelineItemProps)return;const i=r.newTimelineItemProps.subitemPath;return(i?null===(e=i[i.length-1])||void 0===e?void 0:e.value.store:void 0)===t.props.store?r:void 0}),[l,t.props.store,o.dateRangePlaceholder]);function y(e){let{collectionViewBlockStore:t}=e;return t?Gc.findCollectionTimelineViewItems(t):[]}const[v,x]=(0,i.useState)(y({collectionViewBlockStore:C}));return(0,i.useEffect)((()=>{const e=()=>{const e=y({collectionViewBlockStore:C});N.Xy(v,e)||x(e)};return Gc.addListener(e),()=>Gc.removeListener(e)}),[C,v]),C?(0,b.jsxs)(b.Fragment,{children:[g.map((e=>{if(c.id===e.id)return null;const d=v.filter((t=>t.props.store.id===e.id));return(0,b.jsx)(i.Fragment,{children:d.map((i=>{const c=i.props.store,d=i.props.groupFormat;return(0,b.jsx)(Jc,{startItem:t,endItem:i,endRelationPointer:e,timelineState:o,disabled:r,isFullScreen:n,isRootChild:s,renderEmitter:a,relationType:l},`${c.id}-${null==d?void 0:d.value.value}-${c.key}`)}))},e.id)})),"dependency"===l&&S&&(0,b.jsx)(Jc,{isUserDrawnTemp:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:n,isRootChild:s,relationType:"dependency"}),"subitem"===l&&f&&(0,b.jsx)(Jc,{isNewSubitemPlaceholder:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:n,isRootChild:s,relationType:"subitem"})]}):null}var sd=o(2585),ld=o(5257),ad=o(7525),cd=o(12457),dd=o(71574),ud=o(86615),pd=o(28451),hd=o(63296),md=o(30874),Sd=o(92083),gd=o(84437),Cd=o(35599);const fd=(0,B.defineMessages)({defaultTitle:{id:"openInNotionCalendarOnboardingTooltip.header",defaultMessage:"Get Notion Calendar"},defaultContent:{id:"openInNotionCalendarOnboardingTooltip.content",defaultMessage:"View any Notion database with calendar and timeline views with your Google Calendar events"},connectCalendarTitle:{id:"openInNotionCalendarOnboardingTooltip.connectCalendarTitle",defaultMessage:"Connect Calendar"},successTitle:{id:"openInNotionCalendarOnboardingTooltip.success.header",defaultMessage:"Successfully connected"},successContent:{id:"openInNotionCalendarOnboardingTooltip.success.content",defaultMessage:"You can now view any database with calendar and timeline views in Notion Calendar"}});function yd(e){let{variant:t,origin:o,onCloseClick:r,onConnectCalendarClick:i}=e;const n=(0,u.yK)((e=>({tooltip:{width:233},content:{opacity:1},contentInner:{display:"flex",flexDirection:"column",gap:14},contentMessage:{opacity:.8,color:e.regularInvertedTextColor},footer:{display:"flex",alignItems:"center",gap:12},primaryButton:{display:"flex",alignItems:"center",height:24,padding:"0 12px",marginLeft:"auto",borderRadius:4,background:"#FFF",color:"#1D1B16",fontSize:12,fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},primaryButtonHover:{background:"rgba(255,255,255,0.9)"},primaryButtonPressed:{background:"rgba(255,255,255,0.8)"}})),[]);return(0,b.jsx)(ll.U,{origin:o,placementToOrigin:"bottom",header:(0,b.jsx)(B.FormattedMessage,{..."success"===t?fd.successTitle:fd.defaultTitle}),content:(0,b.jsxs)("div",{style:n.contentInner,children:[(0,b.jsx)("div",{style:n.contentMessage,children:(0,b.jsx)(B.FormattedMessage,{..."success"===t?fd.successContent:fd.defaultContent})}),"default"===t&&(0,b.jsx)("div",{style:n.footer,children:(0,b.jsx)(Yt.Z,{style:n.primaryButton,hoveredStyle:n.primaryButtonHover,pressedStyle:n.primaryButtonPressed,onClick:i,children:(0,b.jsx)(B.FormattedMessage,{...fd.connectCalendarTitle})})})]}),contentStyle:n.content,onCloseClick:r,shouldDismissUponOutsideClick:!0,pointerPosition:"33%",style:{...n.tooltip}})}function vd(e){let{collectionContextStore:t}=e;const o=(0,i.useRef)(null),[r,n]=(0,i.useState)(!1),[s,l]=(0,i.useState)(!1),c=(0,a.O7)(),p=(0,d.VK)((()=>$o.default.state.currentSpaceStore),[]),h=(0,d.VK)((()=>$o.default.state.currentUserSettingsStore),[]),m=(0,d.VK)((()=>(0,dd.tE)()),[]),S=(0,d.VK)((()=>t.isFullScreen.state),[t]),g=(0,d.VK)((()=>{var e,t;if(!S)return!1;if(!co.default.checkGate("notion_calendar"))return!1;if(null!==(e=$o.default.state.currentSpaceStore)&&void 0!==e&&e.isNotionCalendarDisabledOnSpace())return!1;if(!h)return!1;if(!md.Z.state.loaded)return!1;return!Sd.Z.state.open&&(!!$o.default.state.inAppCalloutStore.canShow("open_in_calendar_tooltip")&&(!Xo.default.state.open&&(!s&&(!(null!==(t=h.getSettings())&&void 0!==t&&t.seen_open_in_calendar_tooltip)||r))))}),[S,h,r,s]),C=(0,i.useCallback)((()=>{const e=t.collectionViewStore(),o=t.collectionStore(),r=null==o?void 0:o.getParentBlockStore();e&&o&&r&&p&&(ud.QK(c,{is_calendar_connected:m,collection_id:o.id,collection_view_id:e.id,collection_view_block_id:r.id}),gd.sh({environment:c,collectionViewStore:e,spaceStore:p,from:"openInCalendarButton"}))}),[c,t,p,m]),f=(0,i.useCallback)((()=>{r?l(!0):h&&gd.Bm({environment:c,userSettingsStore:h,transactionUserAction:"OpenInCalendarTooltip.dismiss"})}),[c,r,h]),y=(0,i.useCallback)((()=>{n(!0),h&&gd.Bm({environment:c,userSettingsStore:h,transactionUserAction:"OpenInCalendarTooltip.connectCalendar"}),C(),requestAnimationFrame((()=>{l(!1)}))}),[c,h,C]),v=(0,u.yK)((e=>({button:{marginRight:8,paddingRight:12,fontSize:14,fontWeight:500,height:26},calendarIcon:{marginLeft:4},calendarIconSvg:{fill:e.timelineRed}})),[]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(hd.Z,{ref:o,style:v.button,iconStyle:v.calendarIconSvg,icon:e=>(0,b.jsx)(Cd.Z,{style:{...e,...v.calendarIcon}}),onClick:C,children:(0,b.jsx)(B.FormattedMessage,{id:"openInNotionCalendarButton.label",defaultMessage:"Open in Calendar"})}),g&&(0,b.jsx)(pd.P,{calloutId:"open_in_calendar_tooltip",children:(0,b.jsx)(yd,{variant:r||m?"success":"default",origin:o,onCloseClick:f,onConnectCalendarClick:y})})]})}function xd(e){const t=(0,a.O7)();return(0,d.VK)((()=>(0,dd.ZH)({environment:t,collectionContextType:e.collectionContextStore.contextType})),[t,e.collectionContextStore])?(0,b.jsx)(vd,{...e}):null}var bd=o(36488);const wd=function(e){let{zoomLevel:t,onChange:o}=e;const r=(0,u.Fg)(),i=(0,a.O7)(),{device:n}=i;return(0,b.jsx)(qe.ZP,{popupType:n.isMobile?Ye.kQ.SlideUp:Ye.kQ.Popup,renderOrigin:e=>(0,b.jsxs)(Qe.Z,{isSmall:!0,isGray:!0,...e,children:[(0,b.jsx)(kd,{zoomLevel:t}),(0,Gi.i)({width:10,marginLeft:4,fill:r.mediumIconColor})]}),originGap:8,render:e=>(0,b.jsx)(_d,{parent:e,zoomLevel:t,onChange:o})})};function kd(e){let{zoomLevel:t}=e;return"hours"===t?(0,b.jsx)(B.FormattedMessage,{id:"database.timelineView.zoomLevel.hours",defaultMessage:"Hours"}):"day"===t?(0,b.jsx)(B.FormattedMessage,{id:"database.timelineView.zoomLevel.day",defaultMessage:"Day"}):"week"===t?(0,b.jsx)(B.FormattedMessage,{id:"database.timelineView.zoomLevel.week",defaultMessage:"Week"}):"bi_week"===t?(0,b.jsx)(B.FormattedMessage,{id:"database.timelineView.zoomLevel.biWeek",defaultMessage:"Bi-week"}):"month"===t?(0,b.jsx)(B.FormattedMessage,{id:"database.timelineView.zoomLevel.month",defaultMessage:"Month"}):"quarter"===t?(0,b.jsx)(B.FormattedMessage,{id:"database.timelineView.zoomLevel.quarter",defaultMessage:"Quarter"}):"year"===t?(0,b.jsx)(B.FormattedMessage,{id:"database.timelineView.zoomLevel.year",defaultMessage:"Year"}):void(0,ut.t1)(t)}function _d(e){let{parent:t,zoomLevel:o,onChange:r}=e;const i=(0,a.O7)(),{device:n}=i,s=[{key:"calendar by section",render:e=>(0,b.jsx)(Pe.Z,{...e}),items:Xt.H.map((e=>({key:e,render:t=>(0,b.jsx)($e.Z,{...t,title:(0,b.jsx)(kd,{zoomLevel:e})}),action:()=>{r(e),t.close()}})))}];return(0,b.jsx)(bd.Z,{capture:!0,allowEsc:!0,render:e=>{let r;return r=n.isMobile?{menuType:ke.og.Modal,title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Select a zoom level",id:"database.timelineView.mobileTimelineZoomPicker.title"}),right:(0,b.jsx)(Ve.DoneMenuText,{}),onClickRight:t.close,...e}:{menuType:ke.og.Popup,width:180,...e},(0,b.jsx)(Te.Z,{...r,children:(0,b.jsx)(Oe.Z,{type:Oe.i.Vertical,sections:s,initialFocus:Xt.H.indexOf(o)})})}})}const Td=6;function Od(e){let{timelineState:t,scrollerLeftOffset:o,paddingLeft:i,showTable:n,isFullScreen:s,isRootChild:l,isReady:c,collectionContextStore:p,isInPeekRenderer:h,format:m,paddingRight:S}=e;const g=(0,u.Fg)(),C=(0,a.O7)(),f=(0,d.VK)((()=>{const e=t.zoomLevel.state,{primaryDisplayUnit:l,secondaryDisplayUnit:a}=Gn.BJ[e],c=t.scrollLeft.state,{startTimestamp:d}=t.currentRange.state;if(void 0!==c){const t=d+(0,Gn.x2)(e,c+o+(!n&&s?i:0));return(0,Gn.DS)(r.ou.fromMillis(t),l).startOf(a).valueOf()}}),[t,o,i,n,s]),y=(0,a.Fy)(),v=(0,d.VK)((()=>t.zoomLevel.state),[t]),x=(0,d.VK)((()=>t.outerSizeObserver.rect.state.width),[t]),{secondaryDisplayUnit:w}=Gn.BJ[v],k=(0,d.VK)((()=>(0,Gn.d$)({environment:C,isFullScreen:s,isRootChild:l})),[C,s,l]),_=(0,d.VK)((()=>p.permissionScopes.state),[p]),T=!n&&k&&_.canConfigureBlock,O=(0,d.VK)((()=>{var e;return(null===(e=p.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(h?g.cardContentBackground:g.contentBackground)}),[p,h,g]),V=h?g.cardContentBackgroundTransparent:g.contentBackgroundTransparent,P=(0,u.yK)((()=>({secondaryDisplayUnit:{position:"absolute",top:1,left:0,paddingLeft:s&&!n?o+i:o,display:"flex",alignItems:"center",height:32,paddingTop:Td+(y.isMobile?2:0),background:O,fontSize:14,fontWeight:D.Z.fontWeight.medium},outerContainer:{position:"sticky",left:0,width:x,zIndex:F.Qm,height:0},controlBarRight:{position:"absolute",top:1,right:0,paddingRight:S,display:"flex",alignItems:"center",height:32,paddingTop:Td+1,background:O},hideTableIcon:{paddingLeft:4,paddingRight:4,marginLeft:2,marginRight:4,marginTop:y.isIOS?0:1,height:22,fill:g.lightIconColor}})),[O,y.isIOS,y.isMobile,s,x,i,S,o,n,g.lightIconColor]);return(0,b.jsx)(Mt,{position:mt.Top,children:(0,b.jsxs)("div",{style:P.outerContainer,children:[f&&(0,b.jsxs)("div",{style:P.secondaryDisplayUnit,children:[T&&(0,b.jsx)(Xe.ZP,{render:e=>(0,b.jsx)(Qe.Z,{isSmall:!0,onClick:()=>function(e,t,o,r,i,n){const s=r.collectionViewStore();if(!s)return;ee.createAndCommit({userAction:"CollectionTimelineViewControlBar.handleShowTableClick",environment:e,perform:e=>{const o=(0,Gn.YP)(t,!0);Jt.FH({stores:[s],update:o,transaction:e})}}),L.CB(e,{...(0,Gn.Ii)({environment:e,collectionContextStore:r,timelineState:o,isFullScreen:i,isRootChild:n}),show:!0})}(C,m,t,p,s,l),style:P.hideTableIcon,...e,children:(0,ad.t)({width:14})}),renderTooltip:()=>(0,b.jsx)(B.FormattedMessage,{id:"database.timelineView.controlHeader.showTableButton.title",defaultMessage:"Show table"})}),(0,b.jsx)("span",{style:{paddingLeft:T||y.isPhone?0:s||n?16:2},children:(0,Gn.qG)(f,w)}),!c&&!n&&(0,b.jsx)(Pd,{}),(0,b.jsx)("div",{style:{width:30,marginRight:-30,height:"100%",backgroundImage:`linear-gradient(to right, ${O} 20%, ${V} 100%)`}})]}),(0,b.jsxs)("div",{style:P.controlBarRight,children:[(0,b.jsx)("div",{style:{width:30,marginLeft:-30,height:"100%",backgroundImage:`linear-gradient(to left, ${O} 20%, ${V} 100%)`}}),(0,b.jsx)(xd,{collectionContextStore:p}),(0,b.jsx)(wd,{zoomLevel:v,onChange:e=>function(e,t,o,r,i,n){Ec.Nf({timelineState:o,environment:t,zoomLevel:e,centerTimestamp:(0,Gn.al)(o)}),L.zI(t,(0,Gn.Ii)({environment:t,collectionContextStore:r,timelineState:o,isFullScreen:i,isRootChild:n}))}(e,C,t,p,s,l)}),(0,b.jsx)(Qe.Z,{isSmall:!0,isGray:!0,onClick:()=>function(e,t,o,r,i,n,s){const l=t.zoomLevel.state,a=t.outerSizeObserver.rect.state.width,c=(0,Gn.xI)({environment:e,paddingLeft:o,format:r,isFullScreen:i,isRootChild:n}),d=(a-c)/2,u=(0,Gn.al)(t),p=u-(0,Gn.x2)(l,d);Ec.Nf({timelineState:t,environment:e,zoomLevel:l,centerTimestamp:p}),L.Al(e,{...(0,Gn.Ii)({environment:e,collectionContextStore:s,timelineState:t,isFullScreen:i,isRootChild:n}),type:"left"})}(C,t,i,m,s,l,p),style:{marginLeft:4,paddingLeft:4,paddingRight:4},children:(0,sd.f)({width:12,fill:g.mediumIconColor})}),(0,b.jsx)(Qe.Z,{isSmall:!0,onClick:()=>function(e,t,o,r,i,n,s){const l=t.zoomLevel.state,a=(0,Gn.bK)({timestamp:Date.now(),environment:e,timelineState:t,paddingLeft:o,format:r});Ec.Nf({timelineState:t,environment:e,zoomLevel:l,centerTimestamp:a}),L.H6(e,(0,Gn.Ii)({environment:e,collectionContextStore:i,timelineState:t,isFullScreen:n,isRootChild:s}))}(C,t,i,m,p,s,l),children:(0,b.jsx)(B.FormattedMessage,{id:"database.timelineView.controlHeader.todayButton.title",defaultMessage:"Today"})}),(0,b.jsx)(Qe.Z,{isSmall:!0,isGray:!0,onClick:()=>function(e,t,o,r,i,n,s){const l=t.zoomLevel.state,a=t.outerSizeObserver.rect.state.width,c=(0,Gn.xI)({environment:e,paddingLeft:o,format:r,isFullScreen:i,isRootChild:n}),d=(a-c)/2,u=(0,Gn.al)(t),p=u+(0,Gn.x2)(l,d);Ec.Nf({timelineState:t,environment:e,zoomLevel:l,centerTimestamp:p}),L.Al(e,{...(0,Gn.Ii)({environment:e,collectionContextStore:s,timelineState:t,isFullScreen:i,isRootChild:n}),type:"right"})}(C,t,i,m,s,l,p),style:{paddingLeft:4,paddingRight:4},children:(0,ld.o)({width:12,fill:g.mediumIconColor})})]})]})})}const Vd=i.memo(Od);function Pd(){return(0,b.jsx)(cd.Z,{show:!0,showDelay:400,showHold:0,render:e=>e?(0,b.jsx)(Ge.Z,{style:{marginLeft:8,marginTop:1}}):void 0})}var Rd=o(97439);const Md=function(e){let{isGrouped:t,format:o,collectionContextStore:r,isFullScreen:i,isRootChild:n,timelineState:s}=e;const l=(0,u.Fg)(),c=(0,a.O7)(),{device:d}=c;return(0,b.jsx)(Xe.ZP,{render:e=>(0,b.jsx)(Qe.Z,{isSmall:!0,onClick:()=>function(e,t,o,r,i,n){const s=o.collectionViewStore();if(!s)return;ee.createAndCommit({userAction:"CollectionTimelineViewHideTableButton.handleHideTableClick",environment:e,perform:e=>{const o=(0,Gn.YP)(t,!1);Jt.FH({stores:[s],update:o,transaction:e})}}),L.CB(e,{...(0,Gn.Ii)({environment:e,collectionContextStore:o,timelineState:n,isFullScreen:r,isRootChild:i}),show:!1})}(c,o,r,i,n,s),style:{position:"absolute",top:t?d.isIOS?3:4:d.isIOS?7:8,right:t?6:8,zIndex:F.MC,fill:l.lightIconColor},...e,children:(0,Rd.D)({width:14})}),renderTooltip:()=>(0,b.jsx)(B.FormattedMessage,{id:"database.timelineView.tableGroupResults.hideTableButton.title",defaultMessage:"Hide table"})})};var jd=o(13991),Id=o(7057),Fd=o(24211);function Bd(e){const{shouldShowShimmer:t,children:o}=e,r=(0,Br.Z)(t,0,100)?"notion-shimmer-timeline-transition notion-shimmer-timeline":"notion-shimmer-timeline-transition";return(0,b.jsx)("div",{className:r,style:{height:"100%"},children:o})}const Nd=22,Dd=110,Ld=22,Ed=12,Ad=4,Hd=32;class Zd extends s.Z{constructor(){super(...arguments),this.interval=void 0,this.handleSeconds=()=>{0===(new Date).getSeconds()&&this.enqueueForceUpdate()},this.activeRangeStore=this.createComputedStore((()=>{const{collectionContextStore:e,timelineState:t,query:o,schema:r,intl:i}=this.props,n=e.collectionStore();if(!n)return;const s=t.dragState.state,l=t.zoomLevel.state,a=t.hoveredItem.state,c=t.dateRangePlaceholder.state,{activeRangeType:d}=Gn.BJ[l];if(!d)return;let u;if(s)u=s.temporaryValues.map((e=>(0,Gn.XO)(e,"day")));else if(c.active)u=[(0,Gn.XO)(c.date,"day")];else{const{stores:t}=Jo.default.state,s=t.filter((e=>e.getAssociatedCollectionId()===n.id)),l=N.jj(N.oA([...s,a]));u=N.oA(l.map((t=>{const n=(0,Gn.bk)({store:t,query:o,schema:r,userId:e.getCurrentUserId(),intl:i});if(n)return(0,Gn.XO)(n,"day")})))}const p=N.F(u,(e=>{let{start:t}=e;return t.valueOf()})),h=N.UT(u,(e=>{let{end:t}=e;return t.valueOf()}));return p&&h?{start:p.start.valueOf(),end:h.end.valueOf()}:void 0}),!0)}UNSAFE_willMount(e){super.UNSAFE_willMount(e)}didMount(){super.didMount(),this.interval=setInterval(this.handleSeconds,1e3)}willUnmount(){super.willUnmount(),clearInterval(this.interval)}renderComponent(){const{collectionContextStore:e,timelineState:t}=this.props,o=t.zoomLevel.state,i=Gn.BJ[o],{primaryDisplayUnit:n,activeRangeType:s}=i,l=(0,Gn.ST)(n),a=r.ou.now(),c=l?a.startOf("minute"):a.startOf("day"),d=a.startOf("minute"),{device:u}=this.environment,p=!e.groupsStore.anyGroupHasNonEmptyResults()&&Wt({collectionContextStore:e,groupsPointer:[],hasPartialResults:!1});return(0,b.jsx)(Mt,{position:mt.Top,children:(0,b.jsxs)("div",{style:Ud(this.props.collectionContextStore,this.props.isInPeekRenderer,this.theme),children:[(0,b.jsx)("div",{style:{height:32,position:"relative",overflow:"hidden"},children:!u.isPhone&&(0,b.jsx)(tu,{timelineState:this.props.timelineState})}),(0,b.jsxs)("div",{style:{height:Hd,position:"relative",overflow:"hidden"},children:[(0,b.jsx)(Bd,{shouldShowShimmer:p,children:(0,b.jsx)(eu,{timelineState:this.props.timelineState,nowTimeStartOfPrimaryDisplayUnit:c})}),"highlight_days"===s&&(0,b.jsx)(ru,{timelineState:this.props.timelineState,activeRangeStore:this.activeRangeStore}),(0,b.jsx)(ou,{timelineState:this.props.timelineState,time:c}),"display_range"===s&&(0,b.jsx)(ru,{timelineState:this.props.timelineState,activeRangeStore:this.activeRangeStore})]}),(0,b.jsx)(Qd,{timelineState:this.props.timelineState,time:d})]})})}}Zd.displayName="CollectionTimelineViewTimeBar";const zd=(0,B.injectIntl)(Zd);function Gd(e,t,o){const r=o.zoomLevel.state,{startTimestamp:i}=o.currentRange.state,{primaryDisplayUnit:n,primaryDisplayUnitAlignment:s}=Gn.BJ[r],l=(0,Gn.DS)(e,n),a=(0,Gn.Ip)(e,n),c=(0,Gn.e$)(r,l.valueOf()-i),d=(0,Gn.e$)(r,e.valueOf()-i),u=(0,Gn.e$)(r,a.valueOf()-i)-c,p=t?Ad:0;return{left:("range_start"===s?d-u/2:d)-p,width:u+2*p}}function Kd(e,t,o,r,i){const n=e.setLocale(jd.SP),s=(0,Gn.xJ)(),l=r?i.regularTextColor:i.lightTextColor,a=r?i.regularTextColor:i.mediumTextColor,c=r?i.mediumTextColor:i.lightTextColor,d=n.toFormat("t").startsWith(n.toFormat("a"));if("fifteen_minutes"===o){if(s)return(0,b.jsx)("span",{style:{color:l},children:n.toFormat("H:mm")});{const e=(0,b.jsx)("span",{style:{color:a,paddingRight:d?void 0:3},children:n.toFormat("h:mm")}),t=(0,b.jsx)("span",{style:{color:c,paddingRight:d?3:void 0},children:n.toFormat("a")});return d?(0,b.jsxs)(b.Fragment,{children:[t,e]}):(0,b.jsxs)(b.Fragment,{children:[e,t]})}}if("hour"===o){if(s)return(0,b.jsx)("span",{style:{color:l},children:n.toFormat("H:mm")});{const e=(0,b.jsx)("span",{style:{color:a,paddingRight:d?void 0:3},children:n.toFormat("h")}),t=(0,b.jsx)("span",{style:{color:c,paddingRight:d?3:void 0},children:n.toFormat("a")});return d?(0,b.jsxs)(b.Fragment,{children:[t,e]}):(0,b.jsxs)(b.Fragment,{children:[e,t]})}}if("day"===o||"week"===o)return"week"===t||"bi_week"===t?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{style:{color:c,paddingRight:3},children:n.toFormat("ccccc")}),(0,b.jsx)("span",{style:{color:a,padding:"2px 7px"},children:n.toFormat("d")})]}):(0,b.jsx)("span",{style:{color:l},children:n.toFormat("d")});(0,ut.t1)(o)}function Ud(e,t,o){var r;return{position:"absolute",left:0,top:0,width:"100%",background:(null===(r=e.inheritedBlockColorStore.state)||void 0===r?void 0:r.background)||(t?o.cardContentBackground:o.contentBackground),borderTop:e.viewIsFlushToTopbar()?`1px solid ${o.tableDividerColor}`:"1px solid transparent",borderBottom:`1px solid ${o.tableDividerColor}`}}function Wd(e){return{color:e.regularTextColor,fontSize:Ed}}function $d(e){return{background:e.timelineRed,width:Ld,height:Ld,borderRadius:Ld/2,position:"absolute",left:`calc(50% - ${Ld/2}px)`,top:`calc(50% - ${Ld/2}px)`}}function qd(e){let{time:t,accent:o,timelineState:r}=e;const i=(0,u.Fg)(),n=(0,d.VK)((()=>r.zoomLevel.state),[r]),{primaryDisplayUnit:s}=Gn.BJ[n],{left:l,width:a}=(0,d.VK)((()=>Gd(t,!1,r)),[t,r]);return(0,b.jsx)("div",{style:{position:"absolute",top:0,left:l,width:a,height:Hd-4,display:"flex",alignItems:"start",lineHeight:Hd-4+"px"},children:(0,b.jsx)("div",{style:{fontSize:Ed,margin:"0 auto"},children:Kd(t,n,s,o,i)})})}function Qd(e){let{time:t,timelineState:o}=e;const r=(0,u.Fg)(),i=(0,d.VK)((()=>o.zoomLevel.state),[o]),{startTimestamp:n}=(0,d.VK)((()=>o.currentRange.state),[o]),s=Math.floor((0,Gn.e$)(i,t.valueOf()-n));return(0,b.jsx)("div",{style:{position:"absolute",left:s-3.5+.5,top:Math.floor(Hd+32-3.5+.5),width:7,height:7,background:r.timelineRed,borderRadius:"100%"}})}function Yd(e){let{time:t,timelineState:o,intl:r}=e;const i=(0,u.Fg)(),n=(0,a.O7)(),s=(0,d.VK)((()=>o.zoomLevel.state),[o]),{startTimestamp:l}=(0,d.VK)((()=>o.currentRange.state),[o]),{secondaryDisplayUnit:c}=Gn.BJ[s],p=(0,Gn.e$)(s,t.valueOf()-l);return(0,b.jsx)("div",{style:{position:"absolute",top:0,left:p,height:Hd,color:i.regularTextColor,fontSize:14,fontWeight:D.Z.fontWeight.medium,verticalAlign:"middle",paddingTop:Td+(n.device.isMobile?2:0),display:"flex",alignItems:"center"},children:(0,Gn.EW)((0,Fd.E2)(r),t.valueOf(),c)},p)}function Xd(e){let{start:t,end:o,rangeWidth:r}=e;const i=(0,u.Fg)();return t&&o?r>=Dd?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{style:Wd(i),children:(0,Id.Yx)(t.valueOf(),"month_day",jd.SP)}),(0,b.jsx)("div",{style:{flexGrow:1}}),(0,b.jsx)("div",{style:Wd(i),children:(0,Id.Yx)(o.valueOf(),"month_day",jd.SP)})]}):(0,b.jsxs)("div",{style:Wd(i),children:[(0,Id.Yx)(t.valueOf(),"month_day",jd.SP)," – ",t.month===o.month?(0,Id.Yx)(o.valueOf(),"day",jd.SP):(0,Id.Yx)(o.valueOf(),"month_day",jd.SP)]}):(0,b.jsx)("div",{style:Wd(i),children:(0,Id.Yx)(t.valueOf(),"month_day",jd.SP)})}function Jd(e,t,o,r){const i=e.setLocale(jd.SP),n=(0,Gn.ST)(o),s=(0,Gn.xJ)();return n?s?(0,b.jsx)("span",{style:{color:r.timelineRed},children:i.toFormat("H:mm")}):(0,b.jsx)("span",{style:{color:r.timelineRed,paddingRight:3},children:i.toFormat("t")}):"week"===t||"bi_week"===t?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{style:{color:r.lightTextColor,paddingRight:3},children:i.toFormat("ccccc")}),(0,b.jsxs)("div",{style:{position:"relative"},children:[(0,b.jsx)("div",{style:$d(r)}),(0,b.jsx)("span",{style:{position:"relative",color:"white",padding:"2px 7px"},children:i.toFormat("d")})]})]}):(0,b.jsxs)("div",{style:{position:"relative"},children:[(0,b.jsx)("div",{style:$d(r)}),(0,b.jsx)("span",{style:{position:"relative",color:"white",padding:"2px 7px"},children:i.toFormat("d")})]})}function eu(e){let{nowTimeStartOfPrimaryDisplayUnit:t,timelineState:o}=e;const i=(0,d.VK)((()=>o.zoomLevel.state),[o]),{startTimestamp:n,endTimestamp:s}=(0,d.VK)((()=>o.currentRange.state),[o]),l=Gn.BJ[i],{primaryDisplayUnit:a,hidePrimaryIndicatorIntersectionOffset:c}=l,u=c||0,p=(0,d.VK)((()=>Gd(t,!1,o)),[t,o]),h=p.left+u,m=p.left+p.width-u,S=[];let g=(0,Gn.DS)(r.ou.fromMillis(n),a);const C=(0,d.VK)((()=>Gd(g,!1,o)),[g,o]);for(;g.valueOf()<s;){const e=C.left+u,t=C.left+C.width-u;void 0!==c&&(h>=e&&h<=t||m>=e&&m<=t)||S.push((0,b.jsx)(qd,{timelineState:o,time:g,accent:!1},g.valueOf()));const r=(0,Gn.Ip)(g,a);g=r}return(0,b.jsx)(b.Fragment,{children:S})}function tu(e){let{timelineState:t}=e;const o=(0,B.useIntl)(),i=(0,d.VK)((()=>t.zoomLevel.state),[t]),{startTimestamp:n,endTimestamp:s}=(0,d.VK)((()=>t.currentRange.state),[t]),l=Gn.BJ[i],{primaryDisplayUnit:a,secondaryDisplayUnit:c}=l,u=[];let p=(0,Gn.DS)(r.ou.fromMillis(n),c);for(;p.valueOf()<s;){u.push((0,b.jsx)(Yd,{timelineState:t,intl:o,time:p},p.valueOf()));const e=(0,Gn.Ip)(p,c);p=(0,Gn.xP)(e,a)}return(0,b.jsx)(b.Fragment,{children:u})}function ou(e){let{time:t,timelineState:o}=e;const r=(0,u.Fg)(),i=(0,d.VK)((()=>o.zoomLevel.state),[o]),{primaryDisplayUnit:n}=Gn.BJ[i],{left:s,width:l}=(0,d.VK)((()=>Gd(t,!0,o)),[t,o]);return(0,b.jsx)("div",{style:{position:"absolute",top:0,left:s,width:l,height:Hd-4,display:"flex",alignItems:"center",fontWeight:500},children:(0,b.jsx)("div",{style:{fontSize:Ed,margin:"0 auto",display:"flex"},children:Jd(t,i,n,r)})},s)}function ru(e){let{timelineState:t,activeRangeStore:o}=e;const i=(0,u.Fg)(),n=(0,d.VK)((()=>t.zoomLevel.state),[t]),{startTimestamp:s,endTimestamp:l}=(0,d.VK)((()=>t.currentRange.state),[t]),a=Gn.BJ[n],{activeRangeType:c}=a,p=(0,d.VK)((()=>o.state),[o]);if(p){const e=(0,Gn.DS)(r.ou.fromMillis(p.start),"day"),o=(0,Gn.e$)(n,e.valueOf()-s);if("highlight_days"===c){const a=[];let c=r.ou.fromMillis(Math.max(e.valueOf(),(0,Gn.DS)(r.ou.fromMillis(s),"day").valueOf()));for(;c.valueOf()<p.end&&c.valueOf()<l;){a.push(c);c=(0,Gn.Ip)(c,"day")}const d=(0,Gn.e$)(n,c.valueOf()-s)-o+8,u=a.map(((e,o)=>(0,b.jsx)(qd,{timelineState:t,time:e,accent:0===o||o===a.length-1},`${e.toString()}-${o}`)));return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{style:{position:"absolute",top:0,left:o-4,width:d,marginTop:(Hd-Nd)/2-2,height:Nd,background:i.timelineDarkerBackground,borderRadius:11}}),u]})}{const t=(0,Gn.DS)(r.ou.fromMillis(p.end),"day"),l=(0,Gn.cK)(r.ou.fromMillis(p.end),"day"),a=(0,Gn.e$)(n,t.valueOf()-s)-o+8;return(0,b.jsx)("div",{style:{display:"flex",alignItems:"center",position:"absolute",top:0,left:o-4,minWidth:a,marginTop:(Hd-Nd)/2-2,height:Nd,background:i.timelineDarkerBackground,borderRadius:11,paddingLeft:6,paddingRight:6},children:(0,b.jsx)(Xd,{start:e,end:e.valueOf()!==l.valueOf()?l:void 0,rangeWidth:a})})}}return null}function iu(e){let{timelineState:t}=e;const o=(0,Kc.k)(),r=(0,i.useCallback)((()=>{0===(new Date).getSeconds()&&o()}),[o]);(0,i.useEffect)((()=>{const e=setInterval(r,1e3);return()=>clearInterval(e)}),[r]);const n=(0,d.VK)((()=>t.zoomLevel.state),[t]),{startTimestamp:s,endTimestamp:l}=(0,d.VK)((()=>t.currentRange.state),[t]);return(0,b.jsxs)("div",{style:{position:"absolute",width:"100%",height:"100%",overflow:"hidden",cursor:"default"},children:[(0,b.jsx)(cu,{zoomLevel:n,startTimestamp:s,endTimestamp:l}),(0,b.jsx)(du,{zoomLevel:n,startTimestamp:s,endTimestamp:l}),(0,b.jsx)(au,{zoomLevel:n,startTimestamp:s})]})}const nu=i.memo(iu,po.Z),su=i.memo((function(e){let{start:t,zoomLevel:o,startTimestamp:r}=e;const i=(0,u.yK)((e=>{const i=t.plus({day:2}).startOf("day"),n=(0,Gn.e$)(o,t.valueOf()-r);return{weekendIndicator:{position:"absolute",left:n,width:(0,Gn.e$)(o,i.valueOf()-r)-n,height:"100%",background:e.timelineDarkerBackground}}}),[t,r,o]);return(0,b.jsx)("div",{style:i.weekendIndicator},t.valueOf())}),po.Z),lu=i.memo((function(e){let{time:t,zoomLevel:o,startTimestamp:r}=e;const i=(0,u.yK)((e=>({verticalDivider:{position:"absolute",left:(0,Gn.e$)(o,t-r),height:"100%",borderRight:`1px solid ${e.regularDividerColor}`}})),[r,t,o]);return(0,b.jsx)("div",{style:i.verticalDivider},t)}),po.Z),au=i.memo((function(e){let{zoomLevel:t,startTimestamp:o}=e;const i=(0,u.yK)((e=>{const i=r.ou.now().startOf("minute");return{nowVerticalDivider:{position:"absolute",left:Math.floor((0,Gn.e$)(t,i.valueOf()-o)),height:"100%",borderRight:`1px solid ${e.timelineRed}`}}}),[o,t]);return(0,b.jsx)("div",{style:i.nowVerticalDivider})}),po.Z),cu=i.memo((function(e){let{zoomLevel:t,startTimestamp:o,endTimestamp:i}=e;const{showWeekendIndicators:n}=Gn.BJ[t];if(!n)return null;let s=(0,Gn.DS)(r.ou.fromMillis(o),"day");const l=[];for(;s.valueOf()<i;)6===s.weekday&&l.push((0,b.jsx)(su,{start:s,zoomLevel:t,startTimestamp:o},s.valueOf())),s=(0,Gn.Ip)(s,"day");return(0,b.jsx)(b.Fragment,{children:l})}),po.Z),du=i.memo((function(e){let{zoomLevel:t,startTimestamp:o,endTimestamp:i}=e;const{verticalDividerUnit:n}=Gn.BJ[t];if(!n)return null;const s=[];let l=(0,Gn.DS)(r.ou.fromMillis(o),n);for(;l.valueOf()<i;)s.push((0,b.jsx)(lu,{time:l.valueOf(),zoomLevel:t,startTimestamp:o},l.valueOf())),l=(0,Gn.Ip)(l,n);return(0,b.jsx)(b.Fragment,{children:s})}),po.Z);const uu=function(e){let{store:t,collectionContextStore:o,groupFormat:r}=e;const i=(0,a.O7)(),n=(0,d.VK)((()=>pu(t)),[t]);return(0,b.jsx)(It.Z,{store:t,style:{width:"100%",height:Fc.Z+1},canDropBelow:!0,canNativeDropBelow:!0,shouldShowDropZone:!0,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,canInsertAbove:!0,canInsertBelow:!0,onInsertBelow:n?hu(n,i,t,o,r):void 0,onInsertAbove:n?mu(n,i,t,o,r):void 0,onSelectableDrop:e=>function(e,t,o,r,i){const{droppedDirection:n,droppedStores:s,duplicate:l}=e,a=pu(o);if(!a)return;const c=r.subitemTreeStore.state,d=(0,Gr.DY)(c.children,(e=>e.value.store===o)),u=Hr.default.mark("collections.drop_item_lag");Hr.default.measureAfterNextFlush(u,{environment:t,getData:()=>he.yr({collectionContextStore:r,is_native_drop:!1,is_empty:!1})});const p="collectionTypedView"===r.contextType;ee.createAndCommit({userAction:"CollectionTimelineViewDroppableRow.handleDrop",environment:t,perform:e=>{Z.by({environment:t,collectionStore:p?void 0:a,targetStore:o,droppedDirection:n,collectionContextStore:r,groupsPointer:i?[i]:[],droppedStores:s,duplicate:l,transaction:e,subitemPath:d})}})}(e,i,t,o,r),onNativeDrop:e=>function(e,t,o,r,i){const{files:n,droppedDirection:s}=e,l=pu(i);if(!l)return;const a=o.collectionViewBlockStore(),c=Hr.default.mark("collections.drop_item_lag");Hr.default.measureAfterNextFlush(c,{environment:t,getData:()=>he.yr({collectionContextStore:o,is_native_drop:!0,is_empty:!1})}),a&&ee.createAndCommit({userAction:"CollectionTimelineViewDroppableRow.handleNativeDrop",environment:t,perform:e=>{Z.tQ({environment:t,collectionStore:l,targetStore:a,droppedDirection:s,collectionContextStore:o,groupsPointer:r?[r]:[],files:n,transaction:e})}})}(e,i,o,r,t),onRemove:e=>function(e,t){const{transaction:o}=e,r=pu(t);if(!r)return;Z.Od({store:t,transaction:o})}(e,t),analyticsName:"timeline"},t.id)};function pu(e){return e.getAssociatedCollectionStore()}function hu(e,t,o,r,i){return n=>{const{insertStores:s,transaction:l}=n,a="collectionTypedView"===r.contextType;return Z.$T({environment:t,collectionStore:a?void 0:e,collectionContextStore:r,groupsPointer:i?[i]:[],insertStores:s,store:o,before:!1,transaction:l})}}function mu(e,t,o,r,i){return n=>{const{insertStores:s,transaction:l}=n,a="collectionTypedView"===r.contextType;return Z.$T({environment:t,collectionStore:a?void 0:e,collectionContextStore:r,groupsPointer:i?[i]:[],insertStores:s,store:o,before:!0,transaction:l})}}function Su(e){let{store:t,groupFormat:o,collectionContextStore:r,canEdit:n,disabled:s,format:l}=e;const c=(0,a.O7)(),[u]=(0,i.useState)((()=>new ge.G(c,t.pointer))),p=(0,d.VK)((()=>r.groupsStore.getGroupState(o)),[r,o]),h=(0,d.VK)((()=>r.permissionScopes.state),[r]),m=(0,d.VK)((()=>r.collectionViewStore()),[r]),S=(0,d.VK)((()=>n&&h.canEditContent&&!h.isSyncedCollection&&c.device.isMobile&&!(null!=m&&m.isSyncedCollection())),[n,m,c,h]),g=(0,i.useMemo)((()=>{if(u)return(0,b.jsx)(It.Z,{store:u,shouldShowDropZone:n,canDropBelow:n,canNativeDropBelow:n,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:e=>function(e,t,o,r){const{droppedDirection:i,droppedStores:n,duplicate:s}=e,l=o.collectionStore();if(!l)return;const a=o.groupsStore.getGroupState(t);if(!a)return;const c=o.collectionViewBlockStore(),d=Hr.default.mark("collections.drop_item_lag");Hr.default.measureAfterNextFlush(d,{environment:r,getData:()=>he.yr({collectionContextStore:o,is_native_drop:!1,is_empty:!0})}),c&&ee.createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableDrop",environment:r,perform:e=>{Z.by({environment:r,collectionStore:l,targetStore:c,droppedDirection:i,collectionContextStore:o,groupsPointer:a.groupsPointer,droppedStores:n,duplicate:s,transaction:e})}})}(e,o,r,c),onNativeDrop:e=>function(e,t,o,r){const{files:i,droppedDirection:n}=e,s=t.collectionStore();if(!s)return;const l=t.collectionViewBlockStore(),a=Hr.default.mark("collections.drop_item_lag");Hr.default.measureAfterNextFlush(a,{environment:r,getData:()=>he.yr({collectionContextStore:t,is_native_drop:!0,is_empty:!0})}),l&&ee.createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableNativeDrop",environment:r,perform:e=>{Z.tQ({environment:r,collectionStore:s,targetStore:l,droppedDirection:n,collectionContextStore:t,groupsPointer:o?[o]:[],files:i,transaction:e})}})}(e,r,o,c),analyticsName:"timeline",style:{width:"100%"}})}),[n,r,c,o,u]);return p?(0,b.jsxs)(b.Fragment,{children:[g,(0,b.jsx)(ii,{collectionContextStore:r,groupsPointer:p.groupsPointer,format:l,canDrag:S,disableRequest:!0,resultProps:{groupFormat:o,collectionContextStore:r,isLast:!1,handleOpenPeekPage:N.ZT},canDrop:!0,resultComponent:uu,disabled:s,direction:oi.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,touchDragOnly:!0,disableSelectable:!0,nestedCreateSubitemButton:Cu})]}):null}const gu=i.memo(Su,po.Z);function Cu(e){return(0,b.jsx)("div",{style:{width:"100%",height:Fc.Z+1}})}var fu=o(62193),yu=o(53877),vu=o(42239),xu=o(76798);function bu(e){const{store:t,schema:o,timelineState:r,dateValueStore:n,collectionContextStore:s,isFullScreen:l,isRootChild:c}=e,p=(0,i.useRef)(null),[h,m]=(0,i.useState)(!1),S=(0,a.O7)(),g=(0,d.VK)((()=>{const e=r.drawState.state;if(e)return e.startStore===t}),[t,r.drawState]),C=(0,d.VK)((()=>!g&&r.hoveredItem.state===t&&!Qo.Z.state),[g,t,r.hoveredItem]),f=(0,d.VK)((()=>(0,Gn.H5)(s)),[s]),y=(0,i.useCallback)((e=>{if(e.preventDefault(),!r.scrollLeft.state||!p.current)return;const i=(0,Se.VW)(p.current);Ec.J4({timelineState:r,store:t,startX:e.startX,startY:e.startY,schema:o,collectionContextStore:s,verticalScroller:i}),m(!1)}),[s,o,t,r]),v=(0,i.useCallback)((e=>{if(!p.current)return;const t=(0,Se.VW)(p.current);Ec.mz({timelineState:r,currentX:e.currentX,currentY:e.currentY,verticalScroller:t})}),[r]),x=(0,i.useCallback)((()=>{ee.createAndCommit({userAction:"TimelineItemDependencyDrawHandle.handleDraggableDragEnd",environment:S,perform:e=>{Ec.$o({timelineState:r,environment:S,transaction:e,collectionContextStore:s,isFullScreen:l,isRootChild:c})}})}),[S,r,s,l,c]),w=(0,i.useCallback)((e=>{Ec.x({timelineState:r,environment:S})}),[S,r]),k=(0,i.useCallback)((()=>{m(!0)}),[m]),_=(0,i.useCallback)((()=>{m(!1)}),[m]),T=(0,u.yK)((e=>({draggableStyle:{position:"absolute",top:0,right:-24,width:24,height:"100%",zIndex:1},draggableSvgStyle:{position:"absolute",left:0,cursor:"pointer"},svgPathStyle:{stroke:f?e.collectionValidDependencyArrow:e.collectionUnsetDependencyArrow,strokeWidth:Gn.lf},svgCircleFill:{color:e.white}})),[f]),O=(0,i.useCallback)((e=>{if(!n.state)return;return(0,b.jsx)("div",{ref:p,style:T.draggableStyle,...e,children:C&&(0,b.jsx)(b.Fragment,{children:(0,b.jsx)("div",{style:T.draggableSvgStyle,children:(0,b.jsxs)("svg",{style:{width:22,height:30},onMouseMove:k,onMouseLeave:_,children:[(0,b.jsx)(Wc.Z,{startPoint:{x:0,y:14},endPoint:{x:10,y:14},style:T.svgPathStyle,showArrowHead:h}),(0,b.jsx)("circle",{cx:h?10+Gn.S7:10,cy:14,r:h?Gn.S7:Gn.Wk,style:T.svgPathStyle,fill:T.svgCircleFill.color})]})})})})}),[n,_,k,C,T.draggableStyle,T.draggableSvgStyle,T.svgCircleFill.color,T.svgPathStyle,h]);return(0,b.jsx)(sa.Z,{render:O,onDraggableDragStart:y,onDraggableDragMove:v,onDraggableDragEnd:x,onDraggableDragCancel:w})}const wu={position:"absolute",top:0,right:-6,width:8,height:"100%",zIndex:1,cursor:"col-resize"},ku={position:"absolute",top:0,left:-6,width:8,height:"100%",zIndex:1,cursor:"col-resize"};function _u(e){let{type:t,store:o,query:r,schema:n,timelineState:s,dateValueStore:l,collectionContextStore:c,isInPeekRenderer:p,isFullScreen:h,isRootChild:m}=e;const S=(0,a.O7)(),g=(0,B.useIntl)(),[C,f]=(0,i.useState)(!1),y=(0,d.VK)((()=>{const e=s.dragState.state;return e?e.stores[0]===o&&("left"===t?e.type===Gn.px.LeftResizer:e.type===Gn.px.RightResizer):C&&!Qo.Z.state}),[C,o,s,t]),v=(0,d.VK)((()=>l.state),[l]),x=(0,d.VK)((()=>s.zoomLevel.state),[s]),w=(0,u.yK)((e=>{const t={position:"absolute",top:6,borderRadius:3,width:3,bottom:6,background:e.regularTextColor},o={fontSize:12,position:"absolute",width:200,lineHeight:`${Fc.Z}px`,pointerEvents:"none"};return{leftDraggableIndicator:{...t,left:Math.ceil(3.5)+1},rightDraggableIndicator:{...t,left:Math.floor(.5)},leftDraggableLabel:{...o,right:12,textAlign:"right"},rightDraggableLabel:{...o,left:12},timelineBackground:{background:p?e.peekTimelineBackground:e.timelineBackground,padding:4,borderRadius:4}}}),[p]),k=(0,i.useCallback)((()=>f(!0)),[]),_=(0,i.useCallback)((()=>f(!1)),[]),T=(0,i.useCallback)((e=>{Ec.td({timelineState:s,currentX:e.currentX})}),[s]),O=(0,i.useCallback)((()=>{ee.createAndCommit({userAction:"TimelineItemResizer.handleDraggableDragEnd",environment:S,perform:e=>{Ec.fX({timelineState:s,collectionContextStore:c,query:r,schema:n,intl:g,environment:S,transaction:e})}}),L.ne(S,{...(0,Gn.Ii)({environment:S,collectionContextStore:c,timelineState:s,isFullScreen:h,isRootChild:m}),type:t})}),[c,S,g,h,m,r,n,s,t]),V=(0,i.useCallback)((e=>{e.preventDefault(),Ec.f$({timelineState:s,store:o,startX:e.startX,type:"left"===t?Gn.px.LeftResizer:Gn.px.RightResizer,query:r,schema:n,intl:g,environment:S})}),[S,g,r,n,o,s,t]),P=(0,i.useCallback)((()=>{Ec.cQ({timelineState:s,environment:S})}),[S,s]),R=(0,i.useCallback)((e=>{const o="left"===t;if(v)return(0,b.jsx)("div",{style:o?ku:wu,onMouseMove:k,onMouseLeave:_,...e,children:y&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{style:o?w.leftDraggableIndicator:w.rightDraggableIndicator}),(0,b.jsx)("span",{style:o?w.leftDraggableLabel:w.rightDraggableLabel,children:(0,b.jsx)("span",{style:w.timelineBackground,children:o?(0,Gn.yk)(v,x):(0,Gn.fc)(v,x)})})]})})}),[v,x,_,k,y,w,t]);return(0,b.jsx)(sa.Z,{render:R,onDraggableDragStart:V,onDraggableDragMove:T,onDraggableDragEnd:O,onDraggableDragCancel:P})}const Tu=i.memo(_u,po.Z),Ou=(0,B.defineMessages)({typeAName:{defaultMessage:"Type a name…",id:"timelineItem.itemName.placeholder"}}),Vu=400;var Pu=function(e){return e[e.Absolute=0]="Absolute",e[e.Sticky=1]="Sticky",e}(Pu||{});class Ru extends s.Z{constructor(){super(...arguments),this.propertiesWrapEl=i.createRef(),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderProperty=(e,t)=>(0,b.jsx)(Au,{showProperties:this.props.showProperties,store:this.props.store,disabled:this.props.disabled,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,clonedStore:this.props.clonedStore,collectionContextStore:this.props.collectionContextStore,parentStore:this.props.parentStore,editingTitleStore:this.editingTitleStore,property:e,index:t}),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDateRangeButtonMouseMove=()=>function(e,t,o,r){const i=o.dragState.state;if((Qo.Z.state||i)&&!r.state||e.device.isPhone)return;o.hoveredItem.setState(t)}(this.environment,this.props.store,this.props.timelineState,this.isDrawingDependencyStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDateRangeButtonMouseLeave=()=>function(e,t){const o=e.dragState.state;if((Qo.Z.state||o)&&!t.state)return;e.hoveredItem.setState(void 0)}(this.props.timelineState,this.isDrawingDependencyStore),this.handleAnimationStateChange=()=>{const{current:e}=this.propertiesWrapEl,t=this.animationStateStore.state;e&&t&&(e.style.position=t.position===Pu.Absolute?"absolute":"sticky",e.style.left=`${t.left}px`)},this.pageURLStore=this.createComputedStore((()=>{const{store:e}=this.props;if(e)return(0,Ko.ZP)({store:e,fullyQualified:!1,pageVisitSource:h.tY.LinkInPage})})),this.peekURLStore=this.createComputedStore((()=>{const{store:e,collectionContextStore:t}=this.props,{mainEditorCurrentBlockStore:o}=$o.default.state;if(e&&o)return ce.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})})),this.isHoveredStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props;return t.hoveredItem.state===e})),this.isDrawingDependencyStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props,o=t.drawState.state;return o&&o.startStore!==e})),this.editingTitleStore=this.createComputedStore((()=>{var e;const{store:t}=this.props,o=er.default.state;if("editing"!==o.mode)return!1;const r=null===(e=(0,Uo.QY)(o.multiSelection))||void 0===e?void 0:e.store;return t&&r&&r===t.getBlockTitleStore()})),this.animationStateStore=this.createComputedStore((()=>{const{timelineState:e,scrollerLeftOffset:t,itemPositionStore:o}=this.props,r=o.state;if(r){const{left:o,right:i}=r,n=i-o;if(!((0,Gn.Tp)(this.environment)&&n>50))return{position:Pu.Absolute,left:o};{const r=e.scrollLeft.state;if(void 0!==r){const e=r+t-o+21;if(e<0)return{position:Pu.Absolute,left:o};if(e>n)return{position:Pu.Absolute,left:i};if(e>0)return{position:Pu.Sticky,left:t+21}}}}})),this.passesFilterStore=this.createComputedStore((()=>{var e,t;const o=this.props.parentStore,r=(0,ao.m1)({collectionContextStore:this.props.collectionContextStore,collectionStore:o,environment:this.environment}),i=null===(e=this.props.store)||void 0===e?void 0:e.getModel(),n=null===(t=this.props.store)||void 0===t?void 0:t.getRecordModel;if(!r||!i||!n)return!0;const s=co.default.getConfigKey("collection_request_settings","clientFormulaTimeoutMs");return(0,Zr.q)(r)({block:i,getRecordModel:n,propertyMapping:null==o?void 0:o.getPropertyMapping(),formulaTimeoutTimestampMs:Date.now()+s,resultCache:new Map})})),this.shouldShowHighlightHalo=this.createComputedStore((()=>!!this.props.store&&ce.Sc(this.props.store))),this.isTypedMSVCollection=this.createComputedStore((()=>"collectionTypedView"===this.props.collectionContextStore.contextType))}didMount(){super.didMount(),this.animationStateStore.addListener(this.handleAnimationStateChange),this.handleAnimationStateChange()}willUnmount(){super.willUnmount(),this.animationStateStore.removeListener(this.handleAnimationStateChange)}UNSAFE_willUpdate(){this.animationStateStore.enqueueRecompute()}renderComponent(){const{itemPositionStore:e,store:t,timelineState:o,query:r,schema:i,dateValueStore:n,disabled:s,isDraggingViaTimelineItemStore:l,collectionContextStore:a,isFullScreen:c,isRootChild:d}=this.props,u=e.state;if(!u)return;const p=(0,Gn.H5)(a),{left:h,right:m,maskPercent:S}=u,g=this.isHoveredStore.state,C=this.pageURLStore.state,f=this.peekURLStore.state,y=!s&&(null==t?void 0:t.canEdit()),v=this.environment.device.isPhone,x=y&&!v&&(p||a.permissionScopes.state.canConfigureBlock)&&!this.isTypedMSVCollection.state,w=a.currentSubitemFormatStoreForUiDisplay.state?42:10,k=Math.max(m-h,w)+1,_=l.state,T=(0,b.jsx)(Iu,{collectionContextStore:this.props.collectionContextStore,toggleButton:this.props.toggleButton,itemPositionStore:this.props.itemPositionStore}),O=this.passesFilterStore.state,V=a.isCompactView.state;return t&&!u.isPlaceholder?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(It.Z,{style:Fu(h,k,_,u,O,this.props.isInPeekRenderer,this.theme),haloStyle:(P=this.theme,R=this.shouldShowHighlightHalo,{borderRadius:4,...ce.pB(R.state,P)}),className:fo.ovr,store:t,canSelect:!0,shouldShowHalo:!V,shouldForceRenderSelectionHalo:this.shouldShowHighlightHalo.state,canDrag:y,analyticsName:"timeline",onDraggableDragStart:Bu,onDraggableDragMove:e=>function(e,t,o,r,i,n,s){if(!t)return;o.dragState.state||Ec.f$({timelineState:o,store:t,startX:e.startX,type:Gn.px.ItemDrag,query:r,schema:i,intl:n,environment:s});Ec.td({timelineState:o,currentX:e.currentX})}(e,this.props.store,this.props.timelineState,this.props.query,this.props.schema,this.props.intl,this.environment),onDraggableDragEnd:()=>function(e,t,o,r,i,n){ee.createAndCommit({userAction:"TimelineItemDateRange.handleSelectableDragEnd",environment:n,perform:s=>{Ec.fX({timelineState:e,collectionContextStore:t,query:o,schema:r,intl:i,environment:n,transaction:s})}})}(this.props.timelineState,this.props.collectionContextStore,this.props.query,this.props.schema,this.props.intl,this.environment),onDraggableDragCancel:()=>function(e,t){Ec.cQ({timelineState:e,environment:t})}(this.props.timelineState,this.environment),canTriggerContextMenu:y,getGhostElement:Nu,disableScrollToReveal:!0,onMouseMove:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDateRangeButtonMouseMove,onMouseLeave:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDateRangeButtonMouseLeave,showBlockMenuInput:!0,children:[T,(0,b.jsx)(No.Z,{style:{width:"100%",height:"100%",borderRadius:4},innerStyle:{width:"100%",height:"100%",display:"flex",paddingLeft:6,paddingRight:6,borderRadius:4},onClick:this.props.handleOpenPeekPage,href:C,metaHref:f,hovered:g,ignoreLocalHoverState:!0}),x&&this.props.store&&(0,b.jsx)(bu,{store:this.props.store,isFullScreen:this.props.isFullScreen,isRootChild:this.props.isRootChild,schema:this.props.schema,timelineState:this.props.timelineState,dateValueStore:this.props.dateValueStore,collectionContextStore:this.props.collectionContextStore}),y&&!v&&(0,b.jsx)(Tu,{type:"left",store:t,query:r,schema:i,timelineState:o,dateValueStore:n,collectionContextStore:a,isFullScreen:c,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:d}),y&&!v&&(0,b.jsx)(Tu,{type:"right",store:t,query:r,schema:i,timelineState:o,dateValueStore:n,collectionContextStore:a,isFullScreen:c,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:d})]}),this.renderProperties(S,_,O)]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{style:Fu(h,k,_,u,O,this.props.isInPeekRenderer,this.theme),className:fo.ovr}),this.renderProperties(S,_,O)]});var P,R}renderProperties(e,t,o){const{showProperties:r}=this.props;return(0,b.jsx)("div",{style:Lu(e,t,o,this.isHoveredStore),children:(0,b.jsx)("div",{style:ju(this.props.collectionContextStore,this.props.toggleButton),ref:this.propertiesWrapEl,className:fo.z_z,children:r.map(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderProperty)})})}}Ru.displayName="TimelineItemDateRange";const Mu=Ru;function ju(e,t){const o=e.currentSubitemFormatStoreForUiDisplay.state;return{display:"flex",height:Fc.Z-2+1,paddingLeft:o&&t?24:6,width:800,overflow:"hidden"}}function Iu(e){let{collectionContextStore:t,toggleButton:o,itemPositionStore:r}=e;const i=(0,d.VK)((()=>t.currentSubitemFormatStoreForUiDisplay.state),[t]),n=(0,d.VK)((()=>r.state),[r]);return!i||!o||null!=n&&n.isExistingSubitemPlaceholder?null:(0,b.jsx)("span",{style:{zIndex:1,paddingTop:3},children:o})}function Fu(e,t,o,r,i,n,s){const l=s.mode;return{position:"absolute",left:e,marginTop:1,marginBottom:1,width:t,height:Fc.Z-2,borderRadius:4,display:"flex",...r.isExistingSubitemPlaceholder?void 0:{..."light"===l?{background:r.isPlaceholder?s.buttonHoveredBackground:s.contentBackground,boxShadow:r.isPlaceholder?void 0:s.buttonBoxShadow}:{background:n?s.calendarItemBackground:s.popoverBackground,boxShadow:r.isPlaceholder?void 0:s.lightBoxShadow}},...r.isPlaceholder&&{cursor:"crosshair"},...o&&{display:"none"},...!i&&{opacity:.5},zIndex:F.ov}}function Bu(e){e.preventDefault()}function Nu(e){const t=Xa.C.findSelectablesFromStore(e),o=N.oA(t.map((e=>e.getNode()))),r=N.oA(o.map((e=>e.closest(`.${fo.o4s}`))))[0];if(r){const e=vu.eN(r),t=e.cloned.querySelector(`.${fo.ovr}`),o=e.cloned.querySelector(`.${fo.z_z}`);return t&&o&&"sticky"===o.style.position&&(o.style.position="absolute",o.style.left=t.style.left),[e]}return o.map(vu.eN)}function Du(e,t){e&&Y.Ys({environment:t,store:e})}function Lu(e,t,o,r){return{width:"100%",WebkitMaskImage:e<1&&r.state?`linear-gradient(90deg, rgba(0,0,0,1) ${100*e}%, rgba(0,0,0,0.4) ${100*e}%)`:void 0,pointerEvents:"none",...t&&{display:"none"},zIndex:F.ov,opacity:o?1:.5}}function Eu(e){let{isLast:t,store:o,collectionContextStore:r,parentStore:i,editingTitleStore:n}=e;const s=(0,u.Fg)(),l=(0,a.O7)(),c=(0,B.useIntl)(),p=(0,d.VK)((()=>null==o?void 0:o.getIcon()),[o]),h=(0,d.VK)((()=>null==r?void 0:r.shouldShowPageIcon()),[r]),m=(0,d.VK)((()=>null==o?void 0:o.hasError()),[o]),S=(0,d.VK)((()=>!o||o.isEmptyPage()),[o]),g=(0,d.VK)((()=>n.state),[n]),C=(0,d.VK)((()=>r.currentSubitemFormatStoreForUiDisplay.state),[r]),f=(0,d.VK)((()=>{var e;return C&&i?null===(e=i.getSchema()[C.property])||void 0===e?void 0:e.name:""}),[i,C]),y=(0,d.VK)((()=>null==o?void 0:o.getBlockTitleStore()),[o]),v=(0,d.VK)((()=>o&&(0,Go.Cr)({collectionContextStore:r,blockId:o.id,blockStore:o})),[r,o]),x=(0,d.VK)((()=>o&&(0,Go.wI)({collectionContextStore:r,blockStore:o})),[r,o]);return(0,b.jsxs)("div",{style:{display:"flex",marginRight:t?0:10,fontSize:14,fontWeight:D.Z.fontWeight.medium,alignItems:"center"},children:[h&&p&&!m&&(0,b.jsx)(Do.Z,{disabled:!0,icon:p,isEmptyPage:S,size:20,style:{marginLeft:2,marginRight:6}}),m&&(0,ko.t)({display:"inline-block",verticalAlign:"text-top",marginLeft:4,marginRight:7,width:16,fill:s.accentColors.orange[500]}),o&&!g&&(0,b.jsx)(xu.Z,{style:{whiteSpace:"nowrap",maxWidth:Vu},store:o}),g&&o&&y&&(0,b.jsx)(Eo.Z,{store:y,style:{whiteSpace:l.device.isFirefox?"pre":"nowrap"},disabled:!1,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableEmbedMenu:!0,onEnter:()=>Du(o,l),onEsc:()=>Du(o,l),onTab:N.yR,placeholder:c.formatMessage(Ou.typeAName),disableSelectAllBlocks:!0,pasteBehavior:"inline",inPageFind:{type:"none"}}),o&&v&&(0,b.jsx)("div",{style:{paddingTop:2,paddingLeft:4},children:(0,b.jsx)(Io.O,{blockStore:o,collectionContextStore:r})}),o&&x&&(0,b.jsx)("div",{style:{paddingTop:2,paddingLeft:8,color:s.lightTextColor},children:(0,b.jsx)(Fo.B,{blockStore:o,collectionContextStore:r})}),!o&&(0,b.jsx)("span",{children:i&&f?(0,b.jsx)(B.FormattedMessage,{defaultMessage:"New page in {propertyName}",id:"timeline.itemPlaceholder.nest.addSubitemWithPropertyName",values:{propertyName:f}}):(0,b.jsx)(B.FormattedMessage,{id:"timeline.itemPlaceholder.newPage",defaultMessage:"New page"})})]},"title")}function Au(e){let{property:t,index:o,showProperties:r,store:i,disabled:n,blockPropertyValueOverlayStore:s,clonedStore:l,collectionContextStore:a,parentStore:c,editingTitleStore:u}=e;const p=o===r.length-1,h=(0,d.VK)((()=>null==i?void 0:i.getAssociatedCollectionStore()),[i]),m=(0,d.VK)((()=>null==i?void 0:i.canEdit()),[i]),S=(0,d.VK)((()=>a.collectionViewStore()),[a]);return h?"title"===t?(0,b.jsx)(Eu,{store:i,collectionContextStore:a,parentStore:c,editingTitleStore:u,isLast:p}):i&&l?(0,b.jsx)(Ro.Z,{store:l,property:t,disabled:n||!m,locked:!1,format:Mo.C.Timeline,tableWrap:!1,isLast:p,blockPropertyValueOverlayStore:s,enablePointerEventsForInteractiveTypes:!0,collectionStore:h,collectionViewStore:S},t):null:null}var Hu=o(31505),Zu=o(39301),zu=function(e){return e[e.Hidden=0]="Hidden",e[e.VisibleInItem=1]="VisibleInItem",e[e.VisibleOutOfItem=2]="VisibleOutOfItem",e[e.NotDefined=3]="NotDefined",e}(zu||{});function Gu(e){let{store:t,type:o,timelineState:r,scrollerLeftOffset:n,paddingLeft:s,format:l,itemPositionStore:c,dateValueStore:p,isDraggingViaTimelineItemStore:h,collectionContextStore:m,isFullScreen:S,isInPeekRenderer:g,isRootChild:C}=e;const f=(0,a.O7)(),y=(0,i.useRef)(zu.NotDefined),v=(0,i.useRef)(null),x=(0,i.useRef)(null),[w,k]=(0,i.useState)(!1),_="left"===o?Hu.Y:Zu.n,T=(0,d.VK)((()=>r.outerSizeObserver.rect.state),[r]),O=(0,d.SI)((()=>{const e=c.state;if(e){const{left:t,right:i}=e;if(h.state)return zu.Hidden;const s=r.scrollLeft.state;if(void 0!==s){if("left"===o){const e=s+n;if(e-i>0)return zu.VisibleOutOfItem;if(e-t>0)return zu.VisibleInItem}else{const e=s+T.width;if(t-e>0)return zu.VisibleOutOfItem;if(i-e>0)return zu.VisibleInItem}return zu.Hidden}}return zu.NotDefined}),[h,c,T,n,r,o]),V=(0,u.yK)((e=>({arrow:{display:"flex",alignItems:"center",width:16,height:16,flexShrink:0,pointerEvents:"auto",background:w?e.regularIconColor:e.mediumIconColor,borderRadius:4,border:`1px solid ${e.contentBackground}`,..."left"===o&&{marginLeft:8,marginRight:4},..."right"===o&&{marginRight:8,marginLeft:4}},icon:{height:6,fill:g?e.cardContentBackground:e.contentBackground},wrap:{position:"sticky",left:"left"===o?n:T.width-220,width:220,height:xc-6,marginTop:2,display:"flex",alignItems:"center",cursor:"pointer",flexDirection:"right"===o?"row-reverse":void 0,whiteSpace:"nowrap",textOverflow:"ellipsis",zIndex:F.fQ}})),[w,g,T,n,o]);(0,i.useLayoutEffect)((()=>{P()}),[]),(0,i.useEffect)((()=>(O.addListener(P),()=>{O.removeListener(P)})),[]),(0,i.useEffect)((()=>{O.enqueueRecompute()}));const P=(0,i.useCallback)((()=>{const e=v.current,t=x.current;if(e&&t){const o=O.state,r=o===zu.VisibleInItem||o===zu.VisibleOutOfItem;e.style.opacity=""+(r?1:0),e.style.transform=`scale(${r?1:.3})`,t.style.pointerEvents=o===zu.VisibleOutOfItem?"":"none";y.current!==zu.NotDefined&&o!==zu.NotDefined&&!e.style.transition&&(e.style.transition="transform 160ms ease-in-out, opacity 160ms ease-in-out"),y.current=o}}),[O]),R=(0,i.useCallback)((()=>{const e=p.state,i=r.zoomLevel.state,{snapUnit:n}=Gn.BJ[i],a=(0,Gn.x2)(i,200);if(e)if("left"===o){const{start:t}=(0,Gn.XO)(e,n),o=(0,Gn.GK)({timestamp:t.valueOf(),environment:f,timelineState:r,paddingLeft:s,format:l})-a;Ec.Nf({timelineState:r,environment:f,zoomLevel:i,centerTimestamp:o})}else{const{end:t}=(0,Gn.XO)(e,n),o=(0,Gn.PF)({timestamp:t.valueOf(),timelineState:r})+a;Ec.Nf({timelineState:r,environment:f,zoomLevel:i,centerTimestamp:o})}k(!1),Y.Ys({environment:f,store:t}),L.gw(f,{...(0,Gn.Ii)({environment:f,collectionContextStore:m,timelineState:r,isFullScreen:S,isRootChild:C}),type:o})}),[m,p,f,l,S,C,s,t,r,o]),M=(0,i.useCallback)((()=>{f.device.isPhone||Qo.Z.state||k(!0)}),[f]),j=(0,i.useCallback)((()=>{f.device.isPhone||k(!1)}),[f]);return(0,b.jsxs)("div",{style:V.wrap,onMouseOver:M,onMouseOut:j,onMouseDown:me.$0,onClick:R,ref:x,children:[(0,b.jsx)("div",{style:V.arrow,ref:v,children:_(V.icon)}),w&&(0,b.jsx)(Uu,{dateValueStore:p,timelineState:r,isInPeekRenderer:g})]})}const Ku=i.memo(Gu,po.Z);function Uu(e){let{dateValueStore:t,timelineState:o,isInPeekRenderer:r}=e;const i=(0,u.yK)((e=>({dateRange:{fontSize:12,paddingLeft:4,paddingRight:4,borderRadius:4,background:r?e.peekTimelineBackground:e.timelineBackground,pointerEvents:"none"}})),[r]),n=(0,d.VK)((()=>t.state),[t]),s=(0,d.VK)((()=>o.zoomLevel.state),[o]);return n?(0,b.jsx)("span",{style:i.dateRange,children:(0,Gn._Q)(n,s)}):null}class Wu extends s.Z{constructor(){super(...arguments),this.clonedStore=void 0,this.dateRangeRef=i.createRef(),this.storeTypes={nodeStore:p.default.createClass(null)},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseMove=e=>function(e,t,o,i,n,s,l,a,c){const d=o.dragState.state,u=o.drawState.state,{horizontalScroller:p}=o,h=o.scrollLeft.state,m=o.zoomLevel.state,S=o.currentRange.state,{snapUnit:g,getDateRangePlaceholderDuration:C}=Gn.BJ[m];if(!u&&Qo.Z.state||d||qu(i,l,a,t)||!p||void 0===h||s)return;const f=p.getBoundingClientRect(),y=h+(e.clientX-f.left),v=(0,Gn.x2)(m,y),x=r.ou.fromMillis(S.startTimestamp+v),b=(0,Gn.DS)(x,g),w=(0,Gn.DS)(C(x),g),k=(0,yu.hT)(b.valueOf(),(0,Ee.r)()),_=(0,Gn.AZ)({startValue:k,snapUnit:g,desiredStart:b,desiredEnd:w});o.dateRangePlaceholder.setState({active:!0,store:i,parentStore:c.state,groupFormat:n,date:_,newTimelineItemProps:void 0,existingTimelineItemProps:{query:l,schema:a}})}(e,this.environment,this.props.timelineState,this.props.store,this.props.groupFormat,this.props.disabled,this.props.query,this.props.schema,this.parentCollectionStore),this.handleClick=e=>{const{store:t,query:o,schema:r,timelineState:i,groupFormat:n,collectionContextStore:s}=this.props,l=i.dateRangePlaceholder.state,a=s.groupsStore.getGroupState(n);if(a)if(l.active){const{date:e}=l;ee.createAndCommit({userAction:"CollectionTimelineViewItem.handleClick",environment:this.environment,perform:i=>{Ec.oP({environment:this.environment,store:t,query:o,schema:r,date:e,transaction:i})}}),i.dateRangePlaceholder.setState({active:!1})}else{const{timelineState:o,collectionContextStore:r}=this.props,{horizontalScroller:i}=o,n=o.scrollLeft.state,s=this.itemPositionStore.state,l=this.dateRangeRef.current;if(!i||void 0===n||!s||!l)return;const c=i.getBoundingClientRect(),d=n+(e.clientX-c.left),u=l.propertiesWrapEl.current;if(!u)return;const p=u.lastElementChild;if(!p)return;const m=n+(p.getBoundingClientRect().right-c.left);d>s.right&&d<=m&&(0,me.ZP)({event,context:me.Af.EditorClick,callback:()=>{(0,Qa.X9)()||le.CH({environment:this.environment,store:t,openInNew:ji.DJ(e),peekMode:(0,ce.kr)(r),resultsStore:a.resultsStore,collectionContextStore:r,pageVisitSource:h.tY.PeekOpen})}})}},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onRefChange=e=>function(e,t){t.setState(e)}(e,this.stores.nodeStore),this.itemPositionStore=this.createComputedStore((()=>{const{timelineState:e}=this.props;return(0,Gn.HZ)({timelineState:e,dateValue:this.dateValueStore.state,placeholderDate:this.placeholderDateStore.state,subitemPlaceholderDate:this.subitemPlaceholderDateStore.state})})),this.shouldRenderDateRangeStore=this.createComputedStore((()=>{const e=this.itemPositionStore.state;return Boolean(e)})),this.shouldRenderScrollArrowsStore=this.createComputedStore((()=>{const e=this.itemPositionStore.state;return Boolean(e&&!e.isPlaceholder)})),this.subitemPlaceholderDateStore=this.createComputedStore((()=>{const{subitemPath:e}=this.props,t=(0,Gr.ub)(e);if(!t||Boolean(this.dateValueStore.state))return;const o=t.value.store,r=Gc.findCollectionTimelineViewItems(o);if(r.length>0){return r[0].dateValueStore.state}})),this.placeholderDateStore=this.createComputedStore((()=>{const{store:e,timelineState:t,groupFormat:o}=this.props,r=t.dateRangePlaceholder.state;if(r.active&&r.store===e&&!r.newTimelineItemProps&&(0,re.ZH)(r.groupFormat,o))return r.date})),this.dateValueStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props,o=t.dragState.state,r=this.placeholderDateStore.state;if(r)return r;if(o){const t=o.stores.indexOf(e);if(t>=0)return o.temporaryValues[t]}return qu(this.props.store,this.props.query,this.props.schema,this.environment)}),!0),this.isDraggingViaTimelineItemStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props,o=t.dragState.state,r=Qr.ZP.state;return Boolean(o&&o.stores.includes(e)&&r.isDragging&&r.draggedStores.includes(e))})),this.parentCollectionStore=this.createComputedStore((()=>this.props.store.getAssociatedCollectionStore()))}get registries(){return[Gc]}UNSAFE_willMount(e){super.UNSAFE_willMount(e),this.clonedStore=e.store.clone()}renderComponent(){var e;const{store:t,timelineState:o,scrollerLeftOffset:r,paddingLeft:i,format:n,query:s,schema:l,blockPropertyValueOverlayStore:a,disabled:c,showProperties:d,collectionContextStore:u,isFullScreen:p,isRootChild:h,toggleButton:m,groupFormat:S}=this.props,g=this.shouldRenderDateRangeStore.state,C=this.shouldRenderScrollArrowsStore.state,f=null===(e=u.groupsStore.getGroupState(S))||void 0===e?void 0:e.reducerResultStore;if(f)return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{style:{display:"flex",height:0},children:[C&&(0,b.jsx)(Ku,{store:t,type:"left",timelineState:o,scrollerLeftOffset:r,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,paddingLeft:i,format:n,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:u,isFullScreen:p,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:h}),C&&(0,b.jsx)(Ku,{store:t,type:"right",timelineState:o,scrollerLeftOffset:r,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,paddingLeft:i,format:n,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:u,isInPeekRenderer:this.props.isInPeekRenderer,isFullScreen:p,isRootChild:h})]}),(0,b.jsx)("div",{style:{display:"flex",height:Fc.Z+1,width:"100%",cursor:"default"},onMouseDown:e=>function(e,t){const{target:o}=e;if(t.device.isMobile||!(o instanceof HTMLElement))return;(0,me.ZP)({event:e,context:me.Af.EditorMouseDown,callback:()=>{e.preventDefault(),W.AI({environment:t,target:o,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,this.environment),onMouseMove:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseMove,onMouseLeave:()=>function(e){e.dateRangePlaceholder.setState({active:!1})}(this.props.timelineState),onClick:this.handleClick,className:fo.o4s,ref:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onRefChange,children:g&&(0,b.jsx)(Mu,{store:t,parentStore:this.parentCollectionStore.state,toggleButton:m,clonedStore:this.clonedStore,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,query:s,schema:l,timelineState:o,blockPropertyValueOverlayStore:a,disabled:c,showProperties:d,scrollerLeftOffset:r,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:u,isFullScreen:p,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:h,intl:ho.default.getIntl(),ref:this.dateRangeRef,resultStore:f,handleOpenPeekPage:this.props.handleOpenPeekPage})})]})}}Wu.displayName="CollectionTimelineViewItem";const $u=Wu;function qu(e,t,o,r){return(0,Gn.bk)({store:e,query:t,schema:o,userId:r.currentUser.id,intl:ho.default.getIntl()})}class Qu extends s.Z{constructor(){super(...arguments),this.clonedStore=void 0,this.itemPositionStore=this.createComputedStore((()=>{const{timelineState:e}=this.props;return(0,Gn.HZ)({timelineState:e,dateValue:this.dateValueStore.state,placeholderDate:this.placeholderDateStore.state,subitemPlaceholderDate:void 0})})),this.shouldRenderDateRangeStore=this.createComputedStore((()=>{const e=this.itemPositionStore.state;return Boolean(e)})),this.isDraggingViaTimelineItemStore=this.createComputedStore((()=>!1)),this.placeholderDateStore=this.createComputedStore((()=>{const{store:e,parentStore:t,timelineState:o,groupFormat:r}=this.props,i=o.dateRangePlaceholder.state;if(i.active&&i.store===e&&i.newTimelineItemProps&&i.parentStore===t&&(0,re.ZH)(i.groupFormat,r))return i.date})),this.dateValueStore=this.createComputedStore((()=>{const e=this.placeholderDateStore.state;if(e)return e}),!0)}UNSAFE_willMount(e){super.UNSAFE_willMount(e),e.store&&(this.clonedStore=e.store.clone())}renderComponent(){var e;const{store:t,parentStore:o,timelineState:i,scrollerLeftOffset:n,query:s,schema:l,blockPropertyValueOverlayStore:a,disabled:c,showProperties:d,collectionContextStore:u,isFullScreen:p,isRootChild:h,toggleButton:m,groupFormat:S}=this.props,g=this.shouldRenderDateRangeStore.state,C=null===(e=u.groupsStore.getGroupState(S))||void 0===e?void 0:e.reducerResultStore,f=!u.isInHomeWidget.state&&!t&&!g&&u.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0});if(C)return(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)("div",{style:{display:"flex",height:Fc.Z+1,width:"100%",cursor:"default"},onMouseDown:e=>function(e,t){const{target:o}=e;if(t.device.isMobile||!(o instanceof HTMLElement))return;(0,me.ZP)({event:e,context:me.Af.EditorMouseDown,callback:()=>{e.preventDefault(),W.AI({environment:t,target:o,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,this.environment),onMouseMove:e=>function(e,t,o,i,n,s,l,a,c,d,u,p){var h;const m=t.drawState.state,S=t.dragState.state,{horizontalScroller:g}=t,C=t.scrollLeft.state,f=t.zoomLevel.state,y=t.currentRange.state,{snapUnit:v,getDateRangePlaceholderDuration:x}=Gn.BJ[f];if(!m&&Qo.Z.state||S||!g||void 0===C||n)return;const b=null===(h=d.groupsStore.getGroupState(i))||void 0===h?void 0:h.resultsStore;if(!b)return;const w=g.getBoundingClientRect(),k=C+(e.clientX-w.left),_=(0,Gn.x2)(f,k),T=r.ou.fromMillis(y.startTimestamp+_),O=(0,Gn.DS)(T,v),V=(0,Gn.DS)(x(T),v),P=(0,yu.hT)(O.valueOf(),(0,Ee.r)()),R=(0,Gn.AZ)({startValue:P,snapUnit:v,desiredStart:O,desiredEnd:V});t.dateRangePlaceholder.setState({active:!0,store:o,parentStore:u,groupFormat:i,date:R,newTimelineItemProps:{query:s,schema:l,resultsStore:b,isFullScreen:a,canEditTimelineItems:c,subitemPath:p},existingTimelineItemProps:void 0})}(e,this.props.timelineState,this.props.store,this.props.groupFormat,this.props.disabled,this.props.query,this.props.schema,this.props.isFullScreen,this.props.canEditTimelineItems,this.props.collectionContextStore,this.props.parentStore,this.props.subitemPath),onMouseLeave:()=>function(e){e.dateRangePlaceholder.setState({active:!1})}(this.props.timelineState),onClick:e=>function(e,t,o,r,i,n,s,l,a,c,d,u){const p=i.dateRangePlaceholder.state;if(p.active){const{date:e}=p,h=u?u.length>0?"timeline_add_subitem_bottom":"timeline_add_parent_item_bottom":"timeline_add_item_bottom";ee.createAndCommit({userAction:"CollectionTimelineViewItem.handleClick",environment:t,perform:i=>{const p=Ec.mg({environment:t,transaction:i,date:e,store:c,parentStore:d,query:o,schema:r,isFullScreen:n,groupFormat:s,canEditTimelineItems:l,collectionContextStore:a,subitemPath:u,from:h});ne.W(t,{from:h,type:"page",new_page_id:null==p?void 0:p.id,creating_block_id:null==p?void 0:p.id,...(0,he.Pn)(a)})}}),i.dateRangePlaceholder.setState({active:!1})}}(0,this.environment,this.props.query,this.props.schema,this.props.timelineState,this.props.isFullScreen,this.props.groupFormat,this.props.canEditTimelineItems,this.props.collectionContextStore,this.props.store,this.props.parentStore,this.props.subitemPath),className:fo.o4s,children:[g&&(0,b.jsx)(Mu,{store:o?void 0:t,parentStore:o,toggleButton:m,clonedStore:this.clonedStore,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,query:s,schema:l,timelineState:i,blockPropertyValueOverlayStore:a,disabled:c,showProperties:d,scrollerLeftOffset:n,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:u,isFullScreen:p,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:h,intl:ho.default.getIntl(),resultStore:C,handleOpenPeekPage:Xu}),f&&(0,b.jsx)(tp,{parentStore:this.props.parentStore,collectionContextStore:this.props.collectionContextStore,paddingLeft:this.props.paddingLeft,isFullScreen:this.props.isFullScreen,showTable:this.props.showTable})]})})}}Qu.displayName="CollectionTimelineViewItemNew";const Yu=Qu;function Xu(){}function Ju(e,t,o){return{position:"sticky",left:t&&!o?e+8:8,display:"flex",alignItems:"center"}}function ep(e){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.mediumIconColor}}function tp(e){let{parentStore:t,collectionContextStore:o,paddingLeft:r,isFullScreen:i,showTable:n}=e;const s=(0,u.Fg)(),l=(0,d.VK)((()=>o.currentSubitemFormatStoreForUiDisplay.state),[o]),a=(0,d.VK)((()=>{var e;return l&&t?null===(e=t.getSchema()[l.property])||void 0===e?void 0:e.name:""}),[l,t]);return(0,b.jsx)("div",{style:Ju(r,i,n),children:(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",paddingBottom:2,fontSize:14,height:bc,lineHeight:D.Z.lineHeight.UIRegular.desktop},children:[(0,ie.R)(ep(s)),(0,b.jsx)("span",{style:{color:s.mediumTextColor},children:t&&a?(0,b.jsx)(B.FormattedMessage,{defaultMessage:"New page in {propertyName}",id:"database.timelineView.nest.addSubitemWithPropertyName",values:{propertyName:a}}):(0,b.jsx)(B.FormattedMessage,{defaultMessage:"New",id:"database.timelineView.item.addRowButton"})})]})})}class op extends s.Z{constructor(){super(...arguments),this.resultPropsMemo=new fu.Uw,this.resultProps=()=>{const{groupFormat:e,disabled:t,query:o,format:r,schema:i,blockPropertyValueOverlayStore:n,collectionContextStore:s,isFullScreen:l,isRootChild:a,showTable:c,canEditTimelineItems:d,scrollerLeftOffsetStore:u,timelineState:p,paddingLeft:h,showTimelinePropertiesStore:m,isInPeekRenderer:S}=this.props,g=s.permissionScopes.state;return this.resultPropsMemo.memo((()=>({disabled:t||!("collectionTypedView"===s.contextType||g.canEditContent),timelineState:p,schema:i,query:o,format:r,scrollerLeftOffset:u.state,paddingLeft:h,showProperties:m.state,blockPropertyValueOverlayStore:n,collectionContextStore:s,isFullScreen:l,showTable:c,isRootChild:a,groupFormat:e,canEditTimelineItems:d,isInPeekRenderer:S,handleOpenPeekPage:()=>np(this.props.collectionContextStore,this.props.groupFormat,this.environment),isLast:!1})),[t,p,i,o,r,u,g,h,m,n,s,l,c,a,e,d,S,()=>np(this.props.collectionContextStore,this.props.groupFormat,this.environment)])},this.resultsReducerStore=this.createComputedStore((()=>{const{collectionContextStore:e,schema:t,groupFormat:o,query:r,showTable:i}=this.props;if(!r.timeline_by)return;const n=e.groupsStore.getGroupState(o);if(!n)return;const s=n.currentLimit.state,l=N.oA([o&&(0,Le.Ko)({schema:t,propertyMapping:void 0,group:o,timeZone:(0,Ee.r)()}),!i&&{property:r.timeline_by,filter:{operator:"is_not_empty"}}]);return{type:"results",filter:l.length>0?{operator:"and",filters:l}:void 0,limit:s}}))}renderComponent(){const{store:e,format:t,groupFormat:o,collectionContextStore:r,isFullScreen:i,paddingLeft:n,showTable:s}=this.props,l=r.groupsStore.getGroupState(o);if(!l)return;const a=o?[o]:[],c=this.resultsReducerStore.state,d=l.reducerResultStore.state,u=ce.VM({collectionContextStore:r,reducerResult:d,isFullScreen:i});return(0,b.jsxs)(b.Fragment,{children:[c&&(0,b.jsx)(ze.Z,{id:a.length>0?`results:${(0,re.KW)(a)}`:"timeline_results",reducer:c,groupsPointer:a,collectionContextStore:r,resultStore:l.reducerResultStore}),this.renderCollectionGroupResults(),u&&(0,b.jsx)("div",{style:{width:"100%"},children:s?(0,b.jsx)("div",{style:{height:33}}):(0,b.jsx)(no,{style:{position:"sticky",left:i?n:3,width:"max-content",height:33},groupsPointer:a,store:e,collectionContextStore:r,format:t,isFullScreen:i,incrementLimitsInRelatedGroups:!1})}),(0,b.jsx)(rp,{...this.props,store:void 0,indentLevel:0,handleOpenPeekPage:()=>np(this.props.collectionContextStore,this.props.groupFormat,this.environment)})]})}renderCollectionGroupResults(){const{groupFormat:e,format:t,collectionContextStore:o}=this.props,r=o.groupsStore.getGroupState(e);if(r)return(0,b.jsx)(ii,{disableSelectable:!0,collectionContextStore:o,groupsPointer:r.groupsPointer,format:t,canDrag:!1,disableRequest:!0,resultProps:this.resultProps(),canDrop:!1,resultComponent:$u,disabled:!0,direction:oi.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,nestedCreateSubitemButton:e=>function(e,t,o){return(0,b.jsx)(rp,{...o,store:e.store,indentLevel:e.indentLevel,parentStore:e.parentStore,subitemPath:e.subitemPath,handleOpenPeekPage:()=>np(o.collectionContextStore,o.groupFormat,t)})}(e,this.environment,this.props)})}}function rp(e){const{store:t,parentStore:o,subitemPath:r,timelineState:i,disabled:n,query:s,format:l,schema:a,collectionContextStore:c,blockPropertyValueOverlayStore:u,isFullScreen:p,isRootChild:h,groupFormat:m,paddingLeft:S,showTimelinePropertiesStore:g,scrollerLeftOffsetStore:C,showTable:f,canEditTimelineItems:y,isInPeekRenderer:v,isReady:x,canEdit:w}=e,k=(0,d.VK)((()=>c.groupsStore.getGroupState(m)),[c,m]),_=(0,d.VK)((()=>c.permissionScopes.state),[c.permissionScopes]),T=(0,d.VK)((()=>C.state),[C]),O=(0,d.VK)((()=>g.state),[g]),V=(0,d.VK)((()=>"collectionTypedView"===c.contextType),[c]);return(0,d.VK)((()=>c.isInHomeWidget.state),[c])||!k||!x||!w&&!V||_.isSyncedCollection?null:(0,b.jsx)(Yu,{store:t,disabled:n||!_.canEditContent&&!V,timelineState:i,schema:a,query:s,format:l,scrollerLeftOffset:T,paddingLeft:S,showProperties:O,blockPropertyValueOverlayStore:u,collectionContextStore:c,isFullScreen:p,showTable:f,isRootChild:h,groupFormat:m,canEditTimelineItems:y,isInPeekRenderer:v,parentStore:o,subitemPath:r})}op.displayName="TimelineItemGroupResults";const ip=(0,B.injectIntl)(op);function np(e,t,o){const r=e.groupsStore.getGroupState(t);if(!r)return;Hr.default.mark("collections.open_item_page_lag");const i=e.collectionViewStore();U.Xd({collectionContextStore:e,resultsStore:r.resultsStore});const n=null==i?void 0:i.getFormat().collection_peek_mode,s=n||qr.Ls.timeline;$r.hy(o,{is_peek:!0,from:"timeline",peek_mode:s})}function sp(){const e=(0,u.yK)((e=>({rowContainer:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0",borderBottom:`1px solid ${e.regularDividerColor}`},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor}})),[]);return(0,b.jsx)("div",{style:e.rowContainer,children:(0,b.jsx)(Nr.Z,{style:e.rowShimmer})})}class lp extends s.Z{constructor(){super(...arguments),this.groupsPointerMemo=new fu.Uw,this.groupsPointer=()=>{const{groupFormat:e}=this.props;return this.groupsPointerMemo.memo((()=>e?[e]:[]),[e])},this.renderGroupResults=e=>{const{device:t}=this.environment,{schema:o,disabled:r,collectionContextStore:i,blockPropertyValueOverlayStore:n,showTablePropertyFormatsStore:s,canEdit:l,format:a,groupFormat:c}=this.props,d=i.collectionViewStore();if(!d)return;const u=this.groupsPointer();if(!i.groupsStore.getGroupState(u))return;const p=s.state,h=!l&&t.isMobile&&!d.isSyncedCollection(),m=this.titleColumnIndexStore.state;return(0,b.jsx)(ii,{collectionContextStore:i,groupsPointer:u,disableRequest:!0,format:a,canDrag:h,resultProps:{schema:o,collectionContextStore:i,propertyFormats:p,onPropertyTab:e.onPropertyTab,onPropertyUntab:e.onPropertyUntab,onPropertyEnter:e.onPropertyEnter,onPropertyClick:e.onPropertyClick,onPropertyEsc:e.onPropertyEsc,onPropertyBgClick:e.onPropertyBgClick,onPropertyContextMenu:e.onPropertyContextMenu,onOpenProperty:e.onOpenProperty,disabled:r,blockPropertyValueOverlayStore:n,showRightActionsSpacer:!1,disableHorizontalEdgeScroll:!0,disableTableWrap:!0,disableCellBorderRight:!1,disableLastCellBorderRight:!0,onShiftEnter:cp,titleColumnIndex:m,groupFormat:c,shouldShowMultiSelectCheckbox:!1,isInHomeWidget:i.isInHomeWidget.state},resultComponent:Ea,canDrop:!1,disabled:r,direction:oi.Vertical,getItemSelectableStyle:()=>(this.theme,{display:"flex",width:"fit-content",height:33}),shouldShowHoverMenu:!0,analyticsName:"timeline",emptyDroppableSize:0,onSelectableEnter:e.onSelectableEnter,disableScrollToRevealHorizontal:!0,blockPropertyValueOverlayStore:n,titleColumnIndex:m,nestedCreateSubitemButton:this.nestedCreateSubitemButton})},this.nestedCreateSubitemButton=e=>{const{collectionContextStore:t,disabled:o}=this.props,{store:r,parentStore:i,subitemPath:n,indentLevel:s}=e;if(i)return(0,b.jsx)(Ms,{store:r,collectionStore:i,subitemPath:n,indentLevel:s,collectionContextStore:t,disabled:o,groupsPointer:this.groupsPointer(),onSubitemCreate:e=>function(e,t,o,r){o&&l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{To.bA({isNewBlock:!0,environment:r,blockPropertyValueOverlayStore:o,store:e,property:"title",format:Mo.C.Table,collectionContextStore:t,disableHorizontalEdgeScroll:!0})}))}))}(e,this.props.collectionContextStore,this.props.blockPropertyValueOverlayStore,this.environment)})},this.titleColumnIndexStore=this.createComputedStore((()=>{const{showTablePropertyFormatsStore:e}=this.props;return e.state.findIndex((e=>"title"===e.property))}))}renderComponent(){const{groupFormat:e,isFullScreen:t,collectionContextStore:o,blockPropertyValueOverlayStore:r,isReady:i,store:n,disabled:s,format:l,schema:a,isInPeekRenderer:c,query:d,showTablePropertyFormatsStore:u,showHoverActionsStore:p}=this.props,h=o.groupsStore.getGroupState(this.groupsPointer());if(!h)return;const m=h.reducerResultStore.state,S=(0,ce.VM)({collectionContextStore:o,reducerResult:m,isFullScreen:t}),g=o.shouldShowSpinner.state,C=i&&0===(null==m?void 0:m.blockIds.length)&&!g,f=o.permissionScopes.state;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(pp,{store:n,format:l,schema:a,query:d,collectionContextStore:o,disabled:s,paddingBottom:this.props.paddingBottom,isInPeekRenderer:c,blockPropertyValueOverlayStore:r,tableStore:this.props.tableStore,showTablePropertyFormats:this.props.showTablePropertyFormatsStore.state,timelineState:this.props.timelineState,isFullScreen:this.props.isFullScreen,isRootChild:this.props.isRootChild,groupFormat:e,isInHomeWidget:o.isInHomeWidget.state}),(0,b.jsx)("div",{style:{height:(0,Gn.vX)(Boolean(e)),width:0}}),C&&(0,b.jsx)(gp,{collectionContextStore:this.props.collectionContextStore,isFullScreen:this.props.isFullScreen,groupFormat:this.props.groupFormat,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,canEdit:this.props.canEdit}),this.renderTableRows(e),g&&(0,b.jsx)(sp,{}),S&&this.renderLoadMoreButton(),dp(this.props.collectionContextStore,this.props.isReady,this.props.canEdit)&&(0,b.jsx)(Cp,{collectionContextStore:this.props.collectionContextStore,isFullScreen:this.props.isFullScreen,groupFormat:this.props.groupFormat,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,isInPeekRenderer:this.props.isInPeekRenderer}),(0,b.jsx)(Ws,{groupFormat:e,style:up(this.props.isReady,this.props.groupFormat,this.props.isFullScreen,this.props.paddingLeft),disabled:s||!f.canConfigureBlock,schema:a,query:d,collectionContextStore:o,isInPeekRenderer:c,isFullScreen:t,showPropertyFormats:u.state,showHoverActionsStore:p,showRightActionsSpacer:!1}),(e||t)&&(0,b.jsx)("div",{style:{height:wc,width:0,marginBottom:e?Gn.y1:void 0}})]})}renderTableRows(e){const{store:t,schema:o,query:r,collectionContextStore:i,blockPropertyValueOverlayStore:n,showTablePropertyFormatsStore:s,canEdit:l,format:a,tableStore:c,paddingLeft:d}=this.props;if(!i.collectionViewStore())return;return i.groupsStore.getGroupState(e)?(0,b.jsx)(ic,{store:t,format:a,schema:o,query:r,collectionContextStore:i,minWidth:void 0,blockPropertyValueOverlayStore:n,showPropertyFormats:s.state,disabled:!l,disableHorizontalEdgeScroll:!0,groupFormat:e,render:this.renderGroupResults,tableStore:c,paddingLeft:d}):void 0}renderLoadMoreButton(){const{collectionContextStore:e,format:t,canEdit:o}=this.props,r=this.groupsPointer();if(!e.groupsStore.getGroupState(r))return;const i=Qt({collectionContextStore:e,groupsPointer:r});return(0,b.jsxs)(Yt.Z,{onMouseDown:me.$0,onClick:e=>function(e,t,o,r,i){const n=t.groupsStore.getGroupState(o);if(!n)return;const s=n.reducerResultStore.state;(0,me.Wi)(e),Y.ZH(i),s&&Z.ID({collectionContextStore:t,environment:i,incrementLimitArgs:{isFullScreen:r,currentResultCount:s.blockIds.length,groupsPointer:n.groupsPointer,incrementLimitsInRelatedGroups:!1}});L.uD(i)}(e,this.props.collectionContextStore,this.props.groupFormat,this.props.isFullScreen,this.environment),disabled:i,hoveredStyle:i?{background:this.theme.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",height:bc+1,width:"100%",paddingLeft:8,paddingBottom:2,fontSize:14,lineHeight:D.Z.lineHeight.UIRegular.desktop,boxShadow:`0 -1px 0 ${this.theme.tableDividerColor}`,borderBottom:`1px solid ${this.theme.tableDividerColor}`,whiteSpace:"break-spaces"},children:[(0,Kt.M)(mp(this.theme)),(0,b.jsx)("span",{style:{color:this.theme.lightTextColor},children:(0,b.jsx)(B.FormattedMessage,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),i?(0,b.jsx)("div",{style:{marginTop:1,marginLeft:8,marginRight:8},children:(0,b.jsx)(Ge.Z,{style:{width:12,height:12}})}):o&&(0,b.jsx)(oo,{collectionContextStore:e,format:t})]})}}lp.displayName="TimelineTableGroupResults";const ap=(0,B.injectIntl)(lp);function cp(){}function dp(e,t,o){const r=e.permissionScopes.state,i="collectionTypedView"===e.contextType;return Boolean(!e.isInHomeWidget.state&&t&&(o||i)&&!r.isSyncedCollection)}function up(e,t,o,r){return{...!e&&{opacity:0,pointerEvents:"none"},...!o&&!t&&{position:"sticky",left:r},...o&&!t&&{left:r}}}function pp(e){let{groupFormat:t,store:o,format:r,schema:i,query:n,collectionContextStore:s,disabled:l,paddingBottom:a,isInPeekRenderer:c,blockPropertyValueOverlayStore:u,tableStore:p,showTablePropertyFormats:h,timelineState:m,isFullScreen:S,isRootChild:g,isInHomeWidget:C}=e;const f=(0,d.VK)((()=>s.groupsStore.getGroupState(t)),[s,t]),y=(0,d.VK)((()=>s.permissionScopes.state),[s]),v=(0,d.VK)((()=>s.viewIsFlushToTopbar()),[s]);if(!f)return null;const x=Boolean(t);return(0,b.jsx)(xa,{store:o,format:r,schema:i,query:n,collectionContextStore:s,isInPeekRenderer:c,minWidth:void 0,paddingBottom:a,blockPropertyValueOverlayStore:u,showPropertyFormats:h,showRightActions:!1,allowHidingTitle:!0,tableStore:p,formatKey:"timeline_table_properties",disabled:l||!y.canConfigureBlock,disableHorizontalEdgeScroll:!0,height:(0,Gn.vX)(x),paddingTop:x?0:Gn.Ne-Gn.pe,disableTopBorder:!v||x,disableCellRightBorder:!0,groupFormat:t,isInHomeWidget:C,children:!x&&y.canConfigureBlock&&(0,b.jsx)(Md,{isGrouped:!1,format:r,collectionContextStore:s,timelineState:m,isFullScreen:S,isRootChild:g})})}function hp(e,t){return{borderBottom:`1px solid ${t.tableDividerColor}`,display:"flex",alignItems:"center",height:bc,width:"100%",paddingLeft:8,fontSize:14,lineHeight:D.Z.lineHeight.UIRegular.desktop,background:e?t.cardContentBackground:t.contentBackground}}function mp(e){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.lightIconColor}}function Sp(e,t,o,r,i,n){const{device:s}=e,a=r?[r]:[],c=t.groupsStore.getGroupState(a);if(!Ce.M_(e)||!c)return;t.searchQuery.state&&pe.Ug({searchQuery:"",collectionContextStore:t,isFullScreen:o});const d=t.currentSubitemFormatStoreForCollection.state;ee.createAndCommit({userAction:"TimelineTableGroupResults.handleAddRowClick",environment:e,perform:o=>{const a=Z.IW({environment:e,collectionContextStore:t,groupsPointer:r?[r]:[],shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:o,from:"timeline_table_group_results"});if(a){if(s.isMobile){!function(e,t,o){o?o(e):ae.c4({environment:t,url:e})}((0,Ko.ZP)({store:a.newStore,fullyQualified:!1,pageVisitSource:h.tY.Create}),e,n)}else l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{if(a.coercionSucceeded)To.bA({environment:e,blockPropertyValueOverlayStore:i,store:a.newStore,property:"title",format:Mo.C.Table,collectionContextStore:t,disableHorizontalEdgeScroll:!0});else{const o=r?[r]:[],i=t.groupsStore.getGroupState(o);le.CH({environment:e,store:a.newStore,peekMode:(0,ce.kr)(t),resultsStore:null==i?void 0:i.resultsStore,collectionContextStore:t,pageVisitSource:h.tY.Create})}}))}));ne.W(e,{from:d?"timeline_add_parent_item_bottom":"timeline_add_item_bottom",type:"page",new_page_id:a.newStore.id,creating_block_id:a.newStore.id,...(0,he.Pn)(t)})}}})}function gp(e){let{collectionContextStore:t,isFullScreen:o,groupFormat:r,blockPropertyValueOverlayStore:n,canEdit:s}=e;const l=(0,u.Fg)(),c=(0,a.O7)(),d=(0,i.useContext)(xn.ZO),p=(0,i.useCallback)((()=>Sp(c,t,o,r,n,d)),[c,t,o,r,n,d]);return(0,b.jsx)(Yt.Z,{onClick:p,onMouseDown:me.$0,disabled:!s,style:{display:"flex",alignItems:"center",height:bc,width:"100%",paddingLeft:8,fontSize:14,lineHeight:D.Z.lineHeight.UIRegular.desktop,background:l.contentBackground,left:0,right:0,borderBottom:`1px solid ${l.tableDividerColor}`},children:s?(0,b.jsx)("span",{style:{color:l.lightTextColor},children:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Empty. Click to add a row.",id:"database.timelineView.emptyTablePlaceholder"})}):(0,b.jsx)("span",{style:{color:l.lightTextColor},children:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Empty.",id:"database.timelineView.cannotEdit.emptyTablePlaceholder"})})})}function Cp(e){let{collectionContextStore:t,isFullScreen:o,groupFormat:r,blockPropertyValueOverlayStore:n,isInPeekRenderer:s}=e;const l=(0,u.Fg)(),c=(0,a.O7)(),d=(0,i.useContext)(xn.ZO),p=(0,i.useCallback)((()=>Sp(c,t,o,r,n,d)),[c,t,o,r,n,d]);return(0,b.jsxs)(Yt.Z,{onClick:p,style:hp(s,l),className:fo.tfM,onMouseDown:me.$0,children:[(0,ie.R)(mp(l)),(0,b.jsx)("span",{style:{color:l.lightTextColor},children:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"New",id:"database.timelineView.addRowButton"})})]})}class fp extends Ho.Z{constructor(){super(...arguments),this.widthEl=null,this.storeTypes={tableStore:Ps,hiddenGroupsVisible:p.default.createClass(!1),groupsReducerResultStore:p.default.createClass(void 0)},this.renderTableGroupHeader=e=>{const{format:t,collectionContextStore:o,isFullScreen:r,isRootChild:i}=this.props,n=o.permissionScopes.state;return(0,b.jsxs)(Nt,{...e,height:Gn.Zn-1,paddingTop:Gn.xd,toggleClosedMarginBottom:Gn.xd,getComputedStickyStyle:e=>function(e,t){return{boxShadow:e?`0 -1px 0 ${t.tableDividerColor}`:void 0}}(e,this.theme),style:bp(e.index,this.props.collectionContextStore,this.theme),children:[0===e.index&&n.canConfigureBlock&&(0,b.jsx)(Md,{isGrouped:!0,format:t,collectionContextStore:o,timelineState:this.timelineState,isFullScreen:r,isRootChild:i})," "]})},this.renderTableGroupResults=e=>{const{store:t,isFullScreen:o,schema:r,query:i,isInPeekRenderer:n,collectionContextStore:s,blockPropertyValueOverlayStore:l,showHoverActionsStore:a,paddingBottom:c,isRootChild:d,disabled:u}=this.props,p=this.isReady.state,h=xp(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment);if(s.groupsStore.getGroupState(e))return(0,b.jsx)(ap,{store:t,groupFormat:e,schema:r,query:i,isInPeekRenderer:n,timelineState:this.timelineState,collectionContextStore:s,blockPropertyValueOverlayStore:l,showTablePropertyFormatsStore:this.showTablePropertyFormatsStore,showHoverActionsStore:a,tableStore:this.stores.tableStore,paddingLeft:h,paddingBottom:c,format:wp(this.props.format,this.stores.tableStore),isFullScreen:o,isRootChild:d,isReady:p,canEdit:this.canEditCollectionTimeline(),disabled:u&&this.canEditCollectionTimeline()})},this.renderTimelineItemGroupResults=e=>{const{store:t,isFullScreen:o,schema:r,query:i,isInPeekRenderer:n,collectionContextStore:s,blockPropertyValueOverlayStore:l,isRootChild:a,disabled:c}=this.props,d=this.isReady.state,u=xp(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment);return(0,b.jsx)(ip,{store:t,groupFormat:e,schema:r,query:i,isInPeekRenderer:n,timelineState:this.timelineState,collectionContextStore:s,blockPropertyValueOverlayStore:l,showTimelinePropertiesStore:this.showTimelinePropertiesStore,paddingLeft:u,format:wp(this.props.format,this.stores.tableStore),isFullScreen:o,isRootChild:a,isReady:d,canEdit:this.canEditCollectionTimeline(),disabled:c,showTable:this.showTableStore.state,canEditTimelineItems:this.canEditTimelineItemsStore.state,scrollerLeftOffsetStore:this.scrollerLeftOffsetStore})},this.renderTimelineItemGroupHeader=e=>{if(this.showTableStore.state)return;const{collectionContextStore:t}=e,o=t.isCompactView.state,r=this.timelineState.outerSizeObserver.rect.state.width;return(0,b.jsx)("div",{style:{position:"sticky",left:0,width:r,height:Gn.Zn,zIndex:F.sL},children:(0,b.jsx)(Nt,{...e,style:{width:"100%",height:"100%",paddingLeft:this.props.isFullScreen?xp(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment):32,zIndex:void 0,transition:"background 200ms ease-in-out, border 200ms  ease-in-out",background:"transparent",borderBottom:"1px solid transparent"},getComputedStickyStyle:e=>function(e,t){return e?{background:t.contentBackground,boxShadow:`0 1px 0 ${t.tableDividerColor}`}:{background:"transparent",boxShadow:void 0}}(e&&!o,this.theme),preventToggleBackground:this.props.isInPeekRenderer})})},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderTimelineItemHiddenGroupsButton=e=>(0,b.jsx)(kp,{isFullScreen:this.props.isFullScreen,isRootChild:this.props.isRootChild,format:this.props.format,paddingLeft:this.props.paddingLeft,showTableStore:this.showTableStore,args:e}),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderTimelineAddGroupButton=e=>(0,b.jsx)(_p,{isFullScreen:this.props.isFullScreen,collectionContextStore:this.props.collectionContextStore,isRootChild:this.props.isRootChild,format:this.props.format,paddingLeft:this.props.paddingLeft,showTableStore:this.showTableStore,args:e}),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderTimelineGroupsLoadMoreButton=e=>(0,b.jsx)(Tp,{isFullScreen:this.props.isFullScreen,isRootChild:this.props.isRootChild,format:this.props.format,paddingLeft:this.props.paddingLeft,showTableStore:this.showTableStore,args:e}),this.renderRowDropzoneSelectableGroupResults=e=>{const{collectionContextStore:t,store:o,format:r,disabled:i}=this.props;return(0,b.jsx)(gu,{store:o,groupFormat:e,collectionContextStore:t,canEdit:this.canEditCollectionTimeline(),format:r,disabled:i&&this.canEditCollectionTimeline()})},this.handleHorizontalScroll=()=>{const{timelineState:e}=this,{horizontalScroller:t,savePreference:o}=e;if(!t)return;const r=t.scrollLeft,i=e.scrollLeft.state;this.environment.device.isIOS&&void 0!==i&&0===r&&i>Gn.lx?t.scrollLeft=i:(o&&o(),e.scrollLeft.setState(r),(0,Gn.rr)(this.environment)?this.resetWindowForScrollDebounced():this.resetWindowForScroll())},this.resetWindowForScroll=()=>{const{timelineState:e}=this,{horizontalScroller:t,outerSizeObserver:o}=e;if(!t)return;const r=e.zoomLevel.state,{startTimestamp:i,endTimestamp:n}=e.currentRange.state,s=t.scrollLeft,l=o.rect.state.width,a=(0,Gn.e$)(r,n-i),c=(0,Gn.al)(e);if(s<Gn.lx){const t=-(0,Gn.x2)(r,Gn.Ge);e.currentRange.setState({startTimestamp:i+t,endTimestamp:n+t}),Ec.Nf({timelineState:e,environment:this.environment,zoomLevel:r,centerTimestamp:c})}else if(s+l>a-Gn.lx){const t=(0,Gn.x2)(r,Gn.Ge);e.currentRange.setState({startTimestamp:i+t,endTimestamp:n+t}),Ec.Nf({timelineState:e,environment:this.environment,zoomLevel:r,centerTimestamp:c})}},this.resetWindowForScrollDebounced=N.Ds(this.resetWindowForScroll,200),this.handleWidthElMount=e=>{if(e){this.widthEl=e;const{timelineState:t}=this,{outerSizeObserver:o}=t;o.observe(e);const r=(0,Se.xH)(e);r&&(t.horizontalScroller=r,(0,ji.lj)(r,"scroll",this.handleHorizontalScroll),this.scrollToCenteredTimestamp())}},this.handleTimelineElMount=e=>{if(e){const{timelineState:t}=this,{timelineSizeObserver:o}=t;o.observe(e)}},this.scrollToCenteredTimestamp=()=>{const{timelineState:e}=this,{startTimestamp:t,endTimestamp:o}=e.currentRange.state;Ec.KA({timelineState:e,centerTimestamp:(t+o)/2})},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem=(e,t,o)=>function(e,t,o,r,i){!function(e,t,o,r,i){if(r.device.isMobile)se._c({environment:r,store:e,pageVisitSource:h.tY.Create});else{const{groupFormat:t}=o,n=t?[t]:[],s=i.groupsStore.getGroupState(n),l="collectionTypedView"===i.contextType;le.CH({environment:r,store:e,peekMode:ce.kr(i),showMoveTo:l,resultsStore:null==s?void 0:s.resultsStore,collectionContextStore:i,pageVisitSource:h.tY.Create})}}(e,0,o,r,i)}(e,0,o,this.environment,this.props.collectionContextStore),this.showTablePropertyFormatsStore=this.createComputedStore((()=>function(e,t){const o=wp(e,t);return o&&o.timeline_table_properties?o.timeline_table_properties:[]}(this.props.format,this.stores.tableStore).filter((e=>e.visible))),!0),this.tableWidthStore=this.createComputedStore((()=>this.showTableStore.state?this.showTablePropertyFormatsStore.state.reduce(((e,t)=>e+(t.width||0)),0):0)),this.scrollerLeftOffsetStore=this.createComputedStore((()=>(0,Gn.xI)({environment:this.environment,paddingLeft:xp(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment),format:this.props.format,isFullScreen:this.props.isFullScreen,isRootChild:this.props.isRootChild}))),this.scrollPixelWidthStore=this.createComputedStore((()=>{const{timelineState:e}=this,t=e.zoomLevel.state,{startTimestamp:o,endTimestamp:r}=e.currentRange.state;return(0,Gn.e$)(t,r-o)})),this.showTimelinePropertiesStore=this.createComputedStore((()=>{const{format:e}=this.props;return(e.timeline_properties||[]).filter((e=>{let{visible:t}=e;return t})).map((e=>{let{property:t}=e;return t}))})),this.showTableStore=this.createComputedStore((()=>{const{format:e,isFullScreen:t,isRootChild:o}=this.props;return(0,Gn.C1)({environment:this.environment,format:e,isFullScreen:t,isRootChild:o})})),this.canEditTimelineItemsStore=this.createComputedStore((()=>{const{query:e,schema:t}=this.props;return ce.D2({query:e,schema:t})})),this.isReady=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return e.groupsStore.anyGroupHasResults()})),this.getTimelineItemGroupStyle=e=>{const t=this.showTableStore.state,o=this.getGroupPaddingState(e);let r=0,i=0;return o.groupHeader&&t&&(r+=Gn.Zn-1),o.tableHeaderRow&&(r+=Gn.pe),o.tableEmptyRow&&(r+=bc),o.tableAggregationRow&&(i+=wc),o.hiddenGroupsButton&&t&&(i+=Ki+Ui),o.groupsLoadMoreButton&&t&&(i+=Ai+2*Hi),o.addGroupButton&&t&&(i+=Oi+Vi),o.groupPaddingBottom&&(i+=Gn.y1),o.extraGroupMarginBottom&&(i+=Gn.xd+1),{paddingTop:r,paddingBottom:i,minHeight:Gn.Zn,boxShadow:e.index>0&&(!t||o.tableHeaderRow)?`0 -1px 0 ${this.theme.tableDividerColor}`:void 0}},this.getRowDropzoneSelectableGroupStyle=e=>{if(!e)return{paddingTop:0,paddingBottom:0};const t=this.getGroupPaddingState(e);let o=0,r=0;return t.groupHeader&&(o+=Gn.Zn),t.tableHeaderRow&&(o+=Gn.pe),t.tableEmptyRow&&(o+=bc),t.addItemRow&&(r+=Fc.Z),t.loadMoreButton&&(r+=33),t.tableAggregationRow&&(r+=wc),t.hiddenGroupsButton&&(r+=Ki+Ui),t.groupsLoadMoreButton&&(r+=Ai+2*Hi),t.groupPaddingBottom&&(r+=Gn.y1),t.extraGroupMarginBottom&&(r+=Gn.xd),t.addGroupButton&&(r+=Oi+Vi),t.dropZoneSelectableGroupExtraBottomPadding&&(r+=1),{paddingTop:o,paddingBottom:r}}}get registries(){return super.registries.concat(Dc.Z)}UNSAFE_willMount(e){super.UNSAFE_willMount(e),this.timelineState=(0,Gn.Gz)({isFullScreen:e.isFullScreen,isRootChild:e.isRootChild});const{collectionContextStore:t}=e,o=t.collectionViewStore();o&&Ec.j2({timelineState:this.timelineState,environment:this.environment,collectionViewStore:o,collectionContextStore:t})}UNSAFE_willMountOrUpdate(e){super.UNSAFE_willMountOrUpdate(e);const{timelineState:t}=this,{query:o,collectionContextStore:r}=e;Qo.Z.state&&t.hoveredItem.setState(void 0);const i=r.collectionStore();i&&!o.timeline_by&&i.isDefined()&&function(e,t,o){const{schema:r}=e,i=t.permissionScopes.state,n=t.collectionStore();if(!n)return;const s=t.collectionViewStore();if(!s||!i.canConfigureBlock)return;const l=(0,B.defineMessages)({date:{id:"database.timelineView.dateProperty.defaultName",defaultMessage:"Date"}});ee.createAndCommit({userAction:"CollectionTimelineView.updateOrCreateTimelineProperty",environment:o,perform:e=>{let t,a=ce.HI(r);if(!a&&i.canConfigureCollection){a=(0,Ic.ZP)();t={[a]:{name:ho.default.formatMessage(l.date),type:"date"}}}pe.Es({collectionViewStore:s,update:{timeline_by:a},transaction:e}),Oo.sW({store:s,data:{type:"timeline"},transaction:e}),t&&pe.xO({environment:o,collectionStore:n,update:t,transaction:e})}})}(e,this.props.collectionContextStore,this.environment)}didMountOrUpdate(){super.didMountOrUpdate();const e=this.timelineState,{collectionContextStore:t,isFullScreen:o,isRootChild:r}=this.props;L.iR(this.environment,(0,Gn.Ii)({environment:this.environment,collectionContextStore:t,timelineState:e,isFullScreen:o,isRootChild:r}));const i=e.drawState.state;if(null!=i&&i.tryToCompleteDrawnArrow){(0,Gn.H5)(t)&&ee.createAndCommit({userAction:"TimelineItemDependencyDrawHandle.completeUserDrawnArrow",environment:this.environment,perform:i=>{Ec.$o({timelineState:e,environment:this.environment,transaction:i,collectionContextStore:t,isFullScreen:o,isRootChild:r})}})}}willUnmount(){super.willUnmount();const{timelineState:e}=this,{horizontalScroller:t,outerSizeObserver:o,timelineSizeObserver:r}=e;o.destroy(),r.destroy(),e.destroyed=!0,t&&(0,ji.ZV)(t,"scroll",this.handleHorizontalScroll)}customizeEdgeScrollRect(e){const t=this.scrollerLeftOffsetStore.state;return Lc.iL.from({top:e.top,height:e.height,left:e.left+t,width:e.width-t})}addBlockToView(e){const{store:t,transaction:o}=e,{collectionContextStore:r}=this.props,i=t.getAssociatedCollectionStore()??r.collectionStore();if(i)return Ec.Fv({environment:this.environment,store:t,timelineState:this.timelineState,query:this.props.query,collectionStore:i,collectionContextStore:this.props.collectionContextStore,groupFormat:void 0,transaction:o})}renderPersisted(){const{store:e,isInPeekRenderer:t,paddingRight:o,isFullScreen:r,isRootChild:i,query:n,schema:s,format:l,collectionContextStore:a,disabled:c}=this.props,{timeline_by:d}=n;if(!d)return(0,b.jsx)(vp,{collectionContextStore:this.props.collectionContextStore,isFullScreen:this.props.isFullScreen,paddingBottom:this.props.paddingBottom});const u=s[d];if(!u||!fe.Lt(u))return(0,b.jsx)(vp,{collectionContextStore:this.props.collectionContextStore,isFullScreen:this.props.isFullScreen,paddingBottom:this.props.paddingBottom});const{timelineState:p}=this,h=this.scrollerLeftOffsetStore.state,m=this.showTableStore.state,S=xp(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment),g=ce.az(a,r),C=l.collection_group_by,f=a.viewIsFlushToTopbar(),y=a.isCompactView.state,v=(0,rs.Z)((d=>(0,b.jsx)(Ni,{isFullScreen:r,renderEmitter:a.renderEmitter,children:(0,b.jsx)("div",{style:this.getStyle(m),className:fo.kDE,...d,children:(0,b.jsxs)(It.Z,{store:e,analyticsName:"timeline",shouldShowHalo:!r&&!y,canSelect:!r,style:y?{height:"100%"}:{},children:[(0,b.jsx)(nu,{timelineState:p}),(0,b.jsxs)("div",{style:{position:"absolute",width:"100%",zIndex:0,top:Gn.Ne},ref:this.handleTimelineElMount,children:[C?this.renderTimelineItemGroups(C):this.renderTimelineItemGroupResults(void 0),(0,b.jsx)(id,{timelineState:p,disabled:c,isReady:this.isReady.state,renderEmitter:a.renderEmitter,isFullScreen:r,isRootChild:i})]}),(0,b.jsx)(zd,{isInPeekRenderer:t,timelineState:p,query:n,schema:s,scrollerLeftOffset:h,collectionContextStore:a,showTable:m}),(0,b.jsx)(Vd,{timelineState:p,isInPeekRenderer:t,paddingLeft:S,paddingRight:!r&&i?8:o,format:l,scrollerLeftOffset:h,isFullScreen:r,isRootChild:i,showTable:m,collectionContextStore:a,isReady:this.isReady.state}),m&&this.renderTable(C,S),(0,b.jsx)("div",{style:{paddingTop:Gn.Ne,pointerEvents:"none"},children:C?this.renderRowDropzoneSelectableGroups(C):(0,b.jsx)("div",{style:this.getRowDropzoneSelectableGroupStyle(void 0),children:this.renderRowDropzoneSelectableGroupResults(void 0)})}),!g&&(0,b.jsx)(di.Z,{onChange:e=>function(e,t,o,r){const i=o.isLoading.state,n=o.groupsStore.getGroupState([]);if(!n)return;const s=n.reducerResultStore.state;e<vo.Z.incrementScrollOffset&&s&&!i&&s.hasMore&&Z.ID({collectionContextStore:o,environment:t,incrementLimitArgs:{isFullScreen:r,currentResultCount:s.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}(e,this.environment,this.props.collectionContextStore,this.props.isFullScreen)})]})})})));return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{ref:this.handleWidthElMount}),!f&&(0,b.jsx)("div",{style:{height:4}}),v]})}renderTable(e,t){const{store:o,isFullScreen:r,collectionContextStore:i}=this.props;return(0,b.jsx)("div",{style:{position:"sticky",left:0,height:0,width:this.tableWidthStore.state,zIndex:F.eU},children:(0,b.jsx)(It.Z,{style:this.getTableSelectableStyle(t),store:o,shouldShowHalo:!1,canSelect:!r,analyticsName:"timeline",children:e?this.renderTableGroups(e):(0,b.jsx)(Ni,{isFullScreen:r,ignoreAncestorContainer:!0,renderEmitter:i.renderEmitter,children:(0,b.jsx)("div",{children:this.renderTableGroupResults(void 0)})})})})}renderTableGroups(e){const{store:t,format:o,collectionContextStore:r,schema:i,disabled:n,isFullScreen:s,paddingLeft:l,isRootChild:a,isInPeekRenderer:c}=this.props;return(0,we.hJ)()?(0,b.jsx)(Xn,{reducerId:"timeline_groups",store:t,collectionContextStore:r,disabled:n,isFullScreen:s,isRootChild:a,paddingLeft:l,stickyLeft:!1,renderGroup:this.renderTableGroupResults,getGroupStyle:()=>({}),renderHeader:this.renderTableGroupHeader,onGroupHeaderAddItem:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem,timelineProps:{type:"table",reducerResultStore:this.stores.groupsReducerResultStore,hiddenGroupsVisible:this.stores.hiddenGroupsVisible}}):(0,b.jsx)(an,{store:t,id:"timeline_groups",groupBy:e,groupsFormatKey:re.Uh,groupAggregationKey:re.dQ,format:o,schema:i,collectionContextStore:r,disabled:n,isFullScreen:s,renderGroup:this.renderTableGroupResults,renderHeader:this.renderTableGroupHeader,onGroupHeaderAddItem:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem,hiddenGroupsVisible:this.stores.hiddenGroupsVisible,reducerResultStore:this.stores.groupsReducerResultStore,disableReducerRequest:!0,ignoreAncestorStickyContainer:!0,paddingLeft:l,isRootChild:a,isInPeekRenderer:c,shouldSurpressShimmer:!1})}renderTimelineItemGroups(e){const{store:t,format:o,collectionContextStore:r,schema:i,disabled:n,isFullScreen:s,paddingLeft:l,isRootChild:a,isInPeekRenderer:c}=this.props;return(0,we.hJ)()?(0,b.jsx)(Xn,{reducerId:"timeline_groups",store:t,collectionContextStore:r,disabled:n,isFullScreen:s,isRootChild:a,paddingLeft:l,stickyLeft:!1,renderGroup:this.renderTimelineItemGroupResults,getGroupStyle:this.getTimelineItemGroupStyle,renderHeader:this.renderTimelineItemGroupHeader,onGroupHeaderAddItem:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem,timelineProps:{type:"item",reducerResultStore:this.stores.groupsReducerResultStore,hiddenGroupsVisible:this.stores.hiddenGroupsVisible}}):(0,b.jsx)(an,{store:t,id:"timeline_groups",groupBy:e,groupsFormatKey:re.Uh,groupAggregationKey:re.dQ,format:o,schema:i,collectionContextStore:r,disabled:n,isFullScreen:s,renderGroup:this.renderTimelineItemGroupResults,onGroupHeaderAddItem:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem,hiddenGroupsVisible:this.stores.hiddenGroupsVisible,renderHeader:this.renderTimelineItemGroupHeader,getGroupStyle:this.getTimelineItemGroupStyle,reducerResultStore:this.stores.groupsReducerResultStore,renderHiddenGroupsButton:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderTimelineItemHiddenGroupsButton,renderAddGroupButton:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderTimelineAddGroupButton,renderGroupsLoadMoreButton:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderTimelineGroupsLoadMoreButton,paddingLeft:l,isRootChild:a,isInPeekRenderer:c,shouldSurpressShimmer:!0})}renderRowDropzoneSelectableGroups(e){const{store:t,format:o,collectionContextStore:r,schema:i,disabled:n,isFullScreen:s,paddingLeft:l,isRootChild:a,isInPeekRenderer:c}=this.props;return(0,we.hJ)()?(0,b.jsx)(Xn,{reducerId:"timeline_groups",store:t,collectionContextStore:r,disabled:n,isFullScreen:s,isRootChild:a,paddingLeft:l,stickyLeft:!1,renderGroup:this.renderRowDropzoneSelectableGroupResults,getGroupStyle:this.getRowDropzoneSelectableGroupStyle,renderHeader:()=>null,onGroupHeaderAddItem:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem,timelineProps:{type:"dropzone",reducerResultStore:this.stores.groupsReducerResultStore,hiddenGroupsVisible:this.stores.hiddenGroupsVisible}}):(0,b.jsx)(an,{store:t,id:"timeline_groups",groupBy:e,groupsFormatKey:re.Uh,groupAggregationKey:re.dQ,format:o,schema:i,collectionContextStore:r,disabled:n,isFullScreen:s,renderGroup:this.renderRowDropzoneSelectableGroupResults,onGroupHeaderAddItem:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem,hiddenGroupsVisible:this.stores.hiddenGroupsVisible,renderHeader:()=>null,getGroupStyle:this.getRowDropzoneSelectableGroupStyle,reducerResultStore:this.stores.groupsReducerResultStore,disableReducerRequest:!0,renderHiddenGroupsButton:()=>null,renderAddGroupButton:()=>null,renderGroupsLoadMoreButton:()=>null,paddingLeft:l,isRootChild:a,isInPeekRenderer:c,shouldSurpressShimmer:!0})}canEditCollectionTimeline(){const e=this.props.collectionContextStore.permissionScopes.state;return this.canEdit()&&e.canEditContent&&!e.isSyncedCollection}getGroupPaddingState(e){const{groupFormat:t,currentGroups:o,visibleGroups:r,hiddenGroups:i,total:n}=e,{collectionContextStore:s,isFullScreen:l,disabled:a,format:c}=this.props,{hiddenGroupsVisible:d}=this.stores,u=c.collection_group_by,p=this.showTableStore.state,h=s.groupsStore.getGroupState(t),m=Boolean(t&&!(null!=h&&h.toggleStateStore.state)),S=function(e,t,o,r){if(!e)return!0;const i=o.indexOf(e);return!t&&!o.find(((e,t)=>{if(t<i){const t=r.groupsStore.getGroupState([e]);return null==t?void 0:t.toggleStateStore.state}return!1}))}(t,m,o,this.props.collectionContextStore),g=null==h?void 0:h.reducerResultStore.state,C=ce.VM({collectionContextStore:s,reducerResult:g,isFullScreen:l}),f=t===i[i.length-1],y=t===r[r.length-1],v=r.length<n,x=d.state?f:y,b=s.permissionScopes.state,w=x&&!a&&b.canConfigureBlock&&u&&(0,re.Wz)(u,b.canConfigureCollection),k=g&&0===g.blockIds.length;return{groupHeader:Boolean(t&&(!p||!S)),tableHeaderRow:Boolean(p&&!m&&!S),tableAggregationRow:Boolean(p&&!m),addItemRow:Boolean(this.canEditCollectionTimeline()&&!m),hiddenGroupsButton:Boolean(y&&i.length>0),groupsLoadMoreButton:Boolean(y&&v),loadMoreButton:Boolean(!m&&C),groupPaddingBottom:Boolean(!m),tableEmptyRow:Boolean(p&&!m&&k),extraGroupMarginBottom:Boolean(p&&m),addGroupButton:Boolean(w),dropZoneSelectableGroupExtraBottomPadding:Boolean(!p)}}getStyle(e){const{isFullScreen:t,paddingBottom:o,collectionContextStore:r}=this.props,i=this.scrollPixelWidthStore.state,n=this.isReady.state,s=r.isCompactView.state;return{position:"relative",float:"left",minWidth:"100%",width:i,...s?{}:{background:this.props.isInPeekRenderer?this.theme.peekTimelineBackground:this.theme.timelineBackground},...!t&&!e&&!s&&{borderBottom:`1px solid ${this.theme.tableDividerColor}`},...(!n||s)&&{minHeight:150},...t&&{paddingBottom:o},height:s?"100%":this.getComputedOuterHeight()}}getTableSelectableStyle(e){const{collectionContextStore:t}=this.props,o=t.isCompactView.state;return{whiteSpace:"nowrap",...o?{}:{background:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground},paddingLeft:e,borderRight:`1px solid ${this.theme.tableDividerColor}`,boxShadow:this.theme.timelineTableBoxShadow,clipPath:"polygon(0% 0%, 120% 0%, 120% 100%, 0% 100%)",width:this.tableWidthStore.state+e+1,height:o?"100%":this.getComputedOuterHeight()}}getComputedOuterHeight(){const{device:e}=this.environment,{paddingBottom:t,isFullScreen:o}=this.props,{timelineSizeObserver:r}=this.timelineState,i=r.rect.state.height||120,n=this.showTableStore.state;return i+t+(o?0:72)+(!o&&n?28:0)+(o&&e.isMobile?72:0)}}fp.displayName="CollectionTimelineView";const yp=fp;function vp(e){let{collectionContextStore:t,isFullScreen:o,paddingBottom:r}=e;const i=(0,d.VK)((()=>t.permissionScopes.state.canConfigureBlock),[t]),n=t.settingsStore;return(0,b.jsx)(Nc,{collectionContextStore:t,title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"No date property",id:"database.timelineView.missingDatePropertyTitle"}),description:i?(0,b.jsx)(B.FormattedMessage,{defaultMessage:"<opensettingslink>Add a date property</opensettingslink> to your database in order to display a Timeline view.",id:"database.timelineView.missingDateProperty",values:{opensettingslink:e=>(0,b.jsx)(Bc,{onClick:()=>{z.r$({collectionContextStore:t,collectionSettingsStore:n}),z.H4({collectionSettingsStore:n,item:{type:"properties",timelineViewTab:"timeline"}})},children:e})}}):(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Timeline views require a date property in order to display.",id:"database.timelineView.missingDatePropertyNoPermissions"}),style:{paddingBottom:o?void 0:r}})}function xp(e,t,o,r,i){return function(e,t,o,r){return(0,Gn.fj)({environment:r,isRootChild:e,isFullScreen:t,format:o})}(e,t,o,i)?Gn.Qw:r}function bp(e,t,o){const r=t.viewIsFlushToTopbar();return 0!==e||r?{borderTop:`1px solid ${o.tableDividerColor}`}:{}}function wp(e,t){const{temporaryFormat:o}=t.state;return o||e}function kp(e){let{args:t,isFullScreen:o,isRootChild:r,format:i,paddingLeft:n,showTableStore:s}=e;const l=(0,a.O7)(),c=(0,d.VK)((()=>s.state),[s]),u=(0,d.VK)((()=>xp(r,o,i,n,l)),[r,o,i,n,l]);return c?null:(0,b.jsx)("div",{style:{width:"100%",height:Ki+Ui,display:"flex"},children:(0,b.jsx)(Wi,{...t,style:{position:"sticky",left:o?u:3,width:"max-content",paddingLeft:4,paddingRight:8}})})}function _p(e){let{args:t,isFullScreen:o,collectionContextStore:r,isRootChild:i,format:n,paddingLeft:s,showTableStore:l}=e;const c=(0,a.O7)(),u=(0,d.VK)((()=>l.state),[l]),p=(0,d.VK)((()=>r.contextType),[r]),h=(0,d.VK)((()=>xp(i,o,n,s,c)),[i,o,n,s,c]);return u||"collectionTypedView"===p?null:(0,b.jsx)("div",{style:{width:"100%",height:Oi+Vi,display:"flex"},children:(0,b.jsx)(Mi,{...t,style:{position:"sticky",left:o?h:3,width:"max-content",paddingLeft:4,paddingRight:8}})})}function Tp(e){let{args:t,isFullScreen:o,isRootChild:r,format:i,paddingLeft:n,showTableStore:s}=e;const l=(0,a.O7)(),c=(0,d.VK)((()=>s.state),[s]),u=(0,d.VK)((()=>xp(r,o,i,n,l)),[r,o,i,n,l]);return c?null:(0,b.jsx)("div",{style:{width:"100%",height:Ai+2*Hi,display:"flex"},children:(0,b.jsx)(zi,{...t,style:{position:"sticky",left:o?u:3,width:"max-content",paddingLeft:4,paddingRight:8}})})}var Op=o(9999),Vp=o(39567),Pp=o(44862);const Rp=function(e){const{store:t,titleStyle:o,actionButton:r,collectionContextStore:i}=e;return(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{style:{display:"flex"},children:[(0,b.jsx)(xu.Z,{store:t,style:o}),r]}),(0,b.jsx)(Pp.Z,{collectionStore:t,collectionContextStore:i})]})};var Mp=o(19987),jp=o(50627),Ip=o(89086);const Fp=(0,B.defineMessages)({titlePlaceholder:{defaultMessage:"Untitled",id:"database.source.titlePlaceholder"}});const Bp=function(e){let{store:t,collectionContextStore:o,isFullScreen:r,canEdit:i,showHoverActionsStore:n}=e;const s=(0,a.O7)(),l=(0,d.VK)((()=>{const e=Xo.default.state;return(0,ce.Ks)(t)||!(0,ce.en)(t)&&e.open&&e.isClosing}),[t]),c=(0,d.VK)((()=>{const e=o.collectionStore();if(!e)return!1;const t=e.getNameStore();return Boolean((0,Ip.J5)(t))}),[o]),u=(0,d.VK)((()=>o.collectionStore()),[o]),p=(0,d.VK)((()=>o.permissionScopes.state),[o]),h=(0,d.VK)((()=>o.collectionViewBlockStore()),[o]),m=(0,d.VK)((()=>{var e;return Boolean((null==u||null===(e=u.getParentBlockStore())||void 0===e?void 0:e.id)===(null==h?void 0:h.id))}),[u,h]),S=(0,d.VK)((()=>Boolean(null==u?void 0:u.isSyncedCollection())),[u]),{WindowSizeStore:g}=s,C=(0,d.VK)((()=>Math.min(jp.zL,g.state.width)),[g]);if(!u||!h)return null;const f=(m||c)&&p.canConfigureCollection&&!S;return(0,b.jsxs)("div",{style:{...(r||l)&&(0,Se.eA)(s)&&{position:"sticky",left:0},paddingTop:8,boxSizing:l?"content-box":void 0,width:l?C:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[f?(0,b.jsx)(Kp,{collectionContextStore:o,showHoverActionsStore:n}):(0,b.jsx)(Gp,{collectionContextStore:o,showHoverActionsStore:n}),S&&(0,b.jsx)("div",{style:{display:"flex"},children:(0,b.jsx)(Mp.Z,{canEdit:i,store:h,buttonStyle:{margin:0}})})]})};function Np(){return{fontWeight:D.Z.fontWeight.bold,fontSize:22}}function Dp(e){const t=e.collectionStore();if(!t)return;const o=t.getParentBlockStore();return o?(0,Ko.ZP)({store:o,fullyQualified:!1,pageVisitSource:h.tY.Breadcrumb}):void 0}function Lp(e){const t=e.collectionStore();if(!t)return 22;return t.isSyncedCollection()?58:22}function Ep(e,t){return{width:24,height:t?24:16,fill:e.regularIconColor}}function Ap(e){let{parent:t,collectionContextStore:o}=e;const r=(0,u.Fg)(),i=(0,a.O7)(),n=(0,d.VK)((()=>o.permissionScopes.state),[o]),s=(0,d.VK)((()=>o.collectionStore()),[o]),l=(0,d.VK)((()=>null==s?void 0:s.isSyncedCollection()),[s]);if(!s)return null;const c=N.oA([{key:"view",render:e=>(0,b.jsx)($e.Z,{...e,title:(0,b.jsx)(B.FormattedMessage,{id:"database.source.viewDatabase.title",defaultMessage:"View database"}),icon:(0,Op.J)(Ep(r))}),action:e=>{const r=Dp(o);if(!r)return null;const n=ji.DJ(e.event);ae.c4({environment:i,url:r,openInNew:n}),n||t.close(),E.wd({environment:i,collectionContextStore:o,action:"click_source_view"})}},n.canConfigureCollection&&!l&&{key:"edit_name",render:e=>(0,b.jsx)($e.Z,{...e,title:(0,b.jsx)(B.FormattedMessage,{id:"database.source.editTitle.title",defaultMessage:"Edit database title"}),icon:(0,bo.R)(Ep(r))}),action:()=>{J.mT({environment:i,store:s.getNameStore(),canSelectAllBlocks:!1}),t.close(),E.wd({environment:i,collectionContextStore:o,action:"click_source_edit_title"})}}]),p={key:"show_title",render:e=>(0,b.jsx)($e.Z,{...e,icon:(0,Tl.L)(Ep(r,!0)),title:(0,b.jsx)(B.FormattedMessage,{id:"database.source.hideTitle.title",defaultMessage:"Hide database title"})}),action:()=>{const e=o.collectionViewStore();if(!e)return null;ee.createAndCommit({userAction:"CollectionViewBlockSource.showTitleItem",environment:i,perform:t=>{Jt.FH({stores:[e],update:{hide_linked_collection_name:!0},transaction:t})}}),t.close(),E.wd({environment:i,collectionContextStore:o,action:"click_source_hide_title"})}};return(0,b.jsx)(Oe.Z,{type:Oe.i.Vertical,sections:N.oA([{key:"actions",render:e=>(0,b.jsx)(Pe.Z,{...e}),items:c},n.canConfigureBlock&&{key:"show_title",render:e=>(0,b.jsx)(Pe.Z,{...e,topBorder:!0}),items:[p]}]),initialFocus:void 0})}function Hp(e){let{showHoverActionsStore:t,collectionContextStore:o}=e;const r=(0,a.O7)(),i=(0,d.VK)((()=>t.state),[t]);return(0,b.jsx)(Ds.Z,{isVisible:!0,animationStyle:{opacity:i?1:0},render:()=>(0,b.jsx)("div",{style:{display:"flex",alignItems:"center",marginLeft:4},children:(0,b.jsx)(qe.ZP,{popupType:r.device.isMobile?Ye.kQ.SlideUp:Ye.kQ.Popup,render:e=>(0,b.jsx)(Ap,{parent:e,collectionContextStore:o}),renderOrigin:e=>(0,b.jsx)(jt.Z,{icon:ue.o,...e}),style:{width:240},originGap:4})})})}function Zp(e){Y.ZH(e)}function zp(e){let{disabled:t,collectionContextStore:o}=e;const r=(0,u.Fg)(),i=(0,a.O7)(),n=(0,d.VK)((()=>o.collectionStore()),[o]),s=(0,d.VK)((()=>o.collectionViewBlockStore()),[o]),l=(0,d.VK)((()=>null==n?void 0:n.getIcon()),[n]),c=(0,d.VK)((()=>{var e;return Boolean((null==n||null===(e=n.getParentBlockStore())||void 0===e?void 0:e.id)===(null==s?void 0:s.id))}),[n,s]),p=(0,d.VK)((()=>Lp(o)),[o]),h=(0,d.VK)((()=>function(e){return{width:Lp(e),height:Lp(e),marginRight:4}}(o)),[o]),m=(0,d.VK)((()=>null==s?void 0:s.getType()),[s]);return n&&s?l?(0,b.jsxs)("div",{style:{position:"relative",width:p+2,height:p+2,marginRight:4},children:[t?(0,b.jsx)(Do.Z,{disabled:!0,bucket:"secure",store:n,icon:l,isEmptyPage:!1,style:h,size:p}):(0,b.jsx)(Do.Z,{disabled:!1,bucket:"secure",store:n,icon:l,isEmptyPage:!1,style:h,size:p,iconLoggingData:{recordTable:n.table,source:"inline_collection",block_type:m,collection_id:n.id},onChange:e=>function(e,t,o){const r=o.collectionStore();if(!r)return;const i=r&&r.getIconStore();i&&ee.createAndCommit({userAction:"CollectionViewBlockSource.handleRecordIconChange",environment:t,perform:t=>{Oo.sO({store:i,value:e,transaction:t})}})}(e,i,o)}),!c&&(0,Vp.Y)({position:"absolute",width:"50%",height:"50%",right:0,bottom:0,fill:"dark"===r.mode?r.regularTextColor:"#3E3C38",stroke:"dark"===r.mode?r.sidebarBackground:"white",strokeWidth:"dark"===r.mode?"1.85px":"1.5px"})]}):c?null:(0,b.jsx)("div",{style:{width:20,marginRight:4},children:(0,Op.J)({width:20})}):null}function Gp(e){let{collectionContextStore:t,showHoverActionsStore:o}=e;const r=(0,a.O7)(),i=(0,d.VK)((()=>t.collectionStore()),[t]),n=(0,d.VK)((()=>t.collectionViewBlockStore()),[t]),s=(0,d.VK)((()=>Dp(t)),[t]);return i&&n?(0,b.jsxs)(No.Z,{style:{width:"max-content",maxWidth:"100%",marginRight:4,...D.Z.textOverflowStyle},innerStyle:{paddingLeft:4,paddingRight:4,display:"flex",alignItems:"center",borderRadius:4},href:s,onClick:()=>function(e,t){E.wd({environment:e,collectionContextStore:t,action:"click_collection_name_link_button"})}(r,t),children:[(0,b.jsx)(zp,{collectionContextStore:t,disabled:!0}),(0,b.jsx)(Rp,{actionButton:(0,b.jsx)(Hp,{showHoverActionsStore:o,collectionContextStore:t}),store:i,collectionContextStore:t,titleStyle:Np()})]}):null}function Kp(e){let{collectionContextStore:t,showHoverActionsStore:o}=e;const r=(0,a.O7)(),i=(0,d.VK)((()=>t.collectionStore()),[t]),n=(0,d.VK)((()=>t.collectionViewBlockStore()),[t]),s=(0,d.VK)((()=>null==i?void 0:i.getNameStore()),[i]);return i&&n&&s?(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",marginLeft:4,marginRight:4},children:[(0,b.jsx)(zp,{collectionContextStore:t,disabled:!1}),(0,b.jsx)(Eo.Z,{store:s,style:{...Np(),marginRight:4},disabled:!1,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableMobileActionBar:!1,disableComment:!0,placeholder:ho.default.formatMessage(Fp.titlePlaceholder),onEnter:()=>Zp(r),onEsc:()=>Zp(r),onClick:()=>function(e,t){E.wd({environment:e,collectionContextStore:t,action:"click_collection_name_input"})}(r,t),disableShiftEnter:!0,pasteBehavior:"inline",inPageFind:{type:"none"}}),(0,b.jsx)(Hp,{showHoverActionsStore:o,collectionContextStore:t})]}):null}var Up=o(57820),Wp=(o(52262),o(24506),o(38297)),$p=o(45953),qp=o(56518);const Qp=new(o(53809).D)({key:"notion/async_clipboard_store",namespace:"AsyncClipboardStore",important:!0,trackingType:"necessary"});async function Yp(e,t){let{lastActionWasCut:o,valuePromise:r}=t;const i=(0,qp.tt)(e);Qp.setState({eventId:i,waitingForCopy:!0,lastActionWasCut:void 0,value:void 0});const n=await r;if(!n)return void Qp.setState({});const{recordMaps:s,...l}=n;Qp.setState({eventId:i,waitingForCopy:!1,lastActionWasCut:o,value:{...l,recordMapsJson:eh(s)}})}function Xp(e){const t=Qp.getState(),o=(0,qp.tt)(e);if(!t||!o||t.eventId!==o)return Promise.resolve(void 0);const{waitingForCopy:r,value:i,lastActionWasCut:n}=t;return r?new Promise((e=>{Qp.addListener(function(e,t){return function o(r){const i=r.getState();if(!i)return void r.removeListener(o);const{waitingForCopy:n,value:s,lastActionWasCut:l}=i;n||i.eventId!==e||(r.removeListener(o),t(s?{lastActionWasCut:l||!1,value:{...s,recordMaps:Jp(s.recordMapsJson)}}:void 0))}}(o,e))})):i?Promise.resolve({lastActionWasCut:n||!1,value:{...i,recordMaps:Jp(i.recordMapsJson)}}):Promise.resolve(void 0)}function Jp(e){return new Map(e.map((e=>{let[t,o]=e;return[t,$p.Ak.create(o)]})))}function eh(e){return[...e.entries()].map((e=>{let[t,o]=e;return[t,o.toJson({allowVersionDowngrade:!1})]}))}var th=o(893),oh=o(30188),rh=o(54532),ih=o(79978),nh=o(42858),sh=o(58202);function lh(){const e=(0,a.O7)(),t=(0,tn.Y$)(),{value:o}=(0,Ya.useDependency)(Ya.deps.markdownLinkifyIt),{value:r}=(0,Ya.useDependency)(Ya.deps.tinyMceMicrosoftWordPasteFilter),n=(0,d.VK)((()=>{var e;const o=Jo.default.state.stores.filter((e=>sh.R.findBlockFromStore(e))).at(0),r=null==o?void 0:o.getModel();if(!o||!r)return!1;const i=(0,Wp.ky)({block:r,getRecordModel:o.getRecordModel});return!!i&&i.id===(null===(e=t.collectionStore())||void 0===e?void 0:e.id)}),[t]),s=i.useCallback((r=>{th.JG({event:r,environment:e,markdownLinkifyIt:o});const i=Jo.default.state.stores;Yp(r,{lastActionWasCut:!1,valuePromise:ah(e).then((o=>{for(const i of o){var r;L.dh(e,{analyticsName:"Copy",from:"keyboard_shortcut",block_id:i.id,block_type:i.getType(),isBulk:!0,collection_id:null===(r=t.collectionStore())||void 0===r?void 0:r.id})}const n=o.length>0;for(const l of i){var s;L.dh(e,{analyticsName:"Copy",from:"keyboard_shortcut",block_id:l.id,block_type:l.getType(),isBulk:n,collection_id:null===(s=t.collectionStore())||void 0===s?void 0:s.id})}return ch({environment:e,subitems:o})}))})}),[t,e,o]),c=i.useCallback((async r=>{th.JG({event:r,environment:e,markdownLinkifyIt:o});const i=Jo.default.state.stores,n=ah(e),s=ah(e).then((o=>{for(const i of o){var r;L.dh(e,{analyticsName:"Cut",from:"keyboard_shortcut",block_id:i.id,block_type:i.getType(),isBulk:!0,collection_id:null===(r=t.collectionStore())||void 0===r?void 0:r.id})}const n=o.length>0;for(const l of i){var s;L.dh(e,{analyticsName:"Cut",from:"keyboard_shortcut",block_id:l.id,block_type:l.getType(),isBulk:n,collection_id:null===(s=t.collectionStore())||void 0===s?void 0:s.id})}return ch({environment:e,subitems:o})}));await Yp(r,{lastActionWasCut:!0,valuePromise:s});const l=Jo.default.getState().stores,a=await n;await oh.VP({blocks:l,subitems:a,environment:e,canUndo:!0,skipConfirmation:!0})}),[t,e,o]),u=i.useCallback((async i=>{var n,s,a,c;const d=await Xp(i);if(Qp.setState({...Qp.getState(),lastActionWasCut:!1}),!d){var u;const n=Jo.default.state.stores[0];return ee.createAndCommit({userAction:"CollectionViewKeyboardArea.defaultPaste",environment:e,perform:t=>{th.v({environment:e,event:i,disableEmbedMenu:!0,transaction:t,onPasteFiles:th.AL,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:r})}}),void L.dh(e,{analyticsName:"Paste",from:"keyboard_shortcut",block_id:n.id,block_type:n.getType(),isBulk:!1,collection_id:null===(u=t.collectionStore())||void 0===u?void 0:u.id})}const p=t.collectionViewBlockStore();if(!p)return;const h=t.collectionStore();if(!h)return;const{recordMaps:m,subitemFormat:S,childRelationSchema:g,parentRelationSchema:C}=d.value;if(!(m&&S&&g&&C))return;const f=[...m.entries()].map((e=>{let[t]=e;return ge.G.createChildStore(h,{table:M.iU,id:t})}));await Promise.all(f.map((e=>e.load())));const y=Jo.default.getState().stores,v=!(d.lastActionWasCut&&function(e,t){const o=t.map((t=>ge.G.createChildStore(e,t.pointer)));if(o.find((e=>!e.isReady)))return!1;return!o.find((e=>e.getAlive()))}(h,f));let x=[],b=Go.JR(t),w=null===(n=b)||void 0===n?void 0:n.parentRelationProperty,k=null===(s=b)||void 0===s?void 0:s.childRelationSchema,_=null===(a=b)||void 0===a?void 0:a.parentRelationSchema,T=null===(c=b)||void 0===c?void 0:c.subitemFormat;const O=t.permissionScopes.state.canConfigureCollection;for(const o of f){var V;L.dh(e,{analyticsName:"Paste",from:"keyboard_shortcut",block_id:o.id,block_type:o.getType(),isBulk:d.value.isBulk,collection_id:null===(V=t.collectionStore())||void 0===V?void 0:V.id})}if(ee.createAndCommit({userAction:"CollectionViewKeyboardArea.pasteWithSubitems",environment:e,perform:n=>{if(!T&&O){oh.Bb({transaction:n,collectionContextStore:t,environment:e})&&(b=Go.JR(t),b&&(w=b.parentRelationProperty,k=b.childRelationSchema,_=b.parentRelationSchema,T=b.subitemFormat))}if(!(w&&k&&_&&T))return void th.v({environment:e,event:i,disableEmbedMenu:!0,transaction:n,onPasteFiles:th.AL,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:r});const s=v?oh.R2({blocks:f,environment:e,transaction:n,recordMaps:m,migrateSubitemFormat:{from:S,to:T},collectionContextStore:t,originalSubitemSchemas:{subitemRelationSchema:g,parentRelationSchema:C},analyticsFrom:d.lastActionWasCut?"cut":"copy"}):oh.cI({blocks:f,transaction:n,from:S,to:T,environment:e,originAction:"paste"});!function(e){const{environment:t,selectedBlocks:o,blocksToInsert:r,subitemFormat:i,collectionContextStore:n,transaction:s}=e,l=n.collectionStore();if(!l)return;const a=o.at(-1),c=Go.qb(r,i);if(0===c.length)return;if(a){const e=Go.nK(n,a),o=function(e,t){if(e)return t;if(t.recordStoreUIParentStore instanceof ge.G&&t.recordStoreUIParentStore.isPageBlock())return t.recordStoreUIParentStore}(Boolean(null==e?void 0:e.isExpanded),a);c.forEach((e=>{oh.Cz({environment:t,block:e,collectionStore:l,subitemFormat:i,transaction:s}),o&&ih.hE({environment:t,sourceStore:e,destStore:o,propertyWithInverse:{property:i.inverse,inverse:i.property},transaction:s,position:{type:"after"}})}))}else c.forEach((e=>{oh.Cz({environment:t,block:e,collectionStore:l,subitemFormat:i,transaction:s})}))}({environment:e,selectedBlocks:y,blocksToInsert:s,subitemFormat:T,collectionContextStore:t,transaction:n}),nh.is({environment:e,blocks:s,selection:y,transaction:n,replaceEmptyTextBlock:!1,preventSetSelection:!0}),x=s}}),!(w&&k&&_&&T))return;const P=Go.T2({blocks:x,parentRelationProperty:w,parentRelationSchema:_,collectionViewBlockStore:p});l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{Y.Z5({environment:e,stores:P})}))}))}),[t,e,o,r]);return(0,b.jsx)(Bo.Z,{debugName:"CollectionViewKeyboardArea",capture:n,onCopy:s,onCut:c,onPaste:u})}function ah(e){const t=Jo.default.getState().stores;return oh.xr({environment:e,blocks:t})}function ch(e){let{subitems:t,environment:o}=e;const r=Jo.default.getState().stores,i=r.at(0);if(!i)return;const n=(0,Go.g0)(i);if(!n)return;const s=[...r,...t],l=N.oA(s.map((e=>{const t=rh.K8(o,{blockId:e.id,inMemoryRecordCache:e.inMemoryRecordCache,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0});return t&&[e.id,t]}))),a=new Map(l),{subitemFormat:c,childRelationSchema:d,parentRelationSchema:u}=n;return{recordMaps:a,subitemFormat:c,childRelationSchema:d,parentRelationSchema:u,isBulk:t.length>0}}var dh=o(80503);var uh=o(68641),ph=o(31194);class hh extends s.Z{constructor(){super(...arguments),this.storeTypes={placementStore:p.default.createClass(void 0),headerRectStore:p.default.createClass(void 0),shouldScrollIntoViewStore:p.default.createClass(!1)},this.lastPlacement=void 0,this.justOpened=!1,this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderMenu=e=>(0,b.jsx)(gh,{collectionContextStore:this.props.collectionContextStore,shouldScrollIntoViewStore:this.stores.shouldScrollIntoViewStore,isSidebar:e}),this.sidebarLayoutStore=this.createComputedStore((()=>{const e=this.props.headerSizeObserver.rect.state,t=this.environment.WindowSizeStore.state.height,o=e.height-40;return{maxHeight:t-(e.top+40),moveUp:o}}))}UNSAFE_willMountOrUpdate(e){const{collectionContextStore:t,overridePlacement:o}=e,r=Sh(this.props.collectionContextStore),i=this.stores.placementStore.state;r&&!i&&this.props.headerSizeObserver.recompute();const n=this.props.headerSizeObserver.rect.state;if(r&&!i&&0!==n.width){const e=(0,uh.F4)(this.props.collectionContextStore,this.environment.device.isMobile,n.width,o);this.stores.placementStore.setState(e),this.justOpened=!0,this.lastPlacement=e}else this.justOpened=!1;r||this.stores.placementStore.setState(void 0),this.justOpened&&(!t.isFullScreen.state&&"popup"!==this.stores.placementStore.state||Xo.default.isSidePeekOpen())&&this.stores.shouldScrollIntoViewStore.setState(!0)}didMountOrUpdate(){const{collectionContextStore:e}=this.props,{shouldScrollIntoViewStore:t}=this.stores;if(t.state){const o=e.collectionViewBlockStore();if(o){const t=sh.R.findCollectionViewBlockFromStore(o);if(t){const o=t.getNode();if(o){const t=o.getBoundingClientRect(),r=this.environment.WindowSizeStore.state.height-t.bottom,i=t.top;(r<Os.j9||i<dh.Aj||e.isInPeekRenderer.state)&&((0,Se.Wr)(o,{edgeDist:0,animate:!1}),this.props.headerSizeObserver.recompute())}}}t.setState(!1)}}renderComponent(){const{paddingRight:e,collectionContextStore:t,marginTop:o=-1}=this.props,r=Sh(this.props.collectionContextStore),i=this.lastPlacement,n=t.isFullScreen.state,s=t.viewIsFlushToTopbar(),l=function(e){var t;const o=null===(t=e.collectionViewStore())||void 0===t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}(this.props.collectionContextStore),a=("timeline"===l||"table"===l)&&s;if(i){if("sidebar"===i){const t=this.sidebarLayoutStore.state;if(!t)return;const{maxHeight:o,moveUp:i}=t;return(0,b.jsx)(Ds.Z,{isVisible:r,enterAnimationStyle:{opacity:0,translateX:12},animationStyle:{opacity:1,translateX:0},exitAnimationStyle:{opacity:0,translateX:12},render:()=>(0,b.jsx)(bd.Z,{capture:r,allowMobileAutoScroll:!0,allowUndo:!0,render:t=>(0,b.jsx)("div",{style:{position:"absolute",top:(a?1:0)-i,right:-e,height:`calc(100% + ${i}px)`,background:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground,borderLeft:`1px solid ${this.theme.tableDividerColor}`,paddingRight:e,zIndex:F.Nm,...n&&{height:o},...!n&&{maxHeight:o}},className:fo.Dkf,...(0,Ze.Z)({onMouseDown:e=>{return t=e,o=this.environment,void(0,me.ZP)({event:t,context:me.Af.EditorMouseDown,callback:()=>{J.ZH(o)}});var t,o}},t),children:(0,b.jsxs)("div",{style:{display:"flex",height:"100%"},children:[(0,b.jsx)("div",{style:{boxShadow:`0 -1px 0 ${this.theme.tableDividerColor}`},children:(0,b.jsx)(gh,{collectionContextStore:this.props.collectionContextStore,shouldScrollIntoViewStore:this.stores.shouldScrollIntoViewStore,isSidebar:!0})}),(0,b.jsx)("div",{style:{width:e}})]})})})})}return(0,b.jsx)(Ye.ZP,{popupType:this.environment.device.isMobile?Ye.kQ.SlideUp:Ye.kQ.Popup,open:r,placementToOrigin:ph.Iw.Bottom,alignmentToOrigin:ph.lU.End,style:{marginTop:o},origin:(0,b.jsx)("div",{}),render:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderMenu,onDismiss:e=>function(e,t){(0,me.ZP)({event:e,context:me.Af.CollectionSettingsClick,callback:()=>{z.E3({collectionSettingsStore:t.settingsStore})}})}(e,this.props.collectionContextStore),originRect:this.props.headerSizeObserver.rect.state,keepFocus:!0,trapFocus:!0})}}}hh.displayName="CollectionViewSettingsPopup";const mh=(0,B.injectIntl)(hh);function Sh(e){const t=e.settingsStore.state;return t.open&&!0!==t.hideSettingsPopup}function gh(e){let{isSidebar:t,collectionContextStore:o,shouldScrollIntoViewStore:r}=e;const i=(0,d.VK)((()=>r.state),[r]),n=(0,d.VK)((()=>o.isCompactView.state),[o]);return i?null:(0,b.jsx)(_s.P,{context:uh.HV.ViewSettings,collectionContextStore:o,collectionSettingsStore:o.settingsStore,fullHeight:t,hideDesktopHeader:n})}var Ch=o(78454);function fh(e){const{origin:t}=e,o=(0,a.O7)();return(0,b.jsx)(ll.U,{origin:t,placementToOrigin:"bottom",header:(0,b.jsx)(B.FormattedMessage,{id:"WikiHomeOnboardingTooltip.header",defaultMessage:"Welcome to your new wiki!"}),content:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Viewers will have the same reading experience as before, but editors have new features to keep content up to date",id:"WikiHomeOnboardingTooltip.content"}),onCloseClick:()=>{Xs.Rg(o)},shouldDismissUponOutsideClick:!0,pointerPosition:"18%",pointerLength:dl.EZ,pointerOffset:dl.rK,style:{width:dl.G5}})}function yh(e){const{origin:t}=e,o=(0,a.O7)();return(0,b.jsx)(ll.U,{origin:t,placementToOrigin:"right",header:(0,b.jsx)(B.FormattedMessage,{id:"WikiViewsOnboardingTooltip.header",defaultMessage:"New views"}),content:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"The <bold>All pages</bold> and <bold>Pages I own</bold> views will give you an overview of pages in your wiki",id:"WikiViewsOnboardingTooltip.content",values:{bold:e=>(0,b.jsx)("span",{style:{fontWeight:D.Z.fontWeight.semibold},children:e})}}),onCloseClick:()=>{Xs.Rg(o)},pointerPosition:"50%",pointerLength:dl.EZ,pointerOffset:dl.FD,shouldDismissUponOutsideClick:!0,style:{width:dl.G5}})}var vh=o(28020);let xh;class bh{constructor(e){this.style=void 0,this.lastResult=void 0,this.style=e.style}measure(e){var t;if(e===(null===(t=this.lastResult)||void 0===t?void 0:t.text))return this.lastResult.rect;xh||(xh=document.createElement("div"),xh.style.position="absolute",xh.style.left="0",xh.style.top="0",xh.style.pointerEvents="none",xh.style.opacity="0",document.body.appendChild(xh)),N.M6(this.style,((e,t)=>{xh&&(xh.style[t]=e)})),xh.textContent=e;const o=xh.getBoundingClientRect();return this.lastResult={text:e,rect:o},o}}var wh=o(77794),kh=o(20616),_h=o(13401),Th=o(73657),Oh=o(68894),Vh=o(29798),Ph=o(17215),Rh=o(14976),Mh=o(55964),jh=o(27714),Ih=o(53470),Fh=o(94841);const Bh={svgIcon:{width:24,height:16},svgIconPadded:{width:24,height:24}};function Nh(e){let{collectionViewStore:t,collectionContextStore:o,onClose:r}=e;const i=(0,a.O7)(),n=(0,B.useIntl)(),s=(0,d.VK)((()=>function(e){let{collectionViewStore:t,collectionContextStore:o,onClose:r,environment:i,intl:n,styles:s}=e;const l=o.permissionScopes.state,a=o.collectionViewStore(),c=o.collectionViewBlockStore();if(!a||!c)return[];const d=(0,Fh.Kj)(c.id),u=(0,vh.qG)(c.id),p=a.id===t.id,h=t.getAppConfigUri(),m=!(h&&(0,oe.xB)(h)||d&&!u),S=!d,g=!d,C=[];if(C.push([]),l.canConfigureBlock){if(C[0].push({key:"rename",render:e=>(0,b.jsx)(Xe.ZP,{placement:Xe.ug.Left,disableTooltip:m,render:t=>(0,b.jsx)($e.Z,{...e,disabled:!m,disabledFeedback:!0,title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Rename",id:"database.viewSettings.viewActionMenu.rename"}),icon:(0,Ih.H)(s.svgIcon),...t}),renderTooltip:()=>(0,b.jsx)(B.FormattedMessage,{id:"database.viewSettings.viewActionMenu.cannotRename",defaultMessage:"This view can’t be renamed."})}),action:()=>{E.wd({environment:i,collectionContextStore:o,action:"view_action_menu_rename"}),null==r||r(!0),p||pe.f8({environment:i,collectionContextStore:o,collectionViewId:t.id,isFullScreen:o.isFullScreen.state,isRootChild:o.isRootChild.state,isInPeekRenderer:o.isInPeekRenderer.state}),z.r$({collectionContextStore:o,collectionSettingsStore:o.settingsStore,selectViewNameInitial:!0})}}),"page"===t.getType())return C;C[0].push({key:"edit",render:e=>(0,b.jsx)($e.Z,{...e,title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Edit view",id:"database.viewSettings.viewActionMenu.editView"}),icon:(0,Rl.W)(s.svgIcon)}),action:()=>{E.wd({environment:i,collectionContextStore:o,action:"view_action_menu_edit"}),null==r||r(!0),p||pe.f8({environment:i,collectionContextStore:o,collectionViewId:t.id,isFullScreen:o.isFullScreen.state,isRootChild:o.isRootChild.state,isInPeekRenderer:o.isInPeekRenderer.state}),z.r$({collectionContextStore:o,collectionSettingsStore:o.settingsStore})}})}C.push([]),C[1].push({key:"copyLink",render:e=>(0,b.jsx)($e.Z,{...e,title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Copy link to view",id:"database.viewSettings.viewActionMenu.copyLink"}),icon:(0,jh.N)(s.svgIcon)}),action:async()=>{E.wd({environment:i,collectionContextStore:o,action:"view_action_menu_copy_link"}),await z.Ol({environment:i,collectionContextStore:o,collectionViewStore:t}),null==r||r(!1)}});const f=t.getFormat().hide_linked_collection_name;f&&l.canConfigureBlock&&C[1].push({key:"showDatabaseTitle",render:e=>(0,b.jsx)($e.Z,{...e,title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Show database title",id:"database.viewSettings.viewActionMenu.showDatabaseTitle"}),icon:(0,Mh.N)(s.svgIconPadded)}),action:()=>{E.wd({environment:i,collectionContextStore:o,action:"click_source_show_title"}),ee.createAndCommit({userAction:"CollectionViewActionMenu.getMenuSections",environment:i,perform:e=>{Jt.FH({stores:[t],update:{hide_linked_collection_name:!1},transaction:e})}}),null==r||r(!1)}});C.push([]),l.canConfigureBlock&&S&&C[2].push({key:"duplicate",render:e=>(0,b.jsx)($e.Z,{...e,title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Duplicate",id:"database.viewSettings.viewActionMenu.duplicate"}),icon:(0,_l.a)(s.svgIcon)}),action:()=>{E.wd({environment:i,collectionContextStore:o,action:"view_action_menu_duplicate"}),z.zt({environment:i,collectionContextStore:o,collectionViewStore:t,collectionSettingsStore:o.settingsStore,intl:n}),null==r||r(!0)}});l.canConfigureBlock&&g&&C[2].push({key:"delete",render:e=>(0,b.jsx)($e.Z,{...e,title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Delete",id:"database.viewSettings.viewActionMenu.delete"}),icon:(0,O.y)(s.svgIcon),isRedOnHover:!0}),action:async()=>{E.wd({environment:i,collectionContextStore:o,action:"view_action_menu_delete"});await z.TT({environment:i,collectionContextStore:o,collectionViewStore:t,collectionSettingsStore:o.settingsStore,from:"view_action_menu"})&&(null==r||r(!1))}});return C}({collectionViewStore:t,collectionContextStore:o,onClose:r,environment:i,intl:n,styles:Bh})),[o,t,i,n,r]);return(0,b.jsx)(Oe.Z,{type:Oe.i.Vertical,initialFocus:void 0,sections:N.oA(s.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>(0,b.jsx)(Pe.Z,{...e,topBorder:0!==t}),items:e}})))})}const Dh=i.memo(Nh,po.Z);var Lh=o(68155);function Eh(e){const{collectionContextStore:t,collectionViewStore:o,menuListItemProps:r,onClose:i}=e,{device:n}=(0,a.O7)(),s=(0,u.yK)((e=>({tooltipMessage:{color:e.mediumInvertedTextColor}})),[]),l=(0,B.useIntl)(),c=(0,d.qz)(void 0,mo.Z),[p,h,m,S,g,C]=(0,d.VK)((()=>[o.getName(),o.getType(),o.getFormat().collection_view_icon,o.getFormat().description,t.collectionStore(),t.permissionScopes.state.canConfigureBlock]),[o,t]);if(void 0===h)return null;const f=e=>{c.setState({open:!1}),e&&i()},y=()=>{const t=n.isMobile?{menuType:ke.og.ActionSheet}:{menuType:ke.og.Popup,width:220};return(0,b.jsx)(Te.Z,{...t,children:(0,b.jsx)(Dh,{...e,onClose:f})})},v=()=>{if(C)return(0,b.jsx)(qe.ZP,{popupType:n.isMobile?qe.Z4.SlideUp:qe.Z4.Popup,renderOrigin:e=>(0,b.jsx)(jt.Z,{icon:ue.o,ariaLabel:l.formatMessage({id:"collectionViewSelectItem.viewSettings.ariaLabel",defaultMessage:"Database view settings"}),...e}),render:y,buttonPopupStore:c})};return(0,b.jsx)(Xe.ZP,{renderTooltip:e=>(0,b.jsxs)("div",{...e,style:fl.F6,children:[(0,b.jsx)("div",{children:(0,ce.Cc)({collectionViewName:p,collectionViewType:h})}),void 0!==g&&(0,b.jsx)("div",{style:s.tooltipMessage,children:S||(0,b.jsx)(B.FormattedMessage,{defaultMessage:"{viewType, select, Table {Table view of {collection}} Board {Board view of {collection}} Timeline {Timeline view of {collection}} Calendar {Calendar view of {collection}} List {List view of {collection}} Gallery {Gallery view of {collection}} other {collection}}",id:"collectionTabBar.viewTab.tooltip",values:{viewType:yo.Bh[h],collection:(0,Rh.Xh)(g.getName(),g)||(0,Ph.Q2)(l)}})})]}),placement:As.u.Left,render:e=>(0,b.jsx)($e.Z,{title:(0,b.jsx)(Lh.Z,{collectionViewType:h,collectionViewName:p}),icon:(0,b.jsx)(kh.F,{color:"regular",viewIcon:m,viewType:h}),showDragHandle:!n.isMobile&&C,right:v(),rightStyle:{marginRight:8},...(0,Ze.Z)(e,r)})})}Eh.displayName="CollectionViewSelectItem";var Ah=o(24248);class Hh extends s.Z{constructor(){super(...arguments),this.initialMenuListFocus=0,this.storeTypes={menuListStore:Vh.Z,viewFilterQueryStore:p.default.createClass("")},this.renderViewsSection=e=>{if(t=this.environment,o=this.props.collectionContextStore,r=this.stores.viewFilterQueryStore,function(e,t){const o=e.permissionScopes.state,{device:r}=t;return!r.isMobile&&o.canConfigureBlock}(o,t)&&""===r.state){const t=this.getFilteredViewStores().map((e=>e.id));return(0,b.jsx)(Pe.Z,{...e,children:(0,b.jsx)(Js.ZP,{direction:"vertical",keys:t,renderKey:o=>e.children[t.indexOf(o)],onDrop:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleViewsDrop})})}return(0,b.jsx)(Pe.Z,{...e});var t,o,r},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleViewsDrop=e=>function(e,t,o,r){const i=o.collectionViewBlockStore();if(!i)return;ee.createAndCommit({userAction:"CollectionViewSelect2.handleViewsDrop",environment:t,perform:t=>{pe.Wu({collectionViewBlockStore:i,newViewIds:e,transaction:t})}}),r.reset()}(e,this.environment,this.props.collectionContextStore,this.stores.menuListStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleViewFilterQueryChange=e=>function(e,t,o){o.setState(e.target.value),t.setState({...t.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}(e,this.stores.menuListStore,this.stores.viewFilterQueryStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_filterView=e=>function(e,t){return(0,ce.D)(e,t.state)}(e,this.stores.viewFilterQueryStore)}UNSAFE_willMount(e){var t,o;const{collectionContextStore:r}=e,i=null===(t=r.collectionViewStore())||void 0===t?void 0:t.id,n=((null===(o=r.collectionViewBlockStore())||void 0===o?void 0:o.getCollectionViewStores())||[]).findIndex((e=>e.id===i));n>=0&&(this.initialMenuListFocus=n),this.stores.viewFilterQueryStore.setState("")}renderComponent(){var e;const{intl:t,collectionContextStore:o,onClose:r,onAddViewClick:i}=this.props,{device:n}=this.environment,s=o.permissionScopes.state,l=(0,vh.qG)((null==o||null===(e=o.collectionViewBlockStore())||void 0===e?void 0:e.id)??""),a=(0,b.jsx)(_h.Z,{title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Add view",id:"database.collectionViewSelect.addViewButtonTitle"}),onClick:()=>function(e,t){e("CollectionViewSelect2.handleCreateButtonClick"),t()}(this.props.onAddViewClick,this.props.onClose),focused:!1});return(0,b.jsx)(bd.Z,{capture:!0,allowEsc:!0,render:e=>{var c,d;let u;u=n.isMobile?{menuType:ke.og.Modal,title:(0,b.jsx)(Gh,{collectionContextStore:this.props.collectionContextStore}),right:(0,b.jsx)(Ve.DoneMenuText,{}),onClickRight:this.props.onClose,...e}:{menuType:ke.og.Popup,minWidth:290,maxWidth:320,maxHeight:"50vh",...e};const p=s.canConfigureBlock&&!l&&(0,b.jsx)(Pe.Z,{topBorder:!0,children:this.props.suggestedViews&&this.props.suggestedViews.length?(0,b.jsx)(qe.ZP,{popupType:this.environment.device.isMobile?Ye.kQ.SlideUp:Ye.kQ.Popup,alignmentToOrigin:qe.vR.Center,placementToOrigin:qe.pO.Right,renderOrigin:e=>(0,b.jsx)(_h.Z,{title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Add view",id:"database.collectionViewSelect.addViewButtonTitle"}),focused:!1,...e}),render:()=>(0,b.jsx)(Ah.Z,{collectionContextStore:o,suggestedViews:this.props.suggestedViews??[],onClose:r,onNewEmptyViewClick:i})}):a});return(0,b.jsxs)(Te.Z,{...u,header:!n.isMobile&&!(null!==(c=o.collectionViewBlockStore())&&void 0!==c&&c.isCollectionViewPageWithContent())&&(0,b.jsx)(Oh.ZP,{value:this.stores.viewFilterQueryStore.state,focus:!0,style:{marginTop:8,marginBottom:4},textWrapperStyle:{marginLeft:8,marginRight:8},onChange:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleViewFilterQueryChange,placeholder:t.formatMessage({defaultMessage:"Search for a view...",id:"collectionViewSelect.viewSearch.label"})}),footer:!n.isMobile&&p,children:[(0,b.jsx)(Pe.Z,{title:!n.isMobile&&!(null!==(d=o.collectionViewBlockStore())&&void 0!==d&&d.isCollectionViewPageWithContent)&&(0,b.jsx)(Gh,{collectionContextStore:this.props.collectionContextStore}),disableMobilePadding:!0,topBorder:!1,desktopTitleStyle:{marginTop:0,marginBottom:0},children:this.renderMenuList()}),this.stores.viewFilterQueryStore.state&&0===this.getFilteredViewStores().length&&(0,b.jsx)(Th.Z,{caption:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"No results",id:"database.collectionViewSelect.noResultsTitle"})}),n.isMobile&&p]})}})}renderMenuList(){const e=this.getFilteredViewStores();if(e.length>0)return(0,b.jsx)(Oe.Z,{type:Oe.i.Vertical,initialFocus:this.initialMenuListFocus,sections:[{key:"views",render:this.renderViewsSection,items:e.map((e=>{const t={key:e.id,render:t=>(0,b.jsx)(Kh,{collectionContextStore:this.props.collectionContextStore,onClose:this.props.onClose,collectionViewStore:e,props:t}),action:t=>{let{event:o}=t;!function(e,t,o,r,i,n,s,l,a){const c=o.collectionViewStore();c&&r({currentCollectionViewStore:c,newCollectionViewStore:e,openInNew:a});(function(e,t,o,r,i,n,s){pe.f8({environment:n,collectionContextStore:t,collectionViewId:e.id,openInNew:s,isFullScreen:o,isRootChild:r,isInPeekRenderer:i}),E.wd({environment:n,collectionContextStore:t,action:"click_view_in_dropdown",new_view_type:e.getType(),new_view_id:e.id})})(e,o,i,n,s,t,a),a||l()}(e,this.environment,this.props.collectionContextStore,this.props.onViewClick,this.props.isFullScreen,this.props.isRootChild,this.props.isInPeekRenderer,this.props.onClose,ji.DJ(o))}};return t}))}],store:this.stores.menuListStore})}getFilteredViewStores(){return zh(this.props.collectionContextStore).filter(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_filterView)}}Hh.displayName="CollectionViewSelect";const Zh=(0,B.injectIntl)(Hh);function zh(e){var t;return(null===(t=e.collectionViewBlockStore())||void 0===t?void 0:t.getCollectionViewStores())||[]}function Gh(e){let{collectionContextStore:t}=e;const o=(0,d.VK)((()=>zh(t)),[t]);return(0,b.jsx)(B.FormattedMessage,{defaultMessage:"{numberOfViews, plural, one {{numberOfViews} view} other {{numberOfViews} views}}",id:"database.mobileSelectViewMenu.title",values:{numberOfViews:o.length}})}function Kh(e){let{collectionViewStore:t,props:o,collectionContextStore:r,onClose:i}=e;return(0,b.jsx)(Eh,{collectionContextStore:r,collectionViewStore:t,onClose:i,menuListItemProps:o})}var Uh=o(16732),Wh=o(26991);const $h=i.memo((function(e){let{collectionViewStore:t,collectionContextStore:o,onViewClick:r,disabled:n}=e;const s=(0,a.O7)(),l=(0,u.Fg)(),[c,p]=(0,i.useState)(!1),h=(0,i.useCallback)((e=>{e.preventDefault(),(0,me.ZP)({event:e,context:me.Af.EditorContextMenu,callback:()=>{p(!0)}})}),[]),S=(0,i.useCallback)((e=>{const i=o.collectionViewStore();if(!i)return;const n=ji.DJ(e);r({currentCollectionViewStore:i,newCollectionViewStore:t,openInNew:n}),i.id===t.id?p(!0):function(e,t,o,r){pe.f8({environment:o,collectionContextStore:t,collectionViewId:e,openInNew:r,isFullScreen:t.isFullScreen.state,isRootChild:t.isRootChild.state,isInPeekRenderer:t.isInPeekRenderer.state})}(t.id,o,s,n),E.wd({environment:s,collectionContextStore:o,action:"click_view_tab",new_view_type:t.getType(),new_view_id:t.id})}),[s,o,t,r]),g=(0,i.useCallback)((()=>{p(!1)}),[]),C=(0,i.useCallback)((()=>{let e;return e=s.device.isPhone?{menuType:ke.og.Modal,right:(0,b.jsx)(Ve.DoneMenuText,{}),onClickRight:g}:{menuType:ke.og.Popup,minWidth:220},(0,b.jsx)(Te.Z,{...e,children:(0,b.jsx)(Dh,{collectionContextStore:o,collectionViewStore:t,onClose:g})})}),[o,t,s,g]),f=(0,d.VK)((()=>o.collectionViewStore()),[o]),y=(0,d.VK)((()=>o.collectionViewBlockStore()),[o]),v=(0,d.VK)((()=>null==t?void 0:t.getFormat().collection_view_icon),[t]),x=(0,d.VK)((()=>null==t?void 0:t.getType()),[t]),w=(0,d.VK)((()=>t.isDefined()),[t]),k=(0,d.VK)((()=>{var e;return(null===(e=o.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||"none"}),[o.inheritedBlockColorStore]),_=(0,i.useRef)(null),T=(0,d.VK)((()=>{var e;return(null==y?void 0:y.getSpaceId())!==(null===(e=$o.default.state.currentSpaceStore)||void 0===e?void 0:e.id)}),[y]),O=(0,d.VK)((()=>{var e;return t.getFormat().app_config_uri===m.g3&&"sprint_board"===(null===(e=$o.default.state.mainEditorCurrentBlockStore)||void 0===e?void 0:e.getFormat().special_page_for_pm_launch)&&!T}),[t,T]),V=(0,d.VK)((()=>!!y&&o.isInHomeWidget.state),[o,y]);if(!w||!f||!y)return null;const P=f.id===t.id;return(0,b.jsx)(Ye.ZP,{popupType:s.device.isMobile?Ye.kQ.SlideUp:Ye.kQ.Popup,alignmentToOrigin:Ye.ZP.Alignment.Start,open:c,render:C,onDismiss:g,origin:(0,b.jsxs)("div",{className:fo.rTm,style:{display:"flex",alignItems:"center",background:k,height:"100%",...P&&!V&&{borderBottom:`2px solid ${l.regularTextColor}`,paddingTop:2}},onContextMenu:h,children:[O&&(0,b.jsx)(jo.FF,{origin:_}),(0,b.jsx)(qh,{collectionViewStore:t,render:e=>(0,b.jsxs)(Qe.Z,{"aria-selected":P,role:"tab",ref:_,style:{display:"flex",alignItems:"center",fontSize:14,fontWeight:D.Z.fontWeight.medium,color:P?l.regularTextColor:l.mediumTextColor,maxWidth:Xh},hovered:c,onClick:S,disabled:n,...e,children:[(0,b.jsx)(kh.F,{color:P?"regular":"light",viewIcon:v,viewType:x,style:{marginRight:6}}),(0,b.jsx)("span",{style:{...D.Z.textOverflowStyle,marginTop:1},children:(0,b.jsx)(Yh,{collectionContextStore:o,collectionViewStore:t})})]},t.id)})]})})}));function qh(e){const t=(0,u.Fg)(),o=(0,B.useIntl)(),{collectionViewStore:r,render:i,disableTooltip:n}=e,s=(0,d.VK)((()=>r.getCollectionStore()),[r]),l=(0,d.VK)((()=>null==s?void 0:s.getModel()),[s]),a=(0,d.VK)((()=>r.getFormat().description),[r]),c=(0,d.VK)((()=>r.getModel()),[r]);return c?(0,b.jsx)(Xe.ZP,{placement:Xe.ug.Bottom,alignment:Xe.v2.Start,delayThreshold:500,render:i,disableTooltip:n,renderTooltip:e=>(0,b.jsxs)("div",{...e,style:fl.F6,children:[(0,b.jsx)("div",{children:(0,ce.Cc)({collectionViewName:c.getName(),collectionViewType:c.getType()})}),s&&l&&(0,b.jsx)("div",{style:{color:t.mediumInvertedTextColor},children:a||(0,b.jsx)(B.FormattedMessage,{defaultMessage:"{viewType, select, Table {Table view of {collection}} Board {Board view of {collection}} Timeline {Timeline view of {collection}} Calendar {Calendar view of {collection}} List {List view of {collection}} Gallery {Gallery view of {collection}} other {collection}}",id:"collectionTabBar.viewTab.tooltip",values:{viewType:yo.Bh[c.getType()],collection:(0,Rh.Xh)(s.getName(),s)||l.getEmptyTitlePlaceholder({intl:o})}})})]})}):null}function Qh(e,t,o){var r;const i=e.collectionStore();if(!i)return t.getName();const n=i.getPropertyMapping(),s=t.getName(),l=null==n?void 0:n[m.Es.TaskToSprintRelation];if(!o||!l||s!==ho.default.formatMessage(Uh.sY.tasksCurrentSprintV2ViewName))return t.getName();const a=o[l];if(!a||"relation"!==a.type||!a.collection_pointer)return t.getName();const c=null===(r=(0,Wh.As)(e,"current",a.collection_pointer,i))||void 0===r?void 0:r.getBlockTitleStore().getValue();return c?`${ho.default.formatMessage(Uh.sY.tasksCurrentSprintV2ViewNamePrefix)}: ${c[0]}`:t.getName()}function Yh(e){const{collectionViewStore:t,collectionContextStore:o}=e,[r,i]=(0,d.VK)((()=>{const e=o.settingsStore.state;return[e.open,N.Z$(e.stack)]}),[o.settingsStore]),n=(0,d.VK)((()=>o.collectionViewStore()),[o]),s=(0,d.VK)((()=>t.getCollectionStore()),[t]),l=(0,d.VK)((()=>{if(t.isDefined()){return(null==t?void 0:t.getFormatStore().getKeyStore("app_config_uri").getValue())===m.g3&&null!=s&&s.isDefined()?{name:Qh(o,t,s.getSchema()),type:t.getType()}:{name:t.getName(),type:t.getType()}}}),[t,s,o]);return!l||n&&n.id===t.id&&r&&i&&("duplicateExistingView"===i.type||"createViewSource"===i.type||"createView"===i.type)?(0,b.jsx)(B.FormattedMessage,{defaultMessage:"New view",id:"collectionTabBar.newViewPlaceholder.title"}):(0,b.jsx)(Lh.Z,{collectionViewName:l.name,collectionViewType:l.type})}const Xh=220,Jh=i.memo((function(e){const{collectionContextStore:t,showHoverActionsStore:o,isPlaceholderExternalCollectionStore:r,onViewClick:n,disabled:s}=e,l=(0,i.useRef)(new wh.E({throttleMs:200})),c=(0,i.useRef)(new Map),p=(0,i.useRef)(null),h=(0,i.useRef)(null),S=(0,d.VK)((()=>o.state),[o]),g=(0,d.VK)((()=>t.permissionScopes.state),[t]),C=(0,a.O7)(),f=(0,u.Fg)();(0,i.useEffect)((()=>{const e=l.current;return()=>{e.destroy()}}),[l]);const y=(0,i.useCallback)((e=>{const t=e.getName(),o=e.getType();if(!o)return 0;let r=c.current.get(e.id);r||(r=new bh({style:{fontSize:`${D.Z.fontSize.UIRegular.desktop}px`,fontWeight:D.Z.fontWeight.medium}}),c.current.set(e.id,r));const i=(0,ce.Cc)({collectionViewName:t,collectionViewType:o}),n=r.measure(i);return Math.min(40+n.width,Xh)}),[c]),v=(0,d.VK)((()=>{const e=tm(t),o=t.collectionViewStore();if(!o)return;const i=Math.max(100,em(t,r)?105:0);let n=l.current.rect.state.width-i;const s=[],a=y(o);if(!(a<n))return s;s.push(o),n-=a;for(const t of e)if(t.id!==o.id){const e=y(t);if(!(e<n))break;s.push(t),n-=e}const c=s.filter((e=>e.id!==o.id)),d=e.findIndex((e=>e.id===o.id));return c.splice(d,0,o),c}),[t,r,y,l]),x=(0,d.VK)((()=>{var e;const{device:o}=C,i=tm(t),n=(null==v?void 0:v.length)||0,s=i.length-n,l=(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.isCollectionViewPageWithContent())||o.isPhone||v&&(0===n||1===n&&i.length>1)||t.isCompactView.state?"dropdown":s>0?"someTabsNotVisible":"allTabsVisible",a=t.isFullScreen.state||S;return{showMoreViewsButton:"someTabsNotVisible"===l||"dropdown"===l,showAddViewButton:em(t,r)&&"allTabsVisible"===l,addViewButtonAnimatedIn:a,viewSelectState:l,moreViewsCount:s}}),[t,C,r,S,v]),w=(0,i.useCallback)((e=>{e&&l.current.observe(e)}),[l]),k=(0,d.VK)((()=>{const e=t.collectionStore(),o=t.collectionViewBlockStore();if(!e||!o)return;const r=e.getFormat().app_config_uri,i=r?(0,oe.YB)((0,El.appConfigs)(),r):void 0;return i?(0,oe.AG)(C,i,e,o):void 0}),[t,C]),_=(0,i.useCallback)((()=>{if(v&&"dropdown"!==x.viewSelectState)return g.canConfigureBlock?(0,b.jsx)(Js.ZP,{direction:"horizontal",keys:v.map((e=>e.id)),style:{height:"100%"},disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:e=>{const o=v.find((t=>t.id===e));if(o)return(0,b.jsx)(om,{collectionContextStore:t,onViewClick:n,disabled:s,collectionViewStore:o})},onDrop:e=>function(e,t,o){const r=o.collectionViewBlockStore();if(!r)return;ee.createAndCommit({userAction:"CollectionViewTabBar.handleViewTabsDrop",environment:t,perform:t=>{pe.Wu({collectionViewBlockStore:r,newViewIds:e,transaction:t})}})}(e,C,t)}):v.map((e=>(0,b.jsx)(om,{collectionContextStore:t,onViewClick:n,disabled:s,collectionViewStore:e},e.id)))}),[t,g.canConfigureBlock,s,C,n,x.viewSelectState,v]),T=(0,i.useCallback)((e=>{var o;const{device:r}=C,i=function(e){return e.collectionViewStore()}(t);if(!i)return;if(!i.isDefined())return;const n=(null===(o=t.collectionStore())||void 0===o?void 0:o.getFormat().app_config_uri)===m.GZ&&"page"===i.getType();if("dropdown"===x.viewSelectState){const o=i.getType(),l=i.getFormat().collection_view_icon,a=t.isCompactView.state;return(0,b.jsxs)(b.Fragment,{children:[!r.isMobile&&n&&"home"===Xs.B1()&&(0,b.jsx)(fh,{origin:p}),(0,b.jsx)(qh,{collectionViewStore:i,disableTooltip:a,render:r=>(0,b.jsxs)(Qe.Z,{ref:p,style:{display:"flex",alignItems:"center",fontSize:s?D.Z.fontSize.UISmall.desktop:D.Z.fontSize.UIRegular.desktop,fontWeight:D.Z.fontWeight.semibold,color:s?f.mediumTextColor:f.regularTextColor,maxWidth:Xh,paddingRight:s?0:void 0,paddingLeft:t.isInHomeWidget.state?16:void 0},disabled:s,...e,children:[(0,b.jsx)(kh.F,{color:s?"lightGray":"regular",viewType:o,viewIcon:l,style:{marginRight:s?8:6},size:s?14:void 0}),(0,b.jsx)("span",{style:{...D.Z.textOverflowStyle,marginRight:6,marginTop:1},children:(0,b.jsx)(Yh,{collectionContextStore:t,collectionViewStore:i})}),!s&&(0,Gi.i)({marginTop:2,width:10,height:10,fill:f.lightIconColor,marginRight:6})]})})]})}return"someTabsNotVisible"===x.viewSelectState?(0,b.jsx)(Qe.Z,{style:{display:"flex",alignItems:"center",fontSize:D.Z.fontSize.UIRegular.desktop,color:f.mediumTextColor},...e,children:(0,b.jsx)("span",{style:{marginTop:1},children:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"{moreViewsCount} more…",id:"collectionTabBar.showMoreViews.title",values:{moreViewsCount:x.moreViewsCount}})})}):void 0}),[t,s,C,p,x,f]),O=(0,i.useCallback)(((e,o)=>{var r;const{device:i}=C,s=t.isFullScreen.state,l=t.isRootChild.state,a=t.isInPeekRenderer.state,c=(null===(r=t.collectionStore())||void 0===r?void 0:r.getFormat().app_config_uri)===m.GZ;return(0,b.jsxs)(b.Fragment,{children:[!i.isMobile&&"views"===Xs.B1()&&c&&(0,b.jsx)(yh,{origin:h}),(0,b.jsx)("div",{ref:h,children:(0,b.jsx)(Zh,{collectionContextStore:t,onAddViewClick:e=>rm(e,C,t),suggestedViews:o,onClose:e.close,isFullScreen:s,isRootChild:l,isInPeekRenderer:a,onViewClick:n})})]})}),[t,C,n,h]);return(0,b.jsxs)("div",{role:"tablist",style:{display:"flex",alignItems:"center",height:"100%",flexGrow:1},ref:w,children:[_(),x.showMoreViewsButton&&(0,b.jsx)(qe.ZP,{popupType:C.device.isMobile?Ye.kQ.SlideUp:Ye.kQ.Popup,render:e=>O(e,k),renderOrigin:e=>T(e),onClick:()=>function(e,t){E.wd({environment:e,collectionContextStore:t,action:"click_views_dropdown"})}(C,t)}),x.showAddViewButton&&(0,b.jsx)(Ds.Z,{isVisible:!0,animationStyle:{opacity:x.addViewButtonAnimatedIn?1:0},render:()=>k&&k.length?(0,b.jsx)(qe.ZP,{popupType:qe.Z4.Popup,alignmentToOrigin:Ch.v2.Center,render:e=>(0,b.jsx)(im,{collectionContextStore:t,parent:e,suggestedViews:k}),renderOrigin:e=>(0,b.jsx)(jt.Z,{className:fo.rVO,icon:ie.R,...e})},"suggested-views"):(0,b.jsx)(jt.Z,{className:fo.rVO,icon:ie.R,onClick:()=>rm("CollectionViewTabBar.handleAddViewClick",C,e.collectionContextStore)})})]})}));function em(e,t){var o;const r=e.permissionScopes.state,i=null===(o=e.collectionViewBlockStore())||void 0===o?void 0:o.id,n=i&&(0,vh.qG)(i);return r.canConfigureBlock&&!t.state&&!n}function tm(e){var t;return(null===(t=function(e){return e.collectionViewBlockStore()}(e))||void 0===t?void 0:t.getCollectionViewStores())||[]}function om(e){let{collectionViewStore:t,collectionContextStore:o,onViewClick:r,disabled:i}=e;return(0,b.jsx)($h,{collectionContextStore:o,collectionViewStore:t,onViewClick:r,disabled:i},t.id)}function rm(e,t,o){ee.createAndCommit({userAction:e,environment:t,perform:e=>{pe.ME({environment:t,collectionContextStore:o,transaction:e})}}),E.xb({environment:t,collectionContextStore:o,view_type:"table"})}function im(e){let{parent:t,suggestedViews:o,collectionContextStore:r}=e;const i=(0,a.O7)();return(0,b.jsx)(Ah.Z,{collectionContextStore:r,suggestedViews:o,onClose:t.close,onNewEmptyViewClick:e=>rm(e,i,r)})}var nm=o(92650),sm=o(97978),lm=o(70764),am=o(54802),cm=o(92283),dm=o(2688),um=o(58421),pm=o(88632),hm=o(77144),mm=o(19671),Sm=o(80123),gm=o(85844),Cm=o(13023),fm=o(29026),ym=o(97058);function vm(e){const{height:t,boardCoverSize:o,showGroupHeader:r,areColumnsColored:i,isCompactView:n}=e,s=e.numBoardColumns||3,l=function(e,t){const o=t?mi:ui,r=2*o;return(0,ce.rD)(e)+r}(o,n),a=(0,u.yK)((e=>({container:{display:"flex",alignItems:"flex-start",paddingTop:r?10:0},groupHeader:{backgroundColor:e.largeShimmerColor,height:16,marginBottom:10,borderRadius:12,width:"50%"},group:{marginTop:r?i?20:8:0,marginRight:10,width:"100%",minWidth:l}})),[i,r,l]),c=N.DZ(s,(e=>(0,b.jsxs)("div",{style:a.group,children:[(0,b.jsx)(Nr.Z,{style:a.groupHeader}),(0,b.jsx)(Dr,{minHeight:t})]},e)));return(0,b.jsx)("div",{style:a.container,children:c})}var xm=o(24098);class bm extends p.default{getInitialState(){return{searchQuery:"",limit:bm.defaultLimit}}}bm.defaultLimit=20,bm.loadMoreScrollOffset=200,bm.loadMoreIncrement=20;const wm=bm;var km=o(72087),_m=o(43765),Tm=o(3553);const Om={display:"flex",alignItems:"center",justifyContent:"flex-start",height:32,padding:4,borderRadius:4},Vm=(0,B.defineMessages)({searchPlaceholder:{defaultMessage:"Search for a page…",id:"boardHiddenGroup.searchPlaceholder"}});class Pm extends s.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:mo.Z,boardHiddenGroupStore:wm,requestStore:km.Z},this.renderPopup=()=>{const{device:e}=this.environment,{groupFormat:t,schema:o,currentGroups:r,collectionContextStore:i,groupBy:n}=this.props;let s;s=e.isMobile?{menuType:ke.og.Modal,title:(0,b.jsx)(dt.Z,{groupBy:n,groupFormat:t,currentGroups:r,schema:o,disabled:!0,isHiddenGroup:!0,collectionContextStore:i}),left:(0,b.jsx)(qe.ZP,{popupType:Ye.kQ.SlideUp,renderOrigin:e=>(0,b.jsx)("div",{...e,children:(0,ue.o)({width:18,height:18,color:this.theme.lightTextColor})}),render:e=>(0,b.jsx)(Dm,{parent:e,groupFormat:this.props.groupFormat,currentGroups:this.props.currentGroups,format:this.props.format,schema:this.props.schema,collectionContextStore:this.props.collectionContextStore})}),right:(0,b.jsx)(Ve.DoneMenuText,{}),onClickRight:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePopupClose,header:this.renderHeader()}:{menuType:ke.og.Popup,header:this.renderHeader(),width:(0,ce.rD)(Im(this.props.format))+20};const l=this.reducerStore.state;if(l)return(0,b.jsx)(Tm.Z,{store:this.selectableBlockStore,isDefaultContainer:!0,droppable:!0,render:e=>{let{selectableEvents:o}=e;return(0,b.jsxs)(Te.Z,{...s,...o,children:[(0,b.jsx)(ze.Z,{id:`board_hidden_group:${(0,re.mD)(t)}`,reducer:l,groupsPointer:[t],collectionContextStore:i,resultStore:Fm(this.props.collectionContextStore,this.props.groupFormat),render:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderResults}),(0,b.jsx)(di.Z,{onChange:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleScrollOffsetChange})]})}})},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderResults=()=>(0,b.jsx)(Hm,{groupFormat:this.props.groupFormat,disabled:this.props.disabled,format:this.props.format,collectionContextStore:this.props.collectionContextStore,schema:this.props.schema,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,isFullScreen:this.props.isFullScreen,buttonPopupStore:this.stores.buttonPopupStore}),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePopupClose=()=>Am(this.stores.buttonPopupStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSearchInputChange=e=>function(e,t,o){o.setState({searchQuery:e.target.value,limit:wm.defaultLimit}),Nm(t)}(e,this.environment,this.stores.boardHiddenGroupStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSearchClearButtonClick=()=>{return e=this.environment,this.stores.boardHiddenGroupStore.reset(),void Nm(e);var e},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleButtonPopupClick=()=>{return e=this.environment,this.stores.boardHiddenGroupStore.reset(),void Nm(e);var e},this.handleDrop=e=>{const{droppedStores:t,duplicate:o}=e,{collectionContextStore:r,groupFormat:i}=this.props,s=n.findDOMNode(this);s&&s instanceof Element&&ee.createAndCommit({userAction:"BoardHiddenGroup.handleDrop",environment:this.environment,perform:e=>Z.BO({environment:this.environment,collectionContextStore:r,groupsPointer:[i],droppedStores:t,duplicate:o,transaction:e})})},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleScrollOffsetChange=e=>function(e,t,o,r){var i;const n=r.state,s=null===(i=Fm(t,o))||void 0===i||null===(i=i.state)||void 0===i?void 0:i.blockIds,l=t.isLoading.state;e<wm.loadMoreScrollOffset&&!l&&s&&n.limit<=s.length&&r.setState({...n,limit:n.limit+wm.loadMoreIncrement})}(e,this.props.collectionContextStore,this.props.groupFormat,this.stores.boardHiddenGroupStore),this.reducerStore=this.createComputedStore((()=>{const{groupFormat:e,schema:t,format:o}=this.props,{boardHiddenGroupStore:r}=this.stores,{searchQuery:i,limit:n}=r.state,s=(0,Le.zk)({schema:t,group:e,propertyMapping:void 0,timeZone:(0,Ee.r)()});if(!s)return;return{type:"results",filter:s,limit:n,searchQuery:i,loadContentCover:Boolean(o&&o.board_cover&&"page_content"===o.board_cover.type)}}))}UNSAFE_willMount(e){super.UNSAFE_willMount(e);const t=e.collectionContextStore.collectionViewBlockStore();t&&(this.selectableBlockStore=new ge.G(this.environment,{table:M.iU,id:t.id}))}renderComponent(){const{device:e}=this.environment,{groupBy:t,groupFormat:o,disabled:r,query:i,schema:n,currentGroups:s,collectionContextStore:l}=this.props,a=i.aggregations?i.aggregations[0]:void 0,c=l.isCompactView.state;return(0,b.jsx)(It.Z,{store:this.selectableBlockStore,canDropOnto:!r,onSelectableDrop:this.handleDrop,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,children:(0,b.jsx)(qe.ZP,{popupType:e.isMobile?Ye.kQ.SlideUp:Ye.kQ.Popup,renderOrigin:e=>(0,b.jsxs)(Yt.Z,{style:{...Om,...c?{fontSize:14}:{}},...e,children:[(0,b.jsx)(dt.Z,{groupBy:t,groupFormat:o,currentGroups:s,schema:n,disabled:!0,isHiddenGroup:!0,collectionContextStore:l}),(0,b.jsx)(bn,{groupFormat:o,aggregation:a,schema:n,collectionContextStore:l,disabled:!0,onChange:e=>function(e,t,o,r){const i=t.collectionViewStore(),n=e?[e]:[],s={...o,aggregations:n};i&&ee.createAndCommit({userAction:"BoardHiddenGroup.handleBoardAggregationChange",environment:r,perform:e=>{pe.iG({collectionViewStore:i,update:{query2:s},transaction:e})}})}(e,this.props.collectionContextStore,this.props.query,this.environment)})]},(0,re.mD)(o)),render:this.renderPopup,buttonPopupStore:this.stores.buttonPopupStore,onClick:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleButtonPopupClick})})}renderHeader(){const{device:e}=this.environment,{groupFormat:t,disabled:o,format:r,schema:n,query:s,currentGroups:l,collectionContextStore:a,isFullScreen:c,hoveredGroupStore:d,groupBy:u,isInPeekRenderer:p}=this.props,{searchQuery:h}=this.stores.boardHiddenGroupStore.state;return(0,b.jsxs)(i.Fragment,{children:[!e.isMobile&&(0,b.jsx)(In,{groupBy:u,currentGroups:l,groupFormat:t,query:s,schema:n,format:r,collectionContextStore:a,disabled:o||Boolean(h),hidden:!0,isPopup:!0,isFullScreen:c,hoveredGroupStore:d,isInPeekRenderer:p},(0,re.mD)(t)),(0,b.jsx)("div",{style:{margin:e.isMobile?0:"6px 0"},children:(0,b.jsx)(xm.Z,{capture:!0,render:t=>(0,b.jsx)(Oh.ZP,{value:h,placeholder:ho.default.formatMessage(Vm.searchPlaceholder),autoFocus:!e.isMobile,showClearButton:!0,onChange:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSearchInputChange,onClearButtonClick:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSearchClearButtonClick,...t})})})]})}}Pm.displayName="BoardHiddenGroup";const Rm=Pm;function Mm(e){return e?e.board_cover:void 0}function jm(e){return e?e.board_cover_aspect:void 0}function Im(e){return e?e.board_cover_size:void 0}function Fm(e,t){const o=e.groupsStore.getGroupState(t);return null==o?void 0:o.reducerResultStore}function Bm(e,t){const o=e.groupsStore.getGroupState(t);return null==o?void 0:o.resultsStore}function Nm(e){Jo.default.state.stores.length>0&&Y.ZH(e)}function Dm(e){let{parent:t,groupFormat:o,currentGroups:r,format:i,schema:n,collectionContextStore:s}=e;const l=(0,d.VK)((()=>s.collectionStore()),[s]),a=s.boardColumnsLimitStore;return l?(0,b.jsx)(je,{parent:t,groupFormat:o,currentGroups:r,format:i,schema:n,collectionContextStore:s,groupsFormatKey:"board_columns",groupsLimitStore:a}):null}function Lm(e,t,o,r,i){const{blocks:n,transaction:s}=e,l=o.groupsStore.getGroupState(t);if(!l)return;const a=l.resultsStore;if(n.length>0&&a.state.length>0){const e=n[0];if(!Ce.M_(i)||!o.collectionStore()||!o.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;go({transaction:s,environment:i,collectionContextStore:o,isFullScreen:r,groupsPointer:[t],insertAtIndex:a.state.findIndex((t=>t===e))+1,from:"board_group_enter_add_item",transient:!0,useCrdt:(0,Co.dy)({source:"collection_non_table_view"})})}}function Em(e,t,o,r){const i=t.collectionStore(),n=e.getTitleStore();if(So.QaF(null==n?void 0:n.getValue()))return void Y.Ys({environment:r,store:e});if(!i)return;const s=Bm(t,o);if(!s)return;const l=s.state.findIndex((t=>t===e))-1,a=t.collectionViewStore(),c=t.collectionViewBlockStore();if(a&&c&&L.sG(r,{...(0,he.Pn)(t),block_id:e.id}),ee.createAndCommit({userAction:"BoardHiddenGroup.handleBoardItemTextEsc",environment:r,perform:t=>{Z.Od({store:e,transaction:t})}}),l>=0){const e=s.state[l];Y.Ys({environment:r,store:e})}}function Am(e){e.setState({open:!1})}function Hm(e){let{groupFormat:t,disabled:o,format:r,collectionContextStore:n,schema:s,blockPropertyValueOverlayStore:l,isFullScreen:c,buttonPopupStore:u}=e;const p=(0,a.O7)(),h=(0,i.useCallback)((()=>Am(u)),[u]),{device:m}=p,S=(0,d.VK)((()=>{var e;return null===(e=Fm(n,t))||void 0===e?void 0:e.state}),[n,t]),g=(0,d.VK)((()=>{var e;return null===(e=Bm(n,t))||void 0===e?void 0:e.state}),[n,t]),C=(0,d.VK)((()=>Xo.default.isSidePeekOpen()),[]);return S&&g?0===g.length?(0,b.jsx)(Pe.Z,{children:(0,b.jsx)(_m.Z,{title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"No results",id:"database.boardView.searchResults.noResults.label"})})}):(0,b.jsx)("div",{style:{padding:m.isMobile?"8px 16px":"6px 14px 8px"},children:(0,b.jsx)(ii,{collectionContextStore:n,groupsPointer:[t],format:r,canDrag:!o,onSelectableEnter:e=>Lm(e,t,n,c,p),disableRequest:!0,resultProps:{format:r,schema:s,disabled:o,coverFormat:Mm(r),coverAspectFormat:jm(r),coverSizeFormat:Im(r),shouldShowTitle:yo.K8(r,"board"),colorStyle:void 0,blockPropertyValueOverlayStore:l,onTextEnter:e=>function(e,t,o,r,i){const n=Bm(t,r);if(!n)return;if(!Ce.M_(i)||!t.collectionStore())return Em(e,t,r,i);const s=n.state.findIndex((t=>t===e))+1;ee.createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:i,perform:e=>{go({transaction:e,environment:i,collectionContextStore:t,isFullScreen:o,groupsPointer:[r],insertAtIndex:s,from:"board_group_enter_add_item",transient:!0,useCrdt:(0,Co.dy)({source:"collection_non_table_view"})})}})}(e,n,c,t,p),onTextEsc:e=>Em(e,n,t,p),onShiftEnter:e=>Lm(e,t,n,c,p),collectionContextStore:n},resultComponent:Fr,handleOpenPeekPage:C?void 0:h,canDrop:!0,disabled:o,shouldShowHoverMenu:!1,direction:oi.Vertical,belowDropZoneMargin:2,emptyDroppableSize:4,analyticsName:"board"})}):(0,b.jsx)(Pe.Z,{children:(0,b.jsx)(_m.Z,{title:(0,b.jsx)(Ge.Z,{})})})}class Zm extends Ho.Z{constructor(e){super(e),this.storeTypes={groupsResultStore:p.default.createClass(void 0),hoveredGroupStore:p.default.createClass(void 0),subgroupsMountedStore:p.default.createClass(!1),lastColumnsBy:p.default.createClass(void 0),lastGroupBy:p.default.createClass(void 0)},this.hiddenGroupsContainerRef=void 0,this.hiddenGroupsHeaderRef=void 0,this.hiddenGroupsHeaderLastOffset=void 0,this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderBoardHiddenGroupsButton=e=>(0,b.jsx)(iS,{format:this.props.format,columnsDisplayStateStore:this.columnsDisplayStateStore,args:e}),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderSubGroupHeader=e=>(0,b.jsx)(nS,{collectionContextStore:this.props.collectionContextStore,isInPeekRenderer:this.props.isInPeekRenderer,format:this.props.format,subgroupsMountedStore:this.stores.subgroupsMountedStore,columnsDisplayStateStore:this.columnsDisplayStateStore,args:e}),this.renderHiddenGroup=e=>{const{collectionContextStore:t,query:o,schema:r,format:i,disabled:n,blockPropertyValueOverlayStore:s,isFullScreen:l,isInPeekRenderer:a}=this.props,c=this.columnsDisplayStateStore.state.currentGroups;if(!Gm(e,this.props.collectionContextStore)||!i.board_columns_by)return;const d=t.permissionScopes.state,u="collectionTypedView"===t.contextType;return(0,b.jsx)(Rm,{query:o,schema:r,format:i,groupFormat:e,groupBy:i.board_columns_by,currentGroups:c,collectionContextStore:t,disabled:n||!this.canEdit()||!d.canEditContent&&!u,blockPropertyValueOverlayStore:s,isFullScreen:l,hoveredGroupStore:this.stores.hoveredGroupStore,isInPeekRenderer:a},(0,re.mD)(e))},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleGroupsChange=()=>function(e,t,o,r){const i=r.state.currentGroups;Z.$D({environment:e,format:t,groupsFormatKey:"board_columns",collectionContextStore:o,currentGroups:i})}(this.environment,this.props.format,this.props.collectionContextStore,this.columnsDisplayStateStore),this.handleGroupsChangeDebounced=N.Ds(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleGroupsChange,5e3),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseLeave=()=>{this.stores.hoveredGroupStore.setState(void 0)},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem=e=>function(e,t,o){!function(e,t,o){const{device:r}=o;if(r.isMobile)se._c({environment:o,store:e,pageVisitSource:h.tY.Create});else{const r="collectionTypedView"===t.contextType;le.CH({environment:o,store:e,peekMode:ce.kr(t),showMoveTo:r,resultsStore:void 0,collectionContextStore:t,pageVisitSource:h.tY.Create})}}(e,o,t)}(e,this.environment,this.props.collectionContextStore),this.subgroupsOnChangeStore=this.createComputedStore((()=>{var e,t;const{collectionContextStore:o}=this.props,r=o.collectionViewStore();if(!r)return;const i=null==r||null===(e=r.getFormatStore())||void 0===e?void 0:e.getKeyStore("collection_group_by").getValue(),n=null==r||null===(t=r.getFormatStore())||void 0===t?void 0:t.getKeyStore("board_columns_by").getValue();N.Xy(i,this.stores.lastGroupBy.state)&&N.Xy(n,this.stores.lastColumnsBy.state)||this.stores.subgroupsMountedStore.setState(!1),this.stores.lastGroupBy.setState(i),this.stores.lastColumnsBy.setState(n)})),this.anyVisibleGroupHasResultsStore=this.createComputedStore((()=>{var e;const{collectionContextStore:t,format:o,schema:r}=this.props,i=this.columnsDisplayStateStore.state,{visibleGroups:n}=i,s=o.collection_group_by,l=t.collectionViewBlockStore(),a=this.stores.groupsResultStore.state,c=a?a.results:void 0,d=void 0!==l?(0,we.Cz)({groupBy:s,schema:r,formatGroups:o.collection_groups||[],schemaGroups:this.schemaGroupsStore.state,reducerResults:c,getRecordModel:l.getRecordModel,relativeVariableResult:t.relativeVariableStore.state,viewAppConfigUri:null===(e=t.collectionViewStore())||void 0===e?void 0:e.getFormat().app_config_uri,allowedCollectionStores:t.collectionStoresStore.state}):[];if(0===d.length){if(void 0!==s)return!1;for(const e of n){const o=t.groupsStore.getGroupState(e);if(null!=o&&o.reducerResultStore.state)return!0}}else for(const u of d)for(const e of n){const o=[u,e],r=t.groupsStore.getGroupState(o);if(null!=r&&r.reducerResultStore.state)return!0}return!1})),this.schemaGroupsStore=this.createComputedStore((()=>{const{format:e,schema:t}=this.props,o=e.board_columns_by;if(o)return(0,re.Qq)({schema:t,groupBy:o})}),!0),this.groupsReducerStore=this.createComputedStore((()=>{const{format:e,schema:t,collectionContextStore:o}=this.props,r=o.remoteRequestStore.state,i=co.default.checkGate("use_collection_reducer_request_hook")?(0,ao.ze)(o,!0):null==r?void 0:r.loader.filter,n=e.board_columns_by;if(n)return(0,we.ej)({groupBy:n,schema:t,format:e,filter:i,groupsFormatKey:"board_columns",limit:o.boardColumnsLimitStore.state})})),this.columnsDisplayStateStore=this.createComputedStore((()=>{const{format:e,schema:t,collectionContextStore:o}=this.props,r=e.board_columns_by;if(!r)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const i=o.collectionViewBlockStore();if(!i)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const n=o.collectionViewStore(),s=o.boardColumnsLimitStore.state,l=this.schemaGroupsStore.state,a=this.stores.groupsResultStore.state,c=a?a.results:void 0,d=a?a.total:0,u=(0,we.Cz)({groupBy:r,schema:t,formatGroups:e.board_columns||[],schemaGroups:l,reducerResults:c,getRecordModel:i.getRecordModel,relativeVariableResult:o.relativeVariableStore.state,viewAppConfigUri:null==n?void 0:n.getFormat().app_config_uri,allowedCollectionStores:o.collectionStoresStore.state}),p=u.filter((e=>!(0,re.eF)(e))).slice(0,s),h=u.filter((e=>(0,re.eF)(e)));return{currentGroups:[...p,...h],visibleGroups:p,hiddenGroups:h,total:d}}),!0),this.disableBoardColorColumnsStore=this.createComputedStore((()=>{const{schema:e,format:t,collectionContextStore:o}=this.props;return!Boolean((0,we.II)({environment:this.environment,groupFormat:void 0,schema:e,format:t,theme:this.theme,useDarkerColors:o.isInHomeWidget.state}))})),this.hiddenGroupsContainerRef=i.createRef(),this.hiddenGroupsHeaderRef=i.createRef(),this.hiddenGroupsHeaderLastOffset=0}UNSAFE_willMount(){this.columnsDisplayStateStore.addListener(this.handleGroupsChangeDebounced)}UNSAFE_willUnmount(){this.columnsDisplayStateStore.removeListener(this.handleGroupsChangeDebounced),this.handleGroupsChangeDebounced.cancel()}UNSAFE_willMountOrUpdate(e){const{format:t,store:o,collectionContextStore:r}=e,i=r.collectionStore();i&&(!t.board_columns_by&&o.isDefined()&&i.isDefined()&&function(e,t,o){const{collectionContextStore:r,schema:i}=e,n=r.collectionStore(),s=r.permissionScopes.state;if(!n)return;const l=r.collectionViewStore();if(!l||!s.canConfigureBlock)return;ee.createAndCommit({userAction:"Board.updateOrCreateColumnsByProperty",environment:o,perform:e=>{let a,c=ce.Se(i);if(!c&&s.canConfigureCollection){c=(0,Ic.ZP)();a={[c]:{name:t.formatMessage({id:"collection.boardView.selectProperty.defaultName",defaultMessage:"Status"}),type:"select",options:[]}}}if(!c)return;const d=(a||i)[c];d&&(0,re.LG)(d)&&(Jt.FH({stores:[l],update:{board_columns_by:(0,re.fw)(c,d,"collectionTypedView"===r.contextType)},transaction:e}),Oo.sW({store:l,data:{type:"board"},transaction:e}),a&&pe.xO({environment:o,collectionStore:n,update:a,transaction:e}))}})}(e,this.props.intl,this.environment),l.default.afterNextFlush((()=>this.updateHiddenGroupsHeaderOffset())))}renderPersisted(){const{format:e,collectionContextStore:t,isFullScreen:o,paddingLeft:r,paddingRight:i,paddingBottom:n}=this.props,s=t.permissionScopes.state,l=t.settingsStore;return e.board_columns_by?this.renderBoard():(0,b.jsx)(Nc,{collectionContextStore:t,title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"No group by property",id:"database.boardView.missingSelectPropertyTitle"}),description:s.canConfigureBlock?(0,b.jsx)(B.FormattedMessage,{defaultMessage:"<opensettingslink>Add a property to group by</opensettingslink> to your database in order to display a Board view.",id:"database.boardView.missingSelectProperty",values:{opensettingslink:e=>(0,b.jsx)(Bc,{onClick:()=>{z.r$({collectionContextStore:t,collectionSettingsStore:l}),z.H4({collectionSettingsStore:l,item:{type:"properties",timelineViewTab:"table"}})},children:e})}}):(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Board views require a property to group by in order to display.",id:"database.boardView.missingSelectPropertyNoPermissions"}),style:{paddingLeft:r,paddingRight:i,paddingBottom:o?void 0:n}})}renderBoard(){const{store:e,format:t,isFullScreen:o,collectionContextStore:r}=this.props,i=this.columnsDisplayStateStore.state,{visibleGroups:n,hiddenGroups:s}=i,l=t.collection_group_by,a=this.anyVisibleGroupHasResultsStore.state,c=this.stores.subgroupsMountedStore.state;this.subgroupsOnChangeStore.state;const d=r.shouldShowSpinner.state&&!c&&!a,u=r.isCompactView.state,p=r.isInHomeWidget.state,h=o?480:u?220:360,m=p;return(0,b.jsx)(oS,{collectionContextStore:this.props.collectionContextStore,groupsResultStore:this.stores.groupsResultStore,groupsReducerStore:this.groupsReducerStore,render:()=>(0,rs.Z)((c=>{return(0,b.jsx)(Ni,{isFullScreen:o,renderEmitter:r.renderEmitter,children:(0,b.jsx)("div",{style:{...(g=this.props.paddingLeft,C=this.props.paddingRight,{marginLeft:g,marginRight:C,float:"left",minWidth:"100%"}),...p?{paddingTop:8}:{}},className:fo.EGJ,...c,children:(0,b.jsxs)(It.Z,{style:(S=this.props.paddingBottom,{display:"flex",position:"relative",flexGrow:1,paddingBottom:S}),store:e,shouldShowHalo:!o&&!u,canSelect:!o,onMouseDown:e=>function(e,t){const{device:o}=t,{target:r}=e;!o.isMobile&&r instanceof HTMLElement&&(0,me.ZP)({event:e,context:me.Af.EditorMouseDown,callback:()=>{e.preventDefault(),W.AI({environment:t,target:r,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,this.environment),analyticsName:"board",onMouseLeave:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseLeave,children:[(!m||!d)&&this.renderHeader(i),d&&(0,b.jsx)(vm,{height:h,numBoardColumns:n.length,boardCoverSize:t.board_cover_size,areColumnsColored:!this.disableBoardColorColumnsStore.state,showGroupHeader:!m,isCompactView:u}),n.length>0&&(0,b.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,b.jsx)("div",{style:{height:34+gi(this.disableBoardColorColumnsStore.state,u),color:"red"}}),l?this.renderBoardColumnsForGroups(l,n,a):this.renderBoardColumnsForGroup(void 0,n,a)]}),Km(i,this.props.collectionContextStore)&&(0,b.jsx)("div",{style:{width:90,marginLeft:hi,marginRight:hi}}),Um(i,this.props.format,this.props.collectionContextStore)&&(0,b.jsx)("div",{style:{width:35,marginLeft:hi,marginRight:hi}}),s.length>0&&this.renderHiddenGroups(s)]})})});var S,g,C}))})}renderHeader(e){const{format:t,isFullScreen:o,isRootChild:r,collectionContextStore:i}=this.props,{hiddenGroups:n,visibleGroups:s,currentGroups:l}=e;if(0===s.length&&0===n.length)return;const a=s.map((e=>(0,re.mD)(e))),c=t.board_columns_by;if(!c)return;const d=(0,re.mu)(c),u=i.permissionScopes.state,p="manual"===d.type&&u.canConfigureBlock,h=(0,we.qW)({device:this.environment.device,isFullScreen:o,isRootChild:r}),m=i.isCompactView.state;return(0,b.jsx)(Mt,{position:ft(m),children:(0,b.jsxs)("div",{style:Xm(this.theme,this.props.collectionContextStore,this.props.isInPeekRenderer,this.disableBoardColorColumnsStore),children:[h&&(0,b.jsx)("div",{style:Qm(this.props.isInPeekRenderer,this.theme,m)}),p?(0,b.jsx)(Js.ZP,{direction:"horizontal",keys:a,renderKey:(e,t)=>(0,b.jsx)(Ym,{schema:this.props.schema,collectionContextStore:this.props.collectionContextStore,format:this.props.format,query:this.props.query,disabled:this.props.disabled,isFullScreen:this.props.isFullScreen,isInPeekRenderer:this.props.isInPeekRenderer,hoveredGroupStore:this.stores.hoveredGroupStore,groupFormat:s[t],currentGroups:l}),onDrop:e=>tS(e,!1,this.environment,this.props.collectionContextStore,this.columnsDisplayStateStore)}):a.map(((e,t)=>(0,b.jsx)(Ym,{schema:this.props.schema,collectionContextStore:this.props.collectionContextStore,format:this.props.format,query:this.props.query,disabled:this.props.disabled,isFullScreen:this.props.isFullScreen,isInPeekRenderer:this.props.isInPeekRenderer,hoveredGroupStore:this.stores.hoveredGroupStore,groupFormat:s[t],currentGroups:l},(0,re.mD)(s[t])))),Km(e,this.props.collectionContextStore)&&(0,b.jsx)(Wm,{collectionContextStore:this.props.collectionContextStore,schema:this.props.schema,displayState:e}),Um(e,this.props.format,this.props.collectionContextStore)&&(0,b.jsx)(rS,{format:this.props.format,schema:this.props.schema,collectionContextStore:this.props.collectionContextStore,store:this.props.store,columnsDisplayStateStore:this.columnsDisplayStateStore}),n.length>0&&(0,b.jsx)("div",{style:qm(this.props.isInPeekRenderer,this.theme,m),ref:this.hiddenGroupsHeaderRef,children:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Hidden groups",id:"collection.boardView.hiddenGroups.label"})})]})})}renderHiddenGroups(e){const{device:t}=this.environment,{collectionContextStore:o}=this.props,r=this.canEdit()&&!t.isMobile&&!o.permissionScopes.state.isLocked,i=e.slice(0,we.ew),n=i.map((e=>(0,re.mD)(e)));return(0,b.jsx)("div",{style:Jm(this.props.collectionContextStore,this.disableBoardColorColumnsStore),ref:this.hiddenGroupsContainerRef,children:i.length>0&&(r?(0,b.jsx)(Js.ZP,{direction:"vertical",keys:n,renderKey:(e,t)=>this.renderHiddenGroup(i[t]),onDrop:e=>tS(e,!0,this.environment,this.props.collectionContextStore,this.columnsDisplayStateStore)}):(0,b.jsx)("div",{children:i.map(this.renderHiddenGroup)}))})}renderBoardColumnsForGroups(e,t,o){const{store:r,format:i,collectionContextStore:n,schema:s,disabled:l,isFullScreen:a,paddingLeft:c,isRootChild:d,isInPeekRenderer:u}=this.props;return(0,we.hJ)()?(0,b.jsx)(Xn,{reducerId:ym.M9,store:r,collectionContextStore:n,disabled:l,isFullScreen:a,isRootChild:d,paddingLeft:c,stickyLeft:!this.environment.device.isMobile,renderGroup:e=>this.renderBoardColumnsForGroup(e,t,o),getGroupStyle:$m,renderHeader:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderSubGroupHeader,onGroupHeaderAddItem:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem}):(0,b.jsx)(an,{store:r,id:ym.M9,groupBy:e,groupsFormatKey:re.Uh,groupAggregationKey:re.dQ,format:i,schema:s,collectionContextStore:n,disabled:l,isFullScreen:a,isRootChild:d,paddingLeft:c,renderGroup:e=>this.renderBoardColumnsForGroup(e,t,o),renderHeader:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderSubGroupHeader,renderHiddenGroupsButton:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderBoardHiddenGroupsButton,onGroupHeaderAddItem:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem,stickyLeft:!this.environment.device.isMobile,getGroupStyle:$m,isInPeekRenderer:u})}renderBoardColumnsForGroup(e,t,o){return(0,b.jsx)("div",{style:Js.l8,children:t.map(((r,i)=>{const n=i===t.length-1;return this.renderGroupResults(e?[e,r]:[r],n,o)}))})}renderGroupResults(e,t,o){const{store:r,collectionContextStore:i,isFullScreen:n,query:s,schema:l,format:a,disabled:c,blockPropertyValueOverlayStore:d}=this.props,{hiddenGroups:u}=this.columnsDisplayStateStore.state,p=0!==u.length;if(!i.groupsStore.getGroupState(e))return;const h=i.permissionScopes.state,m=this.canEdit()&&("collectionTypedView"===i.contextType||h.canEditContent);return(0,b.jsx)(Ci,{store:r,hoveredGroupStore:this.stores.hoveredGroupStore,query:s,schema:l,format:a,groupsPointer:e,collectionContextStore:i,isFullScreen:n,isInPeekRenderer:this.props.isInPeekRenderer,disabled:c||!m,isLast:t&&!p,blockPropertyValueOverlayStore:d,anyGroupHasResults:o},(0,re.KW)(e))}updateHiddenGroupsHeaderOffset(){var e;if("function"==typeof this.hiddenGroupsHeaderRef||null===(e=this.hiddenGroupsHeaderRef)||void 0===e||!e.current)return;const t=(this.getHiddenGroupsHeaderOffset()||0)+this.hiddenGroupsHeaderLastOffset;this.hiddenGroupsHeaderLastOffset=t,this.hiddenGroupsHeaderRef.current.style.left=`${t}px`}getHiddenGroupsHeaderOffset(){var e,t;if("function"==typeof this.hiddenGroupsHeaderRef||"function"==typeof this.hiddenGroupsContainerRef||null===(e=this.hiddenGroupsHeaderRef)||void 0===e||!e.current||null===(t=this.hiddenGroupsContainerRef)||void 0===t||!t.current)return;const o=this.hiddenGroupsHeaderRef.current.getBoundingClientRect().left;return this.hiddenGroupsContainerRef.current.getBoundingClientRect().left-o+8}}Zm.displayName="Board";const zm=(0,B.injectIntl)(Zm);function Gm(e,t){return t.groupsStore.getGroupState([e])}function Km(e,t){const{visibleGroups:o,hiddenGroups:r,total:i}=e,n=0===o.length&&!t.shouldShowSpinner.state||o.length>0,s=qt({collectionContextStore:t,isForColumnGroups:!0}),l=t.boardColumnsLimitStore.state<i-r.length;return n&&l||s}function Um(e,t,o){const{visibleGroups:r}=e,i=t.board_columns_by,n=o.permissionScopes.state,s=0===r.length&&!o.shouldShowSpinner.state||r.length>0;return n.canConfigureBlock&&i&&(0,re.Wz)(i,n.canConfigureCollection)&&!n.isSyncedCollection&&s}function Wm(e){let{displayState:t,collectionContextStore:o,schema:r}=e;const i=o.boardColumnsLimitStore;return(0,b.jsx)(zi,{visibleGroups:t.visibleGroups,hiddenGroups:t.hiddenGroups,total:t.total,groupsLimitStore:i,type:"board",schema:r,collectionContextStore:o})}function $m(e){return{marginTop:4,...e.isLast&&{paddingBottom:12}}}function qm(e,t,o){return{position:"relative",width:220,flexShrink:0,display:"flex",alignItems:"center",fontSize:14,color:t.lightTextColor,...o?{}:{background:e?t.cardContentBackground:t.contentBackground},marginLeft:20}}function Qm(e,t,o){return{height:"calc(100% + 17px)",...o?{}:{background:e?t.cardContentBackground:t.contentBackground},width:20,marginLeft:-20,marginTop:-17}}function Ym(e){let{groupFormat:t,currentGroups:o,schema:r,collectionContextStore:i,format:n,query:s,disabled:l,isFullScreen:a,isInPeekRenderer:c,hoveredGroupStore:u}=e;return(0,d.VK)((()=>Gm(t,i)),[i,t])&&n.board_columns_by?(0,b.jsx)(In,{currentGroups:o,groupFormat:t,query:s,schema:r,format:n,groupBy:n.board_columns_by,collectionContextStore:i,hoveredGroupStore:u,disabled:l,hidden:!1,isPopup:!1,isInPeekRenderer:c,isFullScreen:a}):null}function Xm(e,t,o,r){var i;const n=t.isCompactView.state,s=n?"transparent":(null===(i=t.inheritedBlockColorStore.state)||void 0===i?void 0:i.background)||(o?e.cardContentBackground:e.contentBackground),l=gi(r.state,n);return{position:"absolute",background:s,height:34+l,paddingTop:l,zIndex:F.LN,display:"flex",boxShadow:`-3px 0 0 ${s}`,minWidth:"100%"}}function Jm(e,t){const o=e.isCompactView.state;return{width:220,flexShrink:0,marginTop:34+gi(t.state,o),marginLeft:12}}function eS(e,t){return t.state.visibleGroups.length*(jn(e)+2*ui+2*hi)}function tS(e,t,o,r,i){const n=i.state.currentGroups,s=n.filter((t=>e.indexOf((0,re.mD)(t))<0)),l=n.filter((t=>e.indexOf((0,re.mD)(t))>=0)),a=N.MR(l,(t=>{const o=e.indexOf((0,re.mD)(t));return o>=0?o:1/0})),c=t?[...s,...a]:[...a,...s];ee.createAndCommit({userAction:"Board.handleGroupReorder",environment:o,perform:e=>{Z.A6({collectionContextStore:r,newGroups:c,groupsFormatKey:"board_columns",transaction:e})}}),E.wd({environment:o,collectionContextStore:r,action:t?"board_reorder_hidden_groups":"board_reorder_groups"})}function oS(e){let{render:t,collectionContextStore:o,groupsResultStore:r,groupsReducerStore:i}=e;const n=(0,d.VK)((()=>i.state),[i]);return n?(0,b.jsx)(ze.Z,{id:"board_columns",reducer:n,collectionContextStore:o,resultStore:r,render:t}):(0,b.jsx)(b.Fragment,{children:t()})}function rS(e){let{format:t,schema:o,collectionContextStore:r,store:i,columnsDisplayStateStore:n}=e;const s=(0,a.O7)(),l=(0,d.VK)((()=>r.contextType),[r]),{currentGroups:c}=(0,d.VK)((()=>n.state),[n]);return t.board_columns_by?"collectionTypedView"===l?null:(0,b.jsx)(Mi,{groupBy:t.board_columns_by,schema:o,currentGroups:c,onAccept:e=>function(e,t,o,r,i){const n=t.collectionStore();if(!n)return;const s=r.board_columns_by;s&&Z.tH({update:e,collectionContextStore:t,groupsFormatKey:"board_columns",collectionStore:n,schema:o,groupBy:s,environment:i})}(e,r,o,t,s),groupsLimitStore:r.boardColumnsLimitStore,parentStore:i,type:"board",collectionContextStore:r}):null}function iS(e){let{args:t,format:o,columnsDisplayStateStore:r}=e;const i=(0,d.VK)((()=>eS(o,r)),[o,r]);return(0,b.jsx)("div",{style:{display:"flex",minWidth:i},children:(0,b.jsx)(Wi,{...t})})}function nS(e){let{args:t,collectionContextStore:o,isInPeekRenderer:r,format:i,subgroupsMountedStore:n,columnsDisplayStateStore:s}=e;const l=(0,u.Fg)(),a=(0,d.VK)((()=>o.isCompactView.state),[o]),c=(0,d.VK)((()=>eS(i,s)),[i,s]);return(0,b.jsx)(Nt,{...t,height:a?yo.yZ:36,getComputedStickyStyle:e=>a?{}:function(e,t,o){return{background:t?o.cardContentBackground:o.contentBackground,boxShadow:e?`0 1px 0 ${t?o.cardContentBackground:o.contentBackground}`:void 0}}(e,r,l),style:{...t.style,minWidth:c},onMount:()=>n.setState(!0)})}var sS=o(40506),lS=o(40863),aS=o(17746),cS=o(50628),dS=o(37034),uS=o(10084),pS=o(53876);class hS extends Ho.Z{activate(){const e=function(e,t){const{mainEditorCurrentBlockStore:o}=$o.default.state;return ce.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})}(this.props.store,this.props.collectionContextStore);e&&(this.props.handleOpenPeekPage(),ae.c4({environment:this.environment,url:e}))}didMount(){this.props.collectionContextStore.onItemMount()}renderComponent(){return(0,b.jsx)(SS,{...this.props})}}hS.displayName="CalendarItem";const mS=hS;function SS(e){const{store:t,row:o,schema:r,format:i,disabled:n,calendarBy:s,showWeekends:l,collectionContextStore:c,includeTime:u,resultsStore:p,handleOpenPeekPage:h,blockPropertyValueOverlayStore:m,calendarStore:S}=e,g=(0,a.O7)(),C=r[s],f=(0,d.VK)((()=>!n&&"date"===(null==C?void 0:C.type)&&!c.permissionScopes.state.isSyncedCollection),[c.permissionScopes,n,null==C?void 0:C.type]),{start:y,end:v,startOfWeek:x,endOfWeek:w,startColumn:k,columnCount:_}=(0,lS.du)({startUnixTimestampMS:e.start,endUnixTimestampMS:e.end,startOfWeekUnixTimestampMS:e.startOfWeek,endOfWeekUnixTimestampMS:e.endOfWeek}),T=(0,d.VK)((()=>{const e=i.calendar_properties?i.calendar_properties.filter((e=>e.visible&&"title"!==e.property)).map((e=>e.property)):[],o=e.filter((e=>Xt.XU({block:t.getModel(),property:e,schema:r,getRecordModel:t.getRecordModel,userId:g.currentUser.id,userTimeZone:(0,Ee.r)(),intl:ho.default.getIntl()})));return o.concat(N.e5(e,o))}),[g.currentUser.id,i.calendar_properties,r,t]),O=(0,d.VK)((()=>(0,Go.ls)({collectionContextStore:c})),[c]);if(!C||!fe.Lt(C))return null;const V=T.length+(O?1:0),P=y<x,R=void 0!==v&&v>w;return(0,b.jsxs)(gS,{store:t,row:o,numRows:V,columnCount:_,startIsBeforeStartOfWeek:P,endIsAfterEndOfWeek:R,startColumn:k,disabled:n,isEditableDate:f,calendarBy:s,showWeekends:l,resultsStore:p,handleOpenPeekPage:h,children:[O&&(0,b.jsx)("span",{style:{paddingRight:4,paddingLeft:8,maxWidth:"100%",overflowX:"hidden",textOverflow:"ellipsis"},children:(0,b.jsx)(Io.O,{blockStore:t,collectionContextStore:c})}),(0,b.jsx)(vS,{store:t,collectionContextStore:c,disabled:n,start:y,startOfWeek:x,end:v,endOfWeek:w,includeTime:u,propertySchema:C}),(0,b.jsx)(bS,{store:t,sortedProperties:T,startIsBeforeStartOfWeek:P,disabled:n,blockPropertyValueOverlayStore:m}),f&&(0,b.jsx)(wS,{store:t,start:y,startOfWeek:x,end:v,endOfWeek:w,calendarBy:s,calendarStore:S})]})}function gS(e){const{store:t,children:o,columnCount:r,row:n,numRows:s,startColumn:l,disabled:c,isEditableDate:p,calendarBy:m,showWeekends:S,resultsStore:g,handleOpenPeekPage:C,startIsBeforeStartOfWeek:f,endIsAfterEndOfWeek:y}=e,v=(0,a.O7)(),x=(0,tn.Y$)(),w=(0,d.VK)((()=>ce.Sc(t)),[t]),k=yS(s,(0,d.VK)((()=>{var e;return null===(e=x.collectionViewStore())||void 0===e?void 0:e.getFormat().calendar_properties}),[x])),_=jS+k*n,T=(0,d.qz)(void 0,uS.Z),O=(0,d.VK)((()=>Qo.Z.state?!0===T.state.dragging:Wr.Z.state.hoveredStore===t),[t,T]),V=S?7:5,P=(0,u.yK)((e=>({selectable:{position:"absolute",paddingTop:3,paddingBottom:3,paddingLeft:f?0:6,paddingRight:y?0:6,width:y?`calc(100% / ${V} * ${r} - 1px)`:`calc(100% / ${V} * ${r})`,left:`calc(100% / ${V} * ${l})`,height:k,top:_},haloStyle:{...ce.pB(w,e),borderRadius:5,marginTop:2,marginBottom:2,marginLeft:f?0:5,marginRight:y?0:5},linkBoxStyle:{height:"100%",background:e.calendarItemBackground,borderTopLeftRadius:4,borderTopRightRadius:4,borderBottomLeftRadius:4,borderBottomRightRadius:4,boxShadow:e.lightBoxShadow,...y&&{borderTopRightRadius:0,borderBottomRightRadius:0},...f&&{borderTopLeftRadius:0,borderBottomLeftRadius:0}},linkBoxHoveredStyle:{opacity:1,background:e.calendarItemHoveredBackground},linkBoxInnerStyle:{display:"flex",position:"relative",paddingTop:2,paddingBottom:2,height:"100%",alignItems:"flex-start",flexDirection:"column"}})),[r,y,k,V,w,l,f,_]),R=(0,i.useCallback)((e=>{const o=t.getAssociatedCollectionStore();return o?H.QG({environment:v,collectionStore:o,collectionContextStore:x,store:t,insertStores:e.insertStores,calendarBy:m,transaction:e.transaction,results:g.state}):[]}),[m,x,v,g,t]),M=(0,i.useCallback)((e=>{const{transaction:o}=e;t.getAssociatedCollectionStore()&&Z.Od({store:t,transaction:o})}),[t]),[j,I]=(0,d.VK)((()=>{const{mainEditorCurrentBlockStore:e}=$o.default.state,o=ce.mb({store:t,mainEditorCurrentBlockStore:e,collectionContextStore:x,fullyQualified:!1});return[(0,Ko.ZP)({store:t,fullyQualified:!1,pageVisitSource:h.tY.LinkInPage}),o]}),[x,t]),F=(0,d.VK)((()=>x.isCompactView.state),[x]);return(0,b.jsx)(It.Z,{store:t,style:P.selectable,canSelect:!c,shouldShowHalo:!F,shouldForceRenderSelectionHalo:w,haloStyle:P.haloStyle,canTriggerContextMenu:!c,showBlockMenuInput:!0,canDrag:p,onInsertAbove:R,onInsertBelow:R,onRemove:M,canInsertAbove:p,canInsertBelow:p,analyticsName:"calendar",shouldShowDropZone:!0,className:fo.K4T,draggableStore:T,children:(0,b.jsx)(No.Z,{style:P.linkBoxStyle,hoveredStyle:P.linkBoxHoveredStyle,pressedStyle:P.linkBoxHoveredStyle,innerStyle:P.linkBoxInnerStyle,onClick:C,href:j,metaHref:I,hovered:O,children:o})},t.id)}const CS=24,fS=36;function yS(e,t){var o;return(!0===(null==t||null===(o=t.find((e=>"title"===e.property)))||void 0===o?void 0:o.wrap)?fS:CS)+e*pS.ch+2*IS+2*FS}function vS(e){const{store:t,collectionContextStore:o,disabled:n,start:s,startOfWeek:l,end:c,endOfWeek:p,includeTime:h,propertySchema:m}=e,S=(0,a.O7)(),g=(0,B.useIntl)(),C=s<l,f=c&&c>p,y=(0,d.VK)((()=>(0,Go.wI)({collectionContextStore:o,blockStore:t})),[o,t]),v="time_format"in m?m.time_format:sS.c_,[x,w,k]=(0,d.VK)((()=>[t.getIcon(),t.isEmptyPage(),t.hasError()]),[t]),_=(0,i.useCallback)((e=>{const o=t.getIconStore();o&&ee.createAndCommit({userAction:"CalendarItem.handleRecordIconChange",environment:S,perform:t=>{Oo.sO({store:o,value:e,transaction:t})}})}),[S,t]),T=(0,d.VK)((()=>{var e,t;const r=null===(e=o.collectionViewStore())||void 0===e?void 0:e.getFormat().calendar_properties;return!0===(null==r||null===(t=r.find((e=>"title"===e.property)))||void 0===t?void 0:t.wrap)}),[o]),O=(0,u.yK)((e=>({titleContainer:{paddingLeft:6,paddingRight:6,overflow:"hidden",...C&&{paddingLeft:12},...f&&{paddingRight:11},width:"100%",...T?{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:"17px",height:fS,paddingTop:2}:{height:CS},overflowWrap:"break-word",textOverflow:"ellipsis",fontSize:14,fontWeight:D.Z.fontWeight.semibold},recordIconStyle:{display:"inline",float:"left",marginRight:3,paddingTop:T?2:4},iconWarningStyle:{display:"inline",float:"left",marginLeft:1,marginRight:5,width:10,height:16,paddingTop:T?2:4,fill:e.accentColors.orange[500]},subitemCountIndicatorContainer:{display:"flex",alignItems:"center",float:"right",paddingTop:T?2:4},timeStyle:{color:e.mediumTextColor,float:"right",fontSize:10,marginLeft:4,height:14,paddingTop:T?2:4},subitemsWrapperStyle:{paddingRight:0,paddingLeft:4}})),[f,C,T]),V=h&&c&&r.Xp.fromDateTimes(l,p).contains(c)&&s.day!==c.day,P=(0,d.VK)((()=>o.shouldShowPageIcon()&&(void 0!==x||!w)&&!k),[o,x,w,k]),R=(0,d.VK)((()=>{const e=(0,dS.V)(t,g,S,!1);return e||(0,dS.NO)(t,g)}),[S,t,g]);return(0,b.jsxs)("div",{style:O.titleContainer,children:[P&&(n?(0,b.jsx)(Do.Z,{disabled:!0,icon:x,isEmptyPage:w,size:14,style:O.recordIconStyle}):(0,b.jsx)(Do.Z,{disabled:!1,store:t,bucket:"secure",icon:x,isEmptyPage:w,size:14,style:O.recordIconStyle,onChange:_})),k&&(0,ko.t)(O.iconWarningStyle),(0,b.jsx)(xS,{store:t,titlePropertyIsWrapped:T}),y&&(0,b.jsx)("div",{style:O.subitemCountIndicatorContainer,children:(0,b.jsx)(Fo.B,{blockStore:t,collectionContextStore:o,wrapperStyle:O.subitemsWrapperStyle})}),h&&r.Xp.fromDateTimes(l,p).contains(s)&&(0,b.jsxs)("div",{style:O.timeStyle,children:[(0,Id.xE)({dateTime:s,humanReadable:!1,timeFormat:v}),V&&(0,b.jsxs)("span",{children:[" → ",(0,Id.xE)({dateTime:c,humanReadable:!1,timeFormat:v})]})]}),R]})}function xS(e){const{store:t,titlePropertyIsWrapped:o}=e,r=(0,d.VK)((()=>Wo.Xp(t,{recursivelyLoadAllDiscussions:!1})),[t]),i=(0,d.VK)((()=>co.default.checkGate("collection_subitem_new_show_hide_options")),[]),n=(0,u.yK)((e=>({speechBubbleIconStyle:{width:12,height:12,marginRight:4,fill:e.mediumIconColor},discussionIndicatorWithSubitemsExperimentOnStyle:{display:"flex",alignItems:"center",color:e.lightTextColor,fontSize:12,flexShrink:0,marginLeft:4,float:"right",marginTop:o?void 0:2},discussionIndicatorCurrentStyle:{display:"flex",alignItems:"center",color:e.lightTextColor,fontSize:12,marginLeft:4,flexShrink:0,float:"right",marginTop:o?void 0:2}})),[o]);return 0===r?null:(0,b.jsxs)("div",{style:i?n.discussionIndicatorWithSubitemsExperimentOnStyle:n.discussionIndicatorCurrentStyle,children:[(0,wo.z)(n.speechBubbleIconStyle),r]})}function bS(e){const{store:t,sortedProperties:o,startIsBeforeStartOfWeek:r,disabled:i,blockPropertyValueOverlayStore:n}=e,s=(0,tn.Y$)(),l=(0,d.VK)((()=>s.permissionScopes.state.isLocked),[s.permissionScopes]),[a,c]=(0,d.VK)((()=>[ce.Bm({store:t,collectionContextStore:s}),s.collectionViewStore()]),[t,s]);return a?(0,b.jsx)("div",{style:{paddingLeft:6,paddingRight:6,overflow:"hidden",width:"100%",...r&&{paddingLeft:12}},children:o.map((e=>(0,b.jsx)(Ro.Z,{store:t,property:e,disabled:i,locked:l,format:Mo.C.Calendar,tableWrap:!1,blockPropertyValueOverlayStore:n,collectionStore:a,collectionViewStore:c},e)))}):null}function wS(e){const{store:t,calendarStore:o,start:r,startOfWeek:n,end:s,endOfWeek:l,calendarBy:c}=e,d=(0,a.O7)(),p=(0,u.yK)((()=>({leftDragHandle:{position:"absolute",top:0,left:-4,height:"100%",width:12,cursor:"col-resize"},rightDragHandle:{position:"absolute",top:0,right:-4,height:"100%",width:12,cursor:"col-resize"}})),[]),h=(0,i.useCallback)((e=>{H.td({calendarStore:o,x:e.currentX,y:e.currentY,calendarBy:c})}),[o,c]),m=(0,i.useCallback)((()=>{ee.createAndCommit({userAction:"CalendarItem.handleDraggableDragEnd",environment:d,perform:e=>{H.fX({environment:d,transaction:e,calendarStore:o,calendarBy:c})}})}),[c,o,d]),S=(0,i.useCallback)((()=>{H.cQ({calendarStore:o})}),[o]),g=r>=n&&(0,b.jsx)(sa.Z,{render:e=>(0,b.jsx)("div",{style:p.leftDragHandle,...e}),onDraggableDragStart:()=>{H.f$({calendarStore:o,target:t,direction:aS.t.Left})},onDraggableDragMove:h,onDraggableDragEnd:m,onDraggableDragCancel:S}),C=(!s||s&&s<l)&&(0,b.jsx)(sa.Z,{render:e=>(0,b.jsx)("div",{style:p.rightDragHandle,...e}),onDraggableDragStart:e=>{H.f$({calendarStore:o,target:t,direction:aS.t.Right})},onDraggableDragMove:h,onDraggableDragEnd:m,onDraggableDragCancel:S});return(0,b.jsxs)(b.Fragment,{children:[g,C]})}const kS={height:28,width:28,lineHeight:"28px",borderRadius:"100%",textAlign:"center",color:xe.ZP.white,background:xe.ZP.red,marginLeft:"auto",marginRight:"auto"},_S={height:28,display:"flex",alignItems:"center",justifyContent:"center"},TS={width:"100%",height:44,borderRadius:4},OS={position:"absolute",fontSize:14,top:4,right:10,height:24,lineHeight:"24px",textAlign:"right",transition:"color 100ms ease-out"},VS={position:"relative",display:"flex"},PS={},RS={height:74},MS={height:66},jS=30,IS=2,FS=3;class BS extends Ho.Z{constructor(){super(...arguments),this.headerEl=void 0,this.root=void 0,this.verticalScrollableAncestor=void 0,this.storeTypes={calendarStore:aS.Z,resultStore:p.default.createClass(void 0)},this.handleHeaderMount=e=>{this.headerEl=e},this.handleScroll=()=>{if(!this.headerEl)return;if(!ES(this.props.collectionContextStore,this.props.isFullScreen,this.environment))return;const{calendarStore:e}=this.stores,t=e.state,o=this.headerEl.getBoundingClientRect();let r=[];t.dayStoreMap.forEach(((e,t)=>{r.push({store:e,timestamp:t})})),r=N.MR(r,(e=>{let{timestamp:t}=e;return t}));const i=r.find((e=>{let{store:t}=e;const r=Xa.C.getRectFromStore(t);return Boolean(r&&r.top<=o.top+o.height&&r.top+r.height>=o.top+o.height)}));if(i){const o=(0,yu.kl)((0,yu.Xz)({date:(0,yu.V7)(i.timestamp,vh.AK.state),daysToAdd:1}));o!==t.startingMonth&&e.setState({...e.state,startingMonth:o})}},this.handleScrollThrottled=N.P2(this.handleScroll,100),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseMove=e=>function(e,t){const o=t.state;if(!o.isDragging&&!Qo.Z.state){const r=function(e,t,o){Y.Ch();const{dayStoreMap:r}=o.state,{selectableRectMap:i}=cS.Z.state,n=Array.from(r.keys()),s=Array.from(r.values());for(const[l,a]of i.entries())if(a&&Lc.uh(a,e,t)&&s.indexOf(l.props.store)>=0)return n.find((e=>r.get(e)===l.props.store))}(e.clientX,e.clientY,t);o.hoveredDay!==r&&t.setState({...o,hoveredDay:r})}}(e,this.stores.calendarStore),this.handleMouseMoveThrottled=N.P2(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseMove,50),this.handleTodayClick=()=>{const e=DS(this.props.collectionContextStore),t="month"===e?(0,yu.IS)((0,yu.kl)(Date.now()),vh.AK.state):(0,yu.IS)(Date.now(),vh.AK.state);this.setNewCalendarStart(t,e)},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleOpenPeekPage=()=>function(e,t,o){Hr.default.mark("collections.open_item_page_lag"),U.Xd({collectionContextStore:t,resultsStore:o});const r=t.normalizedFormatStore.state.collection_peek_mode,i=r||qr.Ls.calendar;$r.hy(e,{is_peek:!0,from:"calendar",peek_mode:i})}(this.environment,this.props.collectionContextStore,this.sortedResultsStore),this.startOfWeekSettingStore=this.createComputedStore((()=>{const{currentUserSettingsStore:e}=$o.default.state;if(!e)return 0;const t=e.getSettings();return null!=t&&t.start_day_of_week?t.start_day_of_week:0}),!0),this.reducerStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return(0,lS.Ft)({collectionContextStore:e})}),!0),this.resultsStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore();if(!t)return[];const o=this.stores.resultStore.state;return o?o.blockIds.map((e=>ge.G.createChildStore(t,{id:e,table:M.iU}))):[]}),!0),this.weeksStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=ho.default.getIntl();return(0,lS.y$)({collectionContextStore:e,results:this.resultsStore.state,getRecordValue:this.getRecordValue,intl:t})}),!0),this.sortedResultsStore=this.createComputedStore((()=>{var e;const{collectionContextStore:t}=this.props,o=t.collectionViewStore();return o&&(null===(e=this.weeksStore.state)||void 0===e?void 0:e.flatMap((e=>e.items.map((e=>ge.G.createChildStore(o,{table:M.iU,id:e.id}))))))||[]}),!0),this.isTypedMSVCollection=this.createComputedStore((()=>"collectionTypedView"===this.props.collectionContextStore.contextType)),this.getRecordValue=this.props.store.getRecordValue}UNSAFE_willMount(e){super.UNSAFE_willMount(e);const{collectionContextStore:t}=e;this.handleMount(t),vh.AK.addListener((()=>{this.handleMount(this.props.collectionContextStore)}))}UNSAFE_willMountOrUpdate(e){super.UNSAFE_willMountOrUpdate(e),Qo.Z.state&&(this.stores.calendarStore.state.isDragging||this.stores.calendarStore.setState({...this.stores.calendarStore.state,hoveredDay:void 0}));const{query:t}=e;t.calendar_by||function(e,t,o){const{schema:r}=e,i=t.permissionScopes.state,n=ho.default.getIntl(),s=t.collectionStore();if(!s)return;const l=t.collectionViewStore();if(!l||!i.canConfigureBlock)return;ee.createAndCommit({userAction:"Calendar.updateOrCreateCalendarProperty",environment:o,perform:e=>{let t,a=ce.PD(r);if(!a&&i.canConfigureCollection){a=(0,Ic.ZP)();t={[a]:{name:n.formatMessage({id:"database.calendarView.dateProperty.defaultName",defaultMessage:"Date"}),type:"date"}}}pe.Es({collectionViewStore:l,update:{calendar_by:a},transaction:e}),Oo.sW({store:l,data:{type:"calendar"},transaction:e}),t&&pe.xO({environment:o,collectionStore:s,update:t,transaction:e})}})}(e,this.props.collectionContextStore,this.environment)}didMountOrUpdate(){this.handleScrollThrottled(),this.root||(this.root=n.findDOMNode(this),this.root&&(this.verticalScrollableAncestor=(0,Se.VW)(this.root),this.verticalScrollableAncestor&&ji.lj(this.verticalScrollableAncestor,"scroll",this.handleScrollThrottled),ji.lj(this.root,"mousemove",this.handleMouseMoveThrottled)))}willUnmount(){super.willUnmount(),this.verticalScrollableAncestor&&ji.ZV(this.verticalScrollableAncestor,"scroll",this.handleScrollThrottled),this.root&&ji.ZV(this.root,"mousemove",this.handleMouseMoveThrottled)}renderPersisted(){const{device:e}=this.environment,{store:t,paddingBottom:o,paddingLeft:r,paddingRight:i,query:n,schema:s,collectionContextStore:l,isFullScreen:a}=this.props,{calendar_by:c}=n;if(!c)return(0,b.jsx)(LS,{collectionContextStore:this.props.collectionContextStore,isFullScreen:this.props.isFullScreen,paddingBottom:this.props.paddingBottom,paddingLeft:this.props.paddingLeft,paddingRight:this.props.paddingRight});const d=s[c];if(!d||!fe.Lt(d))return(0,b.jsx)(LS,{collectionContextStore:this.props.collectionContextStore,isFullScreen:this.props.isFullScreen,paddingBottom:this.props.paddingBottom,paddingLeft:this.props.paddingLeft,paddingRight:this.props.paddingRight});const u=this.reducerStore.state;if(!u)return;const p=DS(l),h=l.isCompactView.state;return(0,rs.Z)((n=>(0,b.jsx)(ze.Z,{id:"calendar_results",resultStore:this.stores.resultStore,collectionContextStore:l,reducer:u,render:()=>(0,b.jsx)(Ni,{isFullScreen:a,children:(0,b.jsx)(di.Z,{onChange:e=>function(e,t,o,r){const i=t.isLoading.state,n=ES(t,o,r);if(e<vo.Z.incrementScrollOffset&&!i&&n){const e=t.dateRangeStart.state,o=t.dateRangeEnd.state,r=(0,yu.V7)((0,yu._)({date:o,monthsToAdd:2}),vh.AK.state);pe.t5({dateRangeStart:e,dateRangeEnd:r,collectionContextStore:t})}}(e,this.props.collectionContextStore,this.props.isFullScreen,this.environment),style:h?{height:"100%",maxHeight:"inherit"}:{},children:(0,b.jsx)("div",{style:{paddingBottom:o,paddingLeft:r,paddingRight:i,minWidth:this.props.minWidth,...h?{height:"100%",maxHeight:"inherit"}:{}},className:fo.c7X,children:(0,b.jsxs)(It.Z,{style:{position:"relative",paddingLeft:1,...h?{height:"100%",maxHeight:"inherit"}:{}},store:t,shouldShowHalo:!a&&!h,canSelect:!a,onMouseDown:e=>function(e,t,o){const{device:r}=o,{target:i}=e;!r.isPhone&&i instanceof HTMLElement&&(0,me.ZP)({event:e,context:me.Af.EditorMouseDown,callback:()=>{e.preventDefault(),W.AI({environment:o,target:i,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[t],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!1})}})}(e,this.props.store,this.environment),analyticsName:"calendar",...n,children:[this.renderHeader(GS(this.environment,this.props.collectionContextStore,this.props.isFullScreen,this.stores.calendarStore),p),h?(0,b.jsx)(yt,{style:{height:"calc(100% - 66px)",maxHeight:this.props.maxHeight?this.props.maxHeight-(e.isPhone?74:66):"inherit",paddingBottom:16,maskImage:"none",WebkitMaskImage:"none"},children:this.renderCalendarBody()}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{style:e.isPhone?RS:MS}),this.renderCalendarBody()]})]})})})})})))}renderHeader(e,t){var o;const{device:r}=this.environment,{collectionContextStore:i}=this.props,n=ho.default.getIntl(),s=i.isCompactView.state,l=(null===(o=i.collectionViewStore())||void 0===o?void 0:o.getFormat().calendar_show_weekends)??!0?(0,Id.kv)(vh.AK.state,jd.SP):(0,Id.vI)(jd.SP);return(0,b.jsx)(Mt,{position:ft(s),children:(0,b.jsxs)("div",{style:r.isPhone?HS(this.props.collectionContextStore,this.theme):AS({collectionContextStore:this.props.collectionContextStore,isInPeekRenderer:this.props.isInPeekRenderer,theme:this.theme}),ref:this.handleHeaderMount,children:[(0,b.jsxs)("div",{style:{display:"flex",height:42,alignItems:"center",marginBottom:2},children:[(0,b.jsx)("div",{style:{fontWeight:D.Z.fontWeight.semibold,marginLeft:8,marginRight:8,lineHeight:1,fontSize:r.isPhone?16:14},children:KS(t,e,jd.SP,this.weeksStore)}),(0,b.jsx)("div",{style:{flexGrow:1}}),(0,b.jsx)(xd,{collectionContextStore:i}),(0,b.jsx)(jt.Z,{ariaLabel:n.formatMessage({id:"database.calendarView.previousMonthButton.label",defaultMessage:"Previous Month"}),mobileFeedback:r.isMobile,icon:sd.f,onClick:()=>this.handleCalendarClick("left",i)}),(0,b.jsx)(Qe.Z,{isSmall:!0,onClick:this.handleTodayClick,children:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Today",id:"database.calendarView.todayButton.label"})}),(0,b.jsx)(jt.Z,{ariaLabel:n.formatMessage({id:"database.calendarView.nextMonthButton.label",defaultMessage:"Next Month"}),mobileFeedback:r.isMobile,icon:ld.o,onClick:()=>this.handleCalendarClick("right",i)})]}),(0,b.jsx)("div",{style:{display:"flex",marginTop:r.isPhone?8:0,boxShadow:`0 1px 0 ${this.theme.tableDividerColor}`},className:fo.GNl,children:l.map((e=>{let[t,o]=e;return(0,b.jsx)("div",{style:(r=this.theme,{flexGrow:1,flexBasis:0,textAlign:"center",fontSize:12,height:24,color:r.lightTextColor}),children:o},t);var r}))})]})})}renderCalendarBody(){var e,t,o;const{device:r}=this.environment,{query:i,schema:n,collectionContextStore:s}=this.props,{calendar_by:l}=i;if(!l)return null;const a=n[l];if(!a)return null;const c=(void 0===(null===(e=this.stores.resultStore.getState())||void 0===e?void 0:e.blockIds)||0===(null===(t=this.stores.resultStore.getState())||void 0===t?void 0:t.blockIds.length))&&Wt({collectionContextStore:s,groupsPointer:[],hasPartialResults:!1}),d=DS(s),u=this.weeksStore.state,p=(null===(o=s.collectionViewStore())||void 0===o?void 0:o.getFormat().calendar_show_weekends)??!0;return(0,b.jsx)("div",{style:r.isPhone?PS:(h=this.theme,{boxShadow:`-1px 0 0 ${h.tableDividerColor}`,marginTop:1,overflow:"hidden"}),children:u&&u.map((e=>r.isPhone?this.renderMobileWeek(e.start,e.items,l,p,d,c):this.renderWeek(e.start,e.end,e.items,l,p,a,d,c)))});var h}renderWeek(e,t,o,r,i,n,s,l){const{collectionContextStore:a,format:c,schema:d,blockPropertyValueOverlayStore:u}=this.props,p=a.collectionViewStore();if(!p)return;const{calendarStore:h}=this.stores,m=h.state,S=[...Array(i?7:5).keys()].map((t=>this.renderDay(t,(0,yu.Xz)({date:e,daysToAdd:t}),r,n,s,l))),g=[];let C=0;for(const k of o){const o=ge.G.createChildStore(p,{table:M.iU,id:k.id});if(!m.isDragging||m.target!==o||!m.temporaryValue){const n=o.getAssociatedCollectionStore();g.push((0,b.jsx)(mS,{collectionContextStore:a,store:o,startOfWeek:e,endOfWeek:t,showWeekends:i,start:k.start,end:k.end,row:k.row,includeTime:k.includeTime,format:c,schema:(null==n?void 0:n.getSchema())??d,calendarBy:(null==n?void 0:n.getMappedProperty(r))??r,disabled:!o.canEdit(),calendarStore:h,blockPropertyValueOverlayStore:u,resultsStore:this.resultsStore,handleOpenPeekPage:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleOpenPeekPage},o.id))}k.row>C&&(C=k.row)}const f=m.isDragging&&m.temporaryValue&&(0,yu.Y_)(m.temporaryValue,(0,Ee.r)());if(m.isDragging&&m.temporaryValue&&f&&(0,sS.b8)(e,t,f.start,f.end)){const{target:n,temporaryValue:s}=m,l=o.find((e=>e.id===n.id)),p=n.getAssociatedCollectionStore();g.push((0,b.jsx)(mS,{collectionContextStore:a,store:n,startOfWeek:e,endOfWeek:t,start:f.start,end:f.end,row:l?l.row:0,includeTime:"datetime"===s.type||"datetimerange"===s.type,format:c,schema:(null==p?void 0:p.getSchema())??d,calendarBy:(null==p?void 0:p.getMappedProperty(r))??r,showWeekends:i,disabled:!n.canEdit(),calendarStore:h,blockPropertyValueOverlayStore:u,resultsStore:this.resultsStore,handleOpenPeekPage:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleOpenPeekPage},n.id))}const y=(c.calendar_properties?c.calendar_properties.filter((e=>e.visible&&"title"!==e.property)).map((e=>e.property)):[]).length+((0,Go.ls)({collectionContextStore:a})?1:0),v="week"===s?372:124,x=yS(y,c.calendar_properties),w=Math.max((C+1)*x+jS+4,v);return(0,b.jsxs)("div",{style:{...VS,height:w},children:[S,g]},e.toString())}renderDay(e,t,o,r,i,n){const{store:s,collectionContextStore:l}=this.props,{calendarStore:a}=this.stores,{dayStoreMap:c}=a.state,d=ho.default.getIntl(),u=a.state,p="date"===r.type,h=l.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}),m=l.isInHomeWidget.state;let S=c.get(t);S||(S=new ge.G(this.environment,s.pointer,{userId:s.userId,inMemoryRecordCache:s.inMemoryRecordCache}),c.set(t,S));const g=!u.isDragging&&u.hoveredDay===t,C=(0,yu.Bn)({firstDate:t,secondDate:GS(this.environment,this.props.collectionContextStore,this.props.isFullScreen,this.stores.calendarStore)}),f=(0,yu.Y3)(t),y=(0,yu.LY)(t),v=!C&&!f&&"week"!==i,x=d.formatMessage({defaultMessage:"Add an item",id:"database.calendarView.addItemButtonTooltip"});return(0,b.jsxs)(It.Z,{style:y?zS({isInPeekRenderer:this.props.isInPeekRenderer,isInHomeWidget:m,theme:this.theme}):ZS(this.theme),store:S,canDropOnto:this.canEditCalendar()&&p,onSelectableDrop:e=>{ee.createAndCommit({userAction:"Calendar.renderDay",environment:this.environment,perform:r=>{const i=l.collectionStore();if(!i&&"collectionTypedView"!==l.contextType)return;const n=Hr.default.mark("collections.drop_item_lag");Hr.default.measureAfterNextFlush(n,{environment:this.environment,getData:()=>he.yr({collectionContextStore:l,is_native_drop:!1,is_empty:!1})}),H.JN({...e,environment:this.environment,startOfDay:t,calendarBy:o,collectionStore:i,collectionContextStore:l,results:this.resultsStore.state,transaction:r})}})},onDoubleClick:()=>{if(this.canEditCalendar()&&Ce.M_(this.environment)&&h){const e=US(t,o,this.environment,this.props.collectionContextStore,this.isTypedMSVCollection,this.context.overrideLinkClick);ne.W(this.environment,{type:"page",from:"calendar_day_double_click",new_page_id:null==e?void 0:e.id,creating_block_id:null==e?void 0:e.id,...(0,he.Pn)(l)})}},analyticsName:"calendar_day",shouldShowDropZone:!0,children:[g&&(p||f)&&h&&this.canEditCalendar()&&(0,b.jsx)(Xe.ZP,{renderTooltip:()=>x,render:e=>(0,b.jsx)(jt.Z,{ariaLabel:x,icon:ie.R,showShadow:!0,hasBackground:!0,style:{position:"absolute",top:6,left:6,width:20,height:20},onClick:()=>{if(Ce.M_(this.environment)){const e=US(t,o,this.environment,this.props.collectionContextStore,this.isTypedMSVCollection,this.context.overrideLinkClick);ne.W(this.environment,{type:"page",from:"calendar_day_add_button",new_page_id:null==e?void 0:e.id,creating_block_id:null==e?void 0:e.id,...(0,he.Pn)(l)})}},...(0,Ze.Z)(e,{onMouseDown:me.$0})})}),(0,b.jsx)("div",{style:{...f?(w=this.theme,{position:"absolute",fontSize:14,top:4,right:4,height:24,width:24,lineHeight:"24px",borderRadius:"100%",textAlign:"center",color:xe.ZP.white,background:w.calendarTodayBackground}):OS,...v&&{color:this.theme.lightTextColor}},className:n?`${fo.irE} notion-shimmer-text animation-delay-${e} notion-shimmer-calendar-transition`:`${fo.irE} notion-shimmer-calendar-transition`,children:1!==(0,yu.TE)(t)||f?(0,yu.TE)(t):`${new Intl.DateTimeFormat(d.locale,{month:"short",day:"numeric"}).format(new Date(t))} `})]},t.toString());var w}renderMobileWeek(e,t,o,r,i,n){const s=[...Array(r?7:5).keys()].map((r=>{const s=(0,yu.Xz)({date:e,daysToAdd:r});return this.renderMobileDay(r,s,(0,yu.us)(s),t,o,i,n)}));return(0,b.jsx)("div",{style:(l=this.theme,{display:"flex",boxShadow:`0 -1px 0 ${l.tableDividerColor}`,paddingTop:8,paddingBottom:8,fontSize:14}),children:s},e.toString());var l}renderMobileDay(e,t,o,r,i,n,s){const{collectionContextStore:l,query:a,format:c,schema:d,blockPropertyValueOverlayStore:u}=this.props,p=this.canEditCalendar(),h=r.find((e=>(0,sS.b8)(t,o,e.start,e.end?e.end:void 0))),m=(0,yu.TE)(t),S=(0,yu.Bn)({firstDate:t,secondDate:GS(this.environment,this.props.collectionContextStore,this.props.isFullScreen,this.stores.calendarStore)}),g=(0,yu.Y3)(t),C=!S&&!g&&"week"!==n;return(0,b.jsx)(qe.ZP,{popupType:qe.Z4.SlideUp,renderOrigin:t=>{return(0,b.jsxs)(Yt.Z,{style:TS,...t,children:[(0,b.jsx)("div",{style:{...g?kS:_S,...C&&{color:this.theme.lightTextColor}},className:s?`notion-shimmer-calendar-transition notion-shimmer-text animation-delay-${e}`:"notion-shimmer-calendar-transition",children:m}),h&&(0,b.jsx)("div",{style:(o=this.theme,{width:8,height:8,background:o.mediumIconColor,borderRadius:"100%",marginTop:2,marginLeft:"auto",marginRight:"auto"})})]});var o},render:e=>(0,b.jsx)(Ya.LazyMobileCalendarDayMenu,{collectionContextStore:l,initialStartOfDay:t,format:c,schema:d,query:a,calendarBy:i,disabled:!p,onDismiss:e.close,blockPropertyValueOverlayStore:u,resultsStore:this.resultsStore})},m.toString())}handleCalendarClick(e,t){const o=(0,yu.V7)(t.dateRangeStart.state,vh.AK.state),r=DS(this.props.collectionContextStore);if("month"===r){const t="left"===e?-1:1,i=(0,yu.IS)((0,yu.kl)((0,yu._)({date:o,monthsToAdd:t})),vh.AK.state);this.setNewCalendarStart(i,r)}else{const o="left"===e?-7:7,i=(0,yu.IS)((0,yu.Xz)({date:t.dateRangeStart.state,daysToAdd:o}),vh.AK.state);this.setNewCalendarStart(i,r)}}handleMount(e){const t=e.collectionViewStore();if(!t)return;const o=this.startOfWeekSettingStore.state,r=DS(e),i=aS.Z.getLocalDateRangeStart({collectionViewId:t.id,currentUserId:this.environment.currentUser.id}),n=(0,yu.IS)(i,o),s=(0,yu.IS)((0,yu.kl)(i),o),l="month"===r?s:n;this.stores.calendarStore.setState({...this.stores.calendarStore.state,startingMonth:s.valueOf()}),this.setNewCalendarStart(l,r)}setNewCalendarStart(e,t){const{collectionContextStore:o}=this.props,r=o.collectionViewStore();if(!r)return;const i=ES(this.props.collectionContextStore,this.props.isFullScreen,this.environment),n=vh.AK.state,s=(0,yu.V7)(e,n);let l;"month"===t?(l=i?(0,yu.V7)((0,yu._)({date:s,monthsToAdd:1}),n):(0,yu.V7)((0,yu.RN)(s),n),this.verticalScrollableAncestor&&i&&(this.verticalScrollableAncestor.scrollTop=0)):l=s,function(e,t,o,r){pe.t5({dateRangeStart:e,dateRangeEnd:t,collectionContextStore:o}),r.setState({...r.state,startingMonth:(0,yu.kl)((0,yu.V7)(e,vh.AK.state))})}(e,l,this.props.collectionContextStore,this.stores.calendarStore),(0,sS.nQ)(e,l,Date.now())?aS.Z.clearLocalDateRangeStart({collectionViewId:r.id,currentUserId:this.environment.currentUser.id}):aS.Z.setLocalDateRangeStart({collectionViewId:r.id,currentUserId:this.environment.currentUser.id,dateRangeStart:e})}canEditCalendar(){const e=this.props.collectionContextStore.permissionScopes.state;return this.canEdit()&&(e.canEditContent||"collectionTypedView"===this.props.collectionContextStore.contextType)}}BS.displayName="Calendar",BS.contextTypes={...xn.wK,...s.w};const NS=BS;function DS(e){const t=e.collectionViewStore(),o=null==t?void 0:t.getFormatStore();return(null==o?void 0:o.getKeyStore("calendar_view_range").getValue())??"month"}function LS(e){let{collectionContextStore:t,isFullScreen:o,paddingBottom:r,paddingLeft:i,paddingRight:n}=e;const s=t.settingsStore,l=(0,d.VK)((()=>t.permissionScopes.state.canConfigureBlock),[t]);return(0,b.jsx)(Nc,{collectionContextStore:t,title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"No date property",id:"database.calendarView.missingDatePropertyTitle"}),description:l?(0,b.jsx)(B.FormattedMessage,{defaultMessage:"<opensettingslink>Add a date property</opensettingslink> to your database in order to display a Calendar view.",id:"database.calendarView.missingDateProperty",values:{opensettingslink:e=>(0,b.jsx)(Bc,{onClick:()=>{z.r$({collectionContextStore:t,collectionSettingsStore:s}),z.H4({collectionSettingsStore:s,item:{type:"properties",timelineViewTab:"table"}})},children:e})}}):(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Calendar views require a date property in order to display.",id:"database.calendarView.missingDatePropertyNoPermissions"}),style:{paddingLeft:i,paddingRight:n,paddingBottom:o?void 0:r}})}function ES(e,t,o){const{device:r}=o,i="month"===DS(e);return t&&!r.isMobile&&i}function AS(e){var t;const{collectionContextStore:o,isInPeekRenderer:r,theme:i}=e;if(o.isCompactView.state)return{};return{position:"absolute",left:0,right:0,background:(null===(t=o.inheritedBlockColorStore.state)||void 0===t?void 0:t.background)||(r?i.cardContentBackground:i.contentBackground),zIndex:F.VT}}function HS(e,t){return e.isCompactView.state?{}:{position:"absolute",left:0,right:0,background:t.contentBackground,zIndex:F.VT}}function ZS(e){return{position:"relative",flexGrow:1,flexShrink:0,flexBasis:0,borderRight:`1px solid ${e.tableDividerColor}`,borderBottom:`1px solid ${e.tableDividerColor}`,cursor:"default"}}function zS(e){const{isInPeekRenderer:t,isInHomeWidget:o,theme:r}=e;return{...ZS(r),background:o?(0,tl.Fq)(r.tableHomeDividerColor,.05):t?r.cardSidebarBackground:r.sidebarBackground}}function GS(e,t,o,r){const i=t.dateRangeStart.state;return ES(t,o,e)||!i?r.state.startingMonth:(0,yu.kl)((0,yu.V7)(i,vh.AK.state))}function KS(e,t,o,r){var i;const n=(0,Id.Yx)(t,"month_year_long",o);if("month"===e)return n;const s=null==r||null===(i=r.state)||void 0===i?void 0:i[0];if(void 0===s)return"";if((0,yu.Bn)({firstDate:s.start,secondDate:s.end}))return n;return`${(0,Id.Yx)(s.start,(0,yu.Xh)({firstDate:s.start,secondDate:s.end})?"month_short":"month_year_short",o)} - ${(0,Id.Yx)(s.end,"month_year_short",o)}`}function US(e,t,o,r,i,n){const{mainEditorCurrentBlockStore:s}=$o.default.state,{performResult:l}=ee.createAndCommit({userAction:"Calendar.createBlockInDay",environment:o,perform:l=>{const a=i.state,c=Z.IW({environment:o,collectionContextStore:r,groupsPointer:[],insertAtIndex:0,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:l,from:"calendar"});if(!c)return;const d=c.newStore.getAssociatedCollectionStore(),u=(null==d?void 0:d.getMappedProperty(t))??t;H.xD({type:"timestamp",environment:o,store:c.newStore,propertyId:u,timestampMs:e,transaction:l});return function(e,t,o){o?o(e):ae.c4({environment:t,url:e})}(ce.mb({store:c.newStore,mainEditorCurrentBlockStore:s,collectionContextStore:r,showMoveTo:a})??(0,Ko.ZP)({store:c.newStore,pageVisitSource:h.tY.Create}),o,n),U.Xd({collectionContextStore:r,resultsStore:void 0}),c.newStore}});return l}var WS=o(6776);function $S(e){const{environment:t,newStore:o,previousStore:r}=e;Y.eP({environment:t,store:o}),pe.Z5({store:o}),WS.Z.setState({store:o,editMode:"new",previousStore:r})}class qS extends Ho.Z{constructor(){super(...arguments),this.storeTypes={mouseStore:Zo.Z},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderProperty=e=>(0,b.jsx)(cg,{blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:this.props.store,schema:this.props.schema,showProperties:this.props.showProperties,collectionContextStore:this.props.collectionContextStore,disabled:this.props.disabled,isEditingStore:this.isEditing,mouseIsEnteredStore:this.mouseIsEntered,property:e}),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseMove=()=>{return e=this.stores.mouseStore,void(Qo.Z.state||e.setState({...e.state,mouseEntered:!0}));var e},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseLeave=()=>{var e;(e=this.stores.mouseStore).setState({...e.state,mouseEntered:!1})},this.handleMouseMoveThrottled=N.P2(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseMove,100),this.handleMouseLeaveDebounced=N.Ds(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseLeave,100),this.mouseIsEntered=this.createComputedStore((()=>this.stores.mouseStore.state.mouseEntered)),this.isEditing=this.createComputedStore((()=>{const e=qo.Z.state;return Boolean(e.isActive&&e.store.id===this.props.store.id)})),this.newItemEditMode=this.createComputedStore((()=>{const e=WS.Z.state;return e.store&&e.store.id===this.props.store.id?e.editMode:void 0})),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleBlockPropertyTab=()=>lg(this.environment,this.props.blockPropertyValueOverlayStore,this.props.store,this.props.schema,this.props.showProperties,this.props.collectionContextStore,this.isEditing),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleBlockPropertyUntab=()=>ag(this.environment,this.props.blockPropertyValueOverlayStore,this.props.store,this.props.schema,this.props.showProperties,this.props.collectionContextStore,this.isEditing),this.shouldCaptureKeyboard=this.createComputedStore((()=>Jo.default.state.stores.length>0&&Jo.default.state.stores[0].id===this.props.store.id))}activate(){const e=XS(this.props.store,this.props.collectionContextStore);e&&(this.props.handleOpenPeekPage(),ae.c4({environment:this.environment,url:e}))}didMount(){super.didMount(),this.isEditing.state&&"new"===this.newItemEditMode.state&&J.NX({store:this.props.store.getBlockTitleStore()})}willUnmount(){super.willUnmount(),WS.Z.reset(),qo.Z.reset()}renderComponent(){const{device:e}=this.environment,{showProperties:t}=this.props,o=e.isPhone&&this.props.showProperties.length>0,r=(0,b.jsx)(eg,{collectionContextStore:this.props.collectionContextStore,toggleButton:this.props.toggleButton,subitemPath:this.props.subitemPath});if(o){const o=t.indexOf("title"),[i,s]=[t.slice(0,o+1),t.slice(o+1)];return(0,b.jsxs)("div",{style:{display:"flex"},children:[r,(0,b.jsxs)(No.Z,{href:JS(this.props.store),metaHref:XS(this.props.store,this.props.collectionContextStore),external:!1,style:(n=this.theme,{flexGrow:1,textDecoration:"none",overflow:"hidden",borderBottom:`1px solid ${n.tableDividerColor}`}),innerStyle:{paddingLeft:4,paddingRight:4,paddingBottom:4,paddingTop:4},children:[(0,b.jsx)("div",{style:{display:"flex",alignItems:"center"},children:i.map(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderProperty)}),s.length>0&&(0,b.jsx)("div",{style:{display:"flex",alignItems:"center",paddingLeft:e.isMobile?0:6,paddingBottom:e.isMobile?0:4},children:s.map(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderProperty)})]})]})}return(0,b.jsx)(Bo.Z,{debugName:"CollectionListViewItem",capture:this.shouldCaptureKeyboard.state,onShiftEnter:this.props.onShiftEnter,children:(0,b.jsxs)("div",{style:{display:"flex"},children:[r,(0,b.jsx)(No.Z,{href:JS(this.props.store),metaHref:XS(this.props.store,this.props.collectionContextStore),altHref:XS(this.props.store,this.props.collectionContextStore),onClick:()=>function(e,t){tg(e),t()}(this.props.store,this.props.handleOpenPeekPage),external:!1,style:(i=this.isEditing.state?"multi":"single",{display:"flex",flexGrow:1,textDecoration:"none",overflow:"hidden",borderRadius:4,..."single"===i?{height:30}:{minHeight:30}}),innerStyle:{display:"flex",alignItems:"center",paddingLeft:4,paddingRight:4,userSelect:this.isEditing.state?void 0:"none",WebkitUserSelect:this.isEditing.state?void 0:"none"},hoveredStyle:{background:this.isEditing.state?"transparent":this.theme.buttonHoveredBackground},pressedStyle:{background:this.isEditing.state?"transparent":this.theme.buttonPressedBackground},onMouseEnter:this.handleMouseMoveThrottled,onMouseMove:this.handleMouseMoveThrottled,onMouseLeave:this.handleMouseLeaveDebounced,children:t.map(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderProperty)})]})});var i,n}}qS.displayName="CollectionListViewItem";const QS=qS;function YS(e,t){const o=t[e];return Boolean(o&&!fe.uk.includes(o.type))}function XS(e,t){const{mainEditorCurrentBlockStore:o}=$o.default.state;return ce.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})}function JS(e){return(0,Ko.ZP)({store:e,fullyQualified:!1,pageVisitSource:h.tY.LinkInPage})}function eg(e){let{collectionContextStore:t,toggleButton:o,subitemPath:r}=e;const i=(0,d.VK)((()=>t.currentSubitemFormatStoreForUiDisplay.state),[t]),n=(null==r?void 0:r.length)??0;if(!i)return null;const s=Math.max((n-1)*Go.Hw,0)+Go.gY;return o?(0,b.jsxs)("div",{style:{paddingTop:4,display:"flex"},children:[(0,b.jsx)("div",{style:{width:s}}),o]}):(0,b.jsx)("div",{style:{minWidth:s+Go.Hw}})}function tg(e){pe.IH({store:e})}function og(e,t,o,r,i){if("title"===e){To.xv({environment:i,blockPropertyValueOverlayStore:o});const e=t.getBlockTitleStore();Y.eP({environment:i,store:t}),pe.Z5({store:t}),J.NX({store:e})}else e?(To.xv({environment:i,blockPropertyValueOverlayStore:o}),To.bA({environment:i,blockPropertyValueOverlayStore:o,store:t,property:e,format:Mo.C.ListView,collectionContextStore:r})):To.xv({environment:i,blockPropertyValueOverlayStore:o});tg(t)}function rg(e,t,o){To.xv({environment:e,blockPropertyValueOverlayStore:t}),Y.Ys({environment:e,store:o}),tg(o)}function ig(e,t,o,r,i){return t.isDefined()?r.filter((r=>{const n="title"!==r&&i.state;return!xl.wV({property:r,schema:o,block:t.getModel(),getRecordModel:t.getRecordModel,userId:e.currentUser.id,userTimeZone:(0,Ee.r)(),intl:ho.default.getIntl()})||n})):[]}function ng(e,t,o,r,i,n){const s=t.state,l=s.isOpen?s.property:"title",a=ig(e,o,r,i,n),c=a.findIndex((e=>e===l)),d=N.dF(a,((e,t)=>t<c&&YS(e,r)));return d||(n.state?"title":function(e,t){return N.dF(e,(e=>YS(e,t)))}(a,r))}function sg(e,t,o,r,i,n){const s=t.state,l=s.isOpen?s.property:"title",a=ig(e,o,r,i,n),c=a.findIndex((e=>e===l)),d=a.find(((e,t)=>t>c&&YS(e,r)));return d||(n.state?"title":function(e,t){return e.find((e=>YS(e,t)))}(a,r))}function lg(e,t,o,r,i,n,s){og(sg(e,t,o,r,i,s),o,t,n,e)}function ag(e,t,o,r,i,n,s){og(ng(e,t,o,r,i,s),o,t,n,e)}function cg(e){let{property:t,blockPropertyValueOverlayStore:o,store:r,schema:n,showProperties:s,collectionContextStore:l,disabled:c,isEditingStore:u,mouseIsEnteredStore:p}=e;const h=(0,a.O7)(),m=(0,i.useCallback)((()=>ag(h,o,r,n,s,l,u)),[h,o,r,n,s,l,u]),S=(0,i.useCallback)((()=>lg(h,o,r,n,s,l,u)),[h,o,r,n,s,l,u]),g=(0,d.VK)((()=>ce.Bm({store:r,collectionContextStore:l})),[r,l]),C=(0,d.VK)((()=>{const e=l.isInHomeWidget.state,o=l.isUnlistedView.state&&l.isCompactView.state;return"title"===t&&p.state&&!e&&!o}),[l,p,t]),f=(0,d.VK)((()=>r.canEdit()),[r]),y=(0,d.VK)((()=>l.collectionViewStore()),[l]),v=(0,d.VK)((()=>u.state||l.isCompactView.state),[u,l]),x=(0,d.VK)((()=>l.permissionScopes.state.isLocked),[l]);return g?(0,b.jsx)(Ro.Z,{store:r,property:t,disabled:c||!f,locked:x,format:Mo.C.ListView,tableWrap:!1,blockPropertyValueOverlayStore:o,collectionStore:g,collectionViewStore:y,forceMouseEntered:C,showIfEmpty:v,onBgClick:()=>rg(h,o,r),onEnter:()=>rg(h,o,r),onEsc:()=>rg(h,o,r),onTab:S,onUntab:m,onClick:()=>tg(r)},t):null}function dg(){return{marginTop:1,marginBottom:1,borderRadius:4}}const ug=i.memo((function(e){let{groupFormat:t,store:o,format:r,disabled:n,collectionContextStore:s,schema:l,blockPropertyValueOverlayStore:c}=e;const u=(0,a.O7)(),p=(0,i.useMemo)((()=>t?[t]:[]),[t]),h=(0,i.useMemo)((()=>(r.list_properties?r.list_properties:[]).filter((e=>e.visible)).map((e=>{let{property:t}=e;return t}))),[r]),{permissionScopes:m}=(0,d.VK)((()=>({permissionScopes:s.permissionScopes.state})),[s]),S=(0,d.VK)((()=>s.groupsStore.getGroupState(p)),[p,s]),g=(0,d.VK)((()=>!n&&o.canEdit()&&m.canEditContent&&!m.isSyncedCollection),[n,o,m]),C=(0,i.useCallback)((()=>{if(!S)return;const e=s.collectionStore();if(!e||!s.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const t=Jo.default.state.stores[0];if(!t)return;const o=s.subitemTreeStore.state,r=(0,Gr.DY)(o.children,(e=>e.value.store===t));if(!r)return;const i=r?(0,Go.Af)(r.map((e=>e.value.store))):"",n=s.subitemExpandedStore.state.get(i),l=Boolean(null==n?void 0:n.isExpanded);ee.createAndCommit({userAction:"CollectionListView.onItemShiftEnter",environment:u,perform:o=>{const i=Z.yk({environment:u,collectionContextStore:s,groupsPointer:S.groupsPointer,store:t,before:!1,collectionStore:e,transaction:o,subitemPath:r,subitemInsertDirection:l?"into":"below",from:"list_selection_overlay_shift_enter"});i&&$S({environment:u,newStore:i,previousStore:t})}}),L.sd(u,"list_item_edit_mode_enter",{...(0,he.Pn)(s),block_id:t.id,from:"shiftEnter",view_type:"list"})}),[s,u,S]),f=(0,i.useCallback)(((e,t)=>{$S({environment:u,newStore:t,previousStore:e})}),[u]),y=(0,i.useMemo)((()=>({schema:l,collectionViewBlockStore:o,showProperties:h,disabled:n,blockPropertyValueOverlayStore:c,collectionContextStore:s,onShiftEnter:C})),[c,s,n,C,l,h,o]),v=(0,i.useCallback)((e=>{const{store:t,parentStore:o,subitemPath:r,indentLevel:i}=e;if(o)return(0,b.jsx)(Ms,{store:t,collectionStore:o,subitemPath:r,indentLevel:i,collectionContextStore:s,disabled:n,groupsPointer:p,styles:{borderBottom:void 0,borderTop:void 0},onSubitemCreate:e=>{pe.Z5({store:e,transient:!1}),WS.Z.setState({store:e,editMode:"new",previousStore:void 0})}})}),[s,n,p]);return S?(0,b.jsx)(ii,{collectionContextStore:s,groupsPointer:p,format:r,canDrag:g,resultProps:y,canDrop:!0,resultComponent:QS,disabled:n,shouldShowHoverMenu:!0,direction:oi.Vertical,analyticsName:"list",getItemSelectableStyle:dg,emptyDroppableSize:0,onSelectableInsertRow:f,nestedCreateSubitemButton:v}):null}));function pg(e){const{isFullScreen:t,hasGroups:o,hasPartialResults:r,hasSearchQuery:i,overrideNumShimmerRows:n}=e,s=(0,tn.DK)(),l=(0,d.VK)((()=>null==s?void 0:s.isCompactView.state),[s]);if(!(0,Br.Z)(!0,0,100))return null;let a=1;void 0!==n?a=n:o||r||i||(a=t?10:3);const c=a>1?["50%","30%","40%","40%","30%","30%","40%","40%","30%","30%"]:["35%"],u=N.DZ(a).map((e=>(0,b.jsx)(on,{widthPercentage:e<c.length?c[e]:void 0},e)));return(0,b.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",marginLeft:l?8:3},children:u})}const hg=i.memo((function(e){const t=(0,a.O7)(),o=(0,u.Fg)(),{store:r,schema:n,format:s,paddingBottom:l,paddingLeft:c,paddingRight:p,isFullScreen:m,isRootChild:S,isInPeekRenderer:g,minWidth:C,disabled:f,collectionContextStore:y}=e,v=(0,d.VK)((()=>ce.az(y,m)),[y,m]),x=s.collection_group_by,w=(0,d.VK)((()=>null==y?void 0:y.isCompactView.state),[y]),k=(0,d.VK)((()=>"collectionVirtualView"===(null==y?void 0:y.contextType)),[y]),_=(0,d.VK)((()=>(0,we.hJ)()),[]),T=(0,i.useCallback)(((e,o,r)=>{!function(e,t,o,r,i){if(r.device.isMobile)se._c({environment:r,store:e,pageVisitSource:h.tY.Create});else if(t)$S({environment:r,newStore:e,previousStore:void 0});else{const{groupFormat:t}=o,n=t?[t]:[],s=i.groupsStore.getGroupState(n),l="collectionTypedView"===i.contextType;le.CH({environment:r,store:e,peekMode:ce.kr(i),showMoveTo:l,resultsStore:null==s?void 0:s.resultsStore,collectionContextStore:i,pageVisitSource:h.tY.Create})}}(e,o,r,t,y)}),[t,y]),O=(0,i.useCallback)((t=>_?(0,b.jsx)(Xn,{reducerId:"list_groups",store:r,collectionContextStore:y,disabled:f,isFullScreen:m,isRootChild:S,paddingLeft:c,stickyLeft:!1,renderGroup:t=>(0,b.jsx)(yg,{...e,groupFormat:t}),getGroupStyle:e=>gg(e,o),renderHeader:e=>(0,b.jsx)(Cg,{args:e}),onGroupHeaderAddItem:T}):(0,b.jsx)(an,{store:r,id:"list_groups",groupBy:t,groupsFormatKey:re.Uh,groupAggregationKey:re.dQ,format:s,schema:n,collectionContextStore:y,disabled:f,isFullScreen:m,renderGroup:t=>(0,b.jsx)(yg,{...e,groupFormat:t}),renderHeader:e=>(0,b.jsx)(Cg,{args:e}),getGroupStyle:e=>gg(e,o),onGroupHeaderAddItem:T,paddingLeft:c,isRootChild:S,isInPeekRenderer:g})),[y,f,s,m,_,g,S,T,c,e,n,r,o]);return(0,rs.Z)((o=>(0,b.jsxs)("div",{style:{paddingBottom:l,paddingLeft:c,paddingRight:p,minWidth:C},className:fo.nM$,children:[(0,b.jsx)(It.Z,{store:r,shouldShowHalo:!m&&!w,canSelect:!m,analyticsName:"list",style:mg(s,w,k),...o,children:x?O(x):(0,b.jsx)(yg,{...e,groupFormat:x})}),!v&&(0,b.jsx)(di.Z,{onChange:e=>function(e,t,o,r){const i=o.isLoading.state,n=o.groupsStore.getGroupState([]);if(!n)return;if("collectionVirtualView"===o.contextType)return;const s=n.reducerResultStore.state;e<vo.Z.incrementScrollOffset&&s&&!i&&s.hasMore&&Z.ID({collectionContextStore:o,environment:t,incrementLimitArgs:{isFullScreen:r,currentResultCount:s.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}(e,t,y,m)})]})))}));function mg(e,t,o){return{display:"flex",flexDirection:"column",paddingTop:e.collection_group_by||t||o?void 0:4,paddingBottom:4}}function Sg(e){return{width:14,height:14,marginLeft:4,marginRight:6,fill:e.lightIconColor}}function gg(e,t){return 0===e.index?{}:{borderTop:`1px solid ${t.tableDividerColor}`}}function Cg(e){let{args:t}=e;const{collectionContextStore:o}=t,r=(0,u.Fg)(),i=(0,d.VK)((()=>o.isCompactView.state),[o]);return(0,b.jsx)(Nt,{...t,height:i?yo.yZ:48,getComputedStickyStyle:e=>function(e,t){return{boxShadow:e?`0 -1px 0 ${t.contentBackground}`:void 0}}(e,r)})}function fg(e,t,o,r,i){if(!Ce.M_(t))return;const n=o.currentSubitemFormatStoreForUiDisplay.state;ee.createAndCommit({userAction:"CollectionListView.handleAddItemClick",environment:t,perform:s=>{!function(e){var t;const{transaction:o,environment:r,results:i,collectionContextStore:n,isFullScreen:s,groupsPointer:l,insertAtIndex:a,from:c,useCrdt:d}=e;n.searchQuery.state&&pe.Ug({searchQuery:"",collectionContextStore:n,isFullScreen:s});const u=null===(t=n.groupsStore.getGroupState(l))||void 0===t?void 0:t.resultsStore;if(!u)return;let p;a>0&&(p=i[a]);const m=Z.IW({environment:r,collectionContextStore:n,groupsPointer:l,insertAtIndex:a,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:o,from:c,useCrdt:d});if(!m)return;const S=m.coercionSucceeded,g=m.newStore;r.device.isMobile?se._c({environment:r,store:g,pageVisitSource:h.tY.Create}):S?$S({environment:r,newStore:g,previousStore:p}):le.CH({environment:r,store:g,peekMode:(0,ce.kr)(n),resultsStore:u,collectionContextStore:n,pageVisitSource:h.tY.Create}),ne.W(r,{from:c,type:"page",new_page_id:g.id,creating_block_id:g.id,...(0,he.Pn)(n)})}({transaction:s,environment:t,results:e.resultsStore.state,collectionContextStore:o,isFullScreen:r,groupsPointer:e.groupsPointer,insertAtIndex:e.resultsStore.state.length,from:n?"list_view_add_parent_item_bottom":"list_view_add_item_bottom",useCrdt:i})}})}const yg=i.memo((function(e){let{store:t,format:o,schema:r,disabled:n,groupFormat:s,isFullScreen:l,collectionContextStore:a,blockPropertyValueOverlayStore:c}=e;const p=(0,u.Fg)(),h=void 0!==s,m=(0,i.useMemo)((()=>s?[s]:[]),[s]),S=(0,d.VK)((()=>a.groupsStore.getGroupState(m)),[a,m]),g=(0,d.VK)((()=>null==S?void 0:S.reducerResultStore.state),[S]),C=(0,d.VK)((()=>a.groupsStore.anyGroupHasResults()),[a]),f=(0,d.VK)((()=>{const e=a.permissionScopes.state;return{canEditContent:e.canEditContent,isSyncedCollection:e.isSyncedCollection}}),[a]),y=(0,d.VK)((()=>"collectionTypedView"===a.contextType),[a]),v=(0,d.VK)((()=>a.isInHomeWidget.state),[a]),x=(0,d.VK)((()=>!v&&C&&!n&&t.canEdit()&&(f.canEditContent||y)&&!f.isSyncedCollection),[v,y,n,C,f.canEditContent,f.isSyncedCollection,t]),w=(0,d.VK)((()=>""!==a.searchQuery.state),[a]),k=(0,d.VK)((()=>a.isCompactView.state),[a]),_=(0,d.VK)((()=>void 0!==g&&(null==g?void 0:g.blockIds.length)>0),[g]),T=(0,d.VK)((()=>Wt({collectionContextStore:a,groupsPointer:m,hasPartialResults:_})),[a,m,_]),O=(0,d.VK)((()=>ce.VM({collectionContextStore:a,reducerResult:g,isFullScreen:l})),[a,g,l]);return S?(0,b.jsxs)("div",{style:{paddingBottom:s?k?8:16:void 0},children:[(0,b.jsx)(ug,{groupFormat:s,store:t,format:o,disabled:n,collectionContextStore:a,schema:r,blockPropertyValueOverlayStore:c}),T&&(0,b.jsx)(pg,{isFullScreen:l,hasGroups:h,hasPartialResults:_,hasSearchQuery:w,overrideNumShimmerRows:k&&!_?6:void 0}),O&&(0,b.jsx)(no,{groupsPointer:m,store:t,collectionContextStore:a,format:o,isFullScreen:l,incrementLimitsInRelatedGroups:!1}),x&&(0,b.jsxs)(b.Fragment,{children:[O&&(0,b.jsx)("div",{style:{width:"100%",borderTop:s?void 0:`1px solid ${p.tableDividerColor}`,marginTop:4,marginBottom:4}}),(0,b.jsx)(vg,{collectionContextStore:a,isFullScreen:l,groupState:S})]})]}):null}));function vg(e){let{groupState:t,collectionContextStore:o,isFullScreen:r}=e;const i=(0,u.Fg)(),n=(0,a.O7)();return(0,b.jsxs)(Yt.Z,{onClick:e=>fg(t,n,o,r,(0,Co.SL)({event:e,source:"collection_non_table_view"})),onMouseDown:me.$0,style:{display:"flex",alignItems:"center",height:30,borderRadius:4,fontSize:14},children:[(0,ie.R)(Sg(i)),(0,b.jsx)("div",{style:{color:i.lightTextColor},children:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"New",id:"database.listView.addItemButtonTitle"})})]})}var xg=o(2005);class bg extends p.default{getInitialState(){return{query:"",limit:20}}}const wg=bg;var kg=o(11470);const _g=(0,B.defineMessages)({searchPlaceholder:{defaultMessage:"Search for a page…",id:"collectionNoDateMenu.searchPlaceholder"}}),Tg=p.default.createClass(void 0);function Og(e){let{collectionViewBlockStore:t,collectionViewType:o,property:r,collectionContextStore:n,onClose:s,onAddPage:l}=e;const c=(0,a.O7)(),u=(0,a.Fy)(),p=(0,d.qz)(void 0,wg),h=(0,d.qz)(void 0,Tg),m=(0,d.VK)((()=>p.state.query),[p]),S=(0,d.VK)((()=>h.state),[h]),g=(0,d.VK)((()=>{const{query:e,limit:t}=p.state;return{type:"results",filter:{operator:"and",filters:[{property:r,filter:{operator:"is_empty"}}]},limit:t,searchQuery:e}}),[r,p]),C=(0,i.useCallback)((e=>{p.setState({query:e.target.value,limit:Rg})}),[p]),f=(0,i.useCallback)((e=>{const t=p.state.limit,o=n.isLoading.state;e<Pg&&S&&S.hasMore&&!o&&p.setState({...p.state,limit:t+Rg})}),[n,S,p]),y=(0,i.useCallback)((()=>{let e;return e="calendar"===o?u.isMobile?(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Click to add date.",id:"collectionNoDateMenu.addResultToCalendar.prompt.basic"}):(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Click or drag to calendar to add date.",id:"collectionNoDateMenu.addResultToCalendar.prompt"}):(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Click to add to the timeline",id:"collectionNoDateMenu.addResultToTimeline.prompt"}),S?S&&0===S.blockIds.length?(0,b.jsx)(Pe.Z,{title:e,children:(0,b.jsx)(_m.Z,{title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"No results",id:"collectionNoDateMenu.noResults.title"})})}):(0,b.jsx)(Oe.Z,{type:Oe.i.Vertical,sections:[{key:"results",render:t=>(0,b.jsx)(Pe.Z,{...t,title:e}),items:Ig(S.blockIds,n,t,r,l,c,o)}],initialFocus:m?0:void 0}):(0,b.jsx)(Pe.Z,{children:(0,b.jsx)(jg,{})})}),[t,o,S,n,r,l,c,m,u.isMobile]);return(0,b.jsxs)(xg.Tp,{title:void 0,onCancel:s,desktopWidth:320,children:[(0,b.jsx)(Pe.Z,{isInput:!0,children:(0,b.jsx)(Oh.ZP,{placeholder:ho.default.formatMessage(_g.searchPlaceholder),focus:!u.isMobile||void 0,focusAfterAnimation:!0,value:m,onChange:C})}),(0,b.jsx)(ze.Z,{id:"no_date_results",reducer:g,collectionContextStore:n,render:y,resultStore:h}),(0,b.jsx)(di.Z,{onChange:f})]})}const Vg=i.memo(Og,po.Z),Pg=200,Rg=20;function Mg(e){let{props:t,store:o,disabled:r,url:n,collectionViewType:s}=e;const l=(0,a.O7)(),c=(0,a.Fy)(),d=i.useRef(null),u=(0,b.jsx)(kg.Z,{...t,ref:d,store:o,hidePath:!0,disabled:r,right:void 0!==n?(0,b.jsx)(Qe.Z,{isSmall:!0,href:n,disabled:r,onClick:()=>{L.tM(l)},children:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Open",id:"collectionNoDateMenu.view.button.label"})},o.id):void 0,dontShrinkRight:!0});return"calendar"!==s||c.isMobile?u:(0,b.jsx)(It.Z,{canSelect:!1,canDrag:!r,canEditText:!1,store:o,shouldShowDropZone:!0,getGhostElement:()=>function(e){if(e.current){return[vu.eN(e.current)]}return[]}(d),analyticsName:"calendar_no_date_item",children:u})}function jg(){return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(Nr.Z,{style:{display:"flex",height:16,marginTop:4,marginLeft:12,marginRight:12,borderRadius:12,width:"50%"}}),(0,b.jsx)(Nr.Z,{style:{display:"flex",height:16,marginTop:6,marginLeft:12,marginRight:12,marginBottom:6,borderRadius:12,width:"75%"}})]})}function Ig(e,t,o,r,i,n,s){const l=e.map((e=>ge.G.createChildStore(o,{table:M.iU,id:e}))).filter((e=>!xl.Gl(e.getPropertyStore(r).getValue()))).map((e=>{const{mainEditorCurrentBlockStore:o}=$o.default.state;if(!o)return;const r=(0,ce.mb)({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1});return{key:e.id,render:t=>(0,b.jsx)(Mg,{props:t,store:e,disabled:!e.canEdit(),url:r,collectionViewType:s}),action:()=>{e.canEdit()&&(i(e),L.ze(n))}}}));return N.oA(l)}var Fg=o(65669),Bg=o(63087),Ng=o(37850),Dg=o(63811);class Lg{constructor(e,t){this.queuedCollectionEmit=void 0,this.queuedBlockIdsToRefetch=void 0,this.isServerRequestRequired=void 0,this.collectionContextStore=void 0,this.environment=void 0,this.isServerQueryCollectionRequired=(e,t)=>{const o=this.collectionContextStore.isClientModeEnabled.state;if(o&&t&&"collectionTypedView"===this.collectionContextStore.contextType)return!0;const r=Boolean(e&&(0,Dg.P9)(Bg.y,e)&&e.hasMore);if(o&&!r)return!1;const i=this.collectionContextStore.remoteRequestStore.state;if(!i)return!0;return!!(0,ut.qP)(i.loader.reducers||{}).some((e=>{let[t,o]=e;return"results"!==o.type}))||!(e&&(0,Dg.P9)(Bg.y,e)&&!e.hasMore)},this.throttledRefetch=(0,Fg.Z)((e=>this.refetchFromRemote({...e,queuedTimestamp:Date.now()}))),this.processCollectionRefetch=async e=>{const t=this.queuedBlockIdsToRefetch,o=this.isServerRequestRequired;this.reset(),o&&this.throttledRefetch({src:e}),t&&await pe.fI({environment:this.environment,collectionContextStore:this.collectionContextStore,blockIdToMinimumVersion:t})},this.refetchFromRemote=async e=>{const t=co.default.getEligibleGroup({experimentId:"collection_client_refetch_throttle_time_ms",defaultGroup:"control"}),o="control"===t?1e3:parseInt(t);await Promise.all([pe.dj(this.environment,this.collectionContextStore,e),(0,Ng.Vs)(o)])},this.queuedCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={},this.collectionContextStore=e,this.environment=t}reset(){this.queuedCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={}}addBlockIdToRefetch(e,t){this.queuedBlockIdsToRefetch[e]=Math.max(this.queuedBlockIdsToRefetch[e]??0,t)}async handleCollectionEmit(e){const{src:t,passThroughData:o,shouldQueueCollectionEmit:r,isCollectionTypeChange:i}=e;if((0,Dg.P9)(Bg.y,o)&&null!=o&&o.blockIdToVersion&&(0,ut.qP)(o.blockIdToVersion).forEach((e=>{let[t,o]=e;return this.addBlockIdToRefetch(t,o)})),this.isServerRequestRequired=this.isServerRequestRequired||this.isServerQueryCollectionRequired(o,i),!r)return await this.processCollectionRefetch(t);this.queuedCollectionEmit=!0}async maybeProcessQueuedCollectionEmit(e){if(this.queuedCollectionEmit)return await this.processCollectionRefetch(e)}}var Eg=o(91007),Ag=o(70475),Hg=o(62967),Zg=o(43664);class zg extends p.default{getInitialState(){return{textStoresBeingEdited:[],lastBlockPropertyValueOverlayCloseTime:void 0}}getNumberOfTextStoresBeingEdited(){return this.state.textStoresBeingEdited.length}textStoresWithEmptyProperty(e){return this.state.textStoresBeingEdited.filter((t=>{const o=t.getPropertyValue(e);return""===So.QaF(o)}))}}const Gg=zg;var Kg=o(13966);function Ug(e){return{boxShadow:`1px 0 0 ${e.regularDividerColor}`,marginRight:1}}const Wg=(0,B.defineMessages)({delete:{id:"CollectionsBulkActionsToolbar.deleteButton.tooltip",defaultMessage:"Delete"}});function $g(e){const t=(0,tn.Y$)(),{marginLeft:o}=e,r=(0,a.O7)(),n=(0,d.qz)(void 0,Gg),s=(0,i.useRef)(null),[l,c]=(0,i.useState)(!1),p=(0,d.VK)((()=>n.state.lastBlockPropertyValueOverlayCloseTime),[n]),h=(0,d.VK)((()=>Jo.default.state.stores.filter((e=>sh.R.findBlockFromStore(e)))),[p]),m=(0,d.VK)((()=>Jo.default.state.stores),[]),S=(0,d.VK)((()=>co.default.checkGate("collection_group_ui_parent")),[])?m:h,g=S.length,C=(0,d.VK)((()=>n.getNumberOfTextStoresBeingEdited()),[n]),f=(0,d.VK)((()=>{var e;return!!(0,ce.fk)({environment:r,collectionContextStore:t})&&(C>0||S.length>=1&&(0,ce.v_)(S,null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.id))}),[t,r,C,S]),y=(0,u.yK)((e=>({inner:{position:"absolute",top:1,left:0+(o??0),display:"inline-flex",justifyContent:"center",alignItems:"center",borderRadius:5,background:e.popoverBackground,boxShadow:e.lightBoxShadow,height:32},outer:{position:"sticky",top:0,left:0,zIndex:F.mJ,visibility:l?"visible":"hidden"},blockActionMenuButton:{width:30,height:"100%",borderRadius:void 0,borderTopRightRadius:5,borderBottomRightRadius:5},blockActionMenuButtonIcon:{fill:e.regularTextColor},trashButton:{borderRadius:0,height:"100%",border:0,...Ug(e),width:28},trashButtonIcon:{width:16},trashButtonIconHovered:{fill:e.accentColors.red[500]}})),[l,o]);return(0,b.jsx)(Ds.Z,{isVisible:f,enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},exitAnimationStyle:{opacity:0},onAnimationEnd:e=>{e||c(!1)},render:()=>(0,b.jsx)(xm.Z,{capture:!0,render:e=>(0,b.jsx)("div",{ref:s,...e,style:y.outer,children:(0,b.jsx)(Fs.p,{allowSelectionWithin:!1,children:(0,b.jsxs)("div",{style:y.inner,children:[(0,b.jsx)(qg,{selectedItemCount:g,collectionsBulkActionsToolbarStore:n}),(0,b.jsx)(oC,{collectionsBulkActionsToolbarStore:n,selectedItems:S,marginLeft:o,setIsReadyToRender:c,outerContainerRef:s}),(0,b.jsx)(Xe.ZP,{renderTooltip:()=>(0,b.jsx)("div",{children:ho.default.formatMessage(Wg.delete)}),render:e=>(0,b.jsx)(jt.Z,{...e,ariaLabel:ho.default.formatMessage(Wg.delete),icon:()=>(0,O.y)(y.trashButtonIcon),style:y.trashButton,hoveredStyle:y.trashButtonIconHovered,hasBackground:!0,isDarkIconColor:!0,showShadow:!0,onClick:async()=>{var e;L.dh(r,{analyticsName:Hg.RE.deleteName.defaultMessage,from:"bulk_actions_toolbar",block_type:"page",collection_id:null===(e=t.collectionStore())||void 0===e?void 0:e.id}),await nh.Qw({environment:r,blocks:S,shouldCheckSuggestEdit:!0})}}),placement:Xe.ug.Top}),(0,b.jsx)(Kg.Z,{store:S[0],fadeIn:!1,style:y.blockActionMenuButton,hoveredStyle:y.blockActionMenuButton,iconStyle:y.blockActionMenuButtonIcon,extraAnalyticsData:{isFromBulkActionsToolbar:!0}})]})})})})})}function qg(e){const{collectionsBulkActionsToolbarStore:t,selectedItemCount:o}=e,r=(0,a.O7)(),i=(0,d.VK)((()=>t.getNumberOfTextStoresBeingEdited()),[t]),n=(0,d.VK)((()=>i>0?i:o),[i,o]),s=(0,u.yK)((e=>({button:{color:e.blueColor,fontSize:14,whiteSpace:"nowrap",height:"100%",alignItems:"center",display:"flex",paddingRight:10,paddingLeft:10,borderTopLeftRadius:5,borderBottomLeftRadius:5,fontVariantNumeric:"tabular-nums",...Ug(e)}})),[]);return(0,b.jsx)(Yt.Z,{style:s.button,onClick:()=>Y.ZH(r),children:(0,b.jsx)(B.FormattedMessage,{id:"SelectedItemCountWidget.numItemsSelected",defaultMessage:"{itemsSelectedCount} selected",values:{itemsSelectedCount:n}})})}const Qg=6,Yg=450,Xg=2,Jg=32,eC=150,tC=["title","rollup","formula","button"];function oC(e){const{outerContainerRef:t,collectionsBulkActionsToolbarStore:o,selectedItems:r,marginLeft:n,setIsReadyToRender:s}=e,l=(0,tn.Y$)(),a=(0,d.VK)((()=>l.normalizedSchemaStore.state),[l]),c=(0,i.useRef)(null),u=(0,d.VK)((()=>l.databaseType===m.Fi&&r.some((e=>e.getPropertyValue(Ag.C.MeetingNoteToCalendarEventRelation)))),[l,r]),p=(0,d.VK)((()=>{var e;const t=l.normalizedFormatStore.state;return(null==t||null===(e=t.table_properties)||void 0===e?void 0:e.filter((e=>{const t=l.collectionStore();if((0,xl.LC)(null==t?void 0:t.getModel(),e.property))return!u;const o=a[e.property];return e.visible&&o&&!tC.includes(o.type)&&(0,yo.Sb)({propertySchema:o,property:e.property,blockStores:r,collectionSchema:a})})))??[]}),[l,a,r,u]).slice(0,Qg),h=(0,i.useRef)([]),[S,g]=(0,i.useState)(Qg),[C,f]=(0,i.useState)(!1);return(0,i.useEffect)((()=>{h.current.length>0&&h.current.forEach((e=>{var t;e&&(e.rightEdge=(null===(t=e.element)||void 0===t||null===(t=t.current)||void 0===t?void 0:t.getBoundingClientRect().right)??0)}))}),[h]),function(e){let{outerContainerRef:t,propertyButtonsContainerRef:o,propertyButtonRefs:r,marginLeft:n,setIsReadyToRender:s,setShowIconsOnly:l,setHiddenButtonsIndex:a}=e;(0,i.useEffect)((()=>{const e=N.Ds((()=>{var e,i,c;const d=(null===(e=t.current)||void 0===e?void 0:e.getBoundingClientRect().right)??window.innerWidth,u=((null===(i=t.current)||void 0===i?void 0:i.getBoundingClientRect().width)??window.innerWidth)-(n??0),p=(null===(c=o.current)||void 0===c?void 0:c.getBoundingClientRect().left)??0,h=d-eC;let m=r.current.findIndex((e=>e.rightEdge>h));m=-1!==m?m:Qg;let S=r.current.findIndex(((e,t)=>p+t*Jg>h));S=-1!==S?S:Qg;const g=m<Xg||u<=Yg;l(g),a(g?S:m),s(!0)}),150,{maxWait:150,leading:!0,trailing:!1});if(t.current){const o=new ResizeObserver((t=>{e()}));return e(),o.observe(t.current),()=>{o.disconnect()}}}),[n,t,r,o,a,s,l])}({propertyButtonsContainerRef:c,propertyButtonRefs:h,outerContainerRef:t,marginLeft:n,setIsReadyToRender:s,setHiddenButtonsIndex:g,setShowIconsOnly:f}),(0,b.jsx)("div",{ref:c,style:{display:"flex"},children:p.map(((e,t)=>{var r;let n=null===(r=h.current[t])||void 0===r?void 0:r.element;if(!n){const e=i.createRef();h.current[t]={element:e,rightEdge:0},n=e}const s=t>=S;return(0,b.jsx)("div",{ref:n,children:(0,b.jsx)(rC,{collectionsBulkActionsToolbarStore:o,schema:a,property:e.property,isHidden:s,showIconsOnly:C},e.property)},e.property)}))})}function rC(e){const{property:t,schema:o,collectionsBulkActionsToolbarStore:r,isHidden:n,showIconsOnly:s}=e,l=(0,tn.Y$)(),c=o[t],p=(0,a.O7)(),h=(0,d.VK)((()=>!(l.permissionScopes.state.canEditContent||"collectionTypedView"===l.contextType)),[l]),m=(0,u.yK)((e=>({button:{display:n?"none":"flex",padding:8,...Ug(e)}})),[n]),S=(0,i.useRef)(null),g=(0,d.qz)(void 0,Zo.Z),C=(0,i.useCallback)((async e=>{var o,i;if(!S.current)return;const n=Jo.default.state.stores;e.stopPropagation(),e.preventDefault();const s=null===(o=S.current)||void 0===o?void 0:o.getBoundingClientRect(),a=n[0].getAssociatedCollectionStore();l&&s&&a&&await Zg.z({environment:p,store:n[0],additionalStores:n.slice(1),property:t,rect:s,format:Mo.C.Table,collectionStore:a,blockPropertyValueOverlayStore:vh._H(),collectionContextStore:l,statusSetCheckbox:"checkbox"===(null===(i=l.getPropertyFormat(t))||void 0===i?void 0:i.statusShowAs),mouseStore:g,preventClearSelection:!0,collectionsBulkActionsToolbarStore:r})}),[S,l,p,t,g,r]),f=(0,u.Fg)();return c?(0,b.jsx)(Xe.ZP,{renderTooltip:()=>c.name,render:e=>(0,b.jsx)(Yt.Z,{...e,ariaLabel:c.name,ref:S,style:m.button,disabled:h,onClick:C,children:(0,b.jsx)(Cl.Z,{style:{maxWidth:"250px",textOverflow:"ellipsis"},propertySchema:c,hideName:s,showIcon:!0,property:t,iconStyle:{fill:f.regularTextColor}})}),disableTooltip:!s,placement:Xe.ug.Top}):null}const iC=(0,x.IU)("myTasksLarge",{viewBox:"0 0 48 48",svg:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("path",{d:"M21.6927 39.1705C21.4812 39.604 21.238 40.0164 20.9631 40.4076H39.5198C41.1693 40.4076 42.4117 39.9952 43.247 39.1705C44.0823 38.3457 44.5 37.1192 44.5 35.4909V19.2022C44.5 17.5739 44.0823 16.3473 43.247 15.5226C42.4117 14.6978 41.1693 14.2855 39.5198 14.2855H16.2526C14.5925 14.2855 13.3448 14.6978 12.5095 15.5226C11.6848 16.3367 11.2724 17.5633 11.2724 19.2022V24.4837C11.4839 24.4626 11.6953 24.4467 11.9068 24.4361C12.1183 24.415 12.3298 24.4044 12.5412 24.4044C12.7527 24.4044 12.9642 24.415 13.1757 24.4361C13.3977 24.4467 13.6145 24.4626 13.8259 24.4837V19.3449C13.8259 18.5202 14.0374 17.8964 14.4603 17.4734C14.8833 17.0505 15.4913 16.839 16.2843 16.839H39.4722C40.2547 16.839 40.8627 17.0505 41.2962 17.4734C41.7297 17.8964 41.9465 18.5202 41.9465 19.3449V35.3481C41.9465 36.1729 41.7297 36.7967 41.2962 37.2196C40.8627 37.6426 40.2547 37.8541 39.4722 37.8541H22.2478C22.0998 38.3087 21.9147 38.7475 21.6927 39.1705Z"}),(0,b.jsx)("path",{d:"M15.3644 10.0825C14.9837 10.4631 14.7353 11.0129 14.619 11.7319H41.1693C41.0424 11.0129 40.7887 10.4631 40.408 10.0825C40.0379 9.69123 39.4564 9.49562 38.6634 9.49562H17.1249C16.3319 9.49562 15.745 9.69123 15.3644 10.0825Z"}),(0,b.jsx)("path",{d:"M18.5206 5.816C18.14 6.15435 17.9285 6.66189 17.8862 7.3386H37.9021C37.8492 6.66189 37.6271 6.15435 37.2359 5.816C36.8553 5.46707 36.3002 5.2926 35.5706 5.2926H20.2018C19.4722 5.2926 18.9118 5.46707 18.5206 5.816Z"}),(0,b.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.44845 42.0729C10.4212 42.4959 11.4574 42.7074 12.5571 42.7074C13.6462 42.7074 14.6771 42.4959 15.6499 42.0729C16.6227 41.65 17.4791 41.0684 18.2193 40.3283C18.97 39.5881 19.5568 38.7317 19.9798 37.7589C20.4027 36.7861 20.6142 35.7499 20.6142 34.6503C20.6142 33.54 20.4027 32.4985 19.9798 31.5258C19.5674 30.553 18.9911 29.6965 18.251 28.9564C17.5108 28.2162 16.6544 27.6399 15.6816 27.2276C14.7088 26.8046 13.6673 26.5932 12.5571 26.5932C11.4574 26.5932 10.4212 26.8046 9.44845 27.2276C8.47568 27.6399 7.61922 28.2215 6.87906 28.9722C6.13891 29.7124 5.55736 30.5688 5.13442 31.5416C4.71147 32.5038 4.5 33.54 4.5 34.6503C4.5 35.7605 4.71147 36.802 5.13442 37.7748C5.55736 38.7475 6.13891 39.604 6.87906 40.3442C7.61922 41.0843 8.47568 41.6606 9.44845 42.0729ZM13.255 39.4242C13.0858 39.604 12.8532 39.6939 12.5571 39.6939C12.261 39.6939 12.0231 39.604 11.8434 39.4242C11.6742 39.2445 11.5896 39.0119 11.5896 38.7264V35.6177H8.48097C8.19548 35.6177 7.96286 35.5279 7.78311 35.3481C7.60336 35.1789 7.51348 34.9463 7.51348 34.6503C7.51348 34.3542 7.60336 34.1216 7.78311 33.9524C7.96286 33.7726 8.19548 33.6828 8.48097 33.6828H11.5896V30.5741C11.5896 30.2886 11.6742 30.056 11.8434 29.8763C12.0231 29.6965 12.261 29.6066 12.5571 29.6066C12.8532 29.6066 13.0858 29.6965 13.255 29.8763C13.4347 30.056 13.5246 30.2886 13.5246 30.5741V33.6828H16.6332C16.9187 33.6828 17.1513 33.7726 17.3311 33.9524C17.5108 34.1216 17.6007 34.3542 17.6007 34.6503C17.6007 34.9463 17.5108 35.1789 17.3311 35.3481C17.1513 35.5279 16.9187 35.6177 16.6332 35.6177H13.5246V38.7264C13.5246 39.0119 13.4347 39.2445 13.255 39.4242Z"}),(0,b.jsx)("path",{d:"M27.2289 32.3258C27.5208 32.6671 27.893 32.8378 28.3453 32.8378C28.8593 32.8378 29.2478 32.6404 29.511 32.2456L35.204 23.666C35.2986 23.5262 35.3685 23.3885 35.4137 23.2528C35.459 23.113 35.4816 22.9793 35.4816 22.8519C35.4816 22.4982 35.3582 22.2063 35.1115 21.976C34.8689 21.7416 34.5687 21.6244 34.211 21.6244C33.9643 21.6244 33.7546 21.6738 33.5819 21.7725C33.4133 21.867 33.2529 22.0315 33.1008 22.2659L28.3206 29.7723L25.9274 26.9042C25.6684 26.604 25.3435 26.4539 24.9529 26.4539C24.5869 26.4539 24.2847 26.5711 24.0462 26.8055C23.8077 27.0399 23.6885 27.3339 23.6885 27.6875C23.6885 27.8479 23.7131 28 23.7625 28.144C23.8159 28.2838 23.9126 28.4297 24.0524 28.5819L27.2289 32.3258Z"})]})});var nC=o(30806),sC=o(5933),lC=o(85740),aC=o(32662);const cC="noWritableDbs";function dC(e){const t=(0,a.O7)(),o=(0,d.VK)((()=>e.collectionContextStore.collectionStoresStore.state.length>0),[e.collectionContextStore.collectionStoresStore]),r=(0,d.VK)((()=>{const t=e.collectionContextStore.collectionStoresStore.state;return Boolean(t.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly())))}),[e.collectionContextStore.collectionStoresStore]),n=(0,d.VK)((()=>(0,ce.PI)(e.collectionContextStore)),[e]),s=(0,d.VK)((()=>e.collectionContextStore.isCompactView.state),[e.collectionContextStore]),l=(0,u.yK)((e=>({container:{width:"100%",height:s?"calc(100% - 4px)":void 0,paddingTop:s?void 0:120,paddingBottom:32,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",fontSize:14,color:e.lightTextColor},desktopInner:{width:800,minWidth:800,padding:32},icon:(0,pt.jO)(e)})),[s]),c=(0,i.useCallback)((()=>o?(0,b.jsx)(Xe.ZP,{disableTooltip:r,placement:Xe.ug.Bottom,renderTooltip:()=>(0,b.jsx)(B.FormattedMessage,{defaultMessage:"You do not have permissions{br}to edit the source databases",id:"tasksEmptyState.addTask.tooltip.noWritableDbs",values:{br:(0,b.jsx)("br",{})}}),render:o=>(0,b.jsx)(lC.Z,{...o,isBlue:!0,disabled:!r,disabledFeedback:!r,onClick:o=>{(0,nC.Aq)({environment:t,from:e.from}),e.onAddTaskClick(o)},icon:e=>(0,ie.R)(e),children:n})}):(0,b.jsx)(lC.Z,{isBlue:!0,onClick:()=>{(0,nC.Aq)({environment:t,from:e.from}),sC.Z.setState(!0)},children:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Don't see your tasks?",id:"tasksEmptyState.noDatabases.title"})})),[o,r,n,t,e]);return(0,b.jsxs)("div",{style:l.container,children:[(0,b.jsx)(Ya.LazyCollectionTasksEmptyStateModal,{from:e.from}),iC(l.icon),(0,b.jsx)(aC.Z,{size:16}),r?(0,b.jsx)(B.FormattedMessage,{defaultMessage:"No matching tasks.",id:"tasksEmptyState.noMatchingTasks.title"}):(0,b.jsx)(B.FormattedMessage,{defaultMessage:"See all tasks assigned to you here.",id:"tasksEmptyState.noTasks.title"}),(0,b.jsx)(aC.Z,{size:16}),c()]})}var uC=o(57260),pC=o(74194),hC=o(14562),mC=o(18278);function SC(e){const{projectCount:t,taskCount:o,paddingLeft:r,paddingRight:i}=e,n=(0,u.yK)((e=>({backgroundForOverlay:{backgroundColor:e.white,zIndex:F.Nm,paddingLeft:r,paddingRight:i},overlay:{display:"flex",flexDirection:"column",alignItems:"center",borderRadius:8,gap:10,backgroundColor:e.accentColors.uiBlue[100]},iconContainer:{display:"flex",flexDirection:"column",alignItems:"center",color:e.blueColor,fontSize:D.Z.fontSize.UIRegular.desktop},arrowCircleIconStyles:{width:45,height:45,position:"relative",color:e.blueColor},overlayMessageContainer:{display:"flex",flexDirection:"column",alignItems:"center"},overlayMessageTitle:{fontSize:D.Z.fontSize.UIRegular.mobile,fontWeight:D.Z.fontWeight.semibold,lineHeight:D.Z.lineHeight.UIRegular.mobile},overlayMessageCaption:{fontSize:D.Z.fontSize.UIRegular.desktop,fontWeight:D.Z.fontWeight.regular,lineHeight:D.Z.lineHeight.UIRegular.desktop}})),[r,i]);return(0,b.jsx)("div",{style:n.backgroundForOverlay,children:(0,b.jsx)("div",{style:n.overlay,children:(0,b.jsxs)("div",{style:n.iconContainer,children:[(0,b.jsx)("div",{children:(0,mC.O)(n.arrowCircleIconStyles)}),(0,b.jsxs)("div",{style:n.overlayMessageContainer,children:[(0,b.jsx)("div",{style:n.overlayMessageTitle,children:(0,b.jsx)(B.FormattedMessage,{id:"collectionViewBlock.overlayComponents.jiraOverlayMessageTitle",defaultMessage:"Syncing {projectCount} projects and {taskCount} issues from Jira",values:{projectCount:t,taskCount:o}})}),(0,b.jsx)("div",{style:n.overlayMessageCaption,children:(0,b.jsx)(B.FormattedMessage,{id:"collectionViewBlock.overlayComponents.jiraOverlayMessageCaption",defaultMessage:"You’ll be notified when the sync is complete"})})]})]})})})}var gC=o(29551),CC=o(58493),fC=o(31192),yC=o(95691),vC=o(57200),xC=o(77744),bC=o(19977),wC=o(45162),kC=o(2275),_C=o(82136),TC=o(15201),OC=o(72711),VC=o(57819),PC=o(16772),RC=o(55217);function MC(e){const{store:t,disabled:o,paddingLeft:r,paddingRight:n,setRef:s}=e,l=(0,a.O7)(),c=(0,d.VK)((()=>{const e=t.getFormat();return{pageFont:e.page_font,pageSmallText:e.page_small_text}}),[t]),u=(0,d.VK)((()=>(0,jp.CX)(t)),[t]),p=(0,kC.Nr)(t),h=(0,d.VK)((()=>(0,jp.a_)(t)),[t]),m=(0,d.VK)((()=>t.isNonEditableState()),[t]),{safePaddingLeft:S,safePaddingRight:g}=(0,d.VK)((()=>({safePaddingLeft:l.WindowSizeStore.getSafePaddingLeftCSS(r),safePaddingRight:l.WindowSizeStore.getSafePaddingRightCSS(n)})),[l.WindowSizeStore,r,n]),C=(0,d.VK)((()=>Boolean((0,VC.RR)(PC.default.state))),[]),f=(0,d.VK)((()=>t.getContentStore()),[t]),y=(0,d.VK)((()=>(0,fC.ww)(l.device)),[l.device]),v=u?e=>OC.og(e,t,l):void 0;function x(e,t){return(0,b.jsxs)("div",{style:e,ref:e=>{e&&s(e)},className:fo.QS0,onClick:t,children:[!h&&(0,b.jsx)(RC.Z,{store:f,emptyDroppableStyle:{width:"100%"},disabled:o||m}),p&&(0,b.jsx)(Ge.Z,{})]})}const w=(0,i.useCallback)((function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{device:t}=l,o=c.pageFont||fC.rk,r=fC.sL[o];let i;if(t.isMobile)i=t.isAndroid?fC.pE:fC.tb;else{i=c.pageSmallText?fC.Pc[o]||fC.ZY:fC.TE[o]||fC.jo}let n={},s={},a={};n={gridTemplateColumns:`${S} calc(100% - ${S} - ${g}) ${g}`},s=C?{paddingBottom:"600px"}:u?{paddingBottom:"15vh"}:{paddingBottom:0},a={...s,paddingLeft:e?0:S,paddingRight:e?0:g};const d=fC.VN[o],p=fC.n5[o]||1.5;return{wrapper:{flexShrink:0,flexGrow:1,display:"grid",gridTemplateColumns:"100%",maxWidth:"100%",width:"100%",...n},leftPadding:{},body:{display:"flex",alignItems:"flexstart",flexDirection:"column",fontFamily:r,fontSize:i,letterSpacing:d?`${d}em`:void 0,lineHeight:p,zIndex:F.ke,...s},rightPadding:{},nonIOSLayoutBody:{flexShrink:0,flexGrow:1,maxWidth:"100%",display:"flex",alignItems:"flexstart",flexDirection:"column",fontFamily:r,fontSize:i,letterSpacing:d?`${d}em`:void 0,lineHeight:p,width:"100%",zIndex:F.ke,...a}}}),[l,c.pageFont,c.pageSmallText,C,u,S,g]),k=w();return y?(0,b.jsxs)("div",{style:k.wrapper,children:[k.leftPadding&&(0,b.jsx)(Fs.p,{allowSelectionWithin:!1,style:k.leftPadding,onClick:v}),x(k.body,v),k.rightPadding&&(0,b.jsx)(Fs.p,{allowSelectionWithin:!1,style:k.rightPadding,onClick:v})]}):x(k.nonIOSLayoutBody,v)}const jC=i.memo(MC,po.Z);function IC(e){const{store:t,style:o,canEdit:r,padding:n}=e,s=(0,a.O7)(),l=(0,i.useRef)(null),c=(0,d.VK)((()=>t.isNonEditableState()),[t]),u=(0,d.VK)((()=>nm.fg(s,t)),[t,s]),p=(0,kC.n1)(),h=(0,i.useMemo)((()=>({width:(0,jp.du)(t,_C.S.CollectionPageView,s)})),[t,s]);let m=(0,b.jsxs)("div",{style:{display:"flex",width:"100%",justifyContent:"center",paddingTop:5,paddingBottom:p},children:[(0,b.jsx)(Ds.Z,{isVisible:!0,animationStyle:h,render:()=>(0,b.jsx)("div",{style:{maxWidth:"100%",minWidth:0},children:(0,b.jsx)(jC,{...e,...n,setRef:e=>{(0,xC.k$)(l,e)}})})}),!s.device.isMobile&&u&&(0,b.jsx)(bC.Z,{pageBlockStore:t,isVisible:u,context:_C.S.CollectionPageView,pageViewBlockAccessor:()=>l.current})]});return(0,wC.Aw)(s)&&(m=(0,b.jsx)(TC.O,{displayName:"PageContent",style:o,disabled:!r||c,children:m})),m}function FC(e){const{theme:t,isInHomeWidget:o}=e;return{display:"flex",alignItems:"center",fontSize:14,padding:6,...o?{height:24,width:24,color:t.lightTextColor,fill:t.lightIconColor}:{height:28,width:28,color:t.mediumIconColor,fill:t.mediumIconColor},fontWeight:D.Z.fontWeight.regular,lineHeight:1,borderRadius:4}}var BC=o(95193),NC=o(35294);const DC=(0,B.defineMessages)({moreButtonAriaLabel:{id:"unlistedCollectionView.moreButton.icon",defaultMessage:"More"}});function LC(e){const{collectionContextStore:t}=e,o=(0,B.useIntl)(),[r,n]=i.useState(!1),s=(0,d.VK)((()=>t.isInHomeWidget.state),[t]),l=i.useCallback((()=>{n(!r)}),[r]),a=(0,NC.d)(),c=(0,u.yK)((e=>({icon:{width:18,height:void 0,fill:e.mediumIconColor},button:FC({theme:e,isInHomeWidget:s})})),[s]);return(0,b.jsx)(Ye.ZP,{popupType:a,alignmentToOrigin:ph.lU.End,placementToOrigin:ph.Iw.Bottom,open:r,onDismiss:l,origin:(0,b.jsx)(jt.Z,{icon:ue.o,ariaLabel:o.formatMessage(DC.moreButtonAriaLabel),onClick:l,iconStyle:c.icon,style:c.button}),render:()=>(0,b.jsx)(EC,{collectionContextStore:t})})}function EC(e){const{collectionContextStore:t}=e,{isMobile:o}=(0,a.Fy)(),r=(0,d.VK)((()=>t.collectionStore()),[t]),i=(0,d.VK)((()=>null==r?void 0:r.getIcon()),[r]),n=(0,u.yK)((e=>({icon:{color:e.regularIconColor,width:12,height:12},title:{display:"flex",alignItems:"center"},collectionIcon:{marginLeft:4,marginRight:2}})),[]),s=(0,BC.F)({maxWidth:250}),l={key:"options",render:e=>(0,b.jsx)(Pe.Z,{...e}),items:[{key:"save",render:e=>(0,b.jsx)($e.Z,{...e,icon:(0,ie.R)(n.icon),title:(0,b.jsx)(B.FormattedMessage,{id:"unlistedCollectionView.moreButton.save",defaultMessage:"Save as view in…"})}),action:()=>{}},{key:"open",render:e=>(0,b.jsx)($e.Z,{...e,icon:(0,Op.J)(n.icon),title:(0,b.jsx)("div",{style:n.title,children:(0,b.jsx)(B.FormattedMessage,{id:"unlistedCollectionView.moreButton.open",defaultMessage:"Open {databaseName}",values:{databaseName:(0,b.jsxs)(b.Fragment,{children:[i&&(0,b.jsx)(Do.Z,{isEmptyPage:!1,size:o?18:16,disabled:!0,icon:i,style:n.collectionIcon}),r&&(0,b.jsx)(xu.Z,{store:r})]})}})})}),action:()=>{}}]};return(0,b.jsx)(Te.Z,{...s,children:(0,b.jsx)(Oe.Z,{type:Oe.i.Vertical,initialFocus:0,sections:[l]})})}class AC extends p.default{getInitialState(){return{stage:"NOT_TRACKING"}}}function HC(e){const{collectionContextStore:t,parentMountTime:o}=e,{handleInitialDatabaseRender:r,handleItemMount:n}=function(e,t){const o=(0,a.O7)(),r=(0,d.qz)(void 0,AC),n=(0,i.useRef)(0),s=(0,i.useRef)(t),c=(0,i.useCallback)((()=>{"NOT_TRACKING"===r.state.stage&&r.setState({stage:"COUNTING_VISIBLE_ITEMS"})}),[r]),u=(0,i.useCallback)((()=>{if("COUNTING_VISIBLE_ITEMS"===r.state.stage&&(n.current++,1===n.current)){const e=performance.now();l.default.afterNextFlush((()=>{"COUNTING_VISIBLE_ITEMS"===r.state.stage&&r.setState({stage:"SHOULD_TRACK",endTime:e})}))}}),[r]),p=(0,i.useCallback)((t=>{if("SHOULD_TRACK"===t.state.stage){const r=he.Pp({environment:o,collectionContextStore:e,visibleItemsCount:n.current||0});Hr.default.measureFromAppStart({metricName:"initial_database_items_visible",endTime:t.state.endTime},{environment:o,data:r}),s.current&&Hr.default.measure({metricName:"collections.initial_mount_to_items_visible",startTime:s.current,endTime:t.state.endTime},{environment:o,data:r}),t.reset(),n.current=0}}),[e,o]);return(0,i.useEffect)((()=>(r.addListener(p),()=>{r.removeListener(p)})),[p,r]),{handleInitialDatabaseRender:c,handleItemMount:u}}(t,o);return t.initialDatabaseItemsVisibleTracker||(t.initialDatabaseItemsVisibleTracker={handleInitialDatabaseRender:r,handleItemMount:n}),null}const ZC=180,zC=(0,B.defineMessages)({searchInputPlaceholder:{defaultMessage:"Type to search...",id:"database.searchInputPlaceholder"},openAutomationsSettingsButtonTooltip:{defaultMessage:"Create and view automations",id:"database.collectionViewBlock.openAutomationsSettingsButton.tooltip"},openAutomationsSettingsButtonAriaLabel:{defaultMessage:"Create and view automations",id:"database.collectionViewBlock.openAutomationsSettingsButton.ariaLabel"},disableAutomationsSettingsButtonTooltip:{defaultMessage:"Can't add automations to databases in the trash",id:"database.collectionViewBlock.disableAutomationsSettingsButton.tooltip"},disableAutomationsSettingsButtonAriaLabel:{defaultMessage:"Can't add automations to databases in the trash",id:"database.collectionViewBlock.disableAutomationsSettingsButton.ariaLabel"},openFullscreenPageButtonTooltip:{defaultMessage:"Open as full page",id:"database.collectionViewBlock.openFullscreenPageButton.tooltip"},filterLabel:{defaultMessage:"Filter",id:"collectionViewBlock.action.filter.title"},sortLabel:{defaultMessage:"Sort",id:"collectionViewBlock.action.sort.title"}});class GC{constructor(e,t,o){this.listener=void 0,this.didEmit=void 0,this.lastValue=void 0,this.handleEmit=(e,t,o)=>{let r=!0;this.didEmit||(this.didEmit=!0,r=!1),this.lastValue===t?r=!1:this.lastValue=t,r&&this.onEmit(t,o)},this.environment=e,this.listenerEventKey=t,this.onEmit=o,this.didEmit=!1,this.lastValue=void 0}subscribe(){this.listener=dm.ZP.addListener(this.listenerEventKey,this.handleEmit,void 0,this.environment)}unsubscribe(){this.listener&&dm.ZP.removeListener(this.listener,this.environment)}}class KC extends Ho.Z{constructor(){super(...arguments),this.isCollectionViewBlock=!0,this.collectionContextStore=new vo.Z(this.environment),this.headerSizeObserver=new wh.E,this.headerEl=null,this.horizontalScrollerEl=null,this.resizeObserver=void 0,this.timelineViewRef=i.createRef(),this.automationsViewRef=i.createRef(),this.parentNode=void 0,this.renderStartTime=void 0,this.subscriptions=new Map,this.collectionTypeChangeSubscription=void 0,this.collectionRefetcher=new Lg(this.collectionContextStore,this.environment),this.syncStateTimeout=void 0,this.switchViewMetric=void 0,this.storeTypes={collectionContextStore:vo.Z,mouseStore:Zo.Z,headerMouseStore:Zo.Z,verticalScrollerStore:gt.Z,focusStore:p.default.createClass(!1),noDateResultStore:p.default.createClass(void 0),tasksResultStore:p.default.createClass(void 0),templateButtonPopupStore:mo.Z,filterBarSettingsStore:p.default.createClass({open:!1,stack:[]}),createFilterButtonPopupStore:mo.Z,createFilterSettingsStore:p.default.createClass({open:!1,stack:[]}),filterBarCreateFilterSettingsStore:p.default.createClass({open:!1,stack:[]}),createSortSettingsStore:p.default.createClass({open:!1,stack:[]}),viewSettingsPlacementStore:p.default.createClass(void 0),saveControlMoreActionsButtonPopupStore:mo.Z},this.renderCreateFilterPopup=()=>{const{collectionContextStore:e}=this,{createFilterSettingsStore:t}=this.stores;return(0,b.jsx)(_s.P,{context:uh.HV.TopbarFilterPopup,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.renderCreateSortPopup=()=>{const{collectionContextStore:e}=this,{createSortSettingsStore:t}=this.stores;return(0,b.jsx)(_s.P,{context:uh.HV.TopbarSortPopup,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.renderViewSettings=()=>{const e=this.isInPeekRenderer(),t=(0,ce.Ks)(this.props.store)?{paddingLeft:0,paddingRight:0}:this.leftRightPadding.state;if(t)return(0,b.jsx)(mh,{collectionContextStore:this.collectionContextStore,headerSizeObserver:this.headerSizeObserver,placementStore:this.stores.viewSettingsPlacementStore,isInPeekRenderer:e,overridePlacement:this.collectionContextStore.isInHomeWidget.state?"popup":void 0,marginTop:12,...t})},this.renderTemplatesPopup=()=>{const{collectionContextStore:e}=this,{store:t}=this.props,o=e.collectionStore();if(o){if(pm.Z.state.online){const r=e.permissionScopes.state;return(0,b.jsx)(uC.Z,{isOverlay:!0,collectionStore:o,canConfigureCollection:r.canConfigureCollection,onEmptyPageClick:this.handleTemplateEmptyPageClick,onEmptyEnter:this.handleTemplateEmptyPageClick,onTemplateClick:this.handleTemplateClick,onCancelClick:this.handleTemplateCancelClick,locked:t.isNonEditableState()})}return(0,b.jsx)("div",{style:{fontSize:14,color:this.theme.mediumTextColor,width:280,padding:8},children:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Please go online to use a template.",id:"collectionViewBlock.actionBar.offlineTemplatePicker.message"})})}},this.renderNoDatePopup=e=>{const{collectionContextStore:t}=this,o=t.collectionViewBlockStore(),r=t.collectionViewStore(),i=this.getNoDateProperty();if(!o||!r||!i)return;const n=this.getCurrentViewType();return!r.isDefined()||"timeline"!==n&&"calendar"!==n?void 0:(0,b.jsx)(Vg,{collectionViewBlockStore:o,property:i,onClose:e.close,onAddPage:this.handleNoDateAddPage,collectionViewType:n,collectionContextStore:t})},this.handleRelativeVariableStaleStoreChange=async e=>{if(e.state){const e=this.collectionContextStore,t=e.collectionViewBlockStore(),o=e.collectionViewStore(),r=e.collectionStore();if(!t||!o||!r)return;await pe.dj(this.environment,e,{src:"relative_variables_stale",queuedTimestamp:Date.now()})}},this.handleViewAutomationSettingsClick=e=>{(0,me.ZP)({event:e,context:me.Af.CollectionAutomationSettingsClick,callback:this.handleViewAutomationSettingsClickInner})},this.handleViewAutomationSettingsClickInner=()=>{const{collectionContextStore:e}=this,t=e.settingsStore,o=t.state.open,r=(0,um.n)(t);o&&"automationSettings"===(null==r?void 0:r.type)?z.E3({collectionSettingsStore:t}):(z.r$({collectionContextStore:e,collectionSettingsStore:t}),z.wl({collectionSettingsStore:t,item:{source:"collection_view_settings",type:"automationSettings"}}))},this.handleViewClick=e=>{let{currentCollectionViewStore:t,newCollectionViewStore:o,openInNew:r}=e;if(t.id!==o.id&&!r){const e=t.getType(),r=o.getType();var i;if(e&&r)this.switchViewMetric={from:e,to:r,metric:Hr.default.mark("collections.switch_view_lag"),sizeHintAtStart:null===(i=this.collectionContextStore.remoteResult.state)||void 0===i?void 0:i.sizeHint}}},this.handleFilterClick=()=>{const{collectionContextStore:e}=this,{createFilterSettingsStore:t}=this.stores,o=e.permissionScopes.state.canConfigureBlock?e.currentCombinatorFilterStore.state:void 0,r=e.currentPropertyFiltersStore.state,i=e.filtersBarOpenStore.state;this.isCompactView.state&&z.wl({collectionSettingsStore:e.settingsStore,item:{type:"filters"}}),i||r.length>0||o?e.filtersBarOpen.setState(!i):z.wl({collectionSettingsStore:t,item:{type:"createFilter"}}),E.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_filter"})},this.handleSortClick=()=>{const{collectionContextStore:e}=this,{createSortSettingsStore:t}=this.stores,o=this.hasSort.state;this.isCompactView.state&&z.wl({collectionSettingsStore:e.settingsStore,item:{type:o?"sort":"createSort"}}),o?(this.isCompactView.state||e.filtersBarOpen.setState(!0),z.wl({collectionSettingsStore:e.filterBarSortSettingsStore,item:{type:"sort"}})):this.isCompactView.state||z.wl({collectionSettingsStore:t,item:{type:"createSort"}}),E.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_sort"})},this.handleCreateFilterPopupDismiss=()=>{const{createFilterSettingsStore:e}=this.stores;z.E3({collectionSettingsStore:e})},this.handleCreateSortPopupDismiss=()=>{const{createSortSettingsStore:e}=this.stores;z.E3({collectionSettingsStore:e})},this.handleCollectionEmit=(e,t)=>{this.collectionRefetcher.handleCollectionEmit({src:"msg",passThroughData:t,shouldQueueCollectionEmit:this.shouldQueueCollectionEmit(),isCollectionTypeChange:!1})},this.handleCollectionTypeChangeEmit=(e,t)=>{this.collectionRefetcher.handleCollectionEmit({src:"msg",passThroughData:t,shouldQueueCollectionEmit:this.shouldQueueCollectionEmit(),isCollectionTypeChange:!0})},this.handlePageVisibilityChange=()=>{this.shouldRefetch()&&this.collectionRefetcher.maybeProcessQueuedCollectionEmit("page_show")},this.handlePeekViewChange=()=>{this.shouldRefetch()&&this.collectionRefetcher.maybeProcessQueuedCollectionEmit("exit_peek")},this.shouldQueueCollectionEmit=()=>{var e;return!gm.Z.state.isVisible||!(!Xo.default.isCenterPeekOpen()||null!==(e=Xo.default.peekTarget.state)&&void 0!==e&&e.uiContains(this.props.store))},this.shouldRefetch=()=>{if(!Xo.default.isCenterPeekOpen()&&gm.Z.state.isVisible)return!0},this.handleHeaderMount=e=>{e&&this.headerSizeObserver.observe(e),this.headerEl=e},this.handleHorizontalScrollerMount=e=>{var t,o;var r;(null==e||null===(t=e.scrollerEl())||void 0===t?void 0:t.classList.contains(fo.PBs))?this.horizontalScrollerEl=e:this.horizontalScrollerEl=(null==e||null===(r=e.context.scrollerContext)||void 0===r?void 0:r.horizontalScroller)||null;const i=this.collectionContextStore.collectionViewStore();this.resetFrozoneStore(i);const n=null===(o=this.horizontalScrollerEl)||void 0===o?void 0:o.scrollerEl();"undefined"!=typeof ResizeObserver&&n&&(this.resizeObserver=new ResizeObserver(this.handleHorizontalScrollerResizeDebounced),this.resizeObserver.observe(n))},this.handleHorizontalScrollerResize=()=>{var e,t;const o=null===(e=this.horizontalScrollerEl)||void 0===e||null===(e=e.scrollerEl())||void 0===e?void 0:e.getBoundingClientRect().width,r=this.collectionContextStore.frozoneStore.state.scrollerWidth,i=null===(t=this.horizontalScrollerEl)||void 0===t||null===(t=t.scrollerEl())||void 0===t?void 0:t.getBoundingClientRect().left,n=this.collectionContextStore.frozoneStore.state.scrollerLeftOffset;if(o===r&&i===n)return;if(this.isCompactView.state)return;const s=this.collectionContextStore.collectionViewStore(),l=this.collectionContextStore.normalizedFormatStore.state;this.collectionContextStore.frozoneStore.setState({...this.collectionContextStore.frozoneStore.state,scrollerWidth:o,scrollerLeftOffset:i,frozenIndex:null==s?void 0:s.getTableFrozenColumnIndex(o,l),tryShowHiddenFrozenColumn:!1})},this.handleHorizontalScrollerResizeDebounced=N.Ds(this.handleHorizontalScrollerResize,50),this.handleEditorMouseDown=e=>{const{device:t}=this.environment,{target:o}=e;if(!this.getCurrentCollectionViewStore()||t.isMobile||!(o instanceof HTMLElement))return;const r=this.getCurrentViewType();r&&(0,me.ZP)({event:e,context:me.Af.EditorMouseDown,callback:()=>{e.preventDefault(),W.AI({environment:this.environment,target:o,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:"board"===r||"table"===r})}})},this.handleEditorClick=(e,t)=>{(0,me.ZP)({event:e,context:me.Af.EditorClick,callback:()=>{if(this.isInPeekRenderer()||U.E5(this.environment),"page"===t&&!Qa.X9()){const{clientX:t,clientY:o,target:r}=e;l.default.afterNextFlush((()=>{ee.createAndCommit({userAction:"CollectionViewBlock.PageView.click",environment:this.environment,perform:e=>{J.jh(this.environment,{x:t,y:o,target:r instanceof Element?r:void 0},e)}})}))}}})},this.handleScroll=e=>{var t,o;const r=null===(t=this.horizontalScrollerEl)||void 0===t||null===(t=t.scrollerEl())||void 0===t?void 0:t.scrollLeft,i=null===(o=this.leftRightPadding.state)||void 0===o?void 0:o.paddingLeft;if(void 0===r||void 0===i)return;const n=r>i;n!==this.collectionContextStore.frozoneStore.state.isScrolled&&(this.collectionContextStore.frozoneStore.setState({...this.collectionContextStore.frozoneStore.state,isScrolled:n}),this.handleHorizontalScrollerResize())},this.handleFocusIn=e=>{const t=e.target;null!==t&&t instanceof HTMLElement&&(0,c.E)(t)&&this.stores.focusStore.setState(!0)},this.handleFocusOut=()=>{this.stores.focusStore.setState(!1)},this.handleMouseMove=()=>{Qo.Z.state||this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0})},this.handleMouseLeave=()=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1})},this.handleHeaderMouseMove=()=>{Qo.Z.state||this.stores.headerMouseStore.setState({...this.stores.headerMouseStore.state,mouseEntered:!0})},this.handleHeaderMouseLeave=()=>{this.stores.headerMouseStore.setState({...this.stores.headerMouseStore.state,mouseEntered:!1})},this.handleLoadedStoreChange=()=>{if(!this.isLoadedStore.state||!this.componentIsMounted||this.collectionContextStore.wasCreatedThisSession.state||!this.isFullScreen())return;const e=this.environment.RouterStore.state;let t;"page"===e.route.name&&(t=e.route.mobileData);const o=()=>{var e,o;return{...he.vS(this.collectionContextStore),is_push:(null===(e=t)||void 0===e?void 0:e.isPush)??!1,collectionViewType:this.getCurrentViewType(),initial_route:this.environment.RouterStore.state.initialRoute.name,prefetchCache:null===(o=this.environment.prefetchCache)||void 0===o||null===(o=o.getPrefetchAnalytic("queryCollection"))||void 0===o?void 0:o.type,wasm_sqlite_initialized:hm.Z.state.metricData.state.wasm_sqlite_initialized,is_mobile_background_launch:(0,V.Z)()}},i=()=>({...he.vS(this.collectionContextStore),wasm_sqlite_initialized:hm.Z.state.metricData.state.wasm_sqlite_initialized,collectionViewType:this.getCurrentViewType(),...(0,Sm.t)()});var n;hm.Z.state.initialRenderCompleted?Hr.default.measureAfterNextFlush("navigation_database_render",{environment:this.environment,getData:i}):(K.setInitialRenderCompleted(),Hr.default.measureFromAppStartAfterNextFlush("initial_database_render",{environment:this.environment,getData:o,shouldSendIfStatsigNotInitialized:!0}),this.renderStartTime&&Hr.default.measureAfterNextFlush({metricName:"initial_database_render_from_component_mount",startTime:this.renderStartTime},{environment:this.environment,getData:o,shouldSendIfStatsigNotInitialized:!0}),this.renderStartTime=void 0,null===(n=this.collectionContextStore.initialDatabaseItemsVisibleTracker)||void 0===n||n.handleInitialDatabaseRender(),r.vF.hackyOffsetParsesCorrectly()||sm.j(this.environment,"luxon_hacky_offset_parses_correctly_false"))},this.handleSearchButtonClick=()=>{this.collectionContextStore.searchOpen.setState(!0),E.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_search"})},this.handleSearchQueryChange=e=>{pe.Ug({searchQuery:e.target.value,collectionContextStore:this.collectionContextStore,isFullScreen:Boolean(this.props.isFullScreen)}),L.ik(this.environment,{view_type:this.getCurrentViewType()})},this.handleSearchFocus=()=>{Jo.default.reset(),er.default.reset()},this.handleSearchBlur=()=>{this.collectionContextStore.searchQuery.state||this.handleClearSearch()},this.handleSearchKeyDown=e=>{27===e.keyCode&&this.handleClearSearch()},this.handleClearSearch=()=>{this.collectionContextStore.searchQuery.setState(""),this.collectionContextStore.searchOpen.setState(!1)},this.handleAddItemClick=e=>{if(!this.collectionContextStore.collectionViewBlockStore()||!(0,Ce.M_)(this.environment))return;const t=this.collectionContextStore.isInHomeWidget.state,o=this.isMultiSourceView.state,r=this.getCurrentViewType();ee.createAndCommit({userAction:"CollectionViewBlock.handleAddItemClick",environment:this.environment,perform:i=>{var n;pe.NZ({store:this.props.store,collectionContextStore:this.collectionContextStore,environment:this.environment,transaction:i,shouldCoerce:!0,showMoveTo:o,peekModeOverride:t?"center_peek":void 0,from:"cvb_add_item",useCrdt:(0,Co.SL)({event:e,source:"table"===r?"collection_table_view":"collection_non_table_view",contextualDefault:null===(n=this.collectionContextStore.defaultPageTemplateStore.state)||void 0===n?void 0:n.useCrdt()})})}}),E.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_new_item"}),this.projManagementTooltipTourAssignToSomeone()},this.handleTemplatesDropdownClick=()=>{E.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_templates_dropdown"})},this.handleTemplateClick=e=>{ee.createAndCommit({userAction:"CollectionViewBlock.handleTemplateClick",environment:this.environment,perform:t=>{const o=pe.NZ({transaction:t,store:this.props.store,collectionContextStore:this.collectionContextStore,environment:this.environment,shouldCoerce:!1,from:"cvb_template",useCrdt:e.useCrdt});o&&G.ob({title:"template",environment:this.environment,store:o,templateStore:e.templateStore,isKeyboard:e.isKeyboard,isCreateIn:!1,transaction:t,from:"collection_view_block"})}}),this.projManagementTooltipTourAssignToSomeone(),this.stores.templateButtonPopupStore.reset()},this.handleTemplateEmptyPageClick=e=>{ee.createAndCommit({userAction:"CollectionViewBlock.handleTemplateEmptyPageClick",environment:this.environment,perform:t=>{pe.NZ({transaction:t,store:this.props.store,collectionContextStore:this.collectionContextStore,environment:this.environment,shouldCoerce:!1,from:"cvb_template_empty_page",useCrdt:(0,Co.SL)({event:e,source:"collection_instantiate_template"})})}}),this.stores.templateButtonPopupStore.reset()},this.handleTemplateCancelClick=()=>{this.stores.templateButtonPopupStore.reset()},this.handleSetSourceClick=()=>{const{collectionContextStore:e}=this,t=e.settingsStore;this.isPlaceholderExternalCollectionStore.state?z.NG({collectionSettingsStore:t}):(z.r$({collectionContextStore:e,collectionSettingsStore:t}),E.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_select_data_source"}))},this.handleNoDateAddPage=e=>{const{collectionContextStore:t}=this,o=e.getAssociatedCollectionStore(),r=this.getCurrentCollectionViewStore(),i=this.timelineViewRef.current;if(!r||!o)return;if(!r.isDefined())return;const{performResult:n}=ee.createAndCommit({userAction:"CollectionViewBlock.insertedStore",environment:this.environment,perform:r=>"calendar"===this.getCurrentViewType()?H.Fv({environment:this.environment,store:e,collectionStore:o,collectionContextStore:t,startDayOfWeek:vh.AK.state,results:this.getDefaultResults(),transaction:r}):i?i.addBlockToView({store:e,transaction:r}):void 0});n&&Y.Z5({environment:this.environment,stores:[n]})},this.handleOpenAsPageClick=()=>{L.Ji(this.environment,{view_type:this.getCurrentViewType()})},this.handleNoDateButtonClick=()=>{E.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_no_date"})},this.initializeSyncStatePolling=async()=>{if(this.isSyncingStore.state){const e=this.getCollectionStore(),t=null==e?void 0:e.getFormat().uri,o=null==e?void 0:e.getFormat().bot_id,r=null==e?void 0:e.id;if(!t||!o||!r)return;await this.pollSyncState({uri:t,botId:o,collectionId:r})}},this.pollSyncState=async e=>{const t=await A.getExternalCollectionSyncState(this.environment,e);if("success"===t.type&&t.data.result){const o=t.data.result,r=this.collectionContextStore.numberChildrenReceived,i=this.collectionContextStore.numberChildrenUnfurled;r.setState(o.numberChildrenReceived),i.setState(o.numberChildrenUnfurled),i.state/r.state<1&&(this.syncStateTimeout=setTimeout((async()=>{await this.pollSyncState(e)}),1e4))}},this.resetCollectionSubscriptions=e=>{const t=Array.from(this.subscriptions.keys()),o=N.e5(t,e),r=N.e5(e,t);for(const n of o){var i;null===(i=this.subscriptions.get(n))||void 0===i||i.unsubscribe(),this.subscriptions.delete(n)}for(const n of r){const e=new GC(this.environment,(0,R.jY)(n),this.handleCollectionEmit);e.subscribe(),this.subscriptions.set(n,e)}},this.subscribeToTypeChanges=()=>{const e=this.collectionContextStore.contextType,t=this.collectionContextStore.databaseType;if("collectionTypedView"!==e||!t||this.collectionTypeChangeSubscription)return;const o=new GC(this.environment,(0,R.JY)({spaceId:this.props.store.getSpaceId(),databaseType:t}),this.handleCollectionTypeChangeEmit);o.subscribe(),this.collectionTypeChangeSubscription=o},this.isSyncingStore=this.createComputedStore((()=>{var e;const t=this.getCollectionStore(),o=null==t?void 0:t.isSyncedCollection(),r=!0===(null==t||null===(e=t.getFormat().sync_state)||void 0===e?void 0:e.syncing),i=this.environment.device.isMobile;return Boolean(o&&r&&!i)})),this.canShowPmIntroTooltipStore=this.createComputedStore((()=>{if(this.environment.device.isMobile)return!1;const e=$o.default.state.currentUserSettingsStore,t=$o.default.state.currentSpaceStore;if(!(0,oe.jH)(e,t)&&(!t||t.getCreatedTime()<oe.VL))return!1;if(!this.isTasksDB())return!1;if(this.props.store.pathIsDead())return!1;return!!this.collectionContextStore.permissionScopes.state.canEditContent&&(!!(0,oe.Z0)()&&$o.default.state.inAppCalloutStore.canShow("pm_intro_tooltip"))})),this.isMultiSourceView=this.createComputedStore((()=>"collectionTypedView"===this.collectionContextStore.contextType)),this.isMyTasksPage=this.createComputedStore((()=>(0,vh.qG)(this.props.store.id))),this.isTasksEmpty=this.createComputedStore((()=>!!this.isMyTasksPage.state&&this.collectionContextStore.isEmptyStore.state)),this.isCompactView=this.createComputedStore((()=>this.collectionContextStore.isCompactView.state)),this.isTasksDB=()=>{const e=this.collectionContextStore.collectionViewBlockStore();return(null==e?void 0:e.getFormat().app_config_uri)===m.NB},this.shouldRestrictHeaderWidthForMarginComments=()=>this.isRootOrDirectChild()&&!(0,ce._5)(this.props.store)&&this.marginCommentsVisible.state,this.shouldRenderOptions=()=>void 0!==this.collectionContextStore.collectionStore()||"collectionTypedView"===this.collectionContextStore.contextType,this.shouldRestrictWidthForMarginComments=this.createComputedStore((()=>{const e=this.getCurrentViewType();return this.shouldRestrictHeaderWidthForMarginComments()&&e&&(ce.bu.has(e)||"timeline"===e&&this.collectionContextStore.collectionStore()&&!(0,Gn.C1)({environment:this.environment,format:this.collectionContextStore.normalizedFormatStore.state,isFullScreen:this.isFullScreen(),isRootChild:this.isRootOrDirectChild()}))})),this.isPlaceholderExternalCollectionStore=this.createComputedStore((()=>{const e=this.getCollectionStore();return!!e&&(0,g.OY)(e.getValue())})),this.getExternalIntegrationId=this.createComputedStore((()=>{const e=this.getCollectionStore();if(e)return e.getFormat().integration_id})),this.leftRightPadding=this.createComputedStore((()=>{const{store:e,isFullScreen:t,overridePaddingLeft:o,overridePaddingRight:r}=this.props,i=(0,ce.Bs)({environment:this.environment,store:e,isFullScreen:t,sizeObserver:this.headerSizeObserver,viewType:this.getCurrentViewType()});i&&void 0!==o&&(i.paddingLeft=o),i&&void 0!==r&&(i.paddingRight=r);const n=this.shouldRestrictWidthForMarginComments.state;return i&&n&&(i.paddingRight+=(0,nm.gC)(this.environment,(0,ce.en)(e),this.isInFrameWhenSidePeekOpen.state)),i})),this.isLoadedStore=this.createComputedStore((()=>this.collectionContextStore.isLoaded.state)),this.leftRightMargin=this.createComputedStore((()=>{if(!this.isRootOrDirectChild()||!this.marginCommentsVisible.state||!(0,ce._5)(this.props.store)||this.props.store.isCollectionViewPageWithContent())return{marginLeft:void 0,marginRight:void 0};const e=nm.QB/2;return{marginLeft:e,marginRight:-e}})),this.noDateTotal=this.createComputedStore((()=>{if(this.noDateReducerStore.state){const e=this.stores.noDateResultStore.state;return e&&"aggregation"===e.type&&"number"===e.aggregationResult.type&&e.aggregationResult.value?e.aggregationResult.value:0}return 0})),this.noDateReducerStore=this.createComputedStore((()=>{const e=this.getNoDateProperty();if(e){return{type:"aggregation",aggregation:{property:e,aggregator:"empty"}}}})),this.hasTasksReducerStore=this.createComputedStore((()=>{if(this.isMyTasksPage.state){return{type:"results",filter:{operator:"and",filters:[]},limit:1}}})),this.hasAppliedFilter=this.createComputedStore((()=>(0,ao.RL)({collectionContextStore:this.collectionContextStore,applySubitemFilter:!1,filterOutHideSubitemsQuickFilter:!1}).length>0)),this.hasSort=this.createComputedStore((()=>{const{collectionContextStore:e}=this;return e.currentSortsStore.state.length>0})),this.showHoverActionsStore=this.createComputedStore((()=>{const{device:e}=this.environment,{mouseStore:t,headerMouseStore:o,focusStore:r,createSortSettingsStore:i,createFilterSettingsStore:n,filterBarCreateFilterSettingsStore:s,saveControlMoreActionsButtonPopupStore:l}=this.stores,{collectionContextStore:a}=this,c=this.isFullScreen(),d=r.state,u=a.settingsStore.state.open,p=a.searchOpen.state,h=i.state.open,m=n.state.open,S=s.state.open,g=a.filterBarSortSettingsStore.state.open,C=Array.from(a.filterBarItemSettingsStoreMap.values()),f=l.state.open,y=C.some((e=>e.state.open));return Boolean(t.state.mouseEntered||o.state.mouseEntered||d||c||this.shouldShowProjManagementTooltipTour()||e.isMobile||u||y||h||m||S||p||f||g)})),this.showCompactDesktopHeaderStore=this.createComputedStore((()=>{const{device:e}=this.environment,t=this.headerSizeObserver.rect.state;return!e.isMobile&&t.width&&t.width<400})),this.isInFrameWhenSidePeekOpen=this.createComputedStore((()=>(0,ce.Ks)(this.props.store))),this.isInPeek=this.createComputedStore((()=>(0,ce.en)(this.props.store))),this.shouldRenderCompactViewVerticalScroller=this.createComputedStore((()=>{const e=this.getCurrentViewType();return!("collectionVirtualView"===this.collectionContextStore.contextType)&&this.isCompactView.state&&function(e){switch(e){case"table":case"board":case"gallery":case"list":case"timeline":case"chart":case"page":return!0;case"calendar":return!1;default:return(0,ut.t1)(e)}}(e)})),this.reasonToDisableNewTaskButton=this.createComputedStore((()=>{const e=this.collectionContextStore.collectionStoresStore.state,t=Boolean(e.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly())));if(this.isMultiSourceView.state)return e?0===e.length?"noDbs":t?void 0:cC:"loading"})),this.headerHeight=this.createComputedStore((()=>{if(this.props.hideHeader)return 0;const e=this.props.hideViewTabBar?40:0;return this.collectionContextStore.isInHomeWidget.state?pt.jX-e:40-e}))}insertBlocks(e,t){const o=this.getCollectionStore();if(o)for(const r of e)Z.mp({environment:this.environment,store:r,collectionStore:o,collectionContextStore:this.collectionContextStore,shouldCoerce:!0,groupsPointer:[],transaction:t});return[]}handleCreated(){Y.ZH(this.environment),l.default.afterNextFlush((()=>{const{collectionContextStore:e}=this,t=e.collectionStore(),o=e.collectionViewBlockStore(),r=e.settingsStore;if(!o)return;const i=o.getCollectionViewSourceCollectionStore();if(this.isPlaceholderExternalCollectionStore.state)z.NG({collectionSettingsStore:r});else if(i)pe.W1({environment:this.environment,collectionContextStore:e});else if(t)z.r$({collectionContextStore:e,collectionSettingsStore:r}),(0,Ts.V)({environment:this.environment,collectionStore:t,collectionContextStore:e,collectionSettingsStore:r});else{const t=co.default.checkGate("typed_db_creation");z.r$({collectionContextStore:e,collectionSettingsStore:r}),t?z.wl({collectionSettingsStore:r,item:{type:"createTypedDB"}}):z.wl({collectionSettingsStore:r,item:{type:"createViewSource"}})}}))}UNSAFE_willMount(e){super.UNSAFE_willMount(e),this.trackRenderTime({isFirstRender:!0}),this.collectionContextStore.isLoaded.addListener(this.handleLoadedStoreChange),this.handleLoadedStoreChange(),this.renderStartTime=performance.now()}UNSAFE_willMountOrUpdate(e){super.UNSAFE_willMountOrUpdate(e);const{store:t}=e,o=t.id,{collectionContextStore:r}=this,i=this.collectionContextStore.collectionViewStore(),n=this.collectionContextStore.collectionStore(),s=this.environment.currentUser.id,l=i?i.id:void 0,a=n?n.id:void 0,c=this.getViewStores().map((e=>e.id)),d=this.getDefaultCollectionViewStore(),u=P.Z.get({userId:s,key:vo.Z.getLocalViewPreferenceKey(o)});let p;const h=t=>!!e.isUnlistedView||c.includes(t);if(e.viewId&&h(e.viewId)?p=e.viewId:i&&h(i.id)?p=i.id:u&&h(u)?p=u:d&&h(d.id)&&(p=d.id),p){const e=ge.Xr.createChildStore(t,{table:j.np,id:p}),i=e.getCollectionStore(),n=!i||i.isDefined();e.isDefined()&&n&&(p!==u&&P.Z.set({userId:s,key:vo.Z.getLocalViewPreferenceKey(o),value:p}),(p!==l||i&&i.id!==a)&&pe.mc({environment:this.environment,collectionViewBlockStore:t,collectionViewStore:e,collectionStore:i,collectionContextStore:r,isFullScreen:this.isFullScreen(),isRootChild:this.isRootOrDirectChild(),isInPeekRenderer:this.isInPeekRenderer()}),void 0===r.frozoneStore.state.frozenIndex&&this.resetFrozoneStore(e))}const m=r.collectionStore();if(m){m.getTemplatePageStores().map((e=>e.getValue()))}this.isSyncingStore.addListener(this.initializeSyncStatePolling),this.ensureStoreListeners()}UNSAFE_willUpdate(){this.trackRenderTime({isFirstRender:!1})}didMount(){var e,t;super.didMount(),gm.Z.addListener(this.handlePageVisibilityChange),Xo.default.addListener(this.handlePeekViewChange),this.collectionContextStore.relativeVariablesAreStale.addListener(this.handleRelativeVariableStaleStoreChange);const o=this.collectionContextStore.collectionViewStore(),r=this.collectionContextStore.collectionStore();if(o&&r){const e=this.getCurrentViewType();e&&sm.j(this.environment,"database_visit",{collection_id:r.id,collection_view_id:o.id,collection_view_block_id:this.props.store.id,type:e,is_full_screen:this.isFullScreen(),is_peek:this.isInPeekRenderer(),peek_mode:Xo.default.state.mode,database_visit_id:this.collectionContextStore.visitSessionId})}if(o&&"collectionTypedView"===this.collectionContextStore.contextType){const e=this.collectionContextStore.databaseType,t=this.getCurrentViewType();e&&t&&sm.lu(this.environment,"type_aggregated_database_visit",`type_aggregated_database_visit-${e}`,60,{collection_view_id:o.id,collection_view_block_id:this.props.store.id,type:t,databaseType:e,is_my_tasks:(0,Fh.Ep)("myTasks")===this.props.store.id})}const i=this.collectionContextStore.sprintSettingsContextStore.state;X.Wu({environment:this.environment,sprintSettingsContext:i}),null===(e=(t=this.props).setCollectionContextStore)||void 0===e||e.call(t,this.collectionContextStore)}didMountOrUpdate(){var e,t;const o=this.getCollectionStore();o?this.resetCollectionSubscriptions([o.id]):this.resetCollectionSubscriptions(this.collectionContextStore.remoteCollectionIds.state);const r=this.collectionContextStore.frozoneStore.state.scrollerWidth,i=null===(e=this.collectionContextStore.collectionViewStore())||void 0===e?void 0:e.getTableFrozenColumnIndex(r,this.collectionContextStore.normalizedFormatStore.state);var s;(void 0===i||this.isCompactView.state||this.collectionContextStore.frozoneStore.setState({...this.collectionContextStore.frozoneStore.state,frozenIndex:i}),this.collectionContextStore.remoteCollectionIds.addListener((e=>this.resetCollectionSubscriptions(e.state))),this.subscribeToTypeChanges(),this.parentNode)||(this.parentNode=null===(s=n.findDOMNode(this))||void 0===s?void 0:s.parentElement,this.parentNode&&((0,ji.lj)(this.parentNode,"focusin",this.handleFocusIn),(0,ji.lj)(this.parentNode,"focusout",this.handleFocusOut),(0,ji.lj)(this.parentNode,"mousemove",this.handleMouseMove),(0,ji.lj)(this.parentNode,"mouseleave",this.handleMouseLeave)));const l=null===(t=this.horizontalScrollerEl)||void 0===t?void 0:t.scrollerEl();l&&(0,ji.lj)(l,"scroll",this.handleScroll)}didUpdate(e){this.trackSwitchViewLag()}willUnmount(){var e,t;super.willUnmount();const{collectionContextStore:o}=this;pe.ob({collectionContextStore:o}),this.unsubscribeAll(),this.headerSizeObserver.destroy(),gm.Z.removeListener(this.handlePageVisibilityChange),Xo.default.removeListener(this.handlePeekViewChange),this.collectionContextStore.isLoaded.removeListener(this.handleLoadedStoreChange),this.collectionContextStore.relativeVariablesAreStale.removeListener(this.handleRelativeVariableStaleStoreChange),this.parentNode&&((0,ji.ZV)(this.parentNode,"focusin",this.handleFocusIn),(0,ji.ZV)(this.parentNode,"focusout",this.handleFocusOut),(0,ji.ZV)(this.parentNode,"mousemove",this.handleMouseMove),(0,ji.ZV)(this.parentNode,"mouseleave",this.handleMouseLeave));const r=null===(e=this.horizontalScrollerEl)||void 0===e?void 0:e.scrollerEl();r&&(0,ji.ZV)(r,"scroll",this.handleScroll),null===(t=this.resizeObserver)||void 0===t||t.disconnect(),this.isSyncingStore.removeListener(this.initializeSyncStatePolling),clearTimeout(this.syncStateTimeout)}renderPersisted(){const{collectionContextStore:e}=this,t=this.getCurrentCollectionViewStore(),o=this.getCollectionStore(),r=e.normalizedSchemaStore.state,i=e.normalizedQueryStore.state,n=e.normalizedFormatStore.state,s=e.remoteResult.state,l=this.isFullScreen();if(!(t&&r&&i&&n))return;const a=this.getCurrentViewType();if(!a)return;if(o&&!o.isDefined())return;const c=null==o?void 0:o.getFormat();if(this.isCollectionViewOfExternalCollectionWithoutExternalObjectId())return(0,b.jsx)(tn.L1,{value:this.collectionContextStore,children:(0,b.jsx)(Fs.p,{allowSelectionWithin:!0,style:this.getHeaderWrapStyle(),onMouseDown:this.handleEditorMouseDown,onMouseMove:this.handleHeaderMouseMove,onMouseLeave:this.handleHeaderMouseLeave,onClick:this.handleEditorClick,ref:this.handleHeaderMount,children:(0,b.jsx)(It.Z,{store:this.props.store,shouldShowHoverMenu:!0,analyticsName:qC(a),shouldShowHalo:!this.isFullScreen()&&!this.isCompactView.state,canSelect:!this.isFullScreen(),children:(0,b.jsx)(hC.Z,{store:this.props.store,style:{width:"auto"},disabled:!1})})})});const d=(0,Wa.$3)(this.environment)-jp.zL,u=this.isInFrameWhenSidePeekOpen.state&&!this.props.isFullScreen&&!(0,ce._5)(this.props.store)&&d>0&&!this.collectionContextStore.isInHomeWidget.state,p=this.renderView(o,t,a,r,i,n),h=this.isInPeek.state?St.Z.X:(0,vh.p5)({environment:this.environment,isFullScreen:this.isFullScreen()}),m=(0,b.jsx)(Ct.Z,{type:h,className:fo.x9t,onMouseDown:this.handleEditorMouseDown,preventType:this.isInPeek.state||this.collectionContextStore.isInHomeWidget.state?St.Z.None:q.Q7(this.environment),onClick:e=>this.handleEditorClick(e,a),style:this.getScrollerStyle(a,n,u?d/2:void 0),ref:this.handleHorizontalScrollerMount,children:p}),S=(0,b.jsx)(yt,{style:{..."list"===a?{paddingBottom:8}:"timeline"===a?{paddingBottom:0}:{paddingBottom:16}},children:m}),g=this.getHeaderWrapStyle(),C={flexGrow:1,flexShrink:0,display:"flex",flexDirection:"column",...this.leftRightMargin.state},f=l?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{style:{position:"sticky",height:0,left:0,zIndex:F.Nm},children:[this.renderViewSettings(),this.maybeRenderJiraOverlayMessages(c,null==s?void 0:s.sizeHint,g.paddingLeft,g.paddingRight)]}),(0,b.jsx)(Fs.p,{allowSelectionWithin:!0,style:{...C,position:"relative"},children:m})]}):(0,b.jsx)(Fs.p,{allowSelectionWithin:!0,style:{flexGrow:1,flexShrink:0,display:"flex",flexDirection:"column",...this.leftRightMargin.state,...u&&{marginLeft:-d/2},maxHeight:this.props.maxHeight?this.props.maxHeight-this.headerHeight.state:"inherit"},children:(0,b.jsxs)("div",{style:{position:"relative",...this.isCompactView.state?{height:"100%",maxHeight:"inherit"}:{}},children:[this.shouldRenderCompactViewVerticalScroller.state?S:m,this.renderViewSettings(),this.maybeRenderJiraOverlayMessages(c,null==s?void 0:s.sizeHint,g.paddingLeft,g.paddingRight)]})});return(0,b.jsxs)(tn.L1,{value:this.collectionContextStore,children:[(0,b.jsx)(QC,{}),this.renderMultiSelectToolbar(),this.renderHeader(a),f,this.renderBottomBorderForViewSettings(),(0,b.jsx)(HC,{collectionContextStore:this.collectionContextStore,parentMountTime:this.renderStartTime})]})}maybeRenderJiraOverlayMessages(e,t,o,r){var i;return(0,cm.K)()&&(0,cm.Y)()&&"Jira"!==(null==e?void 0:e.external_collection_type)&&null!=e&&null!==(i=e.sync_state)&&void 0!==i&&i.syncing&&!t?(0,b.jsx)(SC,{projectCount:(null==e?void 0:e.projects_to_be_synced)||0,taskCount:(null==e?void 0:e.tasks_to_be_synced)||0,paddingLeft:o,paddingRight:r}):null}renderUnlistedCollectionsActionBar(){const{store:e}=this.props;return(0,b.jsx)(tn.L1,{value:this.collectionContextStore,children:(0,b.jsx)(Fs.p,{allowSelectionWithin:!0,style:{...N.CE(this.getHeaderWrapStyle(),["opacity","height","minHeight","pointerEvents"])},onMouseDown:this.handleEditorMouseDown,onMouseMove:this.handleHeaderMouseMove,onMouseLeave:this.handleHeaderMouseLeave,ref:this.handleHeaderMount,children:(0,b.jsx)(It.Z,{store:e,shouldShowCopyLinkButton:e.isNonEditableState(),shouldShowHoverMenu:!0,analyticsName:qC("table"),children:(0,b.jsxs)("div",{style:this.getHeaderStyle(),children:[!this.props.hideViewTabBar&&this.renderViewTabBar(),(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[this.renderLoadingSpinner(),this.renderFilterButton(),this.renderSortButton(),this.renderSearch(),(0,b.jsx)(LC,{collectionContextStore:this.collectionContextStore})]})]})})})})}renderHeader(e){var t;const{device:o}=this.environment,{store:r,disableHoverMenu:i}=this.props,n=this.isFullScreen(),s=this.noDateReducerStore.state,l=this.hasTasksReducerStore.state,a=this.showHoverActionsStore.state,c=this.showCompactDesktopHeaderStore.state,d=this.leftRightPadding.state,u=(null===(t=this.collectionContextStore.collectionViewBlockStore())||void 0===t?void 0:t.isCollectionViewPageWithContent())&&"page"===this.getCurrentViewType(),p=this.shouldShowProjManagementTooltipTour()?(0,b.jsx)(Eg.Z,{store:r,origin:this.renderViewSettingsButton(),isFirstTooltip:!1,phase:"click_view_settings"}):this.renderViewSettingsButton(),h=co.default.checkGate("prevent_edits_trash");return(0,b.jsxs)(Fs.p,{allowSelectionWithin:!0,style:this.getHeaderWrapStyle(),onMouseDown:this.handleEditorMouseDown,onMouseMove:this.handleHeaderMouseMove,onMouseLeave:this.handleHeaderMouseLeave,ref:this.handleHeaderMount,children:[d&&(0,b.jsxs)(It.Z,{store:r,shouldShowCopyLinkButton:r.isNonEditableState(),shouldShowHoverMenu:!i&&this.canEdit()&&!n,analyticsName:qC(e),children:[o.isPhone?(0,b.jsxs)("div",{style:this.getHeaderStyle(),children:[!this.props.hideViewTabBar&&this.renderViewTabBar(),!this.props.hideHeaderActions&&(0,b.jsx)(Ds.Z,{isVisible:!0,animationStyle:{opacity:a?1:0},render:()=>(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[this.renderLoadingSpinner(),this.renderFullScreenButton(),p,this.renderAddItemButton()]})})]}):(0,b.jsxs)("div",{style:this.getHeaderStyle(),children:[!this.props.hideViewTabBar&&this.renderViewTabBar(),!this.props.hideHeaderActions&&(0,b.jsx)(Ds.Z,{isVisible:!0,animationStyle:{opacity:a?1:0},render:()=>(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:2},children:[this.renderLoadingSpinner(),!c&&this.renderLockIndicator(),!c&&this.renderNoDateButton(),"page"!==e&&this.renderFilterButton(),"page"!==e&&this.renderSortButton(),this.renderAutomationSettingsButton(),!c&&"page"!==e&&this.renderSearch(),u&&this.renderPageViewSearch(),this.renderFullScreenButton(),p,this.renderAddItemButton()]})})]}),l&&(0,b.jsx)(ze.Z,{id:"tasks_results",collectionContextStore:this.collectionContextStore,reducer:l,resultStore:this.stores.tasksResultStore}),s&&(0,b.jsx)(ze.Z,{id:"no_date_count",collectionContextStore:this.collectionContextStore,reducer:s,resultStore:this.stores.noDateResultStore})]}),(0,b.jsxs)("div",{style:this.getHeaderPositioningStyle(),children:[this.renderSource(),h?(0,b.jsx)(YC,{collectionContextStore:this.collectionContextStore}):null,this.renderFilterBar()]})]})}renderLockIndicator(){const{device:e}=this.environment,{store:t}=this.props;if(!this.isFullScreen()&&!e.isPhone&&t.canEditCollection())return(0,b.jsx)(CC.Z,{store:t,isMobile:!1,isInlineCollection:!0,disableTooltip:!0,buttonStyle:{marginLeft:4,marginRight:4}})}renderViewTabBar(){return(0,b.jsx)(Jh,{collectionContextStore:this.collectionContextStore,showHoverActionsStore:this.showHoverActionsStore,isPlaceholderExternalCollectionStore:this.isPlaceholderExternalCollectionStore,onViewClick:this.handleViewClick,disabled:this.props.hideHeader||this.collectionContextStore.isInHomeWidget.state})}renderFullScreenButton(){if(this.isFullScreen())return;const e=(0,Ko.ZP)({store:this.props.store,fullyQualified:!1,pageVisitSource:h.tY.Expand}),t=ho.default.formatMessage(zC.openFullscreenPageButtonTooltip),o=0===this.collectionContextStore.collectionStoresStore.state.length;return(0,b.jsx)(Xe.ZP,{disableTooltip:o,renderTooltip:()=>t,render:r=>(0,b.jsx)(jt.Z,{ariaLabel:t,href:o?void 0:e,onClick:this.handleOpenAsPageClick,icon:k.Z,style:this.getTopbarIconButtonStyle(),iconStyle:{fill:this.getTopbarIconButtonStyle().fill,width:16},disabled:o,disabledFeedback:o,...r})})}renderAutomationSettingsButton(){var e;const{collectionContextStore:t,automationsViewRef:o}=this,r=this.getCurrentViewType(),i=t.settingsStore,n=i.state.open,s=(0,um.n)(i),l=(0,S.Cf)({tab:s}),a=t.aliveAutomationCount.state;if("page"===r||this.isPlaceholderExternalCollectionStore.state||!(0,am.cB)(t))return;const c=co.default.checkGate("prevent_edits_trash"),d=null===(e=$o.default.getState().mainEditorCurrentBlockStore)||void 0===e?void 0:e.pathIsDead(),u=t.collectionStore(),p=null==u?void 0:u.getParentBlockStore(),h=null==p?void 0:p.pathIsDead(),m=a>0,g=c&&(h||d)&&!m;return(0,b.jsx)(Xe.ZP,{renderTooltip:()=>g?ho.default.formatMessage(zC.disableAutomationsSettingsButtonTooltip):ho.default.formatMessage(zC.openAutomationsSettingsButtonTooltip),render:e=>(0,b.jsx)(jt.Z,{ariaLabel:g?ho.default.formatMessage(zC.disableAutomationsSettingsButtonAriaLabel):ho.default.formatMessage(zC.openAutomationsSettingsButtonAriaLabel),className:fo.RIA,icon:f.K,style:this.getTopbarIconButtonStyle(),iconStyle:{width:void 0,height:14,fill:m?this.theme.icon.uiBluePrimary:this.theme.mediumIconColor},hovered:n&&l,onClick:this.handleViewAutomationSettingsClick,ref:o,disabled:g,...e})})}renderViewSettingsButton(){return this.isPlaceholderExternalCollectionStore.state?null:(0,b.jsx)(Ya.LazyCollectionViewSettingsButton,{collectionContextStore:this.collectionContextStore,style:this.getTopbarIconButtonStyle()})}renderFilterButton(){const{device:e}=this.environment,{createFilterSettingsStore:t}=this.stores;if(this.shouldRenderOptions()&&!this.isPlaceholderExternalCollectionStore.state)return(0,b.jsx)(Ye.ZP,{popupType:e.isMobile?qe.Z4.SlideUp:qe.Z4.Popup,open:t.state.open,origin:this.renderFilterButtonOrigin(),onDismiss:this.handleCreateFilterPopupDismiss,originGap:4,render:this.renderCreateFilterPopup})}renderFilterButtonOrigin(){const e=this.hasAppliedFilter.state;if(this.showCompactDesktopHeaderStore.state||this.isCompactView.state){const t=ho.default.formatMessage(zC.filterLabel),o=0===this.collectionContextStore.collectionStoresStore.state.length;return(0,b.jsx)(Xe.ZP,{renderTooltip:()=>t,disableTooltip:o,render:r=>(0,b.jsx)(jt.Z,{...r,disabled:o,ariaLabel:t,icon:v.Q,iconStyle:{width:14,height:void 0,fill:e?this.theme.icon.uiBluePrimary:this.theme.mediumIconColor},style:this.getTopbarIconButtonStyle(),onClick:this.handleFilterClick})})}return(0,b.jsx)(Qe.Z,{style:this.getTopbarActionButtonStyle(e),isBlue:e,onClick:this.handleFilterClick,children:(0,b.jsx)(B.FormattedMessage,{...zC.filterLabel})})}renderSortButton(){const{device:e}=this.environment,{createSortSettingsStore:t}=this.stores;if(this.shouldRenderOptions()&&!this.isPlaceholderExternalCollectionStore.state)return(0,b.jsx)(Ye.ZP,{popupType:e.isMobile?qe.Z4.SlideUp:qe.Z4.Popup,open:t.state.open,origin:this.renderSortButtonOrigin(),onDismiss:this.handleCreateSortPopupDismiss,originGap:4,render:this.renderCreateSortPopup})}renderSortButtonOrigin(){const e=this.hasSort.state;if(this.showCompactDesktopHeaderStore.state||this.isCompactView.state){const t=ho.default.formatMessage(zC.sortLabel),o=0===this.collectionContextStore.collectionStoresStore.state.length;return(0,b.jsx)(Xe.ZP,{renderTooltip:()=>t,disableTooltip:o,render:r=>(0,b.jsx)(jt.Z,{...r,disabled:o,ariaLabel:t,icon:T.j,iconStyle:{width:18,height:void 0,fill:e?this.theme.icon.uiBluePrimary:this.theme.mediumIconColor},style:this.getTopbarIconButtonStyle(),onClick:this.handleSortClick})})}return(0,b.jsx)(Qe.Z,{style:this.getTopbarActionButtonStyle(e),isBlue:e,onClick:this.handleSortClick,children:(0,b.jsx)(B.FormattedMessage,{...zC.sortLabel})})}renderSearch(){const{collectionContextStore:e}=this;if(!this.shouldRenderOptions()||this.isPlaceholderExternalCollectionStore.state)return;const t=e.searchOpen.state,o=e.searchQuery.state,r=0===this.collectionContextStore.collectionStoresStore.state.length;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(jt.Z,{icon:y.e,iconStyle:{width:14,height:void 0,fill:this.theme.mediumIconColor},style:this.getTopbarIconButtonStyle(),disabled:r,onClick:this.handleSearchButtonClick}),(0,b.jsx)(Ds.Z,{isVisible:t,animationStyle:{width:150,opacity:1},enterAnimationStyle:{width:0,opacity:0},exitAnimationStyle:{width:0,opacity:0},render:()=>(0,b.jsx)(bd.Z,{capture:t,allowEsc:!0,render:e=>(0,b.jsx)("div",{...e,children:(0,b.jsx)("div",{style:{display:"flex",alignItems:"center",overflow:"hidden"},children:(0,b.jsx)(pC.Z,{style:this.getSearchInputStyle(),format:pC.B.Transparent,value:o,onChange:this.handleSearchQueryChange,placeholder:ho.default.formatMessage(zC.searchInputPlaceholder),focusInitial:t,showClearButton:!0,onFocus:this.handleSearchFocus,onBlur:this.handleSearchBlur,onCancel:this.handleClearSearch,onClick:me.Wi,onClearButtonClick:this.handleClearSearch,onKeyDown:this.handleSearchKeyDown})})})})})]})}renderPageViewSearch(){var e;const t=this.getCurrentCollectionViewStore();if("page"!==(null==t?void 0:t.getType()))return null;const o=null===(e=this.collectionContextStore.collectionViewBlockStore())||void 0===e?void 0:e.id;return o?(0,b.jsxs)(Qe.Z,{style:{display:"flex",alignItems:"center",fontSize:14,fontWeight:D.Z.fontWeight.medium,color:this.theme.mediumTextColor},onClick:()=>{Q.Kf({environment:this.environment,analyticsFrom:"wiki-home-collection-view"}),fm.ZP.updateFilters({ancestors:[o]})},children:[(0,y.e)({width:14,fill:this.theme.mediumIconColor,marginRight:6}),(0,b.jsx)(B.FormattedMessage,{defaultMessage:"Search",id:"database.collectionViewBlock.pageView.search"})]}):null}renderAddItemButton(){const{collectionContextStore:e}=this;if("page"===this.getCurrentViewType()||this.isPlaceholderExternalCollectionStore.state||!e.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return null;const t=(0,ce.PI)(e),o={fontSize:14,...this.isCompactView.state?{marginLeft:4,marginRight:6,marginTop:4,width:24,height:24}:{marginLeft:6,height:28}},r=this.isCompactView.state?{marginRight:0,marginLeft:-4,width:15}:{},i=this.isMultiSourceView.state,n=e=>(0,b.jsx)(yC.Z,{title:this.isCompactView.state?null:t,icon:this.isCompactView.state?_.f:void 0,color:"blue",onClick:this.handleAddItemClick,dropdownEvents:e,style:o,iconStyle:r,className:fo.sqL,disabled:Boolean(this.reasonToDisableNewTaskButton.state),disableDropdown:i});return(0,b.jsx)(qe.ZP,{popupType:this.environment.device.isMobile?Ye.kQ.SlideUp:Ye.kQ.Popup,render:this.renderTemplatesPopup,originGap:4,onClick:this.handleTemplatesDropdownClick,renderOrigin:e=>this.shouldShowProjManagementTooltipTour()?(0,b.jsx)(Eg.Z,{store:this.props.store,origin:n(e),isFirstTooltip:!0,phase:"create_a_task"}):(0,b.jsx)(Xe.ZP,{disableTooltip:Boolean(this.reasonToDisableNewTaskButton.state),renderTooltip:()=>this.reasonToDisableNewTaskButton.state===cC?(0,b.jsx)(B.FormattedMessage,{defaultMessage:"You do not have permissions{br}to edit the source databases",id:"collectionViewBlock.addItem.tooltip.noWritableDbs",values:{br:(0,b.jsx)("br",{})}}):this.isCompactView.state?t:null,render:t=>this.isCompactView.state||this.reasonToDisableNewTaskButton.state===cC?(0,b.jsx)("div",{...t,style:{marginLeft:4,marginRight:4},children:n(e)}):n(e)}),buttonPopupStore:this.stores.templateButtonPopupStore})}renderNoDateButton(){const e=this.noDateTotal.state,{collectionContextStore:t}=this,o=t.permissionScopes.state,r=t.collectionStore();if(0!==e&&("collectionTypedView"===t.contextType||r&&o.canEditContent))return(0,b.jsx)(qe.ZP,{popupType:this.environment.device.isMobile?Ye.kQ.SlideUp:Ye.kQ.Popup,render:this.renderNoDatePopup,onClick:this.handleNoDateButtonClick,renderOrigin:t=>(0,b.jsx)(Qe.Z,{isGray:!0,style:this.getTopbarActionButtonStyle(!1),...t,children:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"No date ({noDateTotal})",id:"collectionViewBlock.action.noDateButton.noProperty.label",values:{noDateTotal:e}})})})}renderFilterBar(){const{collectionContextStore:e}=this,t=e.filtersBarOpenStore.state,o=e.shouldShowSource.state?8:12;if("page"!==this.getCurrentViewType()&&!this.isCompactView.state){if(!t){if(!e.getCompleteSprintButtonContext.state)return;return(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",paddingBottom:this.environment.device.isPhone?12:8,paddingTop:o},children:[(0,b.jsx)("div",{style:{flex:1}}),(0,b.jsx)(vC.Z,{collectionContextStore:e})]})}return(0,b.jsx)(Up.Z,{collectionContextStore:this.collectionContextStore,showHoverActionsStore:this.showHoverActionsStore,createFilterSettingsStore:this.stores.filterBarCreateFilterSettingsStore,saveControlMoreActionsButtonPopupStore:this.stores.saveControlMoreActionsButtonPopupStore})}}renderSource(){if(!this.isPlaceholderExternalCollectionStore.state)return this.collectionContextStore.shouldShowSource.state?(0,b.jsx)(Bp,{store:this.props.store,collectionContextStore:this.collectionContextStore,isFullScreen:this.isFullScreen(),showHoverActionsStore:this.showHoverActionsStore,canEdit:this.canEdit()}):void 0}renderView(e,t,o,r,i,n){const{store:s}=this.props,{collectionContextStore:l}=this,a=!this.canEdit()||"collectionVirtualView"===l.contextType;"rendered"!==$o.default.state.renderPhase&&$o.default.setState({...$o.default.state,renderPhase:"rendered"});const c=this.isFullScreen(),d=this.isInPeekRenderer(),u=this.getBlockPropertyValueOverlayStore(),p=this.isRootOrDirectChild();let h=this.leftRightPadding.state;if(h){if(!e&&this.collectionContextStore.hasSingleCollection())return this.renderNoSourcePlaceholder(o);if(this.isPlaceholderExternalCollectionStore.state)return this.renderNoSourceExternalCollectionPlaceholder(o);if(this.isTasksEmpty.state)return(0,b.jsx)(dC,{collectionContextStore:l,onAddTaskClick:this.handleAddItemClick,from:l.isCompactView.state?"home_tile_tasks":"home_tasks"});if("table"===o)return(0,b.jsx)(Oc,{schema:r,format:n,query:i,store:s,collectionContextStore:l,showHoverActionsStore:this.showHoverActionsStore,isFullScreen:c,isInPeekRenderer:d,...h,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:u,isRootChild:p,viewSettingsPlacementStore:this.stores.viewSettingsPlacementStore},t.id);if("board"===o)return(0,b.jsx)(zm,{schema:r,format:n,query:i,store:s,collectionContextStore:l,isFullScreen:c,isInPeekRenderer:d,...h,paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:u,isRootChild:p},t.id);if("page"===o){const e=t.getFormat().page_pointer;if(!e)return;const o=this.createComputedStore((()=>s.id===e.id?s:ge.G.createChildStore(s,{table:e.table,id:e.id}))),r=(0,vh.ui)(this.environment),i=o.state;if(!i.isCollectionView())return;const n=this.canEdit();return(0,b.jsx)(IC,{canEdit:n,disabled:this.props.disabled||this.props.store.isNonEditableState(),padding:{paddingBottom:fC.ZP.paddingBottom(this.environment),paddingLeft:r,paddingRight:r},store:i,style:fC.d$})}return"calendar"===o?(0,b.jsx)(NS,{schema:r,format:n,query:i,store:s,collectionContextStore:l,isFullScreen:c,isInPeekRenderer:d,...h,maxHeight:this.props.maxHeight?this.props.maxHeight-this.headerHeight.state:void 0,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:u,isRootChild:p},t.id):"list"===o?(this.isInFrameWhenSidePeekOpen.state&&!this.collectionContextStore.isInHomeWidget.state&&(h={...h,paddingRight:24}),(0,b.jsx)(hg,{schema:r,format:n,query:i,store:s,collectionContextStore:l,isFullScreen:c,isInPeekRenderer:d,...h,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:u,isRootChild:p},t.id)):"gallery"===o?(0,b.jsx)(hs,{schema:r,format:n,query:i,store:s,collectionContextStore:l,isFullScreen:c,isInPeekRenderer:d,...h,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:u,isRootChild:p},t.id):"timeline"===o?(0,b.jsx)(yp,{schema:r,format:n,query:i,store:s,collectionContextStore:l,isFullScreen:c,isRootChild:p,isInPeekRenderer:d,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:u,showHoverActionsStore:this.showHoverActionsStore,ref:this.timelineViewRef,...h},t.id):"chart"===o?(0,b.jsx)(Ya.LazyCollectionChartView,{collectionContextStore:l,headingWidth:this.headerSizeObserver.rect.state.width,...h},t.id):void 0}}renderNoSourcePlaceholder(e){const t=this.isFullScreen(),o=this.collectionContextStore.permissionScopes.state;return(0,b.jsx)(Nc,{collectionContextStore:this.collectionContextStore,title:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"No data source",id:"collectionViewBlock.noSourcePlaceholder.title"}),description:o.canConfigureBlock?(0,b.jsx)(B.FormattedMessage,{defaultMessage:"<button>Select a data source</button> to continue",id:"collectionViewBlock.setSourceButton.title",values:{button:e=>(0,b.jsx)(Bc,{onClick:this.handleSetSourceClick,children:e})}}):void 0,icon:w({height:48,fill:this.theme.lightIconColor,margin:"0 auto"}),style:{...this.leftRightPadding.state,paddingBottom:t?void 0:this.getPaddingBottom(e)}})}renderNoSourceExternalCollectionPlaceholder(e){var t;const o=this.isFullScreen(),r=this.collectionContextStore.permissionScopes.state,i=this.collectionContextStore.settingsStore.state.open,n={display:"inline",padding:"1px 2px",borderRadius:4,textDecoration:"underline"},s=this.getExternalIntegrationId.state,l=md.Z.integrations.state.find((e=>e.id===s)),a=!(this.environment.device.isMobileBrowser&&this.isPlaceholderExternalCollectionStore.state&&!this.isUserAuthenticated());if(l)return(0,b.jsx)("div",{style:{...this.leftRightPadding.state,paddingTop:8,paddingBottom:o?void 0:this.getPaddingBottom(e),height:250,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,b.jsxs)("div",{style:{paddingRight:i?Os.nJ:void 0,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,b.jsx)(Do.Z,{icon:null===(t=this.collectionContextStore.collectionStore())||void 0===t?void 0:t.getIcon(),size:48,disabled:!0,isEmptyPage:!1}),(0,b.jsx)("div",{style:{fontSize:17,fontWeight:D.Z.fontWeight.medium,color:this.theme.lightTextColor,textAlign:"center",marginBottom:-2},children:(0,b.jsx)(B.FormattedMessage,{defaultMessage:"{integrationName}",id:"collectionViewBlock.setExternalSource.title",values:{integrationName:l.name}})}),r.canConfigureBlock&&(0,b.jsx)("div",{style:{margin:"0 auto",width:"max-content",fontSize:14,textAlign:"center",color:this.theme.lightTextColor},children:a&&(0,b.jsx)(B.FormattedMessage,{defaultMessage:"<button>Link to {integrationName}</button> to continue",id:"collectionViewBlock.setExternalSourceButton.title",values:{integrationName:l.name,button:e=>(0,b.jsx)(Yt.Z,{style:n,onClick:this.handleSetSourceClick,children:e})}})})]})})}renderLoadingSpinner(){const e=this.collectionContextStore.shouldShowSpinner.state;return(0,b.jsx)(cd.Z,{show:e,...ce.Mq,render:e=>e?(0,b.jsx)("div",{style:{display:"flex",alignItems:"center",flexDirection:"column",marginRight:4},children:(0,b.jsx)(Ge.Z,{style:{width:14,height:14}})}):void 0},"loading-spinner")}renderBottomBorderForViewSettings(){const{collectionContextStore:e}=this;if(e.settingsStore.state.open&&"sidebar"===this.stores.viewSettingsPlacementStore.state)return(0,b.jsx)("div",{style:{...this.leftRightPadding.state,...this.leftRightMargin.state,borderTop:`1px solid ${this.theme.tableDividerColor}`,height:12}})}renderMultiSelectToolbar(){if((0,ce.fk)({environment:this.environment,collectionContextStore:this.collectionContextStore})){var e;const t=(null===(e=this.leftRightPadding.state)||void 0===e?void 0:e.paddingLeft)??0,o=this.leftRightMargin.state.marginLeft??0;return(0,b.jsx)($g,{marginLeft:t+o})}}unsubscribeAll(){for(const e of this.subscriptions.values())e.unsubscribe();this.collectionTypeChangeSubscription&&this.collectionTypeChangeSubscription.unsubscribe()}resetFrozoneStore(e){var t,o;if(this.isCompactView.state)return;const r=null===(t=this.horizontalScrollerEl)||void 0===t?void 0:t.stores.store.state.clientWidth,i=this.collectionContextStore.normalizedFormatStore.state;this.collectionContextStore.frozoneStore.setState({isScrolled:!1,scrollerWidth:r,scrollerLeftOffset:(null===(o=this.horizontalScrollerEl)||void 0===o||null===(o=o.stores.store.state.clientRect)||void 0===o?void 0:o.left)??0,frozenIndex:null==e?void 0:e.getTableFrozenColumnIndex(r,i),tryShowHiddenFrozenColumn:!1})}isCollectionViewOfExternalCollectionWithoutExternalObjectId(){var e;const t=null===(e=this.getCollectionStore())||void 0===e?void 0:e.getValue();return Boolean(t&&(0,g.Ev)(t))}isUserAuthenticated(){const e=this.collectionContextStore.collectionStore();if(!e)return!1;const t=e.getFormat().integration_id,o=md.Z.integrations.state.find((e=>e.id===t));return!(!t||!o)&&(0,lm.NP)(t).length>0}getViewStores(){const{store:e}=this.props;return e.getCollectionViewStores()}getCurrentCollectionViewStore(){return this.collectionContextStore.collectionViewStore()}getDefaultCollectionViewStore(){var e;const t=this.getViewStores();if(null!==(e=t[0])&&void 0!==e&&e.isDefined())return t[0]}getCollectionStore(){return this.collectionContextStore.collectionStore()}getMinWidth(){const{store:e}=this.props,{device:t}=this.environment,o=t.isPhone,r=this.isFullScreen(),i=this.getCurrentViewType(),n=("gallery"===i||("calendar"===i||"list"===i)&&r)&&this.isInFrameWhenSidePeekOpen.state,s=(0,Wa.ll)(this.environment,this.isInPeekRenderer()),l=Xo.default.state;return this.collectionContextStore.isInHomeWidget.state?void 0:r||this.isRootOrDirectChild()?o?`calc(100% - ${2*(0,vh.ui)(this.environment)}px - ${s}px)`:this.isInPeekRenderer()?`calc(100% - ${2*Xo.PeekModePadding.horizontal[l.mode]}px - ${s}px)`:this.isInFrameWhenSidePeekOpen.state?(0,Wa.$3)(this.environment)+(n?(0,Wa.vJ)(this.environment):0):r?`calc(100% - ${2*(0,vh.CP)(this.environment)}px - ${s}px)`:(0,ce._5)(e)?`calc(100% - ${2*(0,vh.ui)(this.environment)}px - ${s}px)`:jp.zL-2*(0,vh.ui)(this.environment)-s:`calc(100% - ${s}px)`}isInPeekRenderer(){return(0,ce.en)(this.props.store)}getBlockPropertyValueOverlayStore(){return this.isInPeekRenderer()?Cm.Z:mm.Z}resetLeftScrollAfterFlush(){l.default.afterNextFlush((()=>{var e;const t=null===(e=this.horizontalScrollerEl)||void 0===e?void 0:e.scrollerEl();if(t){t.scrollLeft=0;const e=Se.xH(t);e&&(e.scrollLeft=0)}}))}isFullScreen(){return Boolean(this.props.isFullScreen)}getDefaultResults(){const e=this.collectionContextStore.localResultStore.state,t=this.getCollectionStore();if(t&&e&&"reducer"===e.type){const o=N.sE(e.reducerResults,(e=>"results"===e.type));if(o)return o.blockIds.map((e=>ge.G.createChildStore(t,{id:e,table:M.iU})))}return[]}getCurrentViewType(){var e;const{collectionContextStore:t}=this,o=this.props.overrideViewType??(null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType());if(!o)throw new Error("View type was not defined.");return o}getNoDateProperty(){const e=this.collectionContextStore.collectionViewStore(),t=this.collectionContextStore.normalizedQueryStore.state;if(!e||!t)return;const o=this.getCurrentViewType();return"timeline"===o&&t.timeline_by?t.timeline_by:"calendar"===o&&t.calendar_by?t.calendar_by:void 0}ensureStoreListeners(){const{collectionContextStore:e}=this,{store:t}=this.props;e.blockIsPrivateStore.state;for(const o of t.getCollectionViewStores())o.getValue()}getScrollerStyle(e,t,o){const{store:r}=this.props,i=this.isFullScreen(),n=this.isRootOrDirectChild(),s=this.leftRightPadding.state,l=this.getPaddingBottom(e),a=this.collectionContextStore.settingsStore.state.open;return{flexGrow:1,flexShrink:0,...r.isNonEditableState()&&{cursor:"default"},..."timeline"===e&&this.collectionContextStore.collectionStore()&&!i&&!(0,Gn.fj)({environment:this.environment,isFullScreen:i,isRootChild:n,format:t})&&s&&{marginLeft:s.paddingLeft,marginRight:s.paddingRight,marginBottom:l},...a&&!i&&"sidebar"===this.stores.viewSettingsPlacementStore.state&&{minHeight:Os.j9},...this.collectionContextStore.isInHomeWidget.state?{paddingRight:this.isMyTasksPage.state?8:void 0,paddingLeft:this.isMyTasksPage.state?"list"===e?8:16:void 0}:{},...this.isCompactView.state&&!this.shouldRenderCompactViewVerticalScroller.state?{maxHeight:"inherit"}:{},...this.isTasksEmpty.state||!this.shouldRenderCompactViewVerticalScroller.state?{height:"100%"}:{},...this.isInFrameWhenSidePeekOpen.state&&"timeline"!==e&&!this.isCompactView.state?{position:"sticky",left:0,paddingLeft:void 0===this.collectionContextStore.frozoneStore.state.frozenIndex?0:o,width:(0,Wa.$3)(this.environment)}:{},..."page"===e?{zIndex:F.y}:{}}}getPaddingBottom(e){return this.props.isFullScreen?"timeline"===e?96:ZC:"timeline"===e||"gallery"===e?0:wt.Z.state}getHeaderWrapStyle(){const{hideHeader:e}=this.props,t=this.leftRightPadding.state,o=(0,Wa.$3)(this.environment),r=(0,ce._5)(this.props.store)||this.isFullScreen()?o:Math.min(jp.zL,o),i=this.isInFrameWhenSidePeekOpen.state&&!Xo.default.isSidePeekOpening.state;return{minHeight:this.headerHeight.state,paddingLeft:null==t?void 0:t.paddingLeft,paddingRight:i?0:null==t?void 0:t.paddingRight,flexShrink:0,...(this.isFullScreen()||i)&&{position:"sticky",zIndex:86,left:0,width:i&&t?r-(t.paddingLeft/2??0):void 0},...this.props.store.isNonEditableState()&&{cursor:"default"},...this.leftRightMargin.state,...e?{opacity:0,height:0,minHeight:void 0,pointerEvents:"none"}:{}}}getHeaderStyle(){const{collectionContextStore:e}=this,t=this.getCurrentViewType(),o=e.viewIsFlushToTopbar(),r=("timeline"===t||"table"===t)&&o||this.isCompactView.state;return{display:"flex",alignItems:"center",height:this.headerHeight.state,boxShadow:r?void 0:`inset 0 -1px 0 ${this.theme.tableDividerColor}`,...this.getHeaderPositioningStyle()}}getHeaderPositioningStyle(){const e=this.leftRightPadding.state;return{left:null==e?void 0:e.paddingLeft,width:"100%"}}getSearchInputStyle(){return{fontSize:14,lineHeight:1,paddingRight:4,color:this.theme.regularTextColor,marginBottom:1}}getTopbarActionButtonStyle(e){return{display:"flex",alignItems:"center",fontSize:14,height:28,padding:6,color:e?this.theme.blueColor:this.theme.mediumIconColor,fontWeight:D.Z.fontWeight.regular,lineHeight:1,borderRadius:4}}getTopbarIconButtonStyle(){return FC({theme:this.theme,isInHomeWidget:this.collectionContextStore.isInHomeWidget.state})}shouldShowProjManagementTooltipTour(){return this.canShowPmIntroTooltipStore.state}projManagementTooltipTourAssignToSomeone(){const e=$o.default.state.currentUserSettingsStore,t=$o.default.state.currentSpaceStore;e&&t&&te.uR({environment:this.environment,requiredCurrPhase:"create_a_task",nextPhase:"assign_to_someone",currentUserSettingsStore:e,currentSpaceStore:t})}trackRenderTime(e){let{isFirstRender:t}=e;const o=Hr.default.mark("collections.collection_view_block_render");Hr.default.measureAfterNextFlush(o,{environment:this.environment,getData:()=>({...he.vS(this.collectionContextStore),is_first_render:t})})}trackSwitchViewLag(){if(!this.switchViewMetric)return;const{from:e,to:t,metric:o,sizeHintAtStart:r}=this.switchViewMetric;Hr.default.measureAfterNextFlush(o,{environment:this.environment,getData:()=>{const o=he.vS(this.collectionContextStore),{view_type:i,row_count_category:n,...s}=o;return{from:e,to:t,did_trigger_fetch:this.collectionContextStore.isLoading.state,row_count_category:he.ZO(r),...s}}}),this.switchViewMetric=void 0}}KC.displayName="CollectionViewBlock",KC.contextTypes={...xn.wK,...s.w};class UC extends s.Z{componentDidCatch(e){throw I.vd("collections"),e}renderComponent(){const{collectionViewBlockRef:e,...t}=this.props;return(0,b.jsx)(KC,{...t,ref:e})}}const WC=i.forwardRef(((e,t)=>(0,b.jsx)(UC,{...e,collectionViewBlockRef:t}))),$C=KC;function qC(e){return"page"===e?"page_view":e}function QC(){return(0,d.VK)((()=>co.default.checkGate("collection_subitem_nested_operations")),[])?(0,b.jsx)(lh,{}):null}function YC(e){const{collectionContextStore:t}=e,o=(0,d.VK)((()=>{const e=t.collectionViewStore(),o=null==e?void 0:e.getParentBlockStore();return o&&o.pathIsDead()}),[t]),{parentBlockStore:r,isParentCollectionDead:i}=(0,d.VK)((()=>{const e=t.collectionStore(),o=null==e?void 0:e.getParentBlockStore(),r=o&&(null==o?void 0:o.pathIsDead());return{parentBlockStore:o,isParentCollectionDead:r}}),[t]),n=!o&&i,s=(0,u.Fg)(),l=(0,a.O7)(),{isMobile:c}=(0,a.Fy)();if(!r||!n)return null;const p=c?gC.Ht:gC.gq;return(0,b.jsxs)(p,{style:{color:s.text.secondary,background:s.accentColors.gray[30],padding:"16px 16px 16px 12px",borderRadius:4,fontSize:14},alignItems:"center",justifyContent:c?"":"space-between",children:[(0,b.jsxs)(gC.gq,{alignItems:"center",children:[(0,O.y)({width:24,height:24,flexShrink:0,marginRight:10,padding:2}),(0,b.jsx)(B.FormattedMessage,{id:"collectionViewBlock.deletedContainerBanner.collectionInTrash",defaultMessage:"The original database has been deleted and cannot be edited"})]}),(0,b.jsxs)(Qe.Z,{style:{fontWeight:D.Z.fontWeight.semibold},onClick:()=>function(e,t){(function(e){sm.j(e,"view_deleted_database_from_deleted_collection_view_banner")})(t),$.r({environment:t,store:e,pageVisitSource:h.tY.LinkInPage})}(r,l),isLightGray:!0,children:[(0,b.jsx)(B.FormattedMessage,{id:"collectionViewBlock.deletedContainerBanner.collection.viewCollectionButton",defaultMessage:"View database"}),(0,C.k)({width:16,height:16,flexShrink:0,padding:2,marginLeft:4})]})]})}},93289:(e,t,o)=>{o.d(t,{Z:()=>l});var r=o(67294),i=o(13991),n=o(77907),s=o(85893);const l=function(e){let{firstDayOfWeek:t,value:o,selectValue:l=!0,onChange:a,disabledDays:c}=e;const d=(0,r.useMemo)((()=>new Date(o)),[o]),[u,p]=(0,r.useState)(d),h=(0,r.useRef)(o);(0,r.useLayoutEffect)((()=>{h.current!==o&&(p(new Date(o)),h.current=o)}),[o]);const m=(0,r.useCallback)(((e,t,o)=>{a(e.getTime())}),[a]);return(0,s.jsx)(n.LazyDayPicker,{locale:i.SP,className:"notion-calendar-picker",numberOfMonths:1,weekStartsOn:t,modifiers:l?{value:d}:{},showOutsideDays:!0,fixedWeeks:!0,onDayClick:m,onMonthSelected:p,disabled:c,month:u})}},78948:(e,t,o)=>{o.d(t,{Z:()=>s});o(67294);var r=o(68785),i=o(28992),n=o(85893);const s=function(){return(0,n.jsx)(i.Z,{title:(0,n.jsx)(r.Z,{})})}},58493:(e,t,o)=>{o.d(t,{Z:()=>k});var r=o(67294),i=o(480),n=o(86628),s=o(24405),l=o(16184),a=o(45238),c=o(85893);const d=(0,a.IU)("mobileLocked",{viewBox:"0 0 26 26",svg:(0,c.jsx)("path",{d:"M7.88672 23.417H18.1133C19.499 23.417 20.1758 22.7295 20.1758 21.2256V13.3408C20.1758 11.9873 19.6172 11.2891 18.4678 11.1709V8.46387C18.4678 4.41406 15.8145 2.45898 13 2.45898C10.1855 2.45898 7.53223 4.41406 7.53223 8.46387V11.2246C6.47949 11.3857 5.82422 12.0732 5.82422 13.3408V21.2256C5.82422 22.7295 6.50098 23.417 7.88672 23.417ZM9.26172 8.23828C9.26172 5.54199 10.9912 4.11328 13 4.11328C15.0088 4.11328 16.7383 5.54199 16.7383 8.23828V11.1602L9.26172 11.1709V8.23828Z"})}),u=(0,a.IU)("mobileUnlocked",{viewBox:"0 0 32 26",svg:(0,c.jsx)("path",{d:"M7.89355 23.417H18.1094C19.4951 23.417 20.1826 22.7295 20.1826 21.2256V13.3408C20.1826 12.0303 19.6562 11.332 18.582 11.1816V8.23828C18.582 5.54199 20.3115 4.11328 22.3203 4.11328C24.3291 4.11328 26.0586 5.54199 26.0586 8.23828V10.623C26.0586 11.2783 26.4346 11.6006 26.9287 11.6006C27.4014 11.6006 27.7881 11.3105 27.7881 10.623V8.46387C27.7881 4.41406 25.1348 2.45898 22.3203 2.45898C19.5059 2.45898 16.8525 4.41406 16.8525 8.46387V11.1602L8.1084 11.1816C6.72266 11.1816 5.82031 11.8584 5.82031 13.3408V21.2256C5.82031 22.7295 6.50781 23.417 7.89355 23.417Z"})}),p=(0,a.IU)("unlockedFilled",{viewBox:"0 0 16 16",svg:(0,c.jsx)("path",{d:"M2.33301 14.6338H8.94336C9.85938 14.6338 10.3105 14.1826 10.3105 13.1914V8.08496C10.3105 7.2168 9.95508 6.75195 9.24414 6.65625V4.83105C9.24414 3.22461 10.2627 2.35645 11.4863 2.35645C12.71 2.35645 13.7354 3.22461 13.7354 4.83105V6.28711C13.7354 6.76562 14.0156 7.01855 14.3848 7.01855C14.7471 7.01855 15.0273 6.7793 15.0273 6.28711V4.96094C15.0273 2.36328 13.2979 1.1123 11.4863 1.1123C9.6748 1.1123 7.94531 2.36328 7.94531 4.96094V6.64258L2.44922 6.64941C1.5332 6.64941 0.96582 7.10742 0.96582 8.08496V13.1914C0.96582 14.1826 1.41699 14.6338 2.33301 14.6338Z"})});var h=o(19889),m=o(7928),S=o(9291),g=o(36610),C=o(96802),f=o(13447),y=o(92547),v=o(6258),x=o(64921),b=o(26388);const w={width:16,marginRight:4};const k=function(e){let{isMobile:t,store:o,disableTooltip:r,isInlineCollection:i,buttonStyle:s,lockStore:l}=e;const a=(0,n.qz)(l,y.Z);return t?(0,c.jsx)(j,{store:o,lockStore:a}):(0,c.jsx)(M,{store:o,disableTooltip:r,isMobile:t,isInlineCollection:i,buttonStyle:s,lockStore:a})};function _(e,t,o){return{display:"flex",alignItems:"center",whiteSpace:"nowrap",fontSize:e?12:14,borderRadius:4,padding:"0 6px",marginRight:2,height:24,marginTop:e?1:0,marginLeft:e?0:-5,...t&&{marginLeft:e?8:12,marginRight:0},...o}}function T(e,t,o,r,i){return{..._(e,r,i),color:o.lightTextColor,fill:o.lightIconColor}}function O(e,t,o,r,i){return{..._(e,r,i),paddingLeft:5,border:`1px solid ${o.blueColor}`,color:o.blueColor,fill:o.blueColor}}function V(e){let{store:t}=e;const o=(0,s.Fg)(),r=(0,n.VK)((()=>t.getFormat().block_locked_by),[t]),i=(0,S.useIntl)(),l=(0,n.VK)((()=>r&&(0,m.Nz)(i,v.t1.createChildStore(t,{table:h.KJ,id:r}).getModel())),[r,i,t]);return r?(0,c.jsx)("div",{children:(0,c.jsx)(S.FormattedMessage,{defaultMessage:"Locked by {lockedByPerson}{br}to prevent accidental editing.{br}<prompttext>Click to unlock</prompttext>",id:"pageLockIndicator.lockedTooltip",values:{lockedByPerson:(0,c.jsx)("b",{children:l}),br:(0,c.jsx)("br",{}),prompttext:e=>(0,c.jsx)("span",{style:{color:o.mediumInvertedTextColor},children:e})}})}):null}function P(e,t,o){f.createAndCommit({userAction:"PageLockTopbarIndicator.handleLockClick",environment:e,perform:o=>{C.Wq({environment:e,store:t,isLocked:!1,transaction:o})}}),o.setState({...o.state,justUnlocked:!0});const r=t.getType();if(r){var i;let o;t.isCollectionView()&&(o=t.getCollectionViewCollectionStore()),g.UJ(e,{from:"topbar",block_type:r,locked:!1,collection_id:null===(i=o)||void 0===i?void 0:i.id})}}function R(e,t,o){f.createAndCommit({userAction:"PageLockTopbarIndicator.handleUnlockClick",environment:e,perform:o=>{C.Wq({environment:e,store:t,isLocked:!0,transaction:o})}}),o.setState({...o.state,justUnlocked:!1});const r=t.getType();if(r){var i;let o;t.isCollectionView()&&(o=t.getCollectionViewCollectionStore()),g.UJ(e,{from:"topbar",block_type:r,locked:!0,collection_id:null===(i=o)||void 0===i?void 0:i.id})}}function M(e){let{store:t,disableTooltip:o,isMobile:a,isInlineCollection:d,buttonStyle:u,lockStore:h}=e;const m=(0,s.Fg)(),g=(0,i.O7)(),C=(0,r.useCallback)((()=>R(g,t,h)),[g,t,h]),f=(0,r.useCallback)((()=>P(g,t,h)),[g,t,h]),y=(0,n.VK)((()=>t.isLocked()),[t]),v=(0,n.VK)((()=>h.state.justUnlocked),[h]);return y?(0,c.jsx)(b.ZP,{renderTooltip:()=>(0,c.jsx)(V,{store:t}),disableTooltip:o,render:e=>(0,c.jsxs)(x.Z,{style:T(a,0,m,d,u),onClick:f,...e,children:[(0,l.Q)(w),(0,c.jsx)("div",{style:{lineHeight:1},children:(0,c.jsx)(S.FormattedMessage,{defaultMessage:"Locked",id:"pageLockIndicator.lockedButton.label"})})]})}):v?(0,c.jsxs)(x.Z,{style:O(a,0,m,d,u),onClick:C,hoveredStyle:{background:m.outlineBlueButtonHoveredBackground},pressedStyle:{background:m.outlineBlueButtonPressedBackground},children:[p(w),(0,c.jsx)("div",{style:{lineHeight:1},children:(0,c.jsx)(S.FormattedMessage,{defaultMessage:"Re-lock",id:"pageLockIndicator.relockButton.label"})})]}):null}function j(e){let{store:t,lockStore:o}=e;const l=(0,s.Fg)(),a=(0,i.O7)(),p=(0,r.useCallback)((()=>R(a,t,o)),[a,t,o]),h=(0,r.useCallback)((()=>P(a,t,o)),[a,t,o]),m=(0,n.VK)((()=>t.isLocked()),[t]),{WindowSizeStore:g}=a,C=(0,n.VK)((()=>g.getSafePaddingLeftCSS(10)),[g]),f=(0,n.VK)((()=>g.getSafePaddingRightCSS(14)),[g]),y=(0,n.VK)((()=>o.state.justUnlocked),[o]);return m?(0,c.jsxs)(x.Z,{onClick:h,mobileFeedback:!0,style:{display:"flex",alignItems:"center",height:"100%",paddingLeft:C,paddingRight:f},children:[d({width:20,marginRight:6}),(0,c.jsx)("div",{children:(0,c.jsx)(S.FormattedMessage,{defaultMessage:"Locked",id:"pageLockIndicator.mobileLockedButton.label"})})]}):y?(0,c.jsxs)(x.Z,{onClick:p,mobileFeedback:!0,style:{display:"flex",alignItems:"center",width:"100%",height:"100%",paddingLeft:C,paddingRight:f,color:l.blueColor,fill:l.blueColor},children:[u({height:26,width:32,marginRight:6}),(0,c.jsx)("div",{children:(0,c.jsx)(S.FormattedMessage,{defaultMessage:"Re-lock",id:"pageLockIndicator.mobileRelockButton.label"})})]}):null}},71424:(e,t,o)=>{o.d(t,{EZ:()=>i,FD:()=>n,G5:()=>r,rK:()=>s});const r=220,i=24,n=-7,s=-3},34232:(e,t,o)=>{o.d(t,{Z:()=>i});var r=o(67294);function i(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const[n,s]=(0,r.useState)(i),l=(0,r.useRef)(null),a=(0,r.useRef)(null);return(0,r.useLayoutEffect)((()=>{null!==a.current&&window.clearTimeout(a.current),null!==l.current&&window.clearTimeout(l.current),a.current=null,l.current=null,e?0===t?s(!0):l.current=window.setTimeout((()=>{l.current=null,s(!0)}),t):0===o?s(!1):a.current=window.setTimeout((()=>{a.current=null,s(!1)}),o)}),[e,t,o]),n}},35599:(e,t,o)=>{o.d(t,{Z:()=>a});var r=o(67294),i=o(24405),n=o(86432),s=o(19584),l=o(77907);function a(e){const t=(0,l.useDependency)(l.deps.calendarDateIcons),o=function(){const[e,t]=(0,r.useState)(new Date),o=(0,r.useRef)();return(0,r.useEffect)((()=>{const r=()=>{const o=new Date;o.getDate()!==e.getDate()&&t(o)},i=new Date,n=new Date(i);n.setHours(i.getHours()+1),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0);const l=n.getTime()-i.getTime(),a=setTimeout((()=>{r(),o.current=window.setInterval(r,s.U6)}),l);return()=>{clearTimeout(a),clearInterval(o.current)}}),[e]),e}(),a=e.dateNumber??o.getDate(),c=(0,i.yK)((t=>({icon:{width:16,height:16,color:t.mediumIconColor,...e.style}})),[e.style]),d=(0,r.useCallback)((e=>{if(e<1||e>31)return(0,n.s)(c.icon);if("resolved"!==t.status)return(0,n.s)(c.icon);const o=`calendarDate${e<10?`0${e}`:`${e}`}Icon`;return(0,t.value[o])(c.icon)}),[c,t]);return d(a)}},92547:(e,t,o)=>{o.d(t,{Z:()=>n});var r=o(49085);class i extends r.default{getInitialState(){return{justUnlocked:!1}}}const n=i},32566:(e,t,o)=>{o.d(t,{k:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.IU)("arrowRightSmaller",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M15.383 8.352a.877.877 0 01-.274.64l-5.156 5.14a.864.864 0 01-.617.266.831.831 0 01-.602-.234.795.795 0 01-.234-.586c0-.12.02-.232.063-.336a.912.912 0 01.187-.273l1.75-1.766 2.914-2.656.274.5-2.711.156H1.484c-.26 0-.471-.078-.632-.234a.851.851 0 01-.235-.617c0-.256.078-.461.235-.618a.856.856 0 01.632-.242h9.493l2.71.164-.273.508L10.5 5.5 8.75 3.727a.946.946 0 01-.188-.266.917.917 0 01-.062-.344c0-.234.078-.43.234-.586a.831.831 0 01.602-.234.79.79 0 01.328.07c.104.047.203.117.297.211l5.148 5.133a.877.877 0 01.274.64z"})})},8597:(e,t,o)=>{o.d(t,{Z:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.IU)("arrowUp",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M8 14.5586C8.44434 14.5586 8.74512 14.251 8.74512 13.7998V5.30957L8.69043 3.83984L10.4951 5.84961L12.0469 7.38086C12.1836 7.51074 12.3682 7.59961 12.5801 7.59961C12.9902 7.59961 13.291 7.28516 13.291 6.86816C13.291 6.66992 13.2158 6.49219 13.0586 6.32812L8.55371 1.81641C8.40332 1.66602 8.20508 1.57715 8 1.57715C7.79492 1.57715 7.59668 1.66602 7.44629 1.81641L2.94141 6.32812C2.78418 6.49219 2.70898 6.66992 2.70898 6.86816C2.70898 7.28516 3.0166 7.59961 3.42676 7.59961C3.63184 7.59961 3.82324 7.51074 3.95312 7.38086L5.50488 5.84961L7.30957 3.83301L7.25488 5.30957V13.7998C7.25488 14.251 7.5625 14.5586 8 14.5586Z"})})},18278:(e,t,o)=>{o.d(t,{O:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.IU)("blueArrowCircle",{viewBox:"0 0 42 42",svg:(0,i.jsx)("path",{d:"M3.90625 18.75L7.64062 13.5C7.93229 13.1042 8.26562 12.9115 8.64062 12.9219C9.02604 12.9219 9.35938 13.1146 9.64062 13.5L13.3594 18.7656C13.7135 19.2344 13.8125 19.6562 13.6562 20.0312C13.5 20.4062 13.125 20.5938 12.5312 20.5938H10.1875C10.3958 22.1562 10.8698 23.6094 11.6094 24.9531C12.3594 26.2969 13.3021 27.474 14.4375 28.4844C15.5833 29.4948 16.8854 30.276 18.3438 30.8281C19.8021 31.3906 21.3542 31.6719 23 31.6719C24.875 31.6719 26.625 31.3021 28.25 30.5625C29.8854 29.8229 31.2812 28.8177 32.4375 27.5469C32.8125 27.1823 33.2083 26.9948 33.625 26.9844C34.0521 26.9635 34.4219 27.099 34.7344 27.3906C35.0469 27.6719 35.2031 28.0365 35.2031 28.4844C35.2135 28.9219 35.0312 29.3281 34.6562 29.7031C33.2188 31.276 31.4896 32.526 29.4688 33.4531C27.4583 34.3906 25.3021 34.8594 23 34.8594C20.9271 34.8594 18.974 34.4948 17.1406 33.7656C15.3073 33.0365 13.6667 32.0156 12.2188 30.7031C10.7708 29.401 9.58854 27.8854 8.67188 26.1562C7.75521 24.4271 7.18229 22.5729 6.95312 20.5938H4.73438C4.13021 20.5938 3.75521 20.4062 3.60938 20.0312C3.46354 19.6562 3.5625 19.2292 3.90625 18.75ZM11.3438 7.73438C12.7812 6.17188 14.5052 4.92188 16.5156 3.98438C18.5365 3.04688 20.6979 2.57812 23 2.57812C25.0521 2.57812 26.9948 2.94792 28.8281 3.6875C30.6719 4.41667 32.3177 5.4375 33.7656 6.75C35.2135 8.05208 36.3958 9.56771 37.3125 11.2969C38.2292 13.026 38.8073 14.8802 39.0469 16.8594H41.2188C41.8229 16.8594 42.1979 17.0469 42.3438 17.4219C42.5 17.7969 42.4062 18.224 42.0625 18.7031L38.3438 23.9531C38.0521 24.349 37.7135 24.5469 37.3281 24.5469C36.9531 24.5365 36.625 24.3385 36.3438 23.9531L32.6094 18.7031C32.2656 18.224 32.1667 17.7969 32.3125 17.4219C32.4688 17.0469 32.8438 16.8594 33.4375 16.8594H35.8125C35.5833 15.2969 35.099 13.849 34.3594 12.5156C33.6302 11.1719 32.6927 9.99479 31.5469 8.98438C30.4115 7.97396 29.1146 7.1875 27.6562 6.625C26.1979 6.05208 24.6458 5.76562 23 5.76562C21.1354 5.76562 19.3854 6.14062 17.75 6.89062C16.125 7.63021 14.7292 8.63021 13.5625 9.89062C13.1875 10.2552 12.7865 10.4427 12.3594 10.4531C11.9427 10.4635 11.5781 10.3229 11.2656 10.0312C10.9427 9.75 10.776 9.39062 10.7656 8.95312C10.7656 8.51562 10.9583 8.10938 11.3438 7.73438Z",fill:"#2383E2"})})},65422:(e,t,o)=>{o.d(t,{K:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.IU)("boltFilled",{svg:(0,i.jsx)("path",{d:"M0 12.117c0 .38.293.664.703.664h5.518l-2.91 7.91c-.381 1.006.664 1.543 1.318.723l8.877-11.094c.166-.205.254-.4.254-.625 0-.371-.293-.664-.703-.664H7.539l2.91-7.91C10.83.115 9.785-.422 9.131.408L.254 11.492c-.166.215-.254.41-.254.625z"}),viewBox:"0 0 14 22"})},86432:(e,t,o)=>{o.d(t,{s:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.IU)("calendarDate31",{viewBox:"0 0 20 20",svg:(0,i.jsxs)("g",{children:[(0,i.jsx)("path",{d:"M7.565 10.164c0-.753-.429-1.246-1.104-1.246-.649 0-.87.467-.87 1.207v.13c-.077.013-.142.026-.22.026-.468 0-.805-.39-.805-1.052 0-1.012.935-1.908 2.713-1.908 1.584 0 2.596.805 2.596 2.116 0 .987-.843 1.636-1.674 1.804 1.558.17 2.207 1.052 2.207 2.13 0 1.843-1.39 2.803-3.531 2.803h-.052c-1.61 0-2.74-.662-2.74-1.687 0-.584.442-1.052 1.104-1.052.052 0 .104.013.156.013.13 1.052.857 1.48 1.584 1.48.7 0 1.194-.428 1.194-1.077v-.026c0-1.013-.87-1.117-2.181-1.246l-.208-1.22c1.22-.144 1.83-.494 1.83-1.195zm4.95 4.66v-6.05c-1.298.286-1.583-.285-1.44-.856.779-.13 2.804-.597 3.57-.818v7.776l1.415.286c0 .506-.299.805-.831.805-.442 0-1.467-.026-1.96-.026-.766 0-2.168.026-2.168.026a.851.851 0 01-.052-.299c0-.246.104-.493.441-.584l1.026-.26z"}),(0,i.jsx)("path",{d:"M16.664 0H3.334A3.333 3.333 0 000 3.334v13.332A3.333 3.333 0 003.334 20h13.332A3.333 3.333 0 0020 16.666V3.334A3.333 3.333 0 0016.666 0h-.002zm-.525 17.932H3.861a1.797 1.797 0 01-1.797-1.797V5.485h15.872v10.652c0 .993-.804 1.797-1.797 1.797v-.002z"})]})})},2585:(e,t,o)=>{o.d(t,{f:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.IU)("chevronLeft",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M3.61816 8.06445C3.61816 8.29688 3.70703 8.49512 3.8916 8.67285L9.22363 13.8887C9.36719 14.0391 9.55859 14.1143 9.77734 14.1143C10.2217 14.1143 10.5703 13.7725 10.5703 13.3213C10.5703 13.1025 10.4814 12.9043 10.3311 12.7539L5.52539 8.06445L10.3311 3.375C10.4814 3.21777 10.5703 3.01953 10.5703 2.80078C10.5703 2.35645 10.2217 2.01465 9.77734 2.01465C9.55859 2.01465 9.36719 2.08984 9.22363 2.24023L3.8916 7.45605C3.70703 7.63379 3.625 7.83203 3.61816 8.06445Z"})})},45453:(e,t,o)=>{o.d(t,{p:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.IU)("collectionHide",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M12.6172 12.9492C12.8047 13.1309 13.0918 13.1426 13.2793 12.9492C13.4727 12.75 13.4609 12.4688 13.2793 12.2871L3.35352 2.37305C3.17773 2.19141 2.87305 2.18555 2.69141 2.37305C2.51562 2.54883 2.51562 2.85352 2.69141 3.0293L12.6172 12.9492ZM8 2.70703C6.98047 2.70703 6.05469 2.88281 5.19336 3.16406L6.13086 4.10156C6.72266 3.93164 7.33789 3.83203 8 3.83203C11.7441 3.83203 14.7207 7.08984 14.7207 7.77539C14.7207 8.23828 13.7715 9.43359 12.2656 10.377L13.1328 11.25C14.9727 10.043 16.0449 8.4668 16.0449 7.77539C16.0449 6.57422 12.8047 2.70703 8 2.70703ZM8 12.8496C9.08398 12.8496 10.0742 12.6621 10.9707 12.3516L10.0391 11.4199C9.40039 11.6074 8.72656 11.7246 8 11.7246C4.25586 11.7246 1.2793 8.5957 1.2793 7.77539C1.2793 7.38281 2.27539 6.11133 3.88086 5.12695L2.99609 4.24219C1.08008 5.46094 -0.0507812 7.07227 -0.0507812 7.77539C-0.0507812 8.97656 3.25977 12.8496 8 12.8496ZM10.9238 8.90625C11.0762 8.56055 11.1641 8.17383 11.1641 7.77539C11.1641 6.01172 9.75781 4.62305 8 4.62305C7.5957 4.62305 7.21484 4.69922 6.86328 4.8457L10.9238 8.90625ZM8 10.9336C8.45703 10.9336 8.88477 10.8281 9.26562 10.6465L5.12305 6.49805C4.93555 6.88477 4.83008 7.3125 4.83008 7.78125C4.83594 9.49805 6.23633 10.9336 8 10.9336Z"})})},9056:(e,t,o)=>{o.d(t,{g:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.IU)("collectionShow",{viewBox:"0 0 30 30",svg:(0,i.jsx)("path",{d:"M15,4 C8.641,4 0,10.469 0,15 C0,19.531 8.641,26 15,26 C21.359,26 30,19.531 30,15 C30,10.469 21.359,4 15,4 Z M15,24 C9.149,24 2,17.975 2,15 C2,12.025 9.149,6 15,6 C20.851,6 28,12.025 28,15 C28,17.975 20.851,24 15,24 Z M15,8 C11.134,8 8,11.134 8,15 C8,18.866 11.134,22 15,22 C18.866,22 22,18.866 22,15 C22,11.134 18.866,8 15,8 Z M15,20 C12.238,20 10,17.761 10,15 C10,12.239 12.238,10 15,10 C17.762,10 20,12.239 20,15 C20,17.761 17.762,20 15,20 Z"})})},31505:(e,t,o)=>{o.d(t,{Y:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.IU)("collectionTimelineArrowLeft",{viewBox:"0 0 9 7",svg:(0,i.jsx)("path",{d:"M0 3.5021C0 3.70786 0.0939831 3.93041 0.237195 4.06479L3.11934 6.76065C3.28493 6.91602 3.48633 7 3.67877 7C4.17106 7 4.48881 6.68506 4.48881 6.27774C4.48881 6.03839 4.37245 5.86203 4.22029 5.72345L3.19095 4.77025L2.56887 4.22855L3.47737 4.27055L8.13625 4.27055C8.6554 4.27055 9 3.96401 9 3.5021C9 3.04019 8.6554 2.73365 8.13625 2.73365L3.47737 2.73365L2.56887 2.77564L3.19095 2.23395L4.22029 1.27654C4.37245 1.13377 4.48881 0.961608 4.48881 0.722255C4.48881 0.314937 4.17106 0 3.67877 0C3.48633 0 3.28493 0.0839832 3.11487 0.239352L0.237195 2.93941C0.0939831 3.07378 0 3.29634 0 3.5021Z"})})},39301:(e,t,o)=>{o.d(t,{n:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.IU)("collectionTimelineArrowRight",{viewBox:"0 0 9 7",svg:(0,i.jsx)("path",{d:"M9 3.4979C9 3.29214 8.90602 3.06959 8.7628 2.93521L5.88066 0.239352C5.71507 0.0839835 5.51368 3.13148e-07 5.32123 2.96324e-07C4.82894 2.53287e-07 4.51119 0.314937 4.51119 0.722256C4.51119 0.961608 4.62755 1.13797 4.77971 1.27654L5.80905 2.22975L6.43113 2.77145L5.52263 2.72945L0.863749 2.72945C0.344604 2.72945 -6.62078e-07 3.03599 -7.02459e-07 3.4979C-7.4284e-07 3.95981 0.344604 4.26635 0.863749 4.26635L5.52263 4.26635L6.43113 4.22436L5.80905 4.76605L4.77971 5.72346C4.62755 5.86623 4.51119 6.03839 4.51119 6.27774C4.51119 6.68506 4.82894 7 5.32123 7C5.51367 7 5.71507 6.91602 5.88513 6.76065L8.7628 4.06059C8.90602 3.92622 9 3.70366 9 3.4979Z"})})},97439:(e,t,o)=>{o.d(t,{D:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.IU)("doubleChevronLeft",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M7.07031 13.8887C7.2207 14.0391 7.40527 14.1211 7.62402 14.1211C8.06836 14.1211 8.41699 13.7725 8.41699 13.3281C8.41699 13.1094 8.32812 12.9043 8.17773 12.7539L3.37207 8.05762L8.17773 3.375C8.32812 3.21777 8.41699 3.0127 8.41699 2.80078C8.41699 2.35645 8.06836 2.00781 7.62402 2.00781C7.40527 2.00781 7.2207 2.08984 7.07031 2.24023L1.73828 7.44922C1.56055 7.62012 1.46484 7.8252 1.46484 8.06445C1.46484 8.29688 1.55371 8.49512 1.73828 8.67969L7.07031 13.8887ZM13.1748 13.8887C13.3252 14.0391 13.5098 14.1211 13.7354 14.1211C14.1797 14.1211 14.5283 13.7725 14.5283 13.3281C14.5283 13.1094 14.4395 12.9043 14.2891 12.7539L9.4834 8.05762L14.2891 3.375C14.4395 3.21777 14.5283 3.0127 14.5283 2.80078C14.5283 2.35645 14.1797 2.00781 13.7354 2.00781C13.5098 2.00781 13.3252 2.08984 13.1748 2.24023L7.84961 7.44922C7.66504 7.62012 7.57617 7.8252 7.56934 8.06445C7.56934 8.29688 7.66504 8.49512 7.84961 8.67969L13.1748 13.8887Z"})})},7525:(e,t,o)=>{o.d(t,{t:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.IU)("doubleChevronRight",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M2.25781 14.1211C2.47656 14.1211 2.66797 14.0391 2.81836 13.8887L8.14355 8.67969C8.32812 8.49512 8.41699 8.29688 8.41699 8.06445C8.41699 7.8252 8.32812 7.62012 8.14355 7.44922L2.81836 2.24023C2.66797 2.08984 2.4834 2.00781 2.25781 2.00781C1.81348 2.00781 1.46484 2.35645 1.46484 2.80078C1.46484 3.0127 1.55371 3.21777 1.7041 3.375L6.50977 8.05762L1.7041 12.7539C1.55371 12.9043 1.46484 13.1094 1.46484 13.3281C1.46484 13.7725 1.81348 14.1211 2.25781 14.1211ZM8.36914 14.1211C8.58789 14.1211 8.77246 14.0391 8.92285 13.8887L14.2549 8.67969C14.4395 8.49512 14.5283 8.29688 14.5283 8.06445C14.5283 7.8252 14.4326 7.62012 14.2549 7.44922L8.92285 2.24023C8.77246 2.08984 8.58789 2.00781 8.36914 2.00781C7.9248 2.00781 7.56934 2.35645 7.56934 2.80078C7.56934 3.0127 7.66504 3.21777 7.81543 3.375L12.6211 8.05762L7.81543 12.7539C7.66504 12.9043 7.56934 13.1094 7.56934 13.3281C7.56934 13.7725 7.9248 14.1211 8.36914 14.1211Z"})})},39132:(e,t,o)=>{o.d(t,{c:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.IU)("eye",{viewBox:"0 0 32 32",svg:(0,i.jsx)("path",{d:"M16.006 25.812c8.863 0 14.994-7.17 14.994-9.406C31 14.16 24.858 7 16.006 7 7.252 7 1 14.16 1 16.406c0 2.236 6.252 9.406 15.006 9.406zm0-3.242a6.194 6.194 0 01-6.197-6.164c-.012-3.452 2.744-6.164 6.197-6.164 3.419 0 6.185 2.711 6.185 6.164 0 3.364-2.766 6.164-6.185 6.164zm0-3.94c1.228 0 2.246-1.007 2.246-2.224 0-1.228-1.018-2.235-2.246-2.235-1.24 0-2.258 1.007-2.258 2.235 0 1.217 1.018 2.224 2.258 2.224z"})})},18557:(e,t,o)=>{o.d(t,{z:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.IU)("flag",{viewBox:"0 0 13 14",svg:(0,i.jsx)("path",{d:"M0.825195 13.8457C1.16699 13.8457 1.4541 13.5654 1.4541 13.2168V9.47754C1.63867 9.40918 2.21973 9.19727 3.10156 9.19727C5.59668 9.19727 7.25781 10.4414 9.66406 10.4414C10.7168 10.4414 11.1885 10.3115 11.7217 10.0654C12.207 9.84668 12.4941 9.4502 12.4941 8.82129V1.99219C12.4941 1.55469 12.1523 1.27441 11.6943 1.27441C11.3047 1.27441 10.6895 1.54102 9.58887 1.54102C7.20996 1.54102 5.52148 0.296875 3.0332 0.296875C1.99414 0.296875 1.5293 0.419922 0.975586 0.672852C0.49707 0.891602 0.196289 1.24707 0.196289 1.86914V13.2168C0.196289 13.5586 0.483398 13.8457 0.825195 13.8457ZM9.63672 9.16309C7.41504 9.16309 5.71289 7.92578 3.12207 7.92578C2.45215 7.92578 1.84375 8.00098 1.48145 8.14453V2.0332C1.59766 1.83496 2.11035 1.56836 3.05371 1.56836C5.38477 1.56836 7.09375 2.80566 9.56836 2.80566C10.2383 2.80566 10.792 2.73047 11.2158 2.61426V8.69824C11.0996 8.89648 10.5801 9.16309 9.63672 9.16309Z"})})},4635:(e,t,o)=>{o.d(t,{W:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.IU)("options",{viewBox:"0 0 17 15",svg:(0,i.jsx)("path",{d:"M11.2871 4.48438C12.1309 4.48438 12.8574 3.95312 13.1621 3.21875H15.7324C16.123 3.21875 16.4512 2.875 16.4512 2.46094C16.4512 2.04688 16.123 1.71094 15.7324 1.71094H13.1621C12.8652 0.96875 12.1387 0.4375 11.2871 0.4375C10.4355 0.4375 9.70898 0.96875 9.41211 1.71094H1.04492C0.630859 1.71094 0.302734 2.04688 0.302734 2.46094C0.302734 2.875 0.630859 3.21875 1.04492 3.21875H9.41211C9.7168 3.95312 10.4434 4.48438 11.2871 4.48438ZM11.2871 3.42188C10.748 3.42188 10.3262 2.99219 10.3262 2.46094C10.3262 1.91406 10.748 1.49219 11.2871 1.49219C11.834 1.49219 12.248 1.91406 12.248 2.46094C12.248 2.99219 11.834 3.42188 11.2871 3.42188ZM1.02148 6.58594C0.630859 6.58594 0.302734 6.92188 0.302734 7.33594C0.302734 7.74219 0.630859 8.08594 1.02148 8.08594H3.67773C3.98242 8.83594 4.70898 9.35938 5.56055 9.35938C6.4043 9.35938 7.13086 8.83594 7.43555 8.08594H15.709C16.123 8.08594 16.4512 7.75 16.4512 7.33594C16.4512 6.92188 16.123 6.58594 15.709 6.58594H7.43555C7.13086 5.84375 6.4043 5.32031 5.56055 5.32031C4.70898 5.32031 3.98242 5.84375 3.67773 6.58594H1.02148ZM5.56055 8.30469C5.02148 8.30469 4.5918 7.875 4.5918 7.33594C4.5918 6.78906 5.02148 6.375 5.56055 6.375C6.09961 6.375 6.52148 6.78906 6.52148 7.33594C6.52148 7.875 6.09961 8.30469 5.56055 8.30469ZM11.2871 14.2344C12.1387 14.2344 12.8652 13.7031 13.1621 12.9609H15.7324C16.123 12.9609 16.4512 12.625 16.4512 12.2109C16.4512 11.7891 16.123 11.4609 15.7324 11.4609H13.1621C12.8652 10.7188 12.1387 10.1875 11.2871 10.1875C10.4434 10.1875 9.70898 10.7188 9.41211 11.4609H1.04492C0.630859 11.4609 0.302734 11.7969 0.302734 12.2109C0.302734 12.6172 0.630859 12.9609 1.04492 12.9609H9.41211C9.70898 13.7031 10.4355 14.2344 11.2871 14.2344ZM11.2871 13.1719C10.748 13.1719 10.3262 12.7422 10.3262 12.2109C10.3262 11.6641 10.748 11.25 11.2871 11.25C11.834 11.25 12.248 11.6641 12.248 12.2109C12.248 12.7422 11.834 13.1719 11.2871 13.1719Z"})})},23903:(e,t,o)=>{o.d(t,{P:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.IU)("pin",{viewBox:"0 0 13 19",svg:(0,i.jsx)("path",{d:"M1.25 12.875h4.227v3.648c0 1.196.5 2.188.695 2.188.187 0 .687-.992.687-2.188v-3.648h4.227c.703 0 1.148-.438 1.148-1.102 0-1.648-1.32-3.304-3.359-4.109L8.617 4c.992-.648 1.93-1.383 2.328-1.914.211-.266.305-.531.305-.758 0-.476-.367-.828-.914-.828H2.008c-.555 0-.914.352-.914.828 0 .227.093.492.297.758.398.531 1.343 1.266 2.328 1.914L3.46 7.664C1.42 8.47.1 10.125.1 11.774c0 .664.446 1.101 1.149 1.101zm4.922-5.719c-.5 0-.984.047-1.438.14l.235-3.874c.008-.11-.008-.149-.086-.188-1.172-.601-2.078-1.312-2.14-1.468-.063-.102 0-.164.085-.164h6.68c.086 0 .148.062.086.164-.063.156-.969.867-2.14 1.468-.071.04-.095.079-.079.188l.234 3.875a7.177 7.177 0 00-1.437-.14zm-4.61 4.54c-.18 0-.257-.102-.226-.313.172-1.406 1.969-3.086 4.836-3.086 2.86 0 4.656 1.68 4.828 3.086.031.21-.047.312-.227.312h-9.21z"})})},79310:(e,t,o)=>{o.d(t,{A:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.IU)("pinStrikethrough",{viewBox:"0 0 15 19",svg:(0,i.jsx)("path",{d:"M3.094 1.328c0 .227.094.492.297.758.398.531 1.343 1.266 2.328 1.914l-.055.86 1.149 1.156.156-2.594c.008-.11-.008-.149-.086-.188-1.172-.601-2.078-1.312-2.14-1.468-.063-.102.007-.164.085-.164h6.68c.086 0 .148.062.086.164-.063.156-.961.867-2.14 1.468-.071.04-.087.079-.079.188l.234 3.875a7.12 7.12 0 00-1.437-.14h-.203l1.203 1.226c2.164.219 3.758 1.984 3.758 3.234 0 .04-.008.078-.008.117l.844.97c.257-.157.468-.477.468-.93 0-1.649-1.32-3.313-3.359-4.11L10.617 4c.992-.648 1.93-1.383 2.336-1.914.203-.266.297-.531.297-.758 0-.476-.367-.828-.914-.828H4.008c-.555 0-.914.352-.914.828zM.367 2.656l14.125 14.11a.603.603 0 00.852 0 .597.597 0 000-.852L1.227 1.804a.606.606 0 00-.86 0 .618.618 0 000 .852zm1.735 9.117c0 .665.445 1.102 1.148 1.102h4.234v3.648c0 1.196.493 2.188.688 2.188.195 0 .687-.992.687-2.188V12.97h.446L8.03 11.695H3.562c-.171 0-.257-.101-.226-.312.094-.875.828-1.805 1.984-2.399l-.82-.82c-1.477.867-2.398 2.234-2.398 3.61z"})})},75071:(e,t,o)=>{o.d(t,{f:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.IU)("plusThick",{viewBox:"0 0 14 14",svg:(0,i.jsx)("path",{d:"M2 7.16357C2 7.59692 2.36011 7.95093 2.78735 7.95093H6.37622V11.5398C6.37622 11.9731 6.73022 12.3271 7.16357 12.3271C7.59692 12.3271 7.95093 11.9731 7.95093 11.5398V7.95093H11.5398C11.9731 7.95093 12.3271 7.59692 12.3271 7.16357C12.3271 6.73022 11.9731 6.37622 11.5398 6.37622H7.95093V2.78735C7.95093 2.36011 7.59692 2 7.16357 2C6.73022 2 6.37622 2.36011 6.37622 2.78735V6.37622H2.78735C2.36011 6.37622 2 6.73022 2 7.16357Z"})})}}]);