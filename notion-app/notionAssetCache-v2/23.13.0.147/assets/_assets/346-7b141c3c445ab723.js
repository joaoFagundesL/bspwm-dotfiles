"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[346],{18145:(e,t,o)=>{o.d(t,{Z:()=>_,t:()=>R});var r=o(67294),a=o(480),n=o(86628),i=o(24405),s=o(2032),l=o(99036),p=o(42853),d=o(9291),c=o(53965),u=o(36610),m=o(94166),h=o(66890),g=o(16187),y=o(75079),f=o(60709),M=o(98742),v=o(61766),x=o(6258),S=o(52275),C=o(31945),b=o(78140),j=o(32163),P=o(40721),k=o(53437),Z=o(72495),F=o(26388),T=o(97820),w=o(3072),Y=o(69872),O=o(77498),V=o(85893);let R=function(e){return e[e.BlockPropertyOverlay=0]="BlockPropertyOverlay",e[e.ViewSettings=1]="ViewSettings",e}({});const _=function(e){let{context:t,schema:o,property:r,parentStore:s,onDismiss:l,disabled:p,analyticsFrom:u,onChange:h}=e;const g=(0,i.Fg)(),y=(0,a.O7)(),x=(0,n.qz)(void 0,v.Z),S=(0,n.qz)(void 0,v.Z),Z=(0,n.qz)(void 0,v.Z),w=(0,a.Fy)(),Y=(0,n.VK)((()=>L(o,r,s)),[o,r,s]),O=Boolean(null==Y?void 0:Y.propertySchema.relation_property),_=Boolean((null==Y?void 0:Y.propertySchema.relation_property)&&(null==Y?void 0:Y.propertySchema.target_property)),D=(0,n.VK)((()=>c.oA([q(y,g,p,o,r,s,u,Z,h),$(O,y,g,p,o,r,s,u,S,h),Q(_,y,g,p,o,r,s,u,x,h)])),[O,_,y,g,p,o,r,s,u,h,x,Z,S]),E=(0,n.VK)((()=>x.state.open),[x]),K=(0,n.VK)((()=>Z.state.open),[Z]),N=(0,n.VK)((()=>S.state.open),[S]);if(!Y)return null;if(t===R.BlockPropertyOverlay){let e;return e=w.isMobile?{menuType:f.og.Modal,title:Y.propertySchema.name,right:(0,V.jsx)(P.DoneMenuText,{}),onClickRight:l}:{menuType:f.og.Popup},(0,V.jsx)(b.Z,{...e,children:(0,V.jsx)(j.Z,{type:j.i.Vertical,initialFocus:void 0,sections:D})})}return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(C.ZP,{popupType:w.isMobile?k.kQ.SlideUp:k.kQ.Popup,alignmentToOrigin:C.vR.End,renderOrigin:e=>(0,V.jsx)(m.Z,{title:(0,V.jsx)(d.FormattedMessage,{defaultMessage:"Relation",id:"database.viewSettings.rollupOptions.relationProperty"}),disabled:p,showChevron:!0,rotateChevron:K,right:Y.relationPropertySchema?(0,V.jsx)(T.Z,{propertySchema:Y.relationPropertySchema,showIcon:!0}):(0,V.jsx)(d.FormattedMessage,{id:"database.viewSettings.rollupOptions.selectRelation",defaultMessage:"Select"}),...e}),render:e=>(0,V.jsx)(B,{parent:e,analyticsFrom:u,schema:o,property:r,parentStore:s,onChange:h}),buttonPopupStore:Z}),(0,V.jsx)(F.ZP,{renderTooltip:()=>(0,V.jsx)(I,{}),disableTooltip:O,render:e=>(0,V.jsx)(C.ZP,{popupType:w.isMobile?k.kQ.SlideUp:k.kQ.Popup,alignmentToOrigin:C.vR.End,renderOrigin:t=>(0,V.jsx)(m.Z,{title:(0,V.jsx)("span",{style:{...!_&&{color:g.mediumTextColor}},children:(0,V.jsx)(d.FormattedMessage,{defaultMessage:"Property",id:"database.viewSettings.rollupOptions.targetProperty"})}),disabled:!O||p,showChevron:!0,rotateChevron:N,right:O&&(Y.targetPropertySchema?(0,V.jsx)(T.Z,{propertySchema:Y.targetPropertySchema,showIcon:!0}):(0,V.jsx)(d.FormattedMessage,{id:"database.viewSettings.rollupOptions.selectTargetProperty",defaultMessage:"Select"})),...(0,M.Z)(e,t)}),render:e=>(0,V.jsx)(U,{parent:e,analyticsFrom:u,schema:o,property:r,parentStore:s,onChange:h}),buttonPopupStore:S})}),(0,V.jsx)(F.ZP,{renderTooltip:()=>(0,V.jsx)(A,{}),disableTooltip:_,render:e=>(0,V.jsx)(C.ZP,{popupType:w.isMobile?k.kQ.SlideUp:k.kQ.Popup,alignmentToOrigin:C.vR.End,renderOrigin:t=>(0,V.jsx)(m.Z,{disabled:!_||p,title:(0,V.jsx)("span",{style:{...!_&&{color:g.mediumTextColor}},children:(0,V.jsx)(d.FormattedMessage,{defaultMessage:"Calculate",id:"database.viewSettings.rollupOptions.calculate"})}),showChevron:!0,rotateChevron:E,right:_&&(0,V.jsx)(H,{schema:o,property:r,parentStore:s}),...(0,M.Z)(e,t)}),render:e=>(0,V.jsx)(z,{parent:e,analyticsFrom:u,schema:o,property:r,parentStore:s,onChange:h}),buttonPopupStore:x})})]})};function L(e,t,o){var r;const a=e[t];if(!a)return;let n,i;if(a.relation_property){const t=e[a.relation_property];t&&"relation"===t.type&&(n=t)}if(n){const e=l.j0(n);i=e?x.NW.createChildStore(o,e):void 0}const s=null===(r=i)||void 0===r?void 0:r.getValue(),p=s?l.oC(s):{};let d;if(s&&a.target_property){var c;d=p[(null===(c=i)||void 0===c?void 0:c.getMappedProperty(a.target_property))??a.target_property]}return{propertySchema:a,relationPropertySchema:n,relatedCollectionValue:s,relatedCollectionSchema:p,targetPropertySchema:d}}function H(e){let{schema:t,property:o,parentStore:r}=e;const a=(0,n.VK)((()=>L(t,o,r)),[r,o,t]);return a?a.propertySchema.aggregation?(0,V.jsx)(V.Fragment,{children:g.VN[(0,s.gu)(a.propertySchema.aggregation)]}):(0,V.jsx)(d.FormattedMessage,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original"}):null}function I(){return(0,V.jsx)(d.FormattedMessage,{id:"database.rollupProperty.editProperty.tooltip",defaultMessage:"Select an existing relation first."})}function A(){return(0,V.jsx)(d.FormattedMessage,{id:"database.rollupProperty.editAggregate.tooltip",defaultMessage:"Select an existing relation and property first."})}function D(e,t){return e?void 0:(0,p.i)({width:11,fill:t.mediumIconColor})}function E(e){return"relation"===e.type}function K(e){return"rollup"!==e.type&&!l.Eu.includes(e.type)}function B(e){let{parent:t,analyticsFrom:o,schema:n,property:i,parentStore:s,onChange:l}=e;const p=(0,a.O7)(),d=(0,h.Y$)(),c=(0,r.useCallback)((e=>function(e,t,o,r,a,n,i,s){const l=L(r,a,n);if(!l)return;const p={...l.propertySchema,relation_property:e,target_property:"title",target_property_type:"title",aggregation:void 0};null==i||i({propertySchema:p}),u.Zr(t,{...(0,y.Pn)(s),from:o})}(e,p,o,n,i,s,l,d)),[p,o,n,i,s,l,d]);return(0,V.jsx)(O.Z,{schema:n,isRelationProperty:!0,onAccept:c,onClose:t.close,allowProperty:E})}function U(e){let{parent:t,analyticsFrom:o,schema:i,property:s,parentStore:l,onChange:p}=e;const d=(0,a.O7)(),c=(0,h.Y$)(),m=(0,r.useCallback)((e=>function(e,t,o,r,a,n,i,s){const l=L(r,a,n);if(!l||!l.relatedCollectionValue||!l.relatedCollectionSchema)return;const p=l.relatedCollectionSchema[e];if(!p)return;const d={...l.propertySchema,target_property:e,target_property_type:p.type,aggregation:void 0};null==i||i({propertySchema:d}),u.yj(t,{...(0,y.Pn)(s),from:o,property_type:p.type})}(e,d,o,i,s,l,p,c)),[d,o,i,s,l,p,c]),g=(0,n.VK)((()=>L(i,s,l)),[l,s,i]);return g?(0,V.jsx)(O.Z,{isRelationProperty:!1,schema:g.relatedCollectionSchema,onAccept:m,allowProperty:K,onClose:t.close}):null}function z(e){let{parent:t,analyticsFrom:o,schema:i,property:l,parentStore:p,onChange:c}=e;const m=(0,a.O7)(),g=(0,h.Y$)(),f=(0,r.useCallback)((e=>function(e,t,o,r,a,n,i,l){const p=L(r,a,n);if(!p)return;const d={...p.propertySchema,aggregation:e,show_as:void 0};null==i||i({propertySchema:d});const c=e?(0,s.gu)(e):void 0;u.en(t,{...(0,y.Pn)(l),from:o,aggregation:c})}(e,m,o,i,l,p,c,g)),[m,o,i,l,p,c,g]),M=(0,n.VK)((()=>L(i,l,p)),[p,l,i]);return M&&M.propertySchema.target_property?(0,V.jsx)(w.Z,{property:M.propertySchema.target_property,schema:M.relatedCollectionSchema,currentAggregation:M.propertySchema.aggregation,onChange:f,onClose:t.close,noneText:(0,V.jsx)(d.FormattedMessage,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original"}),source:"rollupPropertyMenu"}):null}function q(e,t,o,r,a,n,i,s,l){const{device:p}=e,c=L(r,a,n);if(c)return{key:0,render:e=>(0,V.jsx)(Z.Z,{...e,title:(0,V.jsx)(d.FormattedMessage,{id:"database.rollupProperty.editRelation.title",defaultMessage:"Relation"}),isTitleUppercase:!0}),items:[{key:0,render:e=>(0,V.jsx)(C.ZP,{popupType:p.isMobile?k.kQ.SlideUp:k.kQ.Popup,renderOrigin:r=>c.relationPropertySchema?(0,V.jsx)(Y.Z,{...(0,M.Z)(e,r),propertySchema:c.relationPropertySchema,format:Y.L.Name,right:D(o,t),disabled:o}):(0,V.jsx)(S.Z,{...(0,M.Z)(e,r),title:(0,V.jsx)(d.FormattedMessage,{id:"database.rollupProperty.editRelation.buttonTitle",defaultMessage:"Select an existing relationâ€¦"}),right:D(o,t),style:{color:t.mediumTextColor},disabled:o}),render:e=>(0,V.jsx)(B,{parent:e,analyticsFrom:i,schema:r,property:a,parentStore:n,onChange:l}),buttonPopupStore:s},e.key),action:()=>{s.setState({open:!0})}}]}}function $(e,t,o,r,a,n,i,s,l,p){const{device:c}=t,u=L(a,n,i);if(u)return{key:1,render:e=>(0,V.jsx)(Z.Z,{...e,title:(0,V.jsx)(d.FormattedMessage,{id:"database.rollupProperty.editProperty.title",defaultMessage:"Property"}),topBorder:!0,isTitleUppercase:!0}),items:[{key:0,render:t=>(0,V.jsx)(F.ZP,{renderTooltip:()=>(0,V.jsx)(I,{}),disableTooltip:e,render:m=>(0,V.jsx)(C.ZP,{popupType:c.isMobile?k.kQ.SlideUp:k.kQ.Popup,renderOrigin:a=>u.targetPropertySchema?(0,V.jsx)(Y.Z,{...(0,M.Z)(t,a),propertySchema:u.targetPropertySchema,format:Y.L.Name,right:D(r,o),disabled:r}):(0,V.jsx)(S.Z,{...(0,M.Z)(t,m),title:(0,V.jsx)(d.FormattedMessage,{id:"database.rollupProperty.editProperty.buttonTitle",defaultMessage:"Select a property to displayâ€¦"}),right:D(!e||r,o),disabled:!e||r,disabledFeedback:!0}),render:e=>(0,V.jsx)(U,{parent:e,analyticsFrom:s,schema:a,property:n,parentStore:i,onChange:p}),buttonPopupStore:l})},t.key),action:()=>{l.setState({open:!0})}}]}}function Q(e,t,o,r,a,n,i,s,l,p){const{device:c}=t;if(L(a,n,i))return{key:2,render:e=>(0,V.jsx)(Z.Z,{...e,title:(0,V.jsx)(d.FormattedMessage,{id:"database.rollupProperty.editAggregate.title",defaultMessage:"Calculate"}),topBorder:!0,isTitleUppercase:!0}),items:[{key:0,render:t=>(0,V.jsx)(F.ZP,{renderTooltip:()=>(0,V.jsx)(A,{}),disableTooltip:e,render:u=>e?(0,V.jsx)(C.ZP,{popupType:c.isMobile?k.kQ.SlideUp:k.kQ.Popup,renderOrigin:e=>(0,V.jsx)(S.Z,{...(0,M.Z)(t,e),title:(0,V.jsx)(H,{schema:a,property:n,parentStore:i}),right:D(r,o),disabled:r}),render:e=>(0,V.jsx)(z,{parent:e,analyticsFrom:s,schema:a,property:n,parentStore:i,onChange:p}),buttonPopupStore:l}):(0,V.jsx)(S.Z,{...(0,M.Z)(t,u),title:(0,V.jsx)(d.FormattedMessage,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original"}),right:D(r,o),disabled:!0,disabledFeedback:!0})},t.key),action:()=>{l.setState({open:!0})}}]}}},73456:(e,t,o)=>{o.d(t,{Z:()=>I});o(57658);var r=o(67294),a=o(480),n=o(86628),i=o(49085),s=o(99036),l=o(84619),p=o(96711),d=o(18557),c=o(37612),u=o(6287),m=o(9291),h=o(31701),g=o(53965),y=o(37810),f=o(36610),M=o(47307),v=o(17095),x=o(27871),S=o(18533),C=o(66890),b=o(92658),j=o(75079),P=o(60709),k=o(50959),Z=o(93405),F=o(68894),T=o(78140),w=o(32163),Y=o(40721),O=o(53437),V=o(72495),R=o(9050),_=o(22084),L=o(85893);const H=i.default.createClass(!1);const I=function(e){let{onClose:t,collectionId:o,propertySchema:i,property:s,onChange:l,option:p,analyticsFrom:d,statusGroup:c,origin:u,open:m,alignmentToOrigin:h}=e;const g=(0,a.O7)(),y=(0,n.qz)(void 0,H),f=(0,n.qz)(void 0,b.Z),M=(0,r.useRef)(m);(0,r.useEffect)((()=>{!M.current&&m&&f.setState({...f.state,inputValue:p.value}),M.current=m}),[m,p.value,f]);const v=(0,r.useCallback)((()=>(0,L.jsx)(D,{onClose:t,collectionId:o,propertySchema:i,property:s,onChange:l,option:p,analyticsFrom:d,statusGroup:c,renameInputStore:f,showSelectDescriptionStore:y})),[t,o,i,s,l,p,d,c,f,y]),x=(0,r.useCallback)((()=>function(e,t,o,r,a,n,i){e(),A(t,o,r,a,n,i)}(t,o,i,s,l,p,f)),[t,o,i,s,l,p,f]),{device:S}=g;return(0,L.jsx)(O.ZP,{popupType:S.isMobile?O.ZP.PopupType.SlideUp:O.ZP.PopupType.Popup,open:m,onDismiss:x,origin:u,render:v,alignmentToOrigin:h})};function A(e,t,o,r,a,n){const i=n.state.inputValue,s=t.options||[],l=s.find((e=>e.id!==a.id&&e.value.trim().toLowerCase()===i.trim().toLowerCase()));if(a.value!==i)if(i)if(l)M.showErrorMessage((0,L.jsx)(m.FormattedMessage,{defaultMessage:"This select option already exists.",id:"database.editProperty.errorDialog.duplicateSelectValue.message"}));else{const n=s.find((e=>e.id===a.id));if(!n)return;const l=i.trim(),p={...n,value:l},d={pointer:{table:u.vF,id:e},command:"keyedObjectListUpdate",path:["schema",o,"options"],args:{value:p}},c="status"===t.type&&a.value===t.defaultOption?{pointer:{table:u.vF,id:e},command:"update",path:["schema",o],args:{defaultOption:l}}:void 0;r(g.oA([d,c]))}else M.showErrorMessage((0,L.jsx)(m.FormattedMessage,{defaultMessage:"Please type a value.",id:"database.editProperty.errorDialog.missingSelectValue.message"}))}function D(e){let{onClose:t,collectionId:o,propertySchema:i,property:g,onChange:b,option:O,analyticsFrom:H,statusGroup:I,renameInputStore:D,showSelectDescriptionStore:E}=e;const K=(0,m.useIntl)(),B=(0,a.O7)(),U=(0,C.Y$)(),z=(0,r.useCallback)((e=>function(e,t){const o=e.target.value.replace(/,/g,"");t.setState({...t.state,inputValue:o}),t.emit()}(e,D)),[D]),q=(0,r.useCallback)((()=>function(e,t,o,r,a,n,i){e(),A(t,o,r,a,n,i)}(t,o,i,g,b,O,D)),[t,o,i,g,b,O,D]),$=(0,r.useCallback)((()=>function(e,t,o,r,a,n,i,l,p,d){"status"!==n.type||t.value!==n.defaultOption?M.showDialog({showCancel:!0,keepFocus:!1,message:(0,L.jsx)(m.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.deleteModal.prompt",defaultMessage:"Are you sure you want to delete this option?"}),items:[{label:(0,L.jsx)(m.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.deleteModal.confirmButton",defaultMessage:"Delete"}),color:"red",onAccept:()=>{if(!s.cu(n)&&"status"!==n.type)return;const c={table:u.vF,id:o},m=[],h={pointer:c,command:"keyedObjectListRemove",path:["schema",i,"options"],args:{remove:{id:t.id}}};if(m.push(h),p&&"status"===n.type){const e=(n.groups??[]).findIndex((e=>e.id===p.id)),o={pointer:c,command:"listRemove",path:["schema",i,"groups",e,"optionIds"],args:{id:t.id}};m.push(o)}r(m),l(),f.$q(e,{...(0,j.Pn)(d),property_type:n.type,action:"select_delete_option",from:a})}}]}):M.showErrorMessage((0,L.jsx)(m.FormattedMessage,{defaultMessage:"Cannot delete default option.",id:"database.editProperty.errorDialog.forbidDeleteDefaultOption.message"}))}(B,O,o,b,H,i,g,t,I,U)),[B,O,o,b,H,i,g,t,I,U]),{device:Q}=B,N=(0,n.VK)((()=>E.state),[E]),W=(0,n.VK)((()=>D.state.inputValue),[D]),G=[];N&&G.push({key:"description",render:e=>(0,L.jsx)(V.Z,{...e,desktopStyle:{paddingTop:0},title:Q.isMobile?K.formatMessage(x.k.descriptionHeader):void 0}),items:[{key:"description",render:e=>(0,L.jsx)(x.i,{...e,initialDescription:O.description,handleSaveDescription:e=>function(e,t,o,r,a,n,i,s){if(e===(s.description??""))return;const l={...s,description:e};o([{pointer:{table:u.vF,id:r},command:"keyedObjectListUpdate",path:["schema",a,"options"],args:{value:l}}]),f.$q(t,{property_type:n.type,action:"select_set_description",from:i})}(e,B,b,o,g,i,H,O),disableAutoSection:!0}),action:()=>{}}]});const J={key:"action",render:e=>(0,L.jsx)(V.Z,{...e}),items:[]};G.push(J),J.items.push({key:"delete",render:e=>(0,L.jsx)(Z.Z,{...e,title:(0,L.jsx)(m.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.deleteLabel",defaultMessage:"Delete"}),svg:c.y}),action:$}),I&&"status"===i.type&&(J.items.push({key:"setAsDefault",render:e=>(0,L.jsx)(Z.Z,{...e,title:(0,L.jsx)(m.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.setAsDefault",defaultMessage:"Set as default"}),svg:d.z}),action:()=>async function(e,t,o,r,a,n,i,s,l){if("status"!==o.type||!l)return;if(n.value===o.defaultOption)return;if(void 0!==o.defaultOption&&!(await M.confirmUserAction({message:(0,L.jsx)("span",{children:(0,L.jsx)(m.FormattedMessage,{defaultMessage:"Change default to <b>{defaultValue}</b>?",id:"database.editProperty.setAsDefault.confirm.title",values:{defaultValue:n.value,b:e=>(0,L.jsx)("span",{style:{fontWeight:y.Z.fontWeight.semibold},children:e})}})}),description:(0,L.jsx)("span",{children:(0,L.jsx)(m.FormattedMessage,{defaultMessage:"New pages will start with {defaultValue} as the default status. Existing pages <b>without a status explicitly set</b> will switch to {defaultValue}.",id:"database.editProperty.setAsDefault.confirm.description",values:{defaultValue:n.value,b:e=>(0,L.jsx)("span",{style:{fontWeight:y.Z.fontWeight.semibold},children:e})}})}),acceptLabel:(0,L.jsx)(m.FormattedMessage,{defaultMessage:"Continue",id:"database.editProperty.setAsDefault.confirm.continueButton"})})))return;const p=[],d={pointer:{table:u.vF,id:e},command:"update",path:["schema",t],args:{defaultOption:n.value}};p.push(d),r(p),i(),f.$q(s,{property_type:o.type,action:"status_set_default",from:a,collection_id:e})}(o,g,i,b,H,O,t,B,I)}),J.items.push({key:"Group",render:e=>(0,L.jsx)("div",{...e,children:(0,L.jsx)(S.Z,{...e,title:(0,L.jsx)(m.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.Group",defaultMessage:"Group"}),selectedKey:I.name,options:(i.groups??[]).map((e=>({key:e.name,title:k.ZA[e.name]??e.name}))),icon:e=>(0,p.V)({...e,width:16,marginRight:0}),onChange:e=>{!function(e,t,o,r,a,n,i,s,l){if("status"!==i.type||!l)return;const p={table:u.vF,id:t},d=[],c=i.groups??[],m=c.findIndex((e=>e.id===l.id)),h=c.findIndex((t=>t.name===e));if(m===h)return;const g={pointer:p,command:"listRemove",path:["schema",r,"groups",m,"optionIds"],args:{id:o.id}},y={pointer:p,command:"listAfter",path:["schema",r,"groups",h,"optionIds"],args:{id:o.id}};d.push(g,y);const M=i.options??[],v=c.flatMap((e=>{const t=e.optionIds??[],o=M.filter((e=>t.includes(e.id)));return o})),x={pointer:p,command:"set",path:["schema",r,"options"],args:v};d.push(x),a(d),f.$q(s,{property_type:i.type,action:"status_set_default",from:n,collection_id:t})}(e,o,O,g,b,H,i,B,I)}})}),action:()=>{}}));const X=h.AP.map((e=>{const t={key:e,render:t=>(0,L.jsx)(R.Z,{...t,color:e,checkState:O.color===e}),action:()=>{!function(e,t,o,r,a,n,i,s){const l={...t,color:e};n([{pointer:{table:u.vF,id:o},command:"keyedObjectListUpdate",path:["schema",r,"options"],args:{value:l}}]),f.$q(s,{property_type:a.type,action:"select_change_color",from:i,collection_id:o})}(e,O,o,g,i,b,H,B)}};return t})),ee={key:"color",render:e=>(0,L.jsx)(V.Z,{...e,title:(0,L.jsx)(m.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.colorsSection",defaultMessage:"Colors"}),isTitleUppercase:!0,topBorder:!0}),items:X};let te;return G.push(ee),te=Q.isMobile?{menuType:P.og.Modal,title:(0,L.jsx)(_.a,{format:l.lo.Large,value:O.value,color:O.color,showRemoveButton:!1,isSingle:!0}),right:(0,L.jsx)(Y.DoneMenuText,{}),onClickRight:q}:{menuType:P.og.Popup,width:220},(0,L.jsxs)(T.Z,{...te,children:[(0,L.jsx)(V.Z,{isInput:!0,children:(0,L.jsx)(F.ZP,{focusInitial:!0,selectAll:!Q.isMobile,value:W,maxlength:180,onChange:z,onSubmit:q,showClearButton:!1,inputRight:(0,L.jsx)(v.l,{onClick:()=>E.setState(!N),description:O.description,showTooltip:!N})})}),(0,L.jsx)(w.Z,{type:w.i.Vertical,disableKeyboard:!0,initialFocus:void 0,sections:G})]})}},72589:(e,t,o)=>{o.d(t,{Z:()=>O});var r=o(67294),a=o(480),n=o(86628),i=o(24405),s=o(35011),l=o(84619),p=o(73110),d=o(73717),c=o(35102),u=o(42875),m=o(66673),h=o(59753),g=o(40470),y=o(37810),f=o(36610),M=o(66890),v=o(75079),x=o(33929),S=o(60709),C=o(73807),b=o(80444),j=o(19629),P=o(30752),k=o(8606),Z=o(53876),F=o(78140),T=o(65668),w=o(85893);const Y=200;function O(e){var t,o,i,l;const{property:y,disabled:j,formulas:P,getRecordModel:k,propertySchema:Z,collectionStore:O,handleSave:R,handleClose:_,blockStore:L,analyticsFrom:H}=e,I=(0,a.O7)(),A=(0,M.Y$)(),[D,E]=(0,r.useState)(null==Z||null===(t=Z.formula2)||void 0===t?void 0:t.code),K=(0,m.Kt)(D,Y,Object.is),B=(0,r.useRef)(null===(o=Z.formula2)||void 0===o?void 0:o.code),U=(0,r.useRef)(D),z=(0,r.useRef)(null==Z||null===(i=Z.formula2)||void 0===i?void 0:i.result_type),q=(0,r.useCallback)((e=>{U.current=e,E(e)}),[]),$=(0,r.useCallback)((e=>{z.current=e}),[]),[Q,N]=(0,r.useState)([]),W=(0,a.Fy)();(0,r.useEffect)((()=>()=>{const e=B.current,t=U.current,o=z.current;t===e&&void 0===ee||(R({newValue:t,newType:(0,s.x9)(o??{type:"unknown"}),propertySchema:Z,collectionStore:O,property:y}),f.$q(I,{...(0,v.Pn)(A),property_type:Z.type,action:"formula_v2_edit",from:H}))}),[]);const G=(0,n.VK)((()=>O.pointer),[O.pointer]),J=(0,r.useMemo)((()=>{const e={type:"block",collection:G};return{kind:p.yp.ThisRow,type:e}}),[G]),X=(0,r.useMemo)((()=>{const e=h.s8.fromGetRecordModelFn(k);return{sourceProperty:y,valueTypes:[J],handleDataRequest:P.createFormulaDataRequestHandler(k,e),formulaPropertyNames:D&&(0,c.Ny)(D)}}),[D,P,k,y,J]),ee=(0,n.VK)((()=>{if("v2"!==Z.version&&Z.formula)return P.convertCollectionFormulaToFormula2(Z.formula,G,O.getSchema())}),[G,O,P,Z.formula,Z.version]),te=(0,r.useRef)(!1);(0,r.useEffect)((()=>{!async function(){if(!ee||te.current)return;const e=await P.analyzeFormula(ee,X);let t;t=g.x.isFail(e)?{type:"unknown"}:e.value.type??{type:"unknown"},te.current=!0,q(ee),$(t)}()}),[O,P,q,$,y,Z,ee,X]);const oe=(0,r.useMemo)((()=>{var e;const t="v2"===Z.version?null===(e=Z.formula2)||void 0===e?void 0:e.code:ee;return B.current=t,t}),[null===(l=Z.formula2)||void 0===l?void 0:l.code,Z.version,ee]),re=(0,n.VK)((()=>{var e;return null===(e=b.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),ae=(0,C._)(),ne=(0,n.VK)((()=>{N([]);const e=O.getModel(),t=null==L?void 0:L.getModel(),o=null==L?void 0:L.getRecordModel;if(!(t&&e&&K&&o))return;const r=(0,s.NM)({block:t,property:y,formulaCode:K,getRecordModel:o,intl:x.default.getIntl(),userTimeZone:(0,u.r)(),depth:0,visitedProperties:new Set,formulaTimeoutTimestampMs:Date.now()+ae,resultCache:new Map});if(r){if(!g.x.isFail(r))return r.value;(0,d.y_)(r.error)&&N([r.error])}}),[O,L,K,y,ae]);return X&&re?(0,w.jsx)(F.Z,{menuType:W.isMobile?S.og.Modal:S.og.Popup,hideMobileTopbar:!0,width:W.isMobile?void 0:740,disableBottomPadding:!0,maxHeight:"unset",disableHeaderBorder:!0,disableScroller:!0,children:(0,w.jsx)(T.Z,{initialCode:oe,outputFooter:void 0!==L&&(0,w.jsx)(V,{formulaResult:ne,blockStore:L,formulaSchema:Z}),formulas:P,getRecordModel:k,focus:!0,disabled:j,parentSpaceId:re,typecheckContext:X,onCodeChange:q,onTypeChange:$,handleClose:_,parentCollection:O,evaluationErrors:Q})}):null}const V=r.memo((e=>{let{formulaResult:t,blockStore:o,formulaSchema:a}=e;const[s,p]=(0,n.VK)((()=>{var e;if(!t||"undefined"===t.type)return[[],"text"];const r=(0,P.$I)(t,o.getRecordModel,(0,u.r)());return[r,(null===(e=r[0])||void 0===e?void 0:e.type)??"text"]}),[o.getRecordModel,t]),d=(0,n.VK)((()=>{if(null==s||!s.length)return[];const e=(0,j.vQ)(p,a);return(0,w.jsx)(j.E1,{propertyType:p,rootPropertySchema:a,numberRightAlign:!1,children:s.map(((t,r)=>(0,w.jsx)(j.gZ,{token:t,targetPropertySchema:a,blockStore:o,withComma:e&&r<s.length-1,numberRightAlign:!1},`${t.id}-${r}`)))})}),[o,a,s,p]),c=(0,i.yK)((e=>({output:{display:"flex",alignItems:"center",zIndex:1,fontSize:y.Z.fontSize.UISmall.desktop,height:38,padding:10,width:"100%",borderTop:`1px solid ${e.outlineButtonBorder}`,overflow:"hidden"},equals:{fontSize:y.Z.fontSize.UIRegular.desktop,color:e.mediumTextColor,marginRight:6,marginLeft:2}})),[]),m=(0,r.useMemo)((()=>({baseStyles:{sizing:"small",tokenFormat:l.lo.Small,textStyle:{overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap"},tokenWrapStyle:{display:"flex",flexWrap:"nowrap",...Z.RQ[l.lo.Medium]}},store:o,isEmpty:!1,isReadOnly:!0,shouldRenderTooltip:!1,shouldWrap:!1,collectionContextStore:void 0,templateVariableContext:void 0,property:void 0,propertyFormat:void 0,propertySchema:a,trackEditBlockProperty:()=>{},format:0,containerRef:null})),[o,a]);return(0,w.jsx)(k.O.Provider,{value:m,children:(0,w.jsxs)("div",{style:c.output,children:[(0,w.jsx)("span",{style:c.equals,children:"="}),d]})})}));V.displayName="FormulaOutputFooter"},12205:(e,t,o)=>{o.d(t,{J:()=>n});var r=o(86628),a=o(80444);function n(){const{currentSpaceStore:e}=(0,r.Kw)(a.default);return(0,r.VK)((()=>(null==e?void 0:e.canAdmin())??!1),[e])}},52489:(e,t,o)=>{o.d(t,{Z:()=>n});var r=o(49085);class a extends r.default{getInitialState(){return{isModalOpen:!1,collectionContextStore:void 0}}}const n=new a},11843:(e,t,o)=>{o.d(t,{E:()=>i,S:()=>n});var r=o(40506);const a={"de-DE":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"da-DK":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"fi-FI":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"nb-NO":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"nl-NL":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"sv-SE":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"en-US":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"es-ES":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"es-LA":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"fr-FR":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"pt-BR":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"ko-KR":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"YYYY[ë…„] MMMM"},"zh-CN":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"YYYY[å¹´]MMM"},"zh-TW":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"YYYY[å¹´]MMM"},"ja-JP":{time:{"12h":"A h:mm","24h":"H:mm",hidden:r.n3},month:"YYYY[å¹´]MMM"},pseudo:{time:{"12h":"A h:mm","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"}},n=["de-DE","fr-FR"];function i(e){return a[e]}},92165:(e,t,o)=>{o.d(t,{Z:()=>n});o(67294);var r=o(45238),a=o(85893);const n=(0,r.IU)("arrowsDiverging",{viewBox:"0 0 12 12",svg:(0,a.jsx)("path",{d:"M6 11.2891C6.42188 11.2891 6.63281 11.0469 6.63281 10.5625V7.3457C6.63281 7.00586 6.71875 6.64062 6.89062 6.25C7.06641 5.85938 7.29492 5.47266 7.57617 5.08984C7.86133 4.70703 8.16992 4.35547 8.50195 4.03516C8.83789 3.71484 9.16406 3.45312 9.48047 3.25L9.95508 2.94531C10.1621 2.81641 10.2656 2.63281 10.2656 2.39453C10.2656 2.21875 10.2109 2.07227 10.1016 1.95508C9.99219 1.83789 9.8418 1.7793 9.65039 1.7793C9.4668 1.7793 9.29102 1.83398 9.12305 1.94336L8.81836 2.14844C8.51367 2.34766 8.20898 2.58984 7.9043 2.875C7.59961 3.15625 7.31641 3.45508 7.05469 3.77148C6.79297 4.08398 6.56836 4.39258 6.38086 4.69727C6.19727 4.99805 6.07227 5.26953 6.00586 5.51172H5.98828C5.91797 5.26953 5.79102 4.99805 5.60742 4.69727C5.42383 4.39258 5.19922 4.08398 4.93359 3.77148C4.67188 3.45508 4.38867 3.15625 4.08398 2.875C3.7832 2.58984 3.48047 2.34766 3.17578 2.14844L2.87109 1.94336C2.69922 1.83398 2.52344 1.7793 2.34375 1.7793C2.14844 1.7793 1.99609 1.83984 1.88672 1.96094C1.78125 2.08203 1.72852 2.22461 1.72852 2.38867C1.72852 2.62695 1.83203 2.8125 2.03906 2.94531L2.51367 3.25C2.83008 3.45312 3.1543 3.71484 3.48633 4.03516C3.81836 4.35547 4.12695 4.70703 4.41211 5.08984C4.69727 5.47266 4.92773 5.85938 5.10352 6.25C5.2793 6.64062 5.36719 7.00586 5.36719 7.3457V10.5625C5.36719 11.0469 5.57812 11.2891 6 11.2891ZM1.81641 3.9707L3.71484 1.52734C3.85547 1.33984 3.88281 1.17578 3.79688 1.03516C3.71484 0.890625 3.55469 0.814453 3.31641 0.806641L0.808594 0.712891C0.613281 0.705078 0.466797 0.763672 0.369141 0.888672C0.271484 1.00977 0.251953 1.16406 0.310547 1.35156L1.02539 3.75391C1.0918 3.98438 1.20312 4.125 1.35938 4.17578C1.51953 4.22656 1.67188 4.1582 1.81641 3.9707ZM10.0898 3.95898C10.2266 4.1543 10.375 4.23047 10.5352 4.1875C10.6992 4.14062 10.8164 4.00391 10.8867 3.77734L11.6777 1.39258C11.7402 1.20508 11.7246 1.04883 11.6309 0.923828C11.541 0.798828 11.3984 0.736328 11.2031 0.736328L8.68945 0.753906C8.45117 0.753906 8.28711 0.824219 8.19727 0.964844C8.10742 1.10156 8.13086 1.26562 8.26758 1.45703L10.0898 3.95898Z"})})},5336:(e,t,o)=>{o.d(t,{r:()=>n});o(67294);var r=o(45238),a=o(85893);const n=(0,r.IU)("basicClock",{viewBox:"0 0 16 16",svg:(0,a.jsx)("path",{d:"M4.541 7.919a.53.53 0 01-.39-.157.53.53 0 01-.157-.39c0-.155.053-.282.157-.383a.53.53 0 01.39-.157h2.905V2.895c0-.15.053-.278.158-.383a.521.521 0 01.382-.158.53.53 0 01.39.158.521.521 0 01.157.383v4.477a.53.53 0 01-.157.39.53.53 0 01-.39.157H4.541zm3.452 6.207a6.789 6.789 0 01-2.727-.554 7.124 7.124 0 01-2.256-1.524 7.277 7.277 0 01-1.525-2.256 6.788 6.788 0 01-.553-2.728c0-.966.184-1.875.553-2.727A7.241 7.241 0 015.258.557 6.788 6.788 0 017.987.003c.971 0 1.882.184 2.735.554.852.369 1.604.88 2.256 1.53a7.136 7.136 0 011.53 2.25c.37.852.555 1.761.555 2.727 0 .967-.185 1.876-.554 2.728a7.218 7.218 0 01-3.787 3.78 6.789 6.789 0 01-2.728.554zm0-1.395c.789 0 1.525-.145 2.208-.437a5.678 5.678 0 001.805-1.217 5.68 5.68 0 001.217-1.805c.291-.683.437-1.42.437-2.208a5.55 5.55 0 00-.437-2.2 5.66 5.66 0 00-3.029-3.029 5.567 5.567 0 00-2.208-.438c-.784 0-1.52.146-2.208.438A5.6 5.6 0 003.98 3.052a5.715 5.715 0 00-1.21 1.811 5.55 5.55 0 00-.437 2.201c0 .789.146 1.525.438 2.208a5.735 5.735 0 001.21 1.805 5.598 5.598 0 004.013 1.654z"})})},89036:(e,t,o)=>{o.d(t,{v:()=>n});o(67294);var r=o(45238),a=o(85893);const n=(0,r.IU)("folder",{viewBox:"0 0 16 16",svg:(0,a.jsx)("path",{d:"M2.4082 14.3672H13.7627C15.0684 14.3672 15.8271 13.6084 15.8271 12.1455V5.11816C15.8271 3.65527 15.0615 2.89648 13.585 2.89648H7.22754C6.73535 2.89648 6.44824 2.78027 6.07227 2.47266L5.67578 2.1582C5.19727 1.76172 4.8418 1.63184 4.13086 1.63184H2.19629C0.917969 1.63184 0.166016 2.37695 0.166016 3.8125V12.1455C0.166016 13.6084 0.931641 14.3672 2.4082 14.3672ZM1.50586 3.92871C1.50586 3.2998 1.84766 2.97168 2.46289 2.97168H3.77539C4.26074 2.97168 4.54102 3.08105 4.92383 3.39551L5.32031 3.7168C5.79199 4.10645 6.16113 4.23633 6.87207 4.23633H13.5098C14.1387 4.23633 14.4873 4.56445 14.4873 5.23438V5.63086H1.50586V3.92871ZM2.49023 13.0273C1.85449 13.0273 1.50586 12.6992 1.50586 12.0361V6.81348H14.4873V12.0361C14.4873 12.6992 14.1387 13.0273 13.5098 13.0273H2.49023Z"})})}}]);