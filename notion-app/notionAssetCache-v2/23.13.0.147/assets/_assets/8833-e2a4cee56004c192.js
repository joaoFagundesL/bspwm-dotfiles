"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[8833],{26797:(e,t,o)=>{o.d(t,{Fv:()=>B,JN:()=>C,QG:()=>A,cQ:()=>P,f$:()=>k,fX:()=>V,td:()=>h,xD:()=>I});o(57658);var r=o(30120),n=o(80951),i=o(40506),a=o(53877),c=o(42875),l=o(6287),s=o(53965),p=o(1898),d=o(10906),u=o(95802),m=o(15723),f=o(17746),v=o(6258),S=o(8406),_=o(54569),g=o(75134),y=o(19785),b=o(9953),w=o(993);function C(e){const{environment:t,droppedStores:o,duplicate:s,calendarBy:p,transaction:u,collectionContextStore:m}=e,f=r.ou.fromMillis(e.startOfDay);let v=!0;for(const r of o){const t=e.collectionStore?e.collectionStore:(0,d.Bm)({store:r,collectionContextStore:m});if(r.getParentTable()===l.vF||!t){v=!1;break}y.zw({childStore:r,parentStore:t,transaction:u})||(v=!1)}const g=_.Ab({environment:t,droppedStores:o,duplicate:s,duplicateUseCrdt:"same_as_store",transaction:u,collectionStore:e.collectionStore});for(const r of g){const o=e.collectionStore?e.collectionStore:(0,d.Bm)({store:r,collectionContextStore:m});if(!o)continue;const l=o.getMappedProperty(p),s=r.getPropertyStore(l),g=n.Gl(s.getValue())||a.Lg((0,c.r)()),y=a.c$(g,(0,c.r)()),b=f.toFormat(a.Iq);let w;if("date"===y.type||"datetime"===y.type)w={...y,start_date:b};else{const e=a.NK(y,(0,c.r)());if(!e.end)return;const t={...y,start_date:b},o=a.NK(t,(0,c.r)()).start.diff(e.start,"days"),r=e.end.plus(o).toFormat(a.Iq);w={...y,start_date:b,end_date:r}}const C=a.c$(w,i.yw(g)||(0,c.r)());_.mp({environment:t,store:r,collectionStore:o,collectionContextStore:m,shouldCoerce:!0,groupsPointer:[],transaction:u,alreadyMovedToCollection:v}),I({environment:t,type:"dateValue",propertyId:l,store:r,transaction:u,dateValue:C}),S.rv({environment:t,collectionContextStore:m,block_id:r.id,property:l,property_type:"date",from:"calendar"})}}function k(e){const{calendarStore:t,direction:o,target:r}=e;t.setState({...t.state,isDragging:!0,target:r,direction:o,temporaryValue:void 0})}function h(e){const{calendarStore:t,x:o,y:l,calendarBy:p}=e,d=t.state;if(d.isDragging){const e=n.Gl(d.target.getPropertyStore(p).getValue());if(!e)return;const v=a.c$(e,(0,c.r)()),S=d.temporaryValue||e,_=a.c$(S,(0,c.r)()),g=[];d.dayStoreMap.forEach(((e,t)=>{g.push({store:e,timestamp:t})}));const y=g.find((e=>{let{store:t}=e;const r=u.C.getRectFromStore(t);return Boolean(r&&m.uh(r,o,l))}));let b;if(y){const e=r.ou.fromMillis(y.timestamp),t=e.endOf("day"),o=e.toFormat(a.Iq);if(v){const n=a.NK(v,(0,c.r)());if(d.direction===f.t.Left)if(r.Xp.fromDateTimes(e,t).contains(n.start))b=v;else{let e;e="datetimerange"===v.type||"daterange"===v.type?{...v,start_date:o,end_date:v.end_date}:"datetime"===v.type?{type:"datetimerange",start_date:o,start_time:v.start_time,end_date:v.start_date,end_time:v.start_time,time_zone:v.time_zone,reminder:v.reminder}:{type:"daterange",start_date:o,end_date:v.start_date,reminder:v.reminder};const t=a.NK(e,(0,c.r)());b=!n.end&&t.start>n.start||n.end&&t.start>n.end?_:e}else if(n.end?r.Xp.fromDateTimes(e,t).contains(n.end):r.Xp.fromDateTimes(e,t).contains(n.start))b=v;else{let e;e="date"===v.type?{...v,type:"daterange",end_date:o}:"datetime"===v.type?{...v,type:"datetimerange",end_date:o,end_time:"00:00"}:{...v,end_date:o};const t=a.NK(e,(0,c.r)());b=t.end&&t.end<t.start?_:e}}}if(b&&!s.Xy(_,b)){const e=a.c$(b,i.yw(S)||(0,c.r)());t.setState({...d,temporaryValue:e})}}}function V(e){const{environment:t,calendarStore:o,calendarBy:r,transaction:n}=e,i=o.state;i.isDragging&&i.temporaryValue&&(I({type:"dateValue",environment:t,dateValue:i.temporaryValue,propertyId:r,store:i.target,transaction:n}),o.setState({...o.state,isDragging:!1}))}function P(e){const{calendarStore:t}=e,o=t.state;o.isDragging&&t.setState({...o,isDragging:!1})}function B(e){const{environment:t,store:o,collectionStore:i,collectionContextStore:l,startDayOfWeek:s,transaction:p}=e,d=l.dateRangeStart.state,u=(0,c.r)(),m=l.normalizedQueryStore.state;if(!m||!m.calendar_by)return;const f=(null==i?void 0:i.getMappedProperty(m.calendar_by))??m.calendar_by,v=a.gQ(d,s,u),S=v.startOf("month"),g=v.endOf("month"),y=r.ou.now().startOf("day");let w;return w=r.Xp.fromDateTimes(S,g).contains(y)?a.hT(y.valueOf(),u):a.hT(a.em(d,s,u).valueOf(),u),b.sW({store:o.getPropertiesStore(),data:{[f]:n.d7(w)},transaction:p}),_.mp({environment:t,store:o,collectionStore:i,collectionContextStore:l,shouldCoerce:!0,groupsPointer:[],transaction:p}),o}function I(e){const{environment:t,store:o,propertyId:r,transaction:i}=e;let l;"timestamp"===e.type?l=a.hT(e.timestampMs.valueOf(),(0,c.r)()):"dateValue"===e.type?l=e.dateValue:(0,p.t1)(e);const s=o.getPropertyValue(r),d=n.d7(l);b.sW({store:o.getPropertiesStore(),data:{[r]:d},transaction:i}),g.H({environment:t,store:o,dateProperty:{id:r,oldValue:s,newValue:d}})}function A(e){const{environment:t,collectionStore:o,calendarBy:r,store:n,insertStores:i,collectionContextStore:a,transaction:c}=e,l=n.getPropertyStore(r).getValue();for(const s of i)_.mp({environment:t,store:s,collectionStore:o,collectionContextStore:a,shouldCoerce:!0,groupsPointer:[],transaction:c}),w.sO({environment:t,editorMode:"default",store:s.getNormalizedPropertyStore(r),value:l,transaction:c});return i.map((e=>v.G.createChildStore(o,e.pointer)))}},36821:(e,t,o)=>{o.d(t,{KV:()=>q,Rh:()=>Q,U6:()=>X,Wu:()=>L,Xx:()=>N,YD:()=>J,g9:()=>G,jc:()=>H,m8:()=>Y,ys:()=>$,zX:()=>Z});var r=o(30120),n=o(15145),i=o(92996),a=o(2647),c=o(99036),l=o(40506),s=o(53877),p=o(98963),d=o(18844),u=o(21202),m=o(6287),f=o(75246),v=o(29369),S=o(39927),_=o(94438),g=o(70203),y=o(7032),b=o(16732),w=o(40663),C=o(93174),k=o(75330),h=o(97978),V=o(33929),P=o(77907),B=o(80444),I=o(6258),A=o(8406),T=o(54642),U=o(26797),M=o(16956),F=o(5149),R=o(96802),x=o(9953),D=o(21862),E=o(13447),W=o(39865),O=o(37181);const z="week";function N(e){var t;const{environment:o,transaction:r,tasksBlockStore:n,sprintsBlockStore:i}=e,a=null===(t=i.getFormat())||void 0===t?void 0:t.collection_pointer,c=n.getFormat().collection_pointer;a&&c&&j({environment:o,transaction:r,sprintCollectionStore:I.NW.createChildStore(i,a),taskCollectionStore:I.NW.createChildStore(n,c),sprintSettingsConfig:S.iZ})}function j(e){const{environment:t,sprintSettingsConfig:o,transaction:r,sprintCollectionStore:n,taskCollectionStore:i}=e,a=n.getSpaceId(),c=(0,y.ZP)(),l=(0,y.ZP)();x.ae({environment:t,table:p.cv,inMemoryRecordCache:n.inMemoryRecordCache,value:{id:c,parent_id:n.id,parent_table:n.table,alive:!0,space_id:a,status:o.autoCompleteSprints?"active":"disabled",trigger:{id:(0,y.ZP)(),type:"recurrence",recurrence:te(o)},action_ids:[l]},transaction:r}),R.FH({stores:[n],update:{automation_ids:[...n.getFormat().automation_ids??[],c]},transaction:r}),x.ae({environment:t,table:d.Xj,inMemoryRecordCache:n.inMemoryRecordCache,transaction:r,value:{id:l,parent_id:c,parent_table:p.cv,type:"complete_sprint",alive:!0,space_id:a,config:{sprint_collection:n.getSpaceShardedPointer(),task_collection:i.getSpaceShardedPointer(),complete_sprint_action:o.actionConfig.complete_sprint_action}}})}function q(e){const{environment:t,automationStore:o,transaction:r,newDuration:n,currentSprintBlockStore:i}=e;x.sW({store:o.getTriggerStore().getKeyStore("recurrence"),data:{interval:n},transaction:r}),K({environment:t,transaction:r,automationStore:o,currentSprintBlockStore:i})}function G(e){const{environment:t,automationStore:o,transaction:r,newWeekday:n,currentSprintBlockStore:i}=e;x.sW({store:o.getTriggerStore().getKeyStore("recurrence"),data:{weekdays:[n]},transaction:r}),K({environment:t,transaction:r,automationStore:o,currentSprintBlockStore:i})}function H(e){const{environment:t,automationStore:o,transaction:r,newAutocompleteStatus:n,currentSprintBlockStore:i}=e;x.sW({store:o,data:{status:n?"active":"disabled"},transaction:r}),K({environment:t,transaction:r,automationStore:o,currentSprintBlockStore:i});const c=o.getParentPointer();if(!c||c.table!==m.vF)return;const l=(0,h.mc)(t),s={automation_id:o.id,automation_actions:[{type:"complete_sprint"}],automation_triggers:[{type:"recurrence"}],collection_id:c.id};n?(0,a.Rt)(l,s):(0,a.ai)(l,s)}function K(e){const{automationStore:t,currentSprintBlockStore:o,transaction:n,environment:a}=e;if(!t.isActive())return;const c=t.getRecurrence();if(!c)return;const s=(0,_.Su)(c);if(!s)return;const p=o.getPropertyValue(i.b0.Dates);if(!p)return;const d=(0,g.nai)(p)[0];if(!d||"daterange"!==d.type)return;const u=d.start_date,{start_date:m,end_date:f}=(0,_.DW)({currentSprintStartDate:u,sprintSchedule:s});x.sW({store:t.getTriggerStore().getKeyStore("recurrence"),data:{start_date:(0,l.Io)(r.ou.fromISO(m).plus({minutes:1}).toJSDate())},transaction:n}),U.xD({store:o,propertyId:i.b0.Dates,transaction:n,environment:a,type:"dateValue",dateValue:{type:"daterange",start_date:u,end_date:f}})}function X(e){const{transaction:t,newRemainingTasksBehavior:o,actionStore:r}=e;x.sW({store:r.getConfigStore(),data:{complete_sprint_action:o},transaction:t})}async function $(e){var t;const{appTemplatesSetupActions:o,appTemplatesSprintBoardActions:r,appConfigs:a}=await P.deps.AppTemplates.loader(),{environment:c,collectionContextStore:l}=e,{currentSpaceViewStore:s}=B.default.state,p=l.collectionStore(),d=null==p?void 0:p.getParentBlockStore(),m=null==d?void 0:d.getParentStore(),S=null==p||null===(t=p.getFormat())||void 0===t?void 0:t.app_config_uri,_=S&&(0,w.YB)(a(),S);if(!p||!d||!m||!s||m.table!==f.bx&&m.table!==u.iU&&m.table!==v.e0||!_)return;const g=d.getFormat().app_id,y=g?await T.getCollectionViewBlocksByAppId(c,{spaceId:d.getSpaceId(),appId:g}):void 0,C="success"===(null==y?void 0:y.type)&&y.data.result.length?y.data.result.map((e=>I.G.createChildStore(m,{table:u.iU,id:e.blockId,spaceId:d.getSpaceId()}))):[d];await ee({environment:c,taskCollectionStore:p,executeFn:()=>{E.createAndCommit({userAction:"sprintSettingsActions.handleTurnOnSprints",environment:c,perform:e=>{const t=(0,b.eu)(),a=o.applyFeatures({environment:c,spaceViewStore:s,appParentStore:m,appUri:_.uri,features:[{type:"simple",featureUri:t.uri}],transaction:e,createOrModify:"modify",appCollectionViewBlockStores:C}),p=r.createSprintPage({environment:c,spaceViewStore:s,appParentStore:m,transaction:e,blockStores:a,creationEntryPoint:{type:"sprint_settings"}});F.E3({collectionSettingsStore:l.settingsStore}),p&&(D.r({environment:c,store:p,pageVisitSource:n.tY.Create}),A._H({environment:c,collectionContextStore:l,from:"view_settings",property:i.Es.TaskToSprintRelation,property_type:"relation",is_suggested_property:!0}))}})}})}async function Y(e){const{environment:t,collectionContextStore:o,sprintSettingsContext:r,sprintBoardViewBlockIds:a}=e,{sprintCollectionStore:c,automationContext:l,currentCollectionViewBlockStore:s,sprintCollectionViewBlockStore:p,taskCollectionStore:d,taskCollectionViewBlockStore:m}=r;if(!c||!p||!l)return;const f=m.getSpaceId(),v=[p,...a.map((e=>new I.G(t,{id:e,table:u.iU,spaceId:f})))];s.id===m.id?F.E3({collectionSettingsStore:o.settingsStore}):D.r({environment:t,store:m,pageVisitSource:n.tY.LeaveOrRemove});const{automationActions:S}=await C._1.loader(),{automationStore:_}=l;await ee({environment:t,taskCollectionStore:d,executeFn:()=>{E.createAndCommit({userAction:"sprintSettingsActions.handleTurnOffSprints",environment:t,perform:e=>{!function(e){const{transaction:t,blocksToDelete:o,environment:r,taskCollectionStore:n,sprintCollectionStore:a}=e;x.sW({store:a,transaction:t,data:{alive:!1}}),M.E2({environment:r,collectionStore:n,schema:n.getSchema(),property:i.Es.TaskToSprintRelation,transaction:t,permanentlyDelete:!0}),W.y8({environment:r,blocks:o,transaction:t,permanentlyDelete:!0})}({environment:t,transaction:e,blocksToDelete:v,sprintCollectionStore:c,taskCollectionStore:d}),S.disableAutomation({automationStore:_,environment:t,transaction:e}),S.deleteAutomation({automationStore:_,environment:t,transaction:e})}}),A.y9({environment:t,collectionContextStore:o,property_type:"relation",from:"view_settings",property:i.Es.TaskToSprintRelation})}})}function Z(e){const{environment:t,userSettingsStore:o}=e;E.createAndCommit({userAction:"sprintSettingsActions.handleSeenSprintsEngagementBanner",environment:t,perform:e=>{O.d2({userSettingsStore:o,data:{seen_sprint_settings_engagement_banner:!0},transaction:e})}})}function Q(e){e.settingsStore.setState({open:!0,stack:[{type:"main"},{type:"sprintSettings"}]})}function J(e){const{environment:t,collectionContextStore:o,currentViewBlockStore:r,taskCollectionViewBlockStore:n}=e,a=o.collectionViewStore();if(!a)return;const c=a.getFormat(),l=a.getRawQuery();E.createAndCommit({userAction:"sprintSettingsActions.handleManageSprintFromThisView",environment:t,perform:e=>{if(k.iG({collectionViewStore:a,transaction:e,update:{name:V.default.formatMessage(b.sY.tasksCurrentSprintV2ViewName),query2:{...l,filter:void 0},format:{...c,collection_view_icon:"/icons/playback-play-button_gray.svg",property_filters:b.Jt,app_config_uri:i.g3,hide_linked_collection_name:!0}}}),r.id===n.id){var t;const o=(null===(t=r.getFormat())||void 0===t?void 0:t.app_uri_map)??{},l=c.app_config_uri;l&&delete o[l],R.FH({stores:[n],update:{app_uri_map:{...o,[i.g3]:a.id}},transaction:e})}}})}function L(e){const{environment:t,sprintSettingsContext:o}=e;if(!o)return;const r=o.sprintCollectionStore;r&&!o.automationContext&&E.createAndCommit({userAction:"sprintSettingsActions.ensureCompleteSprintAutomation",environment:t,perform:e=>{j({environment:t,transaction:e,sprintCollectionStore:r,taskCollectionStore:o.taskCollectionStore,sprintSettingsConfig:S.iZ})}})}async function ee(e){const{executeFn:t,environment:o,taskCollectionStore:r}=e;await async function(e){var t;const{environment:o,taskCollectionStore:r}=e,n=r.getFormat().app_uri_map,a=i.Es.TaskToSprintRelation,l=r.getSchema(),s=(null==n?void 0:n[a])??a,p=l[s];if(!p||!(0,c.p_)(p))return;const d=null===(t=(0,c.j0)(p))||void 0===t?void 0:t.id;if(!d)return;const u=new Set([s]);Object.entries(l).forEach((e=>{var t;let[o,r]=e;r&&(0,c.p_)(r)&&(null===(t=(0,c.j0)(r))||void 0===t?void 0:t.id)===d&&u.add(o)}));const{serverCommitResult:m}=E.createAndCommit({userAction:"sprintSettingsActions.clearSprintRelationDataFromTaskCollection",environment:o,perform:e=>{for(const t of u)M.E2({environment:o,transaction:e,permanentlyDelete:!0,collectionStore:r,schema:l,property:t});null==n||delete n[a],n&&R.FH({stores:[r],transaction:e,update:{app_uri_map:n}})}});await m}({environment:o,taskCollectionStore:r}),t()}function te(e){return{frequency:z,interval:e.recurrenceConfig.interval,weekdays:e.recurrenceConfig.weekdays,start_date:r.ou.local().set({hour:0,minute:0,second:0,millisecond:0}).toMillis(),timezone:(0,s.Sv)(),hour:0,minute:0}}},88833:(e,t,o)=>{o.r(t),o.d(t,{applyFeatures:()=>ue,applyPresetFeatures:()=>pe,createTypedDBsInTeam:()=>be,createWikiInTeam:()=>Ce,initializeApp:()=>le,installAppsInTeam:()=>we,markTasksDatabaseTemplateIfNeeded:()=>ce,removeDependencies:()=>me});o(57658),o(21703);var r=o(15145),n=o(92996),i=o(41432),a=o(90559),c=o(14714),l=o(99036),s=o(80951),p=o(77657),d=o(6695),u=o(68626),m=o(74181),f=o(21202),v=o(6287),S=o(13493),_=o(9844),g=o(75246),y=o(29369),b=o(19889),w=o(11002),C=o(73314),k=o(70203),h=o(9291),V=o(53965),P=o(52629),B=o(7032),I=o(1898),A=o(36610),T=o(81193),U=o(54642),M=o(74882),F=o(16956),R=o(28673),x=o(47307),D=o(96802),E=o(94419),W=o(4617),O=o(19785),z=o(9953),N=o(75754),j=o(28014),q=o(150),G=o(993),H=o(13447),K=o(75330),X=o(10906),$=o(21100),Y=o(27105),Z=o(65183),Q=o(77181),J=o(27383),L=o(33929),ee=o(95697),te=o(30874),oe=o(6258),re=o(34517),ne=o(40663),ie=o(86095);const ae=(0,h.defineMessages)({initializeAppTemplateError:{id:"appTemplateActions.initializeAppTemplateError.message",defaultMessage:"Duplicate template failed."}});function ce(e){e&&e.some((e=>e.getFormat().app_config_uri===n.NB))&&(J.y.locallyMutatedTasksDatabase=!0)}function le(e){const{environment:t,temporaryContainerBlockStore:o,transaction:n}=e,i=pe({...e,initializeStore:o,createOrModify:"create"});return i&&i.length>0&&N._c({environment:t,store:i[0],redirect:!0,pageVisitSource:r.tY.Onboarding}),n.postSubmitCallbacks.push((async e=>{e?x.showErrorMessage(L.default.formatMessage(ae.initializeAppTemplateError)):i&&await async function(e){const{environment:t,appCollectionViewBlockStores:o}=e,r=V.oA(o.map((e=>{const t=e.getCollectionViewCollectionStore();if(t){const e=t.getSchema();if((0,a.$z)(e).length>0)return t}})));for(const n of r)await M.K({environment:t,collectionStore:n})}({environment:t,appCollectionViewBlockStores:i})})),i}function se(e){const{environment:t,spaceViewStore:o,appUri:r,parentStore:n,spaceId:a,transaction:c,presetUri:l}=e,s=(0,re.appConfigs)().find((e=>e.uri===r));if(!n.isDefined()||!s)return;if(0===s.presets.length)throw new Error(`No presets configuration for specified app: ${r}`);const p=s.presets.find((e=>e.uri===l));if(l&&!p)throw new Error("Couldn't find specified preset");const d=p||s.presets[0],u=(0,ne.KC)((0,re.appConfigs)(),d),m=s.presets.filter((e=>!(0,ne.Mi)(e.uri)));if(r.startsWith("notion://wiki")||1!==m.length){const e=z.j4({environment:t,type:i.Ti.collectionViewPage,spaceId:a,format:{app_config_uri:r,collection_view_sub_type:"app_container",page_icon:s.logo,app_template_preset:d.uri,app_template_features:u},properties:{title:(0,k.TPx)(r.startsWith("notion://wiki")?s.name:d.shortName)},inMemoryRecordCache:n.inMemoryRecordCache,transaction:c,useCrdt:(0,Y.S9)("app_template")});z.sW({store:e,data:{parent_id:n.id,parent_table:n.table,alive:!0},transaction:c});const l=oe.G.createChildStore(n,e.pointer);return ge(t,o,n,l,c,"prepend"),[l]}return ue({environment:t,spaceViewStore:o,appParentStore:n,appUri:r,features:u,createOrModify:"create",transaction:c})}function pe(e){const{environment:t,appUri:o,presetUri:r,transaction:n,createOrModify:i,from:a}=e,c=(0,re.appConfigs)().find((e=>e.uri===o)),l=null==c?void 0:c.presets.find((e=>e.uri===r));if(l)return n.postSubmitCallbacks.push((e=>{T.Y4(t,{preset_uri:de(r),status:Boolean(e)?"fail":"success",from:a}),e&&u.log({level:"error",from:"appTemplateActions.applyPresetFeatures",type:"transactionFailed",error:(0,P.Ui)(e),data:{miscDataToConvertToString:{appUri:o,presetUri:r,createOrModify:i,from:a}}})})),ue({...e,features:(0,ne.KC)((0,re.appConfigs)(),l)});u.log({level:"error",from:"appTemplateActions.applyPresetFeatures",type:"presetNotFound",error:{name:`Preset not found for appUri ${o} and presetUri ${r}. From: ${a}`}})}function de(e){return(0,n.SA)(e)?e:"other"}function ue(e){const{environment:t,spaceViewStore:o,appParentStore:r,appUri:a,features:p,transaction:u,createOrModify:y}=e,w=(0,re.appConfigs)().find((e=>e.uri===a));if(!w||!r.isDefined())return;let C;if("modify"===y){const t=V.jj(V.oA(e.appCollectionViewBlockStores.map((e=>e.getFormat().app_id))));if(1!==t.length)throw new Error("App collection view block stores must have the same app id");C=t[0]}const h=(0,ne._3)({featurePointers:p,appConfig:w});if(0===h.length)return;let P={};if("create"===e.createOrModify&&e.initializeStore){const o=h.filter((e=>"collection_view_block"===e.type)),r=o[0];r&&(z.sW({store:e.initializeStore,data:{type:e.initializeStore.isType(i.Ti.collectionViewPage)||e.initializeStore.isType(i.Ti.collectionView)?e.initializeStore.getType():i.Ti.collectionViewPage},transaction:u}),z.sW({store:e.initializeStore.getFormatStore(),data:{app_config_uri:r.uri,page_icon:r.icon,page_cover:r.cover,collection_view_sub_type:null,app_template_features:null},transaction:u}),G.sO({environment:t,editorMode:"default",store:e.initializeStore.getBlockTitleStore(),value:(0,k.TPx)(r.name),transaction:u}),P[r.uri]=e.initializeStore.id)}else"modify"===e.createOrModify&&(P=Object.assign({},...V.oA(e.appCollectionViewBlockStores.map((e=>{var t;return null===(t=e.getFormat())||void 0===t?void 0:t.app_uri_map})))));const A={...P};!function(e,t,o,r,i,a,p){const u=[...r.filter((e=>{let{type:t}=e;return"collection_view_block"===t})),...r.filter((e=>{let{type:t}=e;return"collection"===t})),...r.filter((e=>{let{type:t}=e;return"sub_external_collection"===t})),...r.filter((e=>{let{type:t}=e;return"property"===t})),...r.filter((e=>{let{type:t}=e;return"database_template"===t})),...r.filter((e=>{let{type:t}=e;return"block"===t})),...r.filter((e=>{let{type:t}=e;return"collection_view"===t}))],y=o.table===g.bx?o.id:o.getSpaceId();if(!y)return;for(const s of u)if("collection_view_block"===s.type){const r=i[s.uri];if(r){var w;const n=oe.G.createChildStore(o,{table:f.iU,id:r,spaceId:y});null!==(w=fe(t,o,n))&&void 0!==w&&null!==(w=w.getValue())&&void 0!==w&&w.includes(n.id)||ge(e,t,o,n,p,"append"),z.sW({store:n,data:{parent_id:o.id,parent_table:o.table,alive:!0},transaction:p})}else{const r=z.j4({environment:e,inMemoryRecordCache:o.inMemoryRecordCache,type:o.table===f.iU&&"app_container"===o.getFormat().collection_view_sub_type?"collection_view":"collection_view_page",spaceId:y,format:{app_config_uri:s.uri,page_icon:s.icon,page_cover:s.cover},properties:{title:(0,k.TPx)(s.name)},transaction:p,useCrdt:o.table===f.iU?o.useCrdt():(0,Y.S9)("app_template")});z.sW({store:r,data:{parent_id:o.id,parent_table:o.table,alive:!0},transaction:p}),i[s.uri]=r.id;ge(e,t,o,oe.G.createChildStore(o,r.pointer),p,"append")}}else if("collection"===s.type){const t=ye(o,s.collectionViewBlockUri,i);if(!t)throw new Error("SubViewBlockStore not found");const r=t.getCollectionViewSourceCollectionStore();r&&K.A9({collectionViewBlockStore:t,collectionStore:r,transaction:p});const n=i[s.uri];if(n){const e=oe.NW.createChildStore(o,{table:v.vF,id:n,spaceId:y});K.zz({collectionViewBlockStore:t,collectionStore:e,transaction:p}),z.sW({store:e,data:{alive:!0,parent_id:t.id,parent_table:t.table},transaction:p})}else{const o=z.ae({environment:e,table:v.vF,inMemoryRecordCache:t.inMemoryRecordCache,value:{...s.value,parent_id:t.id,parent_table:t.table,space_id:t.getSpaceId(),format:{app_config_uri:s.uri,app_uri_map:Object.fromEntries(Object.keys(s.value.schema??{}).filter((e=>e.startsWith("notion://"))).map((e=>[e,e]))),...s.value.format},alive:!0},transaction:p});i[s.uri]=o.id;const r=oe.NW.createChildStore(t,o.pointer);K.zz({collectionViewBlockStore:t,collectionStore:r,transaction:p})}}else if("sub_external_collection"===s.type){const t=te.Z.getIntegrationsAsRecordMap().getValue({table:_.K2,id:s.integrationId});if(!t||!(0,m.VM)(t))throw new Error("Invalid integration");const r=_e(o,s.parentCollectionUri,i);if(!r)throw new Error("Unable to find parent collection store");const n=r.getDeletedSchema()[s.relationUri];if(n&&(0,l.NK)(n)&&n.collection_pointer){i[s.uri]=n.collection_pointer.id;continue}const a=R.c({environment:e,pattern:s.pattern,integration:t,parentCollectionStore:r,transaction:p});i[s.uri]=a.id}else if("property"===s.type)Se({environment:e,appConfig:a,appParentStore:o,dependency:s,uriMap:i,transaction:p});else if("collection_view"===s.type){const t="block"===o.table&&o.getFormat().app_config_uri===s.collectionViewBlockUri?o:ye(o,s.collectionViewBlockUri,i);if(!t)throw new Error("View's home block not found");const r=i[s.uri];if(r){const e=oe.Xr.createChildStore(o,{table:S.np,id:r,spaceId:y});z.sW({store:e,data:{alive:!0,parent_id:t.id,parent_table:t.table},transaction:p}),E.R3({parent:t.getCollectionViewsStore(),append:e,transaction:p})}else{var C,h,P,B,A,T,U,M,F,x,W,O,N,j;const r=_e(o,s.collectionUri,i);if(!r)throw new Error("View source collection not found");const a=r.getPropertyMapping(),l=ke(null===(C=s.value.format)||void 0===C?void 0:C.collection_group_by,r),u=ke(null===(h=s.value.format)||void 0===h?void 0:h.board_columns_by,r),m=he(null===(P=s.value.format)||void 0===P?void 0:P.board_columns,r),f=null==a?void 0:a[n.Es.SubTaskRelation],v=null==a?void 0:a[n.Es.BlockingRelation],_=s.value.type,g=_?(0,d.oz)(_):void 0,b=g?null===(B=s.value.format)||void 0===B?void 0:B[g]:void 0,w=g?{[g]:he(b,r)}:{},k=he(null===(A=s.value.format)||void 0===A?void 0:A.board_properties,r),R=he(null===(T=s.value.format)||void 0===T?void 0:T.table_properties,r);if(f&&!(0,Q.Av)(_)&&g){var q;const e=null===(q=w[g])||void 0===q?void 0:q.findIndex((e=>e.property===f)),t=w[g];t&&(!e||e<0?t.push({property:f,visible:!0}):t[e].visible=!0)}const D={...s.value.format,collection_group_by:l,board_columns_by:u,board_columns:m,board_properties:k,table_properties:R,property_filters:null===(U=s.value.format)||void 0===U||null===(U=U.property_filters)||void 0===U?void 0:U.map((e=>{let{id:t,filter:o}=e;const{filter:n}=o;if("relation_contains"===n.operator){const e=(Array.isArray(n.value)?n.value:[n.value]).map((e=>{const t=e.type;if("relative"===t)return e;if("exact"===t){const t=e.value,o=t&&i[t];return o?{...e,value:o}:e}(0,I.t1)(t)}));return{id:t,filter:Ve({property:o.property,filter:{operator:n.operator,value:e}},r)}}return{id:t,filter:Ve(o,r)}})),collection_groups:null===(M=s.value.format)||void 0===M||null===(M=M.collection_groups)||void 0===M?void 0:M.map((e=>"relation"===e.value.type&&e.value.value&&!(0,c.t2)(e.value.value)&&i[e.value.value.id]?{...e,value:{type:"relation",value:{id:i[e.value.value.id],table:"block",spaceId:r.getSpaceId()}}}:e)),...w,table_subitem_toggle_column:"title",...v?{timeline_arrows_by:{property:v}}:{}},G=V.oA(null===(F=s.value.page_sort)||void 0===F?void 0:F.map((e=>i[e]))),H=null===(x=s.value.query2)||void 0===x||null===(x=x.aggregations)||void 0===x?void 0:x.map((e=>e.property?{...e,property:(null==a?void 0:a[e.property])??e.property}:e)),K=he(null===(W=s.value.query2)||void 0===W?void 0:W.sort,r),X=null===(O=s.value.query2)||void 0===O?void 0:O.timeline_by,$=X?r.getMappedProperty(X):void 0,Y=null===(N=s.value.query2)||void 0===N?void 0:N.calendar_by,Z=Y?r.getMappedProperty(Y):void 0,J=null===(j=s.value.query2)||void 0===j?void 0:j.filter,L=J?(0,ne.RN)(J,a):void 0,ee=z.ae({environment:e,table:S.np,inMemoryRecordCache:o.inMemoryRecordCache,value:{...s.value,parent_id:t.id,parent_table:t.table,space_id:y,format:{...D,app_config_uri:s.uri,collection_pointer:r.pointer},query2:{...s.value.query2,filter:L,aggregations:H,sort:K,timeline_by:$,calendar_by:Z},page_sort:G,alive:!0},transaction:p});i[s.uri]=ee.id;const te=oe.Xr.createChildStore(t,ee.pointer);E.R3({parent:t.getCollectionViewsStore(),append:te,transaction:p})}}else if("database_template"===s.type){const t=_e(o,s.collectionUri,i);if(!t)throw new Error("Collection not found");const r=t.getTemplatePagesStore(),n=i[s.uri];if(n){const e=oe.G.createChildStore(t,{table:f.iU,id:n,spaceId:t.getSpaceId()});z.sW({store:e,data:{alive:!0,parent_id:t.id,parent_table:t.table,is_template:!0},transaction:p}),E.R3({parent:r,append:e,transaction:p}),s.isDefault&&D.FH({stores:[t],update:{collection_default_template:{template_page_id:e.id}},transaction:p})}else{const n=z.j4({environment:e,inMemoryRecordCache:o.inMemoryRecordCache,type:s.blockValue.type,spaceId:t.getSpaceId(),properties:s.blockValue.properties,format:{...s.blockValue.format,app_config_uri:s.uri},transaction:p,useCrdt:(0,Y.S9)("app_template")});z.sW({store:n,data:{parent_id:t.id,parent_table:t.table,alive:!0,is_template:!0},transaction:p}),i[s.uri]=n.id,E.R3({parent:r,append:n,transaction:p}),s.isDefault&&D.FH({stores:[t],update:{collection_default_template:{template_page_id:n.id}},transaction:p})}}else"block"===s.type?ve(e,o,s,i,p):"page_template"===s.type||(0,I.t1)(s);!function(e,t,o,r,n){for(const i of o){const o=ye(t,i.uri,r),a=null==o?void 0:o.getParentStore();if(!o||!a||"collection"!==a.table||!i.blockValue.properties)continue;const c={};Object.entries(i.blockValue.properties).forEach((o=>{var n,i;let[l,p]=o;if("relation"===(null===(n=a.getSchema()[l])||void 0===n?void 0:n.type)){const e=(0,s.rq)(p),o=V.oA(e.map((e=>{const o=r[e.id];if(o)return{table:f.iU,id:o,spaceId:t.table===g.bx?t.id:t.getSpaceId()}}))),n=(0,s.ow)(o);c[l]=n}else"person"===(null===(i=a.getSchema()[l])||void 0===i?void 0:i.type)&&e.currentUser.id?c[l]=(0,s.C1)([{table:b.KJ,id:e.currentUser.id}]):c[l]=p})),$.b({environment:e,editorMode:"default",store:o,properties:c,transaction:n})}}(e,o,r.filter((e=>{let{type:t}=e;return"block"===t})),i,p)}(t,o,r,h,A,w,u),h.map((e=>{if("collection_view_block"===e.type){const t=ye(r,e.uri,A);t&&function(e,t,o){const r=e.getCollectionViewStores().map((e=>{const o=e.getFormat().app_config_uri;let r=o?null==t?void 0:t.indexOf(o):null==t?void 0:t.length;return void 0!==r&&-1!==r||(r=null==t?void 0:t.length),{viewStore:e,order:r}})),n=V.MR(r,(e=>e.order)).map((e=>e.viewStore.id));z.sW({store:e,data:{view_ids:n},transaction:o})}(t,e.defaultViewsOrder||[],u)}}));const T=V.oA(V.jj(V.oA(h.map((e=>{if("collection_view_block"===e.type)return e.uri;if("collection"===e.type||"collection_view"===e.type){const t=(0,ne.TD)([e.collectionViewBlockUri],w);if(t&&t.length&&"collection_view_block"===t[0].type)return e.collectionViewBlockUri}}))))),U=V.oA(T.map((e=>ye(r,e,A))));if("create"===y&&e.initializeStore){const t=e.initializeStore.getPermissionItemsStore().getValue();t&&U.forEach((e=>{z.sW({store:e,data:{permissions:t},transaction:u})}))}const M="create"===y?V.oA([e.initializeStore]):e.appCollectionViewBlockStores,F=U.filter((e=>void 0===M.find((t=>t.id===e.id))));if(M.length>0&&F.length>0){const e=M[M.length-1],t=fe(o,r,e);t&&F.forEach(((o,r)=>{E.HP({parent:t,current:o,after:0===r?e:F[r-1],transaction:u})}))}const x=C||(0,B.ZP)();return function(e,t,o,r,n){e.forEach((e=>{const i=e.getFormat().app_config_uri;if(i){var a;const c=(0,ne.$Q)(new Set([i]),t),l={};c.forEach((e=>{o[e.uri]&&(l[e.uri]=o[e.uri])})),l[i]=o[i],D.FH({stores:[e],update:{app_uri_map:{...(null===(a=e.getFormat())||void 0===a?void 0:a.app_uri_map)||{},...l},app_id:r},transaction:n})}}))}(U,h,A,x,u),U}function me(e){const{environment:t,dependencies:o,appCollectionViewBlockStores:r,from:n}=e,i=function(e){return e.filter((t=>{if("collection"===t.type){return Boolean(e.find((e=>"collection_view_block"===e.type&&e.uri===t.collectionViewBlockUri)))}if("property"===t.type||"collection_view"===t.type||"collection_view_block"===t.type||"page_template"===t.type||"block"===t.type||"database_template"===t.type||"sub_external_collection"===t.type)return!0;(0,I.t1)(t)}))}(o),a=Object.assign({},...V.oA(r.map((e=>{var t;return null===(t=e.getFormat())||void 0===t?void 0:t.app_uri_map}))));H.createAndCommit({userAction:"appTemplateActions.removeDependencies",environment:t,perform:e=>{!function(e){const{environment:t,appCollectionViewBlockStores:o,dependenciesToRemove:r,completeUriMap:n,transaction:i}=e,a=[...r.filter((e=>{let{type:t}=e;return"collection_view"===t})),...r.filter((e=>{let{type:t}=e;return"block"===t})),...r.filter((e=>{let{type:t}=e;return"database_template"===t})),...r.filter((e=>{let{type:t}=e;return"page_template"===t})),...r.filter((e=>{let{type:t}=e;return"property"===t})),...r.filter((e=>{let{type:t}=e;return"sub_external_collection"===t})),...r.filter((e=>{let{type:t}=e;return"collection"===t})),...r.filter((e=>{let{type:t}=e;return"collection_view_block"===t}))];for(const l of a)if("collection_view_block"===l.type){const e=o.find((e=>{var t;return(null===(t=e.getFormat())||void 0===t?void 0:t.app_config_uri)===l.uri}));e&&i.postSubmitCallbacks.push((o=>{o||U.deleteBlocks(t,{blocks:[{id:e.id,spaceId:e.getSpaceId()}],permanentlyDelete:!0})}))}else if("collection"===l.type){const e=o.find((e=>{var t;return(null===(t=e.getFormat())||void 0===t?void 0:t.app_config_uri)===l.collectionViewBlockUri}));if(e){const t=_e(e,l.uri,n);t&&K.A9({collectionViewBlockStore:e,collectionStore:t,transaction:i})}}else if("property"===l.type){const r=o.find((e=>{var t;return(null===(t=e.getCollectionStore())||void 0===t||null===(t=t.getFormat())||void 0===t?void 0:t.app_config_uri)===l.collectionUri}))??o[0],a=_e(r,l.collectionUri,n);if(a){let o;var c;if("relation"===l.propertySchema.type&&l.propertySchema.collection_pointer)o=_e(r,null===(c=l.propertySchema.collection_pointer)||void 0===c?void 0:c.id,n);F.E2({environment:t,collectionStore:a,schema:a.getSchema(),property:l.uri,transaction:i,targetCollectionStore:o}),A.y9(t,{property_type:l.propertySchema.type,from:e.from,property:l.uri,collection_id:a.id})}}else if("collection_view"===l.type){const e=n[l.uri];if(!e)throw new Error("Cannot delete view: id not found in map.");const t=o.find((e=>{var t;return(null===(t=e.getFormat())||void 0===t?void 0:t.app_config_uri)===l.collectionViewBlockUri}));if(t){const o=oe.Xr.createChildStore(t,{table:S.np,id:e,spaceId:t.getSpaceId()});K.dp({collectionViewBlockStore:t,collectionViewStore:o,transaction:i})}}else"page_template"===l.type||"block"===l.type||"database_template"===l.type||"sub_external_collection"===l.type||(0,I.t1)(l)}({environment:t,appCollectionViewBlockStores:r,dependenciesToRemove:i,completeUriMap:a,transaction:e,from:n})}})}function fe(e,t,o){if(t.table===y.e0)return t.getTeamPagesStore();if(t.table===g.bx){var r,n;if(null!==(r=e.getPrivatePagesStore().getValue())&&void 0!==r&&r.includes(o.id))return e.getPrivatePagesStore();if(null!==(n=e.getSharedPagesStore().getValue())&&void 0!==n&&n.includes(o.id))return e.getSharedPagesStore()}else{if(t.table===f.iU)return t.getContentStore();(0,I.t1)(t)}}function ve(e,t,o,r,n){let i=ye(t,o.uri,r);const a="collection"===o.parentType?_e(t,o.parentUri,r):ye(t,o.parentUri,r);if(!a)return{blockStore:i,parentStore:void 0};if(i)z.sW({store:i,data:{parent_id:a.id,parent_table:a.table,alive:!0},transaction:n});else{const c=t.table===g.bx?t.id:t.getSpaceId();if(!c)return;const l=z.j4({environment:e,type:o.blockValue.type,spaceId:c,format:{...o.blockValue.format,app_config_uri:o.uri},properties:o.blockValue.properties,inMemoryRecordCache:t.inMemoryRecordCache,transaction:n,useCrdt:a.table===f.iU?a.useCrdt():(0,Y.S9)("app_template")});z.sW({store:l,data:{parent_id:a.id,parent_table:a.table,alive:!0},transaction:n}),i=oe.G.createChildStore(a,l.pointer),r[o.uri]=l.pointer.id}return"block"===a.table?O.jG({parentStore:a,childStore:i,transaction:n}):"collection"===a.table?O.zw({parentStore:a,childStore:i,transaction:n}):(0,I.t1)(a),{blockStore:i,parentStore:a}}function Se(e){var t;const{environment:o,transaction:r,appParentStore:n,dependency:i,uriMap:a,appConfig:c}=e,s=_e(n,i.collectionUri,a);if(!s)throw new Error("Collection not found");let d=i.propertySchema;if("relation"===d.type){if(!d.collection_pointer)throw new Error("Invalid relation schema.");const e=_e(n,d.collection_pointer.id,a);if(!e)throw new Error("Relation target collection not found");const t=s.getDeletedSchema(),c=t[i.uri];if(i.isConnectedRelation&&i.integrationId===p.U9&&c&&(0,l.NK)(c)&&c.collection_pointer){const e=X.D8({deletedSchema:t,property:i.uri});if(!e)throw new Error("Deleted property schema was not found");K.xO({environment:o,collectionStore:s,update:e.updateSchema,transaction:r}),K.$N({collectionStore:s,update:e.updateDeletedSchema,transaction:r}),d={...d,collection_pointer:c.collection_pointer,collection_id:c.collection_pointer.id}}else d={...d,collection_pointer:null==e?void 0:e.pointer,collection_id:null==e?void 0:e.pointer.id}}else if("select"===d.type){const e=s.getSchema()[i.uri];if(e&&"select"===e.type){var u;const t=(0,ne.TD)([i.uri],c),o=V.xH(V.oA(t.map((e=>{var t;if("property"===e.type&&"select"===e.propertySchema.type)return null===(t=e.propertySchema.options)||void 0===t?void 0:t.map((e=>e.id))})))),r=(null===(u=e.options)||void 0===u?void 0:u.filter((e=>!o.includes(e.id))))||[];d={...d,options:[...d.options||[],...r]}}}else if("auto_increment_id"===d.type){const e=s.getSchema(),t=(0,I.qP)(e).find((e=>{var t;const o=e[0],r=null===(t=e[1])||void 0===t?void 0:t.type;return o&&r&&"auto_increment_id"===r}));if(t){var m;const e=t[0];return D.FH({stores:[s],update:{app_uri_map:{...null===(m=s.getFormat())||void 0===m?void 0:m.app_uri_map,[i.uri]:e}},transaction:r}),i.uri}}else if("text"===d.type)d.ai_inference&&d.ai_inference.auto_update_on_edit&&(d.ai_inference.auto_update_on_edit=(0,Z.k4)());else if("rollup"===d.type){if(!d.relation_property||!d.target_property)throw new Error("Invalid rollup schema.");const e=s.getSchema()[d.relation_property];if(!e||"relation"!==e.type||!e.collection_pointer)throw new Error("Invalid rollup schema.");const t=oe.NW.createChildStore(n,e.collection_pointer);if(!t)throw new Error("Relation target collection not found");const o=t.getMappedProperty(d.target_property);o&&(d.target_property=o)}K.xO({environment:o,collectionStore:s,update:{[i.uri]:d},transaction:r}),D.FH({stores:[s],update:{app_uri_map:{...null===(t=s.getFormat())||void 0===t?void 0:t.app_uri_map,[i.uri]:i.uri}},transaction:r})}function _e(e,t,o){return o[t]?oe.NW.createChildStore(e,{table:v.vF,id:o[t],spaceId:e.table===g.bx?e.id:e.getSpaceId()}):void 0}function ge(e,t,o,r,n,i){if(o.table!==f.iU)if(o.table===g.bx){if((null==t?void 0:t.getSpaceId())!==o.id)return;j.Hj({environment:e,spaceStore:o,spaceViewStore:t,pageStore:r,isPrivate:!0,transaction:n})}else o.table===y.e0?q.c0({teamStore:o,store:r,transaction:n,location:{type:i}}):(0,I.t1)(o)}function ye(e,t,o){return o[t]?oe.G.createChildStore(e,{table:f.iU,id:o[t],spaceId:e.table===g.bx?e.id:e.getSpaceId()}):void 0}function be(e){const{presetUri:t,environment:o,spaceViewStore:r,teamStore:n,from:i}=e,a=Date.now(),{serverCommitResult:c,performResult:l}=H.createAndCommit({userAction:`teamActions.createTypedDBsInTeam.${re.presetUriToHumanReadableName[t]}`,environment:o,perform:e=>{const a=(0,ne.iX)((0,re.appConfigs)(),t);if(!a)return;const c=pe({environment:o,spaceViewStore:r,appParentStore:n,appUri:a.uri,createOrModify:"create",transaction:e,presetUri:t,from:i});return ie.createSprintPage({environment:o,spaceViewStore:r,appParentStore:n,transaction:e,blockStores:c,creationEntryPoint:{type:"preset",presetUri:t}}),c&&T.bR(o,{created_block_stores:c,preset_uri:t,destination_team_id:n.id,from:i}),c}});return c.then((()=>{T.me(o,{from:i,preset_uri:t,time:Date.now()-a})})),l??[]}async function we(e){const{environment:t,presets:o,spaceStore:r,spaceViewStore:n,teamStore:i}=e,{isAndroid:a,ramSizeInGB:c}=t.device;if(a&&(!c||c<2)){const e=o.slice().reverse().map((e=>{const{serverCommitResult:o,performResult:a}=H.createAndCommit({environment:t,userAction:"AppsSetup.onContinueWithApps",perform:o=>{var a;const c=null===(a=(0,ne.iX)((0,re.appConfigs)(),e))||void 0===a?void 0:a.uri;if(!c)return;return se({environment:t,spaceViewStore:n,appUri:c,parentStore:(0,ee.bq)()?i:r,spaceId:r.id,transaction:o,presetUri:e})}});return{serverCommitResult:o,performResult:a}}));await Promise.all(e.map((e=>e.serverCommitResult)));return V.oA(V.xH(V.GY(e.map((e=>e.performResult)))))}{const{serverCommitResult:e,performResult:{collectionViewBlockStores:a}}=H.createAndCommit({environment:t,userAction:"AppsSetup.onContinueWithApps",perform:e=>{const a=V.xH(V.oA(o.slice().reverse().map((o=>{var a;const c=null===(a=(0,ne.iX)((0,re.appConfigs)(),o))||void 0===a?void 0:a.uri;if(!c)return;return se({environment:t,spaceViewStore:n,appUri:c,parentStore:(0,ee.bq)()?i:r,spaceId:r.id,transaction:e,presetUri:o})}))));return a.reverse(),{collectionViewBlockStores:a}}});return await e,a}}async function Ce(e){const{environment:t,spaceStore:o,spaceViewStore:r,teamStore:n,appendOrPrepend:i}=e;return await W.rC({environment:t,item:(0,C.G)(w.Y.teamWiki,L.default.getIntl()),isPrivate:!1,spaceStore:o,spaceViewStore:r,useMinimalTemplates:!0,teamStore:n,type:"inTeam",from:"sidebar_team_section",isOnboarding:!1,appendOrPrepend:i})}function ke(e,t){if(e)return Ve(e,t)}function he(e,t){if(e)return e.map((e=>Ve(e,t)))}function Ve(e,t){const o=t.getMappedProperty(e.property);return o?{...e,property:o}:e}},86095:(e,t,o)=>{o.r(t),o.d(t,{createSprintPage:()=>w});var r=o(92996),n=o(41432),i=o(21202),a=o(13493),c=o(75246),l=o(29369),s=o(9291),p=o(1898),d=o(94419),u=o(9953),m=o(28014),f=o(36821),v=o(150),S=o(75330),_=o(27105),g=o(33929),y=o(6258);const b=(0,s.defineMessages)({sprintBoard_0:{id:"appTemplatesSprintBoardActions.sprintBoard_0",defaultMessage:"Sprint board"}});function w(e){const{environment:t,spaceViewStore:o,appParentStore:s,transaction:w,blockStores:C,creationEntryPoint:k}=e;if("preset"===k.type&&k.presetUri!==r.tt)return;if(!C)return;const h=C.find((e=>e.getFormat().app_config_uri===r.NB)),V=C.find((e=>e.getFormat().app_config_uri===r.J1));if(!h||!V)return;f.Xx({environment:t,transaction:w,sprintsBlockStore:V,tasksBlockStore:h});return function(e){const{environment:t,spaceViewStore:o,appParentStore:s,transaction:f,tasksBlockStore:w,location:C}=e,k=s.table===c.bx?s.id:s.getSpaceId(),h=s.table===c.bx?s:s.getSpaceStore();if(!k||!h)return;const V=function(e){const{environment:t,appParentStore:o,tasksBlockStore:c,transaction:l,spaceId:s}=e,p=function(e){const{environment:t,appParentStore:o,transaction:r,spaceId:a}=e,c=u.j4({environment:t,type:n.Ti.collectionViewPage,spaceId:a,format:{page_icon:"/icons/run_lightgray.svg",special_page_for_pm_launch:"sprint_board"},properties:{title:[[g.default.formatMessage(b.sprintBoard_0)]]},inMemoryRecordCache:o.inMemoryRecordCache,transaction:r,useCrdt:o.table===i.iU?o.useCrdt():(0,_.S9)("app_template")});u.sW({store:c,data:{parent_id:o.id,parent_table:o.table,alive:!0},transaction:r});const l=y.G.createChildStore(o,c.pointer);return l}({environment:t,appParentStore:o,transaction:l,spaceId:s});return[r.g3,r.sV,r.y$].forEach((e=>{!function(e){var t;const{collectionViewBlock:o,tasksBlockStore:r,viewUri:n,spaceId:i,transaction:c}=e,l=r.getCollectionPointer(),s=null===(t=r.getFormat())||void 0===t||null===(t=t.app_uri_map)||void 0===t?void 0:t[n];if(!s)return;const p=y.Xr.createChildStore(o,{table:a.np,id:s,spaceId:i});l&&p&&function(e){const{viewStore:t,transaction:o,tasksCollectionPointer:r,viewBlockStore:n}=e,i=t.getName(),a=t.getPageSort(),c=t.getFormat(),l=t.getKeyStore("query2").getValue(),s=t.clone(),p=t.getType();u.sW({store:s,data:{name:i,type:p,page_sort:a,format:{...c,collection_pointer:r},query2:l,alive:!0,parent_id:n.id,parent_table:n.table},transaction:o}),d.R3({parent:n.getCollectionViewsStore(),append:s,transaction:o})}({viewStore:p,transaction:c,tasksCollectionPointer:l,viewBlockStore:o});S.dp({collectionViewBlockStore:r,collectionViewStore:p,transaction:c})}({collectionViewBlock:p,tasksBlockStore:c,viewUri:e,spaceId:s,transaction:l})})),p}({environment:t,appParentStore:s,tasksBlockStore:w,transaction:f,spaceId:k});return function(e,t,o,r,n,a){if(o.table===i.iU)"prepend"===a.type&&d.Ce({parent:o.getContentStore(),prepend:r,before:a.before,transaction:n});else if(o.table===c.bx){if(t.getSpaceId()!==o.id)return;m.Hj({environment:e,spaceStore:o,spaceViewStore:t,pageStore:r,isPrivate:!0,transaction:n,location:a})}else o.table===l.e0?v.c0({teamStore:o,store:r,transaction:n,location:a}):(0,p.t1)(o)}(t,o,s,V,f,C),V}({environment:t,spaceViewStore:o,appParentStore:s,transaction:w,tasksBlockStore:h,location:{type:"prepend",before:V.id}})}}}]);