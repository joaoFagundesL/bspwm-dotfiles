"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[3627],{81575:(t,o,e)=>{e.d(o,{AK:()=>_,Mc:()=>r,OS:()=>u,Td:()=>f,Uu:()=>c,XC:()=>s,ZK:()=>y,e8:()=>m,gV:()=>l,hc:()=>g,n0:()=>v,u0:()=>p,xi:()=>d});var n=e(97978),i=e(15010),a=e(35057);function r(t){n.j(t,"add_slack_integration")}function c(t){n.j(t,"remove_slack_integration")}function s(t,o){n.j(t,"slack_notification_create",o)}function d(t,o){n.j(t,"slack_notification_delete",o)}function u(t,o){n.j(t,"slack_notification_update",o)}function l(t,o){const e=a.zt(),r=i.JF();n.j(t,"slack_imports_invite_render_button",{subscription_tier:e,domain_type:r,origin:o.origin,invite_flow_id:o.invite_flow_id})}function m(t,o){const e=a.zt(),r=i.JF();n.j(t,"slack_imports_invite_render_invite_popup",{subscription_tier:e,domain_type:r,origin:o.origin,invite_flow_id:o.invite_flow_id})}function _(t,o){const e=a.zt(),r=i.JF();n.j(t,"slack_imports_invite_click_invite_button",{subscription_tier:e,domain_type:r,invited_user_count:o.invited_user_count,origin:o.origin,invite_token_query:o.inviteTokenQuery,invite_targets:o.inviteTargets,invite_flow_id:o.invite_flow_id})}function p(t,o){const e=a.zt(),r=i.JF();n.j(t,"slack_imports_invite_completed",{subscription_tier:e,domain_type:r,invited_user_count:o.invited_user_count,is_success:o.is_success,origin:o.origin,invite_flow_id:o.invite_flow_id,error:o.error,invite_stage:o.invite_stage})}function f(t,o){const e=a.zt(),r=i.JF();n.j(t,"slack_imports_invite_dismiss_popup",{subscription_tier:e,domain_type:r,origin:o.origin,invite_flow_id:o.invite_flow_id})}function g(t,o){const e=a.zt(),r=i.JF();n.j(t,"slack_imports_invite_click_select_all",{subscription_tier:e,domain_type:r,origin:o.origin,invite_flow_id:o.invite_flow_id,invited_user_count:o.invited_user_count,is_unselect:o.is_unselect,invite_token_query:o.invite_token_query})}function v(t,o){const e=a.zt(),r=i.JF();n.j(t,"slack_imports_invite_start_slack_integration",{subscription_tier:e,domain_type:r,origin:o.origin,invite_flow_id:o.invite_flow_id,from:o.from})}function y(t,o){const e=a.zt(),r=i.JF();n.j(t,"slack_imports_invite_complete_slack_integration",{subscription_tier:e,domain_type:r,origin:o.origin,invite_flow_id:o.invite_flow_id,from:o.from,is_success:o.is_success})}},43627:(t,o,e)=>{e.r(o),e.d(o,{addAutomationAction:()=>P,deleteAutomation:()=>z,disableAutomation:()=>J,duplicateAutomation:()=>$,duplicateAutomationAction:()=>B,enableAutomation:()=>U,insertEmptyTextInDuplicateBlockAction:()=>E,messages:()=>K,removeAutomationAction:()=>W,reorderAutomationActions:()=>V});e(21703);var n=e(59786),i=e(2647),a=e(76837),r=e(73110),c=e(76218),s=e(606),d=e(98963),u=e(18844),l=e(23867),m=e(70203),_=e(9291),p=e(53965),f=e(37850),g=e(7032),v=e(40470),y=e(1898),M=e(81575),S=e(54532),A=e(94419),k=e(19785),b=e(9953),w=e(24677),C=e(98104),h=e(13447),R=e(95477),T=e(27105),I=e(97978),j=e(49117),x=e(73959);const K=(0,_.defineMessages)({genericErrorMessage:{id:"automations.buttonTrigger.genericErrorMessage",defaultMessage:"Button failed to execute"},open:{defaultMessage:"Open",id:"automations.buttonTrigger.open"},undo:{defaultMessage:"Undo",id:"automations.buttonTrigger.undo"},defaultConfirmationWorkflowText:{defaultMessage:"Are you sure you want to continue?",id:"automations.buttonTrigger.defaultConfirmationWorkflowText"},defaultContinueWorkflowMessage:{defaultMessage:"Continue",id:"automations.buttonTrigger.defaultContinueWorkflowMessage"},defaultStopWorkflowMessage:{defaultMessage:"Cancel",id:"automations.buttonTrigger.defaultStopWorkflowMessage"},errorQueryCollectionTooManyPages:{defaultMessage:"Button impacts too many pages",id:"automations.buttonTrigger.errorQueryCollectionTooManyPages"},errorUserCancelled:{defaultMessage:"Button was cancelled",id:"automations.buttonTrigger.errorUserCancelled"}});function P(t){const{actionId:o,environment:e,intl:n,automationStore:a,actionType:r,transaction:c,insertionPoint:s,config:l,createDuplicateBlocksContainer:_=!0}=t,p=a.getSpaceId();if(!p)return;let f;"duplicate_blocks"===r&&_&&(f=b.j4({environment:e,inMemoryRecordCache:a.inMemoryRecordCache,transaction:c,type:"text",useCrdt:T.dy({source:"automation_action"})}));const g=l??function(t){const{actionType:o,intl:e}=t;if("modal_confirmation"===o)return{continue_button:{text:e.formatMessage(K.defaultContinueWorkflowMessage)},cancel_button:{text:e.formatMessage(K.defaultStopWorkflowMessage)},text:{type:"simple",value:(0,m.TPx)(e.formatMessage(K.defaultConfirmationWorkflowText))}};if("assistant"===o)return{type:"prompt"}}({actionType:r,intl:n})??{},v=b.ae({environment:e,inMemoryRecordCache:a.inMemoryRecordCache,table:u.Xj,transaction:c,value:{id:o,type:r,parent_id:a.id,parent_table:d.cv,alive:!0,space_id:p,config:g,blocks:f?[f.id]:[]}});f&&A.R3({transaction:c,parent:v.getKeyStore("blocks"),append:f}),!s||"afterActionId"in s?A.R3({transaction:c,parent:a.getActionIdsStore(),append:v,after:null==s?void 0:s.afterActionId}):"beforeActionId"in s?A.Ce({transaction:c,parent:a.getActionIdsStore(),prepend:v,before:s.beforeActionId}):(0,y.t1)(s);const M=v.getModel();if((0,y.$K)(M)){const t=(0,I.mc)(e),o=(0,i.Bj)({automationActionModel:M,getRecordModel:v.getRecordModel});(0,i.A2)(t,{automation_action:o,automation_action_id:M.id,automation_id:M.parent_id}),(0,i.eI)(t,{automation_action_id:M.id,automation_action_type:M.type,automation_id:a.id})}return v}function $(t){const{actorPointer:o,environment:e,includeParenting:n,sourceAutomationStore:i,targetAutomationId:r,transaction:c}=t,s=i.getParentStore();if(!s||!s.isReady())throw new Error("Automation parent store not ready");const u=i.getValue(),l=i.getSpaceId();if(!(0,y.$K)(u)||!(0,y.$K)(l))throw new Error("Undefined automation value or space id");const m={},_={...(0,p.Xh)(u),id:r??(0,g.ZP)()};m[i.id]=_.id,(0,y.$K)(_.action_ids)&&(0,y.Of)(_.action_ids)&&_.action_ids.forEach((t=>m[t]=(0,g.ZP)()));const v=t=>{let{requested:o}=t;const e=m[o.id];return(0,y.$K)(e)?{...o,id:e}:o};(0,a.J_)({actor:o,duplicateRecord:_,options:{},mapper:v,originalRecord:u});const M=b.ae({environment:e,inMemoryRecordCache:i.inMemoryRecordCache,table:d.cv,transaction:c,value:_});n&&k.jG({childStore:M,parentStore:s,transaction:c});const S=i.getActionStores(),A=f.Lc(S,10,(t=>{const o=m[t.id],{automationActionStore:n,onComplete:i}=B({environment:e,includeParenting:!1,mapper:v,sourceActionStore:t,targetAutomationActionId:o,transaction:c});return k.jG({childStore:n,parentStore:M,transaction:c}),i})),w=A.then((t=>t.flat()));return{automationStore:M,onComplete:w}}function B(t){const{environment:o,includeParenting:e,insertionPoint:n,mapper:r,sourceActionStore:c,targetAutomationActionId:s,transaction:d}=t,m=c.getParentStore();if(!m||!m.isReady())throw new Error("Automation store is not ready");const _=c.getValue(),v=c.getSpaceId();if(!(0,y.$K)(_)||!(0,y.$K)(v))throw new Error("Undefined action value or space id");const M={...(0,p.Xh)(_),id:s??(0,g.ZP)()},A=o.currentUser.id,w=c.inMemoryRecordCache.makeGetRecordRoleFn(A);(0,a.XJ)({duplicateRecord:M,getRecordRole:w,originalRecord:_,mapper:t=>(null==r?void 0:r(t))??t.requested,options:{},originOptions:{baseUrl:R.default.domainBaseUrl,publicDomainName:R.default.publicDomainName}});const C=b.ae({environment:o,inMemoryRecordCache:c.inMemoryRecordCache,table:u.Xj,transaction:d,value:M});e&&(!n||"afterActionId"in n?k.jG({after:null==n?void 0:n.afterActionId,childStore:C,parentStore:m,transaction:d}):"beforeActionId"in n?k.SH({before:null==n?void 0:n.beforeActionId,childStore:C,parentStore:m,transaction:d}):(0,y.t1)(n));const h=f.Lc(c.getBlockStores(),10,(t=>{const[e,n]=S.Qi({addCopyName:!1,baseUrl:R.default.domainBaseUrl,deepCopyTransclusionContainers:!1,environment:o,preferDuplicateLocation:"local",publicDomainName:R.default.publicDomainName,resolveTemplateVariables:!1,stores:[t],targetSpaceId:(0,l.C)(t.pointer.spaceId),transaction:d,useCrdt:T.dy({source:"automation_action"})}),i=e[0];return k.jG({childStore:i,parentStore:C,transaction:d}),n})),j=C.getModel();if((0,y.$K)(j)){const t=(0,I.mc)(o),e=(0,i.Bj)({automationActionModel:j,getRecordModel:C.getRecordModel});(0,i.A2)(t,{automation_action:e,automation_action_id:j.id,automation_id:j.parent_id,from:"duplicate"}),(0,i.eI)(t,{automation_action_id:j.id,automation_action_type:j.type,automation_id:m.id,from:"duplicate"})}return{automationActionStore:C,onComplete:h}}function V(t){const{clientContext:o,transaction:e,newActionIds:n}=t,{automationStore:i}=o,a=i.getValue();if(!a)return;b.sW({store:i,transaction:e,data:{action_ids:n}});F({clientContext:o,transaction:e,automationValue:{...a,action_ids:n}})}function W(t){var o;const{clientContext:e,actionStore:n,environment:i,transaction:a}=t,r=e.automationStore.getValue();if(!r)return;O({automationActionStore:n,environment:i,transaction:a});F({clientContext:e,transaction:a,automationValue:{...r,action_ids:null===(o=r.action_ids)||void 0===o?void 0:o.filter((t=>t!==n.id))}})}function F(t){const{clientContext:o,automationValue:e,transaction:i}=t,a=o.automationStore.getSpaceId();if(!a)return;const s=(0,j.pt)({context:o,automationValue:e});if(!v.x.isFail(s))for(const d of e.action_ids??[]){const t=o.automationStore.getRecordStore(o.automationStore,{table:u.Xj,id:d,spaceId:a});if(!t.isDefined())continue;const e=t.getModel(),l=new Set(s.value.actionInputValueTypes[d].map((t=>{if(t.kind===r.yp.Binding||t.kind===r.yp.ContextValue)return t.id;t.kind!==r.yp.ThisRow&&(0,y.t1)(t)})).filter(y.$K)),m=(0,n.z)(e.getType()).acceptFormulaVisitor({action:e,visitor:{visitVariableOutsideOfFormula:t=>l.has(t)?{type:"keep"}:{type:"replace",value:void 0},visitFormula:t=>t.value&&(0,c.UB)(t).some((t=>!l.has(t)))?{type:"replace",value:void 0}:{type:"keep"}}});for(const o of m)h.applyOperation({store:t,operation:o,transaction:i})}}function E(t){var o;const{environment:e,parentStore:n,transaction:i}=t,a=b.j4({environment:e,type:"text",inMemoryRecordCache:n.inMemoryRecordCache,transaction:i,spaceId:n.pointer.spaceId,useCrdt:(null===(o=(0,x.sQ)(n))||void 0===o?void 0:o.useCrdt())??!1}),r=A.R3({parent:n,append:a,transaction:i}).child;w.eP({environment:e,store:r});const c=r.getBlockTitleStore();C.N_({store:c})}function U(t){const{automationStore:o,environment:e,transaction:n}=t;b.sW({store:o,data:{status:"active"},transaction:n});const a=o.getModel();if((0,y.$K)(a)){const t=(0,I.mc)(e),n=(0,i.TY)({automationModel:a,getRecordModel:o.getRecordModel});(0,i.Rt)(t,n)}}function J(t){const{automationStore:o,environment:e,status:n,transaction:a}=t,r=n??"disabled";b.sW({store:o,data:{status:r},transaction:a}),o.isTriggerType("recurrence")&&b.sW({store:o,data:{run_at:void 0},transaction:a});const c=o.getModel();if((0,y.$K)(c)){const t=(0,I.mc)(e),n=(0,i.TY)({automationModel:c,getRecordModel:o.getRecordModel});(0,i.ai)(t,n)}}function z(t){const{automationStore:o,environment:e,transaction:n}=t;b.sW({store:o,data:{alive:!1},transaction:n});const a=o.getActionStores();for(const i of a)O({automationActionStore:i,automationStore:o,environment:e,transaction:n});const r=o.getModel();if((0,y.$K)(r)){const t=(0,I.mc)(e),n=(0,i.TY)({automationModel:r,getRecordModel:o.getRecordModel});(0,i.uO)(t,n),r.isNotificationType()&&M.xi(e,{type:"granular",source:"collection_view_settings",collection_id:r.parent_id})}}function O(t){const{automationActionStore:o,automationStore:e,environment:n,transaction:a}=t;let r=o.getParentStore();if((0,y.$K)(e)){const t=o.getParentPointer();if(!(0,y.$K)(t))throw new Error("Automation action does not have a parent pointer");if(!s.dr.isEqual(t,e.pointer))throw new Error(`Automation action parent pointer does not match argument: ${s.dr.toKey(t)}, ${s.dr.toKey(e.pointer)}`);r=e}else if(!(0,y.$K)(r))throw new Error("Automation store is undefined");k.hr({childStore:o,parentStore:r,transaction:a});const c=o.getBlockStores();for(const i of c)k.hr({childStore:i,parentStore:o,transaction:a});const d=o.getModel();if((0,y.$K)(d)){const t=(0,I.mc)(n),e=(0,i.Bj)({automationActionModel:d,getRecordModel:o.getRecordModel});(0,i.OK)(t,{automation_action:e,automation_action_id:d.id,automation_id:d.parent_id}),(0,i.co)(t,{automation_action_id:d.id,automation_action_type:d.type,automation_id:r.id})}}}}]);