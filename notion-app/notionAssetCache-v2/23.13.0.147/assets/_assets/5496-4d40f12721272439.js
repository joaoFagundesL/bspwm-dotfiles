"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[5496],{79698:(e,t,o)=>{o.d(t,{j:()=>p});var i=o(9291),n=o(23728),r=o(14542),a=o(96809),s=o(47307),l=o(96802),d=o(27153),c=o(13447),g=o(53471);const u=1500,m=(0,i.defineMessages)({pageCover:{defaultMessage:"Page cover",id:"pageCover.title"},fileTypeCaption:{defaultMessage:"Images wider than {idealImageWidth} pixels work best.",id:"pageCover.fileType.caption"},uploadFailed:{defaultMessage:"Upload failed",id:"pageCover.errorDialogMessage.uploadFailed"},embedTitle:{defaultMessage:"Link",id:"pageCover.embedType.title"},embedPlaceholder:{defaultMessage:"Paste an image link…",id:"pageCover.embedType.placeholder"},embedCaption:{defaultMessage:"Works with any image from the web.",id:"pageCover.embedType.caption"},embedSubmit:{defaultMessage:"Submit",id:"pageCover.embedType.buttonText"}});function p(e){let{environment:t,intl:o,store:i,rect:r}=e;d.$(t,{originGap:3,originRect:r,isSmallWidth:!1,popupWidth:540,maxHeight:485,title:o.formatMessage(m.pageCover),onDelete:()=>{!function(e){let{environment:t,store:o}=e;d.Z();const{serverCommitResult:i}=c.createAndCommit({userAction:"PageCover.handleDelete",environment:t,perform:e=>{l.MF({store:o,transaction:e})}});i.then((()=>n.P({store:o,environment:t})))}({environment:t,store:i})},currentTab:"gallery",tabs:[{type:"gallery",onChange:e=>{let{url:o,position:n}=e;f({environment:t,store:i,url:o,position:n})}},{type:"file",fileUpload:!1,imageUpload:!0,videoUpload:!1,caption:o.formatMessage(m.fileTypeCaption,{idealImageWidth:u}),onUpload:e=>{d.Z(),g.cT({environment:t,file:e,bucket:"secure",record:i.pointer,onStart:v,onProgress:b,onComplete:e=>{var o;o={environment:t,store:i,url:e},h({...o,position:.5})},onError:()=>{s.showErrorMessage(o.formatMessage(m.uploadFailed))}})}},{type:"embed",title:o.formatMessage(m.embedTitle),inputPlaceholder:o.formatMessage(m.embedPlaceholder),caption:o.formatMessage(m.embedCaption),buttonText:o.formatMessage(m.embedSubmit),onChange:e=>{var o;o={environment:t,store:i,url:e},h({...o,position:.5}),d.Z()}},{type:"unsplash",onChange:e=>{let{url:o,position:n}=e;f({environment:t,store:i,url:o,position:n})}}]})}async function h(e){const{environment:t,store:o,url:i,position:s}=e,{serverCommitResult:d}=c.createAndCommit({userAction:"PageCover.updatePageCover",environment:t,perform:e=>{l.fs({store:o,url:i,position:s||.5,transaction:e})}});await d,a.Z.state.loadingMode===r.NS&&a.Z.setState({loadingMode:r.EP,dataURL:a.Z.state.dataURL,uploadProgress:100}),n.P({store:o,environment:t})}function f(e){h(e),e.environment.device.isMobile&&d.Z()}function v(e){const{file:t,name:o,size:i}=e;if(d.Z(),a.Z.setState({loadingMode:r.SS,file:t,name:o,size:i}),t.type.indexOf("image")>=0){const e=new FileReader;e.onload=e=>{a.Z.state.loadingMode===r.SS&&a.Z.setState({...a.Z.state,uploadProgress:0,loadingMode:r.NS,dataURL:e.target.result})},e.readAsDataURL(t)}}function b(e){const{progressPercent:t}=e;a.Z.state.loadingMode===r.NS&&a.Z.setState({...a.Z.state,uploadProgress:t})}},23728:(e,t,o)=>{o.d(t,{P:()=>Z});var i=o(13991),n=o(17755),r=o(22808),a=o(70203),s=o(9291),l=o(97466),d=o(31701),c=o(53965),g=o(37810),u=o(95477),m=o(33929),p=o(9339),h=o(77080),f=o(96802),v=o(13447),b=o(53471);const C=1200,y=(0,d.gh)({theme:"light"}),x=y.text.tertiary,S=(0,s.defineMessages)({builtWithNotion:{id:"socialMediaPreview.builtWithNotion",defaultMessage:"Built with Notion"}});function w(e){return new Promise(((t,o)=>{const i=new Image;i.onload=()=>t(i),i.onerror=o,i.src=e}))}function P(e){return`${g.Z.fontWeight.medium} 40px ${g.Z.getHeaderFontFamily({pageFont:e,locale:i.SP})}`}function M(e){let{context:t,text:o,font:i,color:n,x:r,y:a}=e;t.font=i,t.textAlign="left",t.textBaseline="top",t.fillStyle=n,t.fillText(o,r,a)}const Z=(0,c.Ds)((async e=>{var t,o;let{store:s,environment:d}=e;if(s.pathIsDead()||"on"!==h.default.getEligibleGroup({experimentId:"social_media_preview_image_uploader_enabled_2",defaultGroup:"unassigned"}))return;const Z=a.QaF(s.getTitleValue())||"",R=null===(t=s.getIcon())||void 0===t?void 0:t.icon,j=null===(o=s.getCover())||void 0===o?void 0:o.cover,k=s.getFormat(),F=new OffscreenCanvas(C,630),E=F.getContext("2d"),T=(I=k.page_font,`${g.Z.fontWeight.bold} 96px ${g.Z.getHeaderFontFamily({pageFont:I,locale:i.SP})}`);var I;const L=function(e,t){const o=document.createElement("div");o.style.width="auto",o.style.position="absolute",o.style.whiteSpace="nowrap",o.style.font=t,o.style.top="110vh",o.innerText=e;const i=document.body;if(i.appendChild(o),o.clientWidth<1e3)return i.removeChild(o),e;let n=e;for(;o.clientWidth>1e3;)n=n.substring(0,n.length-1),o.innerText=`${n}…`;return i.removeChild(o),`${n}…`}(Z,T);if(E){!function(e){e.fillStyle="white",e.fillRect(0,0,C,630)}(E),await async function(e){let{context:t,coverImageUrl:o,icon:i,coverPosition:n=.5}=e;if(o){const e=await w(o),i=.2*e.width,r=((0,c.hj)(n)?1-n:.5)*(e.height-i);t.drawImage(e,0,r,e.width,i,0,0,C,240)}else{const e=(0,p.O)({icon:i,theme:y}),o=e?(0,l.Fq)(e,.1):y.home.cards.coverPhoto.base;t.fillStyle=o,t.fillRect(0,0,C,240),t.fillStyle="rgb(0,0,0,1)"}}({context:E,coverImageUrl:j,icon:R,coverPosition:k.page_cover_position}),await async function(e){let{context:t,store:o,icon:i}=e;if(i)if((0,r.Z)(i))t.font='200px "Apple Color Emoji","Segoe UI Emoji",NotoColorEmoji,"Noto Color Emoji","Segoe UI Symbol","Android Emoji",EmojiSymbols',t.textAlign="left",t.textBaseline="top",t.fillText(i,96,150);else{const e=n.EK({url:i,baseUrl:u.default.domainBaseUrl,fullyQualified:!0,permissionRecord:o.pointer,width:184,userId:void 0}),r=await w(e);t.drawImage(r,100,145,184,184)}}({context:E,store:s,icon:R}),M({context:E,text:L,font:T,color:"black",x:100,y:R?370:347}),M({context:E,text:m.default.formatMessage(S.builtWithNotion),font:P(k.page_font),color:x,x:100,y:R?490:467});const e=await F.convertToBlob();!function(e){let{store:t,file:o,environment:i}=e;b.cT({environment:i,file:o,bucket:"secure",record:t.pointer,onComplete:e=>{v.createAndCommit({userAction:"SocialMediaPreviewImageUploadStore.updateSocialMediaPreviewImage",environment:i,perform:o=>{f.eO({store:t,url:e,transaction:o})}})},retryWhenOffline:!0})}({store:s,environment:d,file:new File([e],"SocialMediaPreviewImage.png",{type:"image/png"})})}}),5e3)},87636:(e,t,o)=>{o.d(t,{Z:()=>f});var i=o(67294),n=o(13991),r=o(480),a=o(24405),s=o(22491),l=o(1898),d=o(37810),c=o(17311),g=o(23063),u=o(64921),m=o(26388),p=o(85893);function h(e){const{button:t,isLast:o}=e,n=(0,a.yK)((e=>({button:{display:"flex",alignItems:"center",padding:"4px 6px",fontWeight:d.Z.fontWeight.medium,borderRight:`1px solid ${e.regularDividerColor}`,color:e.actionMenuButtonTextColor,fill:e.actionMenuButtonTextColor},buttonLast:{borderRight:"none"},buttonHovered:{background:e.whiteButtonHoveredBackground},buttonPressed:{background:e.whiteButtonPressedBackground}})),[]);return i.cloneElement(t,{...(0,s.iv)(t.props.style,n.button,o&&n.buttonLast),hoveredStyle:(0,s.iv)(n.buttonHovered,o&&n.buttonLast).style,pressedStyle:n.buttonPressed})}const f=function(e){let{children:t,isVisible:o,position:f,style:v}=e;const b=(0,r.O7)(),C=(0,a.yK)((e=>({container:{color:e.actionMenuButtonTextColor,fill:e.actionMenuButtonTextColor,fontSize:12,background:e.whiteButtonBackground,boxShadow:e.lightBoxShadow,display:"flex",whiteSpace:"nowrap",borderRadius:c.Z.borderRadius,maxWidth:"calc(100% - 16px)",minHeight:24,overflow:"hidden",pointerEvents:b.device.isMobile?"auto":"none",opacity:b.device.isMobile?1:0,fontFamily:d.Z.getCompositeFontFamily(n.SP).sans,position:"absolute",right:c.Z.horizontal.small,bottom:c.Z.vertical.small,zIndex:2},containerHover:{pointerEvents:"auto",opacity:1},containerTop:{top:c.Z.vertical.small,bottom:void 0}})),[b]),y=i.Children.toArray(t).filter(l.$K),x=y.length;return(0,p.jsx)(g.Z,{isVisible:!0,animationStyle:{opacity:o?1:0},render:()=>(0,p.jsx)("div",{...(0,s.iv)(C.container,v,o&&C.containerHover,"top"===f&&C.containerTop),children:y.map(((e,t)=>{const o=t===x-1;if(e&&"object"==typeof e&&"type"in e){if(e.type===m.ZP&&i.isValidElement(e))return i.cloneElement(e,{render:(t,i)=>{const n=e.props.render(t,i);return(0,p.jsx)(h,{isLast:o,button:n},e.key)}});if(e.type===u.Z&&i.isValidElement(e))return(0,p.jsx)(h,{isLast:o,button:e},e.key)}}))})})}},65496:(e,t,o)=>{o.d(t,{Z:()=>Z});var i=o(67294),n=o(480),r=o(86628),a=o(9291),s=o(96802),l=o(79698),d=o(23728),c=o(13447),g=o(28651),u=o(50627),m=o(14542),p=o(96809),h=o(87636),f=o(23063),v=o(64921),b=o(12981),C=o(65107),y=o(68785),x=o(32854),S=o(81865),w=o(27016),P=o(88940),M=o(85893);const Z=function(e){let{store:t,disabled:o,paddingRight:a,paddingLeft:l,height:u,proxyWidth:h}=e;const f=(0,n.O7)(),v=(0,r.qz)(void 0,g.Z),w=(0,r.VK)((()=>t.getCover()),[t]),Z=(0,r.VK)((()=>p.Z.state),[]),[k,F]=(0,i.useState)(void 0);if(!w)return null;const E=Z.loadingMode!==m.LU&&Z.loadingMode!==m.SS;return(0,M.jsx)(P.Z,{mouseStore:v,onFlushTemporaryPosition:e=>function(e,t,o){const{imagePosition:i,reset:n}=e,{serverCommitResult:r}=c.createAndCommit({userAction:"PageCover.handleFlushTemporaryPosition",environment:o,perform:e=>{s.Mp({store:t,coverPosition:i,transaction:e}),n()}});r.then((()=>d.P({store:t,environment:o})))}(e,t,f),renderControl:e=>{let{handleRepositionClick:i,handleSavePositionClick:n,handleCancelClick:r,isVisible:s,isRepositioning:d}=e;return(0,M.jsx)(j,{handleRepositionClick:i,handleSavePositionClick:n,handleCancelClick:r,isVisible:s,isRepositioning:d,lastProxiedUrl:k,store:t,disabled:o,paddingRight:a,paddingLeft:l,mouseStore:v})},source:"page",store:t,style:{display:"flex",flexDirection:"column",alignItems:"center",height:u,cursor:"default"},render:e=>(0,M.jsxs)(i.Fragment,{children:[(0,M.jsx)(S.Z,{url:w.cover,isAuthenticated:!0,permissionRecord:w.pointer,width:h,render:(t,o)=>{F(o);const i={width:"100%",height:u,objectFit:"cover",opacity:E?.5:1,objectPosition:`center ${100*(1-(e.imagePosition||0))}%`,borderRadius:0},n={width:"100%",height:u};return(0,M.jsx)(C.B,{src:o,placeholderSrc:E?Z.dataURL:void 0,placeholderBehavior:E?"force-show-placeholder":"show-placeholder-if-loading-src",containerStyle:n,imageStyle:i,onLoadComplete:R})}}),E&&(0,M.jsxs)("div",{style:b.I,children:[(0,M.jsx)(y.Z,{style:{width:16,height:16,marginRight:4}}),(0,M.jsx)("div",{style:{minWidth:30,textAlign:"right"},children:(0,M.jsx)(x.Z,{percentage:Z.uploadProgress})})]})]})})};function R(){p.Z.reset()}function j(e){let{isVisible:t,isRepositioning:o,handleCancelClick:s,handleRepositionClick:d,handleSavePositionClick:c,lastProxiedUrl:g,store:b,disabled:C,paddingRight:y,paddingLeft:x,mouseStore:S}=e;const P=(0,n.O7)(),Z=(0,a.useIntl)(),R=(0,i.useCallback)((e=>function(e,t,o,i,n){n.reset();const r=e.target.getBoundingClientRect();l.j({environment:t,intl:o,store:i,rect:r})}(e,P,Z,b,S)),[P,Z,b,S]),j=(0,r.VK)((()=>p.Z.state.loadingMode),[]),k=(0,r.VK)((()=>function(e){let t;return t=e.isFullWidth()?"100%":u.zL,t}(b)),[b]);if(C||j!==m.LU)return null;const{device:F}=P,{isMobile:E}=F;return(0,M.jsx)(f.Z,{isVisible:!0,animationStyle:{width:k,opacity:t?1:0},render:()=>(0,M.jsx)("div",{style:{position:"absolute",pointerEvents:t?"auto":"none",maxWidth:"100%",top:48},children:(0,M.jsxs)(h.Z,{isVisible:t,position:"bottom",style:{marginRight:y,marginLeft:x},children:[!o&&(0,M.jsx)(v.Z,{style:{borderRight:E?"none":void 0,...w.ar},onClick:R,children:(0,M.jsx)(a.FormattedMessage,{defaultMessage:"Change cover",id:"pageCover.changeCover.text"})}),!o&&!E&&(0,M.jsx)(v.Z,{style:{...w.ar,borderRight:"none"},onClick:e=>d(e,g),children:(0,M.jsx)(a.FormattedMessage,{defaultMessage:"Reposition",id:"pageCover.reposition.text"})}),o&&!E&&(0,M.jsx)(v.Z,{style:w.ar,onClick:c,children:(0,M.jsx)(a.FormattedMessage,{defaultMessage:"Save position",id:"pageCover.savePosition.text"})}),o&&!E&&(0,M.jsx)(v.Z,{style:{...w.ar,borderRight:"none"},onClick:s,children:(0,M.jsx)(a.FormattedMessage,{defaultMessage:"Cancel",id:"pageCover.reposition.cancelText"})})]})})})}},88940:(e,t,o)=>{o.d(t,{Z:()=>w});var i=o(67294),n=o(13991),r=o(480),a=o(6740),s=o(86628),l=o(24405),d=o(12137),c=o(22491),g=o(9291),u=o(31701),m=o(53965),p=o(37810),h=o(19584),f=o(24677),v=o(28651),b=o(27724),C=o(23063),y=o(6685),x=o(85893);const S={isRepositioning:!1};const w=function(e){const t=(0,i.useRef)(null),o=(0,r.O7)(),{isMobile:n}=(0,r.Fy)(),[g,u]=(0,i.useState)(S),p=(0,i.useCallback)((()=>{u(S)}),[]),{isRepositioning:C,image:w,startDragRenderedPosition:M,startDragImageScreenHeight:Z}=g,R=(0,s.VK)((()=>0===b.default.state.stores.length),[]),[j,k]=(0,i.useState)(!1),F=(0,s.qz)(e.mouseStore,v.Z),{style:E,onFlushTemporaryPosition:T}=e,I=(0,s.VK)((()=>F.state.mouseEntered),[F]),L=(0,l.yK)((()=>({dragContainer:{width:"100%",cursor:C?"move":"inherit"},container:{position:"relative",width:"100%"}})),[C]),D=(0,s.VK)((()=>{return t=e.source,o=e.store,i=g.temporaryPosition,(0,m.hj)(i)?i:function(e,t){if("gallery"===e||"board"===e){const e=t.getFormat().card_cover_position;if((0,m.hj)(e))return e}const o=.5;if(t.isCollectionView()){const e=t.getCollectionViewCollectionStore();if(e){const t=e.getFormat().collection_cover_position;return(0,h.z4)(t)?o:t}}const i=t.getFormat(),n=i.page_cover_position;return(0,m.hj)(n)?n:o}(t,o);var t,o,i}),[g.temporaryPosition,e.source,e.store]);(0,i.useEffect)((()=>{const o=o=>{const i=t.current;i&&!i.contains(o.target)&&C&&e.onFlushTemporaryPosition({imagePosition:D,reset:()=>{F.reset(),p()}})};return window.addEventListener("mousedown",o),()=>window.removeEventListener("mousedown",o)}),[D,C,F,e,p]),C&&!R&&p();const V=(0,i.useMemo)((()=>(0,m.P2)((e=>{F.setState({...F.state,mouseEntered:!0})}),100)),[F]),B=(0,i.useMemo)((()=>(0,m.Ds)((e=>{F.setState({...F.state,mouseEntered:!1})}),100)),[F]),U=(0,i.useCallback)(((e,t)=>{f.ZH(o);const i=new Image;i.onload=()=>{u((e=>({...e,isRepositioning:!0,image:i})))},t&&(i.src=t)}),[o]),W=(0,i.useCallback)((e=>{T({imagePosition:D,reset:()=>{p()}})}),[D,T,p]),_=(0,i.useCallback)((e=>{const t=e.target;void 0!==t&&t instanceof HTMLElement&&(0,a.E)(t)&&k(!0)}),[]),A=(0,i.useCallback)((()=>{k(!0)}),[]),H=(0,i.useCallback)((e=>{if(w&&C){const e=t.current;if(e&&e instanceof Element){const t=e.getBoundingClientRect().width/w.width*w.height;u((e=>({...e,startDragImageScreenHeight:t,startDragRenderedPosition:D})))}}}),[w,D,C]),K=(0,i.useCallback)((e=>{if(C){const t=e.diffY/(Z||0)+(M||0);u((e=>({...e,temporaryPosition:(0,m.NM)((0,d.Z)(t,0,1),4)})))}}),[C,Z,M]),N=(0,i.useCallback)((()=>{u((e=>({...e,startDragImageScreenHeight:void 0,startDragRenderedPosition:void 0})))}),[]),z=(0,s.VK)((()=>e.renderControl({handleRepositionClick:U,handleSavePositionClick:W,handleCancelClick:p,isVisible:n||I||j||C,isRepositioning:C})),[U,W,j,n,C,I,e,p]);return(0,x.jsxs)("div",{ref:t,onFocus:_,onBlur:A,onMouseEnter:V,onMouseMove:V,onMouseLeave:B,...(0,c.iv)(L.container,E),children:[(0,x.jsx)(y.Z,{onDraggableDragStart:H,onDraggableDragMove:K,onDraggableDragEnd:N,onDraggableDragCancel:N,disabled:!C,render:t=>(0,x.jsx)("div",{...(0,c.iv)(L.dragContainer),...t,children:e.render({imagePosition:D,isRepositioning:C})})}),(0,x.jsx)(P,{small:e.small,isRepositioning:C}),z]})};function P(e){let{small:t,isRepositioning:o}=e;if(t)return null;const i={background:u.ZP.blackWithAlpha(.4),borderRadius:4,color:u.ZP.white,fontSize:12,fontFamily:p.Z.getCompositeFontFamily(n.SP).sans,width:180,left:"calc(50% - 90px)",padding:"0.3em 1.5em 0.3em",pointerEvents:"none",position:"absolute",top:"calc(50% - 10px)",textAlign:"center"};return(0,x.jsx)(C.Z,{isVisible:!0,animationStyle:{opacity:o?1:0},render:()=>(0,x.jsx)("div",{style:i,"aria-hidden":!o,children:(0,x.jsx)(g.FormattedMessage,{defaultMessage:"Drag image to reposition",id:"withImageRepositioning.dragImage.text"})})})}},9339:(e,t,o)=>{o.d(t,{O:()=>s});var i=o(79362),n=o(22808),r=o(1898),a=o(24990);function s(e){let{icon:t,theme:o}=e;if(t)return(0,n.Z)(t)?a.Z.state.emojiByColorProcessed[t]:(0,i.V2)(t)?function(e){var t;let{uri:o,theme:n}=e;const r=null===(t=o.match(/\/icons\/[\w\-]*_(.+)\.svg/))||void 0===t?void 0:t[1];if(!function(e){if(!e)return!1;return l.has(e)}(r))return;return i.Lr[n.mode][r]}({uri:t,theme:o}):void 0}const l=new Set((0,r.Yd)(i.Lr.light))},14542:(e,t,o)=>{o.d(t,{EP:()=>a,LU:()=>s,NS:()=>r,SS:()=>n,ZP:()=>d});var i=o(49085);const n="loadingLocalImage",r="uploading",a="downloading",s="loaded";class l extends i.default{getInitialState(){return{loadingMode:s}}}const d=l},96809:(e,t,o)=>{o.d(t,{Z:()=>i});const i=new(o(14542).ZP)}}]);