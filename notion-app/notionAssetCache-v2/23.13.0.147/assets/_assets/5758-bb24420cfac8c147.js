"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[5758],{16287:(e,t,i)=>{i.d(t,{A:()=>d,h:()=>l});var n=i(53877),o=i(23867),s=i(53965),a=i(54642);const r=20;async function d(e,t){const{store:i,activityIds:n,spaceId:d,filterActivityTypes:l,filterDateRange:u,navigableBlockId:h,collectionId:p}=t,g=s.Ps(n),f=await a.getActivityLog(e,{spaceId:d,navigableBlock:h?{id:h,spaceId:(0,o.C)(void 0)}:void 0,collection:p?{id:p,spaceId:(0,o.C)(void 0)}:void 0,endingBeforeId:g,limit:r,activityTypes:l,...c(u)});if("failed"===f.type)throw f.error;const m=f.data.activityIds;i.update((e=>({...e,shouldLoadNewerActivities:!1,activityIds:m.concat(n)})))}async function l(e,t){const{store:i,activityIds:n,spaceId:d,filterActivityTypes:l,filterDateRange:u,navigableBlockId:h,collectionId:p}=t,g=s.Z$(n),f=await a.getActivityLog(e,{spaceId:d,navigableBlock:h?{id:h,spaceId:(0,o.C)(void 0)}:void 0,collection:p?{id:p,spaceId:(0,o.C)(void 0)}:void 0,startingAfterId:g,limit:r,activityTypes:l,...c(u)});if("failed"===f.type)throw f.error;const m=f.data.activityIds;i.update((e=>({...e,shouldLoadOlderActivities:!1,activityIds:n.concat(m),hasOlderActivities:m.length>0})))}function c(e){var t,i;const o=null!==(t=e.ending)&&void 0!==t&&t.start_date?n.OQ.isoToUnixMs(e.ending.start_date):void 0;return{startingAfterTimeMs:null!==(i=e.starting)&&void 0!==i&&i.start_date?n.OQ.isoToUnixMs(e.starting.start_date):void 0,endingBeforeTimeMs:o?n.Xz({date:o,daysToAdd:1}):void 0}}},84708:(e,t,i)=>{i.d(t,{Z:()=>W});var n=i(67294),o=i(83355),s=i(480),a=i(86628),r=i(24405),d=i(69651),l=i(72050),c=i(44615),u=i(70921),h=i(9291),p=i(53965),g=i(19584),f=i(16287),m=i(19719),y=i(23586),v=i(65598),b=i(95697),x=i(51811),S=i(77907),M=i(2688),C=i(5162),j=i(44904),k=i(80444),I=i(61766),A=i(88632),T=i(49085);class w extends T.default{getInitialState(){return{selectedItems:[]}}}const L=w;var _=i(4761),R=i(68785),N=i(43145),B=i(93481),O=i(52275),Z=i(255),P=i(8319),F=i(85893);const V=function(e){let{mode:t,title:i,onChange:o,disabled:s,focused:r,onMenuDismiss:d,items:l,addItemLabel:c,tokenInputPlaceholder:u,resultSectionTitle:h,componentDebugName:p,icon:g,getItemLabel:f,options:m,store:y}=e;const v=(0,a.qz)(y,L),b=(0,a.VK)((()=>v.state),[v]);return(0,n.useEffect)((()=>{v.setState({selectedItems:l})}),[l,v]),(0,F.jsx)(P.Z,{mode:t,hasItemsSelected:b.selectedItems.length>0,title:i,icon:g,items:l,onChange:e=>{o(e)},disabled:s,focused:r,renderFilter:(e,t)=>(0,F.jsx)(K,{getItemLabel:f,item:e,args:t}),renderToken:e=>(0,F.jsx)(U,{item:e}),renderItemForSummary:e=>(0,F.jsx)(z,{item:e}),addItemLabel:c,labelText:{title:i,tokenInputPlaceholder:u,resultSectionTitle:h,componentDebugName:p},performRequest:e=>function(e,t){let{query:i}=e;return Promise.resolve(t.filter((e=>e.includes(i))))}(e,m),renderResultMenuItem:(e,i)=>(0,F.jsx)(E,{getItemLabel:f,mode:t,store:v,item:e,props:i}),onMenuDismiss:d})};function z(e){let{item:t}=e;return(0,F.jsx)(F.Fragment,{children:`hello${t}`})}function U(e){let{item:t}=e;return(0,F.jsx)(F.Fragment,{children:t})}function K(e){let{item:t,args:i,getItemLabel:n}=e;const{disabled:o,onRemove:a,onClick:r}=i,d=function(e){return{menuItem:{minHeight:void 0,paddingTop:e.device.isMobile?12:4,paddingBottom:e.device.isMobile?12:4},menuItemTitle:{width:"100%"},labeledMenuItemTitle:{display:"inline-flex",alignItems:"center"},menuItemLabel:{marginRight:12},recordIcon:{marginRight:4}}}((0,s.O7)()),l=(0,F.jsx)(Z.Z,{disabled:o,onClick:a});return(0,F.jsx)(O.Z,{title:(null==n?void 0:n(t))||t,disabled:o,focused:!1,right:l,style:d.menuItem,desktopTitleStyle:d.menuItemTitle,onClick:r})}function E(e){let{item:t,props:i,getItemLabel:o,mode:s,store:r}=e;const d=(0,a.qz)(r,L),l=(0,a.VK)((()=>d.state.selectedItems),[d]);return(0,n.createElement)(O.Z,{...i,key:t,title:(null==o?void 0:o(t))||t,checkState:s===P.z.Pill&&l.includes(t)})}var D=i(70268);class H extends o.Z{constructor(){super(...arguments),this.searchListFilterStore=new L,this.storeTypes={activityUpdatesStore:j.o,filterPopupStore:I.Z},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_closeAddFilterMenu=()=>Q(this.stores.filterPopupStore),this.renderActivityTypeFilter=()=>{const{collectionId:e}=this.props,t=e=>(0,F.jsx)(F.Fragment,{children:(0,F.jsx)(V,{store:this.searchListFilterStore,focused:!1,icon:l.A,options:[...e].sort(),items:this.stores.activityUpdatesStore.state.filterActivityTypes,mode:P.z.Pill,title:(0,F.jsx)(h.FormattedMessage,{id:"activityUpdates.filterMenu.byType.title",defaultMessage:"Activity type"}),tokenInputPlaceholder:this.props.intl.formatMessage({id:"activityUpdates.filterMenu.byType.search",defaultMessage:"Search for a type"}),resultSectionTitle:this.props.intl.formatMessage({id:"activityUpdates.filterMenu.byType.resultSectionTitle",defaultMessage:"Activity Types"}),addItemLabel:this.props.intl.formatMessage({id:"activityUpdates.filterMenu.byType.addItemLabel",defaultMessage:"Add an activity type"}),componentDebugName:"ActivityUpdatesSearchEditTypesFilter",onChange:e=>ee((()=>this.stores.activityUpdatesStore.update((t=>({...t,filterActivityTypes:e,activityIds:[],hasOlderActivities:!0,shouldLoadOlderActivities:!0,shouldLoadNewerActivities:!1})))),this.environment,this.props.source,this.stores.activityUpdatesStore),onMenuDismiss:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_closeAddFilterMenu,getItemLabel:e=>e.split("-").map((e=>e.replace(/(^.)/,(e=>e.toUpperCase())))).join(" ")})});return t(e?u.Se:u.Py)},this.renderSearchFilters=()=>{const{currentUserStore:e,currentSpaceStore:t}=k.default.state;if(!e||!t)return;const i=this.stores.activityUpdatesStore.state.filterActivityTypes.length>0||this.stores.activityUpdatesStore.state.filterDateRange.ending||this.stores.activityUpdatesStore.state.filterDateRange.starting;return(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"row",padding:"12px 10px",width:"100%",gap:6},children:[this.renderActivityTypeFilter(),(0,F.jsx)(ie,{source:this.props.source,activityUpdatesStore:this.stores.activityUpdatesStore,filterPopupStore:this.stores.filterPopupStore}),i&&(0,F.jsx)(te,{source:this.props.source,activityUpdatesStore:this.stores.activityUpdatesStore})]})},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleActivityEmit=e=>{this.stores.activityUpdatesStore.update((e=>({...e,shouldLoadNewerActivities:!0})))},this.handleActivityEmitThrottled=p.P2(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleActivityEmit,1e3),this.handleNavigableBlockEmit=g.YX(this.handleActivityEmitThrottled),this.handleCollectionEmit=g.YX(this.handleActivityEmitThrottled),this.navigableBlockListenerReference=void 0,this.collectionListenerReference=void 0}UNSAFE_willMount(){this.startMessageListeners()}willUnmount(){this.stopMessageListeners()}renderComponent(){return A.Z.state.online?this.renderOnline():(0,F.jsx)(Y,{})}renderOnline(){const{spaceId:e,navigableBlock:t,collectionId:i,source:n}=this.props,{currentUserStore:o,currentSpaceStore:s}=k.default.state;if(!o||!s)return;const a=s,{shouldLoadOlderActivities:r,shouldLoadNewerActivities:d,filterActivityTypes:l,filterDateRange:c,activityIds:u,hasOlderActivities:g}=this.stores.activityUpdatesStore.state,m=o.id,M=null==t?void 0:t.id;return(0,F.jsx)(y.Z,{throttle:1e3,request:{spaceId:e,navigableBlockId:M,collectionId:i,shouldLoadOlderActivities:r,shouldLoadNewerActivities:d,filterActivityTypes:l,filterDateRange:c,hasOlderActivities:g,activityIds:u},performRequest:async e=>{const{spaceId:t,navigableBlockId:i,collectionId:n,shouldLoadOlderActivities:o,shouldLoadNewerActivities:s,filterDateRange:a,filterActivityTypes:r,hasOlderActivities:d,activityIds:l}=e,c=_.ZP.startLoading();s?await f.A(this.environment,{store:this.stores.activityUpdatesStore,activityIds:l,spaceId:t,filterActivityTypes:r,filterDateRange:a,navigableBlockId:i,collectionId:n}):o&&d&&await f.h(this.environment,{store:this.stores.activityUpdatesStore,activityIds:l,spaceId:t,filterActivityTypes:r,filterDateRange:a,navigableBlockId:i,collectionId:n}),_.ZP.endLoading(c)},render:(t,o,s)=>{var d,u;const{activityIds:f}=this.stores.activityUpdatesStore.state;if(t)return(0,F.jsx)("div",{style:q(this.environment,this.theme),children:(0,F.jsx)(h.FormattedMessage,{defaultMessage:"Something went wrong.",id:"activityUpdate.unknownErrorLoadingActivities.message"})});const y=(0,b.oI)(),j=(0,C.Y)("supportsNativeHome"),I={spaceId:e,userId:m,navigableBlockId:M,collectionId:i,filterDateRange:c,filterActivityTypes:l},A=j&&0===f.length&&!s?x.IS(I):f;if(j&&s&&x.HB(I,f),0===A.length&&!s)return(0,F.jsxs)("div",{children:[y&&this.renderSearchFilters(),(0,F.jsx)(D.B,{areaHeight:window.innerHeight})]});const T=function(e){return p.oA(e.map((e=>function(e){const{currentUserStore:t,currentSpaceStore:i}=k.default.state;if(!t||!i)return;const n=(0,v.No)(i,e,i.id),o=n.getModel();return o&&!o.invalid?o:null}(e))))}(A),w=this.stores.activityUpdatesStore.state,L=0===w.filterActivityTypes.length&&void 0===w.filterDateRange.ending&&void 0===w.filterDateRange.starting,_=0===T.length&&!g&&s;return(0,F.jsxs)("div",{children:[y&&this.renderSearchFilters(),(0,F.jsxs)("div",{style:_?q(this.environment,this.theme):G(this.environment),className:_?"":"notranslate",children:[_?null===(d=(u=this.props).empty)||void 0===d?void 0:d.call(u,{hasFiltersOn:!L}):null,(0,F.jsx)("section",{role:"feed",children:T.map(((e,t,i)=>{const o=i.length-1===t,s="notifications_tab"===n?{tab:"all",source:n}:{tab:"pageUpdatesSidebar",source:n};return(0,F.jsx)(S.LazyActivityUpdate,{activity:e,rootStore:a,isLast:o,tabArgs:s},e.id)}))}),(0,F.jsx)(N.Z,{onChange:e=>{e<200&&s&&!r&&g&&(L||A.length>0)&&this.stores.activityUpdatesStore.update((e=>({...e,shouldLoadOlderActivities:!0})))},children:!s&&g?(0,F.jsx)($,{isPaginated:!0}):null})]})]})}})}startMessageListeners(){const{navigableBlock:e,collectionId:t}=this.props,i=null==e?void 0:e.id;if(i){const e=(0,c.bS)(i);this.navigableBlockListenerReference=M.ZP.addListener(e,this.handleNavigableBlockEmit,void 0,this.environment)}if(t){const e=(0,c.Cy)(t);this.collectionListenerReference=M.ZP.addListener(e,this.handleCollectionEmit,void 0,this.environment)}}stopMessageListeners(){this.navigableBlockListenerReference&&(M.ZP.removeListener(this.navigableBlockListenerReference,this.environment),this.navigableBlockListenerReference=void 0),this.collectionListenerReference&&(M.ZP.removeListener(this.collectionListenerReference,this.environment),this.collectionListenerReference=void 0)}}H.displayName="ActivityUpdates";const W=(0,h.injectIntl)(H);function G(e){return{minHeight:e.device.isMobile?void 0:"75vh"}}function q(e,t){const{device:i}=e;return{...G(e),paddingTop:i.isMobile?64:void 0,minHeight:i.isMobile?void 0:220,display:"flex",textAlign:"center",alignItems:"center",justifyContent:"center",fontSize:14,color:t.mediumTextColor,flexDirection:"column",flex:"1 1 0%"}}function Y(){const e=(0,r.Fg)(),t=(0,s.O7)();return(0,F.jsx)("div",{style:q(t,e),children:(0,F.jsx)(h.FormattedMessage,{defaultMessage:"Please go online to view updates.",id:"activityUpdates.offlineMessage"})})}function X(e,t,i){return{...q(e,t),minHeight:i?64:220}}function $(e){let{isPaginated:t}=e;const i=(0,r.Fg)(),n=(0,s.O7)();return(0,F.jsx)("div",{style:X(n,i,t),children:(0,F.jsx)(R.Z,{})})}function J(e){var t,i;const{filterActivityTypes:n,filterDateRange:o}=e.state;return{activityTypes:n,dateRange:{start:null===(t=o.starting)||void 0===t?void 0:t.start_date,end:null===(i=o.ending)||void 0===i?void 0:i.start_date}}}function Q(e){e.setState({...e.state,open:!1})}function ee(e,t,i,n){const o=J(n);e();const s=J(n);m.Q6({environment:t,activityUpdatesSource:i,filters:s,prevFilters:o})}function te(e){let{source:t,activityUpdatesStore:i}=e;const n=(0,r.Fg)(),o=(0,s.O7)();return(0,F.jsx)("div",{style:{flexGrow:1,textAlign:"right",cursor:"pointer",fontSize:14,color:n.mediumTextColor,marginRight:8},onClick:()=>ee((()=>i.reset()),o,t,i),children:(0,F.jsx)(h.FormattedMessage,{defaultMessage:"Clear",id:"activityUpdates.clearFilters"})})}function ie(e){let{source:t,activityUpdatesStore:i,filterPopupStore:o}=e;const r=(0,s.O7)(),l=(0,n.useCallback)((()=>Q(o)),[o]),c=(0,a.VK)((()=>i.state.filterDateRange),[i]);return(0,F.jsx)(B.Z,{mode:P.z.Pill,focused:!1,showButtons:!0,title:(0,F.jsx)(h.FormattedMessage,{id:"activityUpdates.filterMenu.byDate",defaultMessage:"Date Range"}),icon:d.C,value:c,onMenuDismiss:l,onChange:e=>ee((()=>i.update((t=>({...t,filterDateRange:e,activityIds:[],hasOlderActivities:!0,shouldLoadOlderActivities:!0})))),r,t,i)})}},82598:(e,t,i)=>{i.d(t,{Z:()=>r});i(67294);var n=i(24405),o=i(45238),s=i(85893);const a=(0,o.IU)("inbox",{viewBox:"0 0 30 30",svg:(0,s.jsx)("path",{d:"M4.445 25.3h20.532c2.296 0 3.457-1.16 3.457-3.421v-6.715c0-.902-.13-1.324-.563-1.887l-4.406-5.53c-1.195-1.5-1.793-1.934-3.668-1.934H9.625c-1.875 0-2.473.433-3.668 1.933l-4.406 5.531c-.434.563-.563.985-.563 1.887v6.715c0 2.273 1.172 3.422 3.457 3.422zm10.266-6.948c-1.734 0-2.93-1.442-2.93-3v-.059c0-.422-.234-.785-.738-.785h-8.11c-.304 0-.374-.27-.222-.469l4.664-5.93c.574-.726 1.207-1.02 2.121-1.02h10.43c.914 0 1.547.294 2.12 1.02l4.665 5.93c.164.2.094.469-.211.469h-8.121c-.504 0-.738.363-.738.785v.059c0 1.558-1.196 3-2.93 3zM4.469 23.859c-1.313 0-2.028-.703-2.028-2.05v-5.977h7.957c.188 2.25 2.004 3.855 4.313 3.855 2.309 0 4.125-1.617 4.312-3.855h7.957v5.977c0 1.347-.738 2.05-2.027 2.05H4.47z"})});function r(e){const{message:t,title:i}=e,o=(0,n.yK)((e=>({wrapper:{textAlign:"center",paddingLeft:20,paddingRight:20,height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",overflow:"hidden",minHeight:220},icon:{width:48,fill:e.mediumTextColor},message:{fontSize:14,color:e.lightTextColor,marginTop:2,marginBottom:4,maxWidth:380},title:{fontSize:14,fontWeight:500,color:e.mediumTextColor,maxWidth:380}})),[]),r=e.icon||a;return(0,s.jsxs)("div",{style:o.wrapper,children:[(0,s.jsx)("div",{style:{paddingBottom:12},children:r(o.icon)}),(0,s.jsx)("div",{style:o.title,children:i}),(0,s.jsx)("div",{style:o.message,children:t})]})}},56258:(e,t,i)=>{i.d(t,{Z:()=>P,o:()=>O});i(57658),i(30541);var n=i(67294),o=i(83355),s=i(480),a=i(86628),r=i(24405),d=i(49085),l=i(44615),c=i(65311),u=i(9291),h=i(53965),p=i(19584),g=i(54642),f=i(17659),m=i(13447),y=i(23586),v=i(65598),b=i(51811),x=i(77907),S=i(2688),M=i(41549),C=i(45428),j=i(70564),k=i(50770),I=i(5162),A=i(80444),T=i(88632),w=i(6258),L=i(4761),_=i(43145),R=i(70268),N=i(85893);const B={mentions:!0,archive:!1};function O(e){const t=(0,s.O7)();return(0,n.useEffect)((()=>{void 0!==e.requestId&&j.L(e.requestId,t)}),[e.requestId,t]),(0,N.jsx)(N.Fragment,{children:e.children})}class Z extends o.Z{constructor(){super(...arguments),this.storeTypes={sizeStore:d.default.createClass(20),checkpointStore:d.default.createClass(Math.random())},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleActivityEmit=(e,t)=>function(e,t,i){if(String(t).includes("unreadCount"))return;i.setState(Math.random())}(0,t,this.stores.checkpointStore),this.handleActivityEmitThrottled=h.P2(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleActivityEmit,1e3),this.handleNotificationEmit=p.YX(this.handleActivityEmitThrottled),this.notificationListenerReference=void 0}UNSAFE_willMount(){this.startMessageListeners()}willUnmount(){this.stopMessageListeners()}renderComponent(){return T.Z.state.online?(0,N.jsx)(E,{type:this.props.type,source:this.props.source,tab:this.props.tab,empty:this.props.empty,sizeStore:this.stores.sizeStore,checkpointStore:this.stores.checkpointStore}):(0,N.jsx)(z,{type:this.props.type})}startMessageListeners(){const{currentUserStore:e}=A.default.state;if(e){const t=(0,l.Lp)(e.id);this.notificationListenerReference=S.ZP.addListener(t,this.handleNotificationEmit,void 0,this.environment)}}stopMessageListeners(){this.notificationListenerReference&&(S.ZP.removeListener(this.notificationListenerReference,this.environment),this.notificationListenerReference=void 0)}}Z.displayName="NotificationUpdates";const P=Z;function F(e,t){const{device:i}=t;return{minHeight:i.isMobile||"mentions"===e?void 0:"75vh"}}function V(e,t,i){const{device:n}=t;return{...F(e,t),paddingTop:n.isMobile?64:void 0,minHeight:n.isMobile?void 0:220,display:"flex",textAlign:"center",alignItems:"center",justifyContent:"center",fontSize:14,color:i.regularTextColor,overflow:"hidden"}}function z(e){let{type:t}=e;const i=(0,r.Fg)(),n=(0,s.O7)();return(0,N.jsx)("div",{style:V(t,n,i),children:(0,N.jsx)("div",{children:(0,N.jsx)(u.FormattedMessage,{defaultMessage:"Please go online to view updates.",id:"notificationUpdates.offline.message"})})})}function U(e){let{request:t,error:i,result:o,ready:d,type:l,source:p,tab:g,empty:y,sizeStore:S}=e;const C=(0,r.Fg)(),j=(0,s.O7)(),T=(0,a.VK)((()=>A.default.state.currentSpaceStore),[]),O=(0,a.VK)((()=>L.ZP.state),[]),Z=(0,a.VK)((()=>(0,k.H7)(j)),[j]),P=(0,I.Y)("supportsNativeHome");let z=P?o??b.Tj(t):o;P&&o&&b.yW(t,o),"mentions"===O.currentTab&&O.showOnlyUnreadNotifications&&(z=O.unreadNotificationIds);const U=(0,a.VK)((()=>{const e=T&&z?z.map((e=>w.t1.createChildStore(T,{table:c.uX,id:e}))):[],t=[],i=h.oA(e.map((e=>{const i=e.getValue();if(!i)return null;if(i.invalid)return null;if(!Z&&(i.visited&&B[l]||!i.visited&&"archive"===l))return null;const n=v.sl(e);if(!n||!n.isReady())return null;const o=n.getModel();return o?o.invalid?(t.push(i),null):{activity:o,notification:i}:(t.push(i),null)})));return T&&function(e,t,i){const n=e.filter((e=>!e.read));0!==n.length&&m.createAndCommit({userAction:"NotificationUpdates.unreadNotificationNotRendered",environment:i,perform:e=>{for(const i of n)f.$h({notification:i,rootStore:t,transaction:e,read:!0})}})}(t,T,j),i}),[j,Z,T,z,l]),K=(0,a.VK)((()=>S.state),[S]),E=(0,a.VK)((()=>M.$x(U,t.type)),[U,t.type]),D=Z?0===E.size:0===U.length;if((0,n.useEffect)((()=>{const e=U.some((e=>{let{notification:t}=e;return!t.read})),t=e&&U.some((e=>{let{notification:t}=e;return t.read}));"mentions"===O.currentTab?L.ZP.setState({...O,isCurrentTabEmpty:D,containsBothReadAndUnreadNotifications:t,containsUnreadNotifications:e}):L.ZP.setState({...O,isCurrentTabEmpty:D})}),[O,D,U]),!T||i)return(0,N.jsx)("div",{style:V(l,j,C),children:(0,N.jsx)(u.FormattedMessage,{defaultMessage:"Something went wrong.",id:"notificationUpdates.unknownErrorMessage"})});if(!z)return(0,N.jsx)("div",{style:F(l,j),children:(0,N.jsx)(R.B,{areaHeight:window.innerHeight})});let H;return H=Z?(0,N.jsx)(x.LazyNotificationGroups,{notifications:E,rootStore:T,source:p,tab:g}):U.map(((e,t,i)=>{let{activity:n,notification:o}=e;const s=0===t,a=i.length-1===t,r={source:p,tab:g,notification:o};return(0,N.jsx)(x.LazyActivityNotification,{activity:n,rootStore:T,isFirst:s,isLast:a,tabArgs:r,useInboxRedesign:!1},n.id)})),(0,N.jsxs)("div",{style:D?V(l,j,C):F(l,j),children:[D&&y,(0,N.jsx)("section",{role:"feed",className:"notranslate",children:H}),(0,N.jsx)(_.Z,{onChange:e=>{e<200&&z&&z.length>=K&&S.setState(z.length+20)},children:!z&&(0,N.jsx)(R.B,{areaHeight:window.innerHeight})})]})}function K(e){let{request:t,error:i,result:n,ready:o,requestId:s,type:a,source:r,tab:d,empty:l,sizeStore:c}=e;const u=(0,N.jsx)(U,{type:a,source:r,tab:d,empty:l,sizeStore:c,request:t,error:i,result:n,ready:o});return C.setState({request:t,result:n}),(0,N.jsx)(O,{requestId:s,children:u})}function E(e){let{type:t,source:i,tab:o,empty:r,sizeStore:d,checkpointStore:l}=e;const c=(0,s.O7)(),{currentUserStore:u,currentSpaceStore:h}=(0,a.VK)((()=>A.default.state),[]),p=(0,a.VK)((()=>d.state),[d]),m=(0,a.VK)((()=>l.state),[l]),v=(0,a.VK)((()=>(0,k.H7)(c)),[c]),b=null==h?void 0:h.id,x=null==u?void 0:u.id,S=(0,n.useCallback)(((e,n,s)=>b&&x?(0,N.jsx)(K,{type:t,source:i,tab:o,empty:r,sizeStore:d,request:{spaceId:b,userId:x,type:t},error:e,result:null==n?void 0:n.notificationIds,ready:s,requestId:null==n?void 0:n.requestId}):null),[r,d,i,o,t,b,x]);return x&&b?(0,N.jsx)(y.Z,{throttle:1e3,request:{spaceId:b,size:p,type:t,checkpoint:m},performRequest:async e=>{let{spaceId:t,size:i,type:n}=e;const o=L.ZP.startLoading();j.B(o,{size:i,type:n});const s=v&&"mentions"===n?await g.getNotificationLogV2(c,{spaceId:t,size:i,type:"unread_and_read"}):await g.getNotificationLog(c,{spaceId:t,size:i,type:n});if(L.ZP.endLoading(o),"failed"===s.type)throw s.error;if("mentions"===L.ZP.state.currentTab&&L.ZP.state.showOnlyUnreadNotifications){const e=await f.Qy({environment:c}),t=[...L.ZP.state.unreadNotificationIds];for(const i of e)t.includes(i)||t.unshift(i);L.ZP.setState({...L.ZP.state,unreadNotificationIds:t})}return{notificationIds:s.data.notificationIds,requestId:o}},render:S}):null}},55064:(e,t,i)=>{i.d(t,{Z:()=>T});var n=i(67294),o=i(480),s=i(86628),a=i(24405),r=i(51454),d=i(9291),l=i(1898),c=i(17659),u=i(87420),h=i(24677),p=i(28651),g=i(98742),f=i(89224),m=i(48276),y=i(28161),v=i(16746),b=i(74948),x=i(24646),S=i(38676),M=i(36391),C=i(96049),j=i(88923),k=i(6685),I=i(26388),A=i(85893);const T=function(e){let{type:t}=e;const i=(0,o.O7)(),a=(0,s.qz)(void 0,p.Z),d=(0,n.useRef)(!1),v=(0,n.useCallback)((()=>function(e,t){t.setState({...t.state,mousePressed:!1}),w({isResizing:!1},e)}(t,a)),[t,a]),T=(0,n.useCallback)((()=>function(e,t,i,n){if(!n.current){switch(t){case"page":b.setExpand({environment:e,isExpanded:!S.sidebarExpandedStore.state,from:"sidebar_resizer"}),S.sidebarOpenStore.setState(!1);break;case"update":b.setUpdateExpand({environment:e,isExpanded:!(0,x.Sx)(e),from:"drag"});break;case"peek":u.xv(e,"resizer_click");break;case"secondary_sidebar":c.qQ({environment:e,open:!1});break;default:(0,l.t1)(t)}i.setState({...i.state,mouseEntered:!1})}i.setState({...i.state,mousePressed:!1}),w({isResizing:!1},t)}(i,t,a,d)),[i,t,a]),N=(0,n.useCallback)((e=>function(e,t,i,n){switch(f.clear(t),n.current=!0,i){case"page":b.setWidth({width:L(e.currentX,i),environment:t});break;case"update":b.setUpdateWidth({width:L(e.currentX,i),environment:t});break;case"peek":b.setPeekWidth({width:L(e.currentX,i),environment:t});break;case"secondary_sidebar":y.ZP.setWidth(L(e.currentX,i));break;default:(0,l.t1)(i)}}(e,i,t,d)),[i,t]),B=(0,n.useCallback)((()=>function(e,t,i,n){h.ZH(e),i.setState({...i.state,mousePressed:!0}),n.current=!1,w({...S.sidebarResizingStore.state,isResizing:!0},t)}(i,t,a,d)),[i,t,a]),{device:O}=i,Z=(0,s.VK)((()=>function(e){const t=function(e){switch(e){case"page":return S.sidebarWidthStore.state;case"secondary_sidebar":return S.sidebarWidthStore.state+m.l_();case"update":return M.ZP.state.width;case"peek":return j.default.state.preferredSidePeekWidth;default:(0,l.t1)(e)}}(e);switch(e){case"page":case"secondary_sidebar":return t;case"peek":case"update":return window.innerWidth-t;default:(0,l.t1)(e)}}(t)),[t]),P=(0,s.VK)((()=>S.sidebarMouseEnterYStore.state),[]),F=(0,s.VK)((()=>C.Z.state),[]),V=(0,s.VK)((()=>function(e){return{cursor:"col-resize",height:"100%",width:12,marginLeft:"update"===e?-M.ZP.state.width:-6}}(t)),[t]),z=(0,s.VK)((()=>function(e,t){const i=(0,x.in)(t);return{position:"absolute",left:"peek"===e?0:void 0,right:"peek"!==e?0:void 0,width:0,flexGrow:0,zIndex:"peek"===e?r.YO:1,top:i?0:-1,bottom:i?0:-1,pointerEvents:"auto"}}(t,i)),[t,i]);return F||O.isChromebook?null:(0,A.jsx)(I.ZP,{renderTooltip:()=>(0,A.jsx)(_,{type:t}),originRect:new DOMRect(Z,P,0,0),delayThreshold:500,placement:"page"===t||"secondary_sidebar"===t?I.ug.Right:I.ug.Left,originGap:10,render:e=>(0,A.jsx)("div",{style:z,...(0,g.Z)(e,{onMouseMove:()=>function(e){w({isResizerHovered:!0},e)}(t),onMouseLeave:()=>function(e){w({isResizerHovered:!1},e)}(t),onMouseEnter:R}),children:(0,A.jsx)(k.Z,{onDraggableDragStart:B,onDraggableDragMove:N,onDraggableDragEnd:T,onDraggableDragCancel:v,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,render:e=>(0,A.jsx)("div",{style:V,...e})})})})};function w(e,t){switch(t){case"page":S.sidebarResizingStore.update((t=>({...t,...e})));break;case"update":M.ZP.update((t=>({...t,...e})));break;case"secondary_sidebar":v.Z.update((t=>({...t,...e})));break;case"peek":break;default:(0,l.t1)(t)}}function L(e,t){let i;switch(t){case"page":i=e;break;case"secondary_sidebar":i=e-(S.sidebarExpandedStore.state?S.sidebarWidthStore.state:0);break;case"peek":case"update":i=window.innerWidth-e;break;default:(0,l.t1)(t)}const n=function(e){const t=window.innerWidth;switch(e){case"page":return 480;case"update":return Math.min(t/2,x.Nc);case"peek":return t>2*j.sidePeekMinWidth?t/1.5:t;case"secondary_sidebar":return y.o$;default:(0,l.t1)(e)}}(t),o=function(e){switch(e){case"page":return S.SidebarMinWidth;case"update":return M.AO;case"peek":return j.sidePeekMinWidth;case"secondary_sidebar":return y.um;default:(0,l.t1)(e)}}(t);return i>n?n:i<o?o:i}function _(e){let{type:t}=e;const i=(0,a.Fg)(),r=(0,o.O7)(),c=(0,s.VK)((()=>function(e,t){switch(e){case"page":return(0,x.in)(t);case"update":return(0,x.Sx)(t);case"peek":return j.default.state.open;case"secondary_sidebar":return v.Z.isOpen();default:(0,l.t1)(e)}}(t,r)),[t,r]),u=i.mediumInvertedTextColor;return(0,A.jsxs)("div",{style:{textAlign:"center"},children:[(0,A.jsx)(d.FormattedMessage,{defaultMessage:"Drag <invertedcolor>to resize</invertedcolor>",id:"sidebarResizer.tooltip.dragMessage",values:{invertedcolor:e=>(0,A.jsx)("span",{style:{color:u},children:e})}}),(0,A.jsxs)(n.Fragment,{children:[(0,A.jsx)("br",{}),(0,A.jsx)(d.FormattedMessage,{defaultMessage:"Click <invertedcolor>to {expanded, select, true {close} other {lock open}}</invertedcolor>",id:"sidebarResizer.clickToToggleSidebar.message",values:{expanded:c,invertedcolor:e=>(0,A.jsx)("span",{style:{color:u},children:e})}})]})]})}function R(e){S.sidebarMouseEnterYStore.setState(e.clientY)}},70268:(e,t,i)=>{i.d(t,{B:()=>a});i(67294);var n=i(24405),o=i(36596),s=i(85893);function a(e){let t=Math.floor(e.areaHeight/124);0===t&&(t=1);const i=(0,n.yK)((e=>({skeletonRect:{height:8,borderRadius:4,margin:10,backgroundColor:e.lightDividerColor},skeletonCircle:{display:"flex",width:28,height:28,marginRight:8,backgroundColor:e.lightDividerColor,borderRadius:20},skeletonSection:{display:"flex",width:"100%",margin:20,flexDirection:"row"}})),[8,10,20]),a=[...Array(t)].map(((e,t)=>(0,s.jsxs)("div",{style:i.skeletonSection,children:[(0,s.jsx)(o.Z,{style:i.skeletonCircle}),(0,s.jsxs)("div",{style:{width:"80%"},children:[(0,s.jsx)(o.Z,{style:{width:"80%",...i.skeletonRect,marginTop:0}}),(0,s.jsx)(o.Z,{style:{width:"50%",...i.skeletonRect}}),(0,s.jsx)(o.Z,{style:{width:"60%",...i.skeletonRect}}),(0,s.jsx)(o.Z,{style:{width:"50%",...i.skeletonRect}})]})]},t)));return(0,s.jsx)("div",{children:a})}},99376:(e,t,i)=>{i.d(t,{Z:()=>N,h:()=>_});var n=i(67294),o=i(480),s=i(86628),a=i(24405),r=i(69651),d=i(8504),l=i(21202),c=i(17659),u=i(37834),h=i(13447),p=i(43250),g=i(12534),f=i(33929),m=i(16402),y=i(6258),v=i(4761),b=i(73063),x=i(86176),S=i(26388),M=i(67706),C=i(30573),j=i(32469),k=i(93963),I=i(85893);const A=16,T=12;function w(e){const[t,i]=(0,n.useState)(!1),[r,d]=(0,n.useState)(!1),{notification:l,prominentTitleLink:u,children:f,rootStore:m,icon:y,isPrivate:b,isLast:x,onBacklinkClicked:S,onArchiveClicked:M,onUnarchiveClicked:C,onNotificationFrameClicked:w,onMarkAsReadClicked:N,onMarkAsUnreadClicked:B,showRecordPath:O,navigableBlockId:Z,showSnapshotButton:P,timestamp:F,header:V}=e,z=(0,o.O7)(),U=(0,s.VK)((()=>"mentions"===v.ZP.state.currentTab),[]),K=!l||l.read,E=z.device.isMobile,D=Boolean(K&&U&&!P&&l),H=(0,s.VK)((()=>{const e=z.WindowSizeStore.state;return{left:e.paddingLeftCSS,right:e.paddingRightCSS}}),[z.WindowSizeStore]),W=(0,a.yK)((e=>({container:{paddingTop:T,paddingBottom:f?12:8,paddingLeft:E?H.left:0,paddingRight:E?H.right:0,...D&&{opacity:.7}},headerAndAvatar:{display:"flex",paddingLeft:A,paddingRight:A},avatarAndStatusDot:{display:"flex",alignItems:"flex-start",position:"relative"},statusDot:{position:"absolute",opacity:1,left:-7,top:10},statusDotWrapper:{marginRight:E?3:2},privatePageBadge:{marginTop:1,marginBottom:4,marginLeft:8},divider:{borderBottom:`1px solid ${e.regularDividerColor}`}})),[f,H,E,D]),G=(0,n.useCallback)((e=>{l&&!l.read&&(r||(0,g.ZP)({event:e,context:g.Af.NotificationClick,callback:()=>{w(),h.createAndCommit({userAction:"ActivityNotificationSection.handleMarkAsRead",environment:z,perform:e=>{c.$h({notification:l,rootStore:m,transaction:e,read:!0})}})}}))}),[z,r,l,w,m]),q=(0,n.useCallback)((()=>i(!0)),[]),Y=(0,n.useCallback)((()=>i(!1)),[]),X=(0,n.useId)();return(0,I.jsxs)("article",{onMouseOver:q,onMouseLeave:Y,onClick:G,"aria-labelledby":X,tabIndex:0,children:[(0,I.jsx)(L,{notification:l,rootStore:m,isMobile:E,isHovered:t,isMentionsTab:U,onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),onArchiveClicked:M,onUnarchiveClicked:C,onMarkAsReadClicked:N,onMarkAsUnreadClicked:B}),(0,I.jsxs)("div",{style:W.container,children:[(0,I.jsxs)("div",{style:W.headerAndAvatar,children:[(0,I.jsxs)("div",{className:p.FoE,style:W.avatarAndStatusDot,children:[(0,I.jsx)("div",{style:{marginRight:4},children:U&&(0,I.jsx)("div",{style:W.statusDotWrapper,children:!K&&(0,I.jsx)(k.z,{style:W.statusDot})})}),y]}),(0,I.jsx)(_,{timestamp:F,header:V,prominentTitleLink:u,hasChildren:Boolean(f),navigableBlockId:Z,rootStore:m,onBacklinkClick:S,showRecordPath:O,titleAriaId:X}),P&&Z&&(0,I.jsx)(R,{timestamp:F,navigableBlockId:Z,rootStore:m}),b&&!l&&(0,I.jsx)(j.Z,{style:W.privatePageBadge})]}),f&&(0,I.jsx)("div",{className:p.nU_,children:f})]}),!x&&(0,I.jsx)("div",{style:W.divider})]})}function L(e){const{notification:t,rootStore:i,isMobile:n,isHovered:o,isMentionsTab:s,onArchiveClicked:r,onUnarchiveClicked:d,onMarkAsReadClicked:l,onMarkAsUnreadClicked:c,onMouseEnter:u,onMouseLeave:h}=e,p=(0,a.yK)((()=>({container:{display:"flex",alignItems:"flex-start",position:"relative"},body:{transition:"opacity 100ms ease-out",opacity:n||o?1:0,position:"absolute",right:A,top:T,zIndex:1}})),[n,o]);return s&&t?t.visited?null:(0,I.jsx)("div",{style:p.container,onMouseEnter:u,onMouseLeave:h,children:(0,I.jsx)("div",{style:p.body,children:(0,I.jsx)(C.Z,{notification:t,rootStore:i,onArchiveClicked:r,onUnarchiveClicked:d,onMarkAsReadClicked:l,onMarkAsUnreadClicked:c,useInboxRedesign:!1})})}):null}function _(e){const{timestamp:t,prominentTitleLink:i,header:n,hasChildren:s,navigableBlockId:d,rootStore:c,showRecordPath:u,onBacklinkClick:h,titleAriaId:g}=e,f=(0,m.IS)(t,{useCompactFormat:!0}),v=(0,o.O7)().device.isMobile,b=(0,m.uy)(t),S=(0,a.yK)((e=>({container:{width:"100%"},header:{width:v?"calc(100% - 98px)":"100%",fontSize:14,lineHeight:1.4,minWidth:0,minHeight:v?28:void 0,display:"flex",alignItems:"baseline"},flatIndentHeader:{width:v?"calc(100% - 98px)":"100%",fontSize:14,lineHeight:1.4,minWidth:0,minHeight:v?28:void 0,display:"flex",justifyContent:"space-between",alignItems:"baseline"},title:{fontSize:14,marginTop:4,marginBottom:s?8:4},time:{fontSize:12,color:e.lightTextColor,whiteSpace:"nowrap",display:"inline",paddingLeft:6},path:{marginTop:4,marginBottom:4},separatorDot:{fontSize:12,color:e.lightTextColor,marginLeft:4,marginRight:4}})),[s,v]);return(0,I.jsxs)("div",{style:S.container,children:[(0,I.jsx)("div",{style:S.header,children:(0,I.jsxs)("div",{className:p.NFf,children:[(0,I.jsx)("span",{id:g,children:n}),(0,I.jsx)("div",{style:S.time,className:p.CZG,children:(0,I.jsx)(M.Z,{text:f,tooltipText:b,icon:r.C})})]})}),u&&d&&c&&(0,I.jsx)("div",{style:S.path,children:(0,I.jsx)(x.Z,{isLink:!0,store:y.G.createChildStore(c,{table:l.iU,id:d}),onClick:h})}),i&&(0,I.jsx)("div",{style:S.title,children:i})]})}function R(e){const{timestamp:t,navigableBlockId:i,rootStore:n}=e,s=(0,o.O7)();if(t<new Date("2018-10-26").getTime())return null;const a=f.default.getIntl().formatMessage({defaultMessage:"View version for this update",id:"activitySection.viewVersionForUpdate.tooltip"}),r=()=>{const e=y.G.createChildStore(n,{table:l.iU,id:i});u.jN({environment:s,blockStore:e,openSnapshotNearTimestamp:t.toString(),from:"activity"})};return(0,I.jsx)(S.ZP,{renderTooltip:()=>a,render:e=>(0,I.jsx)(b.Z,{ariaLabel:a,onClick:r,icon:d.J,...e})})}const N=n.memo(w)},24636:(e,t,i)=>{i.d(t,{Kg:()=>z,O2:()=>U,lw:()=>K});var n=i(67294),o=i(480),s=i(86628),a=i(24405),r=i(15145),d=i(92996),l=i(21202),c=i(33709),u=i(23867),h=i(70203),p=i(9291),g=i(1898),f=i(37810),m=i(19719),y=i(95306),v=i(60682),b=i(14976),x=i(98165),S=i(77080),M=i(6258),C=i(84076),j=i(62385),k=i(63381),I=i(13658),A=i(74970),T=i(17022),w=i(92559),L=i(90060),_=i(12472),R=i(22649),N=i(78976),B=i(99376),O=i(85893);function Z(e){let{activity:t,tabArgs:i,rootStore:d,isLast:u}=e;const h=(0,s.VK)((()=>t.getEdits()),[t]),{source:p,tab:f,notification:m}=i;let v=h.filter((e=>{switch(e.type){case"comment-changed":return!1;case"comment-created":case"comment-deleted":return!0;default:(0,g.t1)(e)}}));0===v.length&&0!==h.length&&"updates_sidebar"!==p&&(v=h);const b=v.length>0,j=(0,o.O7)(),_=(0,s.VK)((()=>{const e=d.getRecordStore(d,{table:c.qF,id:t.discussion_id,spaceId:t.space_id});if(e.isDefined())return e}),[t,d]),Z=(0,s.VK)((()=>{const e=null==_?void 0:_.getParentPointer();if(e)return M.G.createChildStore(d,e)}),[_,d]),V=(0,s.VK)((()=>Boolean(Z&&Z.isDefined())),[Z]),K=(0,s.VK)((()=>{const e=null==Z?void 0:Z.getNavigableBlockStore();return(null==e?void 0:e.id)||t.navigable_block_id}),[t,Z]),E=M.G.createChildStore(d,{table:l.iU,id:K}),D=(0,s.VK)((()=>E.isDefined()),[E]),H=(0,s.VK)((()=>Boolean(Z&&(0,x.fl)((0,x.qA)(Z)))),[Z]),W=(0,s.VK)((()=>S.default.checkGate("prevent_edits_trash")?E.canComment()&&H:E.canComment()),[H,E]),G=(0,s.VK)((()=>{if(!H||!Z)return;const e=Z.getModel();return e?e.getRenderUrl({getRecordModel:d.getRecordModel,discussionId:t.discussion_id,pageVisitSource:r.tY.Notification}):void 0}),[H,Z,d,t]),q=(0,s.VK)((()=>(0,L.P6)({edits:v,rootStore:d})),[v,d]),Y=(0,s.VK)((()=>(0,L.XW)(q)),[q]),X=H,$=(0,a.yK)((()=>({flex:{display:"flex"}})),[]),J=(0,n.useCallback)((e=>{if((0,T.dG)({...i,environment:j,activity:t,mightCloseTab:X}),!H&&Z&&_){var n;const o=e.target;y.oK({environment:j,discussionStore:_,rect:o.getBoundingClientRect(),blockStore:Z,discussionLocation:z({forReplyMenu:!0,source:i.source}),activityId:t.id,notificationId:null===(n=i.notification)||void 0===n?void 0:n.id})}}),[t,H,Z,_,j,i,X]),Q=(0,n.useCallback)((()=>{(0,T.BE)({...i,environment:j,activity:t,mightCloseTab:X})}),[i,j,t,X]),ee=(0,O.jsx)(N.Z,{titledRecordStore:E,getRecordModel:d.getRecordModel,activity:t,tabArgs:i}),te=(0,s.VK)((()=>(0,L.jC)({recordId:K,recordType:l.iU,tab:f,rootStore:d,environment:j})),[K,f,d,j]),ie=j.device.isMobile,ne=(0,s.VK)((()=>z({source:p,forReplyMenu:!1})),[p]),oe=(0,s.VK)((()=>(0,L.cr)({activity:t,rootStore:d})),[t,d]),se=null==oe?void 0:oe.id,ae=null==oe?void 0:oe.context,re=(0,s.VK)((()=>{const e=E.getAssociatedCollectionStore();return null==e?void 0:e.getDatabaseType()}),[E]),de=(0,s.VK)((()=>parseInt(t.end_time)),[t]);if(!(b&&D&&V&&_))return null;const le=!ae,ce=(0,O.jsxs)("div",{style:$.flex,children:[le&&(0,O.jsx)(w.Z,{}),ee]}),ue=U({authorCount:q.length,authorPhrase:Y,databaseType:re});return(0,O.jsxs)(B.Z,{timestamp:de,header:(0,O.jsx)("span",{children:ue}),isLast:u,isPrivate:te,rootStore:d,prominentTitleLink:ce,navigableBlockId:K,notification:m,icon:(0,O.jsx)(A.BE,{authors:q,size:24}),showSnapshotButton:!1,showRecordPath:!0,...(0,T.h9)({notification:m,environment:j,tab:f,activity:t}),children:[(0,O.jsx)(P,{discussionId:se,discussionContext:ae,alwaysHighlightWithBlockBar:!0,url:G,onClick:J,rootStore:d,source:p}),(0,O.jsx)(I.Z,{visible:5,items:v.map(((e,t,i)=>(0,O.jsx)(C.Z,{onClick:J,href:G,innerStyle:(0,R.OD)({source:p,isMobile:ie}),children:(0,O.jsx)(k.Z,{edit:e,rootStore:d,type:"comment-edit",discussionLocation:ne,highlightCurrentUser:!0,onReactionClick:Q,hideAuthorName:1===v.length})},t)))}),W&&(0,O.jsx)(F,{activity:t,rootStore:d,tabArgs:i})]})}function P(e){const{url:t,onClick:i,rootStore:n,source:r,discussionId:d,alwaysHighlightWithBlockBar:l,discussionContext:c}=e,u=0===(0,h.llS)(c).length||l,p=(0,o.O7)(),g=p.device.isMobile,m=(0,a.Fg)(),y=(0,a.yK)((e=>({linkbox:{...(0,R.OD)({source:r,isMobile:g}),display:"flex",alignItems:"center",fontSize:14,...u&&{color:e.mediumTextColor},paddingTop:2,paddingBottom:6,marginBottom:0}})),[g,r,u]),x=(0,s.VK)((()=>(0,b.IY)({environment:p,textValue:c?{value:c,spaceId:n.id}:void 0,parentStore:n,disableHover:!0,disableStyleAnnotations:u,disableInsertedDeletedAnnotations:u,disableDateStyleAnnotations:!1,disabled:!0,highlightDiscussionId:d,theme:m,emojiType:(0,v.e_)(p),katex:p.KatexStore.getKatex(),formulaValueTypes:[]})),[n,p,c,d,m,u]);return c?(0,O.jsxs)(C.Z,{href:t,onClick:i,innerStyle:y.linkbox,children:[u&&(0,O.jsx)(w.Z,{}),(0,O.jsx)("div",{style:f.Z.textOverflowStyle,children:x})]}):null}function F(e){const{activity:t,rootStore:i,tabArgs:r}=e,{source:d,notification:h,tab:g}=r,f=(0,s.VK)((()=>{const e=i.getRecordStore(i,{table:c.qF,id:t.discussion_id,spaceId:t.space_id});if(e.isDefined())return e}),[t,i]),v=(0,o.O7)(),b=v.device.isMobile,x=(0,s.VK)((()=>M.t1.createChildStore(i,{table:c.qF,id:t.discussion_id,spaceId:(0,u.C)(i.pointer.spaceId)})),[t,i]),S=(0,s.VK)((()=>null==f?void 0:f.getParentId()),[f]),C=(0,n.useCallback)((e=>{if(!S)return;const n=M.G.createChildStore(i,{table:l.iU,id:S}),o=e.target,s=null==h?void 0:h.id;y.oK({environment:v,discussionStore:x,rect:o.getBoundingClientRect(),blockStore:n,discussionLocation:z({forReplyMenu:!0,source:d}),activityId:t.id,notificationId:s}),"notifications_tab"===d&&m.gY({environment:v,notificationId:s,alreadyRead:Boolean(null==h?void 0:h.read),activity:t,tab:g})}),[t,x,v,h,S,i,d,g]),k=(0,a.yK)((e=>({container:{paddingLeft:(0,R.c3)({source:d,isMobile:b}),paddingTop:12,paddingBottom:4},actionButton:(0,R.b9)(e)})),[b,d]),I=Boolean(null==h?void 0:h.visited);return f?(0,O.jsxs)("div",{style:k.container,children:[(0,O.jsx)(j.Z,{onClick:C,style:k.actionButton,children:(0,O.jsx)(p.FormattedMessage,{defaultMessage:"Reply",id:"activity.replyButton.label"})}),I&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(V,{}),(0,O.jsx)(_.D,{tabArgs:r,environment:v,rootStore:i,activity:t})]})]}):null}function V(){return(0,O.jsx)("div",{style:{width:5,display:"inline-block"}})}function z(e){const{forReplyMenu:t,source:i}=e;if("updates_sidebar"===i)return t?"reply_menu_updates_sidebar":"updates_sidebar";return`${t?"reply_menu_":"updates_menu_"}${m.Jn()}`}function U(e){let{databaseType:t,authorCount:i,authorPhrase:n}=e;switch(t){case d.iS:return(0,O.jsx)(p.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} commented on a task} other {{authorOrAuthors} commented on a task}}",values:{numberOfAuthors:i,authorOrAuthors:n},id:"activity.commentTaskActivity.standardizedHeader"});case d.wW:return(0,O.jsx)(p.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} commented on a project} other {{authorOrAuthors} commented on a project}}",values:{numberOfAuthors:i,authorOrAuthors:n},id:"activity.commentProjectActivity.standardizedHeader"});case d.zU:return(0,O.jsx)(p.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} commented on a document} other {{authorOrAuthors} commented on a document}}",values:{numberOfAuthors:i,authorOrAuthors:n},id:"activity.commentDocActivity.standardizedHeader"});case d.GZ:return(0,O.jsx)(p.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} commented on a wiki page} other {{authorOrAuthors} commented on a wiki page}}",values:{numberOfAuthors:i,authorOrAuthors:n},id:"activity.commentWikiActivity.standardizedHeader"});case d.Fi:return(0,O.jsx)(p.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} commented on a meeting note} other {{authorOrAuthors} commented on a meeting note}}",values:{numberOfAuthors:i,authorOrAuthors:n},id:"activity.commentMeetingActivity.standardizedHeader"});case d.nG:case d.Be:case d.p$:case void 0:return(0,O.jsx)(p.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} commented on a page} other {{authorOrAuthors} commented on a page}}",values:{numberOfAuthors:i,authorOrAuthors:n},id:"activity.commentActivity.standardizedHeader"});default:(0,g.t1)(t)}}const K=n.memo(Z)},63082:(e,t,i)=>{i.d(t,{Z:()=>M});var n=i(67294),o=i(480),s=i(86628),a=i(24405),r=i(52867),d=i(70753),l=i(61248),c=i(9291),u=i(37810),h=i(19719),p=i(54642),g=i(17659),f=i(12534),m=i(41549),y=i(73063),v=i(26388),b=i(85893);function x(e){const{notificationActivityPairs:t}=e,i=t.map((e=>{let{notification:t}=e;return t})),x=(0,o.O7)(),M=(0,o.Fy)(),C=(0,c.useIntl)(),j=i?i[0]:void 0,k=(0,s.VK)((()=>i.every((e=>e.read))),[i]),I=(0,s.VK)((()=>m.Fz()),[]),[A,T]=(0,n.useState)(!1),w=(0,n.useCallback)((e=>{i&&j&&(0,f.ZP)({event:e,context:f.Af.NotificationClick,callback:()=>{T(!0);const e=i.map((e=>{let{id:t}=e;return t}));(async()=>{try{await p.setNotificationsStatus(x,{spaceId:j.space_id,notificationIds:e,archived:!0})}finally{T(!1)}})();const n=i.filter((e=>!e.read));g.Jl("mentions",j.space_id,(e=>Math.max(e-n.length,0))),h.Ee(x,{target:"archive",affectedNotificationIds:e,notificationActivityPairs:t})}})}),[x,i,j,t]),L=(0,n.useCallback)((e=>{i&&j&&(0,f.ZP)({event:e,context:f.Af.NotificationClick,callback:()=>{let e;if(T(!0),k){const n=i.map((e=>{let{id:t}=e;return t}));e=async()=>{try{await p.setNotificationsStatus(x,{spaceId:j.space_id,notificationIds:n,read:!1})}finally{T(!1)}},g.Jl("mentions",j.space_id,(e=>e+n.length)),h.Ee(x,{target:"mark_as_unread",affectedNotificationIds:n,notificationActivityPairs:t})}else{const n=i.filter((e=>!e.read)).map((e=>{let{id:t}=e;return t}));e=async()=>{try{await p.setNotificationsStatus(x,{spaceId:j.space_id,notificationIds:n,read:!0})}finally{T(!1)}},g.Jl("mentions",j.space_id,(e=>Math.max(e-n.length,0))),h.Ee(x,{target:"mark_as_read",affectedNotificationIds:n,notificationActivityPairs:t})}e()}})}),[x,i,j,k,t]),_=(0,a.yK)((e=>({container:{display:"flex",height:"min-content",padding:M.isMobile?0:2,borderWidth:M.isMobile?0:1,borderStyle:"solid",borderColor:M.isMobile?"transparent":e.stroke.regular,background:M.isMobile?"transparent":e.surface.elevated,borderRadius:6},button:{height:M.isMobile?30:26,width:M.isMobile?30:26},inboxIconBase:{fill:e.icon.secondary,stroke:e.icon.secondary,strokeOpacity:1,strokeWidth:.25},iconStyle:{fill:e.mediumIconColor,padding:2},readIcon:{width:M.isMobile?21:19,height:M.isMobile?22:20},archiveIcon:{width:M.isMobile?24:23,height:M.isMobile?24:23},ellipsisIcon:{width:M.isMobile?24:23,height:M.isMobile?24:23},headerLabel:{paddingLeft:16,paddingRight:16,paddingTop:10,fontWeight:u.Z.fontWeight.semibold}})),[M]);return j?"archived_only"===I?null:(0,b.jsxs)("div",{style:_.container,children:[(0,b.jsx)(v.ZP,{renderTooltip:()=>(0,b.jsx)(c.FormattedMessage,{...S.archiveNotificationGroup}),render:e=>(0,b.jsx)(y.Z,{ariaLabel:C.formatMessage(S.archiveNotificationGroup),style:_.button,icon:r.H,iconStyle:{..._.iconStyle,..._.archiveIcon,height:18,width:18,..._.inboxIconBase},onClick:w,disabled:A,...e})}),(0,b.jsx)(v.ZP,{renderTooltip:()=>k?(0,b.jsx)(c.FormattedMessage,{...S.markNotificationGroupAsUnread}):(0,b.jsx)(c.FormattedMessage,{...S.markNotificationGroupAsRead}),render:e=>(0,b.jsx)(y.Z,{ariaLabel:k?C.formatMessage(S.markNotificationGroupAsUnread):C.formatMessage(S.markNotificationGroupAsRead),style:_.button,icon:k?l.F:d.F,iconStyle:{..._.iconStyle,..._.readIcon,...k?{height:17,width:17}:{height:16,width:16},..._.inboxIconBase},onClick:L,disabled:A,...e})})]}):null}const S=(0,c.defineMessages)({markNotificationGroupAsRead:{defaultMessage:"Mark notifications in this page as read",id:"NotificationGroupActionsMenu.markNotificationAsRead.tooltipMessage"},markNotificationGroupAsUnread:{defaultMessage:"Mark notifications in this page as unread",id:"NotificationGroupActionsMenu.markNotificationAsUnread.tooltipMessage"},archiveNotificationGroup:{defaultMessage:"Archive notifications in this page",id:"NotificationGroupActionsMenu.handleArchive.tooltipMessage"},changePageNotificationSettings:{defaultMessage:"Change page notification settings",id:"NotificationGroupActionsMenu.notificationSettings.tooltipMessage"}}),M=n.memo(x)},51811:(e,t,i)=>{i.d(t,{EX:()=>n,HB:()=>d,IS:()=>l,Tj:()=>r,yW:()=>a});let n=function(e){return e[e.Sidebar=0]="Sidebar",e[e.SidebarMobile=1]="SidebarMobile",e[e.MobileBottomBarPhone=2]="MobileBottomBarPhone",e[e.MobileBottomBarTablet=3]="MobileBottomBarTablet",e[e.TopbarMobile=4]="TopbarMobile",e[e.RenderAsPage=5]="RenderAsPage",e[e.SidebarIcon=6]="SidebarIcon",e}({});const o=new Map,s=new Map;function a(e,t){o.set(c(e),t)}function r(e){return o.get(c(e))}function d(e,t){s.set(u(e),t)}function l(e){return s.get(u(e))??[]}function c(e){return Object.keys(e).sort().map((t=>{const i=e[t];return JSON.stringify(i)})).join("-")}function u(e){return Object.keys(e).sort().map((t=>{const i=e[t];return JSON.stringify(i)})).join("-")}},90797:(e,t,i)=>{i.d(t,{p:()=>w});var n=i(67294),o=i(480),s=i(86628),a=i(24405),r=i(52867),d=i(90334),l=i(5686),c=i(9291),u=i(1898),h=i(37810),p=i(19719),g=i(17659),f=i(52275),m=i(31945),y=i(73063),v=i(78140),b=i(32163),x=i(72495),S=i(26388),M=i(64369),C=i(60709),j=i(98742),k=i(19034),I=i(4761),A=i(41549),T=i(85893);function w(){const e=(0,o.Fy)(),t=(0,c.useIntl)(),i=(0,s.VK)((()=>{const e=A.Fz(),{currentTab:t,isCurrentTabEmpty:i}=I.ZP.state;if("all_updates"===e||"archived_only"===e||"mentions"!==t||i)return;const{containsUnreadNotifications:n,containsBothReadAndUnreadNotifications:o}=I.ZP.state;return{containsUnreadNotifications:n,containsBothReadAndUnreadNotifications:o,showOnlyUnreadNotifications:"unread_only"===e}}),[]),n=(0,a.yK)((()=>({popup:{...e.isMobile&&{borderTopLeftRadius:12,borderTopRightRadius:12,overflow:"hidden"}},ellipsisIcon:{height:16}})),[e]);if(!i)return null;const r=t.formatMessage({defaultMessage:"More actions",id:"inbox.ellipsisButton.tooltip"});return(0,T.jsx)(m.ZP,{style:n.popup,popupType:e.isMobile?m.Z4.SlideUp:m.Z4.Popup,renderOrigin:e=>{let{onClick:i}=e;return(0,T.jsx)(S.ZP,{renderTooltip:()=>r,placement:S.ug.Bottom,alignment:S.v2.Start,delayThreshold:0,originGap:6,render:e=>(0,T.jsx)(y.Z,{ariaLabel:t.formatMessage(N.moreActionsButtonAriaLabel),icon:d.O,iconStyle:n.ellipsisIcon,onClick:i,...e})})},render:e=>(0,T.jsx)(L,{...i,closePopup:e.close}),alignmentToOrigin:m.vR.Start,originGap:2})}function L(e){const{containsUnreadNotifications:t,containsBothReadAndUnreadNotifications:i,showOnlyUnreadNotifications:s,closePopup:r}=e,d=(0,o.O7)(),l=(0,o.Fy)(),f=(0,n.useCallback)((()=>{p.Xf(d),g.go(d)}),[d]),m=(0,n.useCallback)((()=>{const e=A.Fz();let t="none";s||"unread_only"===e?t="unread":i&&(t="read"),p.zD(d,{readFilter:t}),g.rG(d,"mentions",t)}),[d,i,s]),y=(0,a.yK)((e=>({menuScroller:l.isMobile?{background:e.sidebarBackground}:{},header:l.isMobile?{display:"flex",justifyContent:"center",alignItems:"center",fontSize:16,fontWeight:h.Z.fontWeight.semibold,background:e.sidebarBackground,height:40}:{paddingLeft:16,paddingRight:16,paddingTop:10,fontWeight:h.Z.fontWeight.semibold},sectionMenuItem:l.isMobile?{overflow:"hidden",background:e.buttonBackground,borderRadius:12,marginLeft:16,marginRight:16,marginBottom:16,borderWidth:1,borderStyle:"solid",borderColor:e.stroke.deemphasized,padding:void 0}:{}})),[l]);return(0,T.jsx)(v.Z,{menuType:C.og.Popup,height:l.isMobile?"50vh":void 0,maxWidth:l.isMobile?"100vw":void 0,header:l.isMobile?(0,T.jsx)(M.Z,{style:y.header,isSmall:!l.isMobile,isSecondaryColor:!l.isMobile,children:(0,T.jsx)(c.FormattedMessage,{id:"inbox.moreActionsMenu.header",defaultMessage:"Actions"})}):void 0,minWidth:250,scrollerStyle:y.menuScroller,children:(0,T.jsx)(b.Z,{type:b.i.Vertical,sections:[{key:"inbox global actions",render:e=>(0,T.jsx)(x.Z,{...e,topBorder:0!==e.index,style:y.sectionMenuItem}),items:["markAllAsRead","archiveAll"].map((e=>({key:e,render:n=>"archiveAll"===e?(0,T.jsx)(R,{...n,containsBothReadAndUnreadNotifications:i,showOnlyUnreadNotifications:s}):"markAllAsRead"===e?(0,T.jsx)(_,{...n,containsUnreadNotifications:t}):void(0,u.t1)(e),action:()=>{r(),"archiveAll"===e?m():"markAllAsRead"===e?f():(0,u.t1)(e)}})))}],initialFocus:void 0,onAccept:()=>r()})})}const _=n.forwardRef(((e,t)=>{const{containsUnreadNotifications:i,...n}=e,r=(0,o.Fy)(),d=(0,s.VK)((()=>k.Z.getUnreadCountForCurrentSpace().mentions>0),[]),u=!(i||d),h=(0,a.yK)((e=>({buttonMenuItem:r.isMobile?{backgroundColor:e.surface.elevated,paddingTop:12,paddingBottom:12,borderBottomWidth:1,borderBottomStyle:"solid",borderBottomColor:e.stroke.deemphasized}:{},title:{fontSize:r.isMobile?16:14},icon:r.isMobile?{width:20,height:20}:{width:16,height:16}})),[r]);return(0,T.jsx)(S.ZP,{placement:S.ug.Left,disableTooltip:!u,renderTooltip:()=>(0,T.jsx)(c.FormattedMessage,{defaultMessage:"All notifications have been marked as read.",id:"updatesModal.spaceUpdatesTab.markAllReadButton.disabledTooltip"}),render:e=>(0,T.jsx)(f.Z,{...(0,j.Z)(n,e),ref:t,icon:(0,l.J)(h.icon),title:(0,T.jsx)(c.FormattedMessage,{defaultMessage:"Mark all as read",id:"updatesModal.spaceUpdates.mentionsTab.markAllReadButtonTitle"}),titleStyle:h.title,disabled:u,disabledFeedback:u,style:h.buttonMenuItem})})}));_.displayName="InboxMarkReadButtonMenuItem";const R=n.forwardRef(((e,t)=>{const{containsBothReadAndUnreadNotifications:i,showOnlyUnreadNotifications:n,...s}=e,d=(0,o.Fy)(),l=(0,a.yK)((e=>({buttonMenuItem:d.isMobile?{backgroundColor:e.surface.elevated,paddingTop:12,paddingBottom:12,borderBottomWidth:1,borderBottomStyle:"solid",borderBottomColor:"transparent"}:{},title:{fontSize:d.isMobile?16:14},icon:d.isMobile?{width:20,height:20}:{width:16,height:16}})),[d]);return(0,T.jsx)(f.Z,{...s,ref:t,icon:(0,r.H)(l.icon),title:n?(0,T.jsx)(c.FormattedMessage,{defaultMessage:"Archive unread",id:"updatesModal.spaceUpdatesTab.archiveUnread.tooltip"}):i?(0,T.jsx)(c.FormattedMessage,{defaultMessage:"Archive read",id:"updatesModal.spaceUpdatesTab.archiveRead.tooltip"}):(0,T.jsx)(c.FormattedMessage,{defaultMessage:"Archive all",id:"updatesModal.spaceUpdatesTab.archiveAll.tooltip"}),titleStyle:l.title,style:l.buttonMenuItem})}));R.displayName="InboxArchiveButtonMenuItem";const N=(0,c.defineMessages)({moreActionsButtonAriaLabel:{defaultMessage:"More actions",id:"inbox.button.moreActionsButtonAriaLabel"}})},76386:(e,t,i)=>{i.d(t,{J:()=>j});var n=i(67294),o=i(480),s=i(86628),a=i(24405),r=i(52867),d=i(61248),l=i(59078),c=i(98519),u=i(44292),h=i(9291),p=i(37810),g=i(52275),f=i(78140),m=i(32163),y=i(72495),v=i(64369),b=i(60709),x=i(41549),S=i(19719),M=i(66353);var C=i(85893);function j(e){const{closePopup:t}=e,i=(0,o.O7)(),j=(0,o.Fy)(),k=(0,s.VK)((()=>x.Fz()),[]),I=(0,n.useCallback)((e=>function(e,t){M.ZP.setState({...M.ZP.state,filter:t}),S.bE(e,{tab:t})}(i,e)),[i]),A=(0,a.yK)((e=>({menuScroller:j.isMobile?{background:e.sidebarBackground}:{},header:j.isMobile?{display:"flex",justifyContent:"center",alignItems:"center",fontSize:16,fontWeight:p.Z.fontWeight.semibold,background:e.sidebarBackground,height:40,paddingLeft:16,paddingRight:16}:{display:"flex",alignItems:"center",paddingLeft:16,paddingRight:16,paddingTop:10,fontWeight:p.Z.fontWeight.semibold},sectionMenuItem:j.isMobile?{overflow:"hidden",background:e.buttonBackground,borderRadius:12,marginLeft:16,marginRight:16,marginBottom:16,borderWidth:1,borderStyle:"solid",borderColor:e.stroke.deemphasized,padding:void 0}:{},buttonMenuItem:j.isMobile?{backgroundColor:e.surface.elevated,paddingTop:12,paddingBottom:12,borderBottomWidth:1,borderBottomStyle:"solid",borderBottomColor:e.stroke.deemphasized}:{},buttonMenuItemPressed:{background:e.buttonPressedBackground},transparentButtonMenuItemBorder:{borderBottomColor:"transparent"},title:j.isMobile?{fontSize:16}:{},iconContainer:{display:"flex",justifyContent:"center",alignItems:"center",...j.isMobile&&{height:20}},icon:{...j.isMobile?{height:20,width:20}:{height:16,width:16}},unreadAndReadIcon:{...j.isMobile?{height:24,width:24,marginLeft:-2,marginRight:-2,marginTop:-4,marginBottom:-4}:{height:20,width:20,marginLeft:-2,marginRight:-2}},unreadIcon:{...j.isMobile?{height:20,width:20,marginLeft:.5,marginRight:-.5}:{height:15,width:15,marginLeft:1,marginRight:1}},updatesIcon:{...j.isMobile&&{height:16,width:16,marginTop:.5,marginBottom:.5}}})),[j]),T=[{type:"unread_and_read",title:(0,C.jsx)(h.FormattedMessage,{id:"inboxFilterMenu.readAndUnreadOption.label",defaultMessage:"Unread & read"}),icon:l.W},{type:"unread_only",title:(0,C.jsx)(h.FormattedMessage,{id:"inboxFilterMenu.unreadOption.label",defaultMessage:"Unread"}),icon:d.F},{type:"archived_only",title:(0,C.jsx)(h.FormattedMessage,{id:"inboxFilterMenu.archivedOption.label",defaultMessage:"Archived"}),icon:r.H},{type:"all_updates",title:(0,C.jsx)(h.FormattedMessage,{id:"inboxFilterMenu.allUpdatesOption.label",defaultMessage:"All workspace updates"}),icon:u.d}];return(0,C.jsx)(f.Z,{menuType:b.og.Popup,height:j.isMobile?"50vh":void 0,minWidth:250,maxWidth:j.isMobile?"100vw":void 0,scrollerStyle:A.menuScroller,header:(0,C.jsx)(v.Z,{style:A.header,isSmall:!j.isMobile,isSecondaryColor:!j.isMobile,children:(0,C.jsx)(h.FormattedMessage,{id:"inbox.filterOptionsMenu.headerMobile",defaultMessage:"Filter"})}),children:(0,C.jsx)(m.Z,{type:m.i.Vertical,sections:[{key:"inbox filters",render:e=>(0,C.jsx)(y.Z,{...e,topBorder:0!==e.index,style:A.sectionMenuItem}),items:T.map(((e,i)=>{const n=e.type===k,o=i===T.length-1,s=j.isMobile&&o;return{key:e.type,render:t=>(0,C.jsx)(g.Z,{...t,style:{...A.buttonMenuItem,...s&&A.transparentButtonMenuItemBorder},pressedStyle:A.buttonMenuItemPressed,title:e.title,titleStyle:A.title,icon:(0,C.jsx)("div",{style:A.iconContainer,children:e.icon({...A.icon,..."unread_and_read"===e.type&&A.unreadAndReadIcon,..."unread_only"===e.type&&A.unreadIcon})}),right:n?(0,c.k)(A.icon):void 0}),action:()=>{t(),I(e.type)}}}))}],initialFocus:void 0,onAccept:()=>t()})})}},66160:(e,t,i)=>{i.d(t,{Z:()=>we});i(57658),i(52262),i(24506);var n=i(67294),o=i(83355),s=i(480),a=i(86628),r=i(24405),d=i(49085),l=i(44615),c=i(65311),u=i(9291),h=i(53965),p=i(1898),g=i(19584),f=i(54642),m=i(17659),y=i(13447),v=i(15145),b=(i(41219),i(54368)),x=i(21202),S=i(33709),M=i(8055),C=i(80453),j=i(10417),k=i(82994),I=i(6258),A=i(31945),T=i(61519),w=i(62385),L=i(74970),_=i(90060),R=i(22649),N=i(24636),B=i(69651),O=i(37810),Z=i(43250),P=i(16402),F=i(50770),V=i(4761),z=i(11066),U=i(31278),K=i(76798),E=i(67706),D=i(63082),H=i(93963),W=i(85893);const G=4,q=5,Y=6,X=22,$=12+X+12;function J(e){const{notificationActivityPairs:t,prominentTitleLink:i,children:o,rootStore:d,icon:l,navigableBlockId:c,url:u,timestamp:h,header:p,isFirst:g,isLast:f}=e,m=(0,s.O7)(),y=(0,s.Fy)(),[v,b]=(0,n.useState)(!1),S=t.map((e=>{let{notification:t}=e;return t})),M=null==S?void 0:S.every((e=>e.read)),C=y.isMobile,j="time_grouping"===(0,a.VK)((()=>(0,F.B7)(m)),[m]),k=(0,a.VK)((()=>{if(c)return I.t1.createChildStore(d,{id:c,table:x.iU})}),[d,c]),A=(0,a.VK)((()=>{const e=m.WindowSizeStore.state;return{left:e.paddingLeftCSS,right:e.paddingRightCSS}}),[m.WindowSizeStore]),T=(0,r.yK)((e=>({article:{display:"flex",flexDirection:"column"},mainClickTargetButton:{borderRadius:4,paddingTop:16-G,paddingBottom:16-G,paddingLeft:C?A.left:0,paddingRight:C?A.right:0,marginTop:g?0:G,marginBottom:f?0:G,marginLeft:G,marginRight:G,opacity:M?.7:1},headerAndAvatar:{display:"flex",paddingLeft:12-G,paddingRight:12-G,gap:12,maxWidth:"100%"},avatarAndStatusDot:{display:"flex",gap:q,alignItems:"center",height:X},statusDotSpacer:{width:Y,flexShrink:0},privatePageBadge:{marginTop:1,marginBottom:4,marginLeft:8},children:{paddingTop:10,paddingLeft:$-G,paddingRight:12-G},divider:{width:"100%",height:1,backgroundColor:e.stroke.deemphasized,alignSelf:"end"},discussionHeader:{fontSize:12,color:e.mediumTextColor}})),[C,A.left,A.right,g,f,M]),w=(0,n.useCallback)((()=>b(!0)),[]),L=(0,n.useCallback)((()=>b(!1)),[]),_=(0,n.useId)();return(0,W.jsxs)("article",{style:T.article,onMouseOver:w,onMouseLeave:L,"aria-labelledby":_,tabIndex:0,children:[(0,W.jsx)(te,{notificationActivityPairs:t,rootStore:d,isMobile:C,isHovered:v,isFirst:g}),(0,W.jsxs)(z.Z,{href:u,style:T.mainClickTargetButton,disabled:!Boolean(u),children:[(0,W.jsxs)("div",{style:T.headerAndAvatar,children:[l&&(0,W.jsx)("div",{className:Z.FoE,style:T.avatarAndStatusDot,children:l}),(0,W.jsx)(se,{timestamp:h,header:p,prominentTitleLink:i,hasChildren:Boolean(o),titleAriaId:_,isNotificationRead:M,navigableBlockStore:k,headerStyle:j?T.discussionHeader:{}})]}),o&&(0,W.jsx)("div",{style:T.children,className:Z.nU_,children:o})]}),!f&&(0,W.jsx)("div",{style:T.divider})]})}const Q=10-G,ee=8-G;function te(e){const{notificationActivityPairs:t,isMobile:i,isHovered:n,isFirst:o}=e,s=(0,r.yK)((()=>({container:{display:"flex",alignItems:"flex-start",position:"relative"},body:{transition:"opacity 100ms ease-out",opacity:i||n?1:0,position:"absolute",right:Q,top:ee+(o?0:G),zIndex:1}})),[i,n,o]);return t?(0,W.jsx)("div",{style:s.container,children:(0,W.jsx)("div",{style:s.body,children:(0,W.jsx)(D.Z,{notificationActivityPairs:t})})}):null}const ie=14,ne=12,oe=4;function se(e){const{timestamp:t,prominentTitleLink:i,header:n,hasChildren:o,titleAriaId:d,isNotificationRead:l,navigableBlockStore:c,headerStyle:h}=e,p=(0,s.Fy)(),g=(0,a.VK)((()=>"mentions"===V.ZP.state.currentTab),[]),f=p.isMobile,m=(0,P.IS)(t,{useUltraCompactFormat:!0}),y=(0,P.uy)(t),v=(0,r.yK)((e=>({container:{display:"flex",flexDirection:"column",width:"100%"},containerMobile:{display:"flex"},headerMobile:{fontSize:ie,minWidth:0},header:{display:"inline-grid",gridAutoFlow:"column",justifyContent:"space-between",fontSize:ie,minWidth:0},headlineMobile:{display:"inline",whiteSpace:"pre-wrap",wordBreak:"break-word",...h},headline:{display:"inline",flexShrink:2,whiteSpace:"pre-wrap",wordBreak:"break-word",...h},title:{fontSize:ie,marginTop:4,marginBottom:o?8:4},timeAndStatusDot:{display:"inline"},time:{display:"flex",fontSize:ne,color:e.lightTextColor,whiteSpace:"nowrap",...f&&{display:"inline-flex"},gap:oe,paddingLeft:6,marginTop:ie-ne},avatarAndStatusDot:{display:"flex",gap:q,alignItems:"center",height:X,paddingBottom:3,paddingLeft:3},statusDotSpacer:{width:Y,flexShrink:0},icon:{...R.e9,verticalAlign:"unset",marginRight:4},pageIcon:{...R.e9,verticalAlign:"unset",marginLeft:-1,marginRight:3},recordTitle:{fontSize:14,fontWeight:O.Z.fontWeight.medium,display:"inline",width:"100%",...h}})),[o,f,h]),b=(0,a.VK)((()=>c instanceof I.G&&c.isEmptyPage()),[c]),x=(0,a.VK)((()=>{if(c)return c.getIcon()}),[c]),S=c&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(U.Z,{disabled:!0,icon:x,isEmptyPage:b,size:Boolean(x)||12===(null==h?void 0:h.fontSize)?12:14,style:x?v.icon:v.pageIcon}),(0,W.jsx)(K.Z,{store:c,style:v.recordTitle,underline:!0,shouldWrap:!0})]});return(0,W.jsxs)("div",{style:f?v.containerMobile:v.container,children:[(0,W.jsxs)("div",{style:f?v.headerMobile:v.header,children:[(0,W.jsx)("div",{style:f?v.headlineMobile:v.headline,className:Z.NFf,id:d,children:S?(0,W.jsx)(u.FormattedMessage,{id:"inboxGroupNotificationSection.headerAndPageName.title",defaultMessage:"{header} in {recordTitleWithIcon}",values:{header:n,recordTitleWithIcon:S}}):n}),(0,W.jsx)("div",{style:v.timeAndStatusDot,children:(0,W.jsxs)("div",{style:v.time,className:Z.CZG,children:[(0,W.jsx)(E.Z,{text:m,tooltipText:y,icon:B.C}),(0,W.jsx)("div",{style:v.avatarAndStatusDot,children:g&&!l?(0,W.jsx)(H.z,{size:Y}):(0,W.jsx)("div",{style:v.statusDotSpacer})})]})})]}),f&&(0,W.jsx)("div",{style:{width:96,flexShrink:0}}),i&&(0,W.jsx)("div",{style:v.title,children:i})]})}const ae=n.memo(J);i(37444);function re(e){var t;const{notificationActivityPairs:i,isFirst:n,isLast:o,tabArgs:s,rootStore:d}=e,l=null===(t=i[0])||void 0===t?void 0:t.activity,{source:c}=s,g=(0,a.VK)((()=>i.map((e=>{let{activity:t}=e;return t.getEdits()})).flat()),[i]);let f=g.filter((e=>{switch(e.type){case"comment-changed":return!1;case"comment-created":case"comment-deleted":return!0;default:(0,p.t1)(e)}}));0===f.length&&0!==g.length&&"updates_sidebar"!==c&&(f=g);const m=f.length>0,y=(0,a.VK)((()=>d.getRecordStore(d,{table:S.qF,id:l.discussion_id,spaceId:l.space_id})),[d,l]),M=(0,a.VK)((()=>y.isDefined()),[y]),C=(0,a.VK)((()=>{const e=y.getParentPointer();if(e)return I.G.createChildStore(d,e)}),[y,d]),j=(0,a.VK)((()=>Boolean(C&&C.isDefined())),[C]),k=(0,a.VK)((()=>{const e=null==C?void 0:C.getNavigableBlockStore();return(null==e?void 0:e.id)||l.navigable_block_id}),[l,C]),B=I.G.createChildStore(d,{table:x.iU,id:k}),O=(0,a.VK)((()=>B.isDefined()),[B]),Z=(0,a.VK)((()=>{if(!C)return;const e=C.getModel();return e?e.getRenderUrl({getRecordModel:d.getRecordModel,discussionId:l.discussion_id,pageVisitSource:v.tY.Notification}):void 0}),[C,d,l]),P=(0,a.VK)((()=>{const e=B.getAssociatedCollectionStore();return null==e?void 0:e.getDatabaseType()}),[B]),F=(0,a.VK)((()=>y.getCommentStores()),[y]),V=(0,a.VK)((()=>{const e=F[0].getCreatedByPointer();if(e&&e.table!==b.y0)return(0,_.uA)(e,d)}),[d,F]),z=(0,a.VK)((()=>{const e=F.map((e=>e.getCreatedByPointer())).filter(p.$K),t=(0,h.mN)(e,(e=>e.id));if(0===t.length)return[];return t.map((e=>{if(e&&e.table!==b.y0)return(0,_.uA)(e,d)})).filter(p.$K)}),[d,F]),U=(0,a.VK)((()=>(0,_.XW)(z)),[z]),K=(0,a.VK)((()=>parseInt(l.end_time)),[l]),E=(0,r.yK)((e=>({flex:{display:"flex"},discussionThreadContainer:{display:"flex",flexDirection:"column",marginTop:4},commentContextContainer:{marginTop:2},commentContextText:{color:e.regularTextColor},viewAllButton:(0,R.b9)(e)})),[]);if(!(m&&O&&j&&M))return null;const D=(0,N.O2)({databaseType:P,authorPhrase:U,authorCount:z.length});return(0,W.jsx)(ae,{header:D,notificationActivityPairs:i,icon:V&&(0,W.jsx)(L.BE,{authors:[V],size:22,style:{marginTop:0,marginRight:0},showAvatarShadow:!1}),isFirst:n,isLast:o,navigableBlockId:k,rootStore:d,url:Z,timestamp:K,children:(0,W.jsx)(A.ZP,{style:{maxHeight:500},popupType:A.Z4.Popup,originGap:4,alignmentToOrigin:A.vR.Start,placementToOrigin:A.pO.Bottom,renderOrigin:e=>(0,W.jsxs)(w.Z,{style:E.viewAllButton,...e,children:[(0,W.jsx)(u.FormattedMessage,{id:"pageCommentNotificationGroup.viewAllButton.label",defaultMessage:"View all"}),` ${i.length}`]}),enableOutsideClickDismiss:!0,render:e=>(0,W.jsx)("div",{style:{maxHeight:500,overflow:"scroll",minWidth:400},children:i.map(((t,n)=>{let{activity:o}=t;const s=i.length-1===n;return(0,W.jsxs)("div",{children:[(0,W.jsx)(de,{activity:o,rootStore:d,dismissPopup:e.close}),!s&&(0,W.jsx)(T.Z,{size:"100%"})]},o.discussion_id??n)}))})})})}function de(e){const{activity:t,rootStore:i,dismissPopup:o}=e,d=(0,s.O7)(),[l,c]=(0,n.useState)(!1),u=(0,a.VK)((()=>{const e=t.getDiscussionPointer();if(e)return I.t1.createChildStore(i,e)}),[i,t]),h=(0,a.VK)((()=>new k.Z(d,i.getSpaceId())),[d,i]),p=(0,a.VK)((()=>{if(!u)return;const e=u.getParentStore();return e||void 0}),[u]),g=(0,a.VK)((()=>{if(!p)return;const e=p.getModel();return e?e.getRenderUrl({getRecordModel:i.getRecordModel,discussionId:t.discussion_id,pageVisitSource:v.tY.Notification}):void 0}),[p,i,t]),f=(0,n.useCallback)((e=>{e.target instanceof HTMLElement&&"true"===e.target.contentEditable?c(!1):g&&(M.c4({environment:d,url:g}),o())}),[d,g,o]),m=(0,r.yK)((e=>({discussionButton:{backgroundColor:l?e.buttonHoveredBackground:void 0}})),[l]);return u&&p?(0,W.jsx)("div",{role:"button",onClick:f,onMouseOver:()=>c(!0),onMouseLeave:()=>c(!1),style:m.discussionButton,children:(0,W.jsx)(C.Discussion,{store:u,discussionInputStore:h,format:j.DiscussionFormat.Menu,isFirst:!1,isOnly:!1,discussionLocation:"reply_menu_mentions_comments",showResolveButtonByDefaultIfPossible:!0,blockStore:p})}):null}const le=n.memo(re);var ce=i(43145),ue=i(56258),he=i(70268),pe=i(23586),ge=i(65598),fe=i(51811),me=i(77907),ye=i(2688),ve=i(5162),be=i(80444),xe=i(88632),Se=i(77080),Me=i(45325),Ce=i(41549),je=i(45428),ke=i(70564);function Ie(e){const{groupName:t}=e;switch(t){case"today":return(0,W.jsx)(u.FormattedMessage,{id:"InboxTimeGroupHeader.today",defaultMessage:"Today"});case"this_week":return(0,W.jsx)(u.FormattedMessage,{id:"InboxTimeGroupHeader.thisWeek",defaultMessage:"This week"});case"last_week":return(0,W.jsx)(u.FormattedMessage,{id:"InboxTimeGroupHeader.lastWeek",defaultMessage:"Last week"});case"older":return(0,W.jsx)(u.FormattedMessage,{id:"InboxTimeGroupHeader.older",defaultMessage:"Older"});default:(0,p.t1)(t)}}function Ae(e){const{groupName:t}=e,i=(0,r.yK)((e=>({container:{padding:"16px 20px 8px 16px",color:e.text.secondary,fontWeight:O.Z.fontWeight.medium,fontSize:"12px"}})),[]);return(0,W.jsx)("div",{style:i.container,children:(0,W.jsx)(Ie,{groupName:t})})}class Te extends o.Z{constructor(){super(...arguments),this.storeTypes={sizeStore:d.default.createClass(20),checkpointStore:d.default.createClass(Math.random())},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleActivityEmit=(e,t)=>function(e,t,i){if(String(t).includes("unreadCount"))return;i.setState(Math.random())}(0,t,this.stores.checkpointStore),this.handleActivityEmitThrottled=h.P2(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleActivityEmit,1e3),this.handleNotificationEmit=g.YX(this.handleActivityEmitThrottled),this.notificationListenerReference=void 0}UNSAFE_willMount(){this.startMessageListeners()}willUnmount(){this.stopMessageListeners()}renderComponent(){return xe.Z.state.online?(0,W.jsx)(Ze,{type:this.props.type,empty:this.props.empty,source:this.props.source,tab:this.props.tab,sizeStore:this.stores.sizeStore,checkpointStore:this.stores.checkpointStore}):(0,W.jsx)(Ne,{type:this.props.type})}startMessageListeners(){const{currentUserStore:e}=be.default.state;if(e){const t=(0,l.Lp)(e.id);this.notificationListenerReference=ye.ZP.addListener(t,this.handleNotificationEmit,void 0,this.environment)}}stopMessageListeners(){this.notificationListenerReference&&(ye.ZP.removeListener(this.notificationListenerReference,this.environment),this.notificationListenerReference=void 0)}}Te.displayName="NotificationInbox";const we=Te;function Le(e,t){switch(e){case"mentions":return t?"unread_only":"unread_and_read";case"archive":return"archived";default:(0,p.t1)(e)}}function _e(e,t){const{device:i}=t;return{minHeight:i.isMobile||"mentions"===e?void 0:"75vh"}}function Re(e,t,i){const{device:n}=t;return{..._e(e,t),paddingTop:n.isMobile?64:void 0,minHeight:n.isMobile?void 0:220,display:"flex",textAlign:"center",alignItems:"center",justifyContent:"center",fontSize:14,color:i.regularTextColor,overflow:"hidden"}}function Ne(e){let{type:t}=e;const i=(0,r.Fg)(),n=(0,s.O7)();return(0,W.jsx)("div",{style:Re(t,n,i),children:(0,W.jsx)("div",{children:(0,W.jsx)(u.FormattedMessage,{defaultMessage:"Please go online to view your inbox.",id:"notificationInbox.offline.message"})})})}function Be(e){let{request:t,error:i,result:o,ready:d,type:l,empty:f,source:v,tab:b,sizeStore:x}=e;const S=(0,r.Fg)(),M=(0,s.O7)(),C=(0,a.VK)((()=>be.default.state.currentSpaceStore),[]),j=(0,ve.Y)("supportsNativeHome"),k=j?o??fe.Tj(t):o;j&&o&&fe.yW(t,o);const A=(0,a.VK)((()=>V.ZP.state),[]),T=(0,a.VK)((()=>(0,F.B7)(M)),[M]),[w,L]=(0,a.VK)((()=>{const e=C&&k?k.map((e=>I.t1.createChildStore(C,{table:c.uX,id:e}))):[],i=Se.default.checkGate("automation_action_notification"),n=e.filter((e=>"in-app-notification-automation-action-triggered"!==e.getType()||i)),o=[];return[h.oA(n.map((e=>{const i=e.getValue();if(!i)return null;if(i.invalid)return null;if("page_grouping"!==T){if("mentions"===t.type&&i.visited)return null;if("archive"===t.type&&!i.visited)return null}const n=ge.sl(e);if(!n||!n.isReady())return null;const s=n.getModel();return s?s.invalid?(o.push(i),null):{activity:s,notification:i}:(o.push(i),null)}))),o]}),[k,C,T,t.type]),_=(0,a.VK)((()=>x.state),[x]),R=(0,a.VK)((()=>Ce.Fz()),[]),N=(0,a.VK)((()=>Ce.$x(w,t.type)),[w,t.type]),B=0===N.size,O=(0,n.useCallback)((()=>{if(!C||i)return null;if(!k)return null;const e=[];if("time_grouping"===T){const t=Ce.mx();let i;w.forEach(((n,o,s)=>{let{activity:a,notification:r}=n;const d={source:v,tab:b,notification:r},l=Number(r.end_time),c=t.findIndex((e=>{const{cutoffTime:t}=e;return void 0===t||t<=l}));if(c!==i){const n=t[c].name;e.push((0,W.jsx)(Ae,{groupName:n})),i=c}e.push((0,W.jsx)(me.LazyActivityNotification,{activity:a,rootStore:C,isFirst:!1,isLast:!1,tabArgs:d,useInboxRedesign:!0},a.id))}))}else if("comment_page_time_grouping"===T){const t=Ce.mx();let i;const n=t.map((e=>({...e,notificationsWithActivity:[],notificationGroups:[]})));w.forEach(((e,o,s)=>{let{activity:a,notification:r}=e;const d=Number(r.end_time),l=t.findIndex((e=>{const{cutoffTime:t}=e;return void 0===t||t<=d}));l!==i&&(i=l),n[l].notificationsWithActivity.push({activity:a,notification:r})}));const o=n.map((e=>{const{notificationsWithActivity:t}=e,i=g.vM(t,(e=>{let{notification:t}=e;return"commented"===t.type?`page-comment-group:${t.navigable_block_id??t.id}`:t.id})),n=[];return i.forEach((e=>{var t;const i=[...e].sort(((e,t)=>Number(t.notification.end_time)-Number(e.notification.end_time))),o=Number(null===(t=i.at(0))||void 0===t?void 0:t.notification.end_time)??Date.now();n.push({type:i.length>1?"page-comment-group":"no-group",end_time:o,notifications:i})})),{...e,notificationGroups:n}}));o.forEach(((i,n)=>{i.notificationGroups.length>0&&e.push((0,W.jsx)(Ae,{groupName:t[n].name})),i.notificationGroups.forEach((t=>{if("page-comment-group"===t.type){const i=new Set,n=t.notifications.filter((e=>{let{notification:t,activity:n}=e;if("commented"!==t.type)return!0;const o=t.discussion_id;return void 0!==o&&!i.has(o)&&(i.add(o),!0)})).filter((e=>{let{notification:t}=e;return("unread_only"!==R||!t.visited)&&!("archived_only"===R&&!t.visited)}));n.length>2?e.push((0,W.jsx)(le,{notificationActivityPairs:n,isFirst:!1,isLast:!1,rootStore:C,tabArgs:{source:v,tab:b}})):n.forEach((t=>{let{activity:i,notification:n}=t;return e.push((0,W.jsx)(me.LazyActivityNotification,{activity:i,rootStore:C,isFirst:!1,isLast:!1,tabArgs:{source:v,tab:b,notification:n},useInboxRedesign:!0},i.id))}))}else"no-group"===t.type&&t.notifications.forEach((t=>{let{activity:i,notification:n}=t;return e.push((0,W.jsx)(me.LazyActivityNotification,{activity:i,rootStore:C,isFirst:!1,isLast:!1,tabArgs:{source:v,tab:b,notification:n},useInboxRedesign:!0},i.id))}))}))}))}else"none"===T?w.forEach((t=>{let{activity:i,notification:n}=t;const o={source:v,tab:b,notification:n};e.push((0,W.jsx)(me.LazyActivityNotification,{activity:i,rootStore:C,isFirst:!1,isLast:!1,tabArgs:o,useInboxRedesign:!1},i.id))})):"page_grouping"===T?e.push((0,W.jsx)(me.LazyNotificationGroups,{notifications:N,rootStore:C,source:v,tab:b})):(0,p.t1)(T);return e}),[C,i,k,T,w,v,b,R,N]);return(0,n.useEffect)((()=>{if(!C)return;!function(e,t,i){const n=e.filter((e=>!e.read));0!==n.length&&y.createAndCommit({userAction:"NotificationUpdates.unreadNotificationNotRendered",environment:i,perform:e=>{for(const i of n)m.$h({notification:i,rootStore:t,transaction:e,read:!0})}})}(L,C,M);const e=w.some((e=>{let{notification:t}=e;return!t.read&&!t.visited})),t=e&&w.some((e=>{let{notification:t}=e;return t.read&&!t.visited}));switch(R){case"unread_and_read":case"unread_only":V.ZP.setState({...A,currentTab:"mentions",isCurrentTabEmpty:B,containsBothReadAndUnreadNotifications:t,containsUnreadNotifications:e,showOnlyUnreadNotifications:"unread_only"===R,unreadNotificationIds:[]});break;case"archived_only":V.ZP.setState({...A,isCurrentTabEmpty:B,currentTab:"archive"});break;case"all_updates":break;default:(0,p.t1)(R)}}),[R,A,B,w,C,M,L]),!C||i?(0,W.jsx)("div",{style:Re(l,M,S),children:(0,W.jsx)(u.FormattedMessage,{defaultMessage:"Something went wrong.",id:"notificationUpdates.unknownErrorMessage"})}):k?(0,W.jsxs)("div",{style:B?Re(l,M,S):_e(l,M),children:[B&&f,(0,W.jsx)("section",{role:"feed",className:"notranslate",children:O()}),(0,W.jsx)(ce.Z,{onChange:e=>{if("closed"===Ce.T6())return null;e<200&&k&&k.length>=_&&x.setState(k.length+20)},children:!k&&(0,W.jsx)(he.B,{areaHeight:window.innerHeight})})]}):(0,W.jsx)("div",{style:_e(l,M),children:(0,W.jsx)(he.B,{areaHeight:window.innerHeight})})}function Oe(e){let{request:t,error:i,result:n,ready:o,requestId:s,type:a,empty:r,source:d,tab:l,sizeStore:c}=e;const u=(0,W.jsx)(Be,{type:a,empty:r,source:d,tab:l,sizeStore:c,request:t,error:i,result:n,ready:o});return je.setState({request:t,result:n}),(0,W.jsx)(ue.o,{requestId:s,children:u})}function Ze(e){let{type:t,empty:i,source:n,tab:o,sizeStore:r,checkpointStore:d}=e;const l=(0,s.O7)(),{currentUserStore:c,currentSpaceStore:u}=(0,a.VK)((()=>be.default.state),[]),h=(0,a.VK)((()=>r.state),[r]),g=(0,a.VK)((()=>d.state),[d]),m=(0,a.VK)((()=>"unread_only"===Ce.Fz()),[]),y=(0,a.VK)((()=>(0,F.B7)(l)),[l]);if(!c||!u)return null;const v=u.id,b=c.id;return(0,W.jsx)(pe.Z,{throttle:1e3,request:{spaceId:v,size:h,type:t,showOnlyUnreadNotifications:m,checkpoint:g},performRequest:async e=>{let{spaceId:t,size:i,type:n,showOnlyUnreadNotifications:o}=e;const s=V.ZP.startLoading();if(ke.B(s,{size:i,type:n}),"time_grouping"===y){const e=await f.getNotificationLogPrototype(l,{spaceId:t,size:i,type:Le(n,o),prototypeVariant:"comment_grouping_only"});if(V.ZP.endLoading(s),"failed"===e.type)throw e.error;return{notificationIds:e.data.notificationIds,requestId:s}}if("comment_page_time_grouping"===y){const e=await f.getNotificationLogPrototype(l,{spaceId:t,size:i,type:Le(n,o),prototypeVariant:"no_grouping"});if(V.ZP.endLoading(s),"failed"===e.type)throw e.error;return{notificationIds:e.data.notificationIds,requestId:s}}if("page_grouping"===y){const e=await f.getNotificationLogV2(l,{spaceId:t,size:i,type:Le(n,o)});if(V.ZP.endLoading(s),"failed"===e.type)throw e.error;return Me.default.setState({...Me.default.state,discussionIdToExpansionStartPointMap:e.data.discussionIdToExpansionStartPointMap}),{notificationIds:e.data.notificationIds,requestId:s}}if("none"===y){const e=await f.getNotificationLogV2(l,{spaceId:t,size:i,type:Le(n,o),variant:"no_grouping"});if(V.ZP.endLoading(s),"failed"===e.type)throw e.error;return{notificationIds:e.data.notificationIds,requestId:s}}(0,p.t1)(y)},render:(e,s,a)=>(0,W.jsx)(Oe,{type:t,empty:i,source:n,tab:o,sizeStore:r,request:{spaceId:v,userId:b,type:t},error:e,result:null==s?void 0:s.notificationIds,ready:a,requestId:null==s?void 0:s.requestId})})}},5758:(e,t,i)=>{i.d(t,{u_:()=>X,Qy:()=>Y,Tt:()=>q});var n=i(67294),o=i(480),s=i(86628),a=i(24405),r=i(97439),d=i(6637),l=i(53392),c=i(25651),u=i(80503),h=i(9291),p=i(1898),g=i(37810),f=i(19719),m=i(17659),y=i(84708),v=i(11066),b=i(31945),x=i(73063),S=i(58261),M=i(53336),C=i(43145),j=i(26388),k=i(82598),I=i(55064),A=i(22165),T=i(43250),w=i(41549),L=i(48276),_=i(9972),R=i(16746),N=i(74948),B=i(24646),O=i(34859),Z=i(80444),P=i(24042),F=i(4761),V=i(50770),z=i(90797),U=i(76386),K=i(66160),E=i(23063),D=i(34700),H=i(85893);function W(){const e=(0,o.O7)(),t=(0,o.Fy)(),{isElectronMac:i}=t,n=(0,s.VK)((()=>P.Z.state.isShowingTabBar),[]),r=(0,s.VK)((()=>!n&&!(0,B.in)(e)&&i),[e,n,i]),d=(0,a.yK)((()=>({container:{...(0,D.X)({drag:i&&!n}),display:"flex",justifyContent:"flex-end",alignItems:"center",paddingRight:11,height:u.br,flexShrink:0}})),[i,n]);return r?(0,H.jsx)(E.Z,{animationStyle:{height:r?u.br:0},render:()=>(0,H.jsx)("div",{style:d.container}),isVisible:!0}):null}function G(){const e=(0,a.yK)((e=>({button:{display:"flex",justifyContent:"center",alignItems:"center",gap:6,height:36,width:174,position:"absolute",left:"50%",marginLeft:-87,bottom:12,zIndex:20,borderRadius:18,background:e.blueColor,color:e.white,boxShadow:e.buttonBoxShadow,fontSize:14},hovered:{background:e.blueButtonHoveredBackground},pressed:{background:e.blueButtonPressedBackground},icon:{width:16,height:16}})),[]);return(0,H.jsxs)(v.Z,{style:e.button,hoveredStyle:e.hovered,pressedStyle:e.pressed,href:"https://dev.notion.so/notion/346c06d81dbf4cf188bf44fcef6a6a62?v=fa0376c6fb2a40f0b77d68b683f73e5b&pvs=4",external:!0,children:[(0,c.R)(e.icon),(0,H.jsx)("div",{children:"Provide Feedback"})]})}function q(e){const{containerStyle:t}=e,i=(0,o.O7)(),d=(0,o.Fy)(),l=(0,h.useIntl)(),c=(0,s.VK)((()=>(0,V.z_)(i)),[i]),p=(0,s.VK)((()=>"overlay_and_pinning"===(0,V.me)(i)),[i]),v=(0,s.VK)((()=>{const{currentSpaceStore:e}=Z.default.state;if(e)return e.id}),[]),b=(0,s.VK)((()=>!1),[]),x=(0,s.VK)((()=>"inbox"===R.Z.state.contentType&&R.Z.state.isResizerHovered&&R.Z.isOpen()),[]),S=(0,s.VK)((()=>(0,u.R6)(d.isElectronMac)),[d]),j=(0,s.VK)((()=>L.l_()),[]),k=(0,s.VK)((()=>R.Z.state.mode),[]),N=(0,n.useCallback)((e=>{f.lh(i,{mode:e})}),[i]),B=(0,s.VK)((()=>w.Fz()),[]),P=(0,a.yK)((e=>{const i={transition:"box-shadow 300ms ease",boxShadow:x?e.secondarySidebarResizerBoxShadow:e.secondarySidebarBoxShadow};return{container:{flexDirection:"column",...t},header:{cursor:"auto",width:"100%"},scroller:{position:"relative",minHeight:0,display:"flex",flexDirection:"column",marginRight:0,pointerEvents:"auto",width:"100%",..."peek"===k?{}:{minWidth:j}},emptyState:{marginTop:100,cursor:"auto"},editorEmptyState:{background:e.contentBackground,display:"flex",flexDirection:"column",width:"100%",height:"100%",fontSize:26,alignItems:"center",justifyContent:"center",color:e.lightTextColor,fontWeight:500},editorEmptyStateIcon:{width:80,height:80,fill:e.lightTextColor},sidebarToggleAndFilterTitleContainer:{display:"flex",gap:4},inboxFilterTitle:{display:"flex",alignItems:"center",height:24,fontSize:14,fontWeight:g.Z.fontWeight.semibold,...c&&{paddingLeft:1}},expandSidebar:{marginLeft:-4},inboxActionsContainer:{display:"flex",justifyContent:"center",alignItems:"center",gap:p?2:10},headerContainer:{display:"flex",justifyContent:"space-between",alignItems:"center",height:S,paddingTop:8,paddingBottom:8,paddingLeft:c?20:16,paddingRight:c?20:16},resizer:{position:"absolute",top:0,right:0,zIndex:1,height:"100%",width:2,...i}}}),[x,S,t,p,c,j,k]);return d.isMobile?null:(0,H.jsxs)("div",{style:P.container,children:[(0,H.jsx)(W,{}),(0,H.jsx)("div",{className:T.JiD,style:P.header,children:(0,H.jsxs)("div",{style:P.headerContainer,children:[(0,H.jsxs)("div",{style:P.sidebarToggleAndFilterTitleContainer,children:[(0,H.jsx)(J,{style:P.expandSidebar}),(0,H.jsx)("div",{style:P.inboxFilterTitle,children:(0,H.jsx)(Y,{filter:B})}),p&&(0,H.jsx)($,{})]}),(0,H.jsxs)("div",{style:P.inboxActionsContainer,children:[("unread_and_read"===B||"unread_only"===B)&&(0,H.jsx)(z.p,{}),p?(0,H.jsx)(_.M,{peekModeTooltipMessage:l.formatMessage({id:"inbox.turnPanelModeOnButton.tooltip",defaultMessage:"Turn on panel mode"}),panelModeTooltipMessage:l.formatMessage({id:"inbox.turnPanelModeOffButton.tooltip",defaultMessage:"Turn off panel mode"}),onClick:N}):(0,H.jsx)($,{}),(0,H.jsx)(A.C,{shouldHide:!1,icon:r.D,caption:l.formatMessage({id:"notificationSidebar.close.tooltip",defaultMessage:"Close Inbox"}),onClick:()=>{m.qQ({environment:i,open:!1})},keyboardShortcutName:"toggleAllUpdates",isElectron:!1,style:{marginLeft:0}})]})]})}),(0,H.jsxs)(M.Z,{type:O.Z.Y,style:P.scroller,children:[(0,H.jsx)(C.Z,{onChange:(e,t)=>{let{offsetFromTop:i}=t;F.n_.setState(i<=0)}}),"all_updates"!==B?(0,H.jsx)(K.Z,{type:"archived_only"===B?"archive":"mentions",source:"notifications_tab",tab:"inbox",empty:(0,H.jsx)("div",{style:P.emptyState,children:(0,H.jsx)(X,{filter:B})})},B):v&&(0,H.jsx)(y.Z,{spaceId:v,source:"notifications_tab",empty:()=>(0,H.jsx)("div",{style:P.emptyState,children:(0,H.jsx)(X,{filter:B})})},B)]}),(0,H.jsx)("div",{style:P.resizer}),(0,H.jsx)(I.Z,{type:"secondary_sidebar"}),b&&(0,H.jsx)(G,{})]})}function Y(e){const{filter:t}=e;switch(t){case"unread_and_read":return(0,H.jsx)(h.FormattedMessage,{id:"inbox.unreadAndUnreadFilter.title",defaultMessage:"Inbox"});case"unread_only":return(0,H.jsx)(h.FormattedMessage,{id:"inbox.unreadOnlyFilter.title",defaultMessage:"Unread"});case"archived_only":return(0,H.jsx)(h.FormattedMessage,{id:"inbox.archivedFilter.title",defaultMessage:"Archived"});case"all_updates":return(0,H.jsx)(h.FormattedMessage,{id:"inbox.allUpdatesFilter.title",defaultMessage:"All workspace updates"});default:return(0,p.t1)(t)}}function X(e){let{filter:t}=e;switch(t){case"unread_and_read":case"unread_only":return(0,H.jsx)(k.Z,{message:(0,H.jsx)(h.FormattedMessage,{defaultMessage:"You'll be notified here for @mentions, page activity, and page invites",id:"inbox.filterEmptyState.nonArchivedMessage"}),title:(0,H.jsx)(h.FormattedMessage,{defaultMessage:"You're all caught up",id:"inbox.filterEmptyState.nonArchivedTitle"})});case"archived_only":return(0,H.jsx)(k.Z,{message:(0,H.jsx)(h.FormattedMessage,{defaultMessage:"Any Inbox updates you archived will show up here.",id:"inbox.filterEmptyState.archivedMessage"}),title:(0,H.jsx)(h.FormattedMessage,{defaultMessage:"No archived updates",id:"inbox.filterEmptyState.archivedTitle"})});case"all_updates":return(0,H.jsx)(k.Z,{message:(0,H.jsx)(h.FormattedMessage,{defaultMessage:"Any activity in the workspace will show up here.",id:"inbox.filterEmptyState.allPagesMessage"}),title:(0,H.jsx)(h.FormattedMessage,{defaultMessage:"No activity in the workspace",id:"inbox.filterEmptyState.allPagesTitle"})});default:(0,p.t1)(t)}}function $(){const e=(0,h.useIntl)(),t=(0,s.VK)((()=>w.Fz()),[]),i=(0,a.yK)((e=>({button:{display:"flex",alignItems:"center",gap:6,borderRadius:4,paddingLeft:8,paddingRight:8,height:24},icon:{height:16,width:16,fill:"unread_and_read"===t?e.mediumIconColor:e.blueColor}})),[t]),n=e.formatMessage({defaultMessage:"Filter notifications",id:"inbox.filterButton.tooltip"});return(0,H.jsx)(b.ZP,{popupType:b.Z4.Popup,renderOrigin:e=>{let{onClick:t}=e;return(0,H.jsx)(j.ZP,{renderTooltip:()=>n,placement:j.ug.Bottom,alignment:j.v2.Start,delayThreshold:0,originGap:6,render:e=>(0,H.jsx)(x.Z,{ariaLabel:n,icon:d.I,iconStyle:i.icon,onClick:t,className:T.exn,...e})})},render:e=>(0,H.jsx)(U.J,{closePopup:e.close}),alignmentToOrigin:b.vR.Start,originGap:2})}function J(e){const{style:t}=e,i=(0,o.O7)(),n=(0,h.useIntl)(),r=(0,s.VK)((()=>{const e=P.Z.state.isShowingTabBar;return!(0,B.in)(i)&&!e}),[i]),d=(0,a.yK)((e=>({icon:{width:16,height:16},keyboardShortcut:{color:e.mediumInvertedTextColor}})),[]),c=n.formatMessage({defaultMessage:"Lock sidebar open",id:"sidebarExpandButton.tooltip"});return r?(0,H.jsx)(j.ZP,{renderTooltip:()=>(0,H.jsxs)("div",{children:[(0,H.jsx)("div",{children:c}),(0,H.jsx)(S.Z,{style:d.keyboardShortcut,name:"toggleSidebar"})]}),placement:j.ug.Bottom,alignment:j.v2.Start,delayThreshold:0,originGap:6,render:e=>(0,H.jsx)(x.Z,{ariaLabel:c,icon:l.K,iconStyle:d.icon,onClick:()=>N.setExpand({environment:i,isExpanded:!0,from:"topbar_sidebar_button"}),style:t,className:T.exn,...e})}):null}},45428:(e,t,i)=>{i.r(t),i.d(t,{getNotificationValues:()=>l,getState:()=>d,setState:()=>r});var n=i(70921),o=i(65311),s=i(80444);let a={};function r(e){a={...a,...e}}function d(){return a}function l(){const e=a.result;if(!e)return null;const t=s.default.state.currentSpaceStore;return t?e.map((e=>{const i={table:o.uX,id:e,spaceId:t.getSpaceId()},s=t.getRecordValue(i),a=null==s?void 0:s.activity_id;if(a&&s){const e={table:n.TY,id:a,spaceId:t.getSpaceId()};s.activity=t.getRecordValue(e)}return s})):null}},70564:(e,t,i)=>{i.d(t,{B:()=>s,L:()=>a});var n=i(18245);const o={};function s(e,t){e in o||(o[e]={measured:!1,startTime:performance.now(),size:t.size,type:t.type})}function a(e,t){if(!(e in o))return;const i=o[e];if(i.measured)return;i.measured=!0;const{startTime:s,size:a,type:r}=i;n.default.measure({metricName:"notification_render",startTime:s},{environment:t,data:{size:a,type:r}})}},9972:(e,t,i)=>{i.d(t,{M:()=>h});var n=i(67294),o=i(86628),s=i(24405),a=i(32240),r=i(73063),d=i(26388),l=i(75419),c=i(16746),u=i(85893);function h(e){const{peekModeTooltipMessage:t,panelModeTooltipMessage:i,onClick:h,isLarge:p}=e,g=(0,o.VK)((()=>c.Z.state.mode),[]),f=(0,n.useCallback)((()=>{const e=l.bP();h&&h(e)}),[h]),m=(0,s.yK)((e=>({panelModeIcon:{transform:"rotate(180deg)",..."panel"===g&&{fill:e.blueColor},...p&&{height:18,width:18}},panelModeButton:{...p&&{height:26,width:26}}})),[g,p]),y="peek"===g?t:i;return(0,u.jsx)(d.ZP,{renderTooltip:()=>y,placement:d.ug.Bottom,alignment:d.v2.Start,delayThreshold:0,originGap:6,render:e=>(0,u.jsx)(r.Z,{ariaLabel:y,icon:a.y,style:m.panelModeButton,iconStyle:m.panelModeIcon,onClick:f,...e})})}},44904:(e,t,i)=>{i.d(t,{o:()=>o});var n=i(49085);class o extends n.default{getInitialState(){return{activityIds:[],shouldLoadNewerActivities:!1,shouldLoadOlderActivities:!0,hasOlderActivities:!0,filterActivityTypes:[],filterDateRange:{starting:void 0,ending:void 0}}}}},5686:(e,t,i)=>{i.d(t,{J:()=>s});i(67294);var n=i(45238),o=i(85893);const s=(0,n.IU)("mailOpen",{viewBox:"0 0 16 16",svg:(0,o.jsx)("path",{d:"M2.88965 15.9277C2.17415 15.9277 1.63639 15.75 1.27637 15.3945C0.920898 15.0436 0.743164 14.515 0.743164 13.8086V7.00684C0.743164 6.76074 0.756836 6.54427 0.78418 6.35742C0.816081 6.17057 0.863932 6.00423 0.927734 5.8584C0.996094 5.71257 1.08496 5.57812 1.19434 5.45508C1.30371 5.32747 1.43815 5.19987 1.59766 5.07227L6.88184 0.916016C7.12793 0.715495 7.36035 0.558268 7.5791 0.444336C7.80241 0.325846 8.03939 0.266602 8.29004 0.266602C8.54069 0.266602 8.77539 0.325846 8.99414 0.444336C9.21745 0.558268 9.45215 0.715495 9.69824 0.916016L14.9824 5.07227C15.1419 5.19987 15.2764 5.32747 15.3857 5.45508C15.4951 5.57812 15.5817 5.71257 15.6455 5.8584C15.7139 6.00423 15.7617 6.17057 15.7891 6.35742C15.821 6.54427 15.8369 6.76074 15.8369 7.00684V13.8086C15.8369 14.515 15.6569 15.0436 15.2969 15.3945C14.9414 15.75 14.4059 15.9277 13.6904 15.9277H2.88965ZM2.84863 14.8818H13.7314C14.0687 14.8818 14.3285 14.7907 14.5107 14.6084C14.6976 14.4307 14.791 14.1641 14.791 13.8086V6.82227C14.791 6.6582 14.7751 6.51921 14.7432 6.40527C14.7113 6.29134 14.6611 6.19108 14.5928 6.10449C14.529 6.01335 14.4424 5.92448 14.333 5.83789L9.11035 1.76367C8.94173 1.63607 8.80046 1.53809 8.68652 1.46973C8.57259 1.39681 8.44043 1.36035 8.29004 1.36035C8.13965 1.36035 8.00749 1.39681 7.89355 1.46973C7.77962 1.53809 7.63835 1.63607 7.46973 1.76367L2.24707 5.83789C2.1377 5.92448 2.04883 6.01335 1.98047 6.10449C1.91667 6.19108 1.86882 6.29134 1.83691 6.40527C1.80501 6.51921 1.78906 6.6582 1.78906 6.82227V13.8086C1.78906 14.1641 1.88021 14.4307 2.0625 14.6084C2.24479 14.7907 2.50684 14.8818 2.84863 14.8818ZM1.51562 14.6357L6.88184 9.37207C7.11882 9.13509 7.35352 8.96419 7.58594 8.85938C7.82292 8.75456 8.06217 8.70215 8.30371 8.70215C8.54525 8.70215 8.78223 8.75456 9.01465 8.85938C9.24707 8.96419 9.48405 9.13509 9.72559 9.37207L15.085 14.6357L14.374 15.3467L9.13086 10.1787C8.98047 10.0283 8.83691 9.92122 8.7002 9.85742C8.56803 9.78906 8.43587 9.75488 8.30371 9.75488C8.16699 9.75488 8.03027 9.78906 7.89355 9.85742C7.76139 9.92122 7.6224 10.0283 7.47656 10.1787L2.2334 15.3467L1.51562 14.6357ZM5.81543 10.6094L1.5498 6.3916L2.26074 5.68066L6.5332 9.90527L5.81543 10.6094ZM10.0742 9.90527L14.3398 5.68066L15.0508 6.3916L10.7852 10.6094L10.0742 9.90527Z"})})},59078:(e,t,i)=>{i.d(t,{W:()=>s});i(67294);var n=i(45238),o=i(85893);const s=(0,n.IU)("sidebarInbox",{viewBox:"0 0 20 20",svg:(0,o.jsx)("path",{d:"M4.61084 16.0537C3.90837 16.0537 3.37305 15.8717 3.00488 15.5078C2.64095 15.1481 2.45898 14.6191 2.45898 13.9209V10.1504C2.45898 9.89225 2.47168 9.67432 2.49707 9.49658C2.52669 9.31462 2.57536 9.15169 2.64307 9.00781C2.71077 8.86393 2.80387 8.71794 2.92236 8.56982L4.94092 6.09424C5.20752 5.76416 5.44238 5.50602 5.64551 5.31982C5.85286 5.12939 6.07715 4.99609 6.31836 4.91992C6.5638 4.83952 6.88118 4.79932 7.27051 4.79932H12.7358C13.1252 4.79932 13.4404 4.83952 13.6816 4.91992C13.9271 4.99609 14.1514 5.12939 14.3545 5.31982C14.5576 5.50602 14.7946 5.76416 15.0654 6.09424L17.0776 8.56982C17.2004 8.71794 17.2956 8.86393 17.3633 9.00781C17.431 9.15169 17.4775 9.31462 17.5029 9.49658C17.5283 9.67432 17.541 9.89225 17.541 10.1504V13.9209C17.541 14.6191 17.359 15.1481 16.9951 15.5078C16.6312 15.8717 16.098 16.0537 15.3955 16.0537H4.61084ZM4.69971 14.6445H15.3066C15.5817 14.6445 15.7912 14.5747 15.9351 14.4351C16.0832 14.2912 16.1572 14.0711 16.1572 13.7749V10.7852H12.4946C12.4142 11.1533 12.2576 11.4813 12.0249 11.769C11.7964 12.0568 11.5086 12.2853 11.1616 12.4546C10.8146 12.6196 10.4274 12.7021 10 12.7021C9.57682 12.7021 9.19173 12.6196 8.84473 12.4546C8.49772 12.2896 8.20785 12.0632 7.9751 11.7754C7.74235 11.4834 7.58789 11.1533 7.51172 10.7852H3.84277V13.7749C3.84277 14.0711 3.91471 14.2912 4.05859 14.4351C4.20671 14.5747 4.42041 14.6445 4.69971 14.6445ZM10 11.4072C10.2751 11.4072 10.512 11.3395 10.7109 11.2041C10.9098 11.0687 11.0643 10.8973 11.1743 10.6899C11.2843 10.4784 11.3394 10.2646 11.3394 10.0488V10.0298C11.3394 9.90706 11.3774 9.79915 11.4536 9.70605C11.5298 9.60872 11.6525 9.56006 11.8218 9.56006H15.8335C15.9351 9.56006 15.9964 9.52409 16.0176 9.45215C16.043 9.38021 16.0303 9.3125 15.9795 9.24902L13.7197 6.43701C13.5885 6.26774 13.4447 6.14502 13.2881 6.06885C13.1315 5.98844 12.9495 5.94824 12.7422 5.94824H7.25781C7.05469 5.94824 6.87484 5.98844 6.71826 6.06885C6.56169 6.14502 6.41569 6.26774 6.28027 6.43701L4.0332 9.24902C3.97819 9.3125 3.96126 9.38021 3.98242 9.45215C4.00781 9.52409 4.07129 9.56006 4.17285 9.56006H8.18457C8.35384 9.56006 8.47656 9.60872 8.55273 9.70605C8.62891 9.79915 8.66699 9.90706 8.66699 10.0298V10.0488C8.66699 10.2646 8.71989 10.4784 8.82568 10.6899C8.93571 10.8973 9.09017 11.0687 9.28906 11.2041C9.48796 11.3395 9.72493 11.4072 10 11.4072Z"})})},41219:(e,t,i)=>{i.d(t,{L:()=>s});i(67294);var n=i(45238),o=i(85893);const s=(0,n.IU)("topbarComment",{viewBox:"0 0 20 20",svg:(0,o.jsx)("path",{d:"M5.9375 18.4844C6.38281 18.4844 6.71094 18.2656 7.25 17.7891L9.92969 15.4297H14.6328C16.9844 15.4297 18.3047 14.0703 18.3047 11.75V5.67969C18.3047 3.35938 16.9844 2 14.6328 2H4.67188C2.32812 2 1 3.35938 1 5.67969V11.75C1 14.0781 2.36719 15.4297 4.61719 15.4297H4.9375V17.3438C4.9375 18.0391 5.30469 18.4844 5.9375 18.4844ZM6.32812 16.7344V14.5078C6.32812 14.0469 6.125 13.8672 5.6875 13.8672H4.72656C3.25781 13.8672 2.55469 13.125 2.55469 11.7031V5.72656C2.55469 4.30469 3.25781 3.5625 4.72656 3.5625H14.5859C16.0469 3.5625 16.75 4.30469 16.75 5.72656V11.7031C16.75 13.125 16.0469 13.8672 14.5859 13.8672H9.84375C9.36719 13.8672 9.13281 13.9453 8.80469 14.2891L6.32812 16.7344Z"})})}}]);