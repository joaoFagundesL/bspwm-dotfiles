"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[5691],{26907:(e,t,i)=>{function n(e){const{target:t,inviteTargetsStore:i}=e;return i.state.inviteTargets.some((e=>"newUser"===t.type?e.type===t.type&&t.value.email===e.value.email:"invalidUser"===t.type?e.type===t.type&&t.value.text===e.value.text:e.type===t.type&&e.value.id===t.value.id))}function r(e){return"invalidUser"!==e.type}function s(e){const{inviteTargetsStore:t}=e,{inviteTargets:i}=t.state;return i.filter(r)}i.d(t,{B:()=>s,H:()=>n})},22508:(e,t,i)=>{i.d(t,{Co:()=>j,E6:()=>x,GZ:()=>b,TW:()=>M,Uw:()=>C,YQ:()=>w,rw:()=>T});i(57658),i(67294);var n=i(33728),r=i(68626),s=i(72141),o=i(9291),a=i(57347),l=i(52629),c=i(7032),u=i(81918),d=i(54642),v=i(76464),g=i(95209),m=i(64964),p=i(19306),f=i(26907),I=i(46654),y=i(95697),S=i(88893),h=i(35057),_=i(73466),k=i(85893);async function x(e){const{environment:t,onInviteComplete:i,flowId:n,intl:s,spaceStore:o,invitedUsers:c,inviteTargetsStore:d,inviteOrigin:v,disable_invite_email:g}=e;let m={success:!1};try{m=await w({environment:t,spaceStore:o,invitedUsers:c,from:v,flowId:n,intl:s,inviteTargetsStore:d,disable_invite_email:g}),m.success?u.pR(t,{invited_user_count:Object.keys(m.invitedUsers).length,invite_flow_id:n,origin:v}):(u.S4(t,{invite_stage:"invite_member",invite_flow_id:n,error:m.error}),r.log({level:"error",from:"personPropertyInviteAction",type:"handleMemberInvite"}))}catch(p){const e=(0,a.t)(p);u.S4(t,{invite_stage:"invite_member",invite_flow_id:n,error:e}),r.log({level:"error",from:"personPropertyInviteAction",type:"handleMemberInvite",error:(0,l.Ui)(p)})}finally{null==i||i(m)}}async function b(e){const{environment:t,blockStore:i,inviteTargetsStore:o,sudoModeStore:d,onInviteComplete:g,inviteOrigin:m,role:p,emailMessage:y,flowId:S}=e;let h={success:!1};try{if(h=await async function(e){const{environment:t,blockStore:i,sudoModeStore:r,inviteTargetsStore:o,role:a,inviteOrigin:l,emailMessage:u,onInviteStart:d}=e,g=e.flowId||(0,c.ZP)();if(!(0,s.iC)(a))return{success:!1};const{tokenQuery:m,inviteTargets:p}=o.state;if((0,n.oH)(m.trim())&&0===p.length){const e={type:"newUser",value:{email:m.trim()},source:"email"};f.H({target:e,inviteTargetsStore:o})||o.setState({inviteTargets:[...o.state.inviteTargets,e],tokenQuery:""})}const y=await I.mU(i,f.B({inviteTargetsStore:o}));null==d||d();const S=await v.n_({environment:t,store:i,sudoModeStore:r,inviteTargets:y,inviteRole:a,isOnboarding:!1,invite:{inviteFlowId:g,inviteMessage:u,inviteOrigin:l}});return S}({environment:t,blockStore:i,sudoModeStore:d,inviteTargetsStore:o,role:p,emailMessage:y,inviteOrigin:m,flowId:S}),!h.success)return}catch(_){const e=(0,a.t)(_);u.S4(t,{invite_stage:"invite_guest",invite_flow_id:S,error:e}),r.log({level:"error",from:"personPropertyInviteAction",type:"handleGuestInvite",error:(0,l.Ui)(_)})}finally{h.success&&u.Vi(t,{invited_user_count:Object.keys(h.invitedUsers).length,origin:m,invite_flow_id:S}),null==g||g(h)}return h}async function T(e){const{environment:t,spaceStore:i,originId:n,originType:s,reasonMessage:o,intl:l,flowId:c,onInviteComplete:v,invitedUsers:g,inviteOrigin:f}=e,I=[];let y={success:!1};try{const e=Object.entries(g).map((e=>{let[r,a]=e;return d.requestAccess(t,{type:"actor-to-space",forActorId:a,spaceId:i.id,message:o,attributes:{origin_id:n,origin_type:s,origin_table:"block",add_permissions_on_approval:!1}}).catch((()=>I.push([r,a])))}));await Promise.all(e),y={success:!0,invitedUsers:g,requestedUsers:{}}}catch(S){const e=(0,a.t)(S);return u.S4(t,{invite_stage:"request_member",invite_flow_id:c,error:e}),function(e,t){const i=Object.keys(t);if(0===i.length)return;m.oV({label:e.formatMessage({id:"contextual_invite.request_members_failure",defaultMessage:"Failed to request {users} to become members"},{users:(0,p.W)(i)})})}(l,g),r.log({level:"error",from:"personPropertyInviteAction",type:"handleMemberRequest",data:{miscDataToConvertToString:{inviteTargetEmailsWithErrors:I}}}),y}finally{y.success&&u.TJ(t,{invited_user_count:Object.keys(y.invitedUsers).length,origin:f,invite_flow_id:c}),null==v||v(y)}return y}async function w(e){const{environment:t,spaceStore:i,from:n,invitedUsers:s,intl:o,flowId:a,onInviteStart:l,inviteTargetsStore:c,disable_invite_email:u}=e,d=function(e){const t=[];if(!e)return t;for(const[i,n]of Object.entries(e))t.push({type:"existingUser",value:{id:n,email:i,version:1}});return t}(s),g=function(e){return e.state.inviteTargets.filter((e=>"newUser"===e.type))}(c),f=[...d];for(const r of g){d.some((e=>e.value.email===r.value.email))||f.push(r)}const I=(0,h.zt)(),k=I&&(0,S.o9)(I)?"editor":e.inviteRole??"read_and_write";let x={success:!1};if((0,y.$)(t)){if(!(await _.HD({environment:t,flowId:a,trackCreateTeamComplete:!1})))return x}try{null==l||l(),x=await v.n_({environment:t,store:i,inviteTargets:f,inviteRole:k,isOnboarding:!1,invite:{inviteOrigin:n,inviteFlowId:a,disable_invite_email:u}})}catch(b){return function(e,t){0!==t.length&&m.oV({label:e.formatMessage({id:"contextual_invite.contextual_invite_failure",defaultMessage:"Failed to invite to {users} as members"},{users:(0,p.W)(t.flatMap((e=>e.value.email||[])))})})}(o,f),r.log({level:"error",from:"contextualInviteHelpers",type:"inviteMembers.inviteTargets",data:{miscDataToConvertToString:{usersToInviteAsMembers:f}}}),x}return x}async function C(e){const{environment:t,inviteTargetsStore:i,allowShowEmptyError:r,personPropertyInviteStore:s}=e,o=i.state.tokenQuery;if(""===o)return void(0===i.state.inviteTargets.length&&r&&s.setState({...s.state,showEmptyError:!0}));const a=(0,n.CU)(o),l=await g.M5(t,a);let c=[];0===l.length&&(c=[{type:"invalidUser",value:{text:o}}]);const u=l.filter((e=>!f.H({inviteTargetsStore:i,target:e}))),d=[...i.state.inviteTargets,...u,...c];i.setState({...i.state,inviteTargets:d,tokenQuery:""})}function j(e){const{email:t,inviteTargetsStore:i}=e,n={type:"newUser",value:{email:t},source:"email"},r=[...i.state.inviteTargets];f.H({inviteTargetsStore:i,target:n})||r.push(n),i.setState({...i.state,inviteTargets:r})}function M(e){const{success:t,invitedUserEmails:i,isRequestMember:n}=e;t?0!==i.length&&(n?m.oV({label:(0,k.jsx)(o.FormattedMessage,{id:"shareMenu.inviteSuccess.snackbarMessage.sendMemberRequest",defaultMessage:"Successfully sent request to admin to invite {users}",values:{users:(0,p.W)(i)}})}):m.oV({label:(0,k.jsx)(o.FormattedMessage,{id:"shareMenu.inviteSuccess.snackbarMessage",defaultMessage:"Successfully invited {users}",values:{users:(0,p.W)(i)}})})):m.oV({label:(0,k.jsx)(o.FormattedMessage,{id:"shareMenu.inviteFailure.snackbarMessage",defaultMessage:"Failed to invite {users}",values:{users:(0,p.W)(i)}})})}},35691:(e,t,i)=>{i.r(t),i.d(t,{default:()=>ue,shouldEnableSlackImportsInvite:()=>de});var n=i(67294),r=i(480),s=i(86628),o=i(24405),a=i(41892),l=i(9291),c=i(53965),u=i(81575),d=i(51077),v=i(9019),g=i(56678),m=i(77080),p=i(55899),f=i(35057),I=i(49085),y=i(7032);let S=function(e){return e.SearchInput="search_input",e.NoFocus="no_focus",e}({});class h extends I.default{getInitialState(){return{flowId:(0,y.ZP)(),modalOpen:!1,focus:S.NoFocus}}}const _=h;var k=i(77657),x=i(68626),b=i(57347),T=i(52629),w=i(54642),C=i(78140),j=i(43250),M=i(60709),O=i(80444),Z=i(30874),U=i(29798),K=i(58297),F=i(22508);var L=i(85893);function V(e){const{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:a,onInviteComplete:c,onInviteClick:d}=e,v=(0,r.O7)(),g=(0,l.useIntl)(),m=(0,o.yK)((e=>({footerStyle:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:60,padding:"12px 16px 16px 16px",borderTop:`1px solid ${e.stroke.deemphasized}`}})),[]),p=(0,s.VK)((()=>O.default.state.currentSpaceStore),[]),f=(0,s.VK)((()=>t.state.flowId),[t]),I=(0,s.VK)((()=>i.state.inviteTargets.length),[i]),y=(0,s.VK)((()=>function(e){return 0===e?(0,L.jsx)(l.FormattedMessage,{id:"invite.slack_imports.button.title.no_selected",defaultMessage:"Add members",values:{totalInviteCount:e}}):(0,L.jsx)(l.FormattedMessage,{id:"invite.slack_imports.button.title.selected",defaultMessage:"Add {totalInviteCount} {totalInviteCount, plural, one {member} other {members}}",values:{totalInviteCount:e}})}(I)),[I]),h=(0,n.useCallback)((e=>{const{response:i,invitedUserEmails:n}=e;u.u0(v,{invite_stage:"invite_complete",invite_flow_id:f,origin:a,is_success:i.success,invited_user_count:n.length}),i.success&&t.setState({...t.state,modalOpen:!1}),null==c||c(i),F.TW({success:i.success,invitedUserEmails:n})}),[a,v,f,c,t]),_=(0,n.useCallback)((async()=>{const e=i.state.inviteTargets.filter((e=>"newUser"===e.type||"existingUser"===e.type)).map((e=>e.value.email));if(!p)return null;await async function(e){const{environment:t,onInviteComplete:i,onInviteClick:n,flowId:r,intl:s,spaceStore:o,inviteTargetsStore:a,inviteOrigin:l}=e;let c={success:!1};const d=a.state.inviteTargets.length;try{c=await F.YQ({environment:t,spaceStore:o,from:l,flowId:r,intl:s,inviteTargetsStore:a,onInviteStart:()=>{null==n||n()}})}catch(v){const e=(0,b.t)(v);u.u0(t,{invite_stage:"invite_member",invited_user_count:d,invite_flow_id:r,error:e,origin:l,is_success:!1}),x.log({level:"error",from:"slackImportsInviteActions",type:"handleMemberInvite",error:(0,T.Ui)(v)})}finally{null==i||i(c)}}({environment:v,spaceStore:p,flowId:f,intl:g,inviteTargetsStore:i,inviteOrigin:a,onInviteComplete:t=>h({response:t,invitedUserEmails:e}),onInviteClick:d}),i.reset()}),[p,v,f,i,g,a,d,h]),k=(0,n.useCallback)((async()=>{t.setState({...t.state,focus:S.NoFocus});const e=i.state.inviteTargets.length;u.AK(v,{invited_user_count:e,origin:a,inviteTargets:i.state.inviteTargets.map((e=>e.type.toString())),inviteTokenQuery:i.state.tokenQuery,invite_flow_id:f}),await _()}),[_,v,f,a,t,i]);return(0,L.jsx)("div",{style:m.footerStyle,children:(0,L.jsx)(K.Z,{isLarge:!0,style:{borderRadius:6},onClick:k,disabled:0===I,children:y})})}var A=i(37810),B=i(68785),z=i(64369);function P(e){const{isLoading:t}=e,i=(0,o.yK)((e=>({topContainer:{display:"flex",alignItems:"center",width:"100%",height:40,padding:"0 16px",borderBottom:`1px solid ${e.stroke.deemphasized}`},sendInviteLabel:{color:e.text.primary,fontSize:14,fontWeight:A.Z.fontWeight.medium,textAlign:"left",verticalAlign:"top"}})),[]),n=t?(0,L.jsx)(B.Z,{style:{marginLeft:6}}):null;return(0,L.jsxs)("div",{style:i.topContainer,children:[(0,L.jsx)(z.Z,{style:i.sendInviteLabel,children:(0,L.jsx)(l.FormattedMessage,{id:"invite.slack_imports.header_title",defaultMessage:"Import from Slack"})}),n]})}var R=i(91219),E=i(47082);function Q(e){const{inviteTargetsStore:t,slackImportsInviteStore:i,inviteOrigin:a}=e,c=(0,l.useIntl)(),u=(0,r.O7)(),{tokenQuery:d}=(0,s.VK)((()=>{const{tokenQuery:e}=t.state;return{tokenQuery:e}}),[t]),{focus:v,flowId:g}=(0,s.VK)((()=>({focus:i.state.focus===S.SearchInput,flowId:i.state.flowId})),[i]),m=function(e){const{focus:t}=e;return(0,o.yK)((e=>({searchBar:{padding:16},inputStyle:{minWidth:60,width:"auto",borderTopLeftRadius:4,borderTopRightRadius:4,fontSize:14,fontWeight:A.Z.fontWeight.regular},tokenInputMenuItem:{padding:6,borderRadius:6,height:20,alignItems:"center",minHeight:32,background:e.accentColors.gray[30],...t&&{background:"none"}}})),[t])}({focus:v}),p=c.formatMessage({id:"invite.slack_imports.search.placeholder",defaultMessage:"Search people, emails..."}),I=(0,n.useCallback)((e=>{t.setState({...t.state,tokenQuery:e.target.value}),q({environment:u,flowId:g,subscriptionTier:(0,f.zt)(),origin:a})}),[t,g,a,u]);return(0,L.jsx)("div",{style:m.searchBar,children:(0,L.jsx)(E.Z,{focus:v,onClick:()=>{i.setState({...i.state,focus:S.SearchInput})},format:E.U.Share,value:d,onChange:I,type:"email",tokens:[],autoComplete:"off",placeholder:p,onRemoveLastToken:()=>{},showBorder:!0,style:m.tokenInputMenuItem,inputFullWidth:!0})})}const q=c.Ds((e=>{let{environment:t,flowId:i,subscriptionTier:n,origin:r}=e;R.UW(t,{invite_flow_id:i,subscription_tier:n,invite_origin:r})}),1e3);i(57658);var W=i(59054),H=i(36591),D=i(31701),$=i(95209),N=i(21752),G=i(52275),J=i(61519),Y=i(32163),X=i(43765),ee=i(72495),te=i(69507),ie=i(26907);function ne(e){const{inviteTargetsStore:t,slackImportsInviteStore:i}=e,n=(0,r.O7)(),o=(0,l.useIntl)(),a=(0,s.VK)((()=>t.state.tokenQuery),[t]),c=(0,s.VK)((()=>i.state.flowId),[i]),[{value:u,status:d}]=(0,W.r5)((async()=>$.jL({query:a,sectionLimit:{userLimit:0,botLimit:0,groupLimit:0,importContactLimit:1e3},environment:n,intl:o,membersOnly:!1})),[n,o,a],{debounce:40});return(0,L.jsx)(re,{...e,tokenQuery:a,ready:"pending"!==d,error:"rejected"===d,result:u,flowId:c,environment:n})}function re(e){const{inviteTargetsStore:t,slackImportsInviteStore:i,tokenQuery:n,error:r,ready:a,result:c,inviteOrigin:d,flowId:v,environment:g}=e,m=(0,o.yK)((e=>({selectAllSectionStyle:{display:"flex",flexDirection:"column",gap:2,padding:"8px 0px 16px 0px"},sectionMenuItem:{padding:"12px 0px 0px 2px",display:"flex",flexDirection:"column",gap:2},dividerStyle:{margin:"0px 16px"},dividerInnerStyle:{borderBottom:`1px solid ${e.stroke.deemphasized}`},selectAllStyle:{display:"flex",fontSize:14,color:e.text.primary},totalCountsStyle:{paddingLeft:3,fontSize:14,color:e.text.tertiary}})),[]),p=(0,s.VK)((()=>(null==c?void 0:c.importedContacts)??[]),[c]),I=(0,s.qz)(e.menuListStore,U.Z),y={key:"select all",render:e=>(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(ee.Z,{...e,style:m.selectAllSectionStyle}),(0,L.jsx)(J.Z,{size:1,innerStyle:m.dividerInnerStyle,style:m.dividerStyle})]}),items:[{key:"select all item",render:e=>(0,L.jsx)(G.Z,{...e,title:(0,L.jsxs)("div",{style:m.selectAllStyle,children:[(0,L.jsx)(l.FormattedMessage,{id:"invite.slack_imports.select_all.title",defaultMessage:"Select all"}),(0,L.jsx)(z.Z,{style:m.totalCountsStyle,isSmall:!0,children:`(${p.length})`})]}),right:(0,L.jsx)(ae,{checked:le({filteredImportedContacts:p,inviteTargetsStore:t})})}),action:()=>{!function(e){const{filteredImportedContacts:t,inviteTargetsStore:i,environment:n,origin:r,flowId:s,tokenQuery:o}=e;if(i.state.inviteTargets.length===t.length)return i.setState({...i.state,inviteTargets:[]}),void u.hc(n,{origin:r,invite_flow_id:s,invited_user_count:0,is_unselect:!0,invite_token_query:o});u.hc(n,{origin:r,invite_flow_id:s,invited_user_count:t.length,is_unselect:!1,invite_token_query:o}),i.setState({...i.state,inviteTargets:t})}({filteredImportedContacts:p,inviteTargetsStore:t,origin:d,flowId:v,environment:g,tokenQuery:n}),i.setState({...i.state,focus:S.NoFocus})}}]},h=function(e){const{filteredImportedContacts:t}=e,i={};return t.forEach(((e,t)=>{const n=e.value.email[0].toUpperCase(),r=/^[A-Za-z]$/.test(n)?n:"#";i[r]||(i[r]=[]),i[r].push(e)})),i}({filteredImportedContacts:p}),_=Object.keys(h).sort(((e,t)=>"#"===e?1:"#"===t?-1:e.localeCompare(t))).map((e=>function(e){const{charKey:t,importedContacts:i,inviteTargetsStore:n,slackImportsInviteStore:r,menuListStore:s,style:o,tokenQuery:a,environment:c}=e,u={key:`imported contacts with ${t}`,render:e=>(0,L.jsx)(ee.Z,{...e,style:o,title:(0,L.jsx)(l.FormattedMessage,{id:"invite.slack_imports.grouped_section.title",defaultMessage:"{charKey}",values:{charKey:t}})}),items:i.sort(((e,t)=>(e.value.name||"").localeCompare(t.value.name||""))).map(((e,t)=>({key:e.value.email,render:t=>(0,L.jsx)(se,{...t,invited:!1,inviteTarget:e,isInInviteTargets:ie.H({target:e,inviteTargetsStore:n})}),action:()=>{ie.H({target:e,inviteTargetsStore:n})?n.setState({...n.state,inviteTargets:n.state.inviteTargets.filter((t=>"newUser"!==t.type||e.value.email!==t.value.email))}):(R.hE(c,{invite_token_query:a,selected_user_token:e,selected_user_token_rank:t,from:"slack_imports_space_setting",subscription_tier:(0,f.zt)(),type:"slack"}),r.setState({...r.state,focus:S.NoFocus}),n.setState({...n.state,inviteTargets:[...n.state.inviteTargets,e]}),s.unsetFocus())}})))};return u}({charKey:e,importedContacts:h[e],inviteTargetsStore:t,slackImportsInviteStore:i,menuListStore:I,style:m.sectionMenuItem,tokenQuery:n,environment:g})));return r?(0,L.jsx)(te.l,{loading:!a,children:(0,L.jsx)(X.Z,{title:(0,L.jsx)(l.FormattedMessage,{id:"inviteUserModal.searchInput.errorMessage",defaultMessage:"Something went wrong"})})}):(0,L.jsx)(Y.Z,{type:Y.i.Vertical,initialFocus:n.length>0?0:void 0,sections:[y,..._],store:I})}const se=n.forwardRef(((e,t)=>{const{inviteTarget:i}=e;return(0,L.jsx)(oe,{...e,ref:t,inviteTarget:i})})),oe=n.forwardRef(((e,t)=>{const{inviteTarget:i,isInInviteTargets:r,...s}=e,l=(0,o.yK)((()=>({cellMemberAvatarContainer:{paddingTop:8,paddingBottom:8},iconBox:{position:"absolute",bottom:-3,right:-3},iconBoxImage:{background:"white",padding:2,borderRadius:"100%"}})),[]),c=(0,n.useMemo)((()=>({actorStore:void 0,avatar:{email:i.value.email,name:"slack"===i.source?i.value.name:void 0,avatarUrl:"slack"===i.source?i.value.avatar_url:void 0}})),[i]);return(0,L.jsx)(G.Z,{...s,ref:t,title:(0,L.jsx)(N.Z,{isLarge:!0,...c,containerStyle:l.cellMemberAvatarContainer,avatarBadge:(0,L.jsx)(d.Z,{type:"image_url",imageURL:a.Z.images.externalIntegrations.slackIconPng,size:18,style:l.iconBox,imageStyle:l.iconBoxImage})}),right:(0,L.jsx)(ae,{checked:r})})}));function ae(e){const{checked:t}=e,i=(0,o.yK)((e=>({circleCheckmark:{display:"flex",justifyContent:"center",alignItems:"center",width:18,height:18,borderRadius:"50%",borderStyle:"solid",borderWidth:1.75,borderColor:t?D.ZP.blue:e.buttonPressedBackground,backgroundColor:t?D.ZP.blue:"transparent"},checkIcon:{height:12,width:12,color:"white"}})),[t]);return(0,L.jsx)("div",{style:i.circleCheckmark,children:t&&(0,H.e)(i.checkIcon)})}function le(e){const{filteredImportedContacts:t,inviteTargetsStore:i}=e,n=i.state.inviteTargets.length;return 0!==n&&n===t.length}function ce(e){const{inviteTargetsStore:t,slackImportsInviteStore:i,inviteOrigin:o,onInviteComplete:a,onInviteClick:l}=e,c=(0,r.O7)(),[d,v]=(0,n.useState)(!1),g=(0,s.VK)((()=>Z.Z.completeSlackAuthentications.state),[]),m=(0,s.VK)((()=>O.default.state.currentSpaceStore),[]),p=(0,s.VK)((()=>i.state.flowId),[i]),f=(0,s.qz)(void 0,U.Z);(0,n.useEffect)((()=>{u.e8(c,{invite_flow_id:i.state.flowId,origin:o}),async function(){if(m&&!d){for(const e of g)await w.loadContacts(c,{botId:e.id,spaceId:m.id,integrationId:k.nO}).catch((e=>{const t=(0,b.t)(e);u.u0(c,{invite_stage:"load_slack_contacts",invited_user_count:0,invite_flow_id:p,error:t,origin:o,is_success:!1}),x.log({level:"error",from:"SlackImportsInvite",type:"loadSlackContacts",error:(0,T.Ui)(e)})}));v(!0)}}()}),[m,g,c,d,o,i,p]);const I=function(e){let{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,isLoading:r}=e;return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(P,{isLoading:r}),(0,L.jsx)(Q,{inviteTargetsStore:i,slackImportsInviteStore:t,inviteOrigin:n})]})}({inviteTargetsStore:t,slackImportsInviteStore:i,inviteOrigin:o,isLoading:!d}),y=function(e){let{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,onInviteComplete:r,onInviteClick:s}=e;return(0,L.jsx)(V,{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,onInviteComplete:r,onInviteClick:s})}({slackImportsInviteStore:i,inviteTargetsStore:t,inviteOrigin:o,onInviteComplete:a,onInviteClick:l}),S=function(e){let{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,menuListStore:r,isLoading:s}=e;if(s)return null;return(0,L.jsx)(ne,{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,menuListStore:r})}({slackImportsInviteStore:i,inviteTargetsStore:t,inviteOrigin:o,menuListStore:f,isLoading:!d}),h={menuType:M.og.Popup,width:480,height:"60vh",header:I,footer:y,tokenInputHeader:!1,disableScroller:!1};return(0,L.jsx)(C.Z,{...h,className:j.FJA,children:(0,L.jsx)("div",{children:S})})}function ue(e){const t=(0,r.O7)(),{inviteOrigin:i,canEditPermission:c,onInviteComplete:m,onInviteClick:I,slackButtonLabel:y,slackButtonStyle:S,slackButtonContainerStyle:h}=e,{isMobile:k}=(0,r.Fy)(),x=function(e,t){return(0,o.yK)((i=>({slackTitle:{display:"flex",fontSize:14,color:i.text.primary},integrationIcon:{marginRight:4},slackButtonContainer:{padding:"0 8px",...t},slackButton:{height:32,borderRadius:4,border:`1px solid ${i.stroke.regular}`,...e}})),[e,t])}(S,h),b=(0,s.qz)(void 0,_),T=(0,s.qz)(void 0,p.ZP),w=(0,s.VK)((()=>b.state.modalOpen),[b]),C=(0,s.VK)((()=>b.state.flowId),[b]),j=(0,n.useCallback)((()=>{!function(e){e.reset()}(b),u.Td(t,{origin:i,invite_flow_id:C})}),[b,i,t,C]),M=(0,n.useMemo)((()=>(0,L.jsxs)("div",{style:x.slackTitle,children:[(0,L.jsx)(d.Z,{type:"image_url",imageURL:a.Z.images.externalIntegrations.slackIconPng,size:16,imageStyle:x.integrationIcon}),(0,L.jsx)(l.FormattedMessage,{defaultMessage:"Import from Slack",id:"invite.slack_imports.button.label"})]})),[x]),O=(0,n.useCallback)((()=>function(e){const{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,onInviteComplete:r,onInviteClick:s}=e;return(0,L.jsx)(ce,{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,onInviteComplete:r,onInviteClick:s})}({inviteTargetsStore:T,slackImportsInviteStore:b,inviteOrigin:i,onInviteComplete:m,onInviteClick:I})),[T,b,i,I,m]);return(0,s.VK)((()=>{const e=de({canEditPermission:c,isMobile:k,subscriptionTier:(0,f.zt)()});return e&&ve({environment:t,flowId:C,origin:i}),e}),[c,k,t,C,i])?(0,L.jsx)(v.Z,{open:w,onDismiss:j,renderContent:O,origin:(0,L.jsx)(g.Z,{onClickAuthenticated:()=>{!function(e){e.setState({...e.state,modalOpen:!0})}(b)},title:y??M,hideChevronIcon:!0,containerStyle:x.slackButtonContainer,buttonStyle:x.slackButton,from:"space_settings",inviteOrigin:i,flowId:C,loadContacts:!1})}):null}function de(e){const{canEditPermission:t,isMobile:i}=e,n="enterprise"===e.subscriptionTier;return!(i||n||!t)&&"on"===m.default.getEligibleGroup({experimentId:"acq_slack_imports_invite_v1",defaultGroup:"control"})}const ve=c.Ds((e=>{let{environment:t,flowId:i,origin:n}=e;u.gV(t,{origin:n,invite_flow_id:i})}),2e3)},56678:(e,t,i)=>{i.d(t,{Z:()=>_});var n=i(67294),r=i(480),s=i(86628),o=i(24405),a=i(77657),l=i(5257),c=i(91315),u=i(31701),d=i(37850),v=i(40470),g=i(81575),m=i(54642),p=i(89475),f=i(68785),I=i(89728),y=i(80444),S=i(30874),h=i(85893);function _(e){const{onClickAuthenticated:t,title:i,hideChevronIcon:_,containerStyle:k,buttonStyle:x,from:b,inviteOrigin:T,flowId:w,loadContacts:C}=e,j=(0,r.O7)(),[M,O]=n.useState(!1),Z=(0,s.VK)((()=>y.default.state.currentSpaceStore),[]),U=(0,s.VK)((()=>{const e=null==Z?void 0:Z.getBotSettingsStore().getValue();return"approved_only"!==(null==e?void 0:e.integration_restrictions)||Boolean((null==e?void 0:e.integration_approval_statuses)&&e.integration_approval_statuses[a.nO])}),[Z]),K=(0,s.VK)((()=>S.Z.integrations.state.find((e=>e.id===a.nO))),[]),F=(0,s.VK)((()=>S.Z.completeSlackAuthentications.state),[]),L=(0,o.yK)((e=>({circleCheck:{height:14,width:14,color:u.ZP.blue},chevron:{height:12,width:12},title:{display:"flex",alignItems:"center",color:u.ZP.uiLightBlack,size:14,gap:6},loadingSpinner:{width:14,height:14,marginLeft:6}})),[]);if(!Z)return(0,h.jsx)(h.Fragment,{});if(!U)return(0,h.jsx)(h.Fragment,{});const V=M?(0,h.jsx)(f.Z,{style:L.loadingSpinner}):(0,h.jsxs)(h.Fragment,{children:[F.length>0&&(0,c.r)(L.circleCheck),!_&&(0,l.o)(L.chevron)]});return(0,h.jsx)("div",{style:k,children:(0,h.jsx)(I.Z,{style:x,onClick:async()=>{0===F.length?await async function(e){const{from:i,inviteOrigin:n,flowId:r}=e,s=j.currentUser.id;if(!K||!Z||!s)return;try{var o;O(!0),g.n0(j,{origin:n,from:i,invite_flow_id:r});const e=await p.hM({environment:j,integration:K,spaceId:Z.id,from:i});if(v.x.isFail(e))return void g.ZK(j,{origin:n,from:i,invite_flow_id:r,is_success:!1});const s=null===(o=e.value.externalAuthentication)||void 0===o?void 0:o.parent_id;if(!s)return;g.ZK(j,{origin:n,from:i,invite_flow_id:r,is_success:!0}),C&&await Promise.race([m.loadContacts(j,{botId:s,spaceId:Z.id,integrationId:K.id}),(0,d.Vs)(2e3)]),null==t||t()}finally{O(!1)}}({from:b,inviteOrigin:T,flowId:w,loadContacts:C}):F.length>0&&(null==t||t())},children:(0,h.jsxs)("div",{style:L.title,children:[i,V]})})})}}}]);