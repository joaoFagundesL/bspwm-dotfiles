"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[2773],{18533:(e,t,n)=>{n.d(t,{Z:()=>g});var o=n(67294),i=n(480),r=n(86628),s=n(68626),l=n(53965),a=n(52629),d=n(52275),u=n(31945),c=n(78140),p=n(32163),m=n(53437),f=n(72495),h=n(60709),x=n(61766),v=n(94166),y=n(85893);const g=function(e){let{icon:t,title:n,selectedKey:g,onChange:b,onClick:k,popupStyle:S,menuItemOptionsStyle:I,disabled:M,collectionContextStore:C,openButtonPopup:w,hideCheck:T,...j}=e;const F=(0,i.Fy)(),R="options"in j?j.options:l.xH(j.sections),E=R.find((e=>l.Xy(e.key,g))),V=(0,r.qz)(void 0,x.Z),A=(0,r.Kw)(V);return(0,o.useEffect)((()=>{C&&w&&(V.setState({...V.state,open:w}),C.settingsStore.setState({...C.settingsStore.state,openButtonPopup:void 0})),E||s.log({level:"error",from:"CollectionSettingsPickListMenuItem",type:"InvalidSelectedItem",error:(0,a.Ui)("Selected key is invalid.")})})),(0,y.jsx)(u.ZP,{popupType:F.isMobile?m.kQ.SlideUp:m.kQ.Popup,alignmentToOrigin:u.vR.End,placementToOrigin:u.pO.Bottom,style:S,originGap:0,buttonPopupStore:V,disabled:M,onClick:k,renderOrigin:e=>(0,y.jsx)(v.Z,{title:n,showChevron:!0,right:null==E?void 0:E.title,rotateChevron:A.open,disabled:M,icon:t,...e}),render:e=>{let t;t=F.isMobile?{menuType:h.og.ActionSheet}:{menuType:h.og.Popup,width:250};const n=(t,n)=>({key:n,render:e=>(0,y.jsx)(d.Z,{...e,disabled:!1,title:t.title,icon:t.icon,caption:t.caption,captionStyle:t.captionStyle,inline:t.captionInline,spacerStyle:t.inlineSpacerStyle,body:t.body,style:I,checkState:!T&&l.Xy(t.key,g)}),action:()=>{b(t.key),e.close()}}),o="sections"in j?j.sections.map(((e,t)=>({key:t,render:e=>(0,y.jsx)(f.Z,{enableActionSheetTitle:!0,topBorder:t>0,...e}),items:l.oA(e.map(n))}))):[{key:0,render:e=>(0,y.jsx)(f.Z,{enableActionSheetTitle:!0,...e}),items:l.oA(R.map(n))}];return(0,y.jsx)(c.Z,{...t,children:(0,y.jsx)(p.Z,{type:p.i.Vertical,sections:o,initialFocus:0})})}})}},65668:(e,t,n)=>{n.d(t,{Z:()=>mt});n(57658);var o=n(67294),i=n(480),r=n(86628),s=n(24405),l=n(73717),a=n(50610),d=n(35102),u=n(66673),c=n(13148),p=n(54497),m=n(70203),f=n(9291),h=n(53965),x=n(40470),v=n(1898),y=n(37810),g=n(98104),b=n(13447),k=n(37181),S=n(68657),I=n(33929),M=n(68056),C=n(18514),w=n(80444),T=n(24666),j=n(73063),F=n(3386),R=n(16354),E=n(74420),V=n(12396),A=n(84619),B=n(73110),D=n(89679),N=n(77097);const P={true:{name:"true",type:{type:"checkbox"},description:N.Gw.true,examples:[{input:"true"},{input:[(0,D.h0)("Checked"),[" == true"]]}]},false:{name:"false",type:{type:"checkbox"},description:N.Gw.false,examples:[{input:"false"},{input:[(0,D.h0)("Checked"),[" == false"]]}]},and:{name:"and",type:{type:"checkbox"},description:N.Gw.and,examples:[{input:"3 > 2 and 2 > 3",output:"false"},{input:[(0,D.h0)("Naughty"),[" && "],(0,D.h0)("Nice")]}]},or:{name:"or",type:{type:"checkbox"},description:N.Gw.or,examples:[{input:"3 > 2 or 2 > 3",output:"true"},{input:[(0,D.h0)("Naughty"),[" || "],(0,D.h0)("Nice")]}]},not:{name:"not",type:{type:"checkbox"},description:N.Gw.not,examples:[{input:"not true",output:"false"},{input:"not (2 > 3)",output:"true"},{input:[["!"],(0,D.h0)("Checked")]}]},"+":{name:"+",type:{type:"number"},description:N.Gw["+"],examples:[{input:"3 + 2",output:"5"},{input:"add(-1, 2)",output:"1"}]},"-":{name:"-",type:{type:"number"},description:N.Gw["-"],examples:[{input:"3 - 2",output:"1"},{input:"subtract(-1, 2)",output:"-3"}]},"*":{name:"*",type:{type:"number"},description:N.Gw["*"],examples:[{input:"3 * 2",output:"6"},{input:"multiply(-1, 2)",output:"-2"}]},"/":{name:"/",type:{type:"number"},description:N.Gw["/"],examples:[{input:"3 / 2",output:"1.5"},{input:"divide(-1, 2)",output:"-0.5"}]},"%":{name:"%",type:{type:"number"},description:N.Gw["%"],examples:[{input:"3 % 2",output:"1"},{input:"mod(-1, 2)",output:"-1"}]},"^":{name:"^",type:{type:"number"},description:N.Gw["^"],examples:[{input:"3 ^ 2",output:"9"},{input:"pow(-1, 2)",output:"1"}]},"==":{name:"==",type:{type:"checkbox"},description:N.Gw["=="],examples:[{input:"3 == 2",output:"false"},{input:'equal("A", "A")',output:"true"}]},"!=":{name:"!=",type:{type:"checkbox"},description:N.Gw["!="],examples:[{input:"3 != 2",output:"true"},{input:'unequal("A", "A")',output:"false"}]},">":{name:">",type:{type:"checkbox"},description:N.Gw[">"],examples:[{input:"3 > 2",output:"true"},{input:'now() > parseDate("2040-01-01")',output:"false"}]},"<":{name:"<",type:{type:"checkbox"},description:N.Gw["<"],examples:[{input:"3 < 2",output:"false"},{input:'now() < parseDate("2040-01-01")',output:"true"}]},">=":{name:">=",type:{type:"checkbox"},description:N.Gw[">="],examples:[{input:"3 >= 2",output:"true"},{input:'now() >= parseDate("2040-01-01")',output:"false"}]},"<=":{name:"<=",type:{type:"checkbox"},description:N.Gw["<="],examples:[{input:"3 <= 2",output:"false"},{input:'now() <= parseDate("2040-01-01")',output:"true"}]}};var O=n(75e3),U=n(56505),Z=n(60709),G=n(29798),L=n(73657),_=n(64921),K=n(52275),W=n(31945),H=n(78140),z=n(28992),$=n(32163),Q=n(40721),Y=n(72495),X=n(42875),q=n(75553),J=n(20852),ee=n(82883),te=n(38585),ne=n(893),oe=n(95477),ie=n(60682),re=n(24990),se=n(62619),le=n(55227),ae=n(77907),de=n(77080),ue=n(85893);const ce=o.memo((e=>{let{infoHelper:t,getRecordModel:n,style:o}=e;const i=t;if(void 0===(null==i?void 0:i.kind))return null;switch(i.kind){case B.x2.Token:return(0,ue.jsx)(fe,{completion:i,getRecordModel:n,style:o});case B.x2.LibraryFunction:{const e=!(null==t||!t.calledFromUnifiedFunctionProperty),r=function(e,t){if(t&&void 0!==e.syntax[1])return e.syntax[1];return e.syntax[0]}(i.libraryFunction,e),s=function(e,t){if(t&&void 0!==e.examples[1])return e.examples[1];return e.examples[0]}(i.libraryFunction,e),l=i.libraryFunction.returnType;return(0,ue.jsx)(me,{icon:Me("function"==typeof l?l([]).type:l.type),name:r,description:I.default.formatMessage(i.libraryFunction.description),examples:s.length>0?s.map(((e,t)=>(0,ue.jsx)(pe,{example:e,getRecordModel:n},t))):void 0,style:o})}case B.x2.Binding:var r;return i.text===B.GV?(0,ue.jsx)(me,{icon:Me(i.type.type),name:i.text,description:I.default.formatMessage(ye.currentValueDescription),style:o}):i.text===B.WY?(0,ue.jsx)(me,{icon:Me(i.type.type),name:i.text,description:I.default.formatMessage(ye.currentIndexDescription),style:o}):(0,ue.jsx)(me,{icon:Me(i.type.type),name:i.text,description:I.default.formatMessage("array"===(null==i||null===(r=i.type)||void 0===r?void 0:r.type)?ye.listVariableType:ye.variableType),style:o});case B.x2.Builtin:{const e=P[i.builtin];return(0,ue.jsx)(me,{icon:Me(e.type.type),name:e.name,description:I.default.formatMessage(e.description),examples:e.examples.length>0?e.examples.map(((e,t)=>(0,ue.jsx)(pe,{example:e,getRecordModel:n},t))):void 0,style:o})}default:return(0,v.t1)(i)}}));function pe(e){let{example:t,getRecordModel:n}=e;const l=(0,ae.useDependency)(ae.deps.prismjs),a=(0,ie.kw)(),d=(0,i.O7)(),{device:u}=d,c=(0,r.VK)((()=>{var e;return null===(e=w.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),p=(0,s.Fg)(),x=(0,f.useIntl)(),v=(0,r.VK)((()=>re.Z.state),[]),y=(0,r.VK)((()=>{var e;const o=document.createElement("div"),i="string"!=typeof t.input?m.QaF(t.input):t.input,r=(null===(e=l.value)||void 0===e?void 0:e.highlight(`${i}`,l.value.languages[J.PrismLanguages.notion],J.PrismLanguages.notion))??"";o.innerHTML=le.g7(r);const s=h.oA(Array.from(o.childNodes).map(xe)),f="string"==typeof t.input?[[t.input],[" = "]]:t.input.concat([[" = "]]),y=le.kF(f,h.oA(s)),g=f.map(m.hDy).map(((e,t)=>te.fn({annotations:e,theme:p,getRecordModel:n,spaceId:c})));return y.map(((e,t)=>{const o=g[e.textTokenIndex],i=f[e.textTokenIndex];return m.km_(i)?(0,te.$i)({args:{textValue:{value:f,spaceId:c},getRecordModel:n,getRecordRole:()=>{},disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableLinks:!1,userTimeZone:(0,X.r)(),disabled:!1,isAndroid:u.isAndroid,isSafariOrIOS:u.isSafari||u.isIOS,isWindows:u.isWindows,showEmojiInline:u.isWindows,emojiType:a,highlightDiscussionId:void 0,theme:p,intl:x,renderedPageBlockId:void 0,parentBlockId:void 0,katex:void 0,isClient:!0,baseUrl:oe.default.domainBaseUrl,publicDomainName:oe.default.publicDomainName,currentUserId:d.currentUser.id,overwriteBaseUrlFromSpaceId:void 0,externalIntegrations:[],formulaValueTypes:[],emojiData:v,isMobileNative:u.isMobileNative,isMobileNativeExternalLinkFixEnabled:de.default.checkGate("mobile_native_external_link_fix"),displayInUserTimezone:de.default.checkGate("display_date_in_user_timezone")},style:o.style,classNames:o.classNames,index:t,token:i,tokenValue:m.WiV(i),tokenAnnotations:m.hDy(i)}):(0,ue.jsx)("span",{className:[e.classNames||"",...o.classNames].join(" "),style:o.style,"data-token-index":e.textTokenIndex,children:e.value},t)}))}),[t.input,l.value,p,n,c,u.isAndroid,u.isSafari,u.isIOS,u.isWindows,u.isMobileNative,a,x,d.currentUser.id,v]),g=(0,r.VK)((()=>Array.isArray(t.output)?(0,te.IY)({textValue:{value:t.output,spaceId:c},getRecordModel:n,getRecordRole:()=>{},disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableLinks:!1,userTimeZone:(0,X.r)(),disabled:!1,isAndroid:u.isAndroid,isSafariOrIOS:u.isSafari||u.isIOS,isWindows:u.isWindows,showEmojiInline:u.isWindows,emojiType:a,theme:p,intl:x,katex:void 0,isClient:!0,baseUrl:oe.default.domainBaseUrl,publicDomainName:oe.default.publicDomainName,currentUserId:d.currentUser.id,overwriteBaseUrlFromSpaceId:void 0,externalIntegrations:[],formulaValueTypes:[],emojiData:v,isMobileNative:u.isMobileNative,isMobileNativeExternalLinkFixEnabled:de.default.checkGate("mobile_native_external_link_fix"),displayInUserTimezone:de.default.checkGate("display_date_in_user_timezone")}):t.output),[u.isAndroid,u.isIOS,u.isSafari,u.isWindows,u.isMobileNative,v,a,d.currentUser.id,t.output,n,x,c,p]),b=!1!==t.isCopyable&&("string"==typeof t.input||!0===t.isCopyable),k=(0,o.useCallback)((()=>{if(b){const e=(Array.isArray(t.input)?(0,ee.X)({intl:x,textValue:t.input,getRecordModel:n,userTimeZone:(0,X.r)()}):t.input).replaceAll(/\/\*.*\*\//g,"").trim();ne.RD({stringValue:e,environment:d,copiedMessage:ve.copiedExampleMessage})}}),[d,t.input,n,x,b]),S=(0,s.yK)((e=>({code:{fontFamily:"monospace",whiteSpaceCollapse:"preserve",fontSize:11,borderRadius:5,border:`1px solid ${e.stroke.deemphasized}`,margin:"0 -4px",padding:"0 6px",pointerEvents:"none",opacity:.95,display:"flex",flexDirection:"row",alignItems:"center",tabSize:2},left:{flexGrow:1,padding:"6px 0"},right:{alignSelf:"center"},copyButton:{height:22,width:22,pointerEvents:"auto"},copyButtonIcon:{height:12,width:12}})),[]);return(0,ue.jsxs)("div",{style:S.code,children:[(0,ue.jsxs)("div",{style:S.left,children:[(0,ue.jsx)("div",{children:y}),g?(0,ue.jsxs)("div",{children:["= ",g]}):null]}),b?(0,ue.jsx)("div",{style:S.right,children:(0,ue.jsx)(j.Z,{ariaLabel:x.formatMessage(ve.copyToClipboard),onClick:k,icon:q.U,style:S.copyButton,iconStyle:S.copyButtonIcon,disallowTabbing:!0})}):null]})}function me(e){let{name:t,icon:n,description:o,examples:i,style:r}=e;const l=(0,s.yK)((e=>({helper:{display:"flex",flexDirection:"column",fontSize:12,height:"auto",width:"100%",gap:8,overflow:"auto",textWrap:"wrap",...r},name:{fontSize:14,fontWeight:600,display:"flex",alignItems:"center"},description:{color:e.mediumTextColor},iconStyle:{height:14,width:14,fill:e.mediumIconColor,display:"inline",marginRight:6},divider:{borderColor:e.stroke.deemphasized},examples:{display:"flex",flexDirection:"column",gap:4}})),[r]);return(0,ue.jsxs)("div",{style:l.helper,children:[(0,ue.jsxs)("span",{style:l.name,children:[void 0!==n&&n(l.iconStyle),t]}),void 0!==o&&(0,ue.jsx)("span",{style:l.description,children:o}),void 0!==i&&(0,ue.jsx)("div",{style:l.examples,children:i})]})}function fe(e){let{completion:t,getRecordModel:n,style:o}=e;const{name:i,description:s,icon:l,examples:a}=(0,r.VK)((()=>{if(!n)return{};if(t.token.type===B.Oy.BlockProperty){var e;if(B.WG.includes(t.token.property)&&!t.token.collection){var o;const e=null===(o=B.dy[t.token.property])||void 0===o?void 0:o.type,i=e?V.wG[e]:void 0,r=D.QP[t.token.property],s="function"==typeof(null==r?void 0:r.description)?r.description():null==r?void 0:r.description,l=t.name??t.token.property;return{name:l,icon:i,description:s?I.default.formatMessage(s):void 0,examples:null!==r?he(r,n,{collection:t.token.collection,property:t.token.property,name:l},{name:l,type:t.token.property}):void 0}}if(!t.token.collection)return{};const i=(0,d.SR)(t.token.property),r=n(t.token.collection),s=null==r||null===(e=r.getNormalizedSchema())||void 0===e?void 0:e[i];if(!s)return{};const l=D.QP[s.type];return l?{name:t.name,icon:V.wG[s.type],description:I.default.formatMessage("function"==typeof l.description?l.description(s):l.description),examples:he(l,n,{collection:t.token.collection,property:i,name:t.name},s)}:{}}return{}}),[t,n]);return void 0===i?null:(0,ue.jsx)(me,{name:i,icon:l,description:s,examples:a,style:o})}function he(e,t,n,o){const i=e.examples;let r=[];return r="function"==typeof i?i(n,o).map(((e,n)=>(0,ue.jsx)(pe,{example:e,getRecordModel:t},n))):i.map(((e,n)=>(0,ue.jsx)(pe,{example:e,getRecordModel:t},n))),r.length>0?r:void 0}function xe(e){return se.Gs(e)?[e.data]:se.kK(e)?[e.textContent||"",e.className]:void 0}const ve=(0,f.defineMessages)({codeExamples:{id:"formula2Input.helperText.codeExamples",defaultMessage:"Examples"},copiedExampleMessage:{id:"formula2Input.helperText.copiedExampleMessage",defaultMessage:"Copied example to clipboard!"},copyToClipboard:{defaultMessage:"Copy to Clipboard",id:"database.copyButton.copyToClipboard"}}),ye=(0,f.defineMessages)({currentValueDescription:{id:"formula2Input.helperText.currentValueDescription",defaultMessage:"Returns the value of the current item in the list function."},currentIndexDescription:{id:"formula2Input.helperText.currentIndexDescription",defaultMessage:"Returns the index of the current item in the list function, starting from 0."},variableType:{id:"formula2Input.variableHelper.description",defaultMessage:"User-defined variable."},listVariableType:{id:"formula2Input.variableHelper.descriptionWithList",defaultMessage:"User-defined variable, list."},emailForUser:{id:"formula2Input.helperText.emailForUser",defaultMessage:"Returns the email address of a provided user."},nameForUser:{id:"formula2Input.helperText.nameForUser",defaultMessage:"Returns the display name of a provided user."}});var ge=n(21396);function be(e){const{store:t,selection:n,cursorEditorInfo:l,cursorEditorInfoRef:a,context:u,onChange:c,getRecordModel:p,setInfoHelper:f}=e,x=(0,s.yK)((()=>({menu:{top:0,left:0,right:0,bottom:0,position:"absolute",marginBottom:2},menuSection:{paddingTop:6,paddingBottom:2}})),[]),y=(0,i.Fy)(),g=(0,r.qz)(void 0,G.Z),b=(0,o.useMemo)((()=>{const e=h.vM((null==l?void 0:l.completions)??[],"kind");let o=-1;return Object.entries(e).map(((e,i)=>{const[r,s]=e,l=s.map(((e,r)=>{o+=1;const s=o;return{key:`${i}-${r}`,render:t=>(0,ue.jsx)(ke,{...t,completion:e,context:u,getRecordModel:p,menuListStore:g,indexGlobal:s,cursorEditorInfoRef:a,setInfoHelper:f}),action:()=>{var o;void 0!==e&&a.current&&(f({...e,calledFromUnifiedFunctionProperty:"member dot receiver"===(null===(o=a.current.completionsInfo)||void 0===o?void 0:o.type)}),function(e){var t;const{completion:n,store:o,selection:i,onChange:r,cursorEditorInfo:s}=e,l=(null==i?void 0:i.startIndex)||0,a=(null==i?void 0:i.endIndex)||0,u=l!==a,c=(null===(t=s.completionsInfo)||void 0===t?void 0:t.prefix)||"",p="overridePrefixLength"in n?n.overridePrefixLength??0:c.length,f=u?l:a-p,h=o.getValue();if(n.kind===B.x2.Token){if(n.token.type===B.Oy.Checkbox)return;if(n.token.type===B.Oy.BlockProperty){const e=(0,m._QS)(h,f,a),t=n.token.collection?(0,d.SR)(n.token.property):n.token.property,o=(0,m.YCD)((0,m.kbv)({collection:n.token.collection,property:t,name:n.name}));return void r({newValue:(0,m.P$X)(e,[o],f),newSelection:{startIndex:f+1,endIndex:f+1}})}if(n.token.type===B.Oy.ContextValue){const e=(0,m._QS)(h,f,a),t=(0,d.Kv)(n.token.valueId),o=(0,m.YCD)((0,m._QF)({id:t}));r({newValue:(0,m.P$X)(e,[o],f),newSelection:{startIndex:f+1,endIndex:f+1}})}else{if(n.token.type===B.Oy.Date||n.token.type===B.Oy.Block||n.token.type===B.Oy.Person)return;(0,v.t1)(n.token)}}else if(n.kind===B.x2.LibraryFunction){var x,y,g,b;const e=(0,m._QS)(h,f,a),t=(0,m.V3y)(`${n.libraryFunction.name}()`,[]),o=(0,m.P$X)(e,[t],f);let i=f+n.libraryFunction.name.length+1;void 0!==(null===(x=n.libraryFunction)||void 0===x||null===(x=x.parameters)||void 0===x?void 0:x.varargs)||null!==(y=n.libraryFunction)&&void 0!==y&&null!==(y=y.parameters)&&void 0!==y&&null!==(y=y.expected)&&void 0!==y&&y.length&&(1!==(null===(g=n.libraryFunction)||void 0===g||null===(g=g.parameters)||void 0===g||null===(g=g.expected)||void 0===g?void 0:g.length)||"member dot receiver"!==(null===(b=s.completionsInfo)||void 0===b?void 0:b.type))||(i+=1);r({newValue:o,newSelection:{startIndex:i,endIndex:i}})}else if(n.kind===B.x2.Binding||n.kind===B.x2.Builtin){const e=(0,m._QS)(h,f,a),t=n.kind===B.x2.Binding?n.text:`${n.builtin} `,o=(0,m.V3y)(t,[]),i=(0,m.P$X)(e,[o],f),s=f+t.length;r({newValue:i,newSelection:{startIndex:s,endIndex:s}})}else(0,v.t1)(n)}({completion:e,store:t,selection:n,onChange:c,cursorEditorInfo:a.current}))}}}));return{key:r,render:e=>(0,ue.jsx)(Y.Z,{...e,style:x.menuSection,title:I.default.formatMessage(Te[r])}),items:l}}))}),[u,null==l?void 0:l.completions,a,p,g,c,n,f,t,x.menuSection]),k=(0,o.useCallback)((e=>{var t;if(y.isMobile)return;const n=void 0!==e.indexGlobal?null===(t=a.current)||void 0===t||null===(t=t.completions)||void 0===t?void 0:t[e.indexGlobal]:void 0;var o;n&&f({...n,calledFromUnifiedFunctionProperty:"member dot receiver"===(null===(o=a.current)||void 0===o||null===(o=o.completionsInfo)||void 0===o?void 0:o.type)})}),[a,y.isMobile,f]);let S;return(0,o.useEffect)((()=>{if(y.isMobile)return;const e=e=>{var t,n;if(void 0!==e.state.focus.indexGlobal&&null!==(t=a.current)&&void 0!==t&&t.completions&&(null===(n=a.current)||void 0===n?void 0:n.completions.length)>0){var o;const t=null===(o=a.current)||void 0===o||null===(o=o.completions)||void 0===o?void 0:o[e.state.focus.indexGlobal];void 0!==t&&f((e=>{var n;return void 0===e||void 0===(null===(n=a.current)||void 0===n?void 0:n.callParameter)?t:e}))}};return g.addListener(e),()=>g.removeListener(e)}),[a,g,f,y.isMobile]),(0,o.useEffect)((()=>{var e,t,n,o;if(y.isMobile)return;const i="function"===(null==l||null===(e=l.callParameter)||void 0===e||null===(e=e.expression)||void 0===e||null===(e=e.type)||void 0===e?void 0:e.type)?null===(t=l.callParameter.expression)||void 0===t?void 0:t.type:void 0;void 0!==i&&void 0!==(null==l||null===(n=l.callParameter)||void 0===n?void 0:n.parameterIndex)&&(null==l||null===(o=l.callParameter)||void 0===o?void 0:o.parameterIndex)>-1&&f({kind:B.x2.LibraryFunction,libraryFunction:i.libraryFunction,calledFromUnifiedFunctionProperty:i.calledFromUnifiedFunctionProperty})}),[null==l?void 0:l.callParameter,y.isMobile,f]),(0,o.useEffect)((()=>{b.length>0&&g.update((e=>({focus:{...e,section:0,indexLocal:0,indexGlobal:0}})))}),[b.length,g,f]),S=y.isPhone?{menuType:Z.og.ActionSheet,disableBottomPadding:!0,maxHeight:"100%"}:{menuType:Z.og.Popup,width:y.isPhone?180:228,minWidth:y.isPhone?180:228,maxWidth:y.isPhone?180:228},(0,ue.jsx)(H.Z,{...S,scrollerStyle:x.menu,children:(0,ue.jsx)($.Z,{type:$.i.Vertical,initialFocus:0,priority:1,store:g,onKeyboardArrow:k,sections:h.oA([...b,0===b.length&&{key:"no-results",render:e=>(0,ue.jsx)(Y.Z,{...e,disableDesktopPadding:!0,style:x.menuSection,children:(0,ue.jsx)(Ce,{})}),items:[]}])})})}const ke=o.forwardRef(((e,t)=>{const{completion:n,context:l,getRecordModel:a,menuListStore:u,indexGlobal:c,cursorEditorInfoRef:p,setInfoHelper:m,onMouseEnter:h,...x}=e,y=(0,i.Fy)(),g=(0,s.yK)((e=>({icon:{width:14,fill:e.mediumIconColor},lightParens:{color:e.lightTextColor}})),[]),b=(0,o.useCallback)((e=>{if(!y.isMobile){var t;const e=null===(t=p.current)||void 0===t||null===(t=t.completions)||void 0===t?void 0:t[c];m(e)}null==h||h(e)}),[p,c,h,m,y.isMobile]),k=(0,r.VK)((()=>u.state.focus.indexGlobal===c),[u,c]),S=(0,o.useMemo)((()=>y.isMobile?(0,ue.jsx)(W.ZP,{popupType:W.Z4.SlideUp,renderOrigin:e=>(0,ue.jsx)(_.Z,{mobileFeedback:!0,style:{width:16,height:16},...e,children:(0,U.S)(g.icon)}),render:e=>{var t;let o;return o=y.isMobile?{menuType:Z.og.Modal,title:(0,ue.jsx)(f.FormattedMessage,{defaultMessage:"Documentation",id:"database.formulaPropertyEntryMenuItem.title"}),right:(0,ue.jsx)(Q.DoneMenuText,{}),onClickRight:e.close}:{menuType:Z.og.Popup},(0,ue.jsx)(H.Z,{...o,children:(0,ue.jsx)(Y.Z,{children:(0,ue.jsx)(z.Z,{title:(0,ue.jsx)(ce,{infoHelper:{...n,calledFromUnifiedFunctionProperty:"member dot receiver"===(null==p||null===(t=p.current)||void 0===t||null===(t=t.completionsInfo)||void 0===t?void 0:t.type)},getRecordModel:a,style:{padding:4}}),style:{paddingTop:16,paddingBottom:16}})})})}}):(0,ue.jsx)(Se,{visible:k})),[n,p,y.isMobile,a,k,g.icon]),I=(0,r.VK)((()=>{var e;if(n.kind!==B.x2.Token||n.token.type!==B.Oy.BlockProperty||!a)return;if(B.WG.includes(n.token.property))return n.token.property;if(!n.token.collection)return;const t=(0,d.SR)(n.token.property),o=a(n.token.collection);return null==o||null===(e=o.getNormalizedSchema())||void 0===e||null===(e=e[t])||void 0===e?void 0:e.type}),[n,a]);if(n.kind===B.x2.Token){if(n.token.type===B.Oy.Checkbox)return null;if(n.token.type===B.Oy.BlockProperty)return(0,ue.jsx)(K.Z,{...x,icon:I?V.wG[I](g.icon):(0,ue.jsx)(Ie,{type:"unknown"}),title:n.name??n.token.property,right:S,onMouseEnter:b,ref:t});if(n.token.type===B.Oy.ContextValue){const e=(0,d.vx)(l.valueTypes,(0,d.Kv)(n.token.valueId));return e?(0,ue.jsx)(K.Z,{...x,icon:(0,ue.jsx)(Ie,{type:e.type.type}),title:(0,ue.jsx)("div",{style:{display:"flex"},children:(0,ue.jsx)(ge.F,{value:e,format:A.lo.Medium,isSingle:!0,shouldShrink:!0})}),right:S,onMouseEnter:b,ref:t}):null}if(n.token.type===B.Oy.Date)return null;if(n.token.type===B.Oy.Block)return null;if(n.token.type===B.Oy.Person)return null;(0,v.t1)(n.token)}else{if(n.kind===B.x2.LibraryFunction){const e=n.libraryFunction.returnType;return(0,ue.jsx)(K.Z,{...x,icon:(0,ue.jsx)(Ie,{type:"function"==typeof e?e([]).type:e.type}),title:(0,ue.jsxs)(ue.Fragment,{children:[n.libraryFunction.name,(0,ue.jsx)("span",{style:g.lightParens,children:"()"})]}),right:S,onMouseEnter:b,ref:t})}if(n.kind===B.x2.Builtin)return(0,ue.jsx)(K.Z,{...x,title:n.builtin,icon:(0,ue.jsx)(Ie,{type:P[n.builtin].type.type}),right:S,onMouseEnter:b,ref:t});if(n.kind===B.x2.Binding)return(0,ue.jsx)(K.Z,{...x,title:n.text,icon:(0,ue.jsx)(Ie,{type:n.type.type}),right:S,onMouseEnter:b,ref:t});(0,v.t1)(n)}})),Se=o.memo((e=>{let{visible:t}=e;const n=(0,s.yK)((e=>({icon:{width:14,fill:e.mediumIconColor,transition:"opacity 50ms 200ms",visibility:t?"visible":"hidden",opacity:t?1:0}})),[t]);return(0,O.U)(n.icon)})),Ie=o.memo((e=>{var t;let{type:n}=e;const o=(0,s.yK)((e=>({icon:{width:14,fill:e.mediumIconColor,transition:"transform .3s ease"}})),[]);return null===(t=Me(n))||void 0===t?void 0:t(o.icon)}));function Me(e){return"text"===e?V.wG.text:"number"===e?V.wG.number:"checkbox"===e?V.wG.checkbox:"date"===e?V.wG.date:"block"===e?V.wG.relation:"person"===e?V.wG.person:"select"===e?V.wG.select:"array"===e?V.wG.multi_select:"function"===e||void 0===e||"unknown"===e?V.wG.formula:void(0,v.t1)(e)}function Ce(){return(0,ue.jsx)(L.Z,{caption:(0,ue.jsx)(f.FormattedMessage,{defaultMessage:"No results",id:"FormulaAutocompleteMenu.noResults.message"})})}const we=(0,f.defineMessages)({[B.x2.Token]:{defaultMessage:"Properties",id:"formulaAutocompleteMenu.token.message"},[B.x2.LibraryFunction]:{defaultMessage:"Functions",id:"formulaAutocompleteMenu.function.message"},[B.x2.Binding]:{defaultMessage:"Variables",id:"formulaAutocompleteMenu.variables.message"},[B.x2.Builtin]:{defaultMessage:"Built-ins",id:"formulaAutocompleteMenu.builtin.message"}}),Te={[B.x2.Token]:we[B.x2.Token],[B.x2.LibraryFunction]:we[B.x2.LibraryFunction],[B.x2.Binding]:we[B.x2.Binding],[B.x2.Builtin]:we[B.x2.Builtin]};var je=n(37652),Fe=n(84169),Re=n(62134),Ee=n(89728),Ve=n(58297),Ae=n(26388);const Be={alignSelf:"right",marginRight:4,height:24,padding:"0 8px"},De=(0,f.defineMessages)({accept:{defaultMessage:"Accept",id:"database.formula.acceptFormulaInput.tooltip"},back:{defaultMessage:"Back",id:"formulas.SimpleFormulaValuePicker.back"},close:{id:"formula2Input.close",defaultMessage:"Close"},done:{id:"formula2Input.done",defaultMessage:"Done"},formulaHeader:{id:"formula2Input.NotionFormula",defaultMessage:"Notion Formula"},learnTooltip:{id:"formula2Input.learnAboutFormulas",defaultMessage:"Learn about formulas!"},revert:{id:"formula2Input.revert",defaultMessage:"Revert"},revertTooltip:{id:"formula2Input.revertTooltip",defaultMessage:"Revert to previous formula"}}),Ne=o.memo((e=>{const{onClickBack:t,onClickClose:n,onClickRevert:o,showRevert:i,disabled:r}=e,l=(0,s.yK)((e=>({headerRow:{display:"flex",color:e.mediumTextColor,flexDirection:"row",padding:"8px 2px 6px 12px",flexWrap:"wrap",fontWeight:500},headerLeft:{flexGrow:1,fontSize:14,display:"inline-flex",alignItems:"center"}})),[]);return(0,ue.jsxs)("span",{style:l.headerRow,children:[(0,ue.jsx)("span",{style:l.headerLeft,children:t?(0,ue.jsx)(Pe,{onClick:t}):(0,ue.jsx)(Ze,{})}),i?(0,ue.jsx)(Ge,{onClick:o}):null,r?(0,ue.jsx)(Oe,{onClick:n}):(0,ue.jsx)(Ue,{onClick:n})]})}));function Pe(e){const{onClick:t}=e,n=(0,f.useIntl)();return(0,ue.jsx)(Ee.Z,{isGray:!0,isSmall:!0,icon:je.V,onClick:t,children:n.formatMessage(De.back)})}function Oe(e){const{onClick:t}=e,n=(0,f.useIntl)();return(0,ue.jsx)(Ve.Z,{onClick:t,style:Be,children:n.formatMessage(De.close)})}function Ue(e){const{onClick:t}=e,n=(0,i.O7)(),o=(0,f.useIntl)(),r=(0,s.yK)((e=>({commandText:{color:e.mediumInvertedTextColor}})),[]);return(0,ue.jsx)(Ae.ZP,{renderTooltip:()=>(0,ue.jsxs)("div",{children:[(0,ue.jsx)("span",{children:o.formatMessage(De.accept)})," ",(0,ue.jsxs)("span",{style:r.commandText,children:[Re.fg(n).command,"+Enter"]})]}),render:e=>(0,ue.jsx)(Ve.Z,{onClick:t,style:Be,...e,children:o.formatMessage(De.done)})})}function Ze(){const e=(0,f.useIntl)(),t=(0,s.yK)((()=>({headerTitle:{fontSize:12,display:"flex",alignItems:"center"},helpButton:{marginLeft:2,height:20,width:20}})),[]);return(0,ue.jsxs)("span",{style:t.headerTitle,children:[e.formatMessage(De.formulaHeader),(0,ue.jsx)(Ae.ZP,{placement:Ae.ug.Top,render:n=>(0,ue.jsx)(j.Z,{...n,ariaLabel:e.formatMessage(De.learnTooltip),icon:Fe.m,href:(0,C.UY)("guides.formulas"),external:!0,style:t.helpButton}),renderTooltip:()=>e.formatMessage(De.learnTooltip)})]})}function Ge(e){const{onClick:t}=e,n=(0,f.useIntl)(),o=(0,s.yK)((e=>({revertButton:{marginLeft:4,marginRight:4,color:e.mediumIconColor}})),[]);return(0,ue.jsx)(Ae.ZP,{placement:Ae.ug.Top,render:e=>(0,ue.jsx)(Ee.Z,{...e,"aria-label":n.formatMessage(De.revertTooltip),isGray:!0,isSmall:!0,style:o.revertButton,onClick:t,children:n.formatMessage(De.revert)}),renderTooltip:()=>n.formatMessage(De.revertTooltip)})}n(52262),n(24506);var Le=n(83355),_e=n(1302),Ke=n(13991),We=n(14577),He=n(15095),ze=n(62193),$e=n(6746),Qe=n(52423),Ye=n(993),Xe=n(94887),qe=n(14976),Je=n(45023),et=n(70219),tt=n(89086),nt=n(30874),ot=n(29595),it=n(1743),rt=n(93262);const st={flexGrow:1,flexShrink:1,textAlign:"left",fontFamily:y.Z.getCompositeFontFamily(Ke.SP).githubMono,fontSize:12,tabSize:2,whiteSpace:"pre-wrap",borderRadius:4,minHeight:"1em",height:"100%",wordBreak:"break-all",paddingLeft:12,paddingRight:13,paddingBottom:10};class lt extends Le.Z{constructor(){super(...arguments),this.editor=null,this.mergeEditorRefs=(0,ze.sH)(),this.renderContentContainer=(e,t)=>{let{leafRef:n,wrapperRef:i,...r}=e;const{device:s}=this.environment;return(0,ue.jsx)("div",{ref:i,...r,onKeyDown:e=>{!function(e,t,n){(0,Je.Z)(n,e,"command+enter")&&(t(),e.stopPropagation())}(e,this.props.handleSave,this.environment),null==r||r.onKeyDown(e)},style:{flexGrow:1,display:"table"},children:(0,ue.jsx)(ot.Z,{ref:this.mergeEditorRefs(this.editorRef,n),style:st,getDisabled:()=>this.props.disabled,getHtml:()=>function(e,t,n,i,r,s,l,a,d,u,c,p,f){const x=m.QaF(e),v="notion",y=n.languages[v],g=document.createElement("div"),b=n.highlight(x,y,v);g.innerHTML=le.g7(b);const k=h.oA(Array.from(g.childNodes).map(dt));for(const o of t)e=m.aSf({textValue:e,selection:o,annotation:[m.GKr.FormulaError]});const S=function(e){let{syntaxTokens:t,textValue:n,store:o,parentSpaceId:i,valueTypes:r,theme:s,isAndroid:l,isSafariOrIOS:a,isWindows:d,isMobileNative:u,currentUserId:c,overwriteBaseUrlFromSpaceId:p}=e;const f=le.kF(n,t),h=n.map(m.hDy).map(((e,t)=>te.fn({annotations:e,theme:s,getRecordModel:o.getRecordModel,spaceId:i})));return f.map(((e,t)=>{const f=n[e.textTokenIndex],x=h[e.textTokenIndex];return m.km_(f)?(0,te.$i)({args:{textValue:{value:n,spaceId:i},getRecordModel:o.getRecordModel,getRecordRole:o.getRecordRole,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableLinks:!1,userTimeZone:(0,X.r)(),disabled:!1,isAndroid:l,isSafariOrIOS:a,isWindows:d,showEmojiInline:d,emojiType:"raw",highlightDiscussionId:void 0,theme:s,intl:I.default.getIntl(),renderedPageBlockId:void 0,parentBlockId:void 0,katex:void 0,isClient:!0,baseUrl:oe.default.domainBaseUrl,publicDomainName:oe.default.publicDomainName,currentUserId:c,overwriteBaseUrlFromSpaceId:p,externalIntegrations:nt.Z.integrations.state,formulaValueTypes:r,emojiData:re.Z.state,isMobileNative:u,isMobileNativeExternalLinkFixEnabled:de.default.checkGate("mobile_native_external_link_fix"),displayInUserTimezone:de.default.checkGate("display_date_in_user_timezone")},style:x.style,classNames:x.classNames,index:t,token:f,tokenValue:m.WiV(f),tokenAnnotations:m.hDy(f)}):(0,ue.jsx)("span",{className:[e.classNames||"",...x.classNames].join(" "),style:x.style,"data-token-index":e.textTokenIndex,children:e.value},t)}))}({store:i,parentSpaceId:r,valueTypes:s,syntaxTokens:h.oA(k),textValue:e||[],theme:l,isAndroid:a,isSafariOrIOS:d,isWindows:u,isMobileNative:c,overwriteBaseUrlFromSpaceId:p,currentUserId:f}),M=(0,ue.jsxs)(o.Fragment,{children:[S,(0,ue.jsx)("span",{children:"\n"})]});return $e.Z.renderToStaticMarkup(M)}(this.textValueStore.state,this.props.errorRanges,this.props.Prism,this.props.store,this.props.parentSpaceId,this.props.valueTypes,this.theme,s.isAndroid,s.isSafari||s.isIOS,s.isWindows,s.isMobileNative,(0,et.b)(this.environment),this.environment.currentUser.id),getSelection:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_getContainerSelection,onMutation:e=>function(e,t,n){const{newValue:o}=e;b.createAndCommit({userAction:"FormulaInputText.handleMutation",environment:n,perform:e=>{Ye.aS({environment:n,editorMode:"default",store:t,newValue:o,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,disableFilters:!0,transaction:e}),e.postEnqueueActions.push((()=>{b.createAndCommit({userAction:"FormulaInputText.normalizeTextValue",environment:n,perform:e=>{Ye.vE({store:t,editorMode:"default",transaction:e})}})}))}})}(e,this.props.store,this.environment),spellCheck:!1,autoCorrect:"off",autoCapitalize:"off",onSelect:t,onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,suppressNewlineEvents:!1,placeholder:" "})})},this.handleClick=e=>{qe.SD({environment:this.environment,event:e,textValue:this.textValueStore.state,editorNode:this.getEditorNode(),store:this.props.store,canEdit:!this.props.disabled})},this.handleDelete=e=>{if(this.props.disabled)return;const t=T.default.state;"editing"===t.mode&&t.multiSelection.start.store===this.props.store&&(b.createAndCommit({userAction:"FormulaInputText.handleDelete",environment:this.environment,perform:n=>{Xe.as({environment:this.environment,multiSelection:t.multiSelection,deleteForwards:!0,transaction:n,event:e,editorMode:"default"})}}),this.scrollSelectionIntoView())},this.handleBackspace=e=>{if(this.props.disabled)return;const t=T.default.state;if("editing"===t.mode&&t.multiSelection.start.store===this.props.store){if(Xe.YV({device:this.environment.device,event:e,multiSelection:t.multiSelection}))return;b.createAndCommit({userAction:"FormulaInputText.handleBackspace",environment:this.environment,perform:n=>{Xe.as({environment:this.environment,multiSelection:t.multiSelection,deleteForwards:!1,transaction:n,event:e,editorMode:"default"})}}),this.scrollSelectionIntoView()}},this.handleShiftEnter=e=>{var t,n,o;if(this.props.disabled)return;if(null===(t=e.preventDefault)||void 0===t||t.call(e),this.editor&&this.editor.isComposing)return;const i=T.default.state,r="editing"===i.mode&&(0,M.QY)(i.multiSelection);if(!r)return;const s=this.textValueStore.state,l=He.p4(m.QaF(s)),a=null===(n=l.slice(0,r.selection.startIndex).join("").split("\n"))||void 0===n?void 0:n.at(-1),d=(null==a||null===(o=a.match(/^\t*/))||void 0===o?void 0:o[0].length)||0,u=(null==a?void 0:a.split("").reverse())||[];let c=0;const p=u.some((e=>{if(")"===e)c++;else if("("===e){if(0===c)return!0;c--}return!1}))?d+1:d;let f="\t".repeat(p);const h=")"===l[r.selection.endIndex],x=!(null==a||!a.endsWith("("))&&h;x&&(f+=`\n${"\t".repeat(p-1)}`),b.createAndCommit({userAction:"FormulaInputText.handleShiftEnter",environment:this.environment,perform:e=>{Ye.hJ({environment:this.environment,editorMode:"default",store:this.props.store,string:`\n${f}`,selection:r.selection,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:e}),x&&g.Z5({store:this.props.store,selection:{startIndex:r.selection.startIndex+p+1,endIndex:r.selection.startIndex+p+1}})}}),this.scrollSelectionIntoView()},this.handleCopy=e=>{var t;const{markdownLinkifyIt:n}=this.props,o=window.getSelection();null!=o&&o.anchorNode&&null!==(t=this.editor)&&void 0!==t&&null!==(t=t.getNode())&&void 0!==t&&t.contains(o.anchorNode)&&ne.JG({environment:this.environment,event:e,markdownLinkifyIt:n})},this.handleCut=e=>{const{markdownLinkifyIt:t}=this.props;this.props.disabled?e.preventDefault():(ne.by({environment:this.environment,event:e,markdownLinkifyIt:t}),this.scrollSelectionIntoView())},this.handlePaste=e=>{const{markdownLinkifyIt:t,tinyMceMicrosoftWordPasteFilter:n}=this.props;this.props.disabled?e.preventDefault():(b.createAndCommit({userAction:"FormulaInputText.handlePaste",environment:this.environment,perform:o=>{ne.v({environment:this.environment,event:e,disableEmbedMenu:!0,transaction:o,onPasteFiles:ne.AL,markdownLinkifyIt:t,tinyMceMicrosoftWordPasteFilter:n})}}),this.scrollSelectionIntoView())},this.handleMouseOver=e=>{qe.vO({environment:this.environment,event:e,textValue:this.textValueStore.state,editorNode:this.getEditorNode(),store:this.props.store,canEdit:!this.props.disabled})},this.handleMouseOut=e=>{qe.kV({environment:this.environment,event:e,textValue:this.textValueStore.state,editorNode:this.getEditorNode(),store:this.props.store,canEdit:!this.props.disabled})},this.scrollSelectionIntoView=()=>{const e=window.getSelection();null!=e&&e.rangeCount&&_e.default.afterNextFlush((()=>{var t;const n=e.getRangeAt(0).getClientRects()[0],o=null===(t=this.editor)||void 0===t||null===(t=t.getNode())||void 0===t||null===(t=t.parentElement)||void 0===t?void 0:t.parentElement,i=null==o?void 0:o.getBoundingClientRect();n&&o&&i&&(i.top>=n.top?o.scrollTo({top:o.scrollTop+(n.top-i.top)-6}):i.bottom<=n.bottom+n.height&&o.scrollTo({top:o.scrollTop+(n.bottom-i.bottom)+28}))}))},this.clearBrowserSelection=()=>{var e;null===(e=this.getEditorNode())||void 0===e||e.blur()},this.textValueStore=new We.Z((()=>this.props.store.getValue()||[]),{debugName:"FormulaInputText.textValueStore"}),this.isEditing=this.createComputedStore((()=>{var e;const t=T.default.state;return"editing"===t.mode&&(null===(e=(0,M.QY)(t.multiSelection))||void 0===e?void 0:e.store)===this.props.store})),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_getContainerSelection=()=>function(e,t){if(t.state)return(0,tt.HE)(e)}(this.props.store,this.isEditing),this.getEndSelection=()=>{const e=He.p4(m.QaF(this.textValueStore.state));return{startIndex:e.length,endIndex:e.length}},this.editorRef=e=>{this.editor=e}}UNSAFE_willMount(e){e.focus&&g.NX({store:e.store})}renderComponent(){const{store:e,disabled:t,handleSave:n}=this.props;return(0,ue.jsx)(it.Z,{debugName:"FormulaInputText",capture:!0,allowEnter:!0,allowTabUntab:!0,allowUndo:!0,allowEsc:!0,allowCopyPaste:!0,children:(0,ue.jsx)(rt.Z,{store:e,disabled:t,clearBrowserSelection:this.clearBrowserSelection,getEndSelection:this.getEndSelection,onClick:this.handleClick,onDelete:this.handleDelete,onBackspace:this.handleBackspace,onShiftEnter:this.handleShiftEnter,onCommandShiftEnter:h.yR,onTab:e=>function(e,t,n,o){if(t)return;e.preventDefault();const i=T.default.state,r="editing"===i.mode&&(0,M.QY)(i.multiSelection);r&&b.createAndCommit({userAction:"FormulaInputText.handleTab",environment:o,perform:e=>{Ye.wA({environment:o,store:n,editorMode:"default",selection:r.selection,transaction:e,shouldStripTokens:!1,disableFilters:!0})}})}(e,this.props.disabled,this.props.store,this.environment),onUntab:e=>function(e,t,n,o){if(t)return;e.preventDefault();const i=T.default.state,r="editing"===i.mode&&(0,M.QY)(i.multiSelection);r&&b.createAndCommit({userAction:"FormulaInputText.handleUntab",environment:o,perform:e=>{Ye.O5({environment:o,store:n,editorMode:"default",selection:r.selection,transaction:e,shouldStripTokens:!1,disableFilters:!0})}})}(e,this.props.disabled,this.props.store,this.environment),onToggleBold:e=>ut(e,this.props.disabled),onToggleItalics:e=>ut(e,this.props.disabled),onToggleUnderline:e=>ut(e,this.props.disabled),onToggleStrike:e=>ut(e,this.props.disabled),onToggleCode:h.yR,onCopy:this.handleCopy,onCut:this.handleCut,onPaste:this.handlePaste,onMoveUp:e=>{return t=this.environment,void b.createAndCommit({userAction:"FormulaInputText.handleMoveUp",environment:t,perform:e=>{Ye.fs({environment:t,transaction:e,direction:"up"})}});var t},onMoveDown:e=>{return t=this.environment,void b.createAndCommit({userAction:"FormulaInputText.handleMoveDown",environment:t,perform:e=>{Ye.fs({environment:t,transaction:e,direction:"down"})}});var t},onUndo:e=>function(e,t,n){var o;e.preventDefault();const i=Qe.XT();(null==i||null===(o=i.getFirstStore())||void 0===o?void 0:o.id)===t.id&&Qe.Yw(n)}(e,this.props.store,this.environment),onRedo:e=>function(e,t,n){var o;e.preventDefault();const i=Qe.M7();(null==i||null===(o=i.getFirstStore())||void 0===o?void 0:o.id)===t.id&&Qe.KX(n)}(e,this.props.store,this.environment),onEsc:n,render:this.renderContentContainer,disableStyleAnnotations:!0,disableMentions:!0,disableSlashCommands:!0,canSelectAllBlocks:!1,canInsertText:!0,canSelectionDrag:!0,disableMobileActionBar:!0,topBottomPadding:40,pasteBehavior:"inline"})})}getEditorNode(){var e;return(null===(e=this.editor)||void 0===e?void 0:e.getNode())||void 0}}function at(e){const{value:t}=(0,ae.useDependency)(ae.deps.prismjs),{value:n}=(0,ae.useDependency)(ae.deps.markdownLinkifyIt),{value:o}=(0,ae.useDependency)(ae.deps.tinyMceMicrosoftWordPasteFilter);return t?(0,ue.jsx)(lt,{...e,Prism:t,markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:o}):null}function dt(e){return se.Gs(e)?[e.data]:se.kK(e)?[e.textContent||"",e.className]:void 0}function ut(e,t){t||e.preventDefault()}lt.displayName="FormulaInputText";const ct=!1,pt=400;function mt(e){const{evaluationErrors:t,initialCode:n,parentSpaceId:c,outputFooter:p,disabled:y,typecheckContext:b,formulas:k,handleBack:I,onCodeChange:C,onTypeChange:j,parentCollection:R}=e,E=(0,f.useIntl)(),V=(0,i.Fy)(),{store:A,setValue:B}=(0,S.Cl)({initialValue:n,onChange:C,source:"formula",parentCollection:R}),D=(0,o.useCallback)((e=>{if(B(e.newValue),e.newSelection){const t={start:{store:A,index:e.newSelection.startIndex},end:{store:A,index:e.newSelection.endIndex}};g.NA({multiSelection:t})}}),[B,A]),N=(0,r.VK)((()=>{var e;const t=T.default.state;if("editing"===t.mode&&(null===(e=(0,M.QY)(t.multiSelection))||void 0===e?void 0:e.store)===A)return{startIndex:t.multiSelection.start.index,endIndex:t.multiSelection.end.index}}),[A]),P=(0,r.VK)((()=>!h.Xy(A.getValue(),n)),[n,A]),{handleClose:O}=e,U=(0,o.useCallback)((()=>{O(A.getValue())}),[O,A]),Z=(0,r.VK)((()=>A.getValue()),[A]),[G,L]=(0,r.VK)((()=>Z?k.processFormulaInput(Z):[void 0,void 0]),[Z,k]),_=(0,r.VK)((()=>{if(G)return k.parseFormulaInputToCst(G,L)}),[G,k,L]),K=(0,r.VK)((()=>{if(_)return k.convertFormulaCSTToAST(_[0])}),[k,_]),[W,H]=(0,o.useState)(void 0);(0,o.useEffect)((()=>{!async function(){if(K&&b&&x.x.isSuccess(K)){const e=await k.addTypesToFormulaASTAsync(K.value,b,L);H(e),null==j||j(e.node.type)}else H(void 0)}()}),[K,b,L,_,k,j]);const z=(0,o.useMemo)((()=>void 0!==W?[...(0,d.Kl)(W.node,!1),...W.errors]:[]),[W]),$=(0,o.useMemo)((()=>({parseErrors:(null==_?void 0:_[1])??[],typeErrors:z,evaluationErrors:t})),[t,_,z]),Q=(0,u.Kt)($,pt,Object.is),Y=$.parseErrors.length+$.typeErrors.length+$.evaluationErrors.length>0,X=(0,r.VK)((()=>function(e){const{errors:t,intl:n,codeLength:o,formulas:i}=e,{parseErrors:r,typeErrors:s,evaluationErrors:a}=t,d=[];if(s&&s.length>0){const e=s.map((e=>{const t=(0,l.FR)((0,l.ic)(e));return{msg:n.formatMessage(...t),range:{startIndex:e.node.startOffset,endIndex:e.node.endOffset+1}}}));d.push(...e)}else if(a&&a.length>0){const e=a.map((e=>{const t=(0,l.FR)((0,l.OY)(e));return{msg:n.formatMessage(...t),range:i.isUniqueFormulaEvaluatorError(e)?{startIndex:e.node.startOffset,endIndex:e.node.endOffset+1}:void 0}}));d.push(...e)}if(r){const e=r.map((e=>{const t=(0,l.FR)((0,l.sG)(e));return{msg:n.formatMessage(...t),range:"eof"===e.offset?{startIndex:o-1,endIndex:o}:{startIndex:e.offset,endIndex:e.offset+1}}}));d.push(...e)}return d}({errors:Q,codeLength:L?(0,a.eD)(L):(0,m.QaF)(Z).length,formulas:k,intl:E})),[Z,Q,k,E,L]),q=(0,o.useMemo)((()=>X.map((e=>e.range)).filter(v.$K)),[X]),[J,ee]=(0,o.useState)(void 0),te=(0,o.useRef)(void 0),[ne,oe]=(0,o.useState)(void 0),ie=(0,o.useRef)(1);(0,o.useEffect)((()=>{ie.current++;const e=ie.current;!async function(){if(k){const t=await k.getFormulaEditorInfoAtPosition({formula:Z??[],inputPosition:N&&N.startIndex===N.endIndex?N.startIndex:0,context:b,includeDeprecatedCompletions:!1});x.x.isSuccess(t)&&ie.current===e&&(te.current=t.value,ee(t.value))}}()}),[N,k,b,Z]);const re=(0,r.VK)((()=>{var e;return!(null!==(e=w.default.state.currentUserSettingsStore)&&void 0!==e&&null!==(e=e.getSettings())&&void 0!==e&&e.dismissed_formulas2_footer)||ct&&Math.random()<.66}),[]),se=(0,o.useCallback)((()=>{B(n)}),[n,B]);ct&&console.log("FormulaInput",{currentValue:Z,cursorEditorInfo:J,infoHelper:ne,errorMessagesWithRange:X,errorRanges:q,astWithTypes:W});const le=(0,s.yK)((e=>({container:{display:"flex",height:"100%",paddingBottom:re?30:void 0,flexDirection:"column"},editorSection:{display:"flex",flexDirection:"column",backgroundColor:"light"===e.mode?e.cardBackground:e.accentColors.gray[30]},inputText:{display:"flex",flexGrow:1,flexShrink:1,overflow:"auto",maxHeight:"min(calc(90vh - 240px - 38px - 30px), 298px)",minHeight:"28px",cursor:"text"},bottomSection:{display:"flex",flexDirection:"row",height:V.isMobile?"100%":240,maxHeight:V.isMobile?void 0:"calc(90vh - 38px - 31px - 38px - 30px)",borderTop:`1px solid ${e.outlineButtonBorder}`},leftColumn:{position:"relative",borderRight:`1px solid ${e.outlineButtonBorder}`,width:V.isMobile?"100%":void 0},rightColumn:{display:"flex",flexGrow:1},infoHelper:{padding:"12px 14px"}})),[re,V.isMobile]);return(0,ue.jsx)(F.Z,{debugName:"FormulaInput",capture:!0,children:(0,ue.jsxs)("div",{style:le.container,children:[(0,ue.jsxs)("div",{style:le.editorSection,children:[(0,ue.jsx)(Ne,{onClickBack:I,onClickClose:U,onClickRevert:se,showRevert:P,disabled:y}),(0,ue.jsx)("div",{style:le.inputText,children:(0,ue.jsx)(at,{value:Z,focus:!0,store:A,disabled:y,parentSpaceId:c,valueTypes:b.valueTypes,errorRanges:q,handleSave:U},"input")})]}),X.length>0&&Y?(0,ue.jsx)(ft,{errorMessagesWithRange:X}):p,!y&&(0,ue.jsxs)("div",{style:le.bottomSection,children:[(0,ue.jsx)("div",{style:le.leftColumn,children:(0,ue.jsx)(be,{store:A,context:b,selection:N,cursorEditorInfo:J,cursorEditorInfoRef:te,onChange:D,getRecordModel:e.getRecordModel,setInfoHelper:oe})}),!V.isMobile&&(0,ue.jsx)("div",{style:le.rightColumn,children:(0,ue.jsx)(ce,{infoHelper:ne,getRecordModel:e.getRecordModel,style:le.infoHelper})})]}),re&&(0,ue.jsx)(xt,{})]})})}const ft=o.memo((e=>{let{errorMessagesWithRange:t}=e;const n=(0,s.yK)((e=>({errors:{display:"flex",flexDirection:"row",alignItems:"center",padding:10,fontSize:y.Z.fontSize.UISmall.desktop,height:38,width:"100%",borderTop:`1px solid ${e.outlineButtonBorder}`,textWrap:"nowrap",color:e.darkTextColor,flexShrink:0},icon:{width:12,height:12,fill:"light"===e.mode?e.accentColors.red[400]:e.accentColors.red[700],display:"inline",marginRight:4,marginTop:1},errorMessages:{overflow:"hidden",textOverflow:"ellipsis",color:"light"===e.mode?e.accentColors.red[500]:e.accentColors.red[800]}})),[]);return 0===t.length?null:(0,ue.jsxs)("div",{style:n.errors,children:[(0,p.t)(n.icon),(0,ue.jsx)("span",{style:n.errorMessages,children:t.slice(0,3).map(((e,t)=>(0,ue.jsx)(ht,{index:t,errorMessageWithRange:e},t)))})]})}));function ht(e){let{errorMessageWithRange:t,index:n}=e;const{msg:o,range:i}=t,r=(0,s.yK)((()=>({errorRange:{opacity:.75}})),[]);return(0,ue.jsxs)(ue.Fragment,{children:[n>0?" ":null,o,void 0!==i&&(0,ue.jsxs)(ue.Fragment,{children:[" ",(0,ue.jsx)("span",{style:r.errorRange,children:`[${i.startIndex},${i.endIndex}]`})]})]})}const xt=o.memo((()=>{const e=(0,i.Fy)(),t=(0,i.O7)(),n=(0,o.useCallback)((()=>{const e=w.default.state.currentUserSettingsStore;e&&b.createAndCommit({userAction:"TutorialActions.dismissTutorial",environment:t,perform:t=>{k.d2({userSettingsStore:e,transaction:t,data:{dismissed_formulas2_footer:!0}})},userId:e.id,canUndo:!1})}),[t]),r=(0,s.yK)((t=>({updateBanner:{zIndex:1,position:e.isMobile?void 0:"absolute",alignSelf:"flex-end",justifySelf:"flex-end",bottom:0,display:"flex",flex:"none",alignItems:"center",fontSize:y.Z.fontSize.UISmall.desktop,paddingLeft:4,paddingRight:8,minHeight:30,height:"auto",width:"100%",color:t.mediumTextColor,borderTop:`1px solid ${t.outlineButtonBorder}`},messageText:{flexGrow:1,marginLeft:4,marginTop:6,marginBottom:6},icon:{width:14,height:14,color:t.blueColor},dismissButton:{marginLeft:2,borderRadius:"100%"},iconCloseStyle:{width:12,height:12}})),[e.isMobile]);return(0,ue.jsxs)("div",{style:r.updateBanner,children:[(0,ue.jsx)(E.Z,{}),(0,ue.jsx)(R.Z,{href:(0,C.UY)("guides.formulasWhatsChanged"),external:!0,style:r.messageText,children:I.default.formatMessage(vt.learnMoreFooter)}),(0,ue.jsx)(j.Z,{ariaLabel:I.default.formatMessage(vt.learnMoreFooter),style:r.dismissButton,onClick:n,icon:c.U})]})}));const vt=(0,f.defineMessages)({learnMoreFooter:{id:"formula2Input.learnMore.button.label",defaultMessage:"We've recently updated our formula language! Learn more."}})},96711:(e,t,n)=>{n.d(t,{V:()=>r});n(67294);var o=n(45238),i=n(85893);const r=(0,o.IU)("checkboxSquareChecked",{viewBox:"0 0 14 14",svg:(0,i.jsx)("path",{d:"M2.85742 13.4561H11.1357C12.6123 13.4561 13.3779 12.6904 13.3779 11.2344V2.91504C13.3779 1.45215 12.6123 0.693359 11.1357 0.693359H2.85742C1.38086 0.693359 0.615234 1.45215 0.615234 2.91504V11.2344C0.615234 12.6973 1.38086 13.4561 2.85742 13.4561ZM2.93945 12.1162C2.30371 12.1162 1.95508 11.7812 1.95508 11.1182V3.02441C1.95508 2.36133 2.30371 2.0332 2.93945 2.0332H11.0537C11.6826 2.0332 12.0381 2.36133 12.0381 3.02441V11.1182C12.0381 11.7812 11.6826 12.1162 11.0537 12.1162H2.93945ZM6.26855 10.3115C6.51465 10.3115 6.72656 10.1885 6.87012 9.96973L9.92578 5.19141C10.0146 5.04785 10.0967 4.88379 10.0967 4.72656C10.0967 4.3916 9.7959 4.16602 9.47461 4.16602C9.26953 4.16602 9.08496 4.27539 8.94141 4.50781L6.24121 8.8418L4.96973 7.22168C4.80566 7.00977 4.6416 6.93457 4.43652 6.93457C4.10156 6.93457 3.8418 7.20117 3.8418 7.54297C3.8418 7.70703 3.90332 7.85742 4.01953 8.00098L5.63281 9.96973C5.81738 10.209 6.01562 10.3115 6.26855 10.3115Z"})})},18557:(e,t,n)=>{n.d(t,{z:()=>r});n(67294);var o=n(45238),i=n(85893);const r=(0,o.IU)("flag",{viewBox:"0 0 13 14",svg:(0,i.jsx)("path",{d:"M0.825195 13.8457C1.16699 13.8457 1.4541 13.5654 1.4541 13.2168V9.47754C1.63867 9.40918 2.21973 9.19727 3.10156 9.19727C5.59668 9.19727 7.25781 10.4414 9.66406 10.4414C10.7168 10.4414 11.1885 10.3115 11.7217 10.0654C12.207 9.84668 12.4941 9.4502 12.4941 8.82129V1.99219C12.4941 1.55469 12.1523 1.27441 11.6943 1.27441C11.3047 1.27441 10.6895 1.54102 9.58887 1.54102C7.20996 1.54102 5.52148 0.296875 3.0332 0.296875C1.99414 0.296875 1.5293 0.419922 0.975586 0.672852C0.49707 0.891602 0.196289 1.24707 0.196289 1.86914V13.2168C0.196289 13.5586 0.483398 13.8457 0.825195 13.8457ZM9.63672 9.16309C7.41504 9.16309 5.71289 7.92578 3.12207 7.92578C2.45215 7.92578 1.84375 8.00098 1.48145 8.14453V2.0332C1.59766 1.83496 2.11035 1.56836 3.05371 1.56836C5.38477 1.56836 7.09375 2.80566 9.56836 2.80566C10.2383 2.80566 10.792 2.73047 11.2158 2.61426V8.69824C11.0996 8.89648 10.5801 9.16309 9.63672 9.16309Z"})})}}]);