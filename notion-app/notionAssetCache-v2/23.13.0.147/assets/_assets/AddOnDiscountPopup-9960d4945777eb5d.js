"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[9729],{80671:(e,t,n)=>{n.d(t,{Cl:()=>m,Kj:()=>_,jw:()=>g,k2:()=>l,v5:()=>f});n(21703);var o=n(19889),s=n(896),a=n(12139),r=n(53965),i=n(7032),u=n(86572),d=n(80444),c=n(6258),p=n(63423);function l(){p.Z.setState({open:!0,stage:"limit_reached",addOnUpgradeId:(0,i.ZP)(),tax:0})}function f(){p.Z.setState({open:!1})}function m(e){const t=p.Z.state;t.open&&p.Z.setState({...t,stage:"confirm_purchase",coupon:e&&!(0,s.$v)(e)?e:void 0})}function _(){p.Z.setState({open:!0,stage:"cancel_plan",addOnUpgradeId:(0,i.ZP)(),tax:0})}async function g(e){const{environment:t,spaceStore:n,from:s}=e,i=function(){var e;const t=null===(e=d.default.state.currentSpaceStore)||void 0===e?void 0:e.getAdminIds();if(!t||0===t.length)throw new Error("No admins found in the current space");return(0,r.UP)(t)}(),p=n.getName(),l=c.U6.createChildStore(n,{table:o.KJ,id:i});await l.load();const f=l.getEmail();f?u.bf(t,{admin_id:i,admin_email:f,space_name:p,from:s}):a.IE(new Error("Could not get email for admin in sendMemberRequestForAddOn"))}},71487:(e,t,n)=>{n.d(t,{AG:()=>d,yY:()=>u});var o=n(9291),s=n(54642),a=n(47307),r=n(33929);n(80444);const i=(0,o.defineMessages)({invalidCoupon:{id:"applyCoupon.error.invalidCoupon",defaultMessage:"Unable to apply the coupon to your account."}});async function u(e,t){const{customerId:n,offerType:o}=t,r=await s.getCustomerOffer(e,{customerId:n,newPlan:"downgrade_flow"===o?t.newPlan:void 0,offerType:o});if("failed"===r.type)a.showError(r);else{const e=r.data;if(e.offerType===o)return e.coupon}}async function d(e,t){const{customerId:n,coupon:o,offerType:u}=t;if(!o)return void a.showErrorMessage(r.default.formatMessage(i.invalidCoupon));const d=await s.applyCustomerOffer(e,{customerId:n,newPlan:"downgrade_flow"===u?t.newPlan:void 0,offerType:u,coupon:o});"failed"===d.type&&a.showError(d)}},74011:(e,t,n)=>{n.r(t),n.d(t,{AddOnDiscountPopup:()=>A});var o=n(67294),s=n(480),a=n(86628),r=n(24405),i=n(92595),u=n(11751),d=n(3791),c=n(896),p=n(9291),l=n(86572),f=n(13447),m=n(37181),_=n(48779),g=n(77907),h=n(80444),v=n(80671),w=n(71487),y=n(70060),S=n(43163),b=n(88893),M=n(35057),P=n(88280),C=n(85893);function A(){const e=(0,s.O7)(),[t,n]=o.useState(void 0);(0,o.useEffect)((()=>{(0,i.exposeDebugValue)("resetAddOnDiscountPopup",(()=>{const{currentUserSettingsStore:t}=h.default.state;t&&f.createAndCommit({userAction:"AddOnDiscountPopup.resetAddOnPromoPopup",environment:e,perform:e=>{m.d2({userSettingsStore:t,transaction:e,data:{seen_ai_discount_popup:!1}})}})}))}),[e]);const{currentUserSettingsStore:A,currentSpaceStore:I}=(0,a.VK)((()=>h.default.state),[]),x=(0,a.VK)((()=>P.subscriptionDataStoreInstance.state),[]);(0,o.useEffect)((()=>{!async function(){var t;if(!I)return;if(!x)return;if(!(0,b.GJ)(x))return;if("unsubscribed_admin"!==x.type&&"subscribed_admin"!==x.type)return;if("stripe"!==(null===(t=x.customerData)||void 0===t?void 0:t.activeSubscriptionPlatform)||!x.customerData.stripe.isSubscribed)return;const o=b.XX(x);if((0,d.de)(null==o?void 0:o.addOns))return;const s=null!=o&&o.customerId?await w.yY(e,{offerType:"add_on_upgrade_flow",customerId:o.customerId}):void 0;(0,c.pp)(s)&&n(s)}()}),[e,I,x]);const O=(0,o.useCallback)((()=>{A&&(f.createAndCommit({userAction:"AddOnDiscountPopup.markSeen",environment:e,perform:e=>{m.d2({userSettingsStore:A,transaction:e,data:{seen_ai_discount_popup:!0}})}}),l.j(e,{name:"add_on_discount_popup_dismissed"}))}),[A,e]),j=(0,o.useCallback)((()=>{t&&(v.k2(),v.Cl(t))}),[t]),D=(0,a.VK)((()=>!(!(0,c.pp)(t)||!(0,y.px)(e,(0,M.zt)())||(0,_.CV)(I))),[t,e,I]),E=(0,r.yK)((e=>({icon:{width:20,height:20,fill:e.accentColors.purple[400]}})),[]);return D?(0,C.jsx)(g.LazyFeatureIntroPopup,{calloutId:"add_on_discount_popup",initialPromo:{icon:u.t,iconStyle:E.icon,header:(0,C.jsx)(p.FormattedMessage,{id:"AddOnDiscountPopup.header",defaultMessage:"Add unlimited AI for {percentage} off?",values:{percentage:(0,c.pp)(t)?(0,S.o)(t):void 0}}),description:(0,C.jsx)(p.FormattedMessage,{id:"AddOnDiscountPopup.description",defaultMessage:"Project management is better with Notion AI. Add it on top of your paid plan with half off."})},steps:[],seenFeatureUserSetting:"seen_ai_discount_popup",userSettingsStore:A,allowExternalMouseEvents:!0,onDismiss:O,onTryFeatureClick:j,isUserEligible:D,onPopupSeen:()=>l.j(e,{name:"add_on_discount_popup_seen"}),onLearnMore:()=>{t&&j(),O()},ctaMessage:(0,C.jsx)(p.FormattedMessage,{id:"AddOnDiscountPopup.purchase.button",defaultMessage:"Claim your deal"})}):null}},43163:(e,t,n)=>{n.d(t,{W:()=>i,o:()=>r});n(67294);var o=n(9291),s=n(1898),a=n(85893);function r(e){switch(e){case"team_three_months":case"ai_fifty_percent":return(0,a.jsx)(o.FormattedMessage,{id:"coupon.percentage.fiftyPercent",defaultMessage:"50%"});case"team_annual":case"business_three_months":case"business_annual":case"enterprise_three_months":case"enterprise_annual":return(0,a.jsx)(o.FormattedMessage,{id:"coupon.percentage.tenPercent",defaultMessage:"10%"});default:(0,s.t1)(e)}}function i(e){switch(e){case"team_annual":case"business_annual":case"enterprise_annual":return(0,a.jsx)(o.FormattedMessage,{id:"coupon.duration.twelveMonths",defaultMessage:"12 months"});case"team_three_months":case"business_three_months":case"enterprise_three_months":case"ai_fifty_percent":return(0,a.jsx)(o.FormattedMessage,{id:"coupons.duration.threeMonths",defaultMessage:"3 months"})}}}}]);