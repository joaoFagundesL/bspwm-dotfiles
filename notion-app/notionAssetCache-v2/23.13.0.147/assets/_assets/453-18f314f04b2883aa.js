"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[453],{80453:(e,t,o)=>{o.r(t),o.d(t,{Comment:()=>ui,CommentFileBlock:()=>Oo,Discussion:()=>Pi,DiscussionIndicator:()=>Ki.Z,DiscussionInput:()=>li,DiscussionReactionBar:()=>ut,MarginCommentsSection:()=>fn,NewDiscussionMenu:()=>Dn,ReactionBar:()=>mt,ReplyDiscussionMenu:()=>In,SuggestionContext:()=>_i,discussionHelpers:()=>le,discussionViewActions:()=>i,reactionActions:()=>$e});var i={};o.r(i),o.d(i,{isCommentUnread:()=>vi});o(21703);var n=o(67294),s=o(1302),r=o(480),a=o(6740),l=o(97511),d=o(33125),c=o(86628),u=o(24405),m=o(68626),p=o(59194),g=o(69651),h=o(45238),f=o(85893);const v=(0,h.IU)("suggestBadge",{viewBox:"0 0 16 16",svg:(0,f.jsxs)("g",{children:[(0,f.jsx)("circle",{cx:"8",cy:"8",r:"7",fill:"#fff",fillOpacity:"1"}),(0,f.jsx)("circle",{cx:"8",cy:"8",r:"7",fill:"#2383E2",fillOpacity:"0.07"}),(0,f.jsx)("circle",{cx:"8",cy:"8",r:"7.5",fill:"#2383E2",fillOpacity:"0.14"}),(0,f.jsx)("path",{fill:"#2383E2",d:"M7.843 9.24l-.906.338c-.07.027-.139.013-.205-.044-.064-.057-.08-.128-.048-.212l.342-.9 3.134-3.13.814.813L7.843 9.24zm3.4-3.398l-.816-.817.359-.352a.617.617 0 01.362-.174.364.364 0 01.332.106l.14.14c.1.105.144.227.133.366a.596.596 0 01-.168.366l-.341.365zM4.142 7.88a3.6 3.6 0 01.236-1.316A3.075 3.075 0 016.12 4.8c.413-.168.87-.252 1.374-.252.333 0 .667.05 1.002.15.337.1.662.24.974.42l-.742.742a3.16 3.16 0 00-.65-.25 2.707 2.707 0 00-.69-.088 2.34 2.34 0 00-1.179.294 2.09 2.09 0 00-.807.817c-.193.348-.29.755-.29 1.22a3.474 3.474 0 00.478 1.753c.164.283.37.548.619.797.25.248.548.472.892.67.344.198.737.36 1.18.485a.856.856 0 01.33.178c.078.073.117.179.117.318 0 .13-.03.229-.092.297a.432.432 0 01-.243.133.884.884 0 01-.311.007 3.974 3.974 0 01-1.05-.331 5.303 5.303 0 01-1.059-.663 5.448 5.448 0 01-.93-.957 4.753 4.753 0 01-.66-1.217 4.204 4.204 0 01-.242-1.443zm7.69.94c0 .454-.097.855-.293 1.204a2.13 2.13 0 01-.82.816c-.352.196-.76.294-1.228.294-.287 0-.574-.038-.861-.116a3.662 3.662 0 01-.82-.332 3.07 3.07 0 01-.69-.522l1.042-.397c.175.146.373.262.594.349.221.086.446.13.674.13.266 0 .509-.06.728-.181.22-.121.396-.289.526-.503a1.42 1.42 0 00.195-.745c0-.212-.038-.43-.113-.656a3.227 3.227 0 00-.308-.674l.725-.735c.2.313.359.644.475.995.116.349.175.706.175 1.073z"})]})});var x=o(30548),b=o(72141),S=o(21202),y=o(9291),C=o(52629),w=o(37810),j=o(54564),k=o(47307),M=o(61045),L=o(993),D=o(98104),R=o(13447),I=o(74136),B=o(26388),T=o(64369),F=o(42402),Z=o(67706),_=o(65085),A=o(12740),V=o(65187),P=o(11368),z=o(4708),K=o(65598),E=o(16402),W=o(89574),U=o(69475),N=o(61766),H=o(77080),O=o(96049),G=o(77144),$=o(6258),q=o(17707),X=o(95306);const Y=8,J=10,Q=8,ee=24,te=6,oe=1.5,ie=(ee-oe)/2,ne=ee+te,se=`calc(100% + ${Q+(Y-te)-ne}px)`,re=ee+8;function ae(e){return"margin_comments"===e?12:"comment_unfurl"===e?14:16}var le=o(10417),de=o(82994),ce=(o(57658),o(15145)),ue=o(41432),me=o(37652),pe=o(13148),ge=o(56666),he=o(27714),fe=o(25651),ve=o(40350),xe=o(18101);const be=(0,h.IU)("resolve",{viewBox:"0 0 16 16",svg:(0,f.jsx)(f.Fragment,{children:(0,f.jsx)("path",{d:"M6.6123 14.2646C7.07715 14.2646 7.43945 14.0869 7.68555 13.7109L14.0566 3.96973C14.2344 3.69629 14.3096 3.44336 14.3096 3.2041C14.3096 2.56152 13.8311 2.09668 13.1748 2.09668C12.7236 2.09668 12.4434 2.26074 12.1699 2.69141L6.57812 11.5098L3.74121 7.98926C3.48828 7.68848 3.21484 7.55176 2.83203 7.55176C2.16895 7.55176 1.69043 8.02344 1.69043 8.66602C1.69043 8.95312 1.7793 9.20605 2.02539 9.48633L5.55273 13.7588C5.84668 14.1074 6.1748 14.2646 6.6123 14.2646Z"})})});var Se=o(98519),ye=o(37612),Ce=o(19889),we=o(53965),je=o(1898),ke=o(893),Me=o(52275),Le=o(31945),De=o(73063),Re=o(78140),Ie=o(32163),Be=o(72495),Te=o(83182),Fe=o(95477),Ze=o(43250),_e=o(60709),Ae=o(18514),Ve=o(80444),Pe=o(1600),ze=o(73935),Ke=o(70279),Ee=o(33709),We=o(31701),Ue=o(27153),Ne=o(23063),He=o(64921),Oe=o(11059),Ge=o(72187),$e=o(21899),qe=o(28992),Xe=o(66957);var Ye=o(54368),Je=o(77420),Qe=o(70301),et=o(45653),tt=o(83420);function ot(e){let{authorStore:t,avatarSize:o,avatarStyle:i,placeholderStyle:n}=e;const s=(0,u.Fg)(),r=(0,c.VK)((()=>(0,tt.TL)(t)),[t]),a=(0,c.VK)((()=>H.default.checkGate("comments_density_image_handling")),[]),l=(0,u.yK)((e=>({placeholder:{width:o,height:o,background:e.lightDividerColor,borderRadius:o/2,flexShrink:0,...i}})),[o,i]);return r.asActor?r.table===Ce.KJ?(0,f.jsx)(et.Z,{hasTooltip:!0,userValue:r.asActor,style:i,size:o,avatarShouldShowShadow:!a}):r.table===Je.cZ?(0,f.jsx)(Qe.Z,{botValue:r,size:o,style:i}):r.table===Ye.y0?(0,f.jsx)("div",{style:a?l.placeholder:{...n,background:s.lightDividerColor}}):void(0,je.t1)(r):(0,f.jsx)("div",{style:a?l.placeholder:{...n,background:s.lightDividerColor}})}function it(e){let{reactionStores:t,initialIndex:o}=e;const[i,s]=n.useState(o),r=(0,y.useIntl)(),a=(0,c.VK)((()=>t.map((e=>e.getIcon()))),[t]),l=(0,c.VK)((()=>t[i].getActorStores().map((e=>({id:e.id,store:e,name:e.getDisplayName(r)}))).filter(je.$K)),[t,i,r]);return(0,f.jsxs)(Re.Z,{menuType:_e.og.ActionSheet,children:[(0,f.jsx)(Xe.Z,{tabStyle:{flex:1,justifyContent:"center",display:"flex",minWidth:60},tabs:a,selectedIndex:i,onChange:e=>s(e)}),l.map((e=>(0,f.jsx)(qe.Z,{title:e.name,dontShrinkIcon:!0,icon:(0,f.jsx)(ot,{authorStore:e.store,avatarSize:20,avatarStyle:{width:20,height:20},placeholderStyle:{width:20,height:20}})},e.id)))]})}function nt(e){const t=(0,r.Fy)(),o=(0,c.VK)((()=>$.bh.getUserVisibleReactions(e.store)),[e.store]),i=(0,n.useRef)(null),s=function(e){const t=(0,r.O7)(),{onLongPress:o,hapticsEnabled:i=!0,timeout:s=300}=e,a=(0,n.useCallback)((()=>{var e,n,s;i&&(null!==(e=t.mobileNative)&&void 0!==e&&e.buzz?t.mobileNative.buzz():null===(n=(s=window.navigator).vibrate)||void 0===n||n.call(s,20)),o()}),[t.mobileNative,i,o]),l=(0,n.useRef)(),d=(0,n.useCallback)((()=>clearTimeout(l.current)),[]);return(0,n.useEffect)((()=>d),[d]),{onTouchStart:(0,n.useCallback)((()=>{clearTimeout(l.current),l.current=setTimeout(a,s)}),[s,a]),onTouchEnd:d,onTouchCancel:d}}({onLongPress:()=>{var e;return null===(e=i.current)||void 0===e?void 0:e.setOpen(!0)}});if(!t.isMobile)return(0,f.jsx)(f.Fragment,{children:e.children});const a=o.findIndex((t=>!e.reactionStore||t===e.reactionStore))??0;return(0,f.jsx)(Le.ZP,{ref:i,renderOrigin:()=>(0,f.jsx)("div",{...s,children:e.children}),popupType:t.isTablet?Le.Z4.Popup:Le.Z4.SlideUp,render:()=>(0,f.jsx)(it,{initialIndex:a,reactionStores:o})},e.store.id)}function st(){const{isMobile:e}=(0,r.Fy)();return(0,u.yK)((t=>({reaction:{display:"flex",margin:"1px",padding:"1px 6px 1px 6px",justifyContent:"center",gap:"4px",border:`1px solid ${t.regularDividerColor}`,borderRadius:"100px",fontSize:14,lineHeight:"20px",fontVariantNumeric:"tabular-nums",background:t.whiteButtonBackground},count:{color:t.mediumTextColor,fontSize:e?w.Z.fontSize.UISmall.mobile:w.Z.fontSize.UISmall.desktop,lineHeight:"20px"},countReacted:{color:t.blueColor},reacted:{background:We.ZP.blueWithAlpha(.08),border:`1px solid ${t.filterPillBorder}`,fontWeight:500},reactedHover:{background:We.ZP.blueWithAlpha(.18)},emojiStyle:{color:"black",display:"inline-block"},reactionIcon:{width:15,height:20,marginTop:.5,marginLeft:.5,fill:t.mediumIconColor},dropShadow:{boxShadow:t.marginDiscussionSelectedShadow}})),[e])}function rt(e){let{store:t,disabled:o,onClick:i,dropShadow:n}=e;const s=(0,c.VK)((()=>t.getActors()),[t]),a=(0,c.VK)((()=>t.getIcon()),[t]),l=st(),{currentUser:d}=(0,r.O7)();if(!s||!a)return null;if(0===s.length)return null;const u=s.some((e=>e.id===d.id)),m={...l.reaction,...u&&l.reacted,...n&&l.dropShadow},p={...l.count,...u&&l.countReacted};return(0,f.jsx)(B.ZP,{textWrap:!0,style:{maxWidth:350,width:"max-content"},placement:B.ug.Bottom,delayThreshold:300,renderTooltip:()=>(0,f.jsx)(at,{store:t,icon:a}),render:e=>(0,f.jsxs)(He.Z,{disabled:o,style:m,hoveredStyle:u?l.reactedHover:void 0,onClick:i,...e,children:[(0,f.jsx)("span",{style:l.emojiStyle,children:(0,f.jsx)(Oe.Z,{size:14,char:a})}),(0,f.jsx)("span",{style:p,children:s.length})]})})}function at(e){let{store:t,icon:o}=e;const i=(0,u.yK)((e=>({text:{color:e.mediumInvertedTextColor}})),[]),n=(0,y.useIntl)(),s=(0,c.VK)((()=>t.getActorStores()),[t]),r=(0,c.VK)((()=>s.map((e=>e.getDisplayName(n))).filter(je.$K)),[s,n]);return r.length>5?(0,f.jsx)(y.FormattedMessage,{defaultMessage:"{additionalNames, plural, one {{names} and {additionalNames} other <medium>reacted with</medium> {icon}} other {{names} and {additionalNames} others <medium>reacted with</medium> {icon}}}",id:"ReactionBar.hoverTooltip.textAbbreviated",values:{additionalNames:r.length-5,names:r.slice(0,5).join(", "),medium:e=>(0,f.jsx)("span",{style:i.text,children:e}),icon:(0,f.jsx)(Oe.Z,{size:14,char:o})}}):(0,f.jsx)(y.FormattedMessage,{defaultMessage:"{numberOfNames, plural, one {{nameOrNames} <medium>reacted with</medium> {icon}} other {{nameOrNames} <medium>reacted with</medium> {icon}}}",id:"ReactionBar.hoverTooltip.text",values:{numberOfNames:r.length,nameOrNames:r.join(", "),medium:e=>(0,f.jsx)("span",{style:i.text,children:e}),icon:(0,f.jsx)(Oe.Z,{size:14,char:o})}})}function lt(e){const{store:t,discussionLocation:o,onEmojiSelection:i,disableDropShadow:s}=e,a=(0,r.O7)(),l=(0,n.useRef)(null),d=(0,r.Fy)(),c=(0,u.yK)((e=>({container:{padding:2,display:"flex",boxShadow:e.lightBoxShadow,backgroundColor:e.buttonGroupBackground,borderRadius:d.isMobile?3:4,...s&&{borderWidth:1,borderStyle:"solid",borderColor:d.isMobile?"transparent":e.stroke.regular,borderRadius:6,boxShadow:void 0}},addIcon:{width:15,fill:e.mediumIconColor},iconButton:{height:22,width:22,flex:"0 0 auto"}})),[d.isMobile,s]),m=(0,y.useIntl)();return(0,f.jsx)("div",{style:c.container,children:(0,f.jsx)(De.Z,{hasBackground:!0,ariaLabel:m.formatMessage({defaultMessage:"Add reaction",id:"ReactionBar.newReaction.ariaLabel"}),showShadow:!1,icon:()=>(0,ve.V)(c.addIcon),style:c.iconButton,ref:l,onClick:()=>ct(a,m,t,null==l?void 0:l.current,o,i)})})}function dt(e){let{store:t,discussionLocation:o,onEmojiSelection:i}=e;const s=(0,r.O7)(),a=(0,n.useRef)(null),l=st(),d=(0,y.useIntl)();return(0,f.jsx)(He.Z,{style:{...l.reaction,minWidth:"2em"},ref:a,onClick:()=>ct(s,d,t,null==a?void 0:a.current,o,i),children:(0,ve.V)(l.reactionIcon)})}function ct(e,t,o,i,n,s){const r=ze.findDOMNode(i);if(!r)return;if(!(r instanceof Element))return;const a=r.getBoundingClientRect();Ue.$(e,{originGap:4,originRect:a,popupWidth:Ge.FZ,popupHeight:Ge.kX,isSmallWidth:!1,title:t.formatMessage({defaultMessage:"Reaction",id:"ReactionBar.emojiModalMenu.title"}),currentTab:"emoji",tabs:[{type:"emoji",title:(0,f.jsx)(y.FormattedMessage,{defaultMessage:"Emojis",id:"recordIcon.emojiTab.title"}),hideRandomButton:!0,onChange:(t,i)=>{s&&s(),R.createAndCommit({environment:e,userAction:"Comment.toggleReactionFromMenu",perform:s=>{$e.toggleReaction({environment:e,transaction:s,store:o,icon:t,discussionLocation:n}),i&&i.keepVisible||Ue.Z()}})}}]})}function ut(e){const{parentStore:t,discussionLocation:o,onReact:i}=e,s=st(),a=e=>{R.createAndCommit({userAction:"Discussion.handleResolve",environment:m,perform:e=>{q.DX({environment:m,discussionStore:t,transaction:e,discussionLocation:o})}}),j.Xv(),null==e||e.stopPropagation()},l=(0,c.VK)((()=>t.canComment()),[t]),d=(0,c.VK)((()=>t.canEdit()),[t]),m=(0,r.O7)(),p=(0,n.useRef)(null),g=(0,n.useRef)(null),h=(0,y.useIntl)(),[v,x]=(0,n.useState)(!1),b=v||e.focused,S=(0,c.VK)((()=>$.bh.getUserVisibleReactions(t)),[t]),C=e=>()=>{e.isDefined()&&(null==i||i(),R.createAndCommit({environment:m,userAction:"Comment.toggleReaction",perform:i=>{const n=1===S.length&&1===e.getActors().length&&e.getActors()[0].id===m.currentUser.id;$e.toggleReaction({environment:m,transaction:i,store:t,icon:e.getIcon(),discussionLocation:o}),n&&q.DX({environment:m,discussionStore:t,transaction:i,discussionLocation:o})}}))},w=()=>{ct(m,h,t,null==p?void 0:p.current,o,i)},k=(0,u.yK)((e=>({actionButtonStyle:{minWidth:"1.8em",height:"1.5em",borderRadius:".75em",justifyContent:"center",alignItems:"center",display:"flex"}})),[]);return(0,f.jsx)("div",{onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),style:{gap:"4px",marginTop:"12px",transform:"scale(1.2)",transformOrigin:"left",display:"flex",flexWrap:"wrap"},children:S.map(((o,i)=>(0,f.jsxs)("div",{style:{display:"flex",flexDirection:"row",gap:2},children:[(0,f.jsx)(nt,{reactionStore:o,store:t,children:(0,f.jsx)(rt,{dropShadow:e.focused,disabled:!l,store:o,onClick:C(o)})}),i===S.length-1&&(0,f.jsx)(Ne.Z,{isVisible:!0,animationStyle:{opacity:b?1:0,marginLeft:2},render:()=>(0,f.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[l&&(0,f.jsx)(nt,{store:t,children:(0,f.jsx)(He.Z,{style:k.actionButtonStyle,ref:p,onClick:w,children:(0,ve.V)(s.reactionIcon)})}),d&&(0,f.jsx)(He.Z,{style:k.actionButtonStyle,ref:g,onClick:a,children:be(s.reactionIcon)})]})})]},o.id)))})}const mt=function(e){const{parentStore:t,discussionLocation:o,onClick:i,disableDropShadow:n}=e,s=(0,c.VK)((()=>t.canComment()),[t]),a=(0,c.VK)((()=>$.bh.getUserVisibleReactions(t)),[t]),l=(0,r.O7)(),d=(0,c.VK)((()=>H.default.checkGate("comments_density_image_handling")),[]),u=(0,c.VK)((()=>H.default.checkGate("prevent_edits_trash")),[]),m=(0,c.VK)((()=>{if(t.table===Ke.x_){const e=t.getParentBlockStore();return Boolean(e&&e.pathIsDead())}if(t.table===Ee.qF){const e=t.getParentStore();return Boolean(e&&e.pathIsDead())}return!1}),[t]),p=s&&!(u&&m)&&a.length>0,g=s&&!(u&&m)&&0===a.length;return(0,f.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px",marginTop:"4px",marginBottom:"4px",...d?{marginTop:8,marginBottom:0}:{}},children:[a.map((e=>(0,f.jsx)(nt,{reactionStore:e,store:t,children:(0,f.jsx)(rt,{disabled:!s||u&&m,store:e,onClick:()=>{e.isDefined()&&(i&&i(),R.createAndCommit({environment:l,userAction:"Comment.toggleReaction",perform:i=>{$e.toggleReaction({environment:l,transaction:i,store:t,icon:e.getIcon(),discussionLocation:o})}}))}})},e.id))),p&&(0,f.jsx)(nt,{store:t,children:(0,f.jsx)(dt,{store:t,discussionLocation:o,onEmojiSelection:i})}),g&&(0,f.jsx)(lt,{store:t,discussionLocation:o,onEmojiSelection:i,disableDropShadow:n})]})},pt=be,gt=pe.U,ht=(0,y.defineMessages)({addReaction:{id:"comment.actions.addReaction.label",defaultMessage:"Add reaction"},acceptButton:{id:"comment.actions.acceptButton.label",defaultMessage:"Accept"},rejectButton:{id:"comment.actions.rejectButton.label",defaultMessage:"Reject"},moreActions:{id:"comment.actions.moreActions.label",defaultMessage:"More actions"},reopenButton:{id:"comment.actions.reopenButton.label",defaultMessage:"Re-open"},resolveButton:{id:"comment.actions.resolveButton.label",defaultMessage:"Resolve"}});function ft(e){const{discussionLocation:t}=e,o=(0,y.useIntl)(),i=(0,r.O7)(),s=i.device,a=(0,n.useRef)(null),d=(0,l.l)(),u=(0,c.VK)((()=>Boolean(e.discussionStore.getResolved())),[e.discussionStore]),m=(0,c.VK)((()=>e.store.isDefined()),[e.store]),p=(0,c.VK)((()=>{var e;return null===(e=Ve.default.state.currentUserStore)||void 0===e?void 0:e.id}),[]),g=(0,c.VK)((()=>{const t=e.store.getCreatedById();return e.store.getCreatedByTable()===Ce.KJ&&p===t}),[p,e.store]),h=(0,c.VK)((()=>{var e;const t=null===(e=Ve.default.state.currentSpaceStore)||void 0===e?void 0:e.getRole();return t&&b.zz(t)}),[]),v=(0,c.VK)((()=>e.blockStore.getRole()),[e.blockStore]),x=(0,c.VK)((()=>{var e;return null==d||null===(e=d.publicEditModeStore.state)||void 0===e?void 0:e.permission}),[null==d?void 0:d.publicEditModeStore]),S=(0,c.VK)((()=>"suggestion"===e.discussionStore.getType()),[e.discussionStore]),C=(0,c.VK)((()=>e.blockStore.pathIsDead()),[e.blockStore]),w=(0,c.VK)((()=>H.default.checkGate("prevent_edits_trash")),[]),k="comment_only"===v||"comment"===x;if(!m||!p)return null;const M=()=>{R.createAndCommit({userAction:"Comment.handleReopen",environment:i,perform:t=>{q.bh({environment:i,commentStore:e.store,discussionStore:e.discussionStore,transaction:t,discussionLocation:e.discussionLocation})}})},L=t=>{R.createAndCommit({userAction:"Comment.handleResolve",environment:i,perform:t=>{q.DX({environment:i,commentStore:e.store,discussionStore:e.discussionStore,transaction:t,discussionLocation:e.discussionLocation})}}),j.Xv(),null==t||t.stopPropagation()},D=()=>{R.createAndCommit({userAction:"Suggestion.handleAccept",environment:i,perform:t=>{Pe.Yo({action:"accept",environment:i,commentStore:e.store,discussionStore:e.discussionStore,transaction:t,discussionLocation:e.discussionLocation})}}),j.Xv()},I=()=>{R.createAndCommit({userAction:"Suggestion.handleReject",environment:i,perform:t=>{Pe.Yo({action:"reject",environment:i,commentStore:e.store,discussionStore:e.discussionStore,transaction:t,discussionLocation:e.discussionLocation})}}),j.Xv()},B=()=>{var t,o;const n=e.store.getParentStore();if(!n||null==n||!n.isDefined())return null;let s=n.getParentStore();if(null===(t=s)||void 0===t||!t.isDefined())return null;var r;s.getType()===ue.Ti.tableRow&&(s=null===(r=s)||void 0===r?void 0:r.getParentBlockStore());if(null===(o=s)||void 0===o||!o.isDefined())return null;const a=s.getModel().getRenderUrl({baseUrl:Fe.default.domainBaseUrl,getRecordModel:e.store.getRecordModel,discussionId:n.id,pageVisitSource:ce.tY.CopyLink});ke.RD({environment:i,stringValue:a,copiedMessage:ke.tq.copiedLinkToClipboard})};if(!i.currentUser.isLoggedIn())return null;const T=v&&b.rz(v)||w&&C;if(T)return null;const F=e.isFirstComment&&"comment_unfurl"!==t&&!s.isMobile&&!k&&!T,Z=[];!s.isMobile||k||T||(u?Z.push("reopen"):Z.push("resolve")),g&&Z.push("edit"),e.isFirstComment&&Z.push("copyLink"),(g||h)&&Z.push("delete");const _=Z.length>0;return _||F||e.canShowReactions?(0,f.jsx)(Le.ZP,{ref:a,popupType:s.isMobile?Le.Z4.SlideUp:Le.Z4.Popup,buttonPopupStore:e.buttonPopupStore,placementToOrigin:Le.pO.Right,stopClickPropagation:!0,renderOrigin:n=>(0,f.jsx)(bt,{buttonConfig:{resolve:{visible:F&&!S,resolved:u,onResolve:L,onReopen:M},react:{visible:e.canShowReactions,onReact:()=>{var n;ct(i,o,e.store,(null===(n=a.current)||void 0===n?void 0:n.getAnchor())??null,t,e.handleReaction)}},accept:{visible:S,onAccept:D},reject:{visible:S,onReject:I},moreActions:{visible:_}},visible:e.visible,buttonPopupEvents:n,discussionLocation:e.discussionLocation,store:e.store}),render:t=>{let o;o=s.isMobile?{menuType:_e.og.ActionSheet}:{menuType:_e.og.Popup};const i=Z.map((t=>"reopen"===t?{key:"reopen",render:e=>(0,f.jsx)(Me.Z,{...e,icon:(0,me.V)({height:16,width:16}),title:(0,f.jsx)(y.FormattedMessage,{id:"comment.reopenDiscussion.button",defaultMessage:"Re-open discussion"})}),action:M}:"resolve"===t?{key:"resolve",render:e=>(0,f.jsx)(Me.Z,{...e,icon:(0,Se.k)({height:16,width:16}),title:(0,f.jsx)(y.FormattedMessage,{id:"comment.resolveDiscussion.button",defaultMessage:"Resolve comments"})}),action:()=>L()}:"edit"===t?{key:"edit",render:e=>(0,f.jsx)(Me.Z,{...e,icon:(0,fe.R)({height:16,width:16}),title:(0,f.jsx)(y.FormattedMessage,{id:"comment.editComment.button",defaultMessage:"Edit comment"})}),action:e.handleEditComment}:"delete"===t?{key:"delete",render:e=>(0,f.jsx)(Me.Z,{...e,icon:(0,ye.y)({height:16,width:16}),title:(0,f.jsx)(y.FormattedMessage,{id:"comment.deleteComment.button",defaultMessage:"Delete comment"})}),action:e.handleDeleteComment}:"copyLink"===t?{key:"copyLink",render:e=>(0,f.jsx)(Me.Z,{...e,icon:(0,he.N)({height:16,width:16}),title:(0,f.jsx)(y.FormattedMessage,{id:"comment.copyLinkToDiscussion.button",defaultMessage:"Copy link to discussion"})}),action:B}:void(0,je.t1)(t)));return(0,f.jsx)("div",{className:Ze.G6g,children:(0,f.jsxs)(Re.Z,{...o,children:[(0,f.jsx)(Ie.Z,{type:Ie.i.Vertical,initialFocus:void 0,onAccept:t.close,sections:we.oA([i.length&&{key:0,render:e=>(0,f.jsx)(Be.Z,{...e}),items:i}])}),!s.isMobile&&(0,f.jsx)(Be.Z,{topBorder:!0,disableDesktopPadding:!1,children:(0,f.jsx)(Te.Z,{title:(0,f.jsx)(y.FormattedMessage,{defaultMessage:"Learn about comments",id:"comments.learn"}),href:(0,Ae.UY)("guides.comments"),analyticsFrom:"comments"})})]})})}}):null}function vt(e){return"accept"in e}function xt(e){return"resolve"in e}function bt(e){const{buttonPopupEvents:t,discussionLocation:o,buttonConfig:i}=e,n=(0,r.O7)().device,s=(0,y.useIntl)(),a=(0,c.VK)((()=>H.default.checkGate("comments_density_image_handling")),[]),l=(0,u.yK)((t=>({addIcon:{width:15,fill:t.mediumIconColor},container:{display:"flex",boxShadow:t.lightBoxShadow,position:"absolute",flexShrink:0,padding:"2px",backgroundColor:t.buttonGroupBackground,...n.isMobile?{borderRadius:4,marginTop:4,right:16}:{marginRight:"margin_comments"===o?0:8,marginTop:"updates_sidebar"===e.discussionLocation?6:0,right:"margin_comments"===o?12:16,top:"margin_comments"===o?6:0,opacity:e.visible?1:0,gap:1,borderRadius:4,transition:"opacity 100ms ease-out",zIndex:1},...a?{top:0,right:0}:{}}})),[n.isMobile,o,e.discussionLocation,e.visible,a]);return(0,f.jsxs)("div",{style:l.container,children:[i.react.visible&&(0,f.jsx)(B.ZP,{renderTooltip:()=>(0,f.jsx)(y.FormattedMessage,{...ht.addReaction}),render:e=>(0,f.jsx)(De.Z,{ariaLabel:s.formatMessage(ht.addReaction),hasBackground:!1,showShadow:!1,icon:()=>(0,ve.V)(l.addIcon),onClick:i.react.onReact,style:{height:22,width:22,flex:"0 0 auto"},...e})}),xt(i)&&i.resolve.visible&&(0,f.jsx)(B.ZP,{renderTooltip:()=>(0,f.jsx)(y.FormattedMessage,{...i.resolve.resolved?ht.reopenButton:ht.resolveButton}),render:e=>(0,f.jsx)(De.Z,{hasBackground:!1,showShadow:!1,icon:i.resolve.resolved?xe.b:be,onClick:i.resolve.resolved?i.resolve.onReopen:i.resolve.onResolve,style:{height:22,width:22,flex:"0 0 auto"},...e,ariaLabel:s.formatMessage(i.resolve.resolved?ht.reopenButton:ht.resolveButton)})}),vt(i)&&i.accept.visible&&(0,f.jsx)(B.ZP,{renderTooltip:()=>(0,f.jsx)(y.FormattedMessage,{...ht.acceptButton}),render:e=>(0,f.jsx)(De.Z,{hasBackground:!1,showShadow:!1,icon:pt,onClick:i.accept.onAccept,style:{height:22,width:22,flex:"0 0 auto"},ariaLabel:s.formatMessage(ht.acceptButton),...e})}),vt(i)&&i.reject.visible&&(0,f.jsx)(B.ZP,{renderTooltip:()=>(0,f.jsx)(y.FormattedMessage,{...ht.rejectButton}),render:e=>(0,f.jsx)(De.Z,{hasBackground:!1,showShadow:!1,icon:gt,onClick:i.reject.onReject,style:{height:22,width:22,flex:"0 0 auto"},ariaLabel:s.formatMessage(ht.rejectButton),...e})}),i.moreActions.visible&&(0,f.jsx)(B.ZP,{renderTooltip:()=>(0,f.jsx)(y.FormattedMessage,{...ht.moreActions}),render:e=>(0,f.jsx)(De.Z,{...t,...e,hasBackground:!1,showShadow:!1,icon:ge.o,style:{height:22,width:22,flex:"0 0 auto"},ariaLabel:s.formatMessage(ht.moreActions)})})]})}var St=o(95538),yt=o(70203),Ct=o(31781),wt=o(53471),jt=o(68785),kt=o(27016),Mt=o(69721),Lt=o(79954),Dt=o(27411),Rt=o(31505),It=o(39301),Bt=o(53336),Tt=o(73744),Ft=o(34859),Zt=o(45589);const _t=.8,At=(0,y.defineMessages)({scrollLeftButtonAriaLabel:{defaultMessage:"Scroll left",id:"FilmStrip.scrollLeftButtonAriaLabel"},scrollRightButtonAriaLabel:{defaultMessage:"Scroll right",id:"FilmStrip.scrollRightButtonAriaLabel"}});function Vt(e){let{children:t,shouldShowGrayFog:o}=e;const i=(0,y.useIntl)(),s=(0,n.useRef)(null),r=(0,c.qz)(void 0,Zt.Z),{scrollLeft:a,scrollWidth:l,clientWidth:d}=(0,c.VK)((()=>r.state),[r]),m=(0,n.useCallback)((()=>{var e;null===(e=s.current)||void 0===e||e.getClientRect()}),[]);(0,n.useEffect)((()=>(Tt.lj(window,"resize",m),()=>{Tt.ZV(window,"resize",m)})),[m]),(0,n.useEffect)((()=>{m()}),[m]);const p=(0,n.useMemo)((()=>Math.floor(a)>0),[a]),g=(0,n.useMemo)((()=>Math.ceil(a+d)<l),[a,l,d]),h=(0,n.useCallback)((e=>{var t;e.stopPropagation(),null===(t=s.current)||void 0===t||t.scrollByOffset(0,-_t*d,{animate:!0})}),[d]),v=(0,n.useCallback)((e=>{var t;e.stopPropagation(),null===(t=s.current)||void 0===t||t.scrollByOffset(0,_t*d,{animate:!0})}),[d]),x=(0,u.yK)((e=>({scrollerWrapper:{display:"flex",position:"relative"},scroller:{overflow:"auto",display:"flex",gap:4,paddingTop:6,marginTop:-6,paddingRight:4},commonArrowStyles:{position:"absolute",borderRadius:12,width:24,height:24,background:e.tint.regular,top:12,boxShadow:"none"},iconHoveredStyle:{background:e.tint.regular},leftArrowStyle:{left:0},rightArrowStyle:{right:4},arrowIconStyle:{height:12,fill:e.icon.secondary},leftArrowContainer:{position:"absolute",height:"100%",width:30,background:`linear-gradient(to right, ${o?e.hoveredMarginDiscussionBackground:e.selectedMarginDiscussionBackground} 0px, ${e.contentBackgroundTransparent} 30px`},rightArrowContainer:{position:"absolute",height:"100%",width:30,right:0,background:`linear-gradient(to left, ${o?e.hoveredMarginDiscussionBackground:e.selectedMarginDiscussionBackground} 0px, ${e.contentBackgroundTransparent} 30px`}})),[o]);return(0,f.jsxs)("div",{style:x.scrollerWrapper,children:[(0,f.jsx)(Bt.Z,{ref:s,type:Ft.Z.X,store:r,onScroll:m,style:x.scroller,zIndex:0,children:t}),p&&(0,f.jsx)("div",{style:x.leftArrowContainer,children:(0,f.jsx)(De.Z,{icon:Rt.Y,hovered:!1,showShadow:!0,onClick:h,ariaLabel:i.formatMessage(At.scrollLeftButtonAriaLabel),style:{...x.commonArrowStyles,...x.leftArrowStyle},iconStyle:x.arrowIconStyle,hoveredStyle:x.iconHoveredStyle})}),g&&(0,f.jsx)("div",{style:x.rightArrowContainer,children:(0,f.jsx)(De.Z,{icon:It.n,hovered:!1,showShadow:!0,onClick:v,ariaLabel:i.formatMessage(At.scrollRightButtonAriaLabel),style:{...x.commonArrowStyles,...x.rightArrowStyle},iconStyle:x.arrowIconStyle,hoveredStyle:x.iconHoveredStyle})})]})}const Pt=3;function zt(e){let{stores:t,collapsed:o,shouldShowGrayFogInScroller:i}=e;return 0===t.length?null:t.length<=Pt?(0,f.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:t.map((e=>(0,f.jsx)(Mt.Z,{store:e,disabled:!1,commentProps:{shouldHideBlockActionMenu:o}},e.id)))}):(0,f.jsx)(Vt,{shouldShowGrayFog:i,children:t.map((e=>(0,f.jsx)(Mt.Z,{store:e,disabled:!1,commentProps:{shouldHideBlockActionMenu:o}},e.id)))})}var Kt=o(42858);const Et=3,Wt=4;function Ut(e){let{stores:t,embedBlockLocation:o,onRemoveContent:i}=e;if(0===t.length)return null;if(t.length<=Et)return(0,f.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:t.map((e=>(0,f.jsx)(Nt,{store:e,embedBlockLocation:o,onRemoveContent:i,isLarge:!0},e.id)))});if(t.length<=Wt)return(0,f.jsx)("div",{style:{display:"flex",gap:4},children:t.map((e=>(0,f.jsx)(Nt,{store:e,embedBlockLocation:o,onRemoveContent:i,isLarge:!1},e.id)))});const n=t.slice(0,Wt-1),s=t[Wt-1],r=t.length-Wt+1,a=t.slice(Wt);return(0,f.jsxs)("div",{style:{display:"flex",gap:4},children:[n.map((e=>(0,f.jsx)(Nt,{store:e,embedBlockLocation:o,onRemoveContent:i,isLarge:!1},e.id))),(0,f.jsxs)("div",{children:[(0,f.jsx)(He.Z,{style:{position:"absolute",zIndex:1,width:48,height:48,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0, 0, 0, 0.4)",borderRadius:8,color:"white",fontWeight:w.Z.fontWeight.bold},hoveredStyle:{background:"rgba(0, 0, 0, 0.4)"},pressedStyle:{background:"rgba(0, 0, 0, 0.4)"},onClick:()=>{Kt.dK({blocks:[s]})},children:`+${r}`}),(0,f.jsx)(Nt,{store:s,embedBlockLocation:o,onRemoveContent:i,isLarge:!1},s.id)]}),(0,f.jsx)("div",{style:{display:"none"},children:a.map((e=>(0,f.jsx)(Nt,{store:e,embedBlockLocation:o,onRemoveContent:i,isLarge:!1},e.id)))})]})}function Nt(e){let{store:t,isLarge:o,embedBlockLocation:i,onRemoveContent:n}=e;const s=(0,u.yK)((e=>({imageShared:{border:`1px solid ${e.stroke.deemphasized}`,borderRadius:8,cursor:"zoom-in"}})),[]);return(0,f.jsx)(kt.ZP,{store:t,blockLocation:i,disabled:!1,disableDrag:!0,disableResizers:!0,preserveScale:!0,inlineContentStyle:{...s.imageShared,...o?Ht:Ot},disableActions:!o,onRemoveBlockFromComment:o?n:void 0},t.id)}const Ht={objectFit:"contain",width:"auto",height:"auto",maxWidth:240,maxHeight:240,minWidth:48,minHeight:48},Ot={width:48,height:48,minWidth:48,minHeight:48};var Gt=o(32854);function $t(e){let{store:t}=e;const o=(0,c.VK)((()=>Dt.default.getKeyState(Dt.default.getBlockKey(t.id))),[t.id]),i=(0,y.useIntl)(),n=(0,u.yK)((e=>({wrapper:{height:48,width:214,display:"flex",alignItems:"center",background:"white",border:`1px solid ${e.regularDividerColor}`,borderRadius:12,padding:"8px 10px 8px 8px",gap:8},icon:{background:e.tint.regular,borderRadius:6,width:32,minWidth:32,height:32,display:"flex",alignItems:"center",justifyContent:"center"},fileDetails:{display:"flex",flexDirection:"column"},fileName:{fontSize:14,fontWeight:w.Z.fontWeight.medium,lineHeight:"18px",color:e.text.primary,textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},fileSizeText:{color:e.text.secondary},progressText:{color:e.text.tertiary},sizeAndProgressContainer:{display:"flex",alignItems:"center",gap:4,fontSize:12,lineHeight:"15px"}})),[]);if(!o)return(0,f.jsxs)("div",{style:n.wrapper,children:[(0,f.jsx)("div",{style:n.icon,children:(0,f.jsx)(jt.Z,{})}),(0,f.jsx)("div",{style:n.fileDetails,children:(0,f.jsx)("div",{style:n.fileName,children:i.formatMessage({id:"commentFilePlaceholder.loading",defaultMessage:"Loading..."})})})]});const{name:s,size:r,progressPercent:a}=o;return(0,f.jsxs)("div",{style:n.wrapper,children:[(0,f.jsx)("div",{style:n.icon,children:(0,f.jsx)(jt.Z,{})}),(0,f.jsx)("div",{style:{overflow:"hidden"},children:(0,f.jsxs)("div",{style:n.fileDetails,children:[(0,f.jsx)("div",{style:n.fileName,children:s}),(0,f.jsxs)("div",{style:n.sizeAndProgressContainer,children:[(0,f.jsx)("span",{style:n.fileSizeText,children:(0,le.formatFileSize)(r)}),(0,f.jsx)("span",{style:n.progressText,children:"—"}),(0,f.jsx)(jt.Z,{}),(0,f.jsx)(Gt.Z,{percentage:a,style:n.progressText})]})]})})]})}var qt=o(64275),Xt=o(54604),Yt=o(12981),Jt=o(81865);function Qt(e){const{url:t,imageNaturalHeight:o,imageNaturalWidth:i}=e,s=(0,n.useMemo)((()=>({display:"block",width:`min(${i}px, 100%)`,height:`min(${o}px, 100%)`,pointerEvents:"auto",objectFit:"cover"})),[i,o]);return(0,f.jsx)("div",{style:eo,children:(0,f.jsx)(Yt.Z,{src:t,style:s,placeholderLoadedStyle:{display:"flex",justifyContent:"center",alignItems:"center"}})})}const eo={alignSelf:"center",margin:"0 auto",position:"relative",height:"100%",width:"100%",overflow:"hidden"};const to=function(e){let{file:t,isLarge:o}=e;const i=(0,n.useRef)(null),s=(0,r.O7)(),a=(0,c.VK)((()=>H.default.checkGate("comments_density_image_handling")),[]),l=(0,u.yK)((e=>{if(a){return{imageThumbnail:{...{border:`1px solid ${e.stroke.deemphasized}`,borderRadius:8,cursor:"zoom-in"},...o?{objectFit:"contain",width:"auto",height:"auto",maxWidth:240,maxHeight:240,minWidth:48,minHeight:48}:{width:48,height:48}}}}return{imageThumbnail:{borderRadius:4,border:`1px solid ${e.lightDividerColor}`,objectFit:"cover",height:48,width:48,cursor:"zoom-in"}}}),[a,o]),d=(0,n.useCallback)((()=>{var e;const o=null===(e=i.current)||void 0===e?void 0:e.getImageDimensions();if(!o)return;const{naturalHeight:n,naturalWidth:s}=o;return"local"===t.type?(0,f.jsx)(Qt,{url:t.dataURL,imageNaturalHeight:n,imageNaturalWidth:s}):(0,f.jsx)(Jt.Z,{url:t.source,render:(e,t)=>(0,f.jsx)(Qt,{url:t,error:e,imageNaturalHeight:n,imageNaturalWidth:s}),isAuthenticated:!0,permissionRecord:t.store.pointer})}),[t]),m=(0,n.useCallback)((e=>{var t;e.stopPropagation();const o=null===(t=i.current)||void 0===t?void 0:t.getImageDimensions();o&&Xt.ui({environment:s,renderFullScreenNode:d,fullScreenNodeRect:o.clientRect,contentAspectRatio:o.naturalWidth/o.naturalHeight})}),[d,s]);return"local"===t.type?(0,f.jsx)(Yt.Z,{src:t.dataURL,style:l.imageThumbnail,placeholderStyle:l.imageThumbnail,onClick:m,ref:i}):(0,f.jsx)(Jt.Z,{url:t.source,isAuthenticated:!0,permissionRecord:t.store.pointer,render:(e,t)=>(0,f.jsx)(Yt.Z,{src:t,style:l.imageThumbnail,placeholderStyle:l.imageThumbnail,onClick:m,ref:i})})};var oo=o(40304),io=o(52455),no=o(87292),so=o(61646);const ro=(0,h.IU)("videoAttachment",{viewBox:"0 0 28 28",svg:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("rect",{width:"28",height:"28",fill:"none"}),(0,f.jsx)("path",{d:"M14.1333 26.4668C21.103 26.4668 26.8667 20.7031 26.8667 13.7334C26.8667 6.75098 21.103 1 14.1206 1C7.15088 1 1.3999 6.75098 1.3999 13.7334C1.3999 20.7031 7.16357 26.4668 14.1333 26.4668ZM14.1333 24.8164C7.98877 24.8164 3.05029 19.8652 3.05029 13.7334C3.05029 7.58887 7.98877 2.6377 14.1206 2.6377C20.2651 2.6377 25.2163 7.58887 25.229 13.7334C25.229 19.8652 20.2778 24.8164 14.1333 24.8164ZM18.9702 14.3936C19.4653 14.1016 19.4526 13.4287 18.9702 13.1367L11.7212 8.79492C11.2261 8.49023 10.5786 8.73145 10.5786 9.27734V18.2275C10.5786 18.7734 11.188 19.0273 11.7212 18.71L18.9702 14.3936Z"})]})}),ao={doc:{title:"DOC"},docx:{title:"DOCX"},xls:{title:"XLS"},xlsx:{title:"XLSX"},pdf:{title:"PDF"},video:{icon:ro}},lo={doc:{icon:oo.w},docx:{icon:oo.w},xls:{icon:so.Y},xlsx:{icon:so.Y},pdf:{icon:no.B},video:{icon:ro}};function co(e){const{file:t,type:o}=e,i=(0,c.VK)((()=>H.default.checkGate("comments_density_image_handling")),[]),n=(0,u.yK)((e=>{let t;switch(o){case"doc":case"docx":t=e.msDocDiscussionInputPreview;break;case"xls":case"xlsx":t=e.msExcelDiscussionInputPreview;break;case"pdf":t=e.pdfDiscussionInputPreview;break;default:t=e.sidebarSecondaryBackground}return i&&(t=e.tint.regular),{wrapper:{height:48,width:220,display:"flex",background:"transparent",borderRadius:5,overflow:"hidden",border:`1px solid ${e.regularDividerColor}`,...i?{width:216,borderRadius:12,padding:"8px 10px 8px 8px",gap:10}:{}},fileTypeArea:{background:t,height:48,width:48,display:"flex",justifyContent:"center",alignItems:"center",flexShrink:0,...i?{width:32,height:32,borderRadius:6}:{}},icon:{height:26,width:26,fill:e.regularIconColor,...i?{width:24,height:24}:{}},fileType:{fontSize:11,lineHeight:"16.8px",fontWeight:w.Z.fontWeight.semibold,color:e.regularInvertedTextColor},fileDescription:{padding:"6px 12px 6px 12px",display:"flex",flexDirection:"column",justifyContent:"center",overflow:"hidden",...i?{padding:0}:{}},fileTitle:{color:e.regularTextColor,textOverflow:"ellipsis",fontSize:14,lineHeight:"19.6px",whiteSpace:"nowrap",overflow:"hidden",width:"100%",paddingBottom:20,...i?{fontWeight:w.Z.fontWeight.medium,lineHeight:"18px",color:e.text.primary}:{}},fileSize:{color:e.lightTextColor,fontSize:12,lineHeight:"16.8px",width:"100%",...i?{lineHeight:"15px",color:e.text.secondary}:{}}}}),[o,i]),s=i?lo[o]:ao[o],r=i?(0,le.formatFileSize)(t.size):t.size;return(0,f.jsxs)("div",{style:n.wrapper,children:[(0,f.jsx)("div",{style:n.fileTypeArea,children:s?"title"in s?(0,f.jsx)("div",{style:n.fileType,children:s.title}):s.icon(n.icon):(0,io.X)(n.icon)}),(0,f.jsxs)("div",{style:n.fileDescription,children:[(0,f.jsx)("div",{style:n.fileTitle,children:t.name}),(0,f.jsx)("div",{style:n.fileSize,children:r})]})]})}const uo={image:to,pdf:co,doc:co,xls:co,embed:co},mo={"application/vnd.openxmlformats-officedocument.wordprocessingml.document":"docx","application/msword":"doc","application/vnd.ms-excel":"xls","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx",image:"image"};function po(e){return"local"===e.type?function(e){const[t]=e.split("/");return mo[e]||mo[t]}(e.file.type)||(0,St.Dz)({url:e.file.name,baseUrl:Fe.default.domainBaseUrl,publicDomainName:Fe.default.publicDomainName}):(0,St.y_)(e.source,".doc")?"doc":(0,St.y_)(e.source,".docx")?"docx":(0,St.y_)(e.source,".xls")?"xls":(0,St.y_)(e.source,".xlsx")?"xlsx":(0,St.Dz)({url:e.source,baseUrl:Fe.default.domainBaseUrl,publicDomainName:Fe.default.publicDomainName})}function go(e){let{file:t,onRemoveFile:o,disableRemove:i,isLarge:s}=e;const[a,l]=(0,n.useState)(!1),d=(0,c.VK)((()=>H.default.checkGate("comments_density_image_handling")),[]),u=(0,n.useCallback)((()=>null==o?void 0:o(t)),[t,o]),m=(0,r.O7)(),p=!i&&(a||m.device.isMobile);(0,n.useEffect)((()=>()=>{"local"===t.type&&t.dataURL&&URL.revokeObjectURL(t.dataURL)}),[t]);const g=po(t),h=uo[g]||co;return(0,f.jsxs)(He.Z,{style:{...vo,...d?{width:"fit-content"}:{}},hoveredStyle:ho,pressedStyle:fo,onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),children:[(0,f.jsx)(h,{file:t,type:g,isLarge:d?s:void 0}),p&&(0,f.jsx)(De.Z,{icon:qt.D,style:xo,hasBackground:!0,isDarkIconColor:!0,hovered:!1,showShadow:!0,onClick:u})]})}const ho={background:"none"},fo={background:"none"},vo={display:"flex",alignItems:"center",justifyContent:"center",position:"relative",paddingRight:"10px",cursor:"pointer"},xo={position:"absolute",top:"-5px",right:"6px",height:18,width:18,borderRadius:18,padding:4},bo=.8;function So(e){const t=(0,n.useRef)(null),o=(0,c.VK)((()=>H.default.checkGate("comments_density_image_handling")),[]),i=(0,u.yK)((e=>({leftArrowStyle:{left:10,top:26,background:e.mediumIconColor,...wo},rightArrowStyle:{right:10,top:26,background:e.mediumIconColor,...wo},iconStyle:{height:6,fill:e.contentBackground},hoveredStyle:{background:e.regularIconColor}})),[]),[{scrollLeft:s,scrollWidth:r,clientWidth:a},,l]=(0,c.AF)(void 0,Zt.Z),d=(0,n.useCallback)((e=>{var o;e.stopPropagation(),null===(o=t.current)||void 0===o||o.scrollByOffset(0,-bo*a,{animate:!0})}),[a]),m=(0,n.useCallback)((e=>{var o;e.stopPropagation(),null===(o=t.current)||void 0===o||o.scrollByOffset(0,bo*a,{animate:!0})}),[a]),p=(0,n.useCallback)((()=>{var e;null===(e=t.current)||void 0===e||e.getClientRect()}),[]);(0,n.useEffect)((()=>(Tt.lj(window,"resize",p),()=>{Tt.ZV(window,"resize",p)})),[p]);const g=(0,n.useMemo)((()=>Math.floor(s)>0),[s]),h=(0,n.useMemo)((()=>Math.ceil(s+a)<r),[s,r,a]);if((0,n.useEffect)((()=>{p()}),[e.files,p]),0===e.files.length)return null;const v=e.files.filter((e=>"local"===e.type||Boolean(e.source)));return o&&v.length<=3?(0,f.jsx)("div",{style:{...Co,...o?{flexDirection:"column",gap:8}:{}},children:v.map((t=>(0,f.jsx)(go,{file:t,onRemoveFile:e.onRemoveFile,disableRemove:e.disableRemove,isLarge:o},t.id)))}):(0,f.jsxs)("div",{style:Co,children:[(0,f.jsx)(Bt.Z,{style:{...yo,...o?{paddingTop:0}:{}},ref:t,type:Ft.Z.X,onScroll:p,zIndex:0,store:l,children:v.map((t=>(0,f.jsx)(go,{file:t,onRemoveFile:e.onRemoveFile,disableRemove:e.disableRemove},t.id)))}),g&&(0,f.jsx)(De.Z,{icon:Rt.Y,hovered:!1,showShadow:!0,onClick:d,style:i.leftArrowStyle,iconStyle:i.iconStyle,hoveredStyle:i.hoveredStyle}),h&&(0,f.jsx)(De.Z,{icon:It.n,hovered:!1,showShadow:!0,onClick:m,style:i.rightArrowStyle,iconStyle:i.iconStyle,hoveredStyle:i.hoveredStyle})]})}const yo={overflow:"scroll",display:"flex",alignItems:"flex-start",flexDirection:"row",paddingTop:10},Co={display:"flex",paddingRight:0,position:"relative"},wo={position:"absolute",borderRadius:4,width:16,height:16,opacity:1,flexShrink:0,boxShadow:"none"};function jo(e){if("image"!==e.getType())return!1;const t=yt.QaF(e.getPropertyValue("source"));return void 0!==t&&!(0,St.y_)(t,".jfif")&&!(0,St.y_)(t,".webp")}function ko(e){let{stores:t}=e;return 0===t.length?null:(0,f.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:t.map((e=>(0,f.jsx)($t,{store:e},e.id)))})}function Mo(e){const t=e.discussionFormat===le.DiscussionFormat.Sidebar?Ct.vW.SidebarComment:Ct.vW.PageComment,o=(0,c.VK)((()=>H.default.checkGate("comments_density_image_handling")),[]),{uploading:i,images:n,embeds:s,files:r}=(0,c.VK)((()=>{if(!o)return{uploading:[],images:[],embeds:[],files:[]};const[t,i]=we.uK(e.contentStores,(e=>{const t=Boolean(Dt.default.getKeyState(Dt.default.getBlockKey(e.id))),o=kt.ZP.getEmbedSourceFromBlockStore(e);return t||!o})),[n,s]=we.uK(i,(e=>jo(e))),[r,a]=we.uK(s,(e=>"video"===e.getType()));return{uploading:t,images:n,embeds:r,files:a}}),[e.contentStores,o]),{filmStripFiles:a,embedBlockStores:l}=(0,c.VK)((()=>{if(o)return{filmStripFiles:[],embedBlockStores:[]};if(e.collapsed)return{filmStripFiles:wt.nQ(e.contentStores),embedBlockStores:[]};if(e.discussionFormat===le.DiscussionFormat.Page&&e.contentStores.filter((e=>jo(e))).length>1){const[t,o]=we.uK(e.contentStores,(e=>jo(e)));return{filmStripFiles:wt.nQ(t),embedBlockStores:o}}return{filmStripFiles:[],embedBlockStores:e.contentStores}}),[e.contentStores,e.collapsed,e.discussionFormat,o]);if(o)return 0===i.length&&0===n.length&&0===s.length&&0===r.length?null:(0,f.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:4,marginTop:8},children:[(0,f.jsx)(ko,{stores:i}),(0,f.jsx)(Ut,{stores:n,embedBlockLocation:t,onRemoveContent:e.onRemoveContent}),s.length>0&&(0,f.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:s.map((o=>(0,f.jsx)(kt.ZP,{store:o,blockLocation:t,disabled:!1,disableDrag:!0,disableResizers:!0,preserveScale:!0,inlineContentStyle:{},onRemoveBlockFromComment:e.onRemoveContent},o.id)))}),(0,f.jsx)(zt,{stores:r,collapsed:e.collapsed,shouldShowGrayFogInScroller:e.discussionHovered&&(e.discussionFormat===le.DiscussionFormat.Margin||e.discussionFormat===le.DiscussionFormat.Sidebar)})]});const d=l.length>0&&l.map((i=>(0,f.jsx)(Lt.Z,{store:i,analyticsName:"comment_media",actionSectionGroupKey:"comment_media",canTriggerContextMenu:!0,style:{marginTop:8,...o?{marginTop:0}:{}},children:kt.ZP.hasRendererForStore(i)?(0,f.jsx)(kt.ZP,{disabled:!1,disableDrag:!0,store:i,disableResizers:!0,preserveScale:!0,inlineContentStyle:{height:"auto",width:"auto",maxHeight:240,maxWidth:"100%",cursor:"zoom-in"},blockLocation:t,iconSvg:()=>(0,f.jsx)(jt.Z,{style:o?{}:{marginRight:10}}),onRemoveBlockFromComment:e.onRemoveContent,children:(0,f.jsx)(y.FormattedMessage,{defaultMessage:"Uploading file...",id:"comment.embeddedFile.uploadInProgressMessage"})}):(0,f.jsx)(Mt.Z,{disabled:!1,store:i})},i.id))),u=a.length>0&&(0,f.jsx)(So,{files:a,disableRemove:!0});return(0,f.jsxs)(f.Fragment,{children:[u,d]})}function Lo(){const e=(0,c.VK)((()=>H.default.checkGate("comments_density_image_handling")),[]),t=(0,u.yK)((t=>({newBarLine:{height:"0px",borderBottom:`1px solid ${t.darkDividerColor}`,width:"100%",marginLeft:0},newBarWrapper:{color:t.mediumTextColor,textTransform:"uppercase",fontSize:10.5,letterSpacing:.5,fontWeight:w.Z.fontWeight.semibold,display:"flex",alignItems:"center",marginRight:16,marginLeft:16,marginTop:10,marginBottom:10,...e?{margin:"0px 0px 0px 0px",paddingTop:10,paddingBottom:10,paddingLeft:re}:{}},newBarText:{padding:"0 10px",whiteSpace:"nowrap"},threadLine:{position:"absolute",backgroundColor:t.stroke.deemphasized,width:oe,height:"100%",borderRadius:2,left:ie,top:-6}})),[e]);return e?(0,f.jsxs)("div",{style:{position:"relative"},children:[(0,f.jsx)("div",{style:t.threadLine}),(0,f.jsxs)("div",{style:t.newBarWrapper,children:[(0,f.jsx)("div",{style:t.newBarLine}),(0,f.jsx)("div",{style:t.newBarText,children:(0,f.jsx)(y.FormattedMessage,{id:"comment.newIndicator.label",defaultMessage:"New comments"})}),(0,f.jsx)("div",{style:t.newBarLine})]})]}):(0,f.jsxs)("div",{style:t.newBarWrapper,children:[(0,f.jsx)("div",{style:t.newBarLine}),(0,f.jsx)("div",{style:t.newBarText,children:(0,f.jsx)(y.FormattedMessage,{id:"comment.newIndicator.label",defaultMessage:"New comments"})}),(0,f.jsx)("div",{style:t.newBarLine})]})}var Do=o(15157),Ro=o(85344),Io=o(67060),Bo=o(37601),To=o(3386),Fo=o(28020),Zo=o(33929),_o=o(68056),Ao=o(24666);var Vo=o(91315),Po=o(22962),zo=o(83065),Ko=o(61519),Eo=o(99768);const Wo=function(e){const t=(0,r.O7)(),{icon:o,onClick:i,tooltip:n}=e,s=(0,c.VK)((()=>H.default.checkGate("comments_density_image_handling")),[]);return(0,f.jsx)(Eo.Z,{capture:!0,render:e=>(0,f.jsx)(B.ZP,{renderTooltip:()=>n,render:r=>(0,f.jsx)(De.Z,{ariaLabel:n,icon:o,iconStyle:{width:t.device.isMobile?20:16,height:t.device.isMobile?20:16},style:{marginLeft:t.device.isMobile?16:10,...s?{marginLeft:t.device.isMobile?16:0}:{}},onClick:i,...r,...e})})})};const Uo=function(e){const t=(0,y.useIntl)(),o=(0,r.O7)(),{device:i}=o,n=(0,c.VK)((()=>H.default.checkGate("comments_density_image_handling")),[]),s=(0,u.yK)((e=>({cancelIcon:{background:e.mediumIconColor,borderRadius:"50%",marginLeft:o.device.isMobile?16:12,pointerEvents:"auto",height:20,width:20,...n?{marginLeft:o.device.isMobile?4:0}:{}},cancelIconHovered:{background:e.lightIconColor}})),[o.device.isMobile,n]),{canSend:a,visible:l,onSend:d,onCancel:m,isEditing:g,animated:h,onMention:v,onAttach:x,inline:b}=e,S={opacity:l?1:0},C=()=>(0,f.jsx)(Eo.Z,{capture:!0,render:e=>(0,f.jsx)(De.Z,{ariaLabel:t.formatMessage({id:"discussionInput.sendButton.ariaLabel",defaultMessage:"Send comment"}),icon:zo._,onClick:d,isBlue:a,disabled:!a,iconStyle:{height:o.device.isMobile?26:24,width:o.device.isMobile?26:24},style:{marginLeft:o.device.isMobile?16:12,pointerEvents:"auto",height:20,width:20,...n?{marginLeft:o.device.isMobile?16:0,height:24,width:24}:{}},...e})}),w=()=>(0,f.jsx)(Eo.Z,{capture:!0,render:e=>(0,f.jsx)(De.Z,{ariaLabel:t.formatMessage({id:"discussionInput.updateButton.ariaLabel",defaultMessage:"Update comment"}),icon:Vo.r,onClick:d,isBlue:a,disabled:!a,iconStyle:{height:o.device.isMobile?23:21,width:o.device.isMobile?23:21},style:{marginLeft:o.device.isMobile?16:12,pointerEvents:"auto",height:20,width:20,...n?{marginLeft:o.device.isMobile?16:2,height:24,width:24}:{}},...e})}),j=()=>(0,f.jsx)(Eo.Z,{capture:!0,render:e=>(0,f.jsx)(De.Z,{ariaLabel:t.formatMessage({id:"discussionInput.cancelButton.ariaLabel",defaultMessage:"Cancel editing comment"}),icon:qt.D,isDarkIconColor:!0,onClick:m,iconStyle:{fill:"white",height:o.device.isMobile?18:16,width:o.device.isMobile?18:16},style:s.cancelIcon,hoveredStyle:s.cancelIconHovered,...e})});return n?(0,f.jsx)(Ne.Z,{isVisible:!0,animationStyle:S,render:()=>(0,f.jsx)("div",{style:{display:"flex",flexDirection:"column-reverse",alignItems:"end",pointerEvents:l?void 0:"none",width:"min-content",...h&&S},children:(0,f.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:6},children:[(0,f.jsx)(Wo,{icon:p.s,onClick:x,tooltip:t.formatMessage({id:"discussionInput.uploadFile.button.tooltip",defaultMessage:"Attach file"})}),!i.isMobileBrowser&&(0,f.jsx)(Wo,{icon:Po.O,onClick:v,tooltip:t.formatMessage({id:"discussionInput.insertMention.button.tooltip",defaultMessage:"Mention a person, page, or date"})}),g&&(0,f.jsx)("div",{style:{height:14,marginRight:6},children:(0,f.jsx)(Ko.Z,{vertical:!0,size:1})}),g?j():null,g?w():C()]})})}):(0,f.jsx)(Ne.Z,{isVisible:!0,animationStyle:S,render:()=>(0,f.jsx)("div",{style:{display:"flex",...b?{flexDirection:"column-reverse",alignItems:"end",marginRight:8}:{flexDirection:"row",position:"absolute",bottom:7,right:12,alignItems:"center"},pointerEvents:l?void 0:"none",...h&&S},children:(0,f.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,f.jsx)(Wo,{icon:p.s,onClick:x,tooltip:t.formatMessage({id:"discussionInput.uploadFile.button.tooltip",defaultMessage:"Attach file"})}),!i.isMobileBrowser&&(0,f.jsx)(Wo,{icon:Po.O,onClick:v,tooltip:t.formatMessage({id:"discussionInput.insertMention.button.tooltip",defaultMessage:"Mention a person, page, or date"})}),g&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{style:{height:14,marginLeft:o.device.isMobile?10:8},children:(0,f.jsx)(Ko.Z,{vertical:!0,size:1})}),j()]}),g?w():C()]})})})},No=(0,y.defineMessages)({defaultPlaceholder:{defaultMessage:"Add a comment…",id:"discussionInput.defaultPlaceholder.addComment"},pasteFileIntoCommentNotAllowed:{id:"clipboardActions.pasteFileIntoCommentError.message",defaultMessage:"Sorry, you cannot paste files into a comment."},replyInputPlaceholder:{defaultMessage:"Reply...",id:"updateSidebar.placeholder.addComment"}});var Ho=o(13966);function Oo(e){let{title:t,source:o,size:i,file:s,store:r,onClick:a,showBlockActionMenuButton:l}=e;(0,n.useEffect)((()=>()=>{"local"===(null==s?void 0:s.type)&&null!=s&&s.dataURL&&URL.revokeObjectURL(s.dataURL)}),[s]);const d=(0,u.yK)((e=>({wrapper:{height:48,width:214,background:"white",border:`1px solid ${e.regularDividerColor}`,borderRadius:12,padding:"7px 10px 8px 8px",cursor:a?"pointer":"default"},wrapperHoveredStyle:{background:e.surface.wash},iconContainer:{height:32,width:32,minWidth:32,background:e.tint.regular,borderRadius:6,display:"flex",justifyContent:"center",alignItems:"center"},icon:{height:24,width:24,fill:e.regularIconColor},fileName:{fontSize:14,fontWeight:w.Z.fontWeight.medium,lineHeight:"18px",color:e.text.primary,textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},fileSizeText:{fontSize:12,lineHeight:"15px",color:e.text.secondary},actionMenuHoveredStyle:{background:e.tint.regular}})),[a]),c=(0,le.getIcon)(o);return(0,f.jsx)(He.Z,{style:d.wrapper,hoveredStyle:r?d.wrapperHoveredStyle:{background:"white"},pressedStyle:r?d.wrapperHoveredStyle:{background:"white"},onClick:a,children:(0,f.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,f.jsx)("div",{style:d.iconContainer,children:c(d.icon)}),(0,f.jsx)("div",{style:{overflow:"hidden",flexGrow:1},children:(0,f.jsx)(B.ZP,{renderTooltip:()=>(0,f.jsx)("div",{children:t}),render:e=>(0,f.jsxs)("div",{style:{display:"flex",flexDirection:"column"},...e,children:[(0,f.jsx)("div",{style:d.fileName,children:t}),i&&(0,f.jsx)("span",{style:d.fileSizeText,children:(0,le.formatFileSize)(i)})]})})}),r&&l&&(0,f.jsx)(Ho.Z,{store:r,fadeIn:!1,actionSectionGroupKey:"comment_media",hideFilterActionsInput:!0,style:{borderRadius:50},hoveredStyle:d.actionMenuHoveredStyle,iconStyle:{width:12,height:12}})]})})}function Go(e){let{children:t,handleRemoveFileClicked:o}=e;const[i,s]=(0,n.useState)(!1),a=(0,r.O7)(),l=(0,y.useIntl)(),d=i||a.device.isMobile;return(0,f.jsxs)(He.Z,{onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),style:qo,hoveredStyle:Xo,pressedStyle:Xo,children:[t,d&&(0,f.jsx)(De.Z,{icon:qt.D,style:$o,hasBackground:!0,isDarkIconColor:!0,hovered:!1,showShadow:!0,onClick:o,ariaLabel:l.formatMessage({id:"discussionInputAttachment.removeFileButton.label",defaultMessage:"Remove file"})})]})}const $o={position:"absolute",top:-4,right:-3,height:18,width:18,borderRadius:18},qo={position:"relative",cursor:"pointer",width:"min-content",height:"min-content",background:"transparent"},Xo={background:"transparent"},Yo=3,Jo=3;function Qo(e){let{files:t,onRemoveFile:o}=e;const{images:i,nonImages:n}=(0,c.VK)((()=>{const[e,o]=we.uK(t,(e=>function(e){if("local"===e.type){const t=e.file.type,[o]=t.split("/");if("image"===o)return!0}const t=(0,St.Dz)({url:"local"===e.type?e.file.name:e.source,baseUrl:Fe.default.domainBaseUrl,publicDomainName:Fe.default.publicDomainName});return"image"===t}(e)));return{images:e,nonImages:o}}),[t]);return(0,f.jsxs)("div",{style:{width:"100%",display:"flex",flexDirection:"column",gap:4,marginTop:4},children:[(0,f.jsx)(ei,{files:i,onRemoveFile:o}),(0,f.jsx)(ti,{files:n,onRemoveFile:o})]})}function ei(e){let{files:t,onRemoveFile:o}=e;return 0===t.length?null:t.length<=Yo?(0,f.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:t.map((e=>(0,f.jsx)(Go,{handleRemoveFileClicked:()=>o(e),children:(0,f.jsx)(to,{file:e,isLarge:!0})},e.id)))}):(0,f.jsx)(Vt,{children:t.map((e=>(0,f.jsx)(Go,{handleRemoveFileClicked:()=>o(e),children:(0,f.jsx)(to,{file:e,isLarge:!1})},e.id)))})}function ti(e){let{files:t,onRemoveFile:o}=e;if(0===t.length)return null;const i=t.map((e=>{const t=e.name??"",i="remote"===e.type?e.source:t,n=e.size??"";return(0,f.jsx)(Go,{handleRemoveFileClicked:()=>o(e),children:(0,f.jsx)(Oo,{title:t,source:i,size:n,showBlockActionMenuButton:!1})},e.id)}));return t.length<=Jo?(0,f.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:i}):(0,f.jsx)(Vt,{children:i})}const oi=n.forwardRef((function(e,t){var o;const i=(0,r.O7)(),{device:l,currentUser:d}=i,[m,p,g]=(0,c.AF)(e.discussionInputStore),{textStore:h,files:v}=m,x=(0,c.VK)((()=>h.getValue()),[h]),[b,S]=(0,n.useState)(!1),[C,w]=(0,n.useState)(!1),j=(0,n.useRef)(null),{commentStore:M}=e,I=e.discussionFormat!==le.DiscussionFormat.Page;(0,n.useImperativeHandle)(t,(()=>({uploadFiles:W})));const B=(0,c.VK)((()=>(0,Fo.B7)(i)),[i]),T=(0,c.VK)((()=>H.default.checkGate("comments_density_image_handling")),[]),F=(0,n.useRef)(null===(o=e.blockStore)||void 0===o?void 0:o.clone()),Z=(0,c.VK)((()=>{const e=Ao.default.state;return"editing"===e.mode&&(0,_o.qS)(e.multiSelection)&&e.multiSelection.start.store===h}),[h]),_=(0,c.VK)((()=>({isEmpty:(0,le.inputIsEmpty)(g),hasChanged:(0,le.hasCommentChanged)(g,M),hasNewLineCharacter:g.hasNewLineCharacter()})),[g,M]),A=(0,c.VK)((()=>Z||!_.isEmpty),[_.isEmpty,Z]),P=(0,n.useCallback)((async()=>{const e=Ao.default.state;"editing"===e.mode&&(0,_o.qS)(e.multiSelection)&&e.multiSelection.start.store===h||(D.NX({store:h}),await s.default.afterNextFlush())}),[h]),z=e=>{const t=g.state;g.setState({...t,files:t.files.filter((t=>t.id!==e.id))})},E=async e=>{await W(e.files),Ro.Zq(i,{type:"paste"})},W=(0,n.useCallback)((async t=>{var o;if(await P(),v.length+t.length>10)return void k.showErrorMessage((0,f.jsx)(y.FormattedMessage,{id:"discussionInput.uploadFile.tooManyFilesErrorMessage",defaultMessage:"You cannot upload more than {maxFiles} files per comment.",values:{maxFiles:10}}));const i=t.map(wt.Xo);p({...m,files:[...v,...i]}),null===(o=e.onFileUploaded)||void 0===o||o.call(e)}),[P,v,p,m,e]),U=e.discussionFormat===le.DiscussionFormat.Margin,N=e.discussionFormat===le.DiscussionFormat.Sidebar,O=e.discussionFormat===le.DiscussionFormat.Page;(0,n.useEffect)((()=>{e.commentStore&&function(e,t){const o=K.le(t),i=wt.nQ(o);e.setState({...e.state,files:i})}(g,e.commentStore)}),[g,e.commentStore]);const G=(0,n.useRef)(!1),$=(0,n.useCallback)((t=>{t?Do.Z.set({userId:d.id,key:ai(e.parentStore.id,e.inReplyToDiscussionId),value:t??null}):Do.Z.remove({userId:d.id,key:ai(e.parentStore.id,e.inReplyToDiscussionId)})}),[d.id,e.inReplyToDiscussionId,e.parentStore.id]);(0,n.useEffect)((()=>{e.shouldSaveUnsentComments&&G.current&&$(x),G.current=!0}),[e.shouldSaveUnsentComments,$,x]);const q=(0,n.useRef)(h);(0,n.useEffect)((()=>{if(e.shouldSaveUnsentComments){const t=Do.Z.get({userId:d.id,key:ai(e.parentStore.id,e.inReplyToDiscussionId)});t&&R.createAndCommit({userAction:"DiscussionInput.willMount",environment:i,perform:e=>{L.sO({environment:i,editorMode:"default",store:q.current,value:t,transaction:e})}})}}),[i,d.id,e.inReplyToDiscussionId,e.parentStore.id,e.shouldSaveUnsentComments]);const X=(0,n.useRef)(v);(0,n.useEffect)((()=>{X.current=v}),[v]),(0,n.useEffect)((()=>()=>{X.current&&X.current.forEach((e=>{"local"===e.type&&e.dataURL&&URL.revokeObjectURL(e.dataURL)}))}),[]);const Y=!e.isEditingExistingComment&&(e.discussionFormat===le.DiscussionFormat.Page||e.discussionFormat===le.DiscussionFormat.Menu),J=!!T||!Y,Q=()=>{var e;return null===(e=j.current)||void 0===e?void 0:e.focus()},te=v&&v.length>0,oe=!(e.discussionFormat===le.DiscussionFormat.Menu&&e.inReplyToDiscussionId)&&(N||U&&!e.isNewComment),ie=void 0!==e.showCtaButtons?e.showCtaButtons:e.isEditingExistingComment||A||b,ne=T?{}:{paddingBottom:J&&ie?34:4},se=!e.isMobileSlideUpMenu,re=(U||N)&&!e.isNewComment,ae=(0,u.yK)((t=>({inputWrapper:{display:"flex",flexDirection:"column",alignItems:"bottom",minHeight:U?void 0:32,width:"100%",fontSize:14,paddingTop:U?1:4,paddingBottom:U?1:4,borderRadius:4,boxShadow:!e.isNewComment&&U?`0px 0px 0px 1px ${t.darkDividerColor}`:void 0,transition:"background 300ms ease",background:C&&!ie&&t.focusDiscussionInputBackground||ie&&!e.isEditingExistingComment&&(e.isNewComment&&U?t.selectedMarginDiscussionBackground:t.discussionInputActivatedBackground)||"inherit",cursor:ie?"text":"pointer",alignSelf:"center",position:"relative",...T?{boxShadow:void 0,flexDirection:"row",flexWrap:"wrap",justifyContent:"flex-end",background:"transparent",minHeight:void 0,alignItems:"center",rowGap:4,columnGap:6,padding:"3.5px 4px 3px 4px",margin:"-3.5px -4px 0 -4px"}:{}}})),[C,U,e.isEditingExistingComment,e.isNewComment,ie,T]),de=T?ee:N?23:20,ce={fontSize:14,marginTop:N?2:3,marginBottom:2,paddingLeft:O?4:6,paddingRight:10,maxHeight:l.isMobileNative?"50vh":"70vh",overflowY:"auto",overflowX:"hidden",WebkitOverflowScrolling:"touch",userSelect:"auto",WebkitUserSelect:"auto",...T?{lineHeight:"20px",padding:0,margin:0,overflow:"auto"}:{}},ue=(0,c.VK)((()=>0===(h.getValue()||[]).length),[h]),me=function(e){const{isEditing:t,onEditPreviousComment:o,textRef:i}=e;if(!t)return{};const n=e=>{"key"in e&&(e.metaKey||e.ctrlKey)&&i.current&&D.N_({store:i.current.props.store})},s=e=>{"key"in e&&(e.metaKey||e.ctrlKey)&&i.current&&D.NX({store:i.current.props.store})};return{onUp:o??n,onDown:s}}({isEditing:Z,shouldTrapCursorInInput:I,onEditPreviousComment:ue?e.onEditPreviousComment:void 0,textRef:j}),pe=()=>{$(void 0),e.onSubmit()},ge=()=>{if(!l.isMobile)return void pe();const e="editing"===Ao.default.state.mode&&Ao.default.state.multiSelection;e&&R.createAndCommit({userAction:"DiscussionInput.handleEnter",environment:i,perform:t=>{L.hJ({environment:i,editorMode:"default",string:"\n",multiSelection:e,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:t})}})},he=(0,f.jsx)(Uo,{visible:ie,onAttach:async()=>{const{device:e}=i;e.isIOS&&e.isMobileNative&&!e.isTablet&&(D.ZH(i),await s.default.afterNextFlush());const t=await wt.y({multiple:!0});await W(t),Ro.Zq(i,{type:"file_picker"})},onMention:async()=>{await P(),Io.lZ(i,{page:!0,heading:!0,createPage:!1,user:!0,inviteUserToWorkspace:!0,inviteUserToPage:!0,bot:!0,date:!0,reminder:!1,templateVariable:!1,group:!0})},canSend:!_.isEmpty,onSend:pe,onCancel:e.onCancel,isEditing:e.isEditingExistingComment||!1,animated:U,inline:!!T||!J});return(0,f.jsx)(To.Z,{debugName:"DiscussionInput",capture:Z,onCommandEnter:we.yR,children:(0,f.jsx)(ri,{enabled:!!F.current&&!!e.canDrop,store:F.current,onNativeDrop:async e=>{let{files:t}=e;await W(t),Ro.Zq(i,{type:"drop"})},children:(0,f.jsx)("div",{className:e.isEditingExistingComment?Ze.hzx:Ze.wFE,style:{...ii,...e.containerStyle||{}},onFocus:e=>{const t=e.target;t instanceof HTMLElement&&(0,a.E)(t)&&S(!0)},onBlur:()=>S(!1),onMouseOver:()=>w(!0),onMouseOut:()=>w(!1),children:(0,f.jsxs)("div",{style:ni,children:[e.showAvatar&&(0,f.jsx)(et.Z,{userStore:B,size:de,avatarShouldShowShadow:!T,style:{...si,...T?{marginTop:0,marginRight:8}:{}}}),(0,f.jsx)(Ne.Z,{isVisible:!0,animationStyle:ne,render:()=>(0,f.jsxs)("div",{className:oe?Ze.Wh_:"",onClick:Q,style:{...ae.inputWrapper,...U&&ne},tabIndex:-1,children:[(0,f.jsxs)("div",{style:{flexGrow:1,display:"flex",...T?{minHeight:24,paddingTop:2,width:_.hasNewLineCharacter?"100%":""}:{}},children:[(0,f.jsx)(V.Z,{style:ce,store:h,parentStore:e.parentStore,disabled:!1,onEnter:ge,onCommandEnter:pe,onPasteFiles:E,onEsc:e.onCancel,...me,placeholder:Zo.default.formatMessage(re?No.replyInputPlaceholder:No.defaultPlaceholder),ref:j,isDiscussionInput:!0,disableSlashCommands:!0,disableInsertText:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableEmbedMenu:!0,disabledMentionTypes:{reminder:!0},disableMobileActionBar:!0,disableStyleAnnotations:l.isMobileBrowser,disableInsertedDeletedAnnotations:l.isMobileBrowser,pasteBehavior:"inline",inPageFind:{type:"none"}}),!J&&he]}),te&&T&&(0,f.jsx)(Qo,{files:v,onRemoveFile:z}),te&&!T&&(0,f.jsx)("div",{style:{paddingBottom:J?8:0,paddingLeft:8,paddingRight:8},children:(0,f.jsx)(So,{files:v,onRemoveFile:z})}),J&&he]})}),se&&(0,f.jsx)(Bo.Z,{show:Z,onDismiss:()=>D.ZH(i)})]})})})})})),ii={display:"flex",flexDirection:"column",width:"100%",cursor:"pointer"},ni={display:"flex",alignItems:"center",flexGrow:1},si={flexShrink:0,flexGrow:0,marginRight:6,alignSelf:"flex-start",marginTop:6};function ri(e){const{enabled:t,children:o,store:i,onNativeDrop:n}=e;return t&&i?(0,f.jsx)(Lt.Z,{store:i,analyticsName:"discussion_input",canNativeDropOnto:!0,onNativeDrop:n,keepTextSelectionOnDrop:!0,shouldShowDropZone:!0,children:o}):(0,f.jsx)(f.Fragment,{children:o})}function ai(e,t){return t?`UnsentDiscussion-${e}-${t}`:`UnsentDiscussion-${e}`}const li=oi,di=new x.ZP("Temporary",!1,"necessary");function ci(e){switch(e){case"margin_comments":return 0;case"updates_sidebar":return 35;case"comment_unfurl":return 29;default:return 32}}const ui=function(e){const{store:t,discussionContext:o,maxLines:i,discussionLocation:h,shouldShowThreadLine:x}=e,te=(0,r.O7)(),ce=(0,y.useIntl)(),[ue,me]=(0,n.useState)(!1),[pe,ge]=(0,n.useState)(!1),[he,fe]=(0,n.useState)(!1),ve=(0,c.VK)((()=>H.default.checkGate("comments_density_image_handling")),[]),xe=ci(h),be=(0,c.VK)((()=>e.store.isDefined()?new de.Z(te,e.store.getSpaceId()):void 0),[te,e.store]),Se=(0,c.VK)((()=>K.le(e.store).filter((e=>(0,$.Vh)(e,{table:S.iU,id:e.id},"alive").getValue()))),[e.store]),ye=(0,c.VK)((()=>e.discussionStore.getResolved()),[e.discussionStore]),Ce=(0,c.VK)((()=>null==be?void 0:be.state.files),[be]),we=(0,c.VK)((()=>null==be?void 0:be.state.textStore),[be]),je=(0,n.useCallback)((e=>{const t=e.target;t instanceof HTMLElement&&(0,a.E)(t)&&ge(!0)}),[]),ke=(0,n.useCallback)((()=>{ge(!1)}),[]),Me=(0,n.useCallback)((()=>{O.Z.state||fe(!0)}),[]),Le=(0,n.useCallback)((()=>{fe(!1)}),[]),De=(0,l.l)(),Re=(0,c.qz)(void 0,N.Z),Ie=(0,c.VK)((()=>Re.state.open),[Re]),Be=(0,c.VK)((()=>{const t=e.discussionStore.getComments();return Boolean(t&&t[0]===e.store.id)}),[e.discussionStore,e.store.id]),Te=(0,c.VK)((()=>{var t;const o=e.blockStore.getRole(),i=Be&&"comment_unfurl"!==h,n=H.default.checkGate("prevent_edits_trash"),s=e.blockStore.pathIsDead(),r=o&&b.rz(o)||n&&s,{device:a}=te,l="comment_only"===o||De&&"comment"===(null===(t=De.publicEditModeStore.state)||void 0===t?void 0:t.permission),d=i&&!a.isMobile&&!l&&!r;return he||pe||e.hoveringDiscussion&&i||Ie||a.isMobile||e.showResolveButtonByDefaultIfPossible&&d}),[e.blockStore,e.hoveringDiscussion,e.showResolveButtonByDefaultIfPossible,Be,h,te,De,he,pe,Ie]),Fe=(0,n.useContext)(P.Ue),Ze=(0,c.VK)((()=>{const e=t.getCreatedByPointer();return e?{createdByPointer:e,lastEditedTime:t.getLastEditedTime(),createdTime:t.getCreatedTime(),text:t.getText(),reactions:$.bh.getUserVisibleReactions(t)}:null}),[t]),_e=(0,c.VK)((()=>{if(!Ze)return null;const o=$.t1.createChildStore(t,Ze.createdByPointer);if(o.isDefined()){const t=o.getValue();t&&t.id!==Ze.createdByPointer.id&&m.log({from:"client/components/Comment.tsx",level:"warning",type:"FetchedPointerMismatch",error:(0,C.Ui)(new Error("Value returned does not match createdByPointer")),data:{miscDataToConvertToString:{blockStorePointer:e.blockStore.pointer,requestedPointer:Ze.createdByPointer,fetchedId:t.id}}})}return{displayName:o.getDisplayName(ce),store:o}}),[Ze,ce,e.blockStore.pointer,t]),Ae=(0,c.VK)((()=>{if(!Ze||!_e)return;const e=t.id,o=Ze.createdByPointer.id,i=_e.store.id,n=_e.store.getName();return n?{commentCreatedById:o,authorId:i,authorName:n,commentWasLoadedFromDisk:U.l.commentIds.has(e),authorWasLoadedFromDisk:U.l.userIds.has(i)}:void 0}),[t.id,_e,Ze]);(0,n.useEffect)((()=>{if(!Ae)return;const{commentCreatedById:e,authorId:o,authorName:i,commentWasLoadedFromDisk:n,authorWasLoadedFromDisk:s}=Ae,r=di.get("commentAuthorMapping"),a=null==r?void 0:r[t.id];if(a){const l=[...e!==a.commentCreatedById?["created-by-id"]:[],...o!==a.authorId?["author-id"]:[],...i!==a.authorName?["author-name"]:[]];l.length>0&&(m.log({from:"client/components/Comment.tsx",level:"warning",type:"CommentToAuthorLocalStorageMismatch",error:(0,C.Ui)(new Error("The user saw a comment whose author didn't match a previous session or render pass.")),data:{mismatches:l,wasm_sqlite_initialized:G.Z.state.metricData.state.wasm_sqlite_initialized,commentCreatedByIdBefore:a.commentCreatedById,commentCreatedByIdAfter:e,authorIdBefore:a.authorId,authorIdAfter:o,authorNameBefore:a.authorName,authorNameAfter:i,commentWasLoadedFromDiskBefore:a.commentWasLoadedFromDisk,commentWasLoadedFromDiskAfter:n,authorWasLoadedFromDiskBefore:a.authorWasLoadedFromDisk,authorWasLoadedFromDiskAfter:s}}),di.set("commentAuthorMapping",{...r,[t.id]:Ae}))}else di.set("commentAuthorMapping",{...r,[t.id]:Ae})}),[t.id,Ae]);const Ve=(0,c.VK)((()=>(0,z.En)()),[]),Pe=(0,n.useCallback)((()=>{R.createAndCommit({userAction:"Comment.deleteComment",environment:te,perform:t=>{q.YF({environment:te,commentStore:e.store,transaction:t,discussionLocation:h})},skipUpdatingEditedMetadata:!0})}),[te,e.store,h]),ze=(0,n.useCallback)((async()=>{await k.confirmUserAction({message:(0,f.jsx)(y.FormattedMessage,{defaultMessage:"Would you like to delete this comment?",id:"comment.confirmDialog.deleteComment.prompt"}),acceptLabel:(0,f.jsx)(y.FormattedMessage,{defaultMessage:"Delete",id:"comment.confirmDialog.deleteComment.deleteButton.label"})})&&(Pe(),j.Xv(),X.Cd(te))}),[Pe,te]),Ke=(0,n.useCallback)((async t=>{const o=K.zP(e.store).getValue(),i=K.le(e.store).filter((e=>e.id!==t.id)),n=o&&o.length>0,s=0===i.length;!n&&s?(await ze(),me(!1)):R.createAndCommit({userAction:"Comment.handleRemoveFileFromActions",environment:te,perform:o=>{q.Zo({commentStore:e.store,fileBlocks:[t],transaction:o})}})}),[te,ze,e.store]),Ee=(0,n.useCallback)((()=>{Oe.current&&M.bx({element:Oe.current,scrollers:{verticalScroller:null==Fe?void 0:Fe.verticalScroller},vertical:{reveal:"closest"},horizontal:void 0,animate:!0})}),[Fe]),We=(0,n.useCallback)((async()=>{if(!be)return;const t=K.zP(e.store).getValue()||[],o=be.state.textStore;R.createAndCommit({userAction:"Comment.handleEditComment",environment:te,perform:e=>{L.sO({environment:te,editorMode:"default",store:o,value:t,transaction:e})}}),me(!0),await s.default.afterNextFlush(),await s.default.afterNextFlush(),D.NX({store:o})}),[be,te,e.store]),Ue=(0,n.useCallback)((async()=>{if(!be)return!1;if(!(0,le.hasCommentChanged)(be,e.store))return me(!1),!0;if(await k.confirmUserAction({message:(0,f.jsx)(y.FormattedMessage,{defaultMessage:"Do you want to discard this edit?",id:"comment.confirmDialog.discardEdit.prompt"}),acceptLabel:(0,f.jsx)(y.FormattedMessage,{defaultMessage:"Discard",id:"comment.confirmDialog.discardEdit.discardButton.label"})}))return me(!1),!0;return!1}),[be,e.store]),Ne=(0,n.useCallback)((async()=>{const t=null==we?void 0:we.getValue();t&&t.length>0||Ce&&Ce.length>0?R.createAndCommit({userAction:"Comment.handleSubmitEdit",environment:te,perform:o=>{q.DF({environment:te,store:e.store,text:t||[],transaction:o,discussionLocation:h,files:Ce||[]})}}):await ze(),me(!1)}),[Ce,we,h,te,ze,e.store]),He=(0,n.useRef)(null),Oe=(0,n.useRef)(null);(0,d.c)(W.Z,(()=>({edit:We,handleCancelEdit:Ue,getNode:()=>He.current,isEditing:()=>ue,discussionLocation:h,commentId:e.store.id})),[We,Ue,ue,h,e.store.id]);const Ge=ve?ee:le.DiscussionLocationToAvatarSize[h],$e=null==Ze?void 0:Ze.text,qe=void 0!==$e&&$e.length>0,Xe=qe&&(0,le.isCommentAllEmojis)($e),Ye=function(e){let{discussionLocation:t,isAllEmojis:o,avatarSize:i,newCommentsDesignEnabled:n}=e;const s=ci(t);return(0,u.yK)((e=>({container:{flexGrow:"comment_unfurl"===t?1:void 0,...n?{paddingTop:"comment_unfurl"===t?J:Y,paddingRight:"margin_comments"===t?12:16,paddingBottom:Q,paddingLeft:ae(t)}:{}},comment:{position:"relative",fontSize:14,...n?{}:{display:"flex",alignItems:"flex-start"}},commentElementsBelowUserRow:n?{paddingLeft:re}:{},avatar:{marginRight:10,marginTop:"comment_unfurl"===t?16:2,...n?{marginTop:0,marginRight:8}:{},userSelect:"none",WebkitUserSelect:"none"},threadLine:n?{position:"absolute",backgroundColor:e.stroke.deemphasized,borderRadius:2,width:oe,height:se,left:ie,top:ne}:{},userRow:{display:"flex",flexDirection:"row",alignItems:"center",userSelect:"none",WebkitUserSelect:"none",...n?{}:{padding:"margin_comments"===t?"4px 16px 0px 12px":"comment_unfurl"===t?"6px 16px 0px 10px":"6px 16px 0px 18px",position:"relative",marginTop:"comment_unfurl"===t?-11:void 0}},placeholder:{height:8,width:81,borderRadius:4,background:e.lightDividerColor},unfurlMoreWrapper:{color:e.lightTextColor,fontWeight:"comment_unfurl"===t?w.Z.fontWeight.medium:void 0,...n?{display:"block",marginBottom:-1.5}:{}},attachIcon:{width:18,height:18,fill:e.mediumIconColor},text:{cursor:"comment_unfurl"!==t?"text":void 0,...o?{fontSize:32}:{},...n?{lineHeight:"20px",paddingTop:4}:{paddingLeft:s,marginLeft:"comment_unfurl"===t?8:void 0}},textWrapper:n?{}:{padding:"margin_comments"===t?"2px 16px 6px 42px":"0px 16px 3px 16px",marginTop:"comment_unfurl"===t?"-14px":void 0},reactionContainer:{marginLeft:"margin_comments"===t?41:50,marginRight:14,marginTop:4,marginBottom:4,...n?{margin:0}:{}},attachmentContainer:{display:"flex",alignItems:"center",...n?{}:{padding:"0px 16px 6px 54px",marginTop:-12}},timestamp:{margin:"0 6px",flexBasis:"comment_unfurl"!==t?140:void 0,whiteSpace:"normal",flexGrow:"updates_sidebar"===t||"comment_unfurl"===t?void 0:1,display:"inline",...n?{color:e.text.tertiary}:{}},commentAttachment:n?{}:{margin:"0px 16px 0px "+("margin_comments"===t?"40px":"50px")},commentAuthorPlaceholder:{marginRight:8,marginTop:"comment_unfurl"===t?14:2,height:i,width:i,borderRadius:20,flexShrink:0}})),[t,s,o,i,n])}({discussionLocation:h,isAllEmojis:Xe,avatarSize:Ge,newCommentsDesignEnabled:ve});if(!be)return null;if(!Ze||!_e)return null;const Je="comment_unfurl"!==h,Qe=!!ve&&x;let et,tt;Ze.lastEditedTime&&Ze.lastEditedTime>Ze.createdTime+100?(et=(0,f.jsx)(y.FormattedMessage,{defaultMessage:"{lastEditedTime} (edited)",id:"comment.editedAtTime.label",values:{lastEditedTime:(0,E.IS)(Ze.lastEditedTime,{useUltraCompactFormat:ve})}}),tt=(0,E.uy)(Ze.lastEditedTime)):(et=(0,E.IS)(Ze.createdTime,{useUltraCompactFormat:ve}),tt=(0,E.uy)(Ze.createdTime));const it=Se.length>0&&(0,f.jsx)("div",{style:Ye.commentAttachment,children:(0,f.jsx)(Mo,{contentStores:Se,onRemoveContent:Ke,discussionFormat:(0,le.discussionLocationToDiscussionFormat)(h),collapsed:e.collapsed,discussionHovered:e.hoveringDiscussion})});return(0,f.jsxs)("div",{ref:He,onClick:e=>ue&&e.stopPropagation(),style:Ye.container,children:[e.showNewBar&&(0,f.jsx)(Lo,{}),(0,f.jsxs)("div",{style:Ye.comment,onFocus:je,onBlur:ke,onMouseMove:Me,onMouseLeave:Le,children:[(0,f.jsxs)("div",{style:ve?{}:{flexGrow:1,minWidth:0},children:[(0,f.jsxs)("div",{style:Ye.userRow,children:[e.isSuggestionComment?(0,f.jsxs)("div",{style:{position:"relative"},children:[(0,f.jsx)(ot,{authorStore:null==_e?void 0:_e.store,avatarSize:Ge,avatarStyle:Ye.avatar,placeholderStyle:Ye.commentAuthorPlaceholder}),(0,f.jsx)("div",{style:{position:"absolute",right:4,bottom:-4},children:v({width:16,height:16})})]}):(0,f.jsx)(ot,{authorStore:null==_e?void 0:_e.store,avatarSize:Ge,avatarStyle:Ye.avatar,placeholderStyle:Ye.commentAuthorPlaceholder}),(0,f.jsxs)("div",{style:{overflow:"hidden"},children:[(0,f.jsx)("span",{style:{fontWeight:ve?w.Z.fontWeight.medium:w.Z.fontWeight.semibold,whiteSpace:"normal"},children:Ve?(0,f.jsx)(B.ZP,{renderTooltip:()=>_e&&_e.store instanceof $.U6?(0,f.jsx)(A.Z,{targetUserStore:_e.store}):null,placement:B.ug.Top,alignment:B.v2.End,render:e=>(0,f.jsx)("span",{...e,children:_e.displayName}),delayThreshold:600,allowHover:!0,closeDelay:1500,isLightBackground:!0}):_e.displayName||(0,f.jsx)("span",{style:Ye.placeholder})}),(0,f.jsx)(T.Z,{isSmall:!0,isSecondaryColor:!0,isMultiline:!0,style:Ye.timestamp,children:(0,f.jsx)(Z.Z,{text:et,tooltipText:tt,icon:g.C})}),"comment_unfurl"===h&&ye&&(0,f.jsx)("div",{style:{display:"inline-flex"},children:(0,f.jsx)(I.Z,{children:(0,f.jsx)(y.FormattedMessage,{id:"comment.unfurl.resolvedStatus",defaultMessage:"Resolved"})})})]})]}),Qe&&(0,f.jsx)("div",{style:Ye.threadLine}),(0,f.jsxs)("div",{style:Ye.commentElementsBelowUserRow,children:[Boolean(o)&&(0,f.jsx)("div",{style:ve?{}:{paddingLeft:xe+15,paddingRight:16},children:o}),ue&&(0,f.jsx)("div",{style:ve?{marginTop:4}:{marginTop:(0,le.discussionLocationToDiscussionFormat)(h)===le.DiscussionFormat.Margin?8:void 0},children:(0,f.jsx)(li,{containerStyle:ve?{width:"calc(100% + 8px)"}:{padding:"margin_comments"===h?"0px 16px 0px 16px":"0px 10px 0px 45px"},showAvatar:!1,parentStore:e.store,blockStore:e.blockStore,onCancel:Ue,onSubmit:Ne,discussionInputStore:be,isEditingExistingComment:!0,isMobileSlideUpMenu:!0,shouldSaveUnsentComments:!1,commentStore:e.store,discussionFormat:(0,le.discussionLocationToDiscussionFormat)(h),canDrop:!0})}),qe&&!ue&&(0,f.jsx)("div",{style:{...Ye.textWrapper},children:(0,f.jsx)(_.Z,{onMore:"comment_unfurl"===h?void 0:()=>{},moreElement:(0,f.jsxs)(F.Z,{disableUnderline:!0,style:Ye.unfurlMoreWrapper,hoverColor:ve?"blue":void 0,children:["…"," ",(0,f.jsx)("span",{children:(0,f.jsx)(y.FormattedMessage,{id:"text.truncated.showMoreLabel",defaultMessage:"more"})})]}),maxLines:e.collapsed?i:void 0,children:(0,f.jsx)(V.Z,{style:Ye.text,store:K.zP(e.store),disabled:!0,disabledMentionTypes:{date:!0},disableEquationInteraction:!0,inPageFind:{type:"none"}})})}),ue||"comment_unfurl"===h?!qe&&(0,f.jsxs)("div",{style:Ye.attachmentContainer,children:[(0,f.jsx)("div",{style:{marginRight:5},children:(0,p.s)(Ye.attachIcon)}),(0,f.jsx)(y.FormattedMessage,{defaultMessage:"{numberOfAttachments, plural, one {{numberOfAttachments} attachment} other {{numberOfAttachments} attachments}}",values:{numberOfAttachments:Se.length},id:"comment.unfurl.attachments.title"})]}):it,(0,f.jsx)("div",{ref:Oe,children:Je&&Ze.reactions.length>0&&(0,f.jsx)("div",{style:Ye.reactionContainer,children:(0,f.jsx)(mt,{parentStore:e.store,discussionLocation:h})})})]})]}),"comment_unfurl"!==h&&!ue&&(0,f.jsx)(ft,{store:e.store,discussionStore:e.discussionStore,blockStore:e.blockStore,discussionLocation:h,visible:Te,isFirstComment:Be,buttonPopupStore:Re,canShowReactions:Je,handleEditComment:We,handleDeleteComment:ze,handleReaction:Ee})]})]})};var mi=o(93963),pi=o(46351),gi=o(95802),hi=o(21853),fi=o(56681);function vi(e){var t;let{discussionStore:o,commentStore:i}=e;if(!i.isDefined())return!1;const n=null===(t=Ve.default.state.currentUserStore)||void 0===t?void 0:t.id;const s=fi.Z.state.lastInteractionTimes[o.id];if(i.getCreatedById()===n)return!1;const r=function(){if(!o.isDefined()||!n)return 0;const{pageVisitStore:e}=Ve.default.state,{lastViewTime:t,lastExitTime:i}=e.state;return i||t}();if(void 0===r)return!1;const a=(0,le.getAndSortCommentStoresByTime)(o).filter((e=>e.getCreatedById()===n)).reverse()[0],l=i.getCreatedTime();return!l||!(a&&l<a.getCreatedTime())&&(!(s&&l<s)&&l>r)}var xi=o(13991),bi=o(99036),Si=o(25501),yi=o(59753),Ci=o(2456);const wi=new Set([ue.Ti.toggle,ue.Ti.bulletedList,ue.Ti.numberedList,ue.Ti.quote,ue.Ti.toDo,ue.Ti.code,ue.Ti.callout,ue.Ti.header,ue.Ti.subHeader,ue.Ti.subSubHeader,ue.Ti.tableRow]);function ji(e){const t=(0,u.Fg)(),o=(0,c.VK)((()=>{var t;return e.store.isDefined()?null===(t=e.store.getParentStore())||void 0===t?void 0:t.getValue():null}),[e.store]),i=(0,c.VK)((()=>e.blockStore.getSpaceId()),[e.blockStore]),n=(0,c.VK)((()=>{if(!e.store.isDefined())return;const t=e.store.getContext();if(!t)return;return yt.VP_(t,(t=>!yt.xw5(t)||yt.h19(t)===e.store.id))}),[e.store]),s=(0,c.VK)((()=>H.default.checkGate("comments_density_image_handling")),[]),r=o=>{let{textValue:n,propertySchema:r,discussionParentValue:a}=o;const l=s?18:24,d=(0,f.jsx)("div",{style:{overflow:"hidden",lineHeight:`${l}px`,maxHeight:4*l},children:(0,f.jsx)(Ci.KX,{value:{value:n,spaceId:i},propertySchema:r,labeled:!1,rootStore:e.blockStore,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableDateStyleAnnotations:!0})});if(!a)return d;const c=a.type;return c===ue.Ti.code?(0,f.jsx)(Si.Z,{title:(0,Ci.SP)(a),theme:t,style:{marginTop:0,marginBottom:0},children:(0,f.jsx)("span",{style:{fontFamily:w.Z.getCompositeFontFamily(xi.SP).mono,fontSize:12,tabSize:2},children:d})}):(0,Ci.pH)(c)?(0,f.jsx)(Si.Z,{title:(0,Ci.pH)(c),theme:t,style:{marginTop:0,marginBottom:0},children:d}):d},a={display:"flex",alignItems:"flex-start",fontSize:14,marginTop:8,marginBottom:8,color:t.mediumTextColor,width:"100%",...s?{alignItems:void 0,marginTop:6,marginBottom:6,fontSize:13,color:t.text.secondary}:{}};function l(e){if(!n)return null;const t=bi.Kc(Zo.default.getIntl()).title;return t?(0,f.jsx)("div",{style:a,children:(0,f.jsxs)("div",{style:{display:"flex",width:"100%"},children:[(0,f.jsx)(ki,{newCommentsDesignEnabled:s}),r({textValue:n,discussionParentValue:e,propertySchema:t})]})}):null}if("updates_sidebar"===e.discussionLocation){if(!o)return null;if("text"!==o.type)return(0,f.jsx)("div",{onClick:e.onClick,style:{display:"flex",cursor:yi.kk.fromBlock(o).isType(ue.Zi)?"text":void 0},children:n&&wi.has(o.type)?l(o):(0,f.jsxs)("div",{style:s?a:{display:"flex",marginTop:8,marginBottom:8,width:"100%"},children:[(0,f.jsx)(ki,{newCommentsDesignEnabled:s}),(0,f.jsx)(Ci.ZP,{blockValue:o,rootStore:e.blockStore,blockPreviewLocation:"comments_sidebar"})]})})}return(0,f.jsx)("div",{onClick:e.onClick,style:{cursor:"text"},children:l()})}function ki(e){let{newCommentsDesignEnabled:t}=e;return(0,f.jsx)("div",{style:t?{width:2,marginLeft:1,borderRadius:4,marginRight:8,background:We.DB,flexShrink:0}:{width:3,borderRadius:4,marginLeft:2,marginRight:8,background:We.DB,flexShrink:0,paddingBottom:2}})}var Mi=o(7189),Li=o(73819);const Di={margin_comments:"8px 12px 6px",page_discussion:"8px 0px 0px",block_menu:"8px 16px 0px",reply_menu_mentions_comments:"8px 16px 0px",updates_sidebar:"4px 16px 12px"},Ri=n.forwardRef((function(e,t){const o=(0,r.O7)(),{format:i,role:n,showMoreCommentsButton:s,onMoreCommentsClick:a,inputVisible:l,blockStore:d}=e,m=(0,Li.cR)(d),p=(0,c.VK)((()=>H.default.checkGate("prevent_edits_trash")),[]),g=n&&b.rz(n)||p&&m,h=o.currentUser.isLoggedIn(),{device:v,WindowSizeStore:x}=o,S=(0,u.Fg)(),C=(0,c.VK)((()=>H.default.checkGate("comments_density_image_handling")),[]),w=(0,c.VK)((()=>({paddingLeft:v.isMobile&&x.getSafePaddingLeftCSS(18)||i===le.DiscussionFormat.Margin&&9||13,paddingRight:v.isMobile&&x.getSafePaddingLeftCSS(14)||i===le.DiscussionFormat.Margin&&12||16})),[x,v.isMobile,i]),j=(0,u.yK)((t=>({container:{paddingTop:e.collapsed?1:4,paddingLeft:w.paddingLeft,paddingRight:w.paddingRight,paddingBottom:(v.isMobile&&i!==le.DiscussionFormat.Page?8:i===le.DiscussionFormat.Sidebar&&14)||0,position:"relative",...C?{padding:0,...i===le.DiscussionFormat.Page?{marginLeft:16,marginRight:16}:{}}:{}},moreCommentsWrapper:{position:"absolute",display:"flex",justifyContent:"center",alignItems:"flex-start",zIndex:1,left:0,right:0,marginTop:-32,height:30,background:`linear-gradient(to bottom, ${t.contentBackgroundTransparent} 0px, ${t.selectedMarginDiscussionBackground} 30px`,...C?{marginTop:-28}:{}},tooltip:{...(0,B.JS)(t,!1),cursor:"pointer",display:"flex",justifyContent:"center",alignItems:"center",...C?{marginTop:-4,borderRadius:6,padding:"4px 10px 4px 8px"}:{}}})),[w,v.isMobile,i,e.collapsed,C]);return(0,f.jsx)(f.Fragment,{children:h&&!g&&(s||l)&&(0,f.jsxs)("div",{style:j.container,children:[s&&(0,f.jsx)("div",{style:j.moreCommentsWrapper,children:(0,f.jsxs)("div",{style:j.tooltip,onClick:a,children:[(0,f.jsx)("div",{style:{marginRight:5},children:(0,Mi.K)({fill:S.regularInvertedTextColor,height:12,width:12})}),(0,f.jsx)(y.FormattedMessage,{defaultMessage:"See more",id:"discussion.moreMessageTooltip"})]})}),l&&(0,f.jsx)(li,{showAvatar:!!C||"margin_comments"!==e.discussionLocation,containerStyle:C?{padding:Di[e.discussionLocation]}:{...v.isMobile?{}:{paddingLeft:5,paddingRight:2}},parentStore:e.store,onCancel:e.onCancel,onSubmit:e.onSubmit,discussionInputStore:e.discussionInputStore,isMobileSlideUpMenu:!1,shouldSaveUnsentComments:!0,onEditPreviousComment:e.onEditPreviousComment,inReplyToDiscussionId:e.store.id,discussionFormat:e.format,showCtaButtons:e.showCtaButtons,ref:t,onFileUploaded:e.onFileUploaded})]})})}));var Ii=o(62385);function Bi(e){const t=(0,c.VK)((()=>H.default.checkGate("comments_density_image_handling")),[]),o=(0,u.yK)((o=>{const i=ae(e.discussionLocation)+ee;return{newBarLine:{height:"0px",borderBottom:`1px solid ${o.darkDividerColor}`,marginLeft:0,flex:1},moreCommentsWrapper:{color:o.lightTextColor,fontSize:14,paddingLeft:e.insetButton?38:25,flexGrow:1,display:"flex",alignItems:"center",...t?{paddingLeft:8}:{}},button:{padding:"12px 12px",margin:"1px 4px",borderRadius:4,fontSize:14,color:o.mediumTextColor,width:"calc(100% - 8px)",justifyContent:"space-between",...t?{padding:"14px 0",margin:`0 0 0 ${i}px`,width:`calc(100% - ${i}px - 16px)`}:{}},buttonHovered:{background:o.focusDiscussionInputBackground},threadLine:{position:"absolute",backgroundColor:o.stroke.deemphasized,width:oe,height:"100%",top:Y-te,left:ae(e.discussionLocation)+ie,borderRadius:2}}}),[e.insetButton,e.discussionLocation,t]);return e.count<=0?null:(0,f.jsxs)("div",{style:t?{position:"relative"}:{},children:[t&&(0,f.jsx)("div",{style:o.threadLine}),(0,f.jsx)(Ii.Z,{style:o.button,onClick:e.onClick,hoveredStyle:o.buttonHovered,children:(0,f.jsx)("div",{style:o.moreCommentsWrapper,children:(0,f.jsx)(y.FormattedMessage,{defaultMessage:"Show {moreCommentsNumber, plural, one {{moreCommentsNumber} reply} other {{moreCommentsNumber} replies}}",id:"discussion.showMoreCommentsSidebarButton.label",values:{moreCommentsNumber:e.count}})})},"show")]})}var Ti=o(14200);const Fi=(0,y.defineMessages)({addLabel:{id:"suggestionContext.label.add",defaultMessage:"Add"},removeLabel:{id:"suggestionContext.label.remove",defaultMessage:"Delete"},boldLabel:{id:"suggestionContext.label.bold",defaultMessage:"Bold"},unboldLabel:{id:"suggestionContext.label.unbold",defaultMessage:"Unbold"},italicLabel:{id:"suggestionContext.label.italic",defaultMessage:"Italicize"},unitalicLabel:{id:"suggestionContext.label.unitalic",defaultMessage:"Unitalicize"},strikeLabel:{id:"suggestionContext.label.strike",defaultMessage:"Strike through"},unstrikeLabel:{id:"suggestionContext.label.unstrike",defaultMessage:"Remove strike through"},underlineLabel:{id:"suggestionContext.label.underline",defaultMessage:"Underline"},removeUnderlineLabel:{id:"suggestionContext.label.remove underline",defaultMessage:"Remove underline"},codeStyleLabel:{id:"suggestionContext.label.codeStyle",defaultMessage:"Mark as code"},removeCodeStyleLabel:{id:"suggestionContext.label.remove codeStyle",defaultMessage:"Remove code style"},addLinkLabel:{id:"suggestionContext.label.addLink",defaultMessage:"Add link"},removeLinkLabel:{id:"suggestionContext.label.removeLink",defaultMessage:"Remove link"},highlightLabel:{id:"suggestionContext.label.highlight",defaultMessage:"Highlight"},removeHighlightLabel:{id:"suggestionContext.label.removeHighlight",defaultMessage:"Remove highlight"},undefinedOpLabel:{id:"suggestionContext.label.undefinedOp",defaultMessage:"Undefined operation"}}),Zi={[yt.GKr.Bold]:[Fi.boldLabel,Fi.unboldLabel],[yt.GKr.Italic]:[Fi.italicLabel,Fi.unitalicLabel],[yt.GKr.Strike]:[Fi.strikeLabel,Fi.unstrikeLabel],[yt.GKr.Underline]:[Fi.underlineLabel,Fi.removeUnderlineLabel],[yt.GKr.Code]:[Fi.codeStyleLabel,Fi.removeCodeStyleLabel],[yt.GKr.Link]:[Fi.addLinkLabel,Fi.removeLinkLabel],[yt.GKr.Highlight]:[Fi.highlightLabel,Fi.removeHighlightLabel]};function _i(e){const{discussionStore:t}=e,o=(0,y.useIntl)(),i=(0,c.VK)((()=>t.isSuggestionDiscussion()),[t]),{value:n,label:s,shouldUseDeleteColor:r}=(0,c.VK)((()=>{const t=e.discussionStore.getContext(),o={value:void 0,label:void 0,shouldUseDeleteColor:void 0};if(!t)return o;const i=t.flatMap((e=>(0,yt.hDy)(e))).find((t=>yt.BIG(t)&&yt.fgJ(t)===e.discussionStore.id));if(!i)return o;const n=function(e){const t=Fi.undefinedOpLabel;if(yt.pGj(e))return Fi.addLabel;if(yt.$b8(e))return Fi.removeLabel;if(yt.u2m(e)||yt.Jeu(e)){const o=yt.EpE(e);return yt.u2m(e)?Zi[yt.J7s(o)][0]??t:Zi[yt.J7s(o)][1]??t}(0,je.t1)(e)}(i),s=yt.$b8(i);let r=t;if(yt.u2m(i)||yt.Jeu(i)){const e=yt.EpE(i);if(yt.j0F(e)){r=[[yt.zW$(e)]]}}return{value:r,label:n,shouldUseDeleteColor:s}}),[e.discussionStore]),a=(0,c.VK)((()=>e.blockStore.getSpaceId()),[e.blockStore]),l=(0,u.yK)((e=>({container:{marginTop:2},label:{color:r?e.text.tertiary:e.text.uiBlueSecondary,fontSize:14,lineHeight:"18px"},text:{color:r?e.text.secondary:e.text.uiBluePrimary,fontSize:14,lineHeight:"18px"}})),[r]),d=bi.Kc(o).title;return i&&n&&d?(0,f.jsx)("div",{style:l.container,children:(0,f.jsxs)(_.Z,{maxLines:e.collapsed?1:void 0,children:[(0,f.jsxs)("span",{style:l.label,children:[o.formatMessage(s),": "]}),(0,f.jsxs)("span",{style:l.text,children:["“",(0,f.jsx)(Ti.Z,{value:{value:n,spaceId:a},propertySchema:d,rootStore:e.blockStore,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableDateStyleAnnotations:!0}),"”"]})]})}):null}const Ai=2,Vi=5;function Pi(e){const t=(0,n.useRef)(null),o=(0,r.O7)(),i=(0,c.VK)((()=>H.default.checkGate("comments_density_image_handling")),[]),a=(0,c.VK)((()=>"suggestion"===e.store.getType()),[e.store]),l=(0,c.VK)((()=>K.D4(e.store)),[e.store]),m=(0,c.VK)((()=>l.filter((e=>e.isDefined()))),[l]),p=(0,n.useRef)(e.discussionInputStore||new de.Z(o,e.store.pointer.spaceId)).current,g=(0,c.VK)((()=>(0,le.inputIsEmpty)(p)),[p]),h=(0,c.VK)((()=>e.store.getResolved()),[e.store]),[v,x]=(0,n.useState)(!1),[b,S]=(0,n.useState)(!1),[C,w]=(0,n.useState)(!0),j=(0,c.qz)(void 0,Zt.Z),L=(0,c.VK)((()=>j.state.clientRect),[j]),I=e.format===le.DiscussionFormat.Sidebar,B=e.format===le.DiscussionFormat.Margin,T=(0,n.useRef)(null);(0,d.c)(pi.Z,(()=>({isSidebarFormat:()=>I,isMarginFormat:()=>B,getStore:()=>e.store,getInputStore:()=>p,getNode:()=>T.current})),[I,B,e.store,p]);const F=(0,c.VK)((()=>{if(!I)return;return(0,le.getAndSortCommentStoresByTime)(e.store).find((t=>vi({discussionStore:e.store,commentStore:t})))}),[I,e.store]),Z=(0,n.useRef)(F),_=void 0===Z.current?F:Z.current,A=(0,c.VK)((()=>{const{showAllRepliesAfterTimestamp:t}=e,o=(()=>{var o;if(b||m.length<=Vi||"block_menu"===e.discussionLocation||"page_discussion"===e.discussionLocation)return m;const i=[t,null===(o=Z.current)||void 0===o?void 0:o.getCreatedTime(),null==F?void 0:F.getCreatedTime()].filter(je.$K),n=i.length>0?Math.min(...i):void 0;if(n){const e=m.filter((e=>(e.getCreatedTime()||0)>n)),t=m.filter((e=>(e.getCreatedTime()||0)<=n));return t.length<=Vi?m:[...we.pm(t,Ai),...e]}return we.pm(m,Ai)})(),i=new Set(o.map((e=>e.id))),n=m.filter((e=>!i.has(e.id)));return{commentStores:m,commentsToShow:o,commentsToCollapse:n,reactionsToShow:$.bh.getUserVisibleReactions(e.store)}}),[m,F,e,b],{useDeepEqual:!0}),V=(0,n.useCallback)((()=>{if(!e.store.isDefined())return;const t=e.store.getContext();if(!t)return;return yt.VP_(t,(t=>!yt.xw5(t)||yt.h19(t)===e.store.id))}),[e.store]),P=(0,c.VK)((()=>{if(!I)return;return(0,le.getAndSortCommentStoresByTime)(e.store).find((t=>vi({discussionStore:e.store,commentStore:t})))}),[I,e.store]),z=n.createRef(),E=(0,n.useRef)(e.blockStore.clone()).current,U=(0,u.yK)((t=>i?{discussionWrapper:{...e.format===le.DiscussionFormat.Page&&{margin:"0px -14px 16px"},...e.format===le.DiscussionFormat.Menu&&{padding:"6px 0 12px",marginLeft:-2,boxShadow:e.isFirst?"none":`0 -1px 0 ${t.regularDividerColor}`,marginTop:e.isFirst?0:1},...e.format===le.DiscussionFormat.Margin&&{padding:"4px 0",borderRadius:8}}}:{discussionWrapper:{...e.format===le.DiscussionFormat.Page&&{margin:"14px -14px 14px"},...e.format===le.DiscussionFormat.Menu&&{paddingTop:10,paddingBottom:12,marginLeft:-2,boxShadow:e.isFirst?"none":`0 -1px 0 ${t.regularDividerColor}`,marginTop:e.isFirst?0:1},...e.format===le.DiscussionFormat.Margin&&{paddingTop:e.collapsed?8:0,paddingBottom:e.collapsed?8:14,borderRadius:4}}}),[e.collapsed,e.format,e.isFirst,i]);(0,n.useEffect)((()=>{o.KatexStore.loadIfNeeded(V)}),[o.KatexStore,V]);const N=t=>{const{device:i}=o;if(!i.isMobile)return;if(!e.store.isDefined())return;t.stopPropagation(),t.preventDefault(),hi.Z.setState({open:!1});const n=we.oA(gi.C.findSelectablesFromIds([e.store.getParentId()])),s=null==n?void 0:n[0];s&&M.XW({handle:s,vertical:{reveal:"bottom"},horizontal:{reveal:"closest"},animate:!0})},G=()=>{const o=(0,le.lineClampForCommentCount)(l.length);if(!e.collapsed)return(0,f.jsx)(Bt.Z,{style:{display:"flex",flexDirection:"column",maxHeight:500,overflowY:"scroll",paddingTop:i?void 0:8},ref:t,type:Ft.Z.Y,store:j,children:l.map(((t,n)=>{const s=a&&0===n;return(0,f.jsx)(ui,{store:t,discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:v,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,maxLines:o,shouldShowThreadLine:i?n!==l.length-1:void 0,discussionContext:s?(0,f.jsx)(_i,{discussionStore:e.store,blockStore:e.blockStore,collapsed:Boolean(e.collapsed)}):void 0,isSuggestionComment:s},t.id)}))});const n=l[0]&&(0,f.jsx)(ui,{store:l[0],discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:v,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,maxLines:o,collapsed:e.collapsed,shouldShowThreadLine:i?1!==l.length:void 0,discussionContext:a?(0,f.jsx)(_i,{discussionStore:e.store,blockStore:e.blockStore,collapsed:Boolean(e.collapsed)}):void 0,isSuggestionComment:a},l[0].id),s=l.length>1&&l[l.length-1]&&(0,f.jsx)(ui,{store:l[l.length-1],discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:v,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,maxLines:o,collapsed:e.collapsed,shouldShowThreadLine:!i&&void 0},l[l.length-1].id),r=l.length-2;return(0,f.jsxs)(f.Fragment,{children:[n,(0,f.jsx)(Bi,{insetButton:!B,count:r,onClick:oe,discussionLocation:e.discussionLocation}),s]})};const X=(0,c.VK)((()=>e.blockStore.getRole()),[e.blockStore]),Y=t.current,J=(0,c.VK)((()=>(null==Y?void 0:Y.atScrollEnd())??!0),[Y]),Q=C&&!e.collapsed&&B&&L&&t.current&&!J,ee=()=>{s.default.afterNextFlush((()=>{t.current&&t.current.scrollToBottom({animate:!0})}))},te=we.Ds((()=>{setTimeout((()=>w(!0)),50)}),50),oe=e=>{B||(e.stopPropagation(),S(!0))},ie=()=>{p.reset()},ne=()=>{O.Z.state||x(!0)},se=()=>{x(!1)};return 0===A.commentsToShow.length&&A.reactionsToShow.length>0?(0,f.jsx)("div",{ref:T,style:{...U.discussionWrapper,paddingLeft:16},onMouseMove:ne,onMouseLeave:se,children:(0,f.jsx)(ut,{focused:!1,parentStore:e.store,discussionLocation:e.discussionLocation})}):(0,f.jsx)(Lt.Z,{store:E,analyticsName:"discussion",canNativeDropOnto:!0,onNativeDrop:async e=>{let{files:t}=e;z.current&&await z.current.uploadFiles(t)},keepTextSelectionOnDrop:!0,shouldShowDropZone:!0,children:(0,f.jsxs)("div",{ref:T,style:U.discussionWrapper,onMouseMove:ne,onMouseLeave:se,children:[function(){if(B)return G();const{commentStores:t,commentsToShow:o,commentsToCollapse:n}=A,s=n.length>0,r=o.map(((t,n)=>{const r=a&&0===n,l=r?(0,f.jsx)(_i,{discussionStore:e.store,blockStore:e.blockStore,collapsed:Boolean(e.collapsed)}):0===n&&!s&&(e.format===le.DiscussionFormat.Menu||e.format===le.DiscussionFormat.Sidebar)&&(0,f.jsx)(ji,{format:e.format,discussionLocation:e.discussionLocation,store:e.store,blockStore:e.blockStore,onClick:N});return(0,f.jsx)(ui,{store:t,discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:v,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,discussionContext:l,isSuggestionComment:r,showNewBar:t.id===(null==_?void 0:_.id)&&0!==n,shouldShowThreadLine:i?n!==o.length-1:void 0},t.id)})),l=a,d=l?(0,f.jsx)(_i,{discussionStore:e.store,blockStore:e.blockStore,collapsed:Boolean(e.collapsed)}):(e.format===le.DiscussionFormat.Menu||e.format===le.DiscussionFormat.Sidebar)&&(0,f.jsx)(ji,{format:e.format,discussionLocation:e.discussionLocation,store:e.store,blockStore:e.blockStore,onClick:N});return(0,f.jsxs)("div",{style:{position:"relative"},children:[I&&P&&(0,f.jsx)(mi.z,{style:zi}),s&&(0,f.jsx)(ui,{store:t[0],discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:v,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,discussionContext:d,shouldShowThreadLine:i?1!==t.length:void 0,isSuggestionComment:l},t[0].id),(0,f.jsx)(Bi,{insetButton:!B,count:n.length-1,onClick:oe,discussionLocation:e.discussionLocation}),r]})}(),h?(0,f.jsx)("div",{style:{height:8}}):(0,f.jsx)(Ri,{ref:z,showMoreCommentsButton:!!Q,onMoreCommentsClick:ee,inputVisible:!e.collapsed||!g,store:e.store,blockStore:E,format:e.format,discussionInputStore:p,discussionLocation:e.discussionLocation,onCancel:async()=>{if((0,le.hasCommentChanged)(p)){await k.confirmUserAction({message:(0,f.jsx)(y.FormattedMessage,{defaultMessage:"Do you want to discard this reply?",id:"discussion.confirmDialog.discardReply.prompt"}),acceptLabel:(0,f.jsx)(y.FormattedMessage,{defaultMessage:"Discard",id:"discussion.confirmDialog.discardReplyButton.label"})})?(ie(),e.onDismiss&&e.onDismiss()):(await s.default.afterNextFlush(),D.NX({store:p.state.textStore}))}else ie(),e.onDismiss&&e.onDismiss()},onSubmit:async()=>{w(!1);const{device:t}=o,{store:i,discussionLocation:n}=e;R.createAndCommit({userAction:"Discussion.handleSubmitReply",environment:o,perform:e=>{q.Xi({environment:o,discussionStore:i,textValue:p.state.textStore.getValue()||[],transaction:e,discussionLocation:n,files:p.state.files})}}),ie(),D.ZH(o),ee(),te(),t.isMobile||(await s.default.afterNextFlush(),D.N_({store:p.state.textStore}))},onEditPreviousComment:()=>{const t=o.currentUser.id;if(!t)return;const i=K.D4(e.store).filter((e=>e.getCreatedById()===t)),n=we.Z$(i);if(!n)return;const s=W.Z.find((t=>t.commentId===n.id&&t.discussionLocation===e.discussionLocation));s&&(D.ZH(o),s.edit())},showCtaButtons:!!B||void 0,onFileUploaded:()=>{const e=gi.C.findSelectableFromStore(E);e&&M.XW({handle:e,vertical:{reveal:"bottom"},horizontal:{reveal:"closest"},animate:!0})},role:X})]})})}const zi={marginRight:4,position:"absolute",right:16,top:14};var Ki=o(33866),Ei=o(10906),Wi=o(82136),Ui=o(92650),Ni=o(14577),Hi=o(38585),Oi=o(80503),Gi=o(51454),$i=o(39500),qi=o(49427),Xi=o(36391),Yi=o(24229),Ji=o(50628),Qi=o(92120),en=o(48514),tn=o(37240);function on(e){let{discussionData:{groupedDiscussionsData:t,id:o},onClick:i}=e;const[s,r]=(0,n.useState)(!1),a=(0,n.useCallback)((()=>{r(!0)}),[]),l=(0,n.useCallback)((()=>{r(!1)}),[]),d=(0,n.useCallback)((async e=>{const o=t[0].discussionStore;await i(e,o)}),[i,t]),m=(0,c.VK)((()=>H.default.checkGate("comments_density_image_handling")),[]),p=(0,c.VK)((()=>t.flatMap((e=>(0,K.D4)(e.discussionStore)))),[t]),h=(0,c.VK)((()=>{const e=t[0].parentBlockStore;return[...new Set(p.map((e=>e.getCreatedById())).filter(je.$K))].map((t=>$.U6.createChildStore(e,{table:Ce.KJ,id:t}))).slice(0,3)}),[t,p]),v=(0,c.VK)((()=>{const e=p.map((e=>e.getLastEditedTime()));return Math.max(...e)}),[p]),x=(0,u.yK)((e=>({discussion:{border:`1px solid ${e.regularDividerColor}`,borderRadius:4,background:s?e.hoveredMarginDiscussionBackground:e.contentBackground,width:Ui.Z,display:"flex",padding:"10px 12px",cursor:"pointer",...m?{border:`1px solid ${e.stroke.deemphasized}`,borderRadius:8,padding:"12px",alignItems:"center",gap:6}:{}},userAvatarsContainer:{display:"flex",marginRight:6,justifyContent:"center",alignItems:"center",flexDirection:"row-reverse",...m?{marginRight:0}:{}},hiddenUsers:{fontSize:14,color:e.mediumTextColor,marginRight:6},commentCount:{fontSize:14,fontWeight:w.Z.fontWeight.semibold,whiteSpace:"normal",marginLeft:6,...m?{marginLeft:0,color:e.text.primary,fontWeight:w.Z.fontWeight.medium,lineHeight:"18px"}:{}},textPlaceholder:{background:e.lightDividerColor,height:14,width:81,borderRadius:4,marginLeft:4},lastEditedTime:{margin:"1px 0px 0px 6px",whiteSpace:"normal",display:"flex",justifyContent:"center",alignItems:"center",lineHeight:"21px",...m?{marginLeft:0,color:e.text.tertiary,fontSize:12,lineHeight:"15px"}:{}},commentAuthorAvatarStyle:{width:20,height:20,borderRadius:20,marginRight:-3,position:"relative",userSelect:"none",WebkitUserSelect:"none",...m?{width:24,height:24,marginRight:2}:{}},commentAuthorPlaceholderStyle:{width:20,height:20,borderRadius:20,marginRight:-3,position:"relative"},secondaryLabel:{fontSize:w.Z.fontSize.UISmall.desktop,marginLeft:4,color:e.lightTextColor,marginTop:1,whiteSpace:"normal",display:"flex",justifyContent:"center",alignItems:"center",lineHeight:"21px",...m?{marginLeft:0,marginTop:0,color:e.text.tertiary}:{}},expandIcon:{width:w.Z.fontSize.UISmall.desktop,height:w.Z.fontSize.UISmall.desktop,fill:e.lightTextColor,marginTop:1}})),[s,m]);return(0,f.jsx)("div",{style:x.discussion,onMouseEnter:a,onMouseLeave:l,onClick:d,className:Ze.S9A,children:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{style:x.userAvatarsContainer,children:h.map((e=>(0,f.jsx)(ot,{authorStore:e,avatarSize:m?24:20,avatarStyle:x.commentAuthorAvatarStyle,placeholderStyle:x.commentAuthorPlaceholderStyle},e.id)))}),p.length>0?(0,f.jsx)("div",{style:x.commentCount,children:(0,f.jsx)(y.FormattedMessage,{defaultMessage:"{numComments, plural, one {{numComments} comment} other {{numComments} comments}}",id:"marginComments.collapsed.numComments.count",values:{numComments:p.length}})}):(0,f.jsx)("div",{style:x.textPlaceholder}),s?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{style:{marginLeft:10,display:"flex",justifyContent:"center",alignItems:"center",...m?{marginLeft:0}:{}},children:(0,tn.s)(x.expandIcon)}),(0,f.jsx)("div",{style:x.secondaryLabel,children:(0,f.jsx)(y.FormattedMessage,{defaultMessage:"Expand",id:"marginComments.collapsed.expand.label"})})]}):v&&(0,f.jsx)(T.Z,{isSmall:!0,isSecondaryColor:!0,isMultiline:!0,style:x.lastEditedTime,children:(0,f.jsx)(Z.Z,{text:(0,E.IS)(v,{useUltraCompactFormat:m}),tooltipText:(0,E.uy)(v),icon:g.C})})]})})}var nn=o(74725),sn=o(18821);function rn(e){let{discussionData:{parentBlockStore:t,discussionInputStore:o},isVisible:i}=e;const s=(0,n.useRef)(null),a=(0,r.O7)(),l=(0,c.VK)((()=>H.default.checkGate("comments_density_image_handling")),[]),d=(0,n.useCallback)((()=>{sn.Dc(a)}),[a]),m=(0,n.useCallback)((()=>{sn.uK({discussionInputStore:o,environment:a,discussionHelpers:le})}),[a,o]),p=(0,n.useMemo)((()=>[`.${Ze.mJW}`]),[]);(0,nn.O)({active:i,closeHandler:m,ref:s,excludedSelectors:p,ignoreKeydown:!0});const g=(0,u.yK)((e=>({discussion:{borderRadius:6,boxShadow:e.marginDiscussionSelectedShadow,width:Ui.Z,background:e.selectedMarginDiscussionBackground},discussionInputContainer:{borderRadius:6,padding:l?"8px 8px 8px 12px":"6px 4px 4px 8px"}})),[l]);return(0,f.jsx)("div",{style:g.discussion,ref:s,className:Ze.S9A,children:(0,f.jsx)(li,{parentStore:t,discussionInputStore:o,shouldSaveUnsentComments:!1,isMobileSlideUpMenu:!1,discussionFormat:le.DiscussionFormat.Margin,onSubmit:d,onCancel:m,isNewComment:!0,blockStore:t,canDrop:!0,showAvatar:!1,containerStyle:g.discussionInputContainer,showCtaButtons:!0})})}var an=o(22491),ln=o(5971);function dn(e){let{discussionData:{discussionStore:t,parentBlockStore:o},timeMounted:i,onClick:s,isVisible:a,isDiscussionSelected:l,isDiscussionHovered:d}=e;const m=(0,n.useRef)(null),p=(0,r.O7)(),[g,h]=(0,n.useState)((()=>new de.Z(p,t.pointer.spaceId))),v=(0,ln.E)("block_reactions"),x=t.id,b=(0,c.VK)((()=>t.getCommentStores().length>0),[t]),S=(0,c.VK)((()=>t.getReactionStores().length>0),[t]),y=(0,n.useMemo)((()=>[`.${(0,an.dk)({discussionId:x})}`,`.${Ze.mJW}`,`.${Ze.S9A}`]),[x]),C=(0,n.useCallback)((async()=>{const e=W.Z.find((e=>e.isEditing()));if(e){if(!(await e.handleCancelEdit()))return}j.LZ()}),[]);(0,nn.O)({active:a&&l,closeHandler:C,ref:m,excludedSelectors:y,ignoreKeydown:!0});const w=(0,u.yK)((e=>({discussion:{border:l?void 0:`1px solid ${e.lightDividerColor}`,borderRadius:6,padding:l?"1px":void 0,background:l?e.selectedMarginDiscussionBackground:d?e.hoveredMarginDiscussionBackground:e.contentBackground,boxShadow:l?e.marginDiscussionSelectedShadow:void 0,width:Ui.Z,cursor:l?void 0:"pointer"},wrapper:{willChange:"transform",transition:"transform 200ms ease",transform:l?"translateX(-20px)":d?"translateX(-5px)":void 0}})),[d,l]),k=(0,n.useCallback)((async e=>{var o;l||(Ro.Uw(p,{discussion_id:t.id,from:"margin_comments",parent_block_id:t.getParentId(),parent_collection_id:null===(o=t.getParentStore())||void 0===o?void 0:o.getParentCollectionIdUpToTwoLevels()}),await s(e,t))}),[s,t,l,p]);return(0,f.jsxs)("div",{className:Ze.S9A,ref:m,style:w.wrapper,onClick:k,children:[S&&v&&(0,f.jsx)("div",{style:{width:Ui.Z},children:(0,f.jsx)(ut,{focused:l,parentStore:t,discussionLocation:"margin_comments"})}),b&&(0,f.jsx)("div",{style:w.discussion,children:(0,f.jsx)(Pi,{store:t,blockStore:o,format:le.DiscussionFormat.Margin,isFirst:!1,isOnly:!1,showResolveButtonByDefaultIfPossible:!1,discussionLocation:"margin_comments",showAllRepliesAfterTimestamp:i,discussionInputStore:g,collapsed:!l})})]})}const cn=n.memo(dn);function un(e){const{discussionData:t,isLastItem:o,isDiscussionSelected:i,discussionItemElementMap:s}=e,r=(0,u.yK)((()=>({discussionContainer:{transition:"background 300ms ease\n\t\t\t\t"+(t.hide?"":", top 200ms ease-in-out"),top:t.offsetTop,position:"absolute",paddingBottom:o?Ui.Vs:Ui.wo,zIndex:i?1:void 0,opacity:t.hide?0:1,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",pointerEvents:"auto"}})),[t.hide,t.offsetTop,i,o]);let a;const l=t.type;"existing"===l?a=(0,f.jsx)(cn,{...e,discussionData:t}):"new"===l?a=(0,f.jsx)(rn,{...e,discussionData:t}):"grouped"===l?a=(0,f.jsx)(on,{...e,discussionData:t}):(0,je.t1)(l);const d=(0,n.useCallback)((()=>{Qi.Z.setState({source:"margin_comments",discussionIds:[t.id]})}),[t.id]),c=(0,n.useCallback)((()=>{Qi.Z.setState({discussionIds:[]})}),[]),m=(0,n.useCallback)((e=>{s.set(t.id,e)}),[t.id,s]);return(0,f.jsx)("div",{style:r.discussionContainer,onMouseEnter:d,onMouseLeave:c,ref:m,children:a})}const mn=n.memo(un),pn=`.${Hi.zd}, .${Hi.FB}`;function gn(e){let{pageBlockStore:t,timeMounted:o,isVisible:i,animating:s,pageViewBlockAccessor:a,width:l}=e;const d=(0,r.O7)(),m=(0,n.useRef)(null),p=(0,n.useRef)(new Map),g=(0,n.useRef)(new Map),h=(0,c.VK)((()=>Qi.Z.getFirstSelectedDiscussionId()),[]),v=(0,n.useCallback)((async(e,o)=>{(0,$i.X9)()||e.target instanceof Element&&e.target.closest(pn)||await q.Ri({discussionStore:o,currentBlockStore:t,environment:d,analyticsFrom:"margin_comments",currentEl:m.current})}),[t,d]),[x,b]=(0,n.useState)({data:[],hasNewDiscussion:!1,selectedDiscussion:void 0}),[S,y]=(0,n.useState)(!1),{WindowSizeStore:C}=d,w=Oi.R6(d.device.isElectronMac);(0,n.useEffect)((()=>{if(!i)return;const e=new Ni.Z((()=>({selectableRectMap:Ji.Z.state.selectableRectMap,pageContentStores:t.getContentStores(),sidebarIsAnimating:Xi.ZP.state.isAnimating,windowHeight:C.state.height})),{debugName:"effectDataStore"}),o=new Ni.Z((()=>Ui.EM.state),{debugName:"discussionStoresStore"}),n=new Ni.Z((()=>{const e=en.Z.state;if(e.open&&e.rect&&"comment"===e.content&&qi.Z.isBlockInFrame(e.blockStore))return{blockStore:e.blockStore,discussionInputStore:e.discussionInputStore}}),{debugName:"newMarginDiscussionArgsStore"}),r=new Ni.Z((()=>Yi.Z.getFramePageFirstSelectedDiscussionId()),{debugName:"selectedDiscussionIdStore"});let l=!1;const d=(0,we.Ds)((()=>{const{selectableRectMap:i,pageContentStores:d,sidebarIsAnimating:c,windowHeight:u}=e.state,h=o.state,f=n.state,v=r.state;if(s||c)return;const C=a();if(!(C&&m.current&&i&&i.size))return;(0,Ui.H0)({discussionStores:h,pageContentStores:d,marginDiscussionItemRefs:p.current,selectedDiscussionId:v,newMarginDiscussionArgs:f,marginContainerElement:m.current,pageViewBlockElement:C,onComputeComplete:(e,t)=>{l||(g.current=t,S||y(!0),b(e))},computedOnce:S,topbarHeight:w,windowHeight:u,isFullWidth:t.isFullWidth(),prevSelectedDiscussionId:x.selectedDiscussion,previousDiscussionElements:g.current})}),5);return e.addListener(d),o.addListener(d),r.addListener(d),n.addListener(d),()=>{l=!0,e.removeListener(d),o.removeListener(d),r.removeListener(d),n.removeListener(d)}}),[i,s,a,S,t,x.selectedDiscussion,C,w]);const j=(0,u.yK)((()=>({marginCommentsContainer:{display:"flex",flexDirection:"column",paddingTop:8,paddingBottom:8,paddingLeft:Ui.fS,paddingRight:Ui.fS,width:l-2*Ui.fS,flexShrink:0,height:"100%",position:"relative",pointerEvents:"none",zIndex:Gi.p8}})),[l]);return(0,f.jsx)("div",{style:j.marginCommentsContainer,ref:m,children:x.data.map(((e,t)=>(0,f.jsx)(mn,{discussionData:e,timeMounted:o,onClick:v,isVisible:i,discussionItemElementMap:p.current,isDiscussionSelected:e.selected||"new"===e.type,isDiscussionHovered:e.id===h,isLastItem:t===x.data.length-1},`margin-discussion-${e.id}`)))})}const hn=n.memo(gn);function fn(e){let{pageBlockStore:t,isVisible:o,pageViewBlockAccessor:i,context:s,isCollapsedAnchor:a}=e;const[l,d]=(0,n.useState)(!1),m=(0,r.O7)(),p=(0,n.useMemo)((()=>(new Date).getTime()),[]),g=(0,c.VK)((()=>t.isFullWidth()||s===Wi.S.CollectionPageView),[s,t]),h=(0,c.VK)((()=>a?{paddingLeft:g?96:42,height:0}:g?void 0:{position:"absolute",right:(0,Ui.oS)(m,(0,Ei.en)(t),(0,Ei.Ks)(t))}),[g,m,t,a]),v=(0,n.useCallback)((()=>{d(!0)}),[]),x=(0,n.useCallback)((()=>{d(!1)}),[]),b=(0,u.yK)((()=>({marginCommentsSection:{display:o||l?"flex":"none",flexShrink:0,pointerEvents:"none",width:o?Ui.QB:0,...h}})),[o,l,h]);return(0,f.jsx)(Ne.Z,{isVisible:!0,animationStyle:{opacity:o?1:0},onAnimationStart:v,onAnimationEnd:x,render:()=>(0,f.jsx)("div",{style:b.marginCommentsSection,children:(0,f.jsx)(hn,{pageBlockStore:t,timeMounted:p,isVisible:o,animating:l,pageViewBlockAccessor:i,width:Ui.QB})})})}var vn=o(36488),xn=o(56940),bn=o(53437),Sn=o(3553),yn=o(83355),Cn=o(72402),wn=o(49085);class jn extends wn.default{getInitialState(){return{}}}const kn=jn;class Mn extends yn.Z{constructor(){super(...arguments),this.storeTypes={store:kn},this.rootNode=void 0,this.observer=void 0,this.handleMutation=()=>{this.rootNode&&this.stores.store.setState({node:this.rootNode})}}get registries(){return[Cn.Z]}didMount(){this.props.capture&&this.startListeners()}UNSAFE_willUpdate(e){e.capture&&!this.props.capture?this.startListeners():!e.capture&&this.props.capture&&this.stopListeners()}willUnmount(){this.stopListeners()}startListeners(){const e=ze.findDOMNode(this);e&&(this.rootNode=e,this.observer=new MutationObserver(this.handleMutation),this.observer.observe(this.rootNode,{attributes:!0,subtree:!0}))}stopListeners(){this.observer&&(this.observer.disconnect(),this.rootNode=void 0,this.observer=void 0)}renderComponent(){return n.Children.only(this.props.children)}}Mn.displayName="SlideUpInputArea";const Ln=Mn;const Dn=function(){const e=(0,c.VK)((()=>H.default.checkGate("comments_density_image_handling")),[]),t=(0,r.O7)(),{device:o,WindowSizeStore:i}=t,n=(0,c.VK)((()=>en.Z.state.rect),[]),s=(0,c.VK)((()=>{if(en.Z.state.open&&"comment"===en.Z.state.content){const{blockStore:e,discussionInputStore:o}=en.Z.state;return{blockStore:e,discussionInputStore:o,canMarginCommentsRender:(0,Ui.az)(t,e)}}return null}),[t]),a=(0,c.VK)((()=>e?{paddingLeft:o.isMobileNative?i.getSafePaddingLeftCSS(12):12,paddingRight:o.isMobileNative?i.getSafePaddingRightCSS(8):8}:{paddingLeft:o.isMobileNative?i.getSafePaddingLeftCSS(10):10,paddingRight:o.isMobileNative?i.getSafePaddingRightCSS(10):10}),[i,o.isMobileNative,e]),l=(0,u.yK)((()=>({inputWrapper:{width:o.isMobileNative?"100%":470,maxWidth:o.isMobileBrowser?"90vw":"100%",paddingTop:e?9:8,paddingBottom:o.isAndroid?12:8,paddingLeft:a.paddingLeft,paddingRight:a.paddingRight}})),[o,a,e]),d=()=>{sn.Dc(t)},m=()=>{s&&sn.uK({discussionInputStore:s.discussionInputStore,environment:t,discussionHelpers:le})};return null!=s&&s.canMarginCommentsRender?null:(0,f.jsx)(bn.ZP,{popupType:o.isMobileNative?bn.ZP.PopupType.SlideUp:bn.ZP.PopupType.Popup,keepFocus:!0,open:null!==s,originRect:n,placementToOrigin:bn.ZP.Placement.Bottom,alignmentToOrigin:bn.ZP.Alignment.Center,originGap:4,onDismiss:m,render:()=>{if(s){const{blockStore:e,discussionInputStore:t}=s;return(0,f.jsx)(xn.Z,{capture:!0,ignoreBlockSelection:!0,restoreSelection:!0,render:()=>(0,f.jsx)(Ln,{capture:!0,children:(0,f.jsx)(vn.Z,{capture:!0,allowOpenLinkMenu:!0,render:()=>(0,f.jsx)(Sn.Z,{store:e,droppable:!0,render:()=>(0,f.jsx)("div",{style:l.inputWrapper,children:(0,f.jsx)(li,{showAvatar:!0,parentStore:e,onCancel:m,onSubmit:d,discussionInputStore:t,isMobileSlideUpMenu:!0,shouldSaveUnsentComments:!1,discussionFormat:le.DiscussionFormat.Page,blockStore:e,canDrop:!0})})},e.id)})})})}}})};var Rn=o(9080);const In=function(){const e=(0,r.O7)(),{device:t}=e,{open:o,rect:i}=(0,c.VK)((()=>Rn.Z.state),[]);return(0,f.jsx)(bn.ZP,{popupType:t.isMobile?bn.ZP.PopupType.SlideUp:bn.ZP.PopupType.Popup,open:o,originRect:i,placementToOrigin:bn.ZP.Placement.Bottom,alignmentToOrigin:bn.ZP.Alignment.Center,originGap:4,onDismiss:()=>X.UZ(e),render:()=>(0,f.jsx)(Bn,{})})};function Bn(){const e=(0,r.O7)(),{device:t}=e,o=(0,c.VK)((()=>Rn.Z.state),[]);if(o.open){const{discussionStore:i,discussionInputStore:n,blockStore:s,discussionLocation:r}=o;let a;return a=t.isMobile?{menuType:_e.og.Modal,title:(0,f.jsx)(y.FormattedMessage,{defaultMessage:"Comments",id:"discussion.mobileReplyMenu.title"}),right:(0,f.jsx)(y.FormattedMessage,{defaultMessage:"Close",id:"discussion.mobileReplyMenu.closeButton.label"}),onClickRight:()=>X.UZ(e),whiteBackground:!0}:{menuType:_e.og.Popup,width:420,maxWidth:t.isMobileBrowser?"80vw":"100%"},(0,f.jsx)(Re.Z,{className:Ze.LoZ,...a,children:(0,f.jsx)(vn.Z,{capture:!0,allowMobileAutoScroll:!0,render:()=>(0,f.jsx)(Pi,{store:i,discussionInputStore:n,onDismiss:()=>X.UZ(e),format:le.DiscussionFormat.Menu,isFirst:!0,isOnly:!0,discussionLocation:r,showResolveButtonByDefaultIfPossible:!0,blockStore:s})})})}return null}},10417:(e,t,o)=>{o.r(t),o.d(t,{DiscussionFormat:()=>R,DiscussionLocationToAvatarSize:()=>$,anyDiscussionCommentsLoading:()=>N,commentComparator:()=>A,discussionLocationToDiscussionFormat:()=>H,formatFileSize:()=>q,getAndSortCommentStoresByTime:()=>V,getDiscussions:()=>Z,getDiscussionsForSidebar:()=>_,getFirstComment:()=>P,getIcon:()=>D,getLatestRelevantComment:()=>I,getSetOfUsersInDiscussions:()=>O,hasCommentChanged:()=>U,inputIsEmpty:()=>W,isCommentAllEmojis:()=>G,lineClampForCommentCount:()=>F,sortDiscussionStoresByLatestComment:()=>E});var i=o(66897),n=o(12436),s=(o(67294),o(45238)),r=o(85893);const a=(0,s.IU)("codeFile",{viewBox:"0 0 23 24",svg:(0,r.jsx)("path",{d:"M4.195 11.86c0-.266.078-.488.235-.665.156-.182.38-.3.672-.351.494-.089.849-.271 1.062-.547.214-.281.32-.73.32-1.344V6.961c0-1.115.263-1.938.79-2.469.525-.536 1.333-.804 2.421-.804.203 0 .375.023.516.07.177.057.31.146.398.265a.646.646 0 01.141.422c0 .339-.148.558-.445.657a1.14 1.14 0 01-.157.039l-.171.015c-.625.047-1.066.222-1.32.524-.256.302-.384.8-.384 1.492v2.414c0 .672-.182 1.198-.546 1.578-.36.38-.86.604-1.5.672-.032 0-.047.013-.047.039.005.02.02.034.047.04.64.062 1.14.283 1.5.663.364.38.546.906.546 1.578v2.414c0 .693.128 1.19.383 1.492.255.303.696.48 1.32.532.053 0 .1.002.141.008l.133.03c.333.09.5.308.5.657a.68.68 0 01-.14.43.816.816 0 01-.407.273 1.48 1.48 0 01-.437.063c-1.12 0-1.948-.266-2.485-.797-.531-.526-.797-1.352-.797-2.477V14.79c0-.614-.106-1.062-.32-1.344-.213-.28-.568-.463-1.062-.547-.292-.062-.516-.182-.672-.359-.157-.177-.235-.404-.235-.68zm15.602 0c0 .275-.078.502-.235.68-.156.176-.382.296-.68.358-.5.084-.856.266-1.07.547-.208.282-.312.73-.312 1.344v1.992c0 1.125-.266 1.95-.797 2.477-.531.531-1.36.797-2.484.797-.151 0-.297-.021-.438-.063a.757.757 0 01-.414-.265.715.715 0 01-.133-.438c0-.182.042-.328.125-.437a.674.674 0 01.383-.22l.117-.03c.047-.006.097-.008.149-.008.625-.052 1.065-.23 1.32-.532.255-.302.383-.799.383-1.492v-2.414c0-.672.182-1.208.547-1.61.364-.405.864-.616 1.5-.632.026-.005.039-.018.039-.039 0-.026-.013-.04-.04-.04-.635-.015-1.135-.226-1.5-.632-.364-.406-.546-.945-.546-1.617V7.172c0-.693-.128-1.193-.383-1.5-.255-.307-.695-.48-1.32-.516l-.18-.015a1.233 1.233 0 01-.148-.04c-.297-.109-.446-.328-.446-.656 0-.166.045-.307.133-.422a.777.777 0 01.414-.265c.14-.047.31-.07.508-.07 1.089 0 1.896.268 2.422.804.526.531.789 1.354.789 2.469v1.992c0 .615.107 1.06.32 1.336.214.276.568.461 1.063.555.297.052.523.169.68.351a.967.967 0 01.234.664z"})}),l=(0,s.IU)("compressedFile",{viewBox:"0 0 23 24",svg:(0,r.jsx)("path",{d:"M5.297 17.758V5.968c0-.838.213-1.473.64-1.905.428-.438 1.06-.657 1.899-.657h8.32c.839 0 1.472.219 1.899.656.427.433.64 1.068.64 1.907v11.789c0 .844-.213 1.482-.64 1.914-.427.432-1.06.648-1.899.648h-8.32c-.839 0-1.471-.216-1.899-.648-.427-.432-.64-1.07-.64-1.914zm1.539-.094c0 .36.094.635.281.828.188.193.472.29.852.29h8.062c.38 0 .664-.097.852-.29.187-.193.281-.469.281-.828V6.07c0-.364-.094-.643-.281-.836-.188-.198-.471-.296-.852-.296H7.97c-.38 0-.664.098-.852.296-.187.193-.281.472-.281.836v11.594zm4.617 1.906V8.648h1.086V19.57h-1.086zM12 8.953c-.62 0-1.107-.17-1.46-.508-.35-.338-.524-.804-.524-1.398 0-.115.005-.23.015-.344.016-.114.037-.226.063-.336l.734-3.21a.637.637 0 01.242-.384.709.709 0 01.438-.14h.984a.68.68 0 01.43.14.672.672 0 01.25.383l.734 3.211c.021.11.037.222.047.336.016.115.024.23.024.344 0 .594-.175 1.06-.524 1.398-.349.339-.833.508-1.453.508zm0-1.125c.24 0 .438-.08.594-.242a.826.826 0 00.242-.61.82.82 0 00-.242-.593.795.795 0 00-.594-.25c-.24 0-.44.083-.602.25a.825.825 0 00-.242.594c0 .24.078.442.235.609a.826.826 0 00.609.242zm0 2.89V9.696h1.828c.146 0 .268.05.367.149a.464.464 0 01.149.351c0 .146-.05.271-.149.375a.498.498 0 01-.367.149H12zm-1.836 1.024a.516.516 0 01-.367-.148.525.525 0 01-.149-.375c0-.14.05-.258.149-.352a.516.516 0 01.367-.148H12v1.023h-1.836zM12 12.79v-1.023h1.828c.146 0 .268.05.367.148a.49.49 0 01.149.36.5.5 0 01-.149.367.498.498 0 01-.367.148H12zm-1.836 1.024a.516.516 0 01-.367-.149.516.516 0 01-.149-.367c0-.14.05-.258.149-.352a.516.516 0 01.367-.148H12v1.015h-1.836zM12 14.867v-1.023h1.828c.146 0 .268.05.367.148a.473.473 0 01.149.36.5.5 0 01-.149.367.499.499 0 01-.367.148H12zm-1.836 1.024a.508.508 0 01-.516-.523.48.48 0 01.149-.352.516.516 0 01.367-.149H12v1.024h-1.836zM12 16.945v-1.023h1.828c.146 0 .268.05.367.148a.473.473 0 01.149.36c0 .14-.05.263-.149.367a.499.499 0 01-.367.148H12zm-1.836 1.04a.516.516 0 01-.367-.15.499.499 0 01-.149-.366c0-.146.05-.266.149-.36a.516.516 0 01.367-.148H12v1.023h-1.836z"})});var d=o(40304);const c=(0,s.IU)("executable",{viewBox:"0 0 23 23.5",svg:(0,r.jsx)("path",{d:"M5.164 16.883c-.37-.209-.651-.448-.844-.719-.187-.276-.28-.69-.28-1.242V8.609c0-.416.08-.763.241-1.039.162-.28.417-.52.766-.718l5.492-3.079c.484-.27.971-.406 1.461-.406.49 0 .974.136 1.453.406l5.492 3.079c.35.197.604.437.766.718.161.276.242.623.242 1.04v6.312c0 .552-.094.966-.281 1.242-.188.27-.469.51-.844.719l-6.047 3.39c-.52.287-1.044.287-1.57 0l-6.047-3.39zm.844-1.203l5.265 2.976v-6.265L5.43 9.094v5.687c0 .203.041.375.125.516.088.14.24.268.453.383zm11.976 0c.214-.115.362-.242.446-.383a.95.95 0 00.133-.516V9.094l-5.844 3.297v6.265l5.265-2.976zM12 11.11l5.773-3.235-4.937-2.781c-.552-.318-1.112-.318-1.68 0l-4.93 2.781L12 11.109z"})}),u=(0,s.IU)("file3D",{viewBox:"0 0 23 24",svg:(0,r.jsx)("path",{d:"M5.648 16.352l5.61-2.82v-6.65h1.492v6.65l5.61 2.82-.75 1.273-5.61-2.82-5.61 2.82-.742-1.273zm-1.945 1.195l1.32-2.985c.105-.25.243-.427.415-.53a.643.643 0 01.539-.071c.187.052.349.198.484.437l1.937 3.352c.146.245.196.46.149.648a.61.61 0 01-.336.43c-.177.1-.404.133-.68.102l-3.242-.36c-.297-.036-.5-.146-.61-.328-.103-.182-.096-.414.024-.695zm16.594 0c.12.281.125.513.015.695-.104.182-.304.292-.601.328l-3.242.36c-.271.03-.498-.003-.68-.102a.634.634 0 01-.344-.43c-.041-.187.01-.403.157-.648l1.937-3.352c.135-.24.294-.385.477-.437a.638.638 0 01.539.07c.177.104.32.281.43.531l1.312 2.985zm-8.89-12.985c.181-.25.377-.372.585-.367.208 0 .404.123.586.367l1.93 2.618c.167.229.252.445.258.648a.596.596 0 01-.204.5c-.14.13-.354.195-.64.195h-3.86c-.276 0-.486-.065-.632-.195a.637.637 0 01-.203-.508c.005-.208.088-.422.25-.64l1.93-2.617z"})});var m=o(52455);const p=(0,s.IU)("font",{viewBox:"0 0 24 24",svg:(0,r.jsx)("path",{d:"M17.008 17.766c-.724 0-1.354-.185-1.89-.555-.537-.37-.957-.888-1.259-1.555-.296-.672-.445-1.458-.445-2.36 0-.895.149-1.676.445-2.343.303-.672.722-1.193 1.258-1.562.537-.375 1.167-.563 1.89-.563.433 0 .834.07 1.204.211.375.14.7.344.977.61.28.26.5.572.656.937h.062V9.64c0-.256.073-.459.219-.61a.738.738 0 01.555-.226c.234 0 .424.075.57.226.146.151.219.354.219.61v7.312c0 .255-.073.453-.219.594a.771.771 0 01-.57.219.773.773 0 01-.547-.203c-.146-.136-.221-.331-.227-.586v-.954h-.062a2.688 2.688 0 01-1.094 1.29c-.495.302-1.076.453-1.742.453zm.453-1.368c.484 0 .906-.125 1.266-.375.364-.255.643-.611.835-1.07.198-.463.297-1.01.297-1.64 0-.63-.099-1.178-.297-1.641-.197-.469-.476-.83-.835-1.086a2.1 2.1 0 00-1.266-.39 2.13 2.13 0 00-1.266.382c-.354.25-.627.607-.82 1.07-.193.464-.29 1.014-.29 1.649s.097 1.185.29 1.648c.193.464.466.823.82 1.078.36.25.782.375 1.266.375zm-14.07 1.32c-.271 0-.485-.072-.641-.218-.151-.146-.227-.349-.227-.61 0-.156.034-.335.102-.538l3.477-9.375C6.33 6.326 6.784 6 7.46 6c.36 0 .651.08.875.242.23.162.404.406.523.735l3.454 9.335c.072.204.109.391.109.563 0 .26-.084.466-.25.617-.162.151-.38.227-.656.227-.26 0-.466-.06-.618-.18-.145-.115-.26-.312-.343-.594l-.867-2.422H5.226l-.868 2.422c-.083.282-.2.48-.351.594-.146.12-.352.18-.617.18zM5.68 13.07h3.57L7.484 7.992h-.039L5.68 13.07z"})});var g=o(87292);const h=(0,s.IU)("presentation",{viewBox:"0 0 24 24",svg:(0,r.jsx)("path",{d:"M6.305 20.703c-.844 0-1.482-.213-1.914-.64-.433-.428-.649-1.06-.649-1.899v-8.031c0-.839.216-1.472.649-1.899.432-.427 1.07-.64 1.914-.64h11.383c.843 0 1.481.216 1.914.648.437.427.656 1.057.656 1.89v8.032c0 .833-.219 1.464-.656 1.89-.433.433-1.07.65-1.915.65H6.306zm.093-1.531h11.196c.36 0 .635-.096.828-.29.198-.187.297-.47.297-.85v-7.766c0-.38-.1-.664-.297-.852-.193-.193-.469-.289-.828-.289H6.398c-.364 0-.643.096-.835.29-.188.187-.282.47-.282.85v7.766c0 .38.094.664.282.852.192.193.47.289.835.289zM5.461 6.32c.057-.37.185-.656.383-.86.203-.202.513-.304.93-.304h10.453c.416 0 .724.102.921.305.204.203.334.49.391.86H5.461zm1.594-2.258c.02-.348.133-.611.336-.789.208-.182.5-.273.875-.273h7.468c.375 0 .664.091.868.273.203.178.32.44.351.79H7.055z"})});var f=o(61646),v=o(62261),x=o(19035),b=o(70691),S=o(53965),y=o(1898),C=o(18265),w=o(65598),j=o(77080),k=o(67926);const M=o(60809),L={doc:d.w,docx:d.w,pages:d.w,md:d.w,txt:d.w,rtf:d.w,xls:f.Y,xlsx:f.Y,csv:f.Y,tsv:f.Y,ods:f.Y,pdf:g.B,pptx:h,ppt:h,zip:l,br:l,bz2:l,gz:l,"7z":l,dmg:l,pkg:l,jar:l,rar:l,tar:l,xar:l,stl:u,obj:u,fbx:u,amf:u,iges:u,mp3:n.l,m4a:n.l,wav:n.l,aac:n.l,ogg:n.l,flac:n.l,alac:n.l,wma:n.l,exe:c,otf:p,ttf:p,woff:p,eof:p,py:a,java:a,js:a,ts:a,tsx:a,c:a,h:a,cpp:a,go:a,rs:a,css:a,php:a,swift:a,kt:a,lua:a,m:a,bash_profile:a,bashrc:a,zshrc:a,vimrc:a,vim:a};function D(e){const t=function(e){if(!e)return"";const{pathname:t}=C.Qc(e);if(!t)return"";const o=t.split(".");return o[o.length-1]}(e).toLowerCase();return L[t]??m.X}let R=function(e){return e[e.Menu=0]="Menu",e[e.Page=1]="Page",e[e.Sidebar=2]="Sidebar",e[e.Margin=3]="Margin",e[e.Unfurl=4]="Unfurl",e}({});function I(e){let{recordStore:t,currentUserId:o,timestamp:i}=e;return K({recordStore:t,currentUserId:o,timestamp:i})||P(t)}const B=6,T=3;function F(e){return e>1?T:B}function Z(e){return e?w.al(e,{recursivelyLoadAllDiscussions:!0,includeLoadingDiscussions:!0}):[]}function _(e){let{blockStore:t,currentUserId:o,ignoreAfterTime:i}=e;if(!t)return[];return w.al(t,{recursivelyLoadAllDiscussions:!0,includeLoadingDiscussions:!0}).sort(((e,t)=>{const n=I({recordStore:e,currentUserId:o,timestamp:i}),s=I({recordStore:t,currentUserId:o,timestamp:i});return null!=n&&n.isDefined()?null!=s&&s.isDefined()?-(n.getCreatedTime()-s.getCreatedTime()):1:-1}))}function A(e,t){return e&&e.isDefined()?t&&t.isDefined()?e.getCreatedTime()-t.getCreatedTime():1:-1}function V(e){return w.D4(e).sort(((e,t)=>A(e,t)))}function P(e){return V(e)[0]}function z(e){return K({recordStore:e,currentUserId:void 0})}function K(e){let{recordStore:t,currentUserId:o,timestamp:i}=e;const n=w.D4(t).filter((e=>j.default.checkGate("comments_pane_improvements")?i?e.isDefined()&&e.getCreatedTime()<i:e.isDefined():e.isDefined()&&e.getCreatedById()!==o)).sort(((e,t)=>A(e,t)));return n[n.length-1]}function E(e){return e.sort(((e,t)=>A(z(e),z(t))))}function W(e){const t=e.state.textStore.getValue(),o=(e.state.files??[]).length>0,i=t&&t.length>0;return!o&&!i}function U(e,t){const o=e.state.textStore.getValue(),i=e.state.files;if(!t)return o&&0!==o.length||i&&i.length>0;const n=w.zP(t).getValue();return!S.Xy(n,o)||function(e,t){const o=e.state.files,i=w.le(t);if(i.length!==o.length)return!0;return i.some(((e,t)=>e.id!==o[t].id))}(e,t)}function N(e){if(e.some((e=>!e.isReady())))return!0;return!!e.map((e=>w.D4(e))).flat().some((e=>!e.isReady()||!e.getCreatedTime()))}function H(e){switch(e){case"block_menu":case"reply_menu_mentions_comments":case"reply_menu_all_updates":case"reply_menu_archive":case"reply_menu_updates_sidebar":case"updates_menu_mentions_comments":case"updates_menu_all_updates":case"updates_menu_archive":return R.Menu;case"page_discussion":return R.Page;case"updates_sidebar":return R.Sidebar;case"margin_comments":return R.Margin;case"comment_unfurl":return R.Unfurl;default:(0,y.t1)(e)}}function O(e){return S.mN(S.VS(e,(e=>w.D4(e).map((e=>({store:e,pointer:e.getCreatedByPointer()}))))),(e=>{var t;return null===(t=e.pointer)||void 0===t?void 0:t.id})).filter((e=>(0,y.$K)(e.pointer))).map((e=>{let{store:t,pointer:o}=e;return k.t.createChildStore(t,o)})).map((e=>e.getModel())).filter(y.$K).map((e=>e instanceof b.T?(0,i.dp)(e):e instanceof x.L?(0,i.D$)(e):e instanceof v.R?(0,i.Jp)(e):void(0,y.t1)(e))).filter(y.$K)}function G(e){var t;if(e.length>1)return!1;const o=e[0];if(!o.length)return!1;const i=o[0].trim(),n=M();return(null===(t=i.match(n))||void 0===t?void 0:t.join(""))===i}const $={updates_menu_all_updates:28,updates_menu_mentions_comments:28,updates_menu_archive:28,block_menu:20,reply_menu_all_updates:20,reply_menu_mentions_comments:20,reply_menu_archive:20,reply_menu_updates_sidebar:20,page_discussion:20,updates_sidebar:23,margin_comments:20,comment_unfurl:32};function q(e){return((null==e?void 0:e.match(/[0-9.]+|[a-z]+/gi))??[]).join(" ")}},72402:(e,t,o)=>{o.d(t,{Z:()=>s});var i=o(35431);class n extends i.Z{}const s=new n},69475:(e,t,o)=>{o.d(t,{A:()=>f,l:()=>v});o(21703),o(57658);var i=o(28084),n=o(68626),s=o(55652),r=o(45953),a=o(21202),l=o(49984),d=o(35092),c=o(12139),u=o(66504),m=o(53965),p=o(52629),g=o(84693);let h=1;class f{constructor(e){let{connection:t,maxSize:o,verifyRecordPointerMismatches:a}=e;this.trackWithDynamicSampling=void 0,this.getLatency=new s.s,this.batchReadWorkers=15,this.connection=void 0,this.maxSize=void 0,this.verifyRecordPointerMismatches=void 0,this.pendingWrites=r.Ao.create(),this.getManyFromDisk=async e=>{const t=r.Ao.create();e.forEach(((e,o)=>{let{pointer:i}=e;t.set(i,o)}));const o=await g.Q6(this.connection,e),i=r.Ao.create();for(const n of o)this.setCachedRecordMap(i,n);return e.map((e=>{let{pointer:t,userId:o}=e;const n=this.getInMemory(t,o);if(n)return n;const s=i.get(t);return s&&s[o]}))},this.diskReadQueue=new i.Z({batchSize:Math.floor(d.mz/3)-1,maxWorkers:this.batchReadWorkers>0?this.batchReadWorkers:1,performRequests:this.getManyFromDisk}),this.flushWrites=async()=>{const e=this.pendingWrites;this.pendingWrites=r.Ao.create();const t=m.VS(Array.from(e),(e=>{let{value:t}=e;return t?Object.values(t):[]}));try{var o;await g.Y3(this.connection,this.maxSize,t),null===(o=this.trackWithDynamicSampling)||void 0===o||o.call(this,{eventName:"sqlite_record_cache.flush_writes",eventProperties:{status:"success"},options:{preboot:!0,defaultSampleRateOverride:0}})}catch(s){var i;n.log({level:"warning",from:"SqliteRecordCache",type:"applyRecordCacheOperationsError",error:{...(0,p.Ui)(s),miscDataString:JSON.stringify(this.getExtraDataForReadOrWriteError(s))}},{forceSuppressConsoleLog:!0}),null===(i=this.trackWithDynamicSampling)||void 0===i||i.call(this,{eventName:"sqlite_record_cache.flush_writes",eventProperties:{status:"error"},options:{preboot:!0,defaultSampleRateOverride:0}})}},this.debouncedFlushWrites=m.Ds(this.flushWrites,500,{maxWait:3e3}),this.connection=t,this.maxSize=o,this.verifyRecordPointerMismatches=a}waitForInitialize(){var e,t;return(null===(e=(t=this.connection).waitForInitialize)||void 0===e?void 0:e.call(t))||Promise.resolve()}set(e,t,o,i,s){if(void 0===e||void 0===e.id){const t=new Error("Attempting to set a record with an invalid pointer.");return n.log({level:"error",from:"SqliteRecordCache",type:"SqliteRecordCache.setBadPointer",error:{message:"Attempting to set a record with an invalid pointer.",stack:t.stack},data:{pointer:e}}),void c.IE(t)}const r={pointer:e,userId:i=i||u.I,value:t,timestamp:Date.now(),importance:o};this.removePendingWrite(e,i,"delete"),this.enqueueWrite({type:"set",record:r,maybeStaleRecord:s})}async get(e,t){const o=`get ${h}`;t=t||u.I,h++,this.getLatency.start(o);try{const a=this.getInMemory(e,t);if(a){var i;if(this.enqueueWrite({type:"access",record:a}),this.getLatency.end(o,"memory"),this.verifyRecordPointerMismatches&&(a.pointer.id!==e.id||a.pointer.table!==e.table||a.value&&a.value.value&&a.value.value.id!==e.id))n.log({level:"warning",from:"SqliteRecordCache.ts",type:"FetchedPointerMismatch",error:(0,p.Ui)(new Error("Value returned does not match pointer when fetching via inMemoryResult")),data:{miscDataToConvertToString:{requestedPointer:e,fetchedPointer:a.pointer,fetchedId:null===(i=a.value)||void 0===i||null===(i=i.value)||void 0===i?void 0:i.id}}});return a.value}const l=await(this.batchReadWorkers>0?this.diskReadQueue.enqueue({pointer:e,userId:t}):this.getFromDiskUnbatched(e,t));if(l){var s,r;if(this.enqueueWrite({type:"access",record:l}),this.getLatency.end(o,"disk"),null===(s=this.trackWithDynamicSampling)||void 0===s||s.call(this,{eventName:"sqlite_record_cache.get_record",eventProperties:{status:"success"},options:{preboot:!0,defaultSampleRateOverride:0}}),this.verifyRecordPointerMismatches&&(l.pointer.id!==e.id||l.pointer.table!==e.table||l.value&&l.value.value&&l.value.value.id!==e.id))n.log({level:"warning",from:"SqliteRecordCache.ts",type:"FetchedPointerMismatch",error:(0,p.Ui)(new Error("Value returned does not match pointer when fetching via diskResult")),data:{miscDataToConvertToString:{requestedPointer:e,fetchedPointer:l.pointer,fetchedId:null===(r=l.value)||void 0===r||null===(r=r.value)||void 0===r?void 0:r.id}}});return l.value&&"comment"===l.pointer.table&&v.commentIds.add(l.pointer.id),l.value&&"notion_user"===l.pointer.table&&v.userIds.add(l.pointer.id),l.value}}catch(l){var a;return n.log({level:"warning",from:"SqliteRecordCache",type:"getError",error:{...(0,p.Ui)(l),miscDataString:JSON.stringify(this.getExtraDataForReadOrWriteError(l))}},{forceSuppressConsoleLog:!0}),void(null===(a=this.trackWithDynamicSampling)||void 0===a||a.call(this,{eventName:"sqlite_record_cache.get_record",eventProperties:{status:"error"},options:{preboot:!0,defaultSampleRateOverride:0}}))}finally{this.getLatency.end(o,"miss")}}deleteRecord(e,t){t=t||u.I,this.removePendingWrite(e,t,"set"),this.enqueueWrite({type:"delete",record:{pointer:e,userId:t}})}async getBlocksWithParent(e){const t=Date.now(),o=e.userId||u.I,i=await g.lR(this.connection,{...e,timestamp:t,userId:o}),n=r.Ao.create(),s=m.oA(Array.from(this.pendingWrites).map((i=>{const s=i&&i.value&&o&&i.value[o];if(!s||"set"!==s.type)return;const r=s.record.value?s.record.value.value:void 0;if(!r)return;if(s.record.pointer.table!==a.iU)return;const l=r;return l.parent_id===e.parent.id&&l.parent_table===e.parent.table?(n.set(s.record.pointer,!0),s.record.timestamp<t&&(s.record.timestamp=t),s.record.value):void 0})));for(const r of i)n.get(r.pointer)||this.getInMemory(r.pointer,r.userId)||s.push(r.value);return s}async getPageBlocksByParent(e){const t=Date.now(),o=e.userId||u.I,i=await g.GF(this.connection,{...e,timestamp:t,userId:o});return i.forEach((e=>{this.enqueueWrite({type:"access",record:{pointer:e.pointer,timestamp:t,userId:o,importance:void 0,value:e.value}})})),i}async reset(){this.pendingWrites=r.Ao.create(),await g.G$(this.connection)}setTrackWithDynamicSampling(e){this.trackWithDynamicSampling=e}enqueueWrite(e){this.debouncedFlushWrites();const{pointer:t,userId:o}=e.record,i=this.pendingWrites.get(t),n=i&&i[o];if(n){if("set"===n.type&&"access"===e.type){const t={type:"set",record:{...n.record,timestamp:e.record.timestamp}};return void this.setCacheOperationMap(this.pendingWrites,t)}const t="set"===n.type&&!n.maybeStaleRecord&&n.record.value&&n.record.value.value?n.record.value.value.version:void 0,o="set"===e.type&&e.maybeStaleRecord&&e.record.value&&e.record.value.value?e.record.value.value.version:void 0;if("number"==typeof t&&"number"==typeof o&&t>=o)return}this.setCacheOperationMap(this.pendingWrites,e)}async getFromDiskUnbatched(e,t){const[o]=await this.getManyFromDisk([{pointer:e,userId:t}]);return o}getInMemory(e,t){const o=this.pendingWrites.get(e),i=o&&o[t];if(i&&"set"===i.type)return i.record}setCacheOperationMap(e,t){const o=t,{pointer:i,userId:n}=o.record,s=e.get(i)||{};e.set(i,{...s,[n]:o})}setCachedRecordMap(e,t){const{pointer:o,userId:i}=t,n=e.get(o)||{};e.set(o,{...n,[i]:t})}removePendingWrite(e,t,o){const i=this.pendingWrites.get(e);i&&i[t]&&i[t].type===o&&this.pendingWrites.delete(e)}getExtraDataForReadOrWriteError(e){return{errorSql:(0,l.l)(e)?e.debugInfo.errorSql:void 0,lastSuccessfulSqlBatch:e instanceof l.q2?e.debugInfo.lastSuccessfulSqlBatch:void 0,sqliteCode:(0,l.l)(e)?e.debugInfo.sqliteCode:void 0}}}const v={commentIds:new Set([]),userIds:new Set([])}},31505:(e,t,o)=>{o.d(t,{Y:()=>s});o(67294);var i=o(45238),n=o(85893);const s=(0,i.IU)("collectionTimelineArrowLeft",{viewBox:"0 0 9 7",svg:(0,n.jsx)("path",{d:"M0 3.5021C0 3.70786 0.0939831 3.93041 0.237195 4.06479L3.11934 6.76065C3.28493 6.91602 3.48633 7 3.67877 7C4.17106 7 4.48881 6.68506 4.48881 6.27774C4.48881 6.03839 4.37245 5.86203 4.22029 5.72345L3.19095 4.77025L2.56887 4.22855L3.47737 4.27055L8.13625 4.27055C8.6554 4.27055 9 3.96401 9 3.5021C9 3.04019 8.6554 2.73365 8.13625 2.73365L3.47737 2.73365L2.56887 2.77564L3.19095 2.23395L4.22029 1.27654C4.37245 1.13377 4.48881 0.961608 4.48881 0.722255C4.48881 0.314937 4.17106 0 3.67877 0C3.48633 0 3.28493 0.0839832 3.11487 0.239352L0.237195 2.93941C0.0939831 3.07378 0 3.29634 0 3.5021Z"})})},39301:(e,t,o)=>{o.d(t,{n:()=>s});o(67294);var i=o(45238),n=o(85893);const s=(0,i.IU)("collectionTimelineArrowRight",{viewBox:"0 0 9 7",svg:(0,n.jsx)("path",{d:"M9 3.4979C9 3.29214 8.90602 3.06959 8.7628 2.93521L5.88066 0.239352C5.71507 0.0839835 5.51368 3.13148e-07 5.32123 2.96324e-07C4.82894 2.53287e-07 4.51119 0.314937 4.51119 0.722256C4.51119 0.961608 4.62755 1.13797 4.77971 1.27654L5.80905 2.22975L6.43113 2.77145L5.52263 2.72945L0.863749 2.72945C0.344604 2.72945 -6.62078e-07 3.03599 -7.02459e-07 3.4979C-7.4284e-07 3.95981 0.344604 4.26635 0.863749 4.26635L5.52263 4.26635L6.43113 4.22436L5.80905 4.76605L4.77971 5.72346C4.62755 5.86623 4.51119 6.03839 4.51119 6.27774C4.51119 6.68506 4.82894 7 5.32123 7C5.51367 7 5.71507 6.91602 5.88513 6.76065L8.7628 4.06059C8.90602 3.92622 9 3.70366 9 3.4979Z"})})},40304:(e,t,o)=>{o.d(t,{w:()=>s});o(67294);var i=o(45238),n=o(85893);const s=(0,i.IU)("document",{viewBox:"0 0 23.5 23.5",svg:(0,n.jsx)("path",{d:"M9.14 8.156a.494.494 0 01-.5-.5c0-.14.047-.258.141-.351a.487.487 0 01.36-.14h5.718a.477.477 0 01.492.492.494.494 0 01-.14.35.464.464 0 01-.352.15H9.141zm0 2.664a.487.487 0 01-.359-.14.504.504 0 01-.14-.36c0-.135.046-.25.14-.343a.487.487 0 01.36-.141h5.718a.477.477 0 01.493.484c0 .14-.047.26-.141.36a.477.477 0 01-.352.14H9.141zm0 2.672a.487.487 0 01-.359-.14.468.468 0 01-.14-.344c0-.14.046-.258.14-.352a.473.473 0 01.36-.148h2.765c.146 0 .266.05.36.148a.48.48 0 01.14.352c0 .135-.047.25-.14.344a.487.487 0 01-.36.14H9.141zm-3.843 4.266V5.968c0-.838.213-1.473.64-1.905.428-.438 1.06-.657 1.899-.657h8.32c.839 0 1.472.219 1.899.656.427.433.64 1.068.64 1.907v11.789c0 .844-.213 1.482-.64 1.914-.427.432-1.06.648-1.899.648h-8.32c-.839 0-1.471-.216-1.899-.648-.427-.432-.64-1.07-.64-1.914zm1.539-.094c0 .36.094.635.281.828.188.193.472.29.852.29h8.062c.38 0 .664-.097.852-.29.187-.193.281-.469.281-.828V6.07c0-.364-.094-.643-.281-.836-.188-.198-.471-.296-.852-.296H7.97c-.38 0-.664.098-.852.296-.187.193-.281.472-.281.836v11.594z"})})},52455:(e,t,o)=>{o.d(t,{X:()=>s});o(67294);var i=o(45238),n=o(85893);const s=(0,i.IU)("fileAttachment",{viewBox:"0 0 28 28",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("rect",{width:"28",height:"28",fill:"none"}),(0,n.jsx)("path",{d:"M7.70703 27.3799H21.2783C23.7412 27.3799 24.9854 26.1104 24.9854 23.6348V11.7266C24.9854 10.3555 24.8076 9.74609 23.9697 8.88281L16.5049 1.3418C15.6924 0.516602 15.0322 0.326172 13.8008 0.326172H7.70703C5.26953 0.326172 4 1.58301 4 4.05859V23.6348C4 26.1104 5.25684 27.3799 7.70703 27.3799ZM7.7832 25.8057C6.32324 25.8057 5.57422 25.0312 5.57422 23.5967V4.09668C5.57422 2.7002 6.32324 1.8877 7.7959 1.8877H13.7246V9.53027C13.7246 10.9775 14.4609 11.6631 15.8701 11.6631H23.4238V23.5967C23.4238 25.0312 22.6621 25.8057 21.2021 25.8057H7.7832ZM16.0352 10.1777C15.4512 10.1777 15.21 9.94922 15.21 9.36523V2.20508L23.1064 10.1777H16.0352Z"})]})})},61646:(e,t,o)=>{o.d(t,{Y:()=>s});o(67294);var i=o(45238),n=o(85893);const s=(0,i.IU)("spreadsheet",{viewBox:"0 0 23 24",svg:(0,n.jsx)("path",{d:"M3.32 10.43V8.96h17.422v1.47H3.32zm0 4.343v-1.468h17.422v1.468H3.32zm7.93 3.758V5.203h1.5v13.328h-1.5zm-5.945.625c-.844 0-1.482-.213-1.914-.64-.433-.427-.649-1.058-.649-1.891V7.109c0-.833.216-1.463.649-1.89.432-.433 1.07-.649 1.914-.649H18.68c.849 0 1.49.216 1.922.649.432.427.648 1.057.648 1.89v9.516c0 .833-.216 1.463-.648 1.89-.433.428-1.073.641-1.922.641H5.305zm.093-1.531h13.196c.36 0 .635-.094.828-.281.193-.193.289-.477.289-.852v-9.25c0-.375-.096-.656-.29-.844-.192-.192-.468-.289-.827-.289H5.398c-.364 0-.643.097-.835.29-.188.187-.282.468-.282.843v9.25c0 .375.094.659.282.852.192.187.47.281.835.281z"})})}}]);