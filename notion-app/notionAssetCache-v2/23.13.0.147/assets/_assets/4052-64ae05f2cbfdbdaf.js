"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[4052],{79474:(e,t,o)=>{o.d(t,{r:()=>i});var n=o(43604);async function i(e){return new Promise((t=>{n.Z.setState({open:!0,onClose:()=>{n.Z.setState({open:!1}),t(!1)},onConfirm:()=>{n.Z.setState({open:!1}),t(!0)},...e})}))}},84654:(e,t,o)=>{o.r(t),o.d(t,{COMPLETION_THROTTLE:()=>ae,acceptCursorCompletion:()=>_e,cancelCompletion:()=>Oe,doesPromptNeedAdditionalUserInput:()=>fe,handleCompletionPopupRetry:()=>ge,improveAssistantCompletion:()=>Pe,improveCompletion:()=>xe,insertBlockSelectionCompletion:()=>We,insertTextSelectionCompletion:()=>Te,maybeSetPromptForCurrentAiBlock:()=>Ke,openCompletionPopupForBlockSelectionContext:()=>de,openCompletionPopupForCursorContext:()=>le,openCompletionPopupForPrefilledContext:()=>ue,openCompletionPopupForSavedContext:()=>pe,postProcessAICreatedStores:()=>Le,redoCompletionRevision:()=>Ee,replaceTextSelectionCompletion:()=>be,revertCurrentCompletionRevision:()=>Be,selectPageAndOpenCompletionPopupForBlockSelectionContext:()=>ce,showCompletionErrorWithCode:()=>Ce,stopCompletion:()=>Re,submitFeedbackForRevision:()=>qe,triggerCompletionForAiBlock:()=>Me,updateAiEligibility:()=>ze});o(21703),o(57658),o(30541);var n=o(26263),i=o(1302),r=o(41432),a=o(68626),s=o(42875),l=o(482),c=o(29299),d=o(82883),p=o(3791),u=o(70203),m=o(95371),f=o(98151),g=o(53965),y=o(7032),h=o(1898),v=o(10910),C=o(54642),k=o(893),I=o(47307),S=o(94419),x=o(9953),P=o(24677),w=o(64964),M=o(993),A=o(98104),_=o(29373),F=o(13447),T=o(56518),b=o(78663),L=o(99417),W=o(96318),R=o(43455),N=o(33929),E=o(45162),B=o(46654),O=o(65598),U=o(77546),Z=o(69645),H=o(73959),V=o(89224),j=o(89086),D=o(77907),z=o(95802),q=o(80444),K=o(21273),G=o(98180),$=o(16772),X=o(77080),Y=o(6258),Q=o(27724),J=o(44041),ee=o(35057),te=o(28956),oe=o(92022),ne=o(71184),ie=o(63594),re=o(30793);const ae=300,se=1001;async function le(e){const{environment:t,prompt:o=L.NX,additionalContext:n,from:i}=e,r=(0,b.FD)();r&&await me({environment:t,prompt:o,context:r,additionalContext:n,from:i})}async function ce(e){const t=P.aw(P.KX()),o=(0,E.W9)(t);if(!o)return;A.NA({multiSelection:o});const n=(0,b.Fu)();if(!n)return;const i={type:"closedWithContext",context:n,futureRevisions:[]};$.default.setState(i),await pe(e)}async function de(e){const{environment:t,prompt:o=L.NX,additionalContext:n,from:i}=e,r=(0,b.Xc)();r&&await me({environment:t,prompt:o,context:r,additionalContext:n,from:i})}async function pe(e){"closedWithContext"===$.default.state.type&&$.default.state.context&&await me({...e,context:$.default.state.context})}async function ue(e){await me(e)}async function me(e){const{environment:t,prompt:o,context:r,additionalContext:a,skipInitialForm:s,from:l}=e,c=$.default.getExistingSessionId(),d=c??(0,y.ZP)();if(fe({clientPrompt:o,additionalContext:a})&&!s)return void(0,oe.toggleInitialPrompt)({environment:t,from:l,prefilledValue:(0,b.$W)(o),promptForAnalytics:o,sessionId:d,context:r});Boolean(c)||v.Tl(t,{session_id:d,prompt_key:o.key,from:l}),A.ZH(t);if(K.Z.isAssistantInWriterEnabled(t.device)){const{assistantWriterActions:e}=await D.deps.assistantWriter.loader();e.triggerAssistantCompletion({environment:t,context:r,prompt:o,intl:N.default.getIntl(),updater:$.default.createUpdater(),additionalContext:a,sessionId:d,from:l})}else await async function(e){const{environment:t,context:o,prompt:r,additionalContext:a,updater:s,sessionId:l,from:c}=e;"textSelection"===o.type&&s((()=>{A.ZH(t),P.ZH(t)}));const d=await D.deps.markdownLinkifyIt.loader(),{serverPrompt:p}=ye({...e,markdownLinkifyIt:d}),u=new n.Z({name:"completionActions.triggerCompletion",isTemporaryData:!0});s((()=>{t.defaultRecordCache.inMemoryRecordCache.addCacheOverride(u)}));const m=$.default.state,f="completionPopup"===m.type&&"initialPrompt"===m.stage||"closedWithContext"===m.type?m.futureRevisions:[],g={type:"completionPopup",stage:"results",loading:!0,sessionId:l,revisions:[...f,{type:"initial",clientPrompt:r,serverPrompt:p,additionalContext:a,userSearchCache:new Map,completion:void 0,hasFeedback:!1}],futureRevisions:[],context:o,inMemoryRecordCache:u,from:c,hasErrored:!1};s((()=>{$.default.setState(g)})),await i.default.afterNextFlush(),await s((()=>Ae({environment:t}))),await he({...e,updater:s})}({environment:t,context:r,prompt:o,intl:N.default.getIntl(),updater:$.default.createUpdater(),additionalContext:a,sessionId:d,from:l})}function fe(e){const{clientPrompt:t,additionalContext:o}=e,n="translate"===t.key&&o&&o.language,i="changeTone"===t.key&&o&&o.tone;return Boolean(!n&&!i&&t.steps)}async function ge(e){const{environment:t}=e,o=$.default.state;if("completionPopup"===o.type&&"results"===o.stage)if(A.ZH(t),fe((0,L.Iz)(o)));else{const e=(0,L.Iz)(o);$.default.setState({...o,revisions:[...o.revisions,{type:"initial",clientPrompt:e.clientPrompt,serverPrompt:e.serverPrompt,additionalContext:e.additionalContext,userSearchCache:new Map,completion:void 0,hasFeedback:!1}]}),await he({environment:t,updater:$.default.createUpdater()})}}function ye(e){const{environment:t,context:o,prompt:n,additionalContext:i,intl:r,markdownLinkifyIt:a}=e,l=(0,d.X)({intl:r,textValue:o.currentPage.getBlockTitleStore().getValue(),getRecordModel:o.currentPage.getRecordModel,userTimeZone:(0,s.r)()}),{previousContent:c,restContent:p,pageContent:u}=function(e){var t,o;const{environment:n,context:i,markdownLinkifyIt:r}=e,a=i.currentPage.getContentStores()[0];let s,l;if("cursor"===i.type||"textSelection"===i.type)s=i.textSelection.start,l=i.textSelection.end;else{var c;s={store:i.stores[0].getBlockTitleStore(),index:0};const e=i.stores[i.stores.length-1].getBlockTitleStore();l={store:e,index:(null===(c=(0,j.x0)(e))||void 0===c?void 0:c.endIndex)||0}}const d=Ze(i.currentPage),p=k.wc({environment:n,textSelection:{start:{store:a.getBlockTitleStore(),index:0},end:l},markdownSerializationOptions:(0,R.KF)(),markdownLinkifyIt:r}),u=[d,p].filter(h.$K).join("\n\n"),f=(0,Z.Bj)({includeNonSelectableListContainer:!1}),g=null===(t=(0,m.CY)(f).value)||void 0===t?void 0:t.store,y=null==g?void 0:g.getBlockTitleStore(),v=y&&k.wc({environment:n,textSelection:{start:s,end:{store:y,index:(null===(o=(0,j.x0)(y))||void 0===o?void 0:o.endIndex)||0}},markdownSerializationOptions:(0,R.KF)(),markdownLinkifyIt:r})||"",C=He({environment:n,page:i.currentPage,markdownLinkifyIt:r})||"";return{previousContent:u,restContent:v,pageContent:C}}({environment:t,context:o,markdownLinkifyIt:a});let f,y;if("textSelection"===o.type||"blockSelection"===o.type){if("textSelection"===o.type)y=k.wc({environment:t,textSelection:o.textSelection,markdownSerializationOptions:(0,R.KF)(),markdownLinkifyIt:a})??"";else if("blockSelection"===o.type){const e=g.oA(Q.default.state.stores.map((e=>e.getValue())));y=(0,T.X4)({rootBlock:{...o.currentPage.pointer,spaceId:o.currentPage.getSpaceId()},blockValues:e,isWindows:t.device.isWindows,getRecordValue:o.currentPage.getRecordValue,markdownSerializationOptions:(0,R.KF)(),markdownLinkifyIt:a}).markdown||""}else(0,h.t1)(o);f=Ve({prompt:n,selectedText:y,pageTitle:l,pageContent:u,additionalContext:i}),f||(f=De({prompt:n,pageTitle:l,previousContent:c,restContent:p,pageContent:u,additionalContext:i}))}else"cursor"===o.type?(f=De({prompt:n,pageTitle:l,previousContent:c,restContent:p,pageContent:u,additionalContext:i}),f||(f=Ve({prompt:n,selectedText:u,pageTitle:l,additionalContext:i,pageContent:u}))):(0,h.t1)(o);if(!f)throw new Error(`Unable to find server prompt for "${n.key}" client prompt`);const v={type:"initial",pageTitle:l,selectedText:y,pageContent:u};return{serverPrompt:f.serverPrompt,initialStep:v,humanStep:f.humanStep}}async function he(e){const{environment:t,updater:o}=e,n=$.default.state;if("completionPopup"!==n.type||"results"!==n.stage)return;const{sessionId:i}=n,r=Date.now(),a=(0,y.ZP)(),s=(0,L.Iz)(n);if(n.revisions[n.revisions.length-1]!==s)throw new Error("Assertion failure, expected current revision to be initial revision");const l={...s,inferenceId:a},c=n.revisions.slice(0,n.revisions.length-1),{serverPrompt:d}=l;v.g_(t,{session_id:i,inference_id:a,from:n.from,prompt_key:l.clientPrompt.key,type:"completion"}),o((()=>{$.default.setState({...n,loading:!0,revisions:[...c,l]})}));let p=!1;const u=g.P2((async()=>{p||await o((()=>Ae({environment:t,setSelection:!1})))}),ae),m=async function(e,t,o){if(!X.default.checkGate("ai_favorites"))return;const{currentSpaceStore:n}=q.default.getState();if(!n)return;if(!t.trim())return;const i=await C.getCompletion(e,{id:(0,y.ZP)(),aiSessionId:o,context:{type:"promptTitle",selectedText:t},model:"default",metadata:{},spaceId:n.id,isSpacePermission:!1});if("success"!==i.type)return;const r=[];if(f.H1.is(i.data))for await(const s of i.data){if("success"!==s.type)return;r.push(s.completion)}const a=r.join("").trim();return a||void 0}(t,(0,L.gY)(s),i),h=ke({environment:t,inferenceId:a,aiSessionId:i,serverPrompt:d,targetStore:n.context.currentPage,inferenceReason:"writer",attribution:{blockId:n.context.currentPage.id},metadata:{blockId:n.context.currentPage.id},onUpdate(e){let{completion:t,userSearchCache:n}=e;o((()=>{const e=$.default.state;"completionPopup"===e.type&&"results"===e.stage&&($.default.setState({...e,revisions:[...c,{...l,completion:t,userSearchCache:n}]}),u())}))}}),[k,I]=await Promise.all([m,h]);if("error_modal_shown"===I.type||"upsell_modal_shown"===I.type)return void o((()=>Ne()));p=!0;const{completion:S,userSearchCache:x}=I;await o((()=>{v.WP(t,{session_id:i,inference_id:a,preview_time:Date.now()-r,type:"completion"});const e=$.default.state;if("completionPopup"===e.type&&"results"===e.stage)return $.default.setState({...e,revisions:[...c,{...l,completion:S,userSearchCache:x,promptTitle:k}],loading:!1}),Ae({environment:t,setSelection:!0})}))}function ve(e){const{environment:t,inMemoryRecordCache:o,completion:n,userSearchCache:i,store:r,prompt:a,additionalContext:s,isComplete:d,markdownLinkifyIt:p,tinyMceMicrosoftWordPasteFilter:m}=e;F.createAndCommit({userAction:"completionActions.updateAiBlockForCompletion",environment:t,perform:e=>{const f=r.clone(o);f.getContentIds().forEach((t=>{F.applyOperation({store:f,operation:(0,c.$j)({blockParentId:f.id,recordId:t}),transaction:e})}));const g=k.Mt({environment:t,text:n,inMemoryRecordCache:o,transaction:e,markdownOptions:(0,R.N9)(i),markdownLinkifyIt:p,tinyMceMicrosoftWordPasteFilter:m,useCrdt:f.useCrdt()});if(!g)return;const y=f.getContentStore();g.reverse().forEach((t=>{S.Ce({parent:y,prepend:t,transaction:e}),x.sW({store:t,data:{parent_id:f.id,parent_table:f.table,alive:!0},transaction:e})})),F.applyOperation({store:f,operation:l.op.update({pointer:f.pointer,path:["format"],args:{ai_last_edited:Date.now(),ai_prompt_key:a.key}}),transaction:e});const h=s?(0,u.TPx)(s.prompt):[];M.sO({environment:t,editorMode:"default",store:f.getBlockTitleStore(),value:h,transaction:e}),d&&je({transaction:e,completionState:{clientPrompt:a,additionalContext:s}})}})}function Ce(e){const t=N.default.getIntl();return 451===e?w.oV({label:t.formatMessage({id:"completionActions.moderationError",defaultMessage:"AI does not allow content that is harmful or illegal. Please revise your input and try again. (451)"})}):502===e||503===e||504===e?w.oV({label:t.formatMessage({id:"completionActions.providerError",defaultMessage:"We’re experiencing issues with our AI provider. Try again in a few minutes. ({errorCode})"},{errorCode:e})}):void w.oV({label:t.formatMessage({id:"completionActions.genericError",defaultMessage:"AI is temporarily unavailable. Try again in a few minutes. ({errorCode})"},{errorCode:e})})}async function ke(e){var t;const{environment:o,inferenceId:n,serverPrompt:i,targetStore:r,onUpdate:s,aiSessionId:l,metadata:c,attribution:d,inferenceReason:u}=e,m=W.mw()?W.SA:C.getCompletion,g=null===(t=q.default.state.currentSpaceStore)||void 0===t?void 0:t.id,y=(0,B.UK)(r);if(!g)return Ce(se),{type:"error_modal_shown"};const h=await m(o,{id:n,context:i,model:"default",spaceId:g,isSpacePermission:y,aiSessionId:l,metadata:c,attributionForLogging:d,inferenceReason:u});if("success"!==h.type)return I.showError(h),{type:"error_modal_shown"};let k="",S="";const x=new Map,P=await D.deps.searchActions.loader(),w=e=>P.searchVisibleSpaceUsers({environment:o,query:e,membersOnly:!0});if(f.H1.is(h.data))for await(const a of h.data)if("success"===a.type)k+=a.completion,(0,R.Ie)(k)||(S=Ie(k),await(0,R.$A)(k,w,x)),s({completion:S,userSearchCache:new Map(x)});else if("error"===a.type)return(0,p.lX)(a.errorCode)?(J.y(o,{from:"ai_limit_in_app",for:(0,ee.zt)(),addOnFeature:"ai"}),{type:"upsell_modal_shown"}):(Ce(a.errorCode),{type:"error_modal_shown"});const M=Ie(k);return M?(await(0,R.$A)(M,w,x),{type:"success",completion:M,userSearchCache:new Map(x)}):(Ce(600),a.log({level:"error",from:"completionActions.getCompletionWithPostProcessing",type:"emptyResponse",data:{inferenceId:n}}),v.UD(o,{promptKey:i.type}),{type:"error_modal_shown"})}function Ie(e){return e.replace(/<br>/g,"\n")}function Se(e){const{improvement:t}=e;return"continueWriting"===t.type?{type:"human",prompt:"Continue writing"}:"makeLonger"===t.type?{type:"human",prompt:"Make longer"}:"helpMeEdit"===t.type?{type:"human",prompt:t.prompt}:void(0,h.t1)(t.type)}async function xe(e,t){const o=$.default.state;if("completionPopup"!==o.type||"results"!==o.stage)return;let n=!1;const i=$.default.createUpdater(),r=(0,L.xM)(o);if(!r.completion)return;const a=o.context,s=r.completion,l="continueWriting"===t.type?s:"",c=Date.now(),d=(0,y.ZP)();v.g_(e,{session_id:o.sessionId,inference_id:d,from:o.from,prompt_key:(0,L.Iz)(o).clientPrompt.key,improvement_prompt_type:t.type,type:"follow_up_improvement"});const p=[...o.revisions,...o.futureRevisions],u={type:"followup",improvement:t,completion:l,userSearchCache:new Map,inferenceId:d,hasFeedback:!1,previousRevision:(0,L.HS)(o)},m={...o,loading:!0,revisions:[...p,u],futureRevisions:[]},f=await D.deps.markdownLinkifyIt.loader(),C=function(e){const{environment:t,completionState:o,markdownLinkifyIt:n}=e,{context:i}=o,r=[];for(const a of(0,L.zU)(o))if("initial"===a.type){const{initialStep:e,humanStep:o}=ye({environment:t,context:i,prompt:a.clientPrompt,additionalContext:a.additionalContext,intl:N.default.getIntl(),markdownLinkifyIt:n});if(void 0===a.completion)throw new Error("Assertion failure, followup without initial completion");r.unshift(e,o,{type:"assistant",result:a.completion})}else if("followup"===a.type){const e=[Se({improvement:a.improvement})];a.completion&&e.push({type:"assistant",result:a.completion}),r.unshift(...e)}else(0,h.t1)(a);W.mw()&&console.log("Transcript",JSON.stringify(r,null,2));return{type:"writerFollowup",transcript:r}}({environment:e,completionState:m,markdownLinkifyIt:f});i((()=>{$.default.setState(m)}));const k=g.P2((async()=>{n||await i((()=>Ae({environment:e,setSelection:!1})))}),ae),I=await ke({environment:e,inferenceId:d,serverPrompt:C,targetStore:a.currentPage,aiSessionId:o.sessionId,inferenceReason:"writer",attribution:{blockId:o.context.currentPage.id},metadata:{blockId:a.currentPage.id},onUpdate(e){let{completion:t,userSearchCache:o}=e;i((()=>{const e=$.default.state;"completionPopup"===e.type&&"results"===e.stage&&($.default.setState({...e,revisions:[...p,{...u,completion:l+t,userSearchCache:o}]}),k())}))}});if("error_modal_shown"===I.type||"upsell_modal_shown"===I.type)return void i((()=>Ne()));n=!0;const{completion:S,userSearchCache:x}=I;i((()=>{v.WP(e,{session_id:m.sessionId,inference_id:d,preview_time:Date.now()-c,type:"follow_up_improvement"}),$.default.setState({...m,loading:!1,revisions:[...p,{...u,completion:l+S,userSearchCache:x}]}),Ae({environment:e,setSelection:!0})}))}async function Pe(e,t){const o=$.default.state;if("assistantCompletionPopup"!==o.type||"results"!==o.stage)return;const n=$.default.createUpdater();if("helpMeEdit"!==t.type)throw new Error("Improvements other than helpMeEdit are not supported");const{assistantActions:i}=await D.deps.assistant.loader(),r=G.Z.getActiveSessionId();if(!r)throw new Error("No active assistant session");await i.commitHumanStep({environment:e,text:(0,u.TPx)(t.prompt),sessionId:r}),await n((()=>{const e=$.default.state;if("assistantCompletionPopup"!==e.type||"results"!==e.stage)return;const t=g.Z$(Q.default.state.stores);$.default.setState({...e,context:{...e.context,origin:t||e.context.origin},loading:!1})}))}const we=(0,h.AO)((e=>e instanceof Y.G?{true:e}:{false:e}));async function Me(e){const{environment:t,store:o,prompt:i,additionalContext:r}=e,a=o.getRecordStoreUIRoot();if(!we(a))return;const l=await D.deps.markdownLinkifyIt.loader(),c=function(e){const{environment:t,rootStore:o,store:n,prompt:i,additionalContext:r,markdownLinkifyIt:a}=e,l=N.default.getIntl(),c=(0,d.X)({intl:l,textValue:o.getBlockTitleStore().getValue(),getRecordModel:o.getRecordModel,userTimeZone:(0,s.r)()}),p=He({environment:t,page:o,markdownLinkifyIt:a})||"";if("summarizeMeetingTranscript"===i.key)return{type:"summarizeMeetingTranscript",pageTitle:c,pageContent:p};if("helpMeWrite"===i.key){var u,f,g,y,v;const e={type:"helpMeWrite",pageTitle:c,pageContent:p,prompt:(null==r?void 0:r.prompt)??""},i=(0,Z.dq)({includeNonSelectableListContainer:!1,root:n.getHighestContentBlockUIAncestor()});if(!i)return e;const s=(0,Z.v5)(n,i.children);if(!s)return e;const l=o.getContentStores()[0],d=(0,m.YL)(i,s),C=d.prev?d.prev.value.store.getBlockTitleStore():null===(u=d.parent)||void 0===u?void 0:u.value.store.getBlockTitleStore(),I=l&&C&&k.wc({environment:t,textSelection:{start:{store:l.getBlockTitleStore(),index:0},end:{store:C,index:(null===(f=(0,j.x0)(C))||void 0===f?void 0:f.endIndex)??0}},markdownSerializationOptions:(0,R.KF)(),markdownLinkifyIt:a})||"",S=[Ze(o),I].filter(h.$K).join("\n\n"),x=null===(g=(0,m.Xf)(i,s).next)||void 0===g?void 0:g.value.store.getBlockTitleStore(),P=null===(y=(0,m.CY)(i).value)||void 0===y?void 0:y.store,w=null==P?void 0:P.getBlockTitleStore();return{type:"helpMeWrite",pageTitle:c,previousContent:S,restContent:x&&w&&k.wc({environment:t,textSelection:{start:{store:x,index:0},end:{store:w,index:(null===(v=(0,j.x0)(w))||void 0===v?void 0:v.endIndex)||0}},markdownSerializationOptions:(0,R.KF)(),markdownLinkifyIt:a})||"",prompt:(null==r?void 0:r.prompt)??""}}return"summarize"===i.key||"findActionItems"===i.key?{type:i.key,pageTitle:c,selectedText:p}:void 0}({environment:t,rootStore:a,store:o,prompt:i,additionalContext:r,markdownLinkifyIt:l});if(!c)return;const p=g.P2(ve,ae),u=new n.Z({name:"completionActions.triggerCompletionForAiBlock",isTemporaryData:!0});t.defaultRecordCache.inMemoryRecordCache.addCacheOverride(u);const f=await D.deps.tinyMceMicrosoftWordPasteFilter.loader(),v=await ke({environment:t,inferenceId:(0,y.ZP)(),serverPrompt:c,targetStore:a,aiSessionId:(0,y.ZP)(),metadata:{blockId:a.id},inferenceReason:"writer",attribution:{blockId:a.id},onUpdate(e){let{completion:n,userSearchCache:a}=e;p({inMemoryRecordCache:u,environment:t,store:o,completion:n,userSearchCache:a,prompt:i,additionalContext:r,isComplete:!1,markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:f})}});if(t.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(u),"error_modal_shown"===v.type||"upsell_modal_shown"===v.type)return;const{completion:C,userSearchCache:I}=v;ve({environment:t,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,store:o,completion:C,userSearchCache:I,prompt:i,additionalContext:r,isComplete:!0,markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:f})}async function Ae(e){const{environment:t,setSelection:o}=e,n=$.default.state;if("completionPopup"!==n.type||"results"!==n.stage)return;const r=(0,L.xM)(n),{completion:a,userSearchCache:s}=r,{context:l,inMemoryRecordCache:c}=n;if("cursor"!==l.type)return;c.clearCache();const{currentBlock:d,currentParent:p,currentPage:m}=l,f=p||m.getContentStore(),{insertTitle:y,insertCompletion:h}=Fe({completion:a||"",currentPage:m});y&&F.createAndCommit({userAction:"completionActions.temporaryInsertion.insertTitle",environment:t,canUndo:!1,perform:e=>{const o=m.clone(c).getBlockTitleStore();o&&M.sO({environment:t,editorMode:"default",store:o,value:(0,u.TPx)(y),transaction:e})}});const[v,C]=await Promise.all([D.deps.markdownLinkifyIt.loader(),D.deps.tinyMceMicrosoftWordPasteFilter.loader()]);if(h){const e=F.createAndCommit({userAction:"completionActions.temporaryInsertion.insertCompletion",environment:t,canUndo:!1,perform:e=>{if(!h)return;const o=k.Mt({environment:t,text:h,inMemoryRecordCache:c,transaction:e,markdownOptions:(0,R.N9)(s),markdownLinkifyIt:v,tinyMceMicrosoftWordPasteFilter:C,useCrdt:!1});if(!o)return;Le(t,o);Ue({parentStore:f.clone(c),insertAfter:null==d?void 0:d.clone(c),insertStores:o,transaction:e});return o.map((e=>e.clone(t.defaultRecordCache.inMemoryRecordCache))).map((e=>e.cloneWithNewUIParent(f)))}}).performResult;if(!e||!e.length)return;o&&P.Z5({environment:t,stores:e}),await i.default.afterNextFlush();const n=$.default.state;if("completionPopup"!==n.type||"results"!==n.stage)return;const r=g.oA(e.map((e=>z.C.findNodeFromStore(e))));if(!(r[0]?(0,U.VW)(r[0]):void 0))return;$.default.setState({...n,context:{...n.context,origin:g.Z$(e)}})}else if(d){const e=(0,L.Ah)(d),i=new DOMRect(null==e?void 0:e.x,null==e?void 0:e.y,null==e?void 0:e.width,0);F.createAndCommit({userAction:"completionActions.temporaryInsertion.insertCompletionStores",environment:t,canUndo:!1,perform:e=>{Ue({parentStore:f.clone(c),insertAfter:d.clone(c),insertStores:[],transaction:e})}}),o&&P.ZH(t),d.getAlive()?$.default.setState({...n,context:{...l,origin:d}}):$.default.setState({...n,context:{...l,origin:i}})}}function _e(e){var t;const{environment:o,transaction:n,selectInsertion:a,exitType:s,markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:d}=e,p=$.default.state;if($.default.invalidateLastUpdater(),"completionPopup"!==p.type||"results"!==p.stage||"cursor"!==p.context.type)return;const{completion:m,userSearchCache:f,inferenceId:g}=(0,L.xM)(p);if(!m)return;const{currentBlock:y,currentParent:h,currentPage:C}=p.context,I=h||C.getContentStore();$.default.resetStore(e);const{insertTitle:w,insertCompletion:_}=Fe({completion:m,currentPage:C});w&&"convert_to_ai_block"!==s&&M.sO({environment:o,editorMode:"default",store:C.getBlockTitleStore(),value:(0,u.TPx)(w),transaction:n});const T=(null===(t=(0,H.sQ)(I))||void 0===t?void 0:t.useCrdt())??!1,b=k.Mt({environment:o,text:_,inMemoryRecordCache:o.defaultRecordCache.inMemoryRecordCache,transaction:n,markdownOptions:(0,R.N9)(f),markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:d,useCrdt:T});if(b){if(y&&"convert_to_ai_block"===s){var W;const e=x.j4({environment:o,type:r.Ti.aiBlock,inMemoryRecordCache:y.inMemoryRecordCache,transaction:n,spaceId:y.pointer.spaceId,useCrdt:T});S.BE({parent:I,after:y,insert:e,transaction:n}),(0,O.PF)(y)&&S.Od({parent:I,childToRemove:y,transaction:n});const t=(0,L.xM)(p);if("initial"!==t.type)throw new Error("Assertion failure, currentRevision.type is not initial");const i=null===(W=t.additionalContext)||void 0===W?void 0:W.prompt;i&&F.applyOperation({store:e,operation:l.op.set({pointer:e.pointer,path:["properties","title"],args:[[i]]}),transaction:n}),F.applyOperation({store:e,operation:l.op.update({pointer:e.pointer,path:["format"],args:{ai_last_edited:Date.now(),ai_prompt_key:t.clientPrompt.key}}),transaction:n}),Ue({parentStore:e.getContentStore(),insertAfter:void 0,insertStores:b,transaction:n})}else Ue({parentStore:I,insertAfter:y,insertStores:b,transaction:n}),function(e){const{environment:t,parentStore:o,insertStores:n,selectInsertion:r}=e,a=n.map((e=>e.cloneWithNewUIParent(o)));i.default.afterNextFlush((()=>{P.yu({environment:t,stores:a}),r&&function(e){const{environment:t,insertedStores:o}=e;V.clear(t),i.default.afterNextFlush((()=>{const e=(0,E.W9)(o);e&&A.NA({multiSelection:e})}))}({environment:t,insertedStores:a})}))}({environment:o,parentStore:I,insertStores:b,selectInsertion:a});je({transaction:n,completionState:(0,L.Iz)(p)}),g&&v.NF(o,{type:"cursor_completion",inference_id:g,feedback_type:"accept",timestamp:(new Date).toUTCString()})}}function Fe(e){const{completion:t,currentPage:o}=e;let n,i;const r=Boolean(o.getBlockTitleStore().getValue()),a=o.getContentStores().every((e=>{var t;return!(null!==(t=e.getTitleStore())&&void 0!==t&&t.getValue())}));if(!r&&a){const{title:e,content:o}=function(e){const t=e.trim().split("\n"),o=t[0];return o.startsWith("# ")?{title:o.substring(2),content:t.slice(1).join("\n")}:{title:"",content:e}}(t||"");n=e,i=o}else i=t;return{insertTitle:n,insertCompletion:i}}function Te(e){var t,o;const{environment:n,transaction:i,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:a}=e,s=$.default.state;if($.default.invalidateLastUpdater(),"completionPopup"!==s.type||"results"!==s.stage||"textSelection"!==s.context.type)return;const{completion:l,userSearchCache:c}=(0,L.xM)(s);if(!l)return;const{endBlock:d,endBlockParent:p,currentPage:m}=s.context,f=p||m.getContentStore();$.default.resetStore(e);const y=k.Mt({environment:n,text:l,inMemoryRecordCache:n.defaultRecordCache.inMemoryRecordCache,transaction:i,markdownOptions:(0,R.N9)(c),markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:a,useCrdt:d.useCrdt()});if(!y)return;Ue({parentStore:f,insertAfter:d,insertStores:y,transaction:i}),je({transaction:i,completionState:(0,L.Iz)(s)});const h=y.map((e=>e.cloneWithNewUIParent(f))),v=null===(t=g.Ps(h))||void 0===t?void 0:t.getBlockTitleStore(),C=null===(o=g.Z$(h))||void 0===o?void 0:o.getBlockTitleStore();v&&C&&A.NA({multiSelection:{start:{index:0,store:v},end:{index:C.getValue()?u.QaF(C.getValue()).length:0,store:C}}})}function be(e){const{environment:t,transaction:o,markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:i}=e,r=$.default.state;if($.default.invalidateLastUpdater(),"completionPopup"!==r.type||"results"!==r.stage||"textSelection"!==r.context.type)return;const a=(0,L.xM)(r);a.completion&&(A.NA({multiSelection:r.context.textSelection}),k.R$({environment:t,text:a.completion,transaction:o,disableEmbedMenu:!0,overwrite:!0,selectAll:!0,markdownOptions:(0,R.N9)(a.userSearchCache),markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:i}),je({transaction:o,completionState:(0,L.Iz)(r)}),$.default.resetStore(e))}function Le(e,t){for(const o of t)_.X_(e,o)}function We(e){const{environment:t,transaction:o,replace:n,markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:r}=e,a=$.default.state;if($.default.invalidateLastUpdater(),"completionPopup"!==a.type||"results"!==a.stage||"blockSelection"!==a.context.type)return;const{completion:s,userSearchCache:l}=(0,L.xM)(a);if(!s)return;const{stores:c}=a.context,d=g.Z$(c);if(!d)return;const p=d.getRecordStoreUIParent();if(!p)return;$.default.resetStore(e);const u=k.Mt({environment:t,text:s,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,transaction:o,markdownOptions:(0,R.N9)(l),markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:r,useCrdt:d.useCrdt()});if(!u)return;if(Ue({parentStore:p,insertAfter:d,insertStores:u,transaction:o}),n)for(const f of c){const e=f.getRecordStoreUIParent();e&&S.Od({parent:e,childToRemove:f,transaction:o})}je({transaction:o,completionState:(0,L.Iz)(a)});const m=u.map((e=>e.cloneWithNewUIParent(p)));P.Z5({environment:t,stores:m})}function Re(e){const t=$.default.state;if("completionPopup"!==t.type||"results"!==t.stage||!t.loading)return;const o=(0,L.xM)(t);o.completion&&(v.zi(e,{session_id:t.sessionId,inference_id:o.inferenceId}),$.default.invalidateLastUpdater(),$.default.setState({...t,loading:!1}),Ae({environment:e,setSelection:!0}))}function Ne(){const e=$.default.state;"completionPopup"===e.type&&"results"===e.stage&&$.default.setState({...e,hasErrored:!0})}function Ee(e){const t=$.default.state;"completionPopup"===t.type&&"results"===t.stage&&0!==t.futureRevisions.length&&($.default.invalidateLastUpdater(),$.default.setState({...t,hasErrored:!1,loading:!1,revisions:[...t.revisions,t.futureRevisions[0]],futureRevisions:t.futureRevisions.slice(1)}),Ae({environment:e,setSelection:!0}))}function Be(e){const{environment:t,purgeFromHistory:o}=e,n=$.default.state;if("completionPopup"!==n.type||"results"!==n.stage||0===n.revisions.length)return;const i=n.revisions[n.revisions.length-1];return $.default.invalidateLastUpdater(),$.default.setState({...n,hasErrored:!1,loading:!1,revisions:n.revisions.slice(0,-1),futureRevisions:o?n.futureRevisions:[i,...n.futureRevisions]}),Ae({environment:t,setSelection:!0}),i}function Oe(e){$.default.invalidateLastUpdater();const{environment:t,sessionId:o,inferenceId:n,exitType:i}=e,r=$.default.state;if("completionPopup"!==r.type||"initialPromptForAIBlock"===r.stage)return;if((!t.device.isMobileNative||"error_modal"!==i&&"upsell_modal"!==i)&&("cursor"===r.context.type||"textSelection"===r.context.type?A.NA({multiSelection:r.context.textSelection}):"blockSelection"===r.context.type?P.Z5({environment:t,stores:r.context.stores}):(0,h.t1)(r.context)),$.default.resetStore(e),v.HC(t,{session_id:o,inference_id:n,exit_type:i}),"results"!==r.stage)return;const a=(0,L.xM)(r);a.inferenceId&&v.NF(t,{type:"cursor_completion",inference_id:a.inferenceId,feedback_type:"cancel",timestamp:(new Date).toUTCString()})}function Ue(e){const{parentStore:t,insertAfter:o,insertStores:n,transaction:i}=e,r=g.d9(n).reverse();for(const a of r)o?S.BE({parent:t,insert:a,after:o,transaction:i}):S.Ce({parent:t,prepend:a,transaction:i}),x.sW({store:a,data:{parent_id:t.id,parent_table:t.table,alive:!0},transaction:i});o&&(0,O.PF)(o)&&S.Od({parent:t,childToRemove:o,transaction:i})}function Ze(e){return k.jm({rootBlock:{...e.pointer,spaceId:e.getSpaceId()},getRecordValue:e.getRecordValue})}function He(e){const{environment:t,page:o,markdownLinkifyIt:n}=e,i=g.oA(o.getContentStores().map((e=>e.getValue())));return[Ze(o),(0,T.X4)({rootBlock:{...o.pointer,spaceId:o.getSpaceId()},getRecordValue:o.getRecordValue,blockValues:i,isWindows:t.device.isWindows,markdownSerializationOptions:(0,R.KF)(),markdownLinkifyIt:n}).markdown].filter(h.$K).join("\n\n")}function Ve(e){const{prompt:t,pageTitle:o,pageContent:n,selectedText:i,additionalContext:r}=e;W.mw()&&console.log("textSelectionPromptToServerContext",e);const a="string"==typeof t.name?t.name:N.default.formatMessage(t.name);if("fixSpellingGrammar"===t.key||"explainThis"===t.key||"makeLonger"===t.key||"makeShorter"===t.key||"findActionItems"===t.key||"improveWriting"===t.key||"simplifyLanguage"===t.key||"cleanUpFormatting"===t.key||"summarize"===t.key)return{serverPrompt:{type:t.key,pageTitle:o,selectedText:i},humanStep:{type:"human",prompt:a}};if("translate"===t.key){const e=(null==r?void 0:r.language)??"english";return{serverPrompt:{type:t.key,text:i,language:e},humanStep:{type:"human",prompt:`Translate to ${e}`}}}if("changeTone"===t.key){const e=(null==r?void 0:r.tone)??"professional";return{serverPrompt:{type:t.key,text:i,tone:e},humanStep:{type:"human",prompt:`Change tone to ${e}`}}}if("helpMeEdit"===t.key){const e=(null==r?void 0:r.prompt)||"";return{serverPrompt:{type:t.key,prompt:e,selectedText:i,pageTitle:o,pageContent:n},humanStep:{type:"human",prompt:e}}}}function je(e){const{transaction:t,completionState:{clientPrompt:o,additionalContext:n,promptTitle:i}}=e,r=(0,re.BG)({clientPrompt:o,additionalContext:n,promptTitle:i});if(!r)return;const{currentUserSettingsStore:a}=q.default.state;if(!a)return;(0,ne.Gl)(a,r)||(0,re.Nv)(r,a,t)}function De(e){const{prompt:t,pageTitle:o,previousContent:n,restContent:i,additionalContext:r,pageContent:a}=e;W.mw()&&console.log("cursorPromptToServerContext",e);const s="string"==typeof t.name?t.name:N.default.formatMessage(t.name);if("continueWriting"===t.key)return{serverPrompt:{type:"continueWriting",pageTitle:o,previousContent:n,restContent:i},humanStep:{type:"human",prompt:s}};if("helpMeWrite"===t.key){const e=(null==r?void 0:r.prompt)??"";return{serverPrompt:{type:"helpMeWrite",pageTitle:o,previousContent:n,restContent:i,prompt:e},humanStep:{type:"human",prompt:e}}}if("helpMeDraft"===t.key){const e=(null==r?void 0:r.prompt)??"";return{serverPrompt:{type:"helpMeDraft",prompt:e,previousContent:n,pageTitle:o},humanStep:{type:"human",prompt:e}}}if("todoList"===t.key||"outline"===t.key||"meetingAgenda"===t.key||"brainstormIdeas"===t.key||"prosConsList"===t.key||"socialMediaPost"===t.key||"pressRelease"===t.key||"creativeStory"===t.key||"poem"===t.key||"essay"===t.key||"blogPost"===t.key||"jobDescription"===t.key||"salesEmail"===t.key||"recruitingEmail"===t.key){const e=(null==r?void 0:r.topic)??"";return{serverPrompt:{type:t.key,topic:e,pageContent:a},humanStep:{type:"human",prompt:e}}}return"summarize"===t.key||"findActionItems"===t.key?{serverPrompt:{type:t.key,pageTitle:o,selectedText:a},humanStep:{type:"human",prompt:s}}:void 0}async function ze(e,t){let o;const n=W.ZE();if(n.debug)o=402!==n.showErrorCode;else{const n=await C.getAIUsageEligibility(e,{spaceId:t});"success"===n.type&&(o=n.data.isEligible,te.Z.setState(n.data))}return void 0!==o&&ie.Z.setState(o),o}async function qe(e){const{environment:t,revision:o,type:n,userContent:i,shareWithNotion:r,userOptIn:a}=e;if(K.Z.isAssistantInWriterEnabled(t.device)){const{assistantActions:e}=await D.deps.assistant.loader(),o=G.Z.getActiveSessionId();if(!o)throw new Error("No assistantSessionId.");e.saveFeedback({environment:t,inferenceId:"",type:"thumbsup"===n?"assistant_thumbs_up":"assistant_thumbs_down",sessionId:o,userComment:i,shareWithNotion:r,userOptIn:a})}else{const e=$.default.state;if(!o.inferenceId||"completionPopup"!==e.type||"results"!==e.stage)return;v.NF(t,{type:"cursor_completion",inference_id:o.inferenceId,feedback_type:n,timestamp:(new Date).toUTCString(),user_comment:i,share_with_notion:r,user_opt_in:a}),$.default.setState({...e,revisions:e.revisions.map((e=>e.inferenceId===o.inferenceId?{...e,hasFeedback:!0}:e))})}}function Ke(e,t){const o=$.default.state;"completionPopup"===o.type&&"initialPromptForAIBlock"===o.stage&&F.createAndCommit({userAction:"completionActions.updatePromptForCurrentAiBlock",environment:e,perform:n=>{M.sO({environment:e,editorMode:"default",store:o.store.getBlockTitleStore(),value:(0,u.TPx)(t),transaction:n})}})}},44866:(e,t,o)=>{o.r(t),o.d(t,{autofillPropertyForBlocks:()=>X,autofillPropertyForCollection:()=>Q,fillAllPagesMessages:()=>V,getDefaultAiInference:()=>te,getPropertyCompletionForBlock:()=>ee,saveOrRemovePropertyAiInference:()=>J,submitFeedbackForAiAutofill:()=>Y,triggerAiAutofillUpsell:()=>G});o(57658);var n=o(67294),i=o(26263),r=o(99036),a=o(80951),s=o(482),l=o(3791),c=o(9291),d=o(98151),p=o(7032),u=o(1898),m=o(10910),f=o(8406),g=o(54642),y=o(893),h=o(79474),v=o(47307),C=o(96802),k=o(64964),I=o(993),S=o(13447),x=o(75330),P=o(86628),w=o(98519),M=o(52423),A=o(79576),_=o(73420),F=o(68785),T=o(6854),b=o(85893);const L=function(e){let{environment:t,inferenceIds:o,aiInference:i}=e;const r=(0,P.VK)((()=>{const{state:e}=A.W;return"uninitialized"===e.type?null:{numBlocksToAutofill:e.numBlocksToAutofill,numBlocksAutofilled:e.numBlocksAutofilled,propertySchema:e.propertySchema,collectionId:e.collectionId,sessionId:e.sessionId,haveAllBlocksCompletedAutofill:e.haveAllBlocksCompletedAutofill}}),[]),a=(0,n.useCallback)((()=>{r&&(o.forEach((e=>{m.qG(t,{ai_inference_type:i.type,type:"undo_from_snackbar",inference_id:e,collection_id:r.collectionId,session_id:r.sessionId})})),M.Yw(t,!0),k.rN(),A.W.setState({type:"filling",...r,didInterruptStreaming:!0}))}),[r,t,i,o]);if(!r)return null;const{numBlocksToAutofill:s,numBlocksAutofilled:l,propertySchema:{name:d}}=r;return l===s?(0,b.jsxs)(_.X2,{gap:4,alignItems:"center",children:[(0,w.k)({width:16}),(0,b.jsx)(c.FormattedMessage,{defaultMessage:'AI updated "{propertyName}" on {numPages, plural, one {1 page} other {# pages}}',id:"snackbar.aiAutofill.autofillInProgress",values:{propertyName:d,numPages:s}}),(0,b.jsx)(T.Pn,{onClick:a,children:(0,b.jsx)(c.FormattedMessage,{defaultMessage:"Undo",id:"snackbar.aiAutofill.undo"})}),(0,b.jsx)(T.Pn,{onClick:()=>{k.rN()},children:(0,b.jsx)(c.FormattedMessage,{defaultMessage:"Close",id:"snackbar.aiAutofill.close"})})]}):(0,b.jsxs)(_.X2,{gap:4,alignItems:"center",children:[(0,b.jsx)(F.Z,{}),0===l?(0,b.jsx)(c.FormattedMessage,{defaultMessage:'AI updating "{propertyName}" on {numPages, plural, one {1 page} other {# pages}}',id:"snackbar.aiAutofill.autofillStarting",values:{propertyName:d,numPages:s}}):(0,b.jsx)(c.FormattedMessage,{defaultMessage:'AI updated "{propertyName}" on {numFilledPages} of {numTotalPages} pages',id:"snackbar.aiAutofill.completedAutofill",values:{propertyName:d,numFilledPages:l,numTotalPages:s}}),(0,b.jsx)(T.Pn,{onClick:a,children:(0,b.jsx)(c.FormattedMessage,{defaultMessage:"Stop & undo",id:"snackbar.aiAutofill.undoAndStop"})})]})};var W=o(33929),R=o(77907),N=o(80444),E=o(6258),B=o(1310),O=o(44041),U=o(35057),Z=o(88280),H=o(84654);const V=(0,c.defineMessages)({fillAllPagesTooltip:{defaultMessage:"{hasNames, select, true {Autofill {propertyName} for all pages in {collectionName}} other {Autofill this property for all pages in the database}}",id:"aiAutofill.fillAllPages.buttonTooltip"},fillAllPagesAddOnMessage:{defaultMessage:"Only with Notion AI add-on",id:"aiAutofill.fillAllPages.onlyWithAiAddOnMessageInTooltip"}});function j(e){let{environment:t,propertyId:o,propertySchema:n,storesWithCompletions:i,blockIdToInferenceId:s,useTemporaryStore:l,markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:d,doneStreaming:p,aiInferenceOverride:m}=e;S.createAndCommit({userAction:"BlockPropertyValue.handleActionButtonClick.aiAutofill",environment:t,canUndo:!Boolean(l),undoCheckpoint:!0,perform:e=>{var f;for(const{store:g,temporaryStore:h,completion:v}of i){const i=l?h:g;let k;switch(n.type){case"text":k=y.of({text:v.trim(),stripText:!1,stripSurroundingWhitespace:!0,markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:d});break;case"multi_select":case"select":const t=l?null===(f=g.getAssociatedCollectionStore())||void 0===f?void 0:f.clone(h.inMemoryRecordCache):g.getAssociatedCollectionStore(),i=m??n.select_ai_inference;let s=v.trim().split(",").map((e=>e.trim()));if(p||(s=s.slice(0,-1)),t&&null!=i&&i.add_options){const i=(0,r.RR)({newTokenValues:s.length>0&&"select"===n.type?[[s[0]]]:[s],property:o,propertySchema:n,collectionId:t.id});if(i)for(const o of i)S.applyOperation({store:t,operation:o,transaction:e})}null!=i&&i.add_options||(s=s.filter((e=>{var t;return null===(t=n.options)||void 0===t?void 0:t.find((t=>t.value===e))}))),k=(0,a.zq)(s);break;default:(0,u.t1)(n)}I.sO({environment:t,editorMode:"default",store:i.getNormalizedPropertyStore(o),value:k,transaction:e});const x=i.getFormat().ai_property_inference_map??{},P=s[g.id]??"";C.FH({stores:[i],update:{ai_property_inference_map:{...x,[o]:{inference_id:P,created_time:Date.now()}}},transaction:e})}}})}const D=(0,c.defineMessages)({FAILED_TO_AUTOFILL:{defaultMessage:"Something went wrong. Please try again later",id:"propertyCompletionActions.error.unableToAutofill"},INVALID_PROPERTY_FOR_AUTOFILL:{defaultMessage:"Invalid property configuration for AI autofill",id:"propertyCompletionActions.error.invalidPropertyForAutofill"},NO_BLOCKS_TO_AUTOFILL:{defaultMessage:"Nothing to update with AI",id:"propertyCompletionActions.error.noBlocksToAutofill"}}),z=(0,c.defineMessages)({featureUnavailable:{id:"completionActions.featureNotEnabledError",defaultMessage:"This feature is not currently enabled"}});function q(e){let{autofillPropertyResult:t}=e;const o=W.default.formatMessage(D[t]);k.rN(),v.deprecatedShowErrorMessage(o)}const K={ai_limit_property_autofill:(0,b.jsx)(c.FormattedMessage,{defaultMessage:"This workspace has used all of its free AI responses. Contact your workspace owner to add Notion AI.",id:"aiAutofill.outOfAiUpsellDialogMessage"}),ai_autofill_on_page_edit:(0,b.jsx)(c.FormattedMessage,{defaultMessage:"Auto-update requires the Notion AI Add-on. Contact your workspace owner to add Notion AI.",id:"aiAutofill.autoUpdateOnPageEditUpsellDialogMessage"}),ai_autofill_fill_all_pages:(0,b.jsx)(c.FormattedMessage,{defaultMessage:"Updating all pages requires the Notion AI Add-on. Contact your workspace owner to add Notion AI.",id:"aiAutofill.fillAllPagesUpsellDialogMessage"}),ai_autofill_bulk_fill:(0,b.jsx)(c.FormattedMessage,{defaultMessage:"Filling more pages at once requires the Notion AI Add-on. Contact your workspace owner to add Notion AI.",id:"aiAutofill.bulkFillUpsellDialogMessage"})};function G(e){var t;let{environment:o,from:n}=e;null!==(t=N.default.state.currentSpaceStore)&&void 0!==t&&t.canAdmin()||v.deprecatedShowErrorMessage(K[n]),O.y(o,{from:n,for:(0,U.zt)(),addOnFeature:"ai"})}function $(e){let{errorCode:t,environment:o}=e;return 405===t?k.oV({label:W.default.formatMessage(z.featureUnavailable)}):(402===t&&(k.rN(),G({environment:o,from:"ai_limit_property_autofill"})),H.showCompletionErrorWithCode(t))}async function X(e){var t;let{environment:o,stores:n,property:a,propertySchema:s,userEventForAnalytics:l,sessionIdForAnalytics:c,collectionContextStore:y,from:h,isBulkAction:v,aiInferenceOverride:C}=e;const I=c||(0,p.ZP)(),S=a,x=n.map((e=>({spaceId:e.getSpaceId(),...e.pointer,propertyId:S,inferenceId:(0,p.ZP)()}))),P=n[0].getAssociatedCollectionId()??(null===(t=n[0].getCollectionViewCollectionStore())||void 0===t?void 0:t.id),w=new i.Z({name:"propertyCompletionActions.autofillPropertyForBlocks"});if(A.W.setIsWriting({stores:n,propertySchema:s,sessionIdForAnalytics:c}),"uninitialized"!==A.W.state.type&&(0,r.qQ)(s)&&P){k.oV({label:(0,b.jsx)(L,{environment:o,inferenceIds:x.map((e=>e.inferenceId)),aiInference:(0,r.q3)(s)}),durationMs:B.JY});try{var M;if(o.defaultRecordCache.inMemoryRecordCache.addCacheOverride(w),!(0,u.Of)(x))return q({autofillPropertyResult:"NO_BLOCKS_TO_AUTOFILL"});const e=C||(0,r.q3)(s);if(!e)return q({autofillPropertyResult:"INVALID_PROPERTY_FOR_AUTOFILL"});x.forEach((t=>{m.qG(o,{type:l,inference_id:t.inferenceId,ai_inference_type:e.type,collection_id:P,session_id:I})})),null!==(M=N.default.state.currentSpaceStore)&&void 0!==M&&M.id&&g.publishAiSession(o,{inference_type:"autofill",id:I,spaceId:N.default.state.currentSpaceStore.id,metadata:{blockPropertyPointers:x,aiInference:e,collection_id:P}});const t=await g.getCompletionForProperty(o,{blockPropertyPointers:x,aiInference:e,aiSessionId:I,model:"default"});if("success"!==t.type)return q({autofillPropertyResult:"FAILED_TO_AUTOFILL"});y&&f.rv({block_id:n[0].pointer.id,property:S,property_type:s.type,from:h,environment:o,collectionContextStore:y,isFromBulkActionsToolbar:v});const i=Object.fromEntries(n.map((e=>[e.pointer.id,{store:e,temporaryStore:e.clone(w),completion:""}]))),a=Object.fromEntries(x.map((e=>[e.id,e.inferenceId]))),c=new Set,[p,k]=await Promise.all([R.deps.markdownLinkifyIt.loader(),R.deps.tinyMceMicrosoftWordPasteFilter.loader()]);if(d.H1.is(t.data)){for await(const e of t.data){if("error"===e.type)return A.W.setState({...A.W.state,didInterruptStreaming:!0}),$({errorCode:e.errorCode,environment:o});if(A.W.state.didInterruptStreaming)return;const t=i[e.blockPropertyPointer.id],n=t.completion+e.completion;i[e.blockPropertyPointer.id]={...t,completion:n},c.add(e.blockPropertyPointer.id),j({environment:o,propertyId:S,propertySchema:s,storesWithCompletions:Object.values(i),blockIdToInferenceId:a,useTemporaryStore:!0,markdownLinkifyIt:p,tinyMceMicrosoftWordPasteFilter:k,aiInferenceOverride:C}),A.W.setState({...A.W.state,numBlocksAutofilled:c.size})}A.W.setState({...A.W.state,haveAllBlocksCompletedAutofill:!0})}o.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(w),j({environment:o,propertyId:S,propertySchema:s,storesWithCompletions:Object.values(i),blockIdToInferenceId:a,useTemporaryStore:!1,markdownLinkifyIt:p,tinyMceMicrosoftWordPasteFilter:k,doneStreaming:!0,aiInferenceOverride:C})}finally{o.defaultRecordCache.inMemoryRecordCache.hasCacheOverride(w)&&o.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(w)}}}function Y(e){const{environment:t,inferenceId:o,feedbackType:n,userContent:i,shareWithNotion:r}=e;m.NF(t,{type:"property_autofill",inference_id:o,feedback_type:n,timestamp:(new Date).toUTCString(),user_comment:i,share_with_notion:r})}async function Q(e){var t,o;let{environment:n,collectionStore:i,propertySchema:a,property:c,sessionIdForAnalytics:d}=e;if(!(0,r.qQ)(a))return;const u=(0,r.q3)(a);if(!i||!a||!u)return;const f=(null===(t=Z.subscriptionDataStoreInstance.state)||void 0===t?void 0:t.addOns)??[];if(!(0,l.de)(f))return void G({environment:n,from:"ai_autofill_fill_all_pages"});if(!(await h.r({sourceAction:"fill_all_pages",propertyName:a.name,collectionName:(null===(o=i.getName())||void 0===o?void 0:o.toString())||""})))return;m.qG(n,{type:"generate_from_fill_all_pages",inference_id:(0,p.ZP)(),ai_inference_type:u.type,collection_id:i.id,session_id:d??(0,p.ZP)()});const g=[];g.push(s.op.update({pointer:i.pointer,path:["format","update_ai_inferences_status"],args:{[c]:{type:"requested",created_time:Date.now()}}})),x.HW({environment:n,collectionStore:i,performTransaction:e=>{for(const t of g)S.applyOperation({store:(0,E.Kv)(i,t.pointer),operation:t,transaction:e})}})}function J(e){const{environment:t,propertySchema:o,collectionStore:n,property:i,draftAiInference:a}=e;let s="";switch(o.type){case"text":s="ai_inference";break;case"select":case"multi_select":s="select_ai_inference";break;default:return}const l=[];if(l.push({pointer:n.pointer,command:"set",path:["schema",i,s],args:a}),a)m._e(t,{type:"set_ai_inference",ai_inference_type:a.type,collection_id:n.id});else{const e=(0,r.q3)(o);m._e(t,{type:"remove_ai_inference",ai_inference_type:null==e?void 0:e.type,collection_id:n.id})}x.HW({environment:t,collectionStore:n,performTransaction:e=>{for(const t of l)S.applyOperation({store:(0,E.Kv)(n,t.pointer),operation:t,transaction:e})}})}async function ee(e){var t;let{environment:o,store:n,property:i,propertySchema:r,userEventForAnalytics:a,sessionIdForAnalytics:s}=e;const l=s||(0,p.ZP)(),c=i,u={spaceId:n.getSpaceId(),...n.pointer,propertyId:c,inferenceId:(0,p.ZP)()},f=n.getAssociatedCollectionId()??(null===(t=n.getCollectionViewCollectionStore())||void 0===t?void 0:t.id),y=te(r,!1);if(!y)return"";m.qG(o,{type:a,inference_id:u.inferenceId,ai_inference_type:y.type,collection_id:f,session_id:l});const h=(0,p.ZP)();g.publishAiSession(o,{inference_type:"autofill",id:h,metadata:{blockPropertyPointers:[u],aiInference:y,collection_id:f}});const v=await g.getCompletionForProperty(o,{blockPropertyPointers:[u],aiInference:y,aiSessionId:h,model:"default"});if("success"!==v.type)return"";let C="";if(d.H1.is(v.data))for await(const d of v.data)"error"!==d.type&&(C+=d.completion);return C}function te(e,t){if(!(0,r.qQ)(e))return;const o=(0,r.q3)(e);return!o&&(0,r.cu)(e)?{type:e.type,auto_update_on_edit:t,add_options:!1}:o}},99417:(e,t,o)=>{o.d(t,{Ah:()=>j,Dr:()=>F,HS:()=>X,Iz:()=>q,LN:()=>E,Mh:()=>O,NX:()=>V,OE:()=>T,dU:()=>Q,gY:()=>$,pv:()=>U,sB:()=>H,sr:()=>G,t8:()=>W,up:()=>B,wA:()=>D,wq:()=>R,xM:()=>K,zU:()=>Y});o(57658),o(21703);var n=o(87205),i=(o(99036),o(30579)),r=o(41886),a=o(27245),s=o(52897),l=o(7500),c=o(31157),d=o(88607),p=o(25879),u=o(12970),m=o(91856),f=o(20669),g=o(25651),y=o(11751),h=o(72050),v=o(9291),C=o(31701),k=o(53965),I=o(1898),S=(o(95477),o(43250)),x=o(95802),P=o(16772),w=(o(77080),o(6258)),M=o(78663),A=o(19124),_=o(33929);const F=(0,v.defineMessages)({writeWithAI:{defaultMessage:"Write with AI",id:"id.completions.writeWithAI"},draftWithAI:{defaultMessage:"Draft with AI",id:"id.completions.draftWithAI"},extractFromSelection:{defaultMessage:"Generate from selection",id:"id.completions.extractFromSelection"},extractFromPage:{defaultMessage:"Generate from page",id:"id.completions.extractFromPage"},editSelection:{defaultMessage:"Edit or review selection",id:"id.completions.editSelection"},editPage:{defaultMessage:"Edit or review page",id:"id.completions.editPage"},aiBlocks:{defaultMessage:"Insert AI blocks",id:"id.completions.aiBlocks"},helpMeEdit:{defaultMessage:"Ask AI to edit...",id:"id.completions.helpMeEdit"},askAI:{defaultMessage:"Ask AI",id:"id.completions.askAI"},genericHelpMeEdit:{defaultMessage:"{filter}",id:"id.completions.genericHelpMeEdit"},genericHelpMeWrite:{defaultMessage:"{filter}",id:"id.completions.genericHelpMeWrite"},continueWriting:{defaultMessage:"Continue writing",id:"id.completions.continueWriting"},brainstormIdeas:{defaultMessage:"Brainstorm ideas",id:"id.completions.brainstormIdeas"},brainstormIdeasTopic:{defaultMessage:'What do you want to brainstorm ideas about?\nFor example, "creative name ideas for a pirate themed party game"',id:"id.completions.Topic"},summarize:{defaultMessage:"Summarize",id:"id.completions.summarize"},translate:{defaultMessage:"Translate",id:"id.completions.translate"},translateLanguage:{defaultMessage:"Select language",id:"id.completions.translateLanguage"},blogPost:{defaultMessage:"Blog post",id:"id.completions.blogPost"},blogPostTopicPlaceholder:{defaultMessage:'What should the blog post be about?\nFor example, "the benefits of practicing mindfulness and meditation"',id:"id.completions.blogPost.blogPostTopic.placeholder"},blogPostGenerate:{defaultMessage:"Generate post",id:"id.completions.blogPost.generate"},prosConsList:{defaultMessage:"Pros and cons list",id:"id.completions.prosConsList"},prosConsListPlaceholder:{defaultMessage:'What do you want to make a pros and cons list about?\nFor example, "learning a new language for the first time"',id:"id.completions.prosConsListPlaceholder"},socialMediaPostPlaceholder:{defaultMessage:'What do you want to make a social media post about?\nFor example, "tips and tricks for changing careers"',id:"id.completions.socialMediaPostPlaceholder"},outlinePlaceholder:{defaultMessage:'What do you want to make an outline for?\nFor example, "a detailed step-by-step process for getting into university"',id:"id.completions.outlinePlaceholder"},creativeStoryPlaceholder:{defaultMessage:'What do you want to write a story about?\nFor example, "suzy discovers a magical secret room only she can see"',id:"id.completions.creativeStoryPlaceholder"},poemPlaceholder:{defaultMessage:'What do you want to write a poem about?\nFor example, "a whimsical poem about finding meaning in ordinary things"',id:"id.completions.poemPlaceholder"},essayPlaceholder:{defaultMessage:'What do you want to write an essay about?\nFor example, "how a chaotic environment can actually improve focus"',id:"id.completions.essayPlaceholder"},todoListPlaceholder:{defaultMessage:'What do you want to make a to-do list about?\nFor example, "creating a new board game"',id:"id.completions.todoListPlaceholder"},meetingAgendaPlaceholder:{defaultMessage:'What is the purpose of the meeting?\nFor example, "alignment on pricing for new product"',id:"id.completions.meetingAgendaPlaceholder"},pressReleasePlaceholder:{defaultMessage:'What should the press release be about?\nFor example, "product launch for new mind-reading app for pets"',id:"id.completions.pressReleasePlaceholder"},jobDescriptionPlaceholder:{defaultMessage:'What job do you want to write a description about?\nFor example, "data engineer at Notion, needs Postgres experience"',id:"id.completions.jobDescriptionPlaceholder"},salesEmailPlaceholder:{defaultMessage:'What product are you selling?\nFor example, "email for a head of operations about a new brain boosting supplement"',id:"id.completions.salesEmailPlaceholder"},recruitingEmailPlaceholder:{defaultMessage:'Who are you trying to recruit?\nFor example, "experienced frontend engineer for our new social mindfulness app"',id:"id.completions.recruitingEmailPlaceholder"},helpMeEditPlaceholder:{defaultMessage:'How would you like to edit this text?\nFor example, "Summarize in one sentence"',id:"id.completions.helpMeEditPlaceholder"},improveWriting:{defaultMessage:"Improve writing",id:"id.completions.improveWriting"},fixSpellingGrammar:{defaultMessage:"Fix spelling & grammar",id:"id.completions.fixSpellingGrammar"},explainThis:{defaultMessage:"Explain this",id:"id.completions.explainThis"},makeLonger:{defaultMessage:"Make longer",id:"id.completions.makeLonger"},findActionItems:{defaultMessage:"Find action items",id:"id.completions.findActionItems"},makeShorter:{defaultMessage:"Make shorter",id:"id.completions.makeShorter"},simplifyLanguage:{defaultMessage:"Simplify language",id:"id.completions.simplifyLanguage"},changeTone:{defaultMessage:"Change tone",id:"id.completions.changeTone"},changeToneType:{defaultMessage:"Select tone",id:"id.completions.changeToneType"},socialMediaPost:{defaultMessage:"Social media post",id:"id.completions.socialMediaPost"},cleanUpFormatting:{defaultMessage:"Clean up formatting",id:"id.completions.cleanUpFormatting"},outline:{defaultMessage:"Outline",id:"id.completions.outline"},creativeStory:{defaultMessage:"Creative story",id:"id.completions.creativeStory"},poem:{defaultMessage:"Poem",id:"id.completions.poem"},essay:{defaultMessage:"Essay",id:"id.completions.essay"},todoList:{defaultMessage:"To-do list",id:"id.completions.todoList"},toDoListKeywords:{id:"id.completions.todoListKeywords",defaultMessage:"Todo To-Do List"},meetingAgenda:{defaultMessage:"Meeting agenda",id:"id.completions.meetingAgenda"},pressRelease:{defaultMessage:"Press release",id:"id.completions.pressRelease"},jobDescription:{defaultMessage:"Job description",id:"id.completions.jobDescription"},salesEmail:{defaultMessage:"Sales email",id:"id.completions.salesEmail"},recruitingEmail:{defaultMessage:"Recruiting email",id:"id.completions.recruitingEmail"},conclusion:{defaultMessage:"Conclusion",id:"id.completions.conclusion"},autofillSummary:{defaultMessage:"Summary",id:"id.completions.autofillSummary"},autofillTranslate:{defaultMessage:"Translate",id:"id.completions.autofillTranslate"},autofillExtract:{defaultMessage:"Key info",id:"id.completions.autofillExtract"},autofillCustom:{defaultMessage:"Custom autofill",id:"id.completions.autofillCustom"},insertAIBlock:{defaultMessage:"Insert as AI block",id:"id.completions.insertAIBlock"}}),T={text:{summarize:{name:F.autofillSummary,svg:m.Y},translate:{name:F.autofillTranslate,svg:d.Q},extract:{name:F.autofillExtract,svg:h.A},custom:{name:F.autofillCustom,svg:f.y}},select:{select:{name:F.autofillCustom,svg:f.y}},multi_select:{select:{name:F.autofillCustom,svg:f.y}}};const b=[A.eL,{key:"brainstormIdeas",category:"draftWithAI",name:F.brainstormIdeas,svg:p.b,svgFill:C.FN.light.purple[400],steps:[{key:"topic",name:F.brainstormIdeasTopic,placeholder:F.brainstormIdeasTopic,type:"text"}]},{key:"blogPost",category:"draftWithAI",name:F.blogPost,generateName:F.blogPostGenerate,svg:g.R,svgFill:C.FN.light.purple[400],steps:[{key:"topic",name:F.blogPostTopicPlaceholder,placeholder:F.blogPostTopicPlaceholder,type:"text"}]},{key:"outline",category:"draftWithAI",name:F.outline,svg:g.R,svgFill:C.FN.light.purple[400],steps:[{key:"topic",name:F.outlinePlaceholder,placeholder:F.outlinePlaceholder,type:"text"}]},{key:"socialMediaPost",category:"draftWithAI",name:F.socialMediaPost,svg:g.R,svgFill:C.FN.light.purple[400],steps:[{key:"topic",name:F.socialMediaPostPlaceholder,placeholder:F.socialMediaPostPlaceholder,type:"text"}]},{key:"pressRelease",category:"draftWithAI",name:F.pressRelease,svg:g.R,svgFill:C.FN.light.purple[400],steps:[{key:"topic",name:F.pressReleasePlaceholder,placeholder:F.pressReleasePlaceholder,type:"text"}]},{key:"creativeStory",category:"draftWithAI",name:F.creativeStory,svg:g.R,svgFill:C.FN.light.purple[400],steps:[{key:"topic",name:F.creativeStoryPlaceholder,placeholder:F.creativeStoryPlaceholder,type:"text"}]},{key:"essay",category:"draftWithAI",name:F.essay,svg:g.R,svgFill:C.FN.light.purple[400],steps:[{key:"topic",name:F.essayPlaceholder,placeholder:F.essayPlaceholder,type:"text"}]},{key:"poem",category:"draftWithAI",name:F.poem,svg:g.R,svgFill:C.FN.light.purple[400],steps:[{key:"topic",name:F.poemPlaceholder,placeholder:F.poemPlaceholder,type:"text"}]},{key:"todoList",category:"draftWithAI",name:F.todoList,fuzzySearchKeywords:F.toDoListKeywords,svg:g.R,svgFill:C.FN.light.purple[400],steps:[{key:"topic",name:F.todoListPlaceholder,placeholder:F.todoListPlaceholder,type:"text"}]},{key:"meetingAgenda",category:"draftWithAI",name:F.meetingAgenda,svg:g.R,svgFill:C.FN.light.purple[400],steps:[{key:"topic",name:F.meetingAgendaPlaceholder,placeholder:F.meetingAgendaPlaceholder,type:"text"}]},{key:"prosConsList",category:"draftWithAI",name:F.prosConsList,svg:g.R,svgFill:C.FN.light.purple[400],steps:[{key:"topic",name:F.prosConsListPlaceholder,placeholder:F.prosConsListPlaceholder,type:"text"}]},{key:"jobDescription",category:"draftWithAI",name:F.jobDescription,svg:g.R,svgFill:C.FN.light.purple[400],steps:[{key:"topic",name:F.jobDescriptionPlaceholder,placeholder:F.jobDescriptionPlaceholder,type:"text"}]},{key:"salesEmail",category:"draftWithAI",name:F.salesEmail,svg:g.R,svgFill:C.FN.light.purple[400],steps:[{key:"topic",name:F.salesEmailPlaceholder,placeholder:F.salesEmailPlaceholder,type:"text"}]},{key:"recruitingEmail",category:"draftWithAI",name:F.recruitingEmail,svg:g.R,svgFill:C.FN.light.purple[400],steps:[{key:"topic",name:F.recruitingEmailPlaceholder,placeholder:F.recruitingEmailPlaceholder,type:"text"}]}],L=[A.It,{key:"continueWriting",category:"writeWithAI",name:F.continueWriting,svg:g.R,svgFill:C.FN.light.purple[400],requiresContent:!0},{key:"summarize",category:"extractFromContent",name:F.summarize,svg:m.Y,svgFill:C.FN.light.purple[400],requiresContent:!0},{key:"findActionItems",category:"extractFromContent",name:F.findActionItems,svg:u.O,svgFill:C.FN.light.purple[400],requiresContent:!0}];function W(e){if("string"==typeof e.name)return e.name;return _.default.getIntl().formatMessage(e.name)}function R(e){for(const t of N()){const o=(0,M.$W)(t);if(o&&e.startsWith(o))return{prompt:t,additionalContext:{topic:e}}}}function*N(){for(const t of b){var e;1===(null===(e=t.steps)||void 0===e?void 0:e.length)&&"topic"===t.steps[0].key&&(yield t)}}function E(e,t){const o=e.trim().toLocaleLowerCase();for(const n of N()){if((0,M.$W)(n,t).trim().toLocaleLowerCase()===o)return!0}return!1}function B(e){const t=[];return"cursor"===e.selectionType?e.isPageEmpty?t.push(...b):t.push(...L,...Z,...b):t.push(...Z,...L,...b),k.mN(t,(e=>e.key))}function O(e,t){switch(e){case"writeWithAI":return F.writeWithAI;case"draftWithAI":return F.draftWithAI;case"editContent":switch(t){case"page":return F.editPage;case"selection":return F.editSelection}break;case"extractFromContent":switch(t){case"page":return F.extractFromPage;case"selection":return F.extractFromSelection}}}function U(e,t){const o={editContent:[],writeWithAI:[],draftWithAI:[],extractFromContent:[]};function n(e){return[e,o[e]]}for(const i of e)o[i.category].push(i);return"cursor"===t.selectionType?t.isPageEmpty?[n("draftWithAI"),n("writeWithAI")]:[n("writeWithAI"),n("extractFromContent"),n("editContent"),n("draftWithAI")]:[n("editContent"),n("extractFromContent"),n("writeWithAI"),n("draftWithAI")]}const Z=[{key:"improveWriting",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:F.improveWriting,svg:s.d,svgFill:C.FN.light.purple[400]},{key:"fixSpellingGrammar",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:F.fixSpellingGrammar,svg:a.U,svgFill:C.FN.light.purple[400]},{key:"summarize",category:"extractFromContent",name:F.summarize,svg:m.Y,svgFill:C.FN.light.purple[400]},{key:"translate",category:"extractFromContent",name:F.translate,svg:d.Q,svgFill:C.FN.light.purple[400],generateName:F.translate,regenerateName:F.translate,steps:[{key:"language",name:F.translateLanguage,type:"dropdown",dropdownOptions:n.nI}]},{key:"explainThis",category:"extractFromContent",name:F.explainThis,svg:r.y,svgFill:C.FN.light.purple[400]},{key:"makeShorter",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:F.makeShorter,svg:c.f,svgFill:C.FN.light.purple[400]},{key:"makeLonger",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:F.makeLonger,svg:l.H,svgFill:C.FN.light.purple[400]},{key:"findActionItems",category:"extractFromContent",name:F.findActionItems,svg:u.O,svgFill:C.FN.light.purple[400]},{key:"changeTone",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:F.changeTone,svg:i.p,svgFill:C.FN.light.purple[400],generateName:F.changeTone,regenerateName:F.changeTone,steps:[{key:"tone",name:F.changeToneType,type:"dropdown",dropdownOptions:n.vK}]},{key:"simplifyLanguage",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:F.simplifyLanguage,svg:y.t,svgFill:C.FN.light.purple[400]},{key:"helpMeEdit",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:F.helpMeEdit,svg:s.d,svgFill:C.FN.light.purple[400],steps:[{key:"prompt",name:F.helpMeEditPlaceholder,placeholder:F.helpMeEditPlaceholder,type:"text"}]}];function H(e){return{key:"helpMeEdit",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:F.helpMeEdit,svg:s.d,svgFill:C.FN.light.purple[400],steps:[{key:"prompt",name:F.helpMeEditPlaceholder,placeholder:F.helpMeEditPlaceholder,type:"text",prefilledValue:e}]}}const V={key:"continueWriting",name:F.continueWriting};function j(e){let t=x.C.findNodeFromStore(e);if(t){if("table"===e.getType()){const e=t.querySelector(`.${S.euV}.notion-table-block`);t=e??t}return t.getBoundingClientRect()}}function D(e){const{origin:t}=e;return t instanceof w.G?j(t):t instanceof HTMLElement?t.getBoundingClientRect():t}function z(e){if(0===e.revisions.length)throw new Error("Assertion failure: no revisions exist")}function q(e){z(e);for(const t of Y(e))if("initial"===t.type)return t;throw new Error("Assertion failure, initial revision does not exist")}function K(e){return z(e),e.revisions[e.revisions.length-1]}function G(e){return"followup"===K(e).type}function $(e){return e.additionalContext&&(e.additionalContext.prompt||e.additionalContext.topic)||""}function X(e){if(0===e.revisions.length)throw new Error("Assertion failure, expected revisions to be non-empty");return e.revisions.length-1}function*Y(e){let t=X(e),o=0;for(;;){if(o+=1,o>1e4)throw new Error("Maximum iteration limit reached");const n=e.revisions[t];if(!n)throw new Error("Assertion failure, invalid revision index");if(yield n,"initial"===n.type)break;"followup"===n.type?t=n.previousRevision:(0,I.t1)(n)}}function Q(){const e=P.default.state;return"completionPopup"===e.type&&"initialPromptForAIBlock"===e.stage&&!e.store.hasContent()}},96318:(e,t,o)=>{o.d(t,{SA:()=>g,ZE:()=>p,mw:()=>d});o(57658);var n=o(92595),i=o(37850),r=o(95477);let a=0;const s="clipboard",l={debug:Boolean(r.default.isDevelopingInAirplaneMode),responseText:s,showErrorCode:!1,delayBetweenChunks:20,chunkSize:5,numLoremIpsums:3},c="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec porta auctor sem vel efficitur. Vivamus efficitur eros sed erat efficitur efficitur. Vivamus et augue vel est efficitur efficitur.";function d(){return l.debug}function p(){return l}function u(e){return{async*[Symbol.asyncIterator](){for(const t of e)await(0,i.Vs)(l.delayBetweenChunks),yield t}}}function m(e,t){const o=Math.ceil(e.length/t),n=new Array(o);for(let i=0,r=0;i<o;++i,r+=t)n[i]=e.substr(r,t);return n}function f(e){return e.map((e=>({type:"success",p:"padding",completion:e,inferenceId:"mock"})))}async function g(e,t){console.log("Retrieving fake completion for data",t);const{context:o}=t,n=o.selectedText,i=[];let{responseText:d}=l;if(d===s&&(d=await async function(){try{return await navigator.clipboard.readText()}catch(e){return}}()??"Unable to retrieve clipboard text."),void 0===d&&(i.push({type:"success",p:"padding",completion:"\n",inferenceId:"mock"},{type:"success",p:"padding",completion:"this is ",inferenceId:"mock"},{type:"success",p:"padding",completion:"fake ",inferenceId:"mock"},{type:"success",p:"padding",completion:`streaming response ${a++}.`,inferenceId:"mock"}),r.default.isDevelopingInAirplaneMode&&i.push({type:"success",p:"padding",completion:"\n\nTo see a real AI response, run the server with `--airplaneMode=false`.",inferenceId:"mock"}),"string"==typeof n)){i.push({type:"success",p:"padding",completion:"\n\nHere is the text you selected:\n\n",inferenceId:"mock"});for(const e of m(n,l.chunkSize))i.push({type:"success",completion:e,p:"padding",inferenceId:"mock"})}if(l.showErrorCode)i.push({type:"error",message:"alas",errorCode:l.showErrorCode});else if(void 0===d)for(let r=0;r<l.numLoremIpsums;r++)i.push(...f([`\n\n${r+1}. `,...m(c,0===l.delayBetweenChunks?c.length:l.chunkSize)]));else if(d.length>0){const e=m(d,l.chunkSize);i.push(...f(e))}return Promise.resolve({type:"success",data:u(i),status:200,headers:{}})}(0,n.exposeDebugValue)("completionDebugSettings",l)},43604:(e,t,o)=>{o.d(t,{Z:()=>n});const n=o(49085).default.createValue({open:!1})},28956:(e,t,o)=>{o.d(t,{Z:()=>r});var n=o(49085);class i extends n.default{getInitialState(){}}const r=new i},30579:(e,t,o)=>{o.d(t,{p:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.IU)("aiChangeTone",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M10.0371 1.67969L14.0293 5.67188C15.2529 4.46875 15.3486 2.82812 14.1113 1.59766C12.8809 0.374023 11.2471 0.456055 10.0371 1.67969ZM8.16406 14.9482C8.58105 14.9482 8.90918 14.627 8.90918 14.21L8.92285 9.26758L10.9189 7.41504C11.7256 7.49023 12.5527 7.15527 13.25 6.44434L9.26465 2.45215C8.55371 3.15625 8.23242 3.96973 8.31445 4.7832L1.97754 11.5918C1.69043 11.8994 1.66992 12.2822 2.00488 12.6719L1.08203 13.8408C0.958984 13.998 0.972656 14.2236 1.12988 14.3809L1.32812 14.5859C1.48535 14.7432 1.7041 14.7568 1.88184 14.6201L3.04395 13.6973C3.42676 14.0391 3.81641 14.0117 4.11719 13.7314L7.42578 10.6621V14.21C7.42578 14.627 7.75391 14.9482 8.16406 14.9482ZM2.90723 12.1934L8.7793 6.03418C8.88867 6.21191 9.01855 6.37598 9.16895 6.5332C9.32617 6.69727 9.49023 6.83398 9.6543 6.94336L3.51562 12.8086L2.90723 12.1934Z"})})},41886:(e,t,o)=>{o.d(t,{y:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.IU)("aiExplainThis",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M7.61035 10.7373C8.19824 10.7373 8.55371 10.4229 8.64941 9.89648C8.64941 9.84863 8.66309 9.78027 8.66309 9.73242C8.74512 9.01465 9.0459 8.69336 10.1807 7.98926C11.4248 7.20312 12.0947 6.31445 12.0947 5.01562C12.0947 2.89648 10.3652 1.61816 7.95898 1.61816C6.1748 1.61816 4.73926 2.35645 4.14453 3.55957C3.98047 3.88086 3.90527 4.21582 3.90527 4.53027C3.89844 5.15234 4.30176 5.56934 4.96484 5.56934C5.46387 5.56934 5.86719 5.30957 6.05176 4.8584C6.36621 3.92188 7.00195 3.55273 7.84961 3.55273C8.85449 3.55273 9.64062 4.14746 9.64062 5.0498C9.64062 5.9043 9.17578 6.3418 8.13672 6.99805C7.15918 7.63379 6.49609 8.33105 6.49609 9.39062V9.64355C6.49609 10.293 6.93359 10.7373 7.61035 10.7373ZM7.6377 14.6611C8.39648 14.6611 9.01855 14.0732 9.01855 13.3281C9.01855 12.5898 8.39648 12.002 7.6377 12.002C6.87207 12.002 6.25684 12.5898 6.25684 13.3281C6.25684 14.0732 6.87207 14.6611 7.6377 14.6611Z"})})},27245:(e,t,o)=>{o.d(t,{U:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.IU)("aiFixSpellingGrammar",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M6.6123 14.2646C7.07715 14.2646 7.43945 14.0869 7.68555 13.7109L14.0566 3.96973C14.2344 3.69629 14.3096 3.44336 14.3096 3.2041C14.3096 2.56152 13.8311 2.09668 13.1748 2.09668C12.7236 2.09668 12.4434 2.26074 12.1699 2.69141L6.57812 11.5098L3.74121 7.98926C3.48828 7.68848 3.21484 7.55176 2.83203 7.55176C2.16895 7.55176 1.69043 8.02344 1.69043 8.66602C1.69043 8.95312 1.7793 9.20605 2.02539 9.48633L5.55273 13.7588C5.84668 14.1074 6.1748 14.2646 6.6123 14.2646Z"})})},7500:(e,t,o)=>{o.d(t,{H:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.IU)("aiMakeLonger",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M1.45117 3.38184H14.542C14.9795 3.38184 15.3281 3.00586 15.3281 2.5752C15.3281 2.13086 14.9863 1.77539 14.542 1.77539H1.45117C1.00684 1.77539 0.665039 2.14453 0.665039 2.5752C0.665039 2.99902 1.01367 3.38184 1.45117 3.38184ZM1.45117 6.96387H14.542C14.9795 6.96387 15.3281 6.58789 15.3281 6.15723C15.3281 5.71973 14.9863 5.35742 14.542 5.35742H1.45117C1.00684 5.35742 0.665039 5.72656 0.665039 6.15723C0.665039 6.58105 1.01367 6.96387 1.45117 6.96387ZM1.45117 10.5527H14.542C14.9795 10.5527 15.3281 10.1768 15.3281 9.74609C15.3281 9.30176 14.9863 8.94629 14.542 8.94629H1.45117C1.00684 8.94629 0.665039 9.31543 0.665039 9.74609C0.665039 10.1699 1.01367 10.5527 1.45117 10.5527ZM1.45117 14.1348H8.44434C8.88184 14.1348 9.23047 13.7588 9.23047 13.3281C9.23047 12.8906 8.88867 12.5283 8.44434 12.5283H1.45117C1.00684 12.5283 0.665039 12.8975 0.665039 13.3281C0.665039 13.752 1.01367 14.1348 1.45117 14.1348Z"})})},31157:(e,t,o)=>{o.d(t,{f:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.IU)("aiMakeShorter",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M1.4502 7.01221H14.541C14.9785 7.01221 15.3271 6.63623 15.3271 6.20557C15.3271 5.76123 14.9854 5.40576 14.541 5.40576H1.4502C1.00586 5.40576 0.664062 5.7749 0.664062 6.20557C0.664062 6.62939 1.0127 7.01221 1.4502 7.01221ZM1.4502 10.5942H8.44336C8.88086 10.5942 9.22949 10.2183 9.22949 9.7876C9.22949 9.3501 8.8877 8.98779 8.44336 8.98779H1.4502C1.00586 8.98779 0.664062 9.35693 0.664062 9.7876C0.664062 10.2114 1.0127 10.5942 1.4502 10.5942Z"})})},25879:(e,t,o)=>{o.d(t,{b:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.IU)("assistBrainstormIdeas",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M3.37915 4.3186C3.37915 6.77734 4.81616 7.63428 5.17212 11.7607C5.20508 12.2024 5.48853 12.4661 5.93018 12.4661H10.0632C10.5049 12.4661 10.7883 12.2024 10.8213 11.7607C11.1772 7.63428 12.6208 6.78394 12.6208 4.3186C12.6208 1.88623 10.5444 0.0471191 7.99341 0.0471191C5.44897 0.0471191 3.37915 1.87964 3.37915 4.3186ZM4.80957 4.3186C4.80957 2.64429 6.27295 1.47754 7.99341 1.47754C9.72046 1.47754 11.1904 2.64429 11.1904 4.3186C11.1904 5.95337 10.0369 6.46753 9.50952 11.0356H6.48389C5.95654 6.46753 4.80957 5.95337 4.80957 4.3186ZM5.8313 14.1799H10.1621C10.439 14.1799 10.6565 13.9492 10.6565 13.6921C10.6565 13.4285 10.439 13.2043 10.1621 13.2043H5.8313C5.55444 13.2043 5.33691 13.4285 5.33691 13.6921C5.33691 13.9492 5.55444 14.1799 5.8313 14.1799ZM7.99341 16.2168C9.08105 16.2168 9.90503 15.7026 9.97754 14.9182H5.99609C6.06201 15.7026 6.91235 16.2168 7.99341 16.2168Z"})})},64878:(e,t,o)=>{o.d(t,{h:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.IU)("dot",{viewBox:"0 0 5 4",svg:(0,i.jsx)("circle",{cx:"2.5",cy:"2",r:"2"})})},38715:(e,t,o)=>{o.d(t,{N:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.IU)("save",{viewBox:"0 0 16 16",svg:(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("path",{d:"M7.99316 10.8877C8.16406 10.8877 8.31445 10.833 8.47168 10.6758L10.7686 8.46094C10.8848 8.34473 10.9463 8.22168 10.9463 8.05762C10.9463 7.74316 10.6934 7.51074 10.3857 7.51074C10.2285 7.51074 10.0713 7.5791 9.96191 7.70215L8.99805 8.7207L8.56055 9.21973L8.62891 8.20801V1.11914C8.62891 0.78418 8.3418 0.49707 7.99316 0.49707C7.65137 0.49707 7.36426 0.78418 7.36426 1.11914V8.20801L7.43262 9.22656L6.98828 8.7207L6.03125 7.70215C5.92188 7.5791 5.75781 7.51074 5.60059 7.51074C5.29297 7.51074 5.04004 7.74316 5.04004 8.05762C5.04004 8.22168 5.1084 8.34473 5.22461 8.46094L7.52148 10.6758C7.67871 10.833 7.8291 10.8877 7.99316 10.8877ZM4.0625 15.3174H11.9307C13.4072 15.3174 14.1729 14.5586 14.1729 13.1025V6.36914C14.1729 4.91309 13.4072 4.1543 11.9307 4.1543H10.0781V5.49414H11.8486C12.4775 5.49414 12.833 5.82227 12.833 6.48535V12.9863C12.833 13.6494 12.4775 13.9775 11.8486 13.9775H4.14453C3.50879 13.9775 3.16016 13.6494 3.16016 12.9863V6.48535C3.16016 5.82227 3.50879 5.49414 4.14453 5.49414H5.92871V4.1543H4.0625C2.58594 4.1543 1.82031 4.91309 1.82031 6.36914V13.1025C1.82031 14.5586 2.58594 15.3174 4.0625 15.3174Z"})})})}}]);