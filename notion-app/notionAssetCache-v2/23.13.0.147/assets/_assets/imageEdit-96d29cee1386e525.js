"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[8138],{29082:(e,t,i)=>{i.r(t),i.d(t,{ImageEditModal:()=>pe,imageEditActions:()=>n,makeAspectCrop:()=>E});var n={};i.r(n),i.d(n,{MIN_CROP_SIZE:()=>p,TEST_ONLY_constrainBlockDimensions:()=>f,TEST_ONLY_getNewBlockDimensions:()=>m,TEST_ONLY_getOriginalSizeFromBlockSize:()=>y,cropAndUploadImage:()=>w,uploadCroppedImage:()=>C});i(21703);var o=i(70203),r=i(7032),a=i(96802),s=i(9953),h=i(13447),d=i(53471),c=i(27411),l=i(85529);const g=2e3,p=50;async function w(e){const{store:t,environment:i,proxiedOriginalUrl:n}=e;l.Z.setStatusDrawing(t.id);const o=await async function(e){const{store:t,proxiedOriginalUrl:i}=e,n=document.createElement("canvas"),o=n.getContext("2d");if(!o)throw Error("drawEditsToCanvas: missing 2d context");const r=l.Z.getMetadataByBlockId(t.id);if(!r)throw Error("attempted to crop without setting ImageEditStore first");const a=await new Promise(((e,t)=>{const n=new Image;n.onload=()=>e(n),n.onerror=()=>{t()},n.src=i}));let s=function(e){const t=document.createElement("canvas"),i=t.getContext("2d");if(!i)throw new Error("drawInitialCanvas: missing 2d context");const n=Math.min(g,e.naturalWidth),o=n/e.naturalWidth,r=e.naturalHeight*o;return t.width=n,t.height=r,i.drawImage(e,0,0,n,r),t}(a);const{crop:h,mask:d}=r;s=function(e,t){const i=document.createElement("canvas"),n=i.getContext("2d");if(!n)throw new Error("applyCropToCanvas: missing 2d context");const o=e.width*t.x/100,r=e.height*t.y/100,a=e.width*t.width/100,s=e.height*t.height/100;return i.width=a,i.height=s,n.drawImage(e,-o,-r),i}(s,h),"Circle"===d&&(s=function(e){const t=document.createElement("canvas"),i=t.getContext("2d");if(!i)throw new Error("applyCircleMaskToCanvas: missing 2d context");return t.width=e.width,t.height=e.height,i.drawImage(e,0,0),i.globalCompositeOperation="destination-in",i.fillStyle="#000",i.beginPath(),i.arc(.5*e.width,.5*e.height,.5*e.width,0,2*Math.PI),i.fill(),t}(s));return n.style.width=`${s.width}px`,n.style.height=`${s.height}px`,n.width=s.width,n.height=s.height,o.drawImage(s,0,0,s.width,s.height),n}({store:t,proxiedOriginalUrl:n});l.Z.setStatusUploading(t.id,o.toDataURL());const{newWidth:r,newHeight:a}=u({store:t});return C({canvas:o,store:t,environment:i,newBlockHeight:a,newBlockWidth:r,onUploadComplete:()=>l.Z.setStatusCompleted(t.id),onUploadError:()=>l.Z.setStatusError(t.id)})}function u(e){var t,i;const{store:n}=e,{block_width:o,block_aspect_ratio:r}=n.getFormat(),a=null===(t=n.getImageEditMetadata())||void 0===t?void 0:t.crop,s=null===(i=l.Z.getMetadataByBlockId(n.id))||void 0===i?void 0:i.crop;if(!o||!r||!s)throw new Error("Block is missing required properties");const{originalWidth:h,originalHeight:d}=x({currentWidth:o,currentHeight:o*r,currentCrop:a}),c=h*s.width,g=d*s.height/c,{visibleWidth:p,visibleHeight:w}=v({desiredWidth:o,desiredHeight:o*r,aspectRatio:g});return{newWidth:p,newHeight:w,newAspectRatio:g}}const m=u;async function C(e){const{environment:t,canvas:i,store:n,newBlockWidth:g,newBlockHeight:p}=e,w="image/png",u=await new Promise(((e,t)=>{i.toBlob((i=>{i?e(i):t()}),w,1)})),m=new File([u],`${(0,r.ZP)()}.png`,{type:w}),C=c.default.getBlockKey(n.id);d.cT({environment:t,file:m,bucket:"secure",record:n.pointer,onStart:e=>{c.default.setKeyState(C,{progressPercent:0,file:m,name:e.name,size:e.size})},onProgress:e=>{const t=c.default.getKeyState(C);t&&c.default.setKeyState(C,{...t,progressPercent:e.progressPercent})},onComplete:i=>{var r;const d=n.getOriginalImageSource(),w=l.Z.getMetadataByBlockId(n.id);if(!w)throw Error("Missing edit metadata on format update!");if(!d)throw Error("Missing original image source on format update!");h.createAndCommit({userAction:"embedBlockActions.uploadEditedImage",environment:t,perform:e=>{a.FH({stores:[n],update:{display_source:i,original_source:d,image_edit_metadata:w,block_width:g,block_height:p,block_aspect_ratio:p/g},transaction:e}),s.sW({store:n.getPropertiesStore(),data:{source:o.TPx(i)},transaction:e})}}),c.default.setKeyState(C,void 0),null===(r=e.onUploadComplete)||void 0===r||r.call(e)},onError:t=>{var i;c.default.setKeyState(C,void 0),null===(i=e.onUploadError)||void 0===i||i.call(e)}})}function x(e){const{currentWidth:t,currentHeight:i,currentCrop:n}=e;if(!n)return{originalWidth:t,originalHeight:i};if(n.width<=0||n.height<=0)throw Error("Crop area set to 0%");return{originalWidth:t/(n.width/100),originalHeight:i/(n.height/100)}}const y=x;function v(e){const{desiredWidth:t,desiredHeight:i,aspectRatio:n}=e;let o,r;if(o=t,r=o*n,r>i){const e=r/i;r/=e,o/=e}return{visibleWidth:o,visibleHeight:r}}const f=v;var k=i(67294);const b={x:0,y:0,width:0,height:0,unit:"px"},D=(e,t,i)=>Math.min(Math.max(e,t),i),M=(e,t)=>e===t||e.width===t.width&&e.height===t.height&&e.x===t.x&&e.y===t.y&&e.unit===t.unit;function E(e,t,i,n){const o=R(e,i,n);return e.width&&(o.height=o.width/t),e.height&&(o.width=o.height*t),o.y+o.height>n&&(o.height=n-o.y,o.width=o.height*t),o.x+o.width>i&&(o.width=i-o.x,o.height=o.width/t),"%"===e.unit?S(o,i,n):o}function S(e,t,i){return"%"===e.unit?{...b,...e,unit:"%"}:{unit:"%",x:e.x?e.x/t*100:0,y:e.y?e.y/i*100:0,width:e.width?e.width/t*100:0,height:e.height?e.height/i*100:0}}function R(e,t,i){return e.unit?"px"===e.unit?{...b,...e,unit:"px"}:{unit:"px",x:e.x?e.x*t/100:0,y:e.y?e.y*i/100:0,width:e.width?e.width*t/100:0,height:e.height?e.height*i/100:0}:{...b,...e,unit:"px"}}function I(e,t,i,n,o,r=0,a=0,s=n,h=o){const d={...e};let c=Math.min(r,n),l=Math.min(a,o),g=Math.min(s,n),p=Math.min(h,o);t&&(t>1?(c=a?a*t:c,l=c/t,g=s*t):(l=r?r/t:l,c=l*t,p=h/t)),d.y<0&&(d.height=Math.max(d.height+d.y,l),d.y=0),d.x<0&&(d.width=Math.max(d.width+d.x,c),d.x=0);const w=n-(d.x+d.width);w<0&&(d.x=Math.min(d.x,n-c),d.width+=w);const u=o-(d.y+d.height);if(u<0&&(d.y=Math.min(d.y,o-l),d.height+=u),d.width<c&&(("sw"===i||"nw"==i)&&(d.x-=c-d.width),d.width=c),d.height<l&&(("nw"===i||"ne"==i)&&(d.y-=l-d.height),d.height=l),d.width>g&&(("sw"===i||"nw"==i)&&(d.x-=g-d.width),d.width=g),d.height>p&&(("nw"===i||"ne"==i)&&(d.y-=p-d.height),d.height=p),t){const e=d.width/d.height;if(e<t){const e=Math.max(d.width/t,l);("nw"===i||"ne"==i)&&(d.y-=e-d.height),d.height=e}else if(e>t){const e=Math.max(d.height*t,c);("sw"===i||"nw"==i)&&(d.x-=e-d.width),d.width=e}}return d}const _={capture:!0,passive:!1};let H=0;const Z=class e extends k.PureComponent{constructor(){super(...arguments),this.docMoveBound=!1,this.mouseDownOnCrop=!1,this.dragStarted=!1,this.evData={startClientX:0,startClientY:0,startCropX:0,startCropY:0,clientX:0,clientY:0,isResize:!0},this.componentRef=(0,k.createRef)(),this.mediaRef=(0,k.createRef)(),this.initChangeCalled=!1,this.instanceId="rc-"+H++,this.state={cropIsActive:!1,newCropIsBeingDrawn:!1},this.onCropPointerDown=e=>{const{crop:t,disabled:i}=this.props,n=this.getBox();if(!t)return;const o=R(t,n.width,n.height);if(i)return;e.cancelable&&e.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const r=e.target.dataset.ord,a=!!r;let s=e.clientX,h=e.clientY,d=o.x,c=o.y;if(r){const t=e.clientX-n.x,i=e.clientY-n.y;let a=0,l=0;"ne"===r||"e"==r?(a=t-(o.x+o.width),l=i-o.y,d=o.x,c=o.y+o.height):"se"===r||"s"===r?(a=t-(o.x+o.width),l=i-(o.y+o.height),d=o.x,c=o.y):"sw"===r||"w"==r?(a=t-o.x,l=i-(o.y+o.height),d=o.x+o.width,c=o.y):("nw"===r||"n"==r)&&(a=t-o.x,l=i-o.y,d=o.x+o.width,c=o.y+o.height),s=d+n.x+a,h=c+n.y+l}this.evData={startClientX:s,startClientY:h,startCropX:d,startCropY:c,clientX:e.clientX,clientY:e.clientY,isResize:a,ord:r},this.mouseDownOnCrop=!0,this.setState({cropIsActive:!0})},this.onComponentPointerDown=e=>{const{crop:t,disabled:i,locked:n,keepSelection:o,onChange:r}=this.props,a=this.getBox();if(i||n||o&&t)return;e.cancelable&&e.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const s=e.clientX-a.x,h=e.clientY-a.y,d={unit:"px",x:s,y:h,width:0,height:0};this.evData={startClientX:e.clientX,startClientY:e.clientY,startCropX:s,startCropY:h,clientX:e.clientX,clientY:e.clientY,isResize:!0},this.mouseDownOnCrop=!0,r(R(d,a.width,a.height),S(d,a.width,a.height)),this.setState({cropIsActive:!0,newCropIsBeingDrawn:!0})},this.onDocPointerMove=e=>{const{crop:t,disabled:i,onChange:n,onDragStart:o}=this.props,r=this.getBox();if(i||!t||!this.mouseDownOnCrop)return;e.cancelable&&e.preventDefault(),this.dragStarted||(this.dragStarted=!0,o&&o(e));const{evData:a}=this;let s;a.clientX=e.clientX,a.clientY=e.clientY,s=a.isResize?this.resizeCrop():this.dragCrop(),M(t,s)||n(R(s,r.width,r.height),S(s,r.width,r.height))},this.onComponentKeyDown=t=>{const{crop:i,disabled:n,onChange:o,onComplete:r}=this.props;if(n)return;const a=t.key;let s=!1;if(!i)return;const h=this.getBox(),d=this.makePixelCrop(h),c=(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)?e.nudgeStepLarge:t.shiftKey?e.nudgeStepMedium:e.nudgeStep;if("ArrowLeft"===a?(d.x-=c,s=!0):"ArrowRight"===a?(d.x+=c,s=!0):"ArrowUp"===a?(d.y-=c,s=!0):"ArrowDown"===a&&(d.y+=c,s=!0),s){t.cancelable&&t.preventDefault(),d.x=D(d.x,0,h.width-d.width),d.y=D(d.y,0,h.height-d.height);const e=R(d,h.width,h.height),i=S(d,h.width,h.height);o(e,i),r&&r(e,i)}},this.onHandlerKeyDown=(t,i)=>{const{aspect:n=0,crop:o,disabled:r,minWidth:a=0,minHeight:s=0,maxWidth:h,maxHeight:d,onChange:c,onComplete:l}=this.props,g=this.getBox();if(r||!o)return;if("ArrowUp"!==t.key&&"ArrowDown"!==t.key&&"ArrowLeft"!==t.key&&"ArrowRight"!==t.key)return;t.stopPropagation(),t.preventDefault();const p=(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)?e.nudgeStepLarge:t.shiftKey?e.nudgeStepMedium:e.nudgeStep,w=function(e,t,i,n){const o={...e};return"ArrowLeft"===t?"nw"===n?(o.x-=i,o.y-=i,o.width+=i,o.height+=i):"w"===n?(o.x-=i,o.width+=i):"sw"===n?(o.x-=i,o.width+=i,o.height+=i):"ne"===n?(o.y+=i,o.width-=i,o.height-=i):"e"===n?o.width-=i:"se"===n&&(o.width-=i,o.height-=i):"ArrowRight"===t&&("nw"===n?(o.x+=i,o.y+=i,o.width-=i,o.height-=i):"w"===n?(o.x+=i,o.width-=i):"sw"===n?(o.x+=i,o.width-=i,o.height-=i):"ne"===n?(o.y-=i,o.width+=i,o.height+=i):"e"===n?o.width+=i:"se"===n&&(o.width+=i,o.height+=i)),"ArrowUp"===t?"nw"===n?(o.x-=i,o.y-=i,o.width+=i,o.height+=i):"n"===n?(o.y-=i,o.height+=i):"ne"===n?(o.y-=i,o.width+=i,o.height+=i):"sw"===n?(o.x+=i,o.width-=i,o.height-=i):"s"===n?o.height-=i:"se"===n&&(o.width-=i,o.height-=i):"ArrowDown"===t&&("nw"===n?(o.x+=i,o.y+=i,o.width-=i,o.height-=i):"n"===n?(o.y+=i,o.height-=i):"ne"===n?(o.y+=i,o.width-=i,o.height-=i):"sw"===n?(o.x-=i,o.width+=i,o.height+=i):"s"===n?o.height+=i:"se"===n&&(o.width+=i,o.height+=i)),o}(R(o,g.width,g.height),t.key,p,i),u=I(w,n,i,g.width,g.height,a,s,h,d);if(!M(o,u)){const e=S(u,g.width,g.height);c(u,e),l&&l(u,e)}},this.onDocPointerDone=e=>{const{crop:t,disabled:i,onComplete:n,onDragEnd:o}=this.props,r=this.getBox();this.unbindDocMove(),!i&&t&&this.mouseDownOnCrop&&(this.mouseDownOnCrop=!1,this.dragStarted=!1,o&&o(e),n&&n(R(t,r.width,r.height),S(t,r.width,r.height)),this.setState({cropIsActive:!1,newCropIsBeingDrawn:!1}))},this.onDragFocus=()=>{var e;null==(e=this.componentRef.current)||e.scrollTo(0,0)}}get document(){return document}getBox(){const e=this.mediaRef.current;if(!e)return{x:0,y:0,width:0,height:0};const{x:t,y:i,width:n,height:o}=e.getBoundingClientRect();return{x:t,y:i,width:n,height:o}}componentDidUpdate(e){const{crop:t,onComplete:i}=this.props;if(i&&!e.crop&&t){const{width:e,height:n}=this.getBox();e&&n&&i(R(t,e,n),S(t,e,n))}}componentWillUnmount(){this.resizeObserver&&this.resizeObserver.disconnect()}bindDocMove(){this.docMoveBound||(this.document.addEventListener("pointermove",this.onDocPointerMove,_),this.document.addEventListener("pointerup",this.onDocPointerDone,_),this.document.addEventListener("pointercancel",this.onDocPointerDone,_),this.docMoveBound=!0)}unbindDocMove(){this.docMoveBound&&(this.document.removeEventListener("pointermove",this.onDocPointerMove,_),this.document.removeEventListener("pointerup",this.onDocPointerDone,_),this.document.removeEventListener("pointercancel",this.onDocPointerDone,_),this.docMoveBound=!1)}getCropStyle(){const{crop:e}=this.props;if(e)return{top:`${e.y}${e.unit}`,left:`${e.x}${e.unit}`,width:`${e.width}${e.unit}`,height:`${e.height}${e.unit}`}}dragCrop(){const{evData:e}=this,t=this.getBox(),i=this.makePixelCrop(t),n=e.clientX-e.startClientX,o=e.clientY-e.startClientY;return i.x=D(e.startCropX+n,0,t.width-i.width),i.y=D(e.startCropY+o,0,t.height-i.height),i}getPointRegion(e,t,i,n){const{evData:o}=this,r=o.clientX-e.x,a=o.clientY-e.y;let s,h;return s=n&&t?"nw"===t||"n"===t||"ne"===t:a<o.startCropY,h=i&&t?"nw"===t||"w"===t||"sw"===t:r<o.startCropX,h?s?"nw":"sw":s?"ne":"se"}resolveMinDimensions(e,t,i=0,n=0){const o=Math.min(i,e.width),r=Math.min(n,e.height);return t&&(o||r)?t>1?o?[o,o/t]:[r*t,r]:r?[r*t,r]:[o,o/t]:[o,r]}resizeCrop(){const{evData:t}=this,{aspect:i=0,maxWidth:n,maxHeight:o}=this.props,r=this.getBox(),[a,s]=this.resolveMinDimensions(r,i,this.props.minWidth,this.props.minHeight);let h=this.makePixelCrop(r);const d=this.getPointRegion(r,t.ord,a,s),c=t.ord||d;let l=t.clientX-t.startClientX,g=t.clientY-t.startClientY;(a&&"nw"===c||"w"===c||"sw"===c)&&(l=Math.min(l,-a)),(s&&"nw"===c||"n"===c||"ne"===c)&&(g=Math.min(g,-s));const p={unit:"px",x:0,y:0,width:0,height:0};"ne"===d?(p.x=t.startCropX,p.width=l,i?(p.height=p.width/i,p.y=t.startCropY-p.height):(p.height=Math.abs(g),p.y=t.startCropY-p.height)):"se"===d?(p.x=t.startCropX,p.y=t.startCropY,p.width=l,p.height=i?p.width/i:g):"sw"===d?(p.x=t.startCropX+l,p.y=t.startCropY,p.width=Math.abs(l),p.height=i?p.width/i:g):"nw"===d&&(p.x=t.startCropX+l,p.width=Math.abs(l),i?(p.height=p.width/i,p.y=t.startCropY-p.height):(p.height=Math.abs(g),p.y=t.startCropY+g));const w=I(p,i,d,r.width,r.height,a,s,n,o);return i||e.xyOrds.indexOf(c)>-1?h=w:e.xOrds.indexOf(c)>-1?(h.x=w.x,h.width=w.width):e.yOrds.indexOf(c)>-1&&(h.y=w.y,h.height=w.height),h.x=D(h.x,0,r.width-h.width),h.y=D(h.y,0,r.height-h.height),h}renderCropSelection(){const{ariaLabels:t=e.defaultProps.ariaLabels,disabled:i,locked:n,renderSelectionAddon:o,ruleOfThirds:r,crop:a}=this.props,s=this.getCropStyle();if(a)return k.createElement("div",{style:s,className:"ReactCrop__crop-selection",onPointerDown:this.onCropPointerDown,"aria-label":t.cropArea,tabIndex:0,onKeyDown:this.onComponentKeyDown,role:"group"},!i&&!n&&k.createElement("div",{className:"ReactCrop__drag-elements",onFocus:this.onDragFocus},k.createElement("div",{className:"ReactCrop__drag-bar ord-n","data-ord":"n"}),k.createElement("div",{className:"ReactCrop__drag-bar ord-e","data-ord":"e"}),k.createElement("div",{className:"ReactCrop__drag-bar ord-s","data-ord":"s"}),k.createElement("div",{className:"ReactCrop__drag-bar ord-w","data-ord":"w"}),k.createElement("div",{className:"ReactCrop__drag-handle ord-nw","data-ord":"nw",tabIndex:0,"aria-label":t.nwDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"nw"),role:"button"}),k.createElement("div",{className:"ReactCrop__drag-handle ord-n","data-ord":"n",tabIndex:0,"aria-label":t.nDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"n"),role:"button"}),k.createElement("div",{className:"ReactCrop__drag-handle ord-ne","data-ord":"ne",tabIndex:0,"aria-label":t.neDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"ne"),role:"button"}),k.createElement("div",{className:"ReactCrop__drag-handle ord-e","data-ord":"e",tabIndex:0,"aria-label":t.eDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"e"),role:"button"}),k.createElement("div",{className:"ReactCrop__drag-handle ord-se","data-ord":"se",tabIndex:0,"aria-label":t.seDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"se"),role:"button"}),k.createElement("div",{className:"ReactCrop__drag-handle ord-s","data-ord":"s",tabIndex:0,"aria-label":t.sDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"s"),role:"button"}),k.createElement("div",{className:"ReactCrop__drag-handle ord-sw","data-ord":"sw",tabIndex:0,"aria-label":t.swDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"sw"),role:"button"}),k.createElement("div",{className:"ReactCrop__drag-handle ord-w","data-ord":"w",tabIndex:0,"aria-label":t.wDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"w"),role:"button"})),o&&k.createElement("div",{className:"ReactCrop__selection-addon",onPointerDown:e=>e.stopPropagation()},o(this.state)),r&&k.createElement(k.Fragment,null,k.createElement("div",{className:"ReactCrop__rule-of-thirds-hz"}),k.createElement("div",{className:"ReactCrop__rule-of-thirds-vt"})))}makePixelCrop(e){return R({...b,...this.props.crop||{}},e.width,e.height)}render(){const{aspect:e,children:t,circularCrop:i,className:n,crop:o,disabled:r,locked:a,style:s,ruleOfThirds:h}=this.props,{cropIsActive:d,newCropIsBeingDrawn:c}=this.state,l=o?this.renderCropSelection():null,g=((...e)=>e.filter((e=>e&&"string"==typeof e)).join(" "))("ReactCrop",n,d&&"ReactCrop--active",r&&"ReactCrop--disabled",a&&"ReactCrop--locked",c&&"ReactCrop--new-crop",o&&e&&"ReactCrop--fixed-aspect",o&&i&&"ReactCrop--circular-crop",o&&h&&"ReactCrop--rule-of-thirds",!this.dragStarted&&o&&!o.width&&!o.height&&"ReactCrop--invisible-crop",i&&"ReactCrop--no-animate");return k.createElement("div",{ref:this.componentRef,className:g,style:s},k.createElement("div",{ref:this.mediaRef,className:"ReactCrop__child-wrapper",onPointerDown:this.onComponentPointerDown},t),o?k.createElement("svg",{className:"ReactCrop__crop-mask",width:"100%",height:"100%"},k.createElement("defs",null,k.createElement("mask",{id:`hole-${this.instanceId}`},k.createElement("rect",{width:"100%",height:"100%",fill:"white"}),i?k.createElement("ellipse",{cx:`${o.x+o.width/2}${o.unit}`,cy:`${o.y+o.height/2}${o.unit}`,rx:`${o.width/2}${o.unit}`,ry:`${o.height/2}${o.unit}`,fill:"black"}):k.createElement("rect",{x:`${o.x}${o.unit}`,y:`${o.y}${o.unit}`,width:`${o.width}${o.unit}`,height:`${o.height}${o.unit}`,fill:"black"}))),k.createElement("rect",{fill:"black",fillOpacity:.5,width:"100%",height:"100%",mask:`url(#hole-${this.instanceId})`})):void 0,l)}};Z.xOrds=["e","w"],Z.yOrds=["n","s"],Z.xyOrds=["nw","ne","se","sw"],Z.nudgeStep=1,Z.nudgeStepMedium=10,Z.nudgeStepLarge=100,Z.defaultProps={ariaLabels:{cropArea:"Use the arrow keys to move the crop selection area",nwDragHandle:"Use the arrow keys to move the north west drag handle to change the crop selection area",nDragHandle:"Use the up and down arrow keys to move the north drag handle to change the crop selection area",neDragHandle:"Use the arrow keys to move the north east drag handle to change the crop selection area",eDragHandle:"Use the up and down arrow keys to move the east drag handle to change the crop selection area",seDragHandle:"Use the arrow keys to move the south east drag handle to change the crop selection area",sDragHandle:"Use the up and down arrow keys to move the south drag handle to change the crop selection area",swDragHandle:"Use the arrow keys to move the south west drag handle to change the crop selection area",wDragHandle:"Use the up and down arrow keys to move the west drag handle to change the crop selection area"}};let B=Z;var j=i(480),P=i(86628),K=i(24405),O=i(51454),A=i(9291),$=i(68785),Y=i(50506),L=i(4827),N=i(89728),U=i(58297),W=i(81865),X=i(33929),V=i(64424),F=i(42853),T=i(45238),z=i(85893);const q=(0,T.IU)("squareOnCircle",{viewBox:"0 0 20 20",svg:(0,z.jsx)("path",{d:"M2.07031 7.85645C2.07031 7.05436 2.2207 6.30469 2.52148 5.60742C2.82227 4.91016 3.23926 4.2972 3.77246 3.76855C4.30566 3.23991 4.92318 2.8252 5.625 2.52441C6.33138 2.21908 7.08561 2.06641 7.8877 2.06641C8.57585 2.06641 9.22982 2.18034 9.84961 2.4082C10.4694 2.63151 11.0322 2.94596 11.5381 3.35156C12.0439 3.75716 12.4701 4.2334 12.8164 4.78027C13.1673 5.32715 13.4157 5.92188 13.5615 6.56445H12.2354C12.0531 5.94466 11.7477 5.39323 11.3193 4.91016C10.8955 4.42708 10.3874 4.04655 9.79492 3.76855C9.20703 3.49056 8.57129 3.35156 7.8877 3.35156C7.26335 3.35156 6.67546 3.46777 6.12402 3.7002C5.57259 3.93262 5.08952 4.25618 4.6748 4.6709C4.26009 5.08561 3.93424 5.56641 3.69727 6.11328C3.46484 6.6556 3.34863 7.23665 3.34863 7.85645C3.34863 8.58561 3.50814 9.26237 3.82715 9.88672C4.15072 10.5065 4.58822 11.0283 5.13965 11.4521C5.69108 11.8714 6.31771 12.1471 7.01953 12.2793V13.5781C6.31771 13.4779 5.66602 13.2591 5.06445 12.9219C4.46289 12.5846 3.9388 12.1608 3.49219 11.6504C3.04557 11.1354 2.69694 10.5566 2.44629 9.91406C2.19564 9.26693 2.07031 8.58105 2.07031 7.85645ZM8.75586 17.4678C8.01758 17.4678 7.45931 17.2809 7.08105 16.9072C6.7028 16.5335 6.51367 15.9798 6.51367 15.2461V8.27344C6.51367 7.54427 6.7028 6.99284 7.08105 6.61914C7.45931 6.24089 8.01758 6.05176 8.75586 6.05176H15.6807C16.4189 6.05176 16.9772 6.24089 17.3555 6.61914C17.7337 6.99284 17.9229 7.54427 17.9229 8.27344V15.2461C17.9229 15.9798 17.7337 16.5335 17.3555 16.9072C16.9772 17.2809 16.4189 17.4678 15.6807 17.4678H8.75586ZM8.83789 16.1279H15.5986C15.9176 16.1279 16.1615 16.0436 16.3301 15.875C16.4987 15.7064 16.583 15.458 16.583 15.1299V8.39648C16.583 8.0638 16.4987 7.81543 16.3301 7.65137C16.1615 7.48275 15.9176 7.39844 15.5986 7.39844H8.83789C8.52344 7.39844 8.2819 7.48275 8.11328 7.65137C7.94466 7.81543 7.86035 8.0638 7.86035 8.39648V15.1299C7.86035 15.458 7.94466 15.7064 8.11328 15.875C8.2819 16.0436 8.52344 16.1279 8.83789 16.1279Z"})}),G=(0,T.IU)("squareOnCircleFilled",{viewBox:"0 0 20 20",svg:(0,z.jsx)("path",{d:"M4.53809 13.4795V6.56836C4.53809 5.83464 4.72721 5.28092 5.10547 4.90723C5.48372 4.53353 6.04427 4.34668 6.78711 4.34668H13.6504C14.3887 4.34668 14.9469 4.53353 15.3252 4.90723C15.7035 5.28092 15.8926 5.83464 15.8926 6.56836V13.4795C15.8926 14.2132 15.7035 14.7669 15.3252 15.1406C14.9469 15.5143 14.3887 15.7012 13.6504 15.7012H6.78711C6.04427 15.7012 5.48372 15.5143 5.10547 15.1406C4.72721 14.7669 4.53809 14.2132 4.53809 13.4795ZM6.78711 3.34863C6.10807 3.34863 5.52474 3.47852 5.03711 3.73828C4.55404 3.99349 4.1849 4.36263 3.92969 4.8457C3.67448 5.32422 3.54688 5.89844 3.54688 6.56836V11.4629C2.85872 11.1621 2.25033 10.7451 1.72168 10.2119C1.19303 9.67871 0.780599 9.06348 0.484375 8.36621C0.188151 7.66439 0.0400391 6.91471 0.0400391 6.11719C0.0400391 5.3151 0.19043 4.56315 0.491211 3.86133C0.791992 3.15951 1.20898 2.54199 1.74219 2.00879C2.27539 1.47559 2.8929 1.05859 3.59473 0.757812C4.30111 0.452474 5.05534 0.299805 5.85742 0.299805C6.59115 0.299805 7.28385 0.429688 7.93555 0.689453C8.58724 0.944661 9.17057 1.30241 9.68555 1.7627C10.2051 2.21842 10.6289 2.74707 10.957 3.34863H6.78711Z"})});var J=i(98519),Q=i(52275),ee=i(31945),te=i(78140),ie=i(85740),ne=i(72495),oe=i(60709),re=i(4023);const ae=(0,T.IU)("verticalRectangle",{viewBox:"0 0 16 16",svg:(0,z.jsx)("path",{d:"M.973 12.693V2.852c0-.63.16-1.106.48-1.43.32-.328.795-.492 1.424-.492h6.24c.63 0 1.104.164 1.424.492.32.324.48.8.48 1.43v9.841c0 .633-.16 1.112-.48 1.436-.32.324-.795.486-1.424.486h-6.24c-.629 0-1.104-.162-1.424-.486-.32-.324-.48-.803-.48-1.436zm1.154-.07c0 .27.07.477.21.621.142.145.354.217.64.217h6.046c.286 0 .498-.072.64-.217.14-.144.21-.351.21-.621V2.928c0-.274-.07-.483-.21-.627-.142-.149-.354-.223-.64-.223H2.977c-.286 0-.498.074-.64.223-.14.144-.21.353-.21.627v9.695z"})});var se=i(18970),he=i(73063),de=i(77080);function ce(e){const{aspectRatio:t}=e;return(0,z.jsxs)("div",{children:[(0,z.jsx)(he.Z,{icon:ae,iconStyle:{width:16,height:16,transform:"translate(2px, 0px)"},ariaLabel:`${t} aspect ratio flipped`,onClick:()=>V.Z.setFixedAspectRatio(t,!0)}),(0,z.jsx)(he.Z,{icon:ae,iconStyle:{width:16,height:16,transform:"translate(0px, 2px) rotate(90deg)"},ariaLabel:`${t} aspect ratio`,onClick:()=>V.Z.setFixedAspectRatio(t,!1)})]})}const le=function(e){const t=(0,P.VK)((()=>{if(V.Z.state.open)return V.Z.state.fixedAspectSelection}),[]),i=(0,P.VK)((()=>!!V.Z.state.open&&V.Z.state.aspectSelectionFlipped),[]),n=(0,P.VK)((()=>de.default.checkGate("image_cropping_aspect_ratios")),[]),[o,r]=(0,k.useState)();return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Q.Z,{focused:!1,onClick:()=>V.Z.setFixedAspectRatio("1:1",!1),title:"Square",right:"1:1"===t?e.checkIcon:void 0},"1:1 aspect ratio"),n&&Object.keys(se.V3).filter((e=>"1:1"!==e)).map((n=>{const{width:a,height:s}=se.V3[n],h=function(e,t,i){return i?`${t}:${e}`:`${e}:${t}`}(a,s,i),d=t===n,c=o===n?(0,z.jsx)(ce,{aspectRatio:n}):d?e.checkIcon:void 0;return(0,z.jsx)(Q.Z,{focused:!1,onMouseEnter:()=>r(n),onMouseLeave:()=>r(void 0),onClick:()=>V.Z.setFixedAspectRatio(n,i),title:h,right:c},h)}))]})};const ge=function(e){const t=(0,P.VK)((()=>{var e;return null===(e=V.Z.getEditMetadata())||void 0===e?void 0:e.mask}),[]),i=(0,P.VK)((()=>V.Z.state.open&&V.Z.state.fixedAspectSelection),[]),n="None"===t&&void 0===i,o=(0,K.yK)((e=>({button:{display:"flex",color:e.icon.secondary},divider:{color:e.stroke.deemphasized,opacity:.2},filledIcon:{width:20,transform:"translate(2px, 2px)",fill:e.blueButtonBackground},checkIcon:{width:14,height:14,color:e.icon.secondary}})),[]),r=(0,k.useMemo)((()=>n?q({width:20}):G(o.filledIcon)),[n,o.filledIcon]),a=(0,k.useMemo)((()=>(0,J.k)(o.checkIcon)),[o.checkIcon]);return(0,z.jsx)(ee.ZP,{alignmentToOrigin:re.v.Start,renderOrigin:e=>{let{onClick:t}=e;return(0,z.jsxs)(ie.Z,{onClick:t,style:o.button,children:[r,(0,F.i)({width:10,marginLeft:2})]})},popupType:ee.Z4.Popup,render:()=>(0,z.jsx)(te.Z,{menuType:oe.og.Popup,children:(0,z.jsxs)(ne.Z,{children:[(0,z.jsx)(Q.Z,{focused:!1,onClick:()=>V.Z.setMask("None"),title:"Freeform",right:n?a:void 0},"free-mask"),(0,z.jsx)("hr",{style:o.divider}),(0,z.jsx)(Q.Z,{focused:!1,onClick:()=>V.Z.setMask("Circle"),title:"Circle",right:"Circle"===t?a:void 0},"circle-mask"),(0,z.jsx)(le,{checkIcon:a})]})})})};function pe(e){const t=(0,j.O7)(),i=X.default.getIntl(),n=(0,P.VK)((()=>V.Z.state),[]),o=(0,P.VK)((()=>V.Z.getIsImageLoaded()),[]),r=(0,P.VK)((()=>V.Z.getEditMetadata()),[]),a=(0,k.useRef)(null),s=function(e){const{isImageLoaded:t}=e;return(0,K.yK)((e=>({modal:{display:t?"flex":"none",borderRadius:"12px"},dragHandle:{color:e.primaryBlack,opacity:e.dragHandleOpacity},cropMask:{color:e.white,opacity:e.cropMaskOpacity},container:{flexDirection:"column",justifyContent:"center",alignItems:"center"},cropWindow:{padding:"30px",background:e.surface.wash},image:{width:"auto",minWidth:"400px",maxHeight:"70vh",maxWidth:"90vw"},loadingSpinner:{display:t?"none":"block",width:"32px",height:"32px"},loadingSpinnerOverlay:{zIndex:O.mJ,width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:e.overlaySmokescreen}})),[t])}({isImageLoaded:o});return(0,k.useEffect)((()=>{document.documentElement.style.setProperty("--drag-handle-color",s.dragHandle.color),document.documentElement.style.setProperty("--drag-handle-opacity",s.dragHandle.opacity),document.documentElement.style.setProperty("--crop-mask-color",s.cropMask.color),document.documentElement.style.setProperty("--crop-mask-opacity",s.cropMask.opacity)}),[s.cropMask,s.dragHandle]),n.open?(0,z.jsxs)("div",{children:[(0,z.jsx)(L.Z,{open:n.open&&!o,children:(0,z.jsx)("div",{style:s.loadingSpinnerOverlay,children:(0,z.jsx)($.Z,{isWhite:!0,style:s.loadingSpinner})})}),(0,z.jsx)(Y.Z,{style:s.modal,open:n.open,onDismiss:ue,render:()=>(0,z.jsx)("div",{style:s.container,children:(0,z.jsx)(W.Z,{url:n.originalSource,render:(e,o)=>(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(we,{onSave:()=>{var e;n.open&&(e={editMetadata:r,store:n.blockStore,environment:t},l.Z.setStatusPending(e.store.id,e.editMetadata),async function(e,t){const i=e.getOriginalImageSource();if(!i)return void l.Z.setStatusError(e.id);const n=await(0,W.b)({url:i,isAuthenticated:!0,permissionRecord:e.pointer},t);w({store:e,environment:t,proxiedOriginalUrl:n})}(e.store,e.environment),V.Z.setSaveButtonLoading(!0),setTimeout((()=>{V.Z.closeModal()}),750))},onClose:()=>{ue()}}),(0,z.jsx)("div",{style:s.cropWindow,children:(0,z.jsx)(B,{onChange:(e,t)=>{V.Z.setCrop(t)},crop:r.crop,minHeight:p,minWidth:p,keepSelection:!0,aspect:n.open&&n.cropAspect,circularCrop:"Circle"===(null==r?void 0:r.mask),children:(0,z.jsx)("img",{ref:a,src:o,alt:i.formatMessage({id:"imageEditModal.image.altText",defaultMessage:"Original image to edit"}),onLoad:()=>function(e){V.Z.setIsImageLoaded(e),null===(t=document.querySelector(".ReactCrop__crop-mask"))||void 0===t||t.setAttribute("height","100%");var t}(a),style:s.image})})})]}),isAuthenticated:!0,permissionRecord:n.blockStore.pointer})})})]}):null}function we(e){const{onSave:t,onClose:i}=e,n=(0,K.yK)((e=>({toolbar:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",width:"100%",background:e.modalBackground,borderBottom:`1px solid ${e.stroke.deemphasized}`,padding:"12px"},buttonGroup:{display:"flex",flexDirection:"row",justifyContent:"space-around",gap:"5px"},title:{position:"absolute",marginLeft:"auto",marginRight:"auto",left:0,right:0,textAlign:"center",width:"fit-content",fontWeight:"400"}})),[]),o=(0,P.VK)((()=>V.Z.state.open&&V.Z.state.saveButtonLoading),[]);return(0,z.jsxs)("div",{style:n.toolbar,children:[(0,z.jsx)("div",{children:(0,z.jsx)(ge,{})}),(0,z.jsx)("div",{style:n.title,children:(0,z.jsx)(A.FormattedMessage,{id:"imageEditModal.title",defaultMessage:"Crop image"})}),(0,z.jsxs)("div",{style:n.buttonGroup,children:[(0,z.jsx)(N.Z,{onClick:i,isGray:!0,children:(0,z.jsx)(A.FormattedMessage,{id:"imageEditModal.cancelButton.label",defaultMessage:"Cancel"})}),(0,z.jsx)(U.Z,{onClick:t,isLoading:o,children:(0,z.jsx)(A.FormattedMessage,{id:"imageEditModal.saveButton.label",defaultMessage:"Save"})})]})]})}function ue(){V.Z.closeModal()}}}]);