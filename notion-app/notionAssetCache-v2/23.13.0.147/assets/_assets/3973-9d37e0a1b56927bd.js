"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[3973],{36154:(e,t,n)=>{n.d(t,{L6:()=>Ht,aU:()=>mt,Yw:()=>We});var o=n(27537),a=n.n(o),s=n(48317),i=n(15145),r=n(41432),l=n(61061),c=n(27714),d=n(38491),u=n(55863),m=n(70203),p=n(9291),g=n(19719),f=n(66324),h=n(1302),v=n(27724),y=n(44886),b=n(61045),S=n(24677);var k=n(6404),M=n(893),C=n(30188),N=n(42239),w=n(47839),P=n(36280),x=n(45990),I=n(91376),R=n(17659),T=n(87420),A=n(52423),L=n(75754),_=n(8055),E=n(1357),Z=n(87531),D=n(42858),V=n(29974),j=n(993),B=n(22974),U=n(29373),O=n(13447),q=n(68422),K=n(19037),F=n(28020),z=n(92783),W=n(18514),H=n(95697),G=n(77907),Y=n(50770),J=n(62967),$=n(94841),Q=n(30806);const X=(0,J.cs)({key:"open home",displayName:void 0,analyticsName:"openHome",validators:[K.jlf],shortcuts:["openHome"],closeParentMenu:!0,action:async e=>{const t=e.environment,n=$.J2("main");n&&(await n.load(),n.canRead()&&((0,Q.$X)({environment:t,from:"keyboard_shortcut"}),L._c({environment:t,store:n,pageVisitSource:i.tY.SidebarHome})))}});var ee=n(57345),te=n(74948),ne=n(24646),oe=n(38676),ae=n(36391),se=n(80444),ie=n(21273),re=n(98180),le=n(85526),ce=n(88923),de=n(29026),ue=n(62820),me=n(9867),pe=n(21797),ge=n(95554),fe=n(89941),he=n(52922),ve=n(82763),ye=n(35067),be=n(93685),Se=n(29768),ke=n(20422),Me=n(2295),Ce=n(12988),Ne=n(6471),we=n(98604),Pe=n(10906),xe=n(58202),Ie=n(69316);const Re=(0,p.defineMessages)({searchName:{id:"action.search.name",defaultMessage:"Search"}}),Te=(0,J.cs)({key:"search",displayName:Re.searchName,analyticsName:Re.searchName.defaultMessage,validators:[K.jlf,K.daU,K.ffD(K.QLY("native-find-in-page"))],shortcuts:["search"],closeParentMenu:!0,action:e=>{const t=ce.default.isCenterPeekOpen();w.inPageSearch.start(t)}}),Ae=(0,J.cs)({key:"search",displayName:Re.searchName,analyticsName:Re.searchName.defaultMessage,validators:[K.jlf,K.QLY("native-find-in-page"),K.lvA,K.ffD(K.hrD)],shortcuts:["search"],closeParentMenu:!0,action:()=>{var e,t;const n=(0,F.np)();if(!n)return;const o=n.isCollectionView(),a=(0,Pe.fm)(n),s="page"===(null==a||null===(e=a.collectionViewStore())||void 0===e?void 0:e.getType());if(o&&!s){const e=xe.R.findCollectionViewBlockFromStore(n);return void(null==e||e.collectionContextStore.searchOpen.setState(!0))}const{open:i,focused:r}=Ie.Z.state,l=Ie.Z.hasFindQuery(),c=null===(t=window.getSelection())||void 0===t?void 0:t.toString();if(i){if(i&&r)return void we.xv({clearQuery:!1})}else we.bA({currentTextSelection:c,shouldSelectAllInput:l&&0===(null==c?void 0:c.length)})}});var Le=n(41670),_e=n(11732);function Ee(e){return void 0!==e.shortcuts}const Ze=(0,p.defineMessages)({enterName:{id:"action.enter.name",defaultMessage:"Enter"},syncPageName:{id:"action.syncPage.name",defaultMessage:"Save for offline"},resyncPageName:{id:"action.resyncPage.name",defaultMessage:"Refresh offline data"},unsyncPageName:{id:"action.unsyncPage.name",defaultMessage:"Remove from offline"},edit:{id:"action.edit.name",defaultMessage:"Edit"},quickFindName:{id:"action.quickFind.name",defaultMessage:"Quick find"},copyLinktoViewName:{id:"action.copyLinktoView.name",defaultMessage:"Copy link to view"},zoomInName:{id:"action.zoomIn.name",defaultMessage:"Zoom in"},zoomOutName:{id:"action.zoomOut.name",defaultMessage:"Zoom out"},resetZoomName:{id:"action.resetZoom.name",defaultMessage:"Reset zoom"},blockSelectionCompletionName:{id:"action.blockSelectionCompletionName.name",defaultMessage:"Ask AI"},copyFormattedLinkNavigableTypeName:{id:"action.copyFormattedLinkNavigableType.name",defaultMessage:"Copy linked title"},copyLinkToCurrentPageSnackBarMessage:{id:"action.copyLinkToCurrentPage.snackBarMessage",defaultMessage:"Link to current page copied to clipboard"},pasteName:{id:"action.paste.name",defaultMessage:"Paste"},moveUpName:{id:"action.moveUp.name",defaultMessage:"Move up"},moveDownName:{id:"action.moveDown.name",defaultMessage:"Move down"},propertyVisibilityLabel:{id:"action.propertyVisibility.label",defaultMessage:"Toggle property visibility"},databaseLockLabel:{id:"action.databaseLock.label",defaultMessage:"Database lock"},wrapCellsName:{id:"action.wrapAllColumns.name",defaultMessage:"Wrap all columns"},createLinkName:{id:"action.createLink.name",defaultMessage:"Create link"},createEquationName:{id:"action.createEquation.name",defaultMessage:"Create equation"},filterName:{id:"action.filter.name",defaultMessage:"Filter"},sortName:{id:"action.sort.name",defaultMessage:"Sort"},legacyGroupByName:{id:"action.legacyGroupBy.name",defaultMessage:"Group by"},groupByName:{id:"action.groupBy.name",defaultMessage:"Group"},subGroupByName:{id:"action.subGroupBy.name",defaultMessage:"Sub-group"},propertiesName:{id:"action.properties.name",defaultMessage:"Properties"},templatesName:{id:"action.templates.name",defaultMessage:"Templates"},calendarByName:{id:"action.calendarBy.name",defaultMessage:"Calendar by"},timelineByName:{id:"action.timelineBy.name",defaultMessage:"Timeline by"},noDateName:{id:"action.noDate.name",defaultMessage:"No date"},boldName:{id:"action.bold.name",defaultMessage:"Bold"},italicName:{id:"action.italic.name",defaultMessage:"Italic"},strikeThroughName:{id:"action.strikeThrough.name",defaultMessage:"Strike-through"},underlineName:{id:"action.underline.name",defaultMessage:"Underline"},darkModeName:{id:"action.darkMode.name",defaultMessage:"Dark mode"},openAsPageName:{id:"action.openAsPage.name",defaultMessage:"Open as page"},openAllTogglesName:{id:"action.openAllToggles.name",defaultMessage:"Open all toggles"},toggleRecordingInputLatencyName:{id:"action.toggleRecordingInputLatency.name",defaultMessage:"Toggle recording input latency"},suggestedSlashMenuSection:{id:"slashMenu.suggestedSection.title",defaultMessage:"Suggested"},more:{defaultMessage:"See more",id:"slashMenu.more.title"},toggleSidePeekMessage:{defaultMessage:"Toggle side peek",id:"searchModal.Sidepeek.name"},toggleQnAMessage:{defaultMessage:"Toggle QnA",id:"action.toggleQnA.name"}});function De(e){return"key"in e}function Ve(e){return"clipboardData"in e}const je=[K.J5S,K.ffD(K.OPg),K.FSO];function Be(e){return(0,J.cs)({...e,validators:je,closeParentMenu:!0,action:t=>{let{environment:n,blocks:o}=t;O.createAndCommit({userAction:"actionRegistry.createAnnotationAction",environment:n,perform:t=>{j.Du({environment:n,blocks:o,annotation:e.annotation,transaction:t})}})}})}const Ue=(0,J.cs)({key:"quick find",displayName:Ze.quickFindName,analyticsName:Ze.quickFindName.defaultMessage,validators:[K.lvA],shortcuts:["quickFind"],closeParentMenu:!0,action:e=>{let{environment:t}=e;Z.Kf({environment:t,analyticsFrom:"keyboard-shortcut"})}}),Oe=(0,J.cs)({key:"toggle side peek",displayName:Ze.toggleSidePeekMessage,analyticsName:Ze.toggleSidePeekMessage.defaultMessage,validators:[K.ATo,K.FOc,K.QLY("search_toggle_side_peek")],closeParentMenu:!0,shortcuts:["toggleSidebar"],action:()=>Z.bn()}),qe=(0,J.cs)({key:"quick find (alternative)",displayName:Ze.quickFindName,analyticsName:Ze.quickFindName.defaultMessage,validators:[K.or([K.lvA,K.MpE]),K.ffD(K.xDy([K.DaG,K.KLp]))],shortcuts:["openLinkMenuOrOpenSearch"],closeParentMenu:!0,action:e=>{let{environment:t}=e;Z.Kf({environment:t,analyticsFrom:"keyboard-shortcut-command-k"})}}),Ke=(0,J.cs)({key:"toggle all updates",displayName:void 0,analyticsName:"toggleAllUpdates",validators:[K.jlf],shortcuts:["toggleAllUpdates"],closeParentMenu:!0,action:e=>{if((0,Y.H7)(e.environment))return void R.w1(e.environment);const t=!ue.Z.state.open;ue.Z.setState({open:t}),t?g.GP({environment:e.environment,forceRestartSession:!0,from:"keyboard-shortcut"}):g.nI(e.environment)}}),Fe=(0,J.cs)({key:"toggle all teams",displayName:void 0,analyticsName:"toggleAllTeams",validators:[K.jlf,H.bq],shortcuts:["toggleAllTeams"],closeParentMenu:!0,action:e=>{let{environment:t}=e;return me.tn(t,{from:"sidebar_browse_team_item"})}}),ze=(0,J.cs)({key:"open share menu",displayName:void 0,analyticsName:"openShareMenu",validators:[K.jlf],shortcuts:["openShareMenu"],closeParentMenu:!0,action:e=>{let{environment:t}=e;return ee.lG(t)}}),We=(0,J.cs)({key:"undo",displayName:J.RE.undoName,analyticsName:J.RE.undoName.defaultMessage,svg:u.s,validators:[K.jlf,K.ffD(K.tqC),K.ffD(K.P99(r.Ti.externalObjectInstancePage)),K.ffD(K.uY7)],shortcuts:["undo"],closeParentMenu:!0,action:e=>{let{environment:t}=e;return A.Yw(t)}}),He=(0,J.cs)({key:"redo",displayName:J.RE.redoName,analyticsName:J.RE.redoName.defaultMessage,svg:d.N,validators:[],shortcuts:["redo"],closeParentMenu:!0,action:e=>{let{environment:t}=e;return A.KX(t)}}),Ge=(0,J.cs)({key:"up",analyticsName:"Up",displayName:void 0,validators:[],shortcuts:["up"],closeParentMenu:!0,action:(e,t)=>{let{environment:n}=e;if(t&&De(t))return t.metaKey||t.ctrlKey?S.w5(n):void S.zJ({environment:n,shiftKey:Boolean(t&&t.shiftKey),altKey:Boolean(t&&t.altKey)})}}),Ye=(0,J.cs)({key:"left",analyticsName:"Left",displayName:void 0,validators:[],shortcuts:["left"],closeParentMenu:!0,action:(e,t)=>{let{environment:n}=e;t&&De(t)&&S.e2(n)}}),Je=(0,J.cs)({key:"down",analyticsName:"Down",displayName:void 0,validators:[],shortcuts:["down"],closeParentMenu:!0,action:(e,t)=>{let{environment:n}=e;if(t&&De(t))return t.metaKey||t.ctrlKey?S.hn(n):void S.DI({environment:n,shiftKey:Boolean(t&&t.shiftKey),altKey:Boolean(t&&t.altKey)})}}),$e=(0,J.cs)({key:"right",analyticsName:"Right",displayName:void 0,validators:[],shortcuts:["right"],closeParentMenu:!0,action:e=>{let{environment:t}=e;S.FC(t)}}),Qe=(0,J.cs)({key:"context menu",analyticsName:"Context menu",displayName:void 0,validators:[K.KHO,K.ffD(K.OPg)],shortcuts:["commandSlash"],closeParentMenu:!0,action:e=>{let{environment:t}=e;const{stores:n}=v.default.state;k.$Z({environment:t,stores:n,actionSectionGroupKey:"default",analyticsFrom:"command_slash_menu"})}}),Xe=(0,J.cs)({key:"indent",analyticsName:"Indent",displayName:void 0,validators:[K.J5S,K.ffD(K.OPg),K.Eok,K.ffD(K.AKv)],shortcuts:["tab"],closeParentMenu:!0,action:e=>{let{environment:t}=e;O.createAndCommit({userAction:"actionRegistry.indent",environment:t,perform:e=>{!function(e){const t=v.default.state.stores;if(t.length>0){const n=y.WY({environment:e.environment,blocks:t,transaction:e.transaction});n&&S.Z5({environment:e.environment,stores:n})}}({environment:t,transaction:e})}})}}),et=(0,J.cs)({key:"subitemIndent",analyticsName:"Toggle By Indent",displayName:void 0,validators:[K.J5S,K.ffD(K.OPg),K.Eok,K.AKv,K.y9X,K.v_H],shortcuts:["tab"],closeParentMenu:!0,action:e=>{let{blocks:t,environment:n}=e;O.createAndCommit({userAction:"actionRegistry.subitemIndent",environment:n,perform:e=>{C.wA({environment:n,transaction:e,blocks:t,action:"indentSelfAndSubtree"})}})}}),tt=(0,J.cs)({key:"unindent",analyticsName:"Unindent",displayName:void 0,validators:[K.J5S,K.ffD(K.OPg),K.Eok,K.ffD(K.AKv)],shortcuts:["untab"],closeParentMenu:!0,action:e=>{let{environment:t}=e;O.createAndCommit({userAction:"actionRegistry.unindent",environment:t,perform:e=>{!function(e){const t=v.default.state.stores;if(t.length>0){const n=y.rB({environment:e.environment,blocks:t,transaction:e.transaction});n&&S.Z5({environment:e.environment,stores:n})}}({environment:t,transaction:e})}})}}),nt=(0,J.cs)({key:"subitemUnindent",analyticsName:"Toggle By Unindent",displayName:void 0,validators:[K.J5S,K.ffD(K.OPg),K.Eok,K.AKv,K.y9X,K.v_H],shortcuts:["untab"],closeParentMenu:!0,action:e=>{let{blocks:t,environment:n}=e;O.createAndCommit({userAction:"actionRegistry.subitemUnindent",environment:n,perform:e=>{C.wA({environment:n,transaction:e,blocks:t,action:"unindentSelf"})}})}}),ot=(0,J.cs)({key:"escape",analyticsName:"Escape",displayName:void 0,validators:[K.ffD(K.lPL)],shortcuts:["esc"],closeParentMenu:!0,action:e=>{let{environment:t}=e;N.cQ(t),S.ZH(t),T.jG(t)}}),at=(0,J.cs)({key:"escape",analyticsName:"Quick Search Escape",displayName:void 0,validators:[K.lPL],shortcuts:["esc"],closeParentMenu:!0,action:()=>{de.ZP.state.query.text.length>0?de.ZP.updateQueryText(""):w.closeQuickSearch()}}),st=(0,J.cs)({key:"select all",analyticsName:"Select all",displayName:void 0,validators:[],shortcuts:["selectAll"],closeParentMenu:!0,action:e=>{let{environment:t}=e;S.td(t)}}),it=(0,J.cs)({key:"cut",analyticsName:"Cut",displayName:void 0,validators:[K.J5S,K.ffD(K.OPg),K.ryx],shortcuts:["cut"],closeParentMenu:!0,action:(e,t)=>{let{environment:n,lazyDependencies:{markdownLinkifyIt:o}}=e;t&&Ve(t)&&M.by({environment:n,event:t,markdownLinkifyIt:o})}}),rt=(0,J.cs)({key:"copy",analyticsName:"Copy",displayName:void 0,validators:[],shortcuts:["copy"],closeParentMenu:!0,action:(e,t)=>{let{environment:n,lazyDependencies:{markdownLinkifyIt:o}}=e;t&&Ve(t)&&M.JG({environment:n,event:t,markdownLinkifyIt:o})}}),lt=(0,J.cs)({key:"zoom in",displayName:Ze.zoomInName,analyticsName:Ze.zoomInName.defaultMessage,validators:[K.daU,K.ffD(K.ar_)],shortcuts:["zoomIn"],closeParentMenu:!0,action:()=>{w.zoomIn()}}),ct=(0,J.cs)({key:"zoom out",displayName:Ze.zoomOutName,analyticsName:Ze.zoomOutName.defaultMessage,validators:[K.daU,K.ffD(K.ar_)],shortcuts:["zoomOut"],closeParentMenu:!0,action:()=>{w.zoomOut()}}),dt=(0,J.cs)({key:"zoom reset",displayName:Ze.resetZoomName,analyticsName:Ze.resetZoomName.defaultMessage,validators:[K.daU,K.ffD(K.ar_)],shortcuts:["zoomReset"],closeParentMenu:!0,action:()=>{w.zoomReset()}});function ut(){const{mainEditorCurrentBlockStore:e}=se.default.state;return ce.default.state.open&&ce.default.state.target||e}const mt=(0,J.cs)({key:"copy link to current page",displayName:J.RE.copyLinkNavigableTypeName,analyticsName:J.RE.copyLinkNavigableTypeName.defaultMessage,svg:c.N,validators:[K.daU,K.ffD(K.uY7)],shortcuts:["copyLinkToCurrentPage"],closeParentMenu:!0,action:(e,t)=>{let{environment:n}=e;const o=ut();o&&M.Hs({environment:n,blocks:[o],event:t})}}),pt=(0,J.cs)({key:"copy linkified page title to current page",displayName:Ze.copyFormattedLinkNavigableTypeName,analyticsName:Ze.copyFormattedLinkNavigableTypeName.defaultMessage,svg:c.N,validators:[],shortcuts:["copyCurrentPageLinkifiedBlockTitle"],closeParentMenu:!0,action:(e,t)=>{let{environment:n}=e;const o=ut();o&&M.VG({environment:n,blocks:[o],event:t})}}),gt=(0,J.cs)({key:"paste",displayName:Ze.pasteName,analyticsName:Ze.pasteName.defaultMessage,validators:[K.J5S,K.ffD(K.OPg),K.ryx,K.NZn,K.jlf],shortcuts:["paste"],closeParentMenu:!0,action:(e,t)=>{let{environment:n,lazyDependencies:{markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:a}}=e;t&&Ve(t)&&O.createAndCommit({userAction:"actionRegistry.paste",environment:n,perform:e=>{M.v({environment:n,event:t,disableEmbedMenu:!0,transaction:e,onPasteFiles:M.AL,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:a})}})}}),ft=(0,J.cs)({key:"move up",displayName:Ze.moveUpName,analyticsName:Ze.moveUpName.defaultMessage,validators:[K.J5S,K.Eok,K.ffD(K.AKv)],shortcuts:["moveUp"],closeParentMenu:!0,action:e=>{let{environment:t}=e;O.createAndCommit({userAction:"actionRegistry.moveUp",environment:t,perform:e=>{!async function(e){const t=y.A1({transaction:e.transaction,blocks:v.default.state.stores});t&&(S.Z5({environment:e.environment,stores:t}),await h.default.afterNextFlush(),b.Zv())}({environment:t,transaction:e})}})}}),ht=(0,J.cs)({key:"move down",displayName:Ze.moveDownName,analyticsName:Ze.moveDownName.defaultMessage,validators:[K.J5S,K.Eok,K.ffD(K.AKv)],shortcuts:["moveDown"],closeParentMenu:!0,action:e=>{let{environment:t}=e;O.createAndCommit({userAction:"actionRegistry.moveDown",environment:t,perform:e=>{!async function(e){const t=y.vi({transaction:e.transaction,blocks:v.default.state.stores});t&&(S.Z5({environment:e.environment,stores:t}),await h.default.afterNextFlush(),b.Zv())}({environment:t,transaction:e})}})}}),vt=(0,J.cs)({key:"property visibility",displayName:Ze.propertyVisibilityLabel,analyticsName:Ze.propertyVisibilityLabel.defaultMessage,svg:l.B,shortcuts:["togglePropertyVisibility"],validators:[K.J5S,K.ffD(K.YGm)],closeParentMenu:!0,action:e=>{le.Z.setState({...le.Z.state,forceShowProperties:!le.Z.state.forceShowProperties})}}),yt=(0,J.cs)({key:"enter",displayName:Ze.enterName,analyticsName:Ze.enterName.defaultMessage,validators:[K.J5S,K.ffD(K.OPg)],shortcuts:["enter"],closeParentMenu:!0,action:e=>{let{environment:t,blocks:n}=e;O.createAndCommit({userAction:"actionRegistry.enter",environment:t,perform:e=>{D.mp({blocks:n,transaction:e})}})}}),bt=(0,J.cs)({key:"activate",analyticsName:"Activate",displayName:void 0,validators:[K.J5S,K.nWT],shortcuts:["commandEnter"],closeParentMenu:!0,action:e=>D.QZ(e)}),St=(0,J.cs)({key:"open tab",analyticsName:"open tab",displayName:void 0,validators:[K.fy9],shortcuts:["commandEnter"],closeParentMenu:!0,action:e=>D.Ah(e)}),kt=(0,J.cs)({key:"toggle sidebar",analyticsName:"Toggle sidebar",displayName:void 0,validators:[K.ffD(K.ATo)],shortcuts:["toggleSidebar"],closeParentMenu:!0,action:e=>{let{environment:t}=e;return te.setExpand({environment:t,isExpanded:!oe.sidebarExpandedStore.state,from:"action_registry"})}}),Mt=(0,J.cs)({key:"toggle favorite",analyticsName:"Toggle favorite",displayName:void 0,validators:[K.jlf,K.NZn],shortcuts:["toggleFavorite"],closeParentMenu:!0,action:e=>{let{environment:t}=e;const{currentSpaceViewStore:n}=se.default.state,o=ut();if(!n||!o)return;const a=(0,z.Z)({spaceViewStore:n,pageId:o.id})?te.unbookmarkPage:te.bookmarkPage;O.createAndCommit({userAction:"actionRegistry.toggleFavorite",environment:t,perform:e=>a({spaceViewStore:n,store:o,transaction:e})})}}),Ct=(0,J.cs)({key:"toggle update sidebar",analyticsName:"Toggle update sidebar",displayName:void 0,validators:[],shortcuts:["toggleUpdateSidebar"],closeParentMenu:!0,action:e=>{let{environment:t}=e;return te.setUpdateExpand({environment:t,isExpanded:!(0,ne.Sx)(t),from:"keyboard_default"})}}),Nt=(0,J.cs)({key:"toggle both sidebars",analyticsName:"Toggle both sidebars",displayName:void 0,validators:[],shortcuts:["toggleBothSidebars"],closeParentMenu:!0,action:e=>{let{environment:t}=e;te.toggleBothSidebars(t)}}),wt=(0,J.cs)({key:"open comments tab in update sidebar",analyticsName:"Open comments tab in update sidebar",displayName:void 0,validators:[],shortcuts:["openCommentsTabInUpdateSidebar"],closeParentMenu:!0,action:e=>{let{environment:t}=e;te.setUpdateExpand({environment:t,isExpanded:!0,from:"keyboard_comments"}),te.setUpdateSidebarTab(ae.gY.Comments)}}),Pt=(0,J.cs)({key:"open updates tab in update sidebar",analyticsName:"Open updates tab in update sidebar",displayName:void 0,validators:[],shortcuts:["openUpdatesTabInUpdateSidebar"],closeParentMenu:!0,action:e=>{let{environment:t}=e;te.setUpdateExpand({environment:t,isExpanded:!0,from:"keyboard_updates"}),te.setUpdateSidebarTab(ae.gY.Updates)}}),xt=(0,J.cs)({key:"open link annotation menu",displayName:Ze.createLinkName,analyticsName:Ze.createLinkName.defaultMessage,validators:[K.DaG,K.KLp,K.U4I,K.ryx,K.NZn],shortcuts:["openLinkMenuOrOpenSearch"],closeParentMenu:!0,action:()=>x.dz({type:"focusOnly",focus:!0})}),It=(0,J.cs)({key:"open equation annotation menu",displayName:Ze.createEquationName,analyticsName:Ze.createEquationName.defaultMessage,validators:[K.DaG,K.ffD(K.or([K.Khw,K.T29,K.QYD,K.DUX]))],shortcuts:["openEquationMenu"],closeParentMenu:!0,action:e=>P.qn({environment:e.environment,analyticsFrom:"input_keyboard_shortcut"})}),Rt=(0,J.cs)({key:"exit app",analyticsName:"Exit app",displayName:void 0,validators:[K.ffD(K.NWv),K.DtP],shortcuts:["backbutton"],closeParentMenu:!0,action:e=>{let{environment:t}=e;if(t.mobileNative)if((0,W.__)(t)){const{TabbedRouterStore:e}=t;"home"!==e.state.activeTab?E.S({environment:t,tab:"home",navigationAction:"pop",navigationSource:"mobile-back-navigation"}):t.mobileNative.exitApp()}else t.mobileNative.exitApp()}}),Tt=(0,J.cs)({key:"command left",analyticsName:"Go back",displayName:void 0,validators:[K.NWv,K.ffD(K.DaG)],shortcuts:["commandLeft"],closeParentMenu:!0,action:(e,t)=>_.op(e.environment)}),At=(0,J.cs)({key:"command right",analyticsName:"Go forward",displayName:void 0,validators:[K.vyP,K.ffD(K.DaG)],shortcuts:["commandRight"],closeParentMenu:!0,action:()=>_.eH()}),Lt=(0,J.cs)({key:"go back",analyticsName:"Go back",displayName:void 0,validators:[K.NWv],shortcuts:["goBack","backbutton"],closeParentMenu:!0,action:e=>{let{environment:t}=e;return _.op(t)}}),_t=(0,J.cs)({key:"go forward",analyticsName:"Go forward",displayName:void 0,validators:[K.vyP],shortcuts:["goForward"],closeParentMenu:!0,action:()=>_.eH()}),Et=(0,J.cs)({key:"go up",analyticsName:"Go up",displayName:void 0,validators:[()=>_.LU()],shortcuts:["goUp"],closeParentMenu:!0,action:e=>{let{environment:t}=e;return _.up(t)}}),Zt=(0,J.cs)({key:"switch spaces pre tabs",analyticsName:"Switch spaces pre tabs",displayName:void 0,validators:[K.daU,K.ffD(K.VcC)],shortcuts:["switchSpacesPreTabs"],closeParentMenu:!0,action:(e,t)=>{let{environment:n}=e;if(!t||!De(t))return;t.preventDefault();const o=parseInt(a()(t.keyCode)),{currentUserRootStore:s,currentUserSettingsStore:i}=se.default.state;s&&i&&(V.Yi({environment:n,index:o-1,userRootStore:s,userSettingsStore:i}),f.so(n))}}),Dt=(0,J.cs)({key:"switch spaces post tabs",analyticsName:"Switch spaces post tabs",displayName:void 0,validators:[K.daU,K.VcC],shortcuts:["switchSpacesPostTabs"],closeParentMenu:!0,action:(e,t)=>{let{environment:n}=e;if(!t||!De(t))return;t.preventDefault();const o=parseInt(a()(t.keyCode)),{currentUserRootStore:s,currentUserSettingsStore:i}=se.default.state;s&&i&&(V.Yi({environment:n,index:o-1,userRootStore:s,userSettingsStore:i}),f.so(n))}}),Vt=(0,J.cs)({key:"open settings",analyticsName:"Open settings",displayName:void 0,validators:[K.daU,K.EDF],shortcuts:["settings"],closeParentMenu:!0,action:e=>{I.r$()}}),jt=(0,J.cs)({key:"new page",analyticsName:"New page",displayName:void 0,validators:[K.ROK,K.jlf,K.or([K.daU,K.Fxc])],shortcuts:["newPage"],closeParentMenu:!0,action:e=>{let{environment:t}=e;te.quickAddPage({environment:t,from:"cmd_n"})}}),Bt=(0,J.cs)({key:"turn into type",displayName:J.RE.turnIntoName,analyticsName:J.RE.turnIntoName.defaultMessage,validators:[K.J5S,K.ffD(K.OPg),K.XQy,K.wFS],shortcuts:["turnIntoType"],closeParentMenu:!0,action:(e,t)=>{let{blocks:n,environment:o}=e;if(!t||!De(t))return;t.preventDefault();const s=parseInt(a()(t.keyCode)),i=r.PH[s];O.createAndCommit({userAction:"actionRegistry.turnIntoTypeViaKeyboard",environment:o,perform:e=>{q.Cj({environment:o,blocks:n,blockType:i,transaction:e})}})}}),Ut=[Be({key:"toggle bold",displayName:Ze.boldName,analyticsName:Ze.boldName.defaultMessage,shortcuts:["toggleBold"],annotation:["b"]}),Be({key:"toggle italics",displayName:Ze.italicName,analyticsName:Ze.italicName.defaultMessage,shortcuts:["toggleItalics"],annotation:["i"]}),Be({key:"toggle strike",displayName:Ze.strikeThroughName,analyticsName:Ze.strikeThroughName.defaultMessage,shortcuts:["toggleStrike"],annotation:["s"]}),Be({key:"toggle underline",displayName:Ze.underlineName,analyticsName:Ze.underlineName.defaultMessage,shortcuts:["toggleUnderline"],annotation:[m.GKr.Underline]})],Ot=(0,J.cs)({key:"toggle dark mode",displayName:Ze.darkModeName,analyticsName:Ze.darkModeName.defaultMessage,validators:[],shortcuts:["toggleDarkMode"],closeParentMenu:!0,action:e=>{let{environment:t}=e;const n="light"===t.ThemeStore.state.mode?"dark":"light";B.Y7(n)}}),qt=(0,J.cs)({key:"open peek view as page",displayName:Ze.openAsPageName,analyticsName:Ze.openAsPageName.defaultMessage,validators:[K.Txk],shortcuts:["commandEnter"],closeParentMenu:!0,action:e=>{let{environment:t}=e;ce.default.peekTarget.state&&L._c({environment:t,store:ce.default.peekTarget.state,pageVisitSource:i.tY.Expand})}}),Kt=(0,J.cs)({key:"toggle all toggles",displayName:Ze.openAllTogglesName,analyticsName:Ze.openAllTogglesName.defaultMessage,validators:[],shortcuts:["toggleAllToggles"],closeParentMenu:!0,action:e=>{let{environment:t}=e;const n=F.np();n&&U.X_(t,n)}});function Ft(e){return e.actions.filter(Ee).map((t=>({...t,searchName:[e.title,t.displayName].filter(Boolean).join(" ")})))}const zt=(0,J.cs)({key:"toggle recording input latency",displayName:Ze.toggleRecordingInputLatencyName,analyticsName:Ze.toggleRecordingInputLatencyName.defaultMessage,validators:[],shortcuts:["toggleRecordingInputLatency"],closeParentMenu:!0,action:()=>{s.toggleRecordingInputLatency()}}),Wt=(0,J.cs)({key:"toggle qna in corner",displayName:Ze.toggleQnAMessage,analyticsName:"toggleQnAPane",validators:[K.lvA,K.ffD(K.DaG),K.ffD(K.KHO),...fe.fF],shortcuts:["commandJ"],closeParentMenu:!0,action:async e=>{let{environment:t}=e;const{assistantMenuStore:n,assistantOriginElementStore:o,assistantAnalyticsActions:a,assistantMenuActions:s}=await G.deps.assistant.loader();if(ie.Z.shouldShowAssistantInCorner(t.device))if(n.state.open){await s.closeAssistantRightHandSideMenu({environment:t}),o.setAssistantLastViewedTime();const e=re.Z.getActiveSession();e&&a.trackQnaClosed(t,{sessionContext:e,from:"button"})}else s.openAssistantRightHandSideMenu({environment:t,from:"shortcut"})}}),Ht=[Kt,Ue,qe,ye.G,...Se.UO.actions,Se.o1,ke.d,yt,bt,St,Ce.KB,Ce.Jw,Le.B,Le.L9,Ne.$,Ne.g,ge.UI,ge.VJ,We,He,Te,Ae,Xe,et,nt,tt,st,ot,at,ft,ht,it,rt,gt,Ge,Ye,Je,$e,Wt,Qe,he.O,ve.H,he.N,xt,It,Rt,Lt,_t,Tt,At,lt,ct,dt,Et,Me.A,Me.Q,Zt,Dt,mt,pt,Bt,Ce.Qk,Ce.OW,kt,Nt,Ct,wt,Pt,Vt,jt,Ot,qt,vt,zt,Mt,Ke,Fe,ze,Oe,X,be.g,...Ut,...Ft(_e.g),...Ft(pe.te)]},15944:(e,t,n)=>{n.d(t,{o:()=>m,q:()=>p});var o=n(86628),a=n(68056),s=n(89086),i=n(28685),r=n(80444),l=n(24666),c=n(13447),d=n(37181);function u(){const e=l.default.state;if("editing"===e.mode){const t=(0,a.QY)(e.multiSelection);if(t&&(0,s.wd)(t.selection)){const e=t.store,n=i.E.findEditableWithStore(e);if(n){return e.getValue()?void 0:n}}}}function m(){return(0,o.VK)(u,[])}function p(e){const{currentUserSettingsStore:t}=r.default.state;t&&c.createAndCommit({userAction:"educationTooltipsActions.completePressSlashTooltip",environment:e,perform:e=>{d.d2({userSettingsStore:t,transaction:e,data:{pressed_slash_tooltip:!0}})},userId:t.id})}},20073:(e,t,n)=>{n.d(t,{I:()=>s,O:()=>a});var o=n(23883);function a(e){const{cursors:t,rootStore:n}=e,a={};for(const o of t)for(const e of o.stack)for(const t of e)a[t.id]=t.index;o.Z.setLimitParents(n,a)}function s(e){o.Z.removeLimitParents(e.rootStore)}},73966:(e,t,n)=>{n.d(t,{k2:()=>l,l6:()=>r,wk:()=>i});var o=n(42875),a=n(13447),s=n(37181);function i(e){const{environment:t,userSettingsStore:n}=e,a=n.getSettings(),s=null==a?void 0:a.time_zone,i=(0,o.r)();s!==i&&r({environment:t,userSettingsStore:n,timeZone:i})}function r(e){const{environment:t,userSettingsStore:n,timeZone:o}=e;a.createAndCommit({userAction:"checkUserTimeZoneAction.updateTimeZone",environment:t,perform:e=>{s.d2({userSettingsStore:n,transaction:e,data:{time_zone:o}})},userId:n.id})}function l(e){const{environment:t,userSettingsStore:n,disableAutoSetTimezone:o}=e;a.createAndCommit({userAction:"checkUserTimeZoneAction.updateDisableAutoSetTimezone",environment:t,perform:e=>{s.d2({userSettingsStore:n,transaction:e,data:{disable_auto_set_timezone:o}})},userId:n.id})}},41464:(e,t,n)=>{n.d(t,{Z:()=>y});n(67294);var o=n(83355),a=n(36154),s=n(36610),i=n(68204),r=n(35328),l=n(77907),c=n(95802),d=n(8949),u=n(77080),m=n(22294),p=n(86486),g=n(27724),f=n(38870),h=n(85893);class v extends o.Z{constructor(){super(...arguments),this.prevX=void 0,this.prevY=void 0,this.handleWindowMouseMove=e=>{e.clientX===this.prevX&&e.clientY===this.prevY||(this.prevX=e.clientX,this.prevY=e.clientY,m.Z.setKeyboardMode(!1))}}UNSAFE_willMount(e){super.UNSAFE_willMount(e),window.addEventListener("mousemove",this.handleWindowMouseMove)}willUnmount(){super.willUnmount(),window.removeEventListener("mousemove",this.handleWindowMouseMove)}renderComponent(){const e=function(e,t,n){const o={};for(const s of a.L6)for(const a of s.shortcuts)o[a]=o=>S(a,o,e,t,n);return o}(this.props.markdownLinkifyIt,this.props.tinyMceMicrosoftWordPasteFilter,this.environment);return(0,h.jsx)(f.Z,{debugName:this.props.debugName,priority:this.props.priority,enable:this.props.capture,shortcuts:e})}}function y(e){const{value:t}=(0,l.useDependency)(l.deps.markdownLinkifyIt),{value:n}=(0,l.useDependency)(l.deps.tinyMceMicrosoftWordPasteFilter);return(0,h.jsx)(v,{...e,markdownLinkifyIt:t,tinyMceMicrosoftWordPasteFilter:n})}function b(){return!function(){const e=document.querySelector("#intercom-container");return!(!e||!e.contains(document.activeElement))}()&&!(d.Z.state.isActive&&!u.default.checkGate("block_menu_shortcut_fix"))}function S(e,t,n,o,l){if(!b())return;const f=g.default.state.stores,h=g.default.state.pivot||f[0],v=h&&c.C.getRectFromStore(h),y=a.L6.find((t=>!!t.shortcuts.some((t=>t===e))&&i.vG(t,{environment:l,blocks:f,originRect:v,publicEditMode:void 0})));if(y){"keydown"===t.type&&t.preventDefault&&t.preventDefault();const e=d.Z.state.isActive;y.action({environment:l,blocks:f,originRect:v,publicEditMode:void 0,lazyDependencies:{markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:o}},t);const a=f[0];let i,c,g,h;var S;if(a)i=a.getType(),c=i?(0,r._A)(i,a.getFormat()):void 0,g=null===(S=a.getCollectionViewCollectionStore())||void 0===S?void 0:S.id,h=a.getParentCollectionIdUpToTwoLevels();s.dh(l,{analyticsName:y.analyticsName,action_type:y.analyticsActionType,from:"keyboard_shortcut",block_id:null==a?void 0:a.id,block_type:i,is_toggleable:c,collection_id:g,parent_collection_id:h}),k={resetBlockMenuStore:e},m.Z.setKeyboardMode(!0),p.default.reset(),u.default.checkGate("block_menu_shortcut_fix")&&k.resetBlockMenuStore&&d.Z.reset()}var k}v.displayName="ActionRegistryShortcutListener"},3403:(e,t,n)=>{n.d(t,{Z:()=>i});n(67294);var o=n(34232),a=n(68785),s=n(85893);function i(){const e=(0,o.Z)(!0,400);return(0,s.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e&&(0,s.jsx)(a.Z,{})})}},26673:(e,t,n)=>{n.r(t),n.d(t,{default:()=>k,getSpaceViewMenuItems:()=>M});n(57658),n(67294);var o=n(480),a=n(86628),s=n(9291),i=n(3297),r=n(97977),l=n(32360),c=n(60709),d=n(48779),u=n(80444),m=n(89256),p=n(52275),g=n(78140),f=n(32163),h=n(40721),v=n(53437),y=n(31278),b=n(72495),S=n(85893);const k=function(){const e=(0,o.O7)(),{device:t}=e,n=(0,a.VK)((()=>m.Z.state),[]);return(0,S.jsx)(v.ZP,{popupType:t.isMobile?v.ZP.PopupType.SlideUp:v.ZP.PopupType.Popup,open:n.open,render:()=>(0,S.jsx)(C,{}),originGap:8,onDismiss:i.sC,originRect:n.originRect,enableRounding:!0})};function M(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{device:o}=e,{currentUserRootStore:a}=u.default.state;if(!a)return[];const{editableStores:s}=(0,l.o)(a),r=[];for(const l of s){const a=l.getSpaceStore();if(a){const s=(0,d.rn)(e,a),c=(0,d.Wd)(e,a);r.push({key:l.id,action:async()=>{await i.DK({environment:e,store:t,spaceStore:a,spaceViewStore:l,isPrivate:!0,context:"public_page_duplicate_multiple_workspace",shouldLogToStatsig:n})},render:e=>(0,S.jsx)(p.Z,{title:s,icon:(0,S.jsx)(y.Z,{icon:c,isEmptyPage:!1,title:s,size:o.isMobile?24:20,disabled:!0}),...e})})}}return r}function C(){const e=(0,o.O7)(),{device:t}=e,n=(0,a.VK)((()=>m.Z.state),[]),{currentUserRootStore:l}=(0,a.VK)((()=>u.default.state),[]),d=(0,a.VK)((()=>n.store?M(e,n.store):[]),[e,n]);if(!n.open||!l)return null;const p=[{key:"spaces",render:e=>(0,S.jsx)(b.Z,{title:t.isMobile?void 0:(0,S.jsx)(s.FormattedMessage,{defaultMessage:"Choose a workspace",id:"duplicatePagePopup.chooseWorkspace.menuItem.title"}),isTitleUppercase:!0,...e}),items:d},{key:"logout",render:e=>(0,S.jsx)(b.Z,{...e,topBorder:!0}),items:[{key:"logout",action:()=>r.logout(e),render:e=>(0,S.jsx)(N,{...e})}]}];let v;return v=t.isMobile?{menuType:c.og.Modal,title:(0,S.jsx)(s.FormattedMessage,{defaultMessage:"Choose a workspace",id:"duplicatePagePopup.choooseWorkspaceMobileMenu.title"}),right:(0,S.jsx)(h.CancelMenuText,{}),onClickRight:i.sC}:{menuType:c.og.Popup},(0,S.jsx)(g.Z,{...v,children:(0,S.jsx)(f.Z,{type:f.i.Vertical,sections:p,initialFocus:1})})}function N(e){const t=(0,a.VK)((()=>{const{currentUserStore:e}=u.default.state;return(null==e?void 0:e.getEmail())||""}),[]);return(0,S.jsx)(p.Z,{caption:(0,S.jsx)(s.FormattedMessage,{defaultMessage:"Log out ({email})",id:"duplicatePagePopup.buttonMenuItem.logoutButton.label",values:{email:t}}),...e})}},81059:(e,t,n)=>{n.d(t,{T:()=>fe,Z:()=>ve});var o=n(67294),a=n(82540),s=n(480),i=n(97511),r=n(86628),l=n(24405),c=n(80503),d=n(51454),u=n(53965),m=n(1898),p=n(51787),g=n(47678),f=n(20073),h=n(61045),v=n(3898),y=n(72899),b=n(10906),S=n(7401),k=n(28020),M=n(43250),C=n(75079),N=n(19124),w=n(51783),P=n(52533),x=n(50627),I=n(46654),R=n(66430),T=n(45010),A=n(77907),L=n(18245);const _=(0,A.lazyComponent)(A.deps.personalHome,(e=>e.PersonalHomeContainer));var E=n(94841),Z=n(61931),D=n(16746),V=n(24646),j=n(38676),B=n(34859),U=n(80444),O=n(88632),q=n(24042),K=n(21051),F=n(17903),z=n(19111),W=n(56638),H=n(82136),G=n(88923),Y=n(83212),J=n(87956),$=n(23063),Q=n(68785),X=n(53336),ee=n(26957),te=n(9291),ne=n(31701),oe=n(36610),ae=n(58297),se=n(85893);const ie=function(){const e=(0,s.O7)();let t;return(0,r.VK)((()=>O.Z.state.online),[])?t=(0,se.jsx)(te.FormattedMessage,{defaultMessage:"Oops, there was an error loading this page. Refresh to load it again.",id:"pageErrorIndicator.loadingError.message"}):(oe.DC(e,{type:"page_error_indicator"}),t=e.defaultRecordCache.persistedRecordCache?(0,se.jsx)(te.FormattedMessage,{defaultMessage:"Please go online to load this page, then you'll be able to access it while offline.",id:"pageOfflineIndicator.hasLocalData.message"}):(0,se.jsx)(te.FormattedMessage,{defaultMessage:"Oops, you seem to be offline. Please go online to view this page.",id:"pageOfflineIndicator.noLocalData.message"})),(0,se.jsxs)("div",{style:ce(e),children:[(0,se.jsx)("div",{style:le(e),children:t}),(0,se.jsx)(ae.Z,{isLarge:!0,onClick:()=>window.location.reload(),children:(0,se.jsx)(te.FormattedMessage,{defaultMessage:"Refresh",id:"pageErrorIndicator.reloadButton.label"})})]})};function re(e){return e.currentUser.isLoggedIn()}function le(e){const{device:t}=e;return{fontSize:t.isMobile?18:32,marginBottom:8,textAlign:"center",color:ne.ZP.uiBlack,maxWidth:640,lineHeight:1.3}}function ce(e){const{device:t}=e;return{height:"100%",minHeight:re(e)?`calc(100vh - ${2*c.R6(e.device.isElectronMac)}px)`:"100vh",paddingLeft:t.isMobile?16:32,paddingRight:t.isMobile?16:32,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}}var de=n(69206),ue=n(31192),me=n(78901),pe=n(3553),ge=n(99659);const fe="1.375em",he=o.memo((function(e){let{store:t,routerState:n,collectionViewStore:i}=e;const u=(0,s.O7)(),{RouterStore:g}=u,h=(0,s.Fy)(),v=(0,o.useCallback)((e=>{J.Z.state&&("scroll"===e?J.Z.state.hadScroll||(J.Z.setState({...J.Z.state,hadScroll:!0}),p.Kk(u,{interactionType:e})):"click"===e?J.Z.state.hadClick||(J.Z.setState({...J.Z.state,hadClick:!0}),p.Kk(u,{interactionType:e})):"copy"===e?J.Z.state.hadCopy||(J.Z.setState({...J.Z.state,hadCopy:!0}),p.Kk(u,{interactionType:e})):(0,m.t1)(e))}),[u]);(0,o.useEffect)((()=>{if(v){const e=()=>{v("copy")};return addEventListener("copy",e),()=>removeEventListener("copy",e)}}),[v]),(0,o.useEffect)((()=>()=>f.I({rootStore:t})),[t]);const y=(0,r.SI)((()=>Y.Z.getMode(u,t)),[u,t]),b=(0,r.VK)((()=>{const{presenceStore:e,pageVisitStore:n,currentSpaceStore:o,currentSpaceViewStore:a}=U.default.state;return{pageStore:t,spaceStore:o,spaceViewStore:a,presenceStore:e,pageVisitStore:n,publicEditModeStore:y}}),[y,t]),{pageVisitStore:S,presenceStore:C,spaceStore:N,spaceViewStore:w}=b,P=(0,r.VK)((()=>!t.isDefined()||!t.canRead()),[t]),x=(0,r.VK)((()=>u.currentUser.isLoggedIn()),[u]),I=(0,r.VK)((()=>U.default.state.mainEditorCurrentBlockStore),[]),R=(0,r.VK)((()=>k.h1(u)),[u]),T=(0,l.Fg)(),L=(0,r.VK)((()=>(0,E.WE)(I)),[I]),_=(0,r.VK)((()=>{const e={flexGrow:0,flexShrink:1,display:"flex",flexDirection:"column",background:L?(0,Z.$1)({theme:T,isPhone:h.isPhone}):T.contentBackground,zIndex:d.Wi,height:h.isMobile?"100vh":`calc(100vh - ${c.R6(h.isElectronMac)}px)`,maxHeight:"100%",...h.isTablet&&{position:"relative"},position:"relative",...L?{height:"100%",position:"absolute"}:{}};if(!(0,V.Jr)(u)){const t=j.sidebarOpenStore.state;(0,V.YR)(u)||(e.boxShadow=T.mediumBoxShadow),e.pointerEvents=t?"none":"auto",e.transform="translateX(0)"}return!R&&h.isMobileNative&&(e.pointerEvents="auto",e.transform="translateX(0px)"),e}),[h.isElectronMac,h.isMobile,h.isPhone,h.isTablet,h.isMobileNative,u,R,T,L]),B=(0,r.VK)((()=>"nativeTab"===g.state.route.name),[g]),F=(0,r.VK)((()=>!O.Z.state.online),[]),[z,W]=(0,r.VK)((()=>{const e=(0,V.$3)(u);return[e,e+(0,V.vJ)(u)]}),[u]),H=(0,r.VK)((()=>Boolean(t.getAppContainerBlockStore())),[t]),G=(0,r.VK)((()=>j.sidebarResizingStore.state),[]),Q=(0,r.VK)((()=>t.getAppContainerBlockStore()),[t]),X=(0,r.VK)((()=>q.Z.state.isShowingTabBar),[]),ee=(0,r.VK)((()=>K.Z.state.banners),[]),te=(0,r.VK)((()=>!X&&!(0,V.in)(u)&&!D.Z.isVisible()),[u,X]),ne=(0,r.VK)((()=>"personal_home_page"===t.getType()),[t]);return(0,se.jsx)(a.Mi,{value:b,children:(0,se.jsxs)("div",{className:B?"hidden":"",style:{display:"flex",flexDirection:"column",width:h.isTablet?"unset":"100%",overflow:h.isTablet?"unset":"hidden"},children:[!h.isMobile&&!H&&(0,se.jsx)(ge.ZP,{store:t,spaceStore:N,spaceViewStore:w,pageVisitStore:S,presenceStore:C,showSidebarButton:te,isElectron:h.isElectron,isInvalidPage:P,banners:ee}),(0,se.jsx)($.Z,{isVisible:!0,animationStyle:{width:L?W:z},skipAnimation:X&&G.isResizing,render:()=>(0,se.jsxs)("main",{style:_,className:M.Wiy,children:[h.isMobile&&(0,se.jsx)(A.LazyTopbarMobile,{store:t,collectionViewStore:i,spaceStore:N,spaceViewStore:w,pageVisitStore:S,presenceStore:C,isInvalidPage:P,shouldShowAddTo:Boolean(n.route.showMoveTo&&t.canEdit()&&x),saveParent:Boolean(n.route.saveParent),banners:ee,isOffline:F}),Q?(0,se.jsx)(ye,{appContainerStore:Q}):ne?(0,se.jsx)(Se,{store:t}):(0,se.jsx)(ke,{store:t,routerState:n,maybeLogSearchInteractionEvent:v}),x&&h.isMobile&&(0,se.jsx)(be,{store:t}),h.isMobileNative&&x&&I&&(0,se.jsx)(A.LazyMobileBottomBar,{})]})})]})})})),ve=he;function ye(e){let{appContainerStore:t}=e;return(0,se.jsx)("div",{style:{position:"absolute",height:"100vh",width:"100%"},children:(0,se.jsx)(A.LazyAppInitializationOverlay,{collectionViewBlockStore:t})})}function be(e){var t;let{store:n}=e;const a=(0,s.O7)(),i=(0,r.VK)((()=>{var e;return null===(e=a.mobileNative)||void 0===e?void 0:e.api.renderMobileActionBar}),[null===(t=a.mobileNative)||void 0===t?void 0:t.api.renderMobileActionBar]),l=(0,o.useCallback)((e=>{const{isMobileNative:t}=a.device;return(0,se.jsx)(A.LazyMobileActionBar,{stores:e,position:t?P.nd.Bottom:P.nd.Floating,currentBlockStore:n})}),[a.device,n]);return(0,w.LQ)({environment:a})?(0,se.jsx)(A.LazyMobileActionBarWrapper,{currentBlockStore:n,makeActionBarComponent:e=>(0,se.jsx)(A.LazyNativeMobileActionBar,{renderApi:i,stores:e,currentBlockStore:n,fallbackRenderer:l})}):(0,se.jsx)(A.LazyMobileActionBarWrapper,{currentBlockStore:n,makeActionBarComponent:l})}const Se=o.memo((function(e){let{store:t}=e;return(0,se.jsx)(pe.Z,{disable:!0,store:t,isDefaultContainer:!0,render:()=>(0,se.jsx)(_,{})})}));function ke(e){let{store:t,routerState:n,maybeLogSearchInteractionEvent:a}=e;const i=(0,s.O7)(),{RouterStore:l}=i,{historyState:c}=n,{currentLoadingContainerStore:d,pageVisitStore:m}=(0,r.VK)((()=>U.default.state),[]),p=(0,r.VK)((()=>c&&u.hj(c.scrollTop)?c.scrollTop:void 0),[c]),f=(0,r.VK)((()=>Boolean((0,I.IJ)(i,t))),[i,t]),h=(0,r.VK)((()=>Boolean(G.default.isCenterPeekOpen()||W.Z.state.open)),[]);return(0,se.jsx)(pe.Z,{store:t,isDefaultContainer:!0,droppable:!0,isRootContainer:!0,disableRectangularSelection:f,disable:h,render:e=>{let{selectableEvents:n,selectableHoverMenuOverlay:s}=e;return(0,se.jsx)(o.Suspense,{fallback:(0,se.jsx)(ee.Z,{isVisible:!0,store:t}),children:(0,se.jsx)(de.Z,{pageStore:t,pageVisitStore:m,scrollToBlockIds:v.uE(l),scrollToPosition:p,store:d,onReady:()=>{g.Y(i,{animateScrollToBlocks:!1})},onDone:()=>{t.isCollectionView()||"rendered"===U.default.state.renderPhase||U.default.setState({...U.default.state,renderPhase:"rendered"})},initialChunkSize:R.OZ,incrementChunkSize:30,render:e=>{let{error:o,ready:i,initialRequestCompleted:r,endOfResultsReached:l,isCollectionInPage:c}=e;return(0,se.jsx)(Me,{store:t,error:o,ready:i,initialRequestCompleted:r,endOfResultsReached:l,isCollectionInPage:c,selectableEvents:n,selectableHoverMenuOverlay:s,maybeLogSearchInteractionEvent:a})}})})}},t.id)}const Me=o.memo((function(e){let{store:t,error:n,ready:a,initialRequestCompleted:l,endOfResultsReached:c,isCollectionInPage:d,selectableEvents:u,selectableHoverMenuOverlay:m,maybeLogSearchInteractionEvent:p}=e;const g=(0,s.O7)(),f=(0,s.Fy)(),{publicEditModeStore:v}=(0,i.l)()??{},M=(0,r.VK)((()=>(0,N.GD)(null==v?void 0:v.state)),[v]),w=(0,o.useCallback)((e=>{let{startTime:n,endTime:o}=e;const a=b.fm(t);L.default.measure({metricName:"collections.max_scroll_lag_in_session",startTime:n,endTime:o},{environment:g,data:C.vS(a)})}),[g,t]),P=(0,o.useCallback)((e=>{T.Z.PageScroller=e}),[]),x=(0,o.useCallback)((()=>{p("scroll")}),[p]),I=(0,o.useCallback)((e=>{u.onClick(e),p("click")}),[p,u]),R=(0,r.VK)((()=>t.isCollectionView()),[t]),_=(0,r.VK)((()=>({spinner:{zIndex:1,opacity:.5,width:fe,height:fe,marginTop:`calc(-${fe} / 2 - ${we(g)} / 2)`,marginBottom:24,marginLeft:"auto",marginRight:"auto"},scroller:{display:"flex",flexDirection:"column",zIndex:1,flexGrow:1,position:"relative",...a?{}:{opacity:0,pointerEvents:"none",height:0},...R?{}:{alignItems:"center"}}})),[g,R,a]),E=(0,r.VK)((()=>G.default.isSidePeekOpen()?void 0:a?h.Q7(g):B.Z.All),[g,a]),Z=(0,r.VK)((()=>k.Zy({environment:g,store:t})),[g,t]);return(0,se.jsxs)(o.Fragment,{children:[(0,se.jsxs)(X.Z,{ref:P,onScrollLagMeasure:d?w:void 0,onScroll:x,preventType:E,type:Z,style:_.scroller,store:F.Z,...u,onClick:I,children:[m,!f.isPhone&&M&&(0,se.jsx)(y.GC,{scrollerStore:F.Z}),(0,se.jsx)(S.vo,{scrollerStore:F.Z}),(0,se.jsx)(A.LazyScrollableSitesBannerContainer,{blockStore:t}),l&&(0,se.jsx)(Ce,{store:t,error:n}),a&&!c&&!(l&&n)&&(0,se.jsx)(Q.Z,{style:_.spinner})]}),f.isPhone&&M&&(0,se.jsx)(y.GC,{scrollerStore:F.Z}),(0,se.jsx)(ee.Z,{isVisible:!a,store:t})]})})),Ce=o.memo((function(e){let{store:t,error:n}=e;const{pageVisitStore:a,presenceStore:i,currentLoadingContainerStore:c}=(0,r.VK)((()=>U.default.state),[]),d=(0,s.O7)(),{WindowSizeStore:u,device:m}=(0,s.O7)(),p=(0,r.VK)((()=>u.state.height),[u]),[g,f]=(0,r.VK)((()=>{const e=(0,V.$3)(d),n=Math.max(x.zL,e),o=e+(0,V.vJ)(d),a=(0,b.Ks)(t)&&!t.isFullWidth()?n:o,s=m.isMobile&&z.Z.state.open?p:0;return[a,ue.ZP.paddingBottom(d,h._4()+s)]}),[m.isMobile,p,d,t]),v=(0,r.VK)((()=>G.default.isSidePeekOpen()||G.default.isSidePeekClosing.state),[]),y=(0,l.yK)((()=>({pageViewBlockStyle:v?{width:g,position:"absolute",left:0}:Ne})),[v,g]);return(0,r.VK)((()=>{const e=c&&!c.state.endOfResultsReached,o=t.isDefined()&&t.canRead();return e&&n||!o}),[t,c,n])?(0,se.jsx)(ie,{}):(0,se.jsxs)(o.Fragment,{children:[(0,se.jsx)(ue.ZP,{context:H.S.Frame,style:y.pageViewBlockStyle,store:t,paddingBottom:f,disabled:!1}),(0,se.jsx)(me.Z,{pageVisitStore:a,presenceStore:i,isPeekView:!1})]})})),Ne={};function we(e){return"number"==typeof ue.ZP.paddingBottom(e)?`${ue.ZP.paddingBottom(e)}px`:ue.ZP.paddingBottom(e)}},26957:(e,t,n)=>{n.d(t,{Z:()=>v});n(67294);var o=n(480),a=n(86628),s=n(24405),i=n(70096),r=n(80503),l=n(9291),c=(n(95477),n(34232)),d=n(36596),u=n(68785),m=n(31192),p=n(85893);const g="1.375em";function f(e){let{store:t,peekMode:n}=e;const r=(0,o.O7)(),l=(0,a.VK)((()=>t.hasCover()),[t]),c=(0,a.VK)((()=>t.hasIcon()),[t]),u=(0,a.VK)((()=>t.isCollectionView()),[t]),g=(0,a.VK)((()=>t.isFullWidth()),[t]),f=(0,a.VK)((()=>r.device.isMobile&&!r.device.isTablet),[r]),h=(0,a.VK)((()=>n===i.l?"20vh":m.ZP.defaultPageCoverHeight(r)),[r,n]),v=(0,s.yK)((()=>{const e=f?24:n===i.R?48:96,t=(()=>{switch(!0){case f:return 32;case c:return 96;case n===i.l&&!c:return 54;case!c:return 102}})(),o=(()=>{switch(!0){case f&&l&&c:return 22;case f&&l&&!c:return 54;case f&&!l&&c:return 56;case f&&!l&&!c:return 4;case!f&&l&&c:return 50;case!f&&l&&!c:return 58;case!f&&!l&&c:return 92;case!f&&!l&&!c:return 20}})();return{collectionCoverPhoto:{width:"100%",height:"20vh"},collectionTitleContainer:{display:"flex",alignItems:"center",paddingLeft:e,paddingRight:e,width:"100%",paddingTop:(()=>{switch(!0){case f&&l:return 50;case f&&!l:return 78;case!f&&l:return 48;case!f&&!l:return 36}})()},collectionIcon:{flexGrow:0,flexShrink:0,width:36,height:36,borderRadius:6,marginRight:10,marginLeft:3},collectionTitle:{height:f?24:30,width:600,marginTop:f?6:3,borderRadius:15},pageCoverPhoto:{width:"100%",height:h},pageCoverPadding:{width:"100%",height:t},pageIconContainer:{maxWidth:"100%",boxSizing:"border-box",paddingLeft:e,paddingRight:e,width:g?"100%":900,height:36},pageIcon:{position:"relative",top:l?-42:0,width:78,height:78,marginLeft:2,borderRadius:16},pageTitleContainer:{display:"flex",boxSizing:"border-box",paddingLeft:e,paddingRight:e,width:g?"100%":900,maxWidth:"100%",paddingTop:o},pageTitle:{marginTop:f?3:0,height:f?24:30,width:600,borderRadius:15}}}),[g,l,c,h,f,n]);return u||n===i.R?(0,p.jsxs)(p.Fragment,{children:[l&&(0,p.jsx)(d.Z,{style:v.collectionCoverPhoto}),(0,p.jsxs)("div",{style:v.collectionTitleContainer,children:[c&&(0,p.jsx)(d.Z,{emphasized:!0,style:v.collectionIcon}),(0,p.jsx)(d.Z,{style:v.collectionTitle})]})]}):(0,p.jsxs)(p.Fragment,{children:[l?(0,p.jsx)(d.Z,{style:v.pageCoverPhoto}):(0,p.jsx)("div",{style:v.pageCoverPadding}),c&&(0,p.jsx)("div",{style:v.pageIconContainer,children:(0,p.jsx)(d.Z,{emphasized:!0,style:v.pageIcon})}),(0,p.jsx)("div",{style:v.pageTitleContainer,children:(0,p.jsx)(d.Z,{style:v.pageTitle})})]})}const h=!1;function v(e){let{isVisible:t,peekMode:n,store:d}=e;const v=(0,o.O7)(),y=(0,o.Fy)(),b=(0,l.useIntl)(),S=y.isMobile&&!y.isTablet,k=y.isMobileNative,M=r.R6(y.isElectronMac),C=(0,s.yK)((()=>({root:{position:"absolute",top:n===i.l||n===i.R||S?`calc(${M}px + env(safe-area-inset-top))`:"env(safe-area-inset-top)",bottom:"env(safe-area-inset-bottom)",left:"env(safe-area-inset-left)",right:"env(safe-area-inset-right)",display:"flex",flexDirection:"column",alignItems:"center",pointerEvents:"none"}})),[n,S,M]),N=(0,a.VK)((()=>m.ZP.paddingBottom(v)),[v]),w=!k||h;return(0,c.Z)(t,w?k?0:10:100,0)?(0,p.jsx)("div",{role:"progressbar","aria-valuetext":b.formatMessage({id:"frameLoadingState.loading",defaultMessage:"Loading..."}),style:{...C.root,...w?{}:{justifyContent:"center"}},children:w?(0,p.jsx)(f,{store:d,peekMode:n}):(0,p.jsx)(u.Z,{style:{zIndex:1,opacity:.5,width:g,height:g,...void 0===n&&{marginTop:`calc(-${g} / 2 - ${N}px / 2)`,marginBottom:24,marginLeft:"auto",marginRight:"auto"}}})},"shimmer"):null}},69206:(e,t,n)=>{n.d(t,{Z:()=>oe});n(21703);var o=n(73935),a=n(83355),s=n(1302),i=n(92996),r=n(41432),l=n(92595),c=n(62193),d=n(45953),u=n(23867),m=n(57347),p=n(53965),g=n(37850),f=n(32603),h=n(20073),v=n(25320),y=n(4408),b=n(3898),S=n(54642);var k=n(61202),M=n(4437),C=n(11599),N=n(92283),w=(n(57658),n(16691)),P=n(64572),x=n(92516),I=n(73360),R=n(606),T=n(98963),A=n(18844),L=n(21202),_=n(6287),E=n(13493),Z=n(70279),D=n(33709),V=n(19889),j=n(70203);var B=n(95477),U=n(45950),O=n(5659),q=n(32223),K=n(69151),F=n(83055);async function z(e){const{environment:t,request:n,abortSignal:o,prefetchCacheKey:a}=e;return(0,F.Bx)(),q.isConnected()||q.isConnecting()?S.loadCachedPageChunk(t,n,void 0,void 0,o,a):S.loadPageChunk(t,function(e){return{...e,page:{id:e.page.id,spaceId:(0,u.C)(void 0)}}}(n),void 0,void 0,o,a)}async function W(e){const{environment:t,request:n,prefetchPromise:o,abortSignal:a,useInMemoryCacheOnly:s,isRacingWithAnotherRequest:i}=e,l=d.PF.create(),c=await async function(e,t,n){let o;o=e.cursor?p.Xh(e.cursor.stack):[];const a=e.page.id,s=e.limit,i=d.Ak.create();0===o.length&&o.push([{table:L.iU,id:a,index:0}]);let l=0,c=0;const u=x.s.fromMonomorphicFunctionUnsafe((async e=>{const n=i.getModel(e);if(c+=1,n)return n;const o=await t(e);return i.setModel(e,o),o&&await g(o),o})),m=new Set,g=async function(t){const o=[];if((0,I.tz)(t)){const e=t.getParentPointer();o.push([e,"Block parent_id"])}if(t.table===L.iU){const n=t.getCollectionViewPointers();for(const e of n)o.push([e,"CollectionViewBlock view_id"]);const a=t.getCollectionPointer();a&&o.push([a,"CollectionViewBlock collection_id"]);const s=t.getDiscussionPointers();for(const e of s)o.push([e,"Discussion"]);const i=t.getProperties().title;if((0,r.XD)(t.getType())&&i){const n=j.lzi(i),a=p.G0(...n.map(j.hDy));for(const s of a){if(j.STW(s)&&o.push([{table:L.iU,id:j.TOT(s)},"page annotation"]),j.IWo(s)&&o.push([{table:V.KJ,id:j.zEN(s)},"user annotation"]),j.j0F(s)){const t=j.zW$(s),n=(0,P.A5)({url:t,baseUrl:e.baseUrl,publicDomainName:e.publicDomainName});n&&o.push([{table:L.iU,id:n},"link annotation"])}if(j.nSN(s)){const e=j.frW(s);e&&o.push([{table:L.iU,id:e,spaceId:t.space_id},"eoi annotation"])}}}if(t.getType()===r.Ti.alias){const e=t.getAliasTargetPointer();e&&o.push([e,"alias"])}else if(t.isExternalObjectInstanceType()){const e=t.getExternalObjectSubInstancePointers();for(const t of e)o.push([t,"eoi"])}else if(t.getType()===r.Ti.button){const e=t.getAutomationPointer();e&&o.push([e,"button_automation"])}}else if(t.table===D.qF){for(const e of t.getCommentPointers())o.push([e,"discussion table comment"]);for(const e of t.getReactionPointers())o.push([e,"discussion table reaction"])}else if(t.table===Z.x_){for(const e of t.getContentPointers())o.push([e,"comment table attachment"]);for(const e of t.getReactionPointers())o.push([e,"comment table reaction"])}else if(t.table===E.np){const e=t.getFormatStore().getKeyStore("collection_pointer").getValue();e&&o.push([e,"CollectionView collection_id"])}else if(t.table===T.cv){const e=t.getActionPointers();for(const t of e)o.push([t,"Automation action_ids"])}else if(t.table===A.Xj)for(const e of t.getBlocks())o.push([{table:L.iU,id:e},"Automation action blocks"]);else if(t.table===_.vF)for(const e of t.getAutomationPointers())o.push([e,"Collection automation_ids"]);await Promise.all(o.filter((e=>{let[t,n]=e;const o=(0,w.dn)(t);return!m.has(o)&&(m.add(o),!0)})).map((e=>{let[o,a]=e;return n&&n({table:t.table,id:t.id},o,a),o})).map(u))},f=async function(){const t=[],i=o[o.length-1];if(l>=s&&c>10*s||!i)return!1;const d=await Promise.all(i.map((async e=>{const{table:t,id:n}=e,o=R.dr.fromPointerLike({table:t,id:n});return await u(o)}))),m=[];for(let n=0;n<i.length;n++){const s=i[n],l=d[n];if(!l||l.table!==L.iU)continue;const c=null==l?void 0:l.getContentIds(),u=null==l?void 0:l.getFormat();if(!e.verticalColumns&&l&&c&&"column_list"===l.type&&0===s.index){for(let e=0;e<c.length;e++){const n=c[e];m.push([{table:L.iU,id:n},s,"column"]),t.push({table:L.iU,id:n,index:0})}s.index=c.length}else if(l&&"transclusion_reference"===l.type&&u&&u.transclusion_reference_pointer&&0===s.index)m.push([u.transclusion_reference_pointer,s,"transclusion reference"]),t.push({...u.transclusion_reference_pointer,index:0}),s.index=1;else if(l&&c&&(0,r.Um)(l.type,u)&&(l.id===a&&1===o.length||!(0,r.Pm)(l.type)&&!(0,r.BX)(l.type,u))&&c[s.index]){const e=c[s.index];m.push([{table:L.iU,id:e},s,"block content child"]),t.push({table:L.iU,id:e,index:0}),s.index++}}await Promise.all(m.map((e=>{let[t,o,a]=e;return n&&n(o,t,a),t})).map(u));const p=t.filter((e=>{for(let t=0;t<o.length;t++){const n=o[t];for(let t=0;t<n.length;t++){const o=n[t];if(o.table===e.table&&o.id===e.id)return!1}}return!0}));return p.length>0?(o.push(p),l++):o.pop(),!0};for(;await f(););return{recordMap:i,cursorValue:{stack:o}}}({...n,baseUrl:B.default.domainBaseUrl,publicDomainName:B.default.publicDomainName},x.s.fromMonomorphicFunctionUnsafe((async e=>{const n=await U.Ye({environment:t,pointer:e,prefetchPromise:o,useInMemoryCacheOnly:s,isRacingWithAnotherRequest:i});if(null!=a&&a.aborted)throw new Error("Abort signal received");if(n)return l.setModelAndRole(e,n.model,n.role),n.model;throw new Error(`Record not found: ${e.table},${e.id}`)})),O.A.enableLogging?(e,t,n)=>{console.log(`Spidering from ${e.table}:${e.id} to ${t.table}:${t.id} (${n})`)}:void 0);return{recordMap:l.toJson({allowVersionDowngrade:!1}),cursor:c.cursorValue}}var H=n(77546),G=n(77282),Y=n(95802),J=n(88632),$=n(77080),Q=n(79167),X=n(77144),ee=n(93220);let te=!1;(0,l.exposeDebugValue)("toggleLogLocalPageLoadFailures",(()=>{te=!te,console.info(te?"Local page load error logging enabled":"Local page load error logging disabled")}));class ne extends a.Z{constructor(){super(...arguments),this.lastTimeout=void 0,this.node=void 0,this.scrollableAncestor=void 0,this.isCollectionInPage=!1,this.trackPage=new c.EJ("trackPage"),this.aiContextActions=new c.EJ("aiContextActions"),this.storeTypes={store:ee.Z},this.handleConnectionStateChange=()=>{const{store:e}=this.stores,t=J.Z.state.online;t&&!this.lastOnlineState&&e.state.error&&(e.reset(),this.requestNextChunk()),this.lastOnlineState=t},this.onReady=p.IH(this.props.onReady?this.props.onReady:()=>{}),this.onDone=p.IH(this.props.onDone?this.props.onDone:()=>{}),this.requestNextChunk=async()=>{const{loading:e,endOfResultsReached:t,initialRequestCompleted:n,currentCursor:o,currentChunkNumber:a,ready:i,error:r}=this.stores.store.state,{incrementChunkSize:l,initialChunkSize:c}=this.props;if(e||t||n&&r)return;this.stores.store.setState({...this.stores.store.state,loading:!0});const d=n?l:c;let u;n||X.Z.state.initialRenderCompleted||this.environment.device.isAndroid||(u=new g._W(async function(e,t){const n=e.currentUser.id;if(!n||!e.defaultRecordCache.persistedRecordCache)return Promise.resolve(void 0);(await e.defaultRecordCache.persistedRecordCache.getPageBlocksByParent({page:t,userId:n})).forEach((t=>{e.defaultRecordCache.inMemoryRecordCache.setRecord({pointer:t.pointer,userId:t.userId},t.value),e.defaultRecordCache.inMemoryRecordCache.emitRecord(t.pointer,[]),K.unsubscribeAfterDelay({environment:e,pointer:t.pointer,userId:t.userId})}))}(this.environment,{id:this.props.pageStore.id,table:this.props.pageStore.table})));try{const e=await this.requestPageChunk(d,o,a||0,u);n&&await s.default.afterNextFlush();const t=this.isScrolledToPosition()&&(!(p=this.props.scrollToBlockIds)||Y.C.findSelectablesFromIds(p).length===p.length),r=i||!e||t;!i&&r&&s.default.afterNextFlush((()=>{s.default.afterNextFlush((()=>{this.onReady()}))}));const l=!e;this.stores.store.setState({...this.stores.store.state,ready:r,initialRequestCompleted:!0,loading:!1,currentCursor:e?e.cursor:void 0,currentChunkNumber:e?e.chunkNumber:void 0,endOfResultsReached:l,error:void 0}),l&&this.onDone()}catch(f){this.stores.store.setState({...this.stores.store.state,ready:!0,initialRequestCompleted:!0,loading:!1,error:(0,m.t)(f)})}var p},this.requestPageChunk=async(e,t,n,o)=>{const{device:a}=this.environment,{pageStore:s}=this.props,l=(0,u.C)(s.pointer.spaceId),c={page:{id:s.id,spaceId:l},limit:e,cursor:t||{stack:[]},chunkNumber:n,verticalColumns:a.isMobile},d=t?Promise.resolve(void 0):async function(e,t){e&&await b.Nz(t,e)}(this.props.scrollToBlockIds,this.props.pageStore),m=this.environment.prefetchCache.isEnabled&&!X.Z.state.initialRenderCompleted||X.Z.state.initialRenderCompleted&&$.default.checkGate("navigation_render_parallel_requests")?this.performLocalOrRemoteLoadPageChunkInParallel({request:c,initialPreloadPromise:o}):this.performLocalOrRemoteLoadPageChunkSerially({request:c,initialPreloadPromise:o});f.setSubMetric({name:"render_end_to_await_page_chunk_start",startTime:e=>{var t;return null===(t=e.render_start_to_render_end)||void 0===t?void 0:t.endTime},endTime:performance.now()});const p=await m;if(!p)throw new Error("No successful load result found.");if(!X.Z.state.initialRenderCompleted&&0===n){f.setSubMetric({name:"await_page_chunk_start_to_await_page_chunk_end",startTime:e=>{var t;return null===(t=e.render_end_to_await_page_chunk_start)||void 0===t?void 0:t.endTime},endTime:performance.now()});const e=this.environment.prefetchCache;f.updateMetricData({page_chunk_source:p.source,page_chunk_prefetch:e.isEnabled?e.getPrefetchAnalytic("initialLoadPageChunk"):{type:"disabled"}})}if(this.environment.currentUser.isLoggedIn()){Q.Z.addFromRecordMapWithRole(p.recordMap),Q.Z.isEmpty()||k.dY({environment:this.environment});const e=s.getFormat(),t=s.getType();(0,N.K)()&&t&&(0,r.dM)(t)&&((null==e?void 0:e.app_config_uri)===i.NB||(null==e?void 0:e.app_config_uri)===i.Aw)&&await async function(e,t){await S.resyncJiraCollection(e,{pagePointer:t})}(this.environment,s.pointer)}const v=performance.now();await(0,g.aM)(d,5e3),X.Z.state.initialRenderCompleted||0!==n||f.updateMetricData({scroll_to_blocks_wait_time:performance.now()-v}),h.O({rootStore:s,cursors:[p.cursor]});const y=p.cursor.stack.length>0?p.cursor:void 0;if(y)return{cursor:y,chunkNumber:n+1}}}shouldComponentUpdate(){return!0}didMount(){super.didMount(),this.lastOnlineState=J.Z.state.online,this.node=o.findDOMNode(this),this.scrollableAncestor=(0,H.VW)(this.node),J.Z.addListener(this.handleConnectionStateChange)}didMountOrUpdate(){super.didMountOrUpdate();const{pageStore:e}=this.props,{initialRequestCompleted:t,endOfResultsReached:n,error:o}=this.stores.store.state;this.trackPage.effect((()=>{if(e.useCrdt()&&t&&!o)return G.Z.trackPage(e),()=>G.Z.untrackPage(e)}),[e.id,e.useCrdt(),t,o]),this.aiContextActions.effect((()=>{n&&!o&&M.N2({environment:this.environment,blockStore:e})}),[e,n]),this.requestNextChunk()}willUnmount(){super.willUnmount(),this.lastTimeout&&window.clearTimeout(this.lastTimeout),J.Z.removeListener(this.handleConnectionStateChange),this.trackPage.unmount(),this.aiContextActions.unmount()}renderComponent(){const{ready:e,error:t,initialRequestCompleted:n,endOfResultsReached:o}=this.stores.store.state;return this.props.render({error:t,ready:e,initialRequestCompleted:n,endOfResultsReached:o,isCollectionInPage:this.isCollectionInPage})}async performRemoteLoadPageChunk(e){const{request:t,abortSignal:n}=e,{pageStore:o,pageVisitStore:a}=this.props,s=z({environment:this.environment,request:t,abortSignal:n,prefetchCacheKey:this.prefetchCacheKey(t)});if(this.isInitialLoad(t)){v.Ri(this.environment,{block:o,pageVisitStore:a,incremental:!1}).catch((()=>{}));const e=C.A$("backlinks","section_show");await ae({environment:this.environment,blockPointer:o.pointer,shouldAwaitLoaded:!!e&&{primaryRequestPromise:s,maxMsToWaitAfterPrimaryRequestResolved:1e3}})}const i=await s;if("success"===i.type){const e=d.PF.create(i.data.recordMap);return this.isCollectionInPage=this.didLoadANonParentCollection(t.page,e,o.inMemoryRecordCache),{recordMap:e,cursor:i.data.cursor,source:"remote"}}}async performLocalLoadPageChunk(e){const{request:t,initialPreloadPromise:n,abortSignal:o,useInMemoryCacheOnly:a,isRacingWithAnotherRequest:s}=e,{pageStore:i}=this.props;try{const e=O.A.measure("localLoadPageChunk",`${t.page.id} ${t.cursor.stack.length}`,(()=>W({environment:this.environment,request:t,prefetchPromise:n,abortSignal:o,useInMemoryCacheOnly:a,isRacingWithAnotherRequest:s})));if(0===t.chunkNumber){const t=C.A$("backlinks","section_show");await ae({environment:this.environment,blockPointer:i.pointer,shouldAwaitLoaded:!!t&&{primaryRequestPromise:e,maxMsToWaitAfterPrimaryRequestResolved:1e3}})}const r=await e,l=d.PF.create(r.recordMap);return y.fL({environment:this.environment,inMemoryRecordCache:i.inMemoryRecordCache,recordMap:l,debugSource:"PageLoadaingContainer.performLocalLoadPageChunk"}),this.isCollectionInPage=this.didLoadANonParentCollection(t.page,l,i.inMemoryRecordCache),{cursor:r.cursor,recordMap:l,source:"local"}}catch(r){te&&console.error(r)}}didLoadANonParentCollection(e,t,n){var o;if(this.isCollectionInPage)return!0;const a=null===(o=n.getRecord({pointer:{table:"block",id:e.id,spaceId:e.spaceId},userId:this.environment.currentUser.id}))||void 0===o?void 0:o.value;if(a)for(const l of t.getByTable("block")){var s,i,r;if(("collection_view"===(null===(s=l.value)||void 0===s||null===(s=s.value)||void 0===s?void 0:s.type)||"collection_view_page"===(null===(i=l.value)||void 0===i||null===(i=i.value)||void 0===i?void 0:i.type))&&a.parent_id!==(null===(r=l.value)||void 0===r||null===(r=r.value)||void 0===r?void 0:r.collection_id))return!0}return!1}async performLocalOrRemoteLoadPageChunkInParallel(e){const t=await this.performLocalLoadPageChunk({...e,useInMemoryCacheOnly:!0,isRacingWithAnotherRequest:!1});if(t)return t;const n=this.prefetchCacheKey(e.request),o=n?this.environment.prefetchCache.getPrefetchStatus(n):void 0,a=new AbortController,s=this.performRemoteLoadPageChunk({...e,abortSignal:a.signal});if(!this.environment.defaultRecordCache.persistedRecordCache)return await s;if(n&&"success"===o)return await s;const i=new AbortController,r=[{promise:this.performLocalLoadPageChunk({...e,abortSignal:i.signal,isRacingWithAnotherRequest:!0}),abortController:i},{promise:s,abortController:a}],{winner:l}=await(0,g.S3)(r.map((e=>e.promise))),c=0===l?1:0,d=r[l],u=r[c],m=await d.promise;return m?(u.abortController.abort(),m):await u.promise}async performLocalOrRemoteLoadPageChunkSerially(e){const t=await this.performLocalLoadPageChunk({...e,isRacingWithAnotherRequest:!1});return t||await this.performRemoteLoadPageChunk(e)}isScrolledToPosition(){const{scrollToPosition:e}=this.props;return!this.scrollableAncestor||!p.hj(e)||e<=this.scrollableAncestor.scrollHeight-this.scrollableAncestor.clientHeight}isInitialLoad(e){return 0===e.chunkNumber}prefetchCacheKey(e){return this.isInitialLoad(e)?"initialLoadPageChunk":void 0}}ne.displayName="PageLoadingContainer";const oe=ne;async function ae(e){const{blockPointer:t,environment:n,shouldAwaitLoaded:o}=e;if(n.LocalBacklinkStore.initializeBacklinks({block:{id:t.id,spaceId:(0,u.C)(t.spaceId)},currentUserId:n.currentUser.id,environment:n}),!o)return;const a=n.LocalBacklinkStore.awaitLoaded(t.id).catch((()=>{})),{primaryRequestPromise:s,maxMsToWaitAfterPrimaryRequestResolved:i}=o;await s.then((()=>(0,g.aM)(a,i)))}},78901:(e,t,n)=>{n.d(t,{Z:()=>K});n(57658),n(21703);var o=n(67294),a=n(480),s=n(86628),i=n(24405),r=n(68626),l=n(19889),c=n(51454),d=n(9291),u=n(53965),m=n(52629),p=n(1898),g=n(48514),f=n(83420),h=n(20095),v=n(17504),y=n(65598),b=n(439),S=n(5971),k=n(95802),M=n(80444),C=n(24229),N=n(17903),w=n(22294),P=n(42057),x=n(6258),I=n(86486),R=n(27724),T=n(24666),A=n(23063),L=n(9612),_=n(68930),E=n(45653),Z=n(65200),D=n(85893);const V={position:"absolute",top:0,left:0,zIndex:c.eu},j=18,B=20,U=24,O=38,q=15;const K=function(e){const{pageVisitStore:t,presenceStore:n}=e,i=(0,a.O7)(),{isMobile:r}=i.device,l=(0,o.useRef)(null),c=(0,S.E)("block_attribution"),d=(0,s.SI)((()=>{var t;if(!c)return[];const o=e.isPeekView?P.Z:N.Z,a=o.state.scrollTop-5e3,s=a+((null===(t=o.state.clientRect)||void 0===t?void 0:t.height)||0)+5e3,i=function(e){var t;const{blockAttributionEnabled:n,containerEl:o,presenceStore:a}=e,{currentUserSettingsStore:s}=M.default.state,i=(null==s||null===(t=s.getSettings())||void 0===t?void 0:t.show_block_attribution)??!0;if(!n||!i)return[];const{rootStore:r}=a.state;if(!o||!r||"editing"!==T.default.state.mode||g.Z.state.open||C.Z.state.open||w.Z.state.isKeyboardMode)return[];let l;for(const u of R.default.state.stores){const e=u.findRecordStoreUIAncestor((e=>e instanceof x.G&&e.isTransclusionType())).ancestor;e&&e instanceof x.G&&"transclusion_container"===e.getType()&&(l=e)}const c=k.C.getMembersByDOMOrder({filter:()=>!0}),d=o.getBoundingClientRect(),m=y.MI({blockStore:r,traverseTransclusionReferences:!1}).flatMap((e=>{const t=[];if(e.isInsideTransclusion()||e.isTransclusionType()){let n=e;if("transclusion_reference"===e.getType()){const t=e.getTransclusionReferenceTargetStore();t&&(n=t)}"transclusion_reference"!==e.getType()&&"transclusion_container"!==e.getType()||(n!==l?t.push(z(e,c,d)):y.MI({blockStore:n,traverseTransclusionReferences:!1}).map((e=>t.push(z(e,c,d)))))}else t.push(z(e,c,d));return t})).filter((e=>!u.o8(e)));m.sort(((e,t)=>e.top-t.top));const p=m.filter(((e,t,n)=>0===t||e.actor.id!==n[t-1].actor.id));if(1===p.length)return[];return p}({blockAttributionEnabled:c,containerEl:l.current,presenceStore:n});i.sort(((e,t)=>e.top-t.top));const r=[];return i.every((e=>e.top>=a&&e.top<=s&&(r.push(e),!0))),r}),[c,n,e.isPeekView],{debugName:"attributionAvatarStore",useDeepEqual:!0});(0,o.useEffect)((()=>{let e;const t=u.Ds(d.recompute,100);return c&&(window.addEventListener("resize",t),e=setInterval(t,1e3)),()=>{window.removeEventListener("resize",t),clearInterval(e)}}),[d,c]);const m=(0,s.Kw)(d),p=[...(0,s.VK)((()=>function(e){const{attributionAvatars:t,pageVisitStore:n,presenceStore:o,environment:a,containerEl:s}=e,i=new Set(t.map((e=>{let{blockStore:t}=e;return t.id}))),{rootStore:r}=o.state;if(!r)return[];if(!s)return[];const l=a.currentUser.id,c=(0,h.AQ)(n,o).filter((e=>e.userId!==l&&(0,h.MR)(a,e)));if(c.length>0){const e={},t=k.C.getMembersByDOMOrder({filter:()=>!0}),n=s.getBoundingClientRect(),o=I.default.state;return u.oA(c.map((a=>{const s=(0,h.EB)(a),l=null==a?void 0:a.blockPath;let c;if(l&&l.length>0?c=function(e,t,n){const o=new Map(t.map(((e,t)=>[e,t])));let a,s;for(const i of e){const e=i.props.store,t=o.get(e.id);if(void 0!==t&&((void 0===s||t<s)&&n.uiContains(e)&&i.props.shouldShowHalo&&(a=i,s=t),0===s))return a}return a}(t,l,r):s&&(c=F(t,s,r)),!c)return;const d=c.props.store.id;e.hasOwnProperty(d)||(e[d]=0),e[d]++;const u=c.getNode();if(!(u&&u instanceof Element))return;const m=u.getBoundingClientRect(),p=o.isOpen&&o.currentStore.id===d?O:0,g=i.has(d)?1:0;if(m){let t=m.left-n.left-p;const o=c.getContextHorizontalScroller();if(o){const e=o.stores.store.state.clientRect,a=null==e?void 0:e.left,s=null==e?void 0:e.right;if(s&&m.left>s)return;a&&(t=Math.max(a-n.left-p,t))}return{type:"presence",userId:a.userId,left:t,top:m.top-n.top+(e[d]+g-1)*q,blockType:c.props.store.getType()}}})))}return[]}({attributionAvatars:m,pageVisitStore:t,presenceStore:n,environment:i,containerEl:l.current})),[i,t,n,m],{debugName:"presenceAvatars",useDeepEqual:!0}),...m];return(0,D.jsx)("div",{className:"notion-presence-container",style:V,ref:l,children:(0,D.jsx)(L.Z,{render:()=>p.map((t=>{const{left:n,top:o}=t,a={avatarWrapperAnimation:{translateX:r?n-21:n-28,translateY:r?o+5:o+3,scale:1,opacity:1},avatarEnterExitAnimation:{scale:.7,opacity:0}},s={...a.avatarWrapperAnimation,...a.avatarEnterExitAnimation};return(0,D.jsx)(A.Z,{isVisible:!0,enterAnimationStyle:s,exitAnimationStyle:s,animationStyle:a.avatarWrapperAnimation,render:()=>(0,D.jsx)(W,{avatar:t,presenceStore:e.presenceStore})},"attribution"===t.type?t.uniqueId:t.userId)}))})})};function F(e,t,n){return e.find((e=>{const o=e.props.store;return Boolean(o&&o.id===t&&n.uiContains(o)&&e.props.shouldShowHalo)}))}function z(e,t,n){const o=e.getLastEditedByPointer(),a=I.default.state;if(!o||o.table!==l.KJ)return;const s=F(t,e.id,e);if(!s)return;const i=e.getType();if("collection_view"===i||"collection_view_page"===i||"divider"===i||"table"===i||"table_row"===i||"tab"===i)return;if(e.isEmptyEditableBlock())return;const r=s.getNode();if(!(r&&r instanceof Element))return;const c=r.getBoundingClientRect();if(!c)return;const d=a.isOpen&&a.currentStore===e?O:0,u=(0,b.zt)((0,b.oJ)(e),e),m=(Z.Z.height-j)/2,p=c.top-n.top+u-m,g=c.left-n.left;return d>0?{type:"attribution",actor:o,left:g-d,top:p,uniqueId:`${String(e.key)}+left`,blockStore:e}:{type:"attribution",actor:o,left:g,top:p,uniqueId:String(e.key),blockStore:e}}function W(e){const{device:t}=(0,a.O7)(),{isMobile:n}=t,{avatar:o}=e,c=(0,d.useIntl)(),u=(0,S.E)("presence_avatar_tooltips"),g="presence"===o.type&&o.blockType?o.blockType:void 0,h=n?B:U,y=(0,i.yK)((()=>{const e=g&&["breadcrumb","bulleted_list","numbered_list","toggle"].includes(g);return{avatarWrapper:{position:"absolute",top:0,left:n&&e?3:0,width:h,height:h},avatar:{width:h,height:h}}}),[n,g,h]),b=(0,s.VK)((()=>{const{rootStore:t}=e.presenceStore.state;if(t){if("presence"===o.type){const e=x.U6.createChildStore(t,{table:l.KJ,id:o.userId});if(!e.isDefined())return null;const n=e.getValue();return(e.pointer.id!==o.userId||e.pointer.table!==l.KJ||n&&n.id!==o.userId)&&r.log({from:"PresenceContainer.tsx",level:"warning",type:"FetchedPointerMismatch",error:(0,m.Ui)(new Error("Value returned by createChildStore does not match avatar userId")),data:{miscDataToConvertToString:{rootStorePointer:t.pointer,requestedId:o.userId,fetchedPointer:e.pointer,fetchedId:null==n?void 0:n.id}}}),{type:"presence",userStore:e}}if("attribution"===o.type){const e=(0,f.nc)({parentStore:t,pointer:o.actor,debugSrc:"PresenceAvatar attribution"});return e.isDefined()?{type:"attribution",userId:e.id,name:e.getDisplayName(c),blockStore:o.blockStore}:null}(0,p.t1)(o)}return null}),[o,c,e.presenceStore]);return b?(0,v.Z)((e=>(0,D.jsx)("div",{style:y.avatarWrapper,...e,children:"presence"===b.type?(0,D.jsx)(E.Z,{hasTooltip:u,userStore:b.userStore,style:y.avatar,size:h,avatarShouldShowShadow:!0}):(0,D.jsx)(_.Z,{userId:b.userId,name:b.name,style:y.avatar,size:U,tooltipStore:b.blockStore})}))):null}},7401:(e,t,n)=>{n.d(t,{at:()=>s,vo:()=>i});var o=n(77907);const a=o.deps.dictation,s=(0,o.lazyComponent)(a,(e=>e.StopDictationButton)),i=(0,o.lazyComponent)(a,(e=>e.DictationBubble))},64286:(e,t,n)=>{n.d(t,{u:()=>i});var o=n(80444),a=n(77080),s=n(15010);function i(e){const{currentUserSettingsStore:t}=o.default.state;if(!t)return!1;const n=(0,s.e2)(t);return!("number"==typeof n&&n>7)&&(!e.device.isMobile&&"on"===a.default.getEligibleGroup({experimentId:"slash_menu_tooltip",defaultGroup:"control"}))}},32360:(e,t,n)=>{n.d(t,{o:()=>a});var o=n(53965);function a(e){const t=o.mN(e.getSpaceViewStores(),(e=>e.getSpaceId())),n=t.filter((e=>{const t=e.getSpaceStore();return e.isReady()&&(null==t?void 0:t.isReady())})),a=n.filter((e=>{const t=e.getSpaceStore();return e.isReady()&&(null==t?void 0:t.isReady())&&t.canEdit()}));return{total:t.length,loaded:n.length,editable:a.length,editableStores:a}}},34232:(e,t,n)=>{n.d(t,{Z:()=>a});var o=n(67294);function a(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const[s,i]=(0,o.useState)(a),r=(0,o.useRef)(null),l=(0,o.useRef)(null);return(0,o.useLayoutEffect)((()=>{null!==l.current&&window.clearTimeout(l.current),null!==r.current&&window.clearTimeout(r.current),l.current=null,r.current=null,e?0===t?i(!0):r.current=window.setTimeout((()=>{r.current=null,i(!0)}),t):0===n?i(!1):l.current=window.setTimeout((()=>{l.current=null,i(!1)}),n)}),[e,t,n]),s}},52432:(e,t,n)=>{n.d(t,{Y:()=>I,f:()=>x});var o=n(21202),a=n(45366),s=n(92338),i=n(53965),r=n(7032),l=n(97978),c=n(97638),d=(n(57658),n(71384)),u=n(80444);class m{constructor(e,t,n){var o;this.featuresets=void 0,this.queryLower=void 0,this.userId=void 0,this.spaceId=void 0,this.currentTimeMs=void 0,this.pageSignals=void 0,this.resultsFeatureMetadata={},this.featuresets=e,this.queryLower=n.toLowerCase(),this.userId=t.currentUser.id,this.spaceId=null===(o=u.default.state.currentSpaceStore)||void 0===o?void 0:o.id,this.currentTimeMs=Date.now(),this.pageSignals=d.Z.getPageSignals({spaceId:this.spaceId,userId:this.userId})}minMaxScale(e,t,n){return t===n?0:(e-t)/(n-t)}extractFeatureGroup(e){const t=[];for(const n of this.featuresets){const o={groupName:n.name,features:[]};for(const t of n.features)o.features.push(t({result:e,featureExtractor:this}));t.push(o)}return t}}var p=n(26842),g=n(55320),f=n(29026),h=n(88893),v=n(43759);const y={name:"CLIENT_FEATURESET_RELEVANCY_MODEL",features:[function(e){let{result:t,featureExtractor:n}=e;return{name:"TIME_SINCE_LAST_EDIT",value:n.currentTimeMs-t.block.blockModel.last_edited_time}},function(e){let{result:t,featureExtractor:n}=e;return{name:"IS_LAST_EDITED_BY_ME",value:n.userId&&t.block.blockModel.last_edited_by_id===n.userId?1:0}},function(e){let{result:t,featureExtractor:n}=e;return{name:"IS_CREATED_BY_ME",value:n.userId&&t.block.blockModel.created_by_id===n.userId?1:0}},...s.ik.map((e=>t=>{let{result:n}=t;return{name:`BLOCK_SOURCE_${e}`,value:n.block.source.has(e)?1:0}})),function(e){var t;let{result:n,featureExtractor:o}=e;return{name:"PAGE_AUTHORITY_V1",value:o.pageSignals?null===(t=o.pageSignals[n.block.blockModel.id])||void 0===t?void 0:t.pageAuthorityV1:void 0}},function(e){let{result:t}=e;return{name:"TITLE_LENGTH",value:t.block.text.length}},function(e){let{result:{terms:t},featureExtractor:{queryLower:n}}=e;return{name:"TERMS_COUNT_NORMALIZED",value:t.length/(0,v.pv)(n).length}},function(e){let{result:{terms:t},featureExtractor:{queryLower:n}}=e;const o=(0,v.pv)(n),a=new Set(t);return{name:"FULL_MATCH_TERM_COUNT_NORMALIZED",value:o.filter((e=>a.has(e))).length/o.length}},function(e){let{result:{terms:t,block:{text:n}}}=e;const o=(0,v.pv)(n.toLowerCase());return{name:"MATCHING_PERCENTAGE_OF_TITLE",value:t.length/o.length}}]},b=1.25,S=[y];function k(e){const{results:t,featureGroups:n}=e;return t.map(((e,t)=>{const{block:o,score:a,personalizationBoost:i,rendered:r,terms:l}=e;return{sources:[s.vp.Local],id:o.blockModel.id,spaceId:o.blockModel.space_id,score:a,localSource:o.source,personalizationBoost:i,terms:l,highlight:{text:r},featureGroups:n[t]}}))}function M(e,t,n){const o=e=>n.matches(e.block),s=(0,a.wS)(t);if(1===s.length)return e.search(t,{filter:o,prefix:!0,fields:["text","inits"]});const i=e.search(t,{filter:o,combineWith:"AND",fields:["text"]});if(i.length>0)return i;const r=s.filter((e=>e.length>=v.Qu)),l=(c=r.length,Math.round(.6*c+.5));var c;return e.search(t,{filter:e=>e.queryTerms.length>=l&&o(e)})}function C(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function N(e){const{block:t,score:n,terms:o}=e,{source:a,text:i}=t,r=o.map(C).join("|"),l=new RegExp(r,"ig");var c;return{block:t,rendered:o.length>0?i.replaceAll(l,`${s.Um}$&${s.dK}`):i,score:n,personalizationBoost:(c=a).has("recentVisit")||c.has("frecencyStore")||c.has("bookmarkedPage")||c.has("defaultRecordCache")?b:1,terms:o}}function w(e,t,n){const{blocks:o,getAllBlocks:a}=e,s=n.text.trim(),i=(0,r.nv)(s),l=i.length>0?i.join(" "):s,d=new c.uL(t);return l.length>0?function(e){const{blocksIndex:t,queryString:n,filterMatcher:o}=e;return M(t,n,o).map((e=>{const t=(0,v.RA)(n,e.block.text);return{...e,score:e.score*t}})).map(N)}({blocksIndex:o,queryString:l,filterMatcher:d}):a().filter((e=>d.matches(e.block))).map(N)}const P=(0,i.Ds)(((e,t,n)=>{S.forEach(((o,a)=>{const s=n.map(((e,n)=>({features:e[a].features,id:t[n].block.blockModel.id})));(0,l.j)(e,"search_local_result_features",{search_session_id:g.default.state.sessionId,group_name:o.name,results_features:s})}))}),1e3,{leading:!1,trailing:!0});function x(e){let{query:t,localCachedPages:n,userId:o,includeRecordMap:a,environment:s,canUseLtr:r}=e;const{query:d,limit:u}=t,{filters:p,sort:g}=d,v=w(n,p,d);if(0===v.length)return;const y=function(e,t){const{field:n}=e,o="relevance"===n||"desc"===e.direction?-1:1;switch(n){case"lastEdited":case"scroll":return(0,i.MR)(t,(e=>{let{block:{blockModel:t}}=e;return o*(t.last_edited_time||0)}));case"created":return(0,i.MR)(t,(e=>{let{block:{blockModel:t}}=e;return o*(t.created_time||0)}));default:return(0,i.MR)(t,(e=>{let{score:t}=e;return o*t}))}}(g,v),b=t.query.text.length>1&&r,M=b?function(e,t,n,o){const a=new m(t,e,n);return o.map((e=>a.extractFeatureGroup(e)))}(s,S,t.query.text,y):y.map((e=>[]));(0,l.j)(s,"search_local_recall_results",{num_visible_members:(0,h.qX)(),results:y.map(R)}),b&&P(s,y,M);const C=("relevance"===g.field?(0,c.YB)({sort:g,currentUserId:o,unsorted:k({results:y,featureGroups:M}),batchSize:f.Xv}):k({results:y,featureGroups:M})).slice(0,u),N=a??!0;return{total:v.length,results:C,recordMap:N?n.recordMap.toJson({allowVersionDowngrade:!1}):{},trackEventProperties:void 0}}function I(e){let{query:t,localCachedPages:n,parentStore:a,isOnline:i,environment:r,shouldLimitLocalResultsWhenOnline:l,maxLocalResultsOverride:d,canUseLtr:u}=e;const m=x({query:t,localCachedPages:n,userId:r.currentUser.id,environment:r,canUseLtr:u});if(!m)return;if(0===m.results.length)return{error:s.Ix.NoResults};let g=m.results.map(((e,t)=>({...e,originalPosition:t,store:p.G.createChildStore(a,{table:o.iU,id:e.id}),serverEventProperties:void 0})));const f=g.length;return i&&l&&(g=(0,c.g8)(r,g,d)),0===g.length?{error:s.Ix.NoResults}:{value:{total:f,results:g,debugInfo:void 0}}}function R(e){const{block:{source:t,blockModel:{id:n}}}=e;return{id:n,localSource:[...t]}}},57345:(e,t,n)=>{n.d(t,{Cv:()=>w,a6:()=>N,lG:()=>C,qg:()=>I,zd:()=>x});n(67294);var o=n(33728),a=n(68626),s=n(72141),i=n(9291),r=n(52629),l=n(7032),c=n(36610),d=n(47307),u=n(76464),m=n(64964),p=n(19306),g=n(26907),f=n(46654),h=n(18245),v=n(88923),y=n(99332),b=n(29677),S=n(66708),k=n(28578),M=n(85893);function C(e){v.default.state.open?y.Z.setState({...y.Z.state,open:!0}):S.Z.setState({...S.Z.state,open:!0}),c.DB(e,{share_menu_session_id:k.ZP.state.sessionId})}function N(e){v.default.state.open?y.Z.setState({...y.Z.state,open:!1}):S.Z.setState({...S.Z.state,open:!1}),c.Rb(e,{share_menu_session_id:k.ZP.state.sessionId}),k.ZP.reset()}function w(e){const{success:t,inviteTargets:n,requestedUserEmails:o}=e;if(0!==n.length){if(!t||0!==(null==o?void 0:o.length))return t&&o.length>0?o.length===n.length?void m.oV({label:(0,M.jsx)(i.FormattedMessage,{id:"shareMenu.inviteSuccess.snackbarMessage.requestedUsersOnly",defaultMessage:"Sent request to invite {users} to this page",values:{users:P(n)}})}):void m.oV({label:(0,M.jsx)(i.FormattedMessage,{id:"shareMenu.inviteSuccess.snackbarMessage.requestedAndInvitedUsers",defaultMessage:"Invited {users} and requested inviting {numberOfRequestedUsers, plural, one {{numberOfRequestedUsers} guest} other {{numberOfRequestedUsers} guests}}",values:{users:P(n.filter((e=>!(0,b.fZ)(e)&&!(0,b.cl)(e)||!o.includes(e.value.email)))),numberOfRequestedUsers:o.length}})}):void m.oV({label:(0,M.jsx)(i.FormattedMessage,{id:"shareMenu.inviteFailure.snackbarMessage",defaultMessage:"Failed to invite {users}",values:{users:P(n)}})});m.oV({label:(0,M.jsx)(i.FormattedMessage,{id:"shareMenu.inviteSuccess.snackbarMessage",defaultMessage:"Successfully invited {users}",values:{users:P(n)}})})}}function P(e){return(0,p.W)(e.map((e=>"group"===e.type?e.value.name??"group":"invalidUser"===e.type?e.value.text:e.value.email)))}async function x(e){const{inviteTargetsStore:t}=e,n=(0,M.jsx)(i.FormattedMessage,{id:"shareMenu.closeInviteDialog.confirmationMessage",defaultMessage:"Your changes have not been saved. Discard changes?"}),o=(0,M.jsx)(i.FormattedMessage,{id:"shareMenu.closeInviteDialog.confirmationButton.label",defaultMessage:"Yes"}),a=(0,M.jsx)(i.FormattedMessage,{id:"shareMenu.closeInviteDialog.cancelButton.label",defaultMessage:"Cancel"});if(t.state.inviteTargets.length>0){return(await d.confirmUserActionV2({message:n,acceptLabel:o,cancelLabel:a})).accept}return!1}async function I(e){const t=h.default.mark("share_menu.invite_user_lag"),{environment:n,blockStore:i,inviteTargetsStore:c,sudoModeStore:d,onInviteClick:m,onInviteComplete:p,inviteOrigin:v,role:y,emailMessage:b,flowId:S}=e;let k={success:!1,requestedUserEmails:[]};try{k=await async function(e){const{environment:t,blockStore:n,sudoModeStore:a,inviteTargetsStore:i,role:r,inviteOrigin:c,emailMessage:d,onInviteStart:m}=e,p=e.flowId||(0,l.ZP)();if(!(0,s.iC)(r))return{success:!1,requestedUserEmails:[]};const{tokenQuery:h,inviteTargets:v}=i.state;if((0,o.oH)(h.trim())&&0===v.length){const e={type:"newUser",value:{email:h.trim()},source:"email"};g.H({target:e,inviteTargetsStore:i})||i.setState({inviteTargets:[...i.state.inviteTargets,e],tokenQuery:""})}const y=await f.mU(n,g.B({inviteTargetsStore:i}));null==m||m();const b=await u.n_({environment:t,store:n,sudoModeStore:a,inviteTargets:y,inviteRole:r,isOnboarding:!1,invite:{inviteFlowId:p,inviteMessage:d,inviteOrigin:c}});return{success:b.success,requestedUserEmails:b.success?Object.keys(b.requestedUsers):[]}}({environment:n,blockStore:i,sudoModeStore:d,inviteTargetsStore:c,role:y,emailMessage:b,inviteOrigin:v,onInviteStart:m,flowId:S})}catch(M){a.log({level:"error",from:"shareMenuActions",type:"handleInviteClick",error:(0,r.Ui)(M)})}finally{null==p||p(k.success,k.requestedUserEmails)}h.default.measure(t,{environment:n})}},758:(e,t,n)=>{n.d(t,{P:()=>d,x:()=>c});var o=n(27117),a=n.n(o),s=n(54153),i=n(53965),r=n(47839);const l="spellcheckEnabled";function c(e){return e instanceof d}class d{constructor(e){this.langCache=new(a())(100),this.enabled=void 0,this.currentInputElement=void 0,this.handleSelectionChange=()=>{if(this.enabled){const e=this.getInputElement();e&&e!==this.currentInputElement?(this.currentInputElement=e,this.handleDetectLanguageChange(e)):e&&this.handleDetectLanguageChangeThrottled(e)}},this.handleDetectLanguageChange=e=>{const t=e.textContent;if(t){let e=this.detectLanguages(t);void 0!==e&&(e=e.map((e=>navigator.language.startsWith(e)?navigator.language:e))),this.setLanguages(e)}},this.handleDetectLanguageChangeThrottled=i.P2(this.handleDetectLanguageChange,500),this.currentLanguages=void 0;const t=s.Z.get(l);this.setEnabled(void 0===t||t);const{isMac:n}=e.device;!n&&r.electronApi&&r.electronApi.loadSpellcheck&&(r.electronApi.loadSpellcheck(),document.addEventListener("selectionchange",this.handleSelectionChange))}setEnabled(e){this.enabled=e,s.Z.set(l,e),r.electronApi&&r.electronApi.setSpellCheckerLanguages&&(e?r.electronApi.setSpellCheckerLanguages(this.getLanguages()):r.electronApi.setSpellCheckerLanguages([]))}isEnabled(){return this.enabled}detectLanguages(e){let t;return this.langCache.cache[e]?(t=this.langCache.get(e),t):(r.electronApi&&r.electronApi.cld&&r.electronApi.cld.detect(e,((e,n)=>{n&&n.reliable&&n.languages&&(t=n.languages.map((e=>e.code)))})),this.langCache.set(e,t),t)}getCorrections(e){return e.dictionarySuggestions}setLanguages(e){i.Xy(this.currentLanguages,e)||(this.currentLanguages=e,r.electronApi&&r.electronApi.setSpellCheckerLanguages&&r.electronApi.setSpellCheckerLanguages(e||[]))}getInputElement(){const e=document.activeElement;if(e instanceof HTMLElement&&("input"===e.tagName||"true"===e.contentEditable))return e}getLanguages(){return navigator.languages.filter((e=>e.includes("-")))}}},33293:(e,t,n)=>{n.d(t,{q:()=>g});var o=n(67294),a=n(86628),s=n(24405),i=n(64275),r=n(9291),l=n(1898),c=n(64921),d=n(50506),u=n(33929),m=n(61254),p=n(85893);function g(e){const{isOpen:t,children:n,onDismiss:r,onClosed:g,style:h,dismissUsing:v}=e,y=function(e){switch(e){case"onlyCloseButton":case"closeButtonOrEscape":return!0;case"onlyEscape":case"none":return!1;default:(0,l.t1)(e)}}(v),[b,S]=function(e,t,n){const s=(0,o.useMemo)((()=>new m.Z),[]),[i,r]=(0,o.useState)(t),l=(0,a.VK)((()=>s.state.open),[s]);return(0,o.useEffect)((()=>{e?r(t):l||(r(void 0),n&&n())}),[e,l,t,n]),[s,i]}(t,n,g),k=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,s.yK)((t=>({cancelButton:{alignItems:"center",background:t.buttonHoveredBackground,borderRadius:"100%",display:"flex",height:20,justifyContent:"center",position:"absolute",right:12,top:12,width:20,zIndex:10},cancelButtonHovered:{background:t.buttonPressedBackground},cancelIcon:{fill:t.mediumTextColor,width:14},innerModal:{borderRadius:10,height:"auto",overflow:"auto",width:300,minHeight:40,padding:"12px 16px",position:"relative",...e}})),[e])}(h),M=(0,o.useCallback)((()=>(0,p.jsxs)(p.Fragment,{children:[y?(0,p.jsx)(c.Z,{hoveredStyle:k.cancelButtonHovered,onClick:()=>r(),style:k.cancelButton,ariaLabel:u.default.formatMessage(f.closeModalAriaLabel),children:(0,i.D)(k.cancelIcon)}):null,S]})),[S,r,y,k.cancelButton,k.cancelButtonHovered,k.cancelIcon]),C=(0,o.useCallback)((()=>{(function(e){switch(e){case"closeButtonOrEscape":case"onlyEscape":return!0;case"onlyCloseButton":case"none":return!1;default:(0,l.t1)(e)}})(v)&&r()}),[v,r]);return(0,p.jsx)(d.Z,{innerStyle:k.innerModal,onDismiss:C,open:t,preventHideChildrenWhileOpening:!0,render:M,store:b,trapFocus:!0})}const f=(0,r.defineMessages)({closeModalAriaLabel:{id:"subscriptions.BillingModal.closeButtonLabel",defaultMessage:"Close modal"}})},49204:(e,t,n)=>{n.d(t,{Id:()=>M,Ng:()=>C,Px:()=>S,ow:()=>k,t_:()=>b,um:()=>y});var o=n(15145),a=n(19889),s=n(9291),i=n(17224),r=n(54642),l=n(9953),c=n(64964),d=n(29974),u=n(13447),m=n(33929),p=n(48779),g=n(80444),f=n(9867),h=n(28517);const v=(0,s.defineMessages)({joinTeamSuccessMessage:{id:"teamInviteLinkActions.joinTeam.confirmationMessage",defaultMessage:"Joined {teamName}"},requestTeamSuccessMessage:{id:"teamInviteLinkActions.requestAccess.successMessage",defaultMessage:"Successfully requested membership"},requestTeamFailureMessage:{id:"teamInviteLinkActions.requestAccess.failureMessage",defaultMessage:"Failed to request membership"}});async function y(e){let{environment:t,userId:n,teamStore:o,user:a}=e;const s=o.getSpaceId();if(!s)return;await f.Cj({environment:t,teamId:o.id,spaceId:s,teamMemberInfos:a,isSettingDefaultTeam:!1,inviterId:n})&&(i.UD(t,{store:o,joined_role:"member",from:"team_invite_link"}),await b({environment:t,userId:n,teamStore:o}),c.oV({label:m.default.formatMessage(v.joinTeamSuccessMessage,{teamName:o.getName()})}))}async function b(e){let{environment:t,userId:n,teamStore:a}=e;const s=g.default.state.currentUserRootStore,i=a.getSpaceId();if(!i||!s)return;const r=s.getSpaceViewStores().filter((e=>e.getSpaceId()===i))[0];await d.y3({environment:t,spaceViewStore:r,userSettingsStore:void 0,userRootStore:s,pageVisitSource:o.tY.JoinTeam,navigationType:"switchingToOrLoadingSpace"}),await h.I({environment:t,spaceId:i,userId:n}),f.hI({environment:t,teamStore:a,shouldScroll:!0})}async function S(e){let{environment:t,teamId:n,message:o}=e;if(!t.currentUser.id)return;"success"===(await r.requestAccess(t,{type:"current-actor-to-team",teamId:n,message:o})).type?(i.LB(t,{teamId:n}),await M({environment:t}),new Promise((e=>setTimeout(e,500))).then((()=>{c.oV({label:m.default.formatMessage(v.requestTeamSuccessMessage)})}))):c.oV({label:m.default.formatMessage(v.requestTeamFailureMessage)})}async function k(e){let{environment:t,teamStore:n,accessRequestStore:o,status:s}=e;const r=o.getForActorId();if(!r)return;const c=o.getRecordModel({table:a.KJ,id:r});if(c){if("approved"===s){const e=[{type:"member",entity_type:"user",user_id:c.id}];if(!(await f.Uj({environment:t,teamStore:n,teamMemberInfos:e,isSettingDefaultTeam:!1,createNewTeamFlowId:void 0})))return}u.createAndCommit({userAction:"GrantAccessActivityAction.handleGrantAccess",environment:t,perform:e=>{l.sW({store:o,transaction:e,data:{resolved_time:Date.now(),resolved_by_table:a.KJ,resolved_by_id:t.currentUser.id,status:s}})}}),i.co(t,{store:n,resolution:s})}}async function M(e){let{environment:t}=e;const{lastVisitedSpaceView:n,userRootStore:a,userSettingsStore:s}=await(0,p.iX)({environment:t,disableRedirectUrl:!1});n?await d.y3({environment:t,spaceViewStore:n,userRootStore:a,userSettingsStore:s,pageVisitSource:o.tY.BackForward,navigationType:"switchingToOrLoadingSpace"}):await d.L5({environment:t,userRootStore:a,userSettingsStore:s,pageVisitSource:o.tY.BackForward})}async function C(e){let{environment:t,teamId:n}=e;const o=await r.getTeamAccessRequestMetadata(t,{teamId:n});if("success"===o.type)return o.data}},14889:(e,t,n)=>{n.d(t,{Z:()=>f});var o=n(67294),a=n(480),s=n(24405),i=n(9291),r=n(74194),l=n(50506),c=n(58297),d=n(64369),u=n(49204),m=n(74016),p=n(85893);const g=(0,i.defineMessages)({message_placeholder:{id:"teamInviteLinkRequestPage.message.placeholder",defaultMessage:"Message (optional)"}});const f=function(e){const{teamStore:t,teamName:n,teamId:f,isModalOpen:h,onDismiss:v}=e,[y,b]=(0,o.useState)(""),S=(0,a.O7)(),k=(0,i.useIntl)(),M=async()=>{await u.Px({environment:S,teamId:f,message:y}),v()},C=(0,s.yK)((()=>({modal:{alignSelf:"center",overflow:"visible",padding:15,width:420},requestTitle:{display:"inline-flex",marginBottom:10},icon:{marginLeft:4,marginRight:4},footer:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:15},requestInvitesButton:{marginLeft:20},input:{padding:8}})),[]);return(0,p.jsx)(l.Z,{open:h,onDismiss:v,innerStyle:C.modal,preventHideChildrenWhileOpening:!0,render:()=>(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{style:C.requestTitle,children:(0,p.jsx)(i.FormattedMessage,{id:"teamInviteLinkRequestModal.reasonForRequest.title",defaultMessage:"Request access to {icon} {teamName}",values:{teamName:n,icon:(0,p.jsx)(m.p,{style:C.icon,store:t,disabled:!0,size:22})}})}),(0,p.jsx)(r.Z,{textarea:!0,style:C.input,value:y,onChange:e=>{b(e.target.value)},placeholder:k.formatMessage(g.message_placeholder)}),(0,p.jsxs)("div",{style:C.footer,children:[(0,p.jsx)(d.Z,{isSecondaryColor:!0,isSmall:!0,isMultiline:!0,children:(0,p.jsx)(i.FormattedMessage,{id:"teamInviteLinkRequestModal.caption",defaultMessage:"Your teamspace owners will approve or decline your request."})}),(0,p.jsx)(c.Z,{isLarge:!0,style:C.requestInvitesButton,onClick:M,children:(0,p.jsx)(i.FormattedMessage,{id:"teamInviteLinkRequestModal.requestAccessButton.label",defaultMessage:"Request"})})]})]})})}},16880:(e,t,n)=>{n.d(t,{R:()=>s});n(67294);var o=n(45238),a=n(85893);const s=(0,o.IU)("chevronUpRounded",{viewBox:"0 0 15 9",svg:(0,a.jsx)("path",{d:"M1.258 6.5L7.203.422a.946.946 0 01.719-.32.99.99 0 01.726.32L14.586 6.5a.89.89 0 01.266.648c0 .524-.407.93-.922.93a.921.921 0 01-.672-.281L7.93 2.32 2.586 7.797a.926.926 0 01-.672.281.915.915 0 01-.922-.93c0-.25.094-.476.266-.648z"})})},64530:(e,t,n)=>{n.d(t,{y:()=>s});n(67294);var o=n(45238),a=n(85893);const s=(0,o.IU)("settingsNotificationsAndPersonal",{viewBox:"0 0 20 20",svg:(0,a.jsx)("path",{d:"M12.5361 7.54883C13.2744 7.54883 13.9033 7.09082 14.1631 6.44141H16.4258C16.7607 6.44141 17.0479 6.14746 17.0479 5.79199C17.0479 5.43652 16.7676 5.14258 16.4258 5.14258H14.1699C13.9102 4.49316 13.2744 4.03516 12.5361 4.03516C11.7979 4.03516 11.1621 4.49316 10.9023 5.14258H3.59473C3.23242 5.14258 2.95215 5.43652 2.95215 5.79199C2.95215 6.14746 3.23926 6.44141 3.59473 6.44141H10.9023C11.1621 7.09082 11.7979 7.54883 12.5361 7.54883ZM12.5361 6.62598C12.0713 6.62598 11.6953 6.25684 11.6953 5.79199C11.6953 5.31348 12.0713 4.95117 12.5361 4.95117C13.0078 4.95117 13.3701 5.31348 13.3701 5.79199C13.3701 6.25684 13.0078 6.62598 12.5361 6.62598ZM3.56738 9.40137C3.23242 9.40137 2.95215 9.68848 2.95215 10.0508C2.95215 10.3994 3.23926 10.6934 3.56738 10.6934H5.91211C6.16504 11.3428 6.80078 11.8076 7.5459 11.8076C8.27734 11.8076 8.91309 11.3428 9.17285 10.6934H16.4053C16.7607 10.6934 17.0479 10.4062 17.0479 10.0508C17.0479 9.68848 16.7676 9.40137 16.4053 9.40137H9.17285C8.91309 8.75195 8.27734 8.29395 7.5459 8.29395C6.80762 8.29395 6.17188 8.75195 5.91211 9.40137H3.56738ZM7.5459 10.8848C7.07422 10.8848 6.70508 10.5156 6.70508 10.0508C6.70508 9.57227 7.07422 9.20996 7.5459 9.20996C8.01758 9.20996 8.37988 9.57227 8.37988 10.0508C8.37988 10.5156 8.01758 10.8848 7.5459 10.8848ZM12.5361 16.0596C13.2744 16.0596 13.9102 15.6016 14.1699 14.9521H16.4258C16.7607 14.9521 17.0479 14.6582 17.0479 14.3027C17.0479 13.9404 16.7676 13.6533 16.4258 13.6533H14.1631C13.9102 13.0039 13.2744 12.5459 12.5361 12.5459C11.7979 12.5459 11.1621 13.0039 10.9023 13.6533H3.59473C3.23242 13.6533 2.95215 13.9473 2.95215 14.3027C2.95215 14.6582 3.23926 14.9521 3.59473 14.9521H10.9023C11.1621 15.6016 11.7979 16.0596 12.5361 16.0596ZM12.5361 15.1436C12.0713 15.1436 11.6953 14.7676 11.6953 14.3027C11.6953 13.8311 12.0713 13.4619 12.5361 13.4619C13.0078 13.4619 13.3701 13.8311 13.3701 14.3027C13.3701 14.7676 13.0078 15.1436 12.5361 15.1436Z"})})},72458:(e,t,n)=>{n.d(t,{A:()=>i,Z:()=>s});var o=n(31701),a=n(15095);function s(e){const t=e.name,n=e.email;let o;if(t||n){if(t){const e=t.split(" ").filter((e=>e.length>0));o=e.length>1?String(a.p4(e[0])[0])+String(a.p4(e[e.length-1])[0]):String(a.p4(t)[0])+String(a.p4(t)[1])}else o=null==n?void 0:n.substring(0,2);return o=o?o.toUpperCase():void 0,o}}function i(e,t){return e&&(0,o.iY)(e,t)}},45366:(e,t,n)=>{n.d(t,{wS:()=>s});var o=n(53965);const a=/[-./\\()"'’‘”“，。、·～；,;<>~!@#$%^&*|+=[\]{}`~?:\s]/u;function s(e){return(0,o.oA)(e.split(a))}}}]);