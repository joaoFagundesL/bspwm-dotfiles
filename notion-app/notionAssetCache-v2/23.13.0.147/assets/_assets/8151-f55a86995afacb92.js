"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[8151],{18574:(e,t,n)=>{n.d(t,{Si:()=>M,TS:()=>y,aX:()=>h,nA:()=>k,z5:()=>x});n(21703);var o=n(67294),i=n(86628),s=n(24405),r=n(51454),a=n(53965),l=n(1898),c=n(1743),d=n(24098),u=n(99417),p=n(45010),m=n(6258),f=n(77794),g=n(57819),v=n(85893);function y(e){const{scrollerStore:t,openState:n,children:a}=e,[p,y]=(0,o.useState)(Date.now()),k=(0,o.useCallback)((()=>y(Date.now())),[]),w=(0,o.useRef)(null),[b,I]=(0,o.useState)(void 0),[A,P]=(0,o.useState)(void 0),j=(0,i.VK)((()=>{const e=(0,g.$b)(n);if(!e)return;const o=(0,u.wA)(e);if(!o)return;const{origin:i}=e;i instanceof m.G&&i.isEmptyEditableBlock()&&(o.height=0);const s=t.state,r=s.clientRect??new DOMRect,a=s.scrollTop,l=function(e){const{openState:t,originRect:n,scrollerRect:o,scrollerScrollTop:i,popupRect:s}=e,r=(null==s?void 0:s.height)??0,a=(null==s?void 0:s.width)??0,l=Math.min(Math.max(n.width,C),S);let c;const d=n.bottom-o.top+i+h.top;n.bottom+r+h.top+h.bottom>o.bottom&&(c=d-(o.height-r-h.bottom+i));let u;a+h.left+h.right>o.width?u=h.left:n.left+a>o.right?u=o.width-a-h.right:(u=n.left-o.left,"initialPromptForAIBlock"===t.stage&&(u-=a-n.width));return{top:d,left:u,width:l,scrollTopIntoView:c}}({openState:n,originRect:o,scrollerRect:r,scrollerScrollTop:a,popupRect:b});return l}),[t,b,n]);(0,o.useEffect)((()=>{j&&P(j)}),[j]);const E=j??A;(0,o.useEffect)((()=>{if(Date.now()-p>500)return;const e=null==E?void 0:E.scrollTopIntoView;if(!e)return;const n=M(t);n&&x(e,n)}),[null==E?void 0:E.scrollTopIntoView,t,p]);const L=(0,s.yK)((e=>({wrap:{position:"absolute",left:null==E?void 0:E.left,top:null==E?void 0:E.top,width:null==E?void 0:E.width,zIndex:r.lB}})),[E]);(0,o.useEffect)((()=>{const e=new f.E;if(!w.current)throw new Error("ref.current is null");let t;return e.observe(w.current),e.rect.addListener((e=>{(0,l.$K)(t)&&cancelAnimationFrame(t),t=requestAnimationFrame((()=>I(e.state)))})),()=>{(0,l.$K)(t)&&cancelAnimationFrame(t),e.destroy()}}),[]);const F="results"===n.stage&&!n.loading;(0,o.useEffect)((()=>{F&&k()}),[F,k]);const T="results"===n.stage&&n.loading,R=(0,g.jq)({resetWhenScrolledToBottom:!1,areWeLoading:T,scrollerStore:t}),Z="results"===n.stage&&"cursor"===n.context.type,[_,N]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{!T||!Z&&_||(R?x.cancel():null!=E&&E.scrollTopIntoView&&(k(),N(!0)))}),[R,_,Z,T,E,k]),(0,v.jsx)(d.Z,{capture:!0,render:e=>(0,v.jsx)(c.Z,{debugName:"PopupPositioner",capture:!0,allowMenuList:!0,allowEsc:!0,children:(0,v.jsx)("div",{style:L.wrap,ref:w,...e,children:E&&a})})})}const x=a.Ds(((e,t)=>{t.scrollByOffset(e,0,{animate:!0}),p.Z.MenuScroller&&p.Z.MenuScroller.scrollToTop()}),60),h={top:4,bottom:6,left:6,right:16},C=500,S=730;function M(e){var t,n;return e===(null===(t=p.Z.PageScroller)||void 0===t?void 0:t.stores.store)?p.Z.PageScroller:e===(null===(n=p.Z.PeekViewScroller)||void 0===n?void 0:n.stores.store)?p.Z.PeekViewScroller:void 0}function k(e){var t,n;return e===(null===(t=p.Z.PageScroller)||void 0===t?void 0:t.stores.store)?"Page":e===(null===(n=p.Z.PeekViewScroller)||void 0===n?void 0:n.stores.store)?"PeekView":void 0}},48151:(e,t,n)=>{n.r(t),n.d(t,{AiEligibilityUpdater:()=>Mt,CompletionPopup:()=>yt,completionActions:()=>i,completionInitialPromptActions:()=>s,favoriteImportActions:()=>r,propertyCompletionsActions:()=>o});var o=n(44866),i=n(84654),s=n(92022),r=n(62878),a=n(67294),l=n(18466),c=n(26263),d=n(1302),u=n(480),p=n(86628),m=n(24405),f=n(42875),g=n(66673),v=n(82883),y=n(9291),x=n(26249),h=n(1898),C=n(46564),S=n(10910),M=n(893),k=n(13447),w=n(77907);const b=w.deps.assistantWriter,I=(0,w.lazyComponent)(b,(e=>e.AssistantWriterPopup));var A=n(3386),P=n(43250),j=n(99417),E=n(43455),L=n(95083),F=n(16772),T=n(29798),R=n(89626),Z=n(16091),_=n(11751),N=n(32163),B=n(50506),D=n(63296),V=n(72495),O=n(24039),U=n(34859),H=n(85893);function K(e){const{open:t,onCancelExit:n,onConfirmExit:o}=e,i=(0,a.useCallback)((()=>(0,H.jsx)(W,{onConfirmExit:o,onCancelExit:n})),[o,n]);return(0,H.jsx)(B.Z,{open:t,render:i,disableAnimation:!0,onDismiss:n})}function W(e){const t=(0,m.yK)((e=>({wrapper:{padding:24,display:"flex",flexDirection:"column",minWidth:280},question:{fontWeight:500,maxWidth:240,textAlign:"center",marginTop:8,marginBottom:8,lineHeight:"1.2em"},icon:{width:32,height:32,alignSelf:"center",paddingTop:8,fill:e.accentColors.purple[400]}})),[]),n={width:"100%",marginTop:8},o=[{key:"confirm",render:e=>(0,H.jsx)(D.Z,{style:n,...e,children:(0,H.jsx)(y.FormattedMessage,{id:"completions.ExitConfirmationDialog.confirmExit",defaultMessage:"Discard"})}),action:e.onConfirmExit},{key:"cancel",render:e=>(0,H.jsx)(D.Z,{style:n,...e,children:(0,H.jsx)(y.FormattedMessage,{id:"completions.ExitConfirmationDialog.cancelExit",defaultMessage:"Cancel"})}),action:e.onCancelExit}];return(0,H.jsx)(O.Z,{capture:!0,preventType:U.Z.All,children:(0,H.jsxs)("div",{style:t.wrapper,children:[(0,_.t)(t.icon),(0,H.jsx)("p",{style:t.question,children:(0,H.jsx)(y.FormattedMessage,{id:"completions.ExitConfirmationDialog.question",defaultMessage:"Do you want to discard the AI response?"})}),(0,H.jsx)(N.Z,{type:N.i.Vertical,initialFocus:0,sections:[{key:"dialog",render:e=>(0,H.jsx)(V.Z,{topBorder:!1,disableMobileBorders:!0,...e}),items:o}]})]})})}var $=n(76095),z=n(1548),G=n(38715),J=n(37612),q=n(62967),X=n(48019),Y=n(73063),Q=n(68894),ee=n(78140),te=n(86825),ne=n(64369),oe=n(33929),ie=n(60709),se=n(80444),re=n(71184);const ae=(0,y.defineMessages)({save:{id:"ai.favorites.save",defaultMessage:"Save changes"},delete:{id:"ai.favorites.delete",defaultMessage:"Delete"},runImmediately:{id:"ai.favorites.runImmediately",defaultMessage:"Run immediately"},actionNameLabel:{id:"ai.favorites.actionNameLabel",defaultMessage:"Action name"},cancelAndGoBack:{id:"ai.favorites.cancelAndGoBack",defaultMessage:"Cancel and go back"}});function le(e){const{state:t,context:n,sessionId:o}=e,i=(0,y.useIntl)(),s=(0,u.O7)(),r=(0,a.useMemo)((()=>new T.Z),[]),l=(0,q.cN)({key:"input",analyticsName:"TODO",displayName:ae.save,validators:[],closeParentMenu:!1,render:()=>(0,H.jsx)(V.Z,{isInput:!0,style:{marginTop:0},children:(0,H.jsx)(Q.ZP,{value:t.current.name,onChange:e=>{t.set({...t.current,name:e.target.value}),r.setState({focus:{section:0,indexLocal:1,indexGlobal:1}})},placeholder:oe.default.formatMessage(ae.actionNameLabel),focusInitial:!0})}),action(e,t){}}),c=[(0,q.$J)({key:"favorite options section",render:e=>(0,H.jsx)(V.Z,{...e}),actions:[l,(0,q.cN)({key:"runImmediately",analyticsName:"TODO",displayName:ae.runImmediately,validators:[],render:(e,n,o)=>{let{blocks:i,environment:s}=n;const r=Boolean(t.current.executeImmediately);return(0,H.jsx)(te.Z,{...e,title:oe.default.formatMessage(ae.runImmediately),on:r})},closeParentMenu:!1,action(e,n){t.set({...t.current,executeImmediately:!t.current.executeImmediately})}})]}),(0,q.$J)({actions:[(0,q.cN)({key:"save",analyticsName:"TODO",displayName:ae.save,validators:[],svg:G.N,closeParentMenu:!1,action(e,n){(0,$.m5)({state:t,environment:s,sessionId:o})}})],key:"actions",render:e=>(0,H.jsx)(V.Z,{...e})}),(0,q.$J)({key:"delete action section",render:e=>(0,H.jsx)(V.Z,{...e}),actions:[(0,q.cN)({key:"delete",analyticsName:"TODO",displayName:ae.delete,validators:[],svg:J.y,closeParentMenu:!1,action(e,n){const{currentUserSettingsStore:i}=se.default.state;i&&(k.createAndCommit({userAction:"ai.favoriteEditorPopup.delete",environment:s,perform(e){(0,re.QC)(t.current,i,e)}}),t.clear(),S.Vo(s,{type:"delete",session_id:o,gtm_favorite_id:t.current.gtmFavoriteId}))}})]})],d=(0,a.useCallback)((()=>{}),[]);return(0,H.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,H.jsxs)("div",{style:{display:"flex",alignItems:"center",padding:"8px 8px 0 8px"},children:[(0,H.jsx)(Y.Z,{icon:z.G,onClick:()=>{(0,$.ny)({environment:s,state:t})},ariaLabel:i.formatMessage(ae.cancelAndGoBack)}),(0,H.jsx)(ne.Z,{isSecondaryColor:!0,isSmall:!0,style:{fontWeight:700},children:(0,H.jsx)(y.FormattedMessage,{id:"ai.favorites.saveHeader",defaultMessage:"Save AI action"})})]}),(0,H.jsx)(ee.Z,{menuType:ie.og.Popup,width:"100%",maxHeight:"min(40vh, 320px)",minHeight:"100%",children:(0,H.jsx)(X.Z,{menuListStore:r,sections:c,onAccept:d,initialFocus:0,context:n})})]})}var ce=n(57819),de=n(2585),ue=n(5257),pe=n(77080);const me=(0,y.defineMessages)({undoAriaLabel:{defaultMessage:"Go to previous AI response",id:"id.completions.undoAriaLabel"},redoAriaLabel:{defaultMessage:"Go to next AI response",id:"id.completions.redoAriaLabel"},historyLabel:{defaultMessage:"{currentRevision} of {totalRevisions}",id:"id.completions.historyLabel"}}),fe={display:"flex",alignItems:"center",marginLeft:-2,marginRight:-2},ge={width:20,height:20,marginLeft:2,marginRight:2};function ve(e){const{onUndo:t,onRedo:n,historyLabel:o}=e,i=(0,y.useIntl)();return t||n?(0,H.jsxs)("div",{style:fe,children:[(0,H.jsx)(Y.Z,{icon:de.f,ariaLabel:i.formatMessage(me.undoAriaLabel),disabled:!t,onClick:t,style:ge}),(0,H.jsx)(ne.Z,{isSmall:!0,isSecondaryColor:!0,style:{fontVariantNumeric:"tabular-nums"},children:o}),(0,H.jsx)(Y.Z,{icon:ue.o,ariaLabel:i.formatMessage(me.redoAriaLabel),disabled:!n,onClick:n,style:ge})]}):null}const ye={onUndo:void 0,onRedo:void 0,historyLabel:void 0};function xe(e,t){const n=F.default.state;if("completionPopup"!==n.type||"results"!==n.stage)return;const{sessionId:o}=n,i=(0,j.xM)(n);S.Bp(e,{session_id:o,inference_id:i.inferenceId,type:t})}var he=n(56863),Ce=n(11066),Se=n(1743),Me=n(74194);const ke=(0,y.defineMessages)({promptLabel:{defaultMessage:"Prompt for action",id:"ai.favoritePromptEditor.promptLabel"}});function we(e,t){e.set({...e.current,action:{...e.current.action,prompt:t}})}function be(e){const{state:t,inputRef:n,sessionId:o}=e,i=(0,u.O7)(),s=(0,ce.bJ)(),r=(0,y.useIntl)().formatMessage(ke.promptLabel);return(0,H.jsxs)(Se.Z,{debugName:"FavoritePromptEditorContent",capture:!0,allowMenuList:!1,allowEsc:!0,children:[(0,H.jsx)(Me.Z,{ref:n,format:Me.B.Transparent,placeholder:r,selectAll:!0,value:t.current.action.prompt,textarea:!0,textareaSubmitOnEnter:!1,autosize:!0,style:{minHeight:28,paddingTop:4,paddingBottom:4},onChange:e=>we(t,e.target.value),onKeyDown:e=>{"Enter"===e.key&&we(t,`${t.current.action.prompt}\n`)},focusInitial:!1}),(0,H.jsx)("div",{style:s.inputActions,children:(0,H.jsx)(Ce.Z,{style:s.purpleButton,onClick:()=>(0,$.m5)({state:t,environment:i,sessionId:o}),children:(0,H.jsx)(y.FormattedMessage,{defaultMessage:"Done",id:"ai.favoritePromptEditor.done"})})})]})}var Ie=n(61519),Ae=n(21273);function Pe(e){const{query:t,setQuery:n,onDismiss:o,onSubmit:i,inputRef:s,submitOnEnter:r,inputPlaceholder:l,children:c}=e,[d,u]=(0,a.useState)(void 0);return(0,H.jsxs)(Se.Z,{debugName:"PromptOrActionInput",capture:!0,allowMenuList:!1,allowEsc:!0,children:[(0,H.jsx)(Me.Z,{ref:s,format:Me.B.Transparent,placeholder:l,selectAll:!0,value:t,textarea:!0,textareaSubmitOnEnter:!0,autosize:!0,style:{minHeight:28,paddingTop:4,paddingBottom:4},onSubmit:e=>{t&&r&&(e.stopPropagation(),null==i||i())},onChange:e=>{n(e.target.value)},onKeyUp:e=>{"Backspace"===e.key&&(""===d&&o(),u(void 0))},onKeyDown:e=>{"Backspace"===e.key&&void 0===d&&u(t)},focusInitial:!0}),c]})}var je=n(83065),Ee=n(58261),Le=n(26388);function Fe(e){const{onSubmit:t,canSend:n}=e,o=(0,ce.bJ)(),i=(0,u.O7)(),s=(0,p.VK)((()=>i.device.isPhone),[i]);return(0,H.jsx)(Le.ZP,{renderTooltip:()=>(0,H.jsxs)("div",{children:[(0,H.jsx)(y.FormattedMessage,{defaultMessage:"Send to AI",id:"completions.CompletionMenuActionBar.sendTooltip"}),(0,H.jsx)(Ee.Z,{style:o.keyboardShortcutInverted,name:"enter"})]}),placement:Le.ug.Bottom,render:e=>(0,H.jsx)(Y.Z,{icon:je._,onClick:t,isPurple:n,disabled:!n,iconStyle:{height:s?24:20,width:s?24:20},ariaLabel:"Send to AI",style:{pointerEvents:"auto",height:s?24:20,width:s?24:20},...e})})}const Te=(0,y.defineMessages)({followUpInputPlaceholder:{id:"AlternativeCommandPalette.followUp.inputPlaceholder",defaultMessage:"Tell AI what to do next…"}}),Re={padding:"8px 10px 8px 14px"};function Ze(e){const t=(0,ce.bJ)(),n=(0,y.useIntl)(),o=0===e.query.trim().length,i=(0,u.Fy)(),s=(0,p.VK)((()=>Ae.Z.isAssistantInWriterEnabled(i)),[i]);return(0,H.jsx)(Pe,{...e,inputPlaceholder:n.formatMessage(Te.followUpInputPlaceholder),children:(0,H.jsxs)("div",{style:t.inputActions,children:[(0,H.jsx)(Fe,{onSubmit:e.onSubmit,canSend:!o}),(e.onUndo||e.onRedo)&&!s&&(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(Ie.Z,{vertical:!0,size:1,style:Re}),(0,H.jsx)(ve,{...e})]})]})})}var _e=n(64921),Ne=n(91839);function Be(e){const{onStop:t,onRetry:n}=e,o=(0,ce.bJ)(),i=(0,u.O7)().device,s=i.isMobileNative&&i.isIOS;return(0,H.jsxs)(A.Z,{debugName:"CompletionInProgressContent",capture:!0,onEnter:()=>{t()},onEsc:()=>{t()},onKeypress:e=>{e.metaKey||"r"!==e.key||n()},children:[(0,H.jsxs)("div",{style:o.writingLabel,children:[(0,H.jsx)(y.FormattedMessage,{id:"AlternativeCompletionsPopupContent.writing",defaultMessage:"AI is writing"}),(0,H.jsx)(Ne.Z,{style:o.loadingDots})]}),!s&&(0,H.jsxs)(_e.Z,{style:o.lightweightButton,onClick:n,children:[(0,H.jsx)(y.FormattedMessage,{id:"AlternativeCompletionsPopupContent.tryAgain.label",defaultMessage:"Try again"}),(0,H.jsx)("span",{style:o.keyboardShortcut,children:(0,H.jsx)(y.FormattedMessage,{id:"AlternativeCompletionsPopupContent.startOver.shortcut",defaultMessage:"r"})})]}),(0,H.jsxs)(_e.Z,{style:o.lightweightButton,onClick:t,children:[s?(0,H.jsx)(y.FormattedMessage,{id:"AlternativeCompletionsPopupContent.cancel.label",defaultMessage:"Cancel"}):(0,H.jsx)(y.FormattedMessage,{id:"AlternativeCompletionsPopupContent.stop.label",defaultMessage:"Stop"}),(0,H.jsx)("span",{style:o.keyboardShortcut,children:(0,H.jsx)(y.FormattedMessage,{id:"AlternativeCompletionsPopupContent.stop.shortcut",defaultMessage:"esc"})})]})]})}var De=n(53965),Ve=n(15201),Oe=n(53336),Ue=n(55217);function He(e){const{temporaryListStore:t,isLoading:n}=e,o=(0,u.O7)(),i=(0,a.useRef)(null),s=null==i?void 0:i.current,r=null==s?void 0:s.getStore(),l=(0,p.VK)((()=>o.device.isPhone),[o]),c=(0,ce.jq)({resetWhenScrolledToBottom:!0,areWeLoading:n,scrollerStore:r});(0,a.useEffect)((()=>{s&&(c?Ke.cancel():Ke(s))}),[s,t,c]);const d={scroller:{maxHeight:l?"min(15vh, 200px)":"min(40vh, 320px)",width:"100%"}};return(0,H.jsx)(a.Fragment,{children:(0,H.jsx)(Oe.Z,{type:U.Z.Y,style:d.scroller,ref:i,children:(0,H.jsx)(Ve.O,{displayName:"CompletionPopupContent",disabled:!0,children:(0,H.jsx)(Ue.Z,{store:t,disabled:!0,disableCommentMenu:!0,disableHoverMenu:!0,disableDrag:!0})})})})}const Ke=De.Ds((e=>{e.scrollToBottom({animate:!0})}),60);var We=n(63594),$e=n(54497),ze=n(42402);const Ge="/help/guides/using-notion-ai#what-are-the-current-limitations-of-notion-ai";function Je(){const e=(0,a.useCallback)((()=>{window.open(Ge)}),[]),t=(0,m.yK)((e=>({icon:{width:12,height:12,fill:e.lightIconColor,marginLeft:2},link:{color:e.lightTextColor,fontWeight:500}})),[]);return(0,H.jsxs)(H.Fragment,{children:[(0,$e.t)(t.icon),(0,H.jsx)(ne.Z,{isSecondaryColor:!0,isSmall:!0,children:(0,H.jsx)(y.FormattedMessage,{id:"completions.AiWarning.warning",defaultMessage:"AI responses can be inaccurate or misleading."})}),(0,H.jsx)(ne.Z,{isSmall:!0,children:(0,H.jsx)(ze.Z,{onClick:e,style:t.link,disableHover:!0,disableUnderline:!0,children:(0,H.jsx)(y.FormattedMessage,{id:"completions.AiWarning.learnMore",defaultMessage:"Learn more"})})})]})}var qe=n(935),Xe=n(81570),Ye=n(80671),Qe=n(44041),et=n(88893),tt=n(35057),nt=n(88280);function ot(){const e=(0,u.O7)(),t=(0,p.VK)((()=>e.device.isMobile),[e]),n=(0,p.VK)((()=>{const e=nt.subscriptionDataStoreInstance.state;return et.GJ(e)}),[]),o=(0,a.useCallback)((()=>{t?Ye.k2():Qe.y(e,{from:"ai_upsell_notice",for:(0,tt.zt)(),addOnFeature:"ai"})}),[e,t]),i=(0,m.yK)((e=>({upsellIcon:{width:14,height:14,fill:e.lightIconColor},upsellLink:{color:e.blueColor,fontWeight:500}})),[]);return(0,H.jsxs)(H.Fragment,{children:[(0,Xe.T)(i.upsellIcon),(0,H.jsxs)(ne.Z,{isSecondaryColor:!0,isSmall:!0,children:[(0,H.jsx)(y.FormattedMessage,{id:"UpsellNotice.label",defaultMessage:"All free AI responses have been used for this workspace."}),!n&&(0,H.jsxs)(H.Fragment,{children:[" ",(0,H.jsx)(y.FormattedMessage,{id:"UpsellNotice.contactWorkspaceOwner.label",defaultMessage:"Contact your workspace owner to add Notion AI."})]})]}),n&&(0,H.jsx)(H.Fragment,{children:(0,H.jsx)(ne.Z,{isSmall:!0,children:(0,H.jsx)(ze.Z,{onClick:o,style:i.upsellLink,disableHover:!0,disableUnderline:!0,children:(0,H.jsx)(y.FormattedMessage,{id:"UpsellNotice.link.label",defaultMessage:"Go unlimited"})})})})]})}const it=!1;function st(e){const{state:t}=e,n=(0,u.O7)(),o=(0,p.VK)((()=>n.device.isPhone),[n]),i=(0,m.yK)((e=>({wrapper:{background:"dark"===e.mode?e.accentColors.gray[100]:e.accentColors.gray[30],display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0 12px",borderTop:`1px solid ${e.lightDividerColor}`,gap:8,color:e.lightTextColor,fontSize:12,minHeight:36},noticeContent:{display:"flex",alignItems:"center",gap:8},actionContent:{display:"flex",alignItems:"center"}})),[]),s=(0,p.VK)((()=>!We.Z.state),[]);if(o)return null;let r,a;return(s||it)&&(r=(0,H.jsx)(ot,{})),"results"!==t.stage||t.loading||(r=r??(0,H.jsx)(Je,{}),a=(0,H.jsx)(qe.u,{revision:(0,j.xM)(t)})),r?(0,H.jsxs)("div",{style:i.wrapper,children:[(0,H.jsx)("div",{style:i.noticeContent,children:r}),a&&(0,H.jsx)("div",{style:i.actionContent,children:a})]}):null}const rt=(0,y.defineMessages)({writeInputPlaceholder:{defaultMessage:"Ask AI to write anything…",id:"completions.PromptMenu.alternativeUiWriteInputPlaceholder"},editInputPlaceholder:{defaultMessage:"Ask AI to edit or generate…",id:"completions.PromptMenu.alternativeUiEditInputPlaceholder"}});function at(e){const{state:t,onDismiss:n,onCompletionRetry:o,onCompletionStop:i,temporaryListStore:s,favoriteEditingState:r}=e,l=(0,a.useRef)(null);(0,a.useEffect)((()=>{he.w()}),[]);const c=(0,u.O7)(),d=(0,p.VK)((()=>c.device.isPhone),[c]),f=(0,m.yK)((e=>({icon:{height:18,width:18,paddingLeft:d?0:4,marginLeft:d?-4:void 0,fill:"dark"===e.mode?e.accentColors.purple[600]:e.accentColors.purple[400]},outer:{width:"100%",minHeight:d?44:36,padding:d?"2px 16px 2px 16px":"2px 12px 2px 8px",display:"flex",flexDirection:"column",justifyContent:"center",gap:2,fontSize:d?16:14}})),[d]),g=(0,H.jsx)("div",{style:{height:36,alignItems:"center",display:"flex"},children:(0,_.t)(f.icon)});return"active"===r.type?(0,H.jsx)("div",{style:f.outer,ref:l,children:(0,H.jsxs)("div",{style:{display:"flex",gap:8,width:"100%"},children:[g,(0,H.jsx)(be,{state:r,inputRef:e.inputRef,sessionId:t.sessionId})]})}):(0,H.jsxs)(H.Fragment,{children:[(0,H.jsxs)("div",{style:f.outer,ref:l,children:[s&&(0,H.jsx)(He,{temporaryListStore:s,isLoading:"results"===t.stage&&t.loading}),(0,H.jsxs)("div",{style:{display:"flex",gap:8,width:"100%"},children:[g,"initialPrompt"===t.stage||"initialPromptForAIBlock"===t.stage?(0,H.jsx)(lt,{...e,paletteMode:(0,ce.rR)(t)}):t.loading?(0,H.jsx)(Be,{onDismiss:n,state:t,onRetry:o,onStop:i}):(0,H.jsx)(Ze,{...e})]})]}),(0,H.jsx)(st,{state:t})]})}function lt(e){const{query:t,onSubmit:n,paletteMode:o}=e,i=(0,ce.bJ)(),s=(0,y.useIntl)(),r="edit"===o?s.formatMessage(rt.editInputPlaceholder):s.formatMessage(rt.writeInputPlaceholder),a=t.trim().length>0;return(0,H.jsx)(Pe,{...e,inputPlaceholder:r,children:(0,H.jsx)("div",{style:i.inputActions,children:(0,H.jsx)(Fe,{onSubmit:n,canSend:a})})})}var ct=n(88202);function dt(e){const{sections:t,onCloseParentMenu:n,context:o,menuListStore:i}=e,s=(0,a.useCallback)((e=>{e.closeParentMenu&&n()}),[n]),r=(0,u.O7)(),l=(0,p.VK)((()=>r.device.isPhone),[r]);return(0,H.jsx)(ee.Z,{menuType:l?ie.og.ActionSheet:ie.og.Popup,width:"100%",maxHeight:l?"min(17vh, 160px)":"min(40vh, 320px)",maxWidth:"100%",children:(0,H.jsx)(X.Z,{menuListStore:i,sections:t,onAccept:s,initialFocus:0,context:o})})}n(21703);var ut=n(51454),pt=n(69454),mt=n(77794),ft=n(18574);function gt(e){const{children:t,scrollerStore:n,openState:o}=e,[i,s]=(0,a.useState)(Date.now()),r=(0,a.useRef)(null),[l,c]=(0,a.useState)(void 0),d=(0,a.useCallback)((()=>s(Date.now())),[]),{WindowSizeStore:m}=(0,u.O7)();(0,a.useEffect)((()=>{const e=new mt.E,t=r.current;if(!t)throw new Error("ref.current is null");e.observe(t);let n=t.getBoundingClientRect().top;e.rect.addListener((e=>{n=e.state.top,c(e.state)}));const o=setInterval((()=>{const o=t.getBoundingClientRect().top;o!==n&&(n=o,e.recompute())}),50);return()=>{e.destroy(),clearInterval(o)}}),[]);const f="results"===o.stage&&!o.loading,v=("results"===o.stage||"initialPrompt"===o.stage)&&"cursor"===o.context.type,y=(0,p.VK)((()=>{const e=(0,ce.$b)(o);if(!e)return;const t=(0,j.wA)(e);if(!t)return;if(!l)return;const n=t.bottom-l.top;return n>0?n:void 0}),[o,l]);(0,a.useEffect)((()=>{if(Date.now()-i>500)return;if(!y)return;const e=(0,ft.Si)(n);e&&(0,ft.z5)(y,e)}),[y,n,i]),(0,a.useEffect)((()=>{f&&v&&d()}),[f,v,d]);const x="results"===o.stage&&o.loading,h=(0,g.D9)(x),[C,S]=(0,a.useState)();(0,a.useEffect)((()=>{h&&!x&&S(Date.now())}),[x,h]),(0,a.useEffect)((()=>{const e=!!C&&Date.now()-C<1e3;(x||e)&&v&&y&&d()}),[v,x,d,y,C]);const M=(0,p.VK)((()=>{const e=pt.Z.state.phase===pt.i.hidden||pt.Z.state.phase===pt.i.willHide,t=pt.Z.estimatedNativeWebBottomOverlap()+ft.aX.bottom;return e?m.getSafePaddingBottomPx(t):t}),[m]);return(0,H.jsx)("div",{ref:r,style:{position:"absolute",bottom:M,left:ft.aX.left,right:ft.aX.left,zIndex:ut.Mo},children:t})}const vt="notion-alternate-ai-ui";function yt(e){const{scrollerStore:t}=e,n=(0,u.O7)(),o=(0,p.VK)((()=>F.default.state),[]);(0,R.w9)(o);const i=(0,a.useMemo)((()=>(0,ce.RR)(o)),[o]),s=(0,p.VK)((()=>i&&(0,ce.$b)(i)),[i]),r=(0,p.VK)((()=>n.device.isPhone),[n]);return i?t!==(null==s?void 0:s.scrollerStore)?null:"assistantCompletionPopup"===i.type?r?null:(0,H.jsx)(ft.TS,{scrollerStore:t,openState:i,children:(0,H.jsx)(I,{completionState:i})}):r?(0,H.jsx)(gt,{scrollerStore:t,openState:i,children:(0,H.jsx)(xt,{openState:i})}):(0,H.jsx)(ft.TS,{scrollerStore:t,openState:i,children:(0,H.jsx)(xt,{openState:i})}):null}function xt(e){const{openState:t}=e,n=(0,u.O7)(),o=(0,y.useIntl)(),r=(0,a.useState)(function(e){switch(e.stage){case"results":return"";case"initialPromptForAIBlock":return e.prompt??e.prefilledValue;case"initialPrompt":return e.prefilledValue;default:return(0,h.t1)(e)}}(t))[0],[b,I]=function(e){const t=(0,y.useIntl)(),[n,o]=(0,a.useState)(""),i=(0,p.VK)((()=>{if("initialPromptForAIBlock"!==e.stage||!(0,j.dU)())return n;const o=e.store.getTitleValue();return(0,v.X)({intl:t,textValue:o,getRecordModel:e.store.getRecordModel,userTimeZone:(0,f.r)()})}),[n,t,e]);return[i,o]}(t),[_,N]=(0,a.useState)(!1),[B,D]=(0,a.useState)(!1),[V,O]=(0,a.useState)(""),U=(0,$.mY)(),W=(0,a.useRef)(null),z=(0,ce.rR)(t),G=(0,a.useMemo)((()=>({environment:n,blocks:[],publicEditMode:void 0})),[n]);(0,R.lZ)(t);const J=(0,a.useCallback)((e=>{S.ov(n,{session_id:t.sessionId,type:e.analyticsName,gtm_favorite_id:e.gtmFavoriteId}),I(e.insertText),i.maybeSetPromptForCurrentAiBlock(n,e.insertText),e.executeImmediately&&N(!0),W.current&&W.current.focusInput()}),[t.sessionId,n,I]),q="results"===t.stage?(0,j.xM)(t).completion:void 0,X=(0,g.Z_)(q,i.COMPLETION_THROTTLE,x.Z),Y="results"===t.stage?t:void 0,Q=(0,w.useDependency)(w.deps.markdownLinkifyIt),ee=(0,w.useDependency)(w.deps.tinyMceMicrosoftWordPasteFilter),te=(0,a.useMemo)((()=>{if(!Y||"textSelection"!==Y.context.type&&"blockSelection"!==Y.context.type)return;if(["idle","pending"].includes(Q.status)||["idle","pending"].includes(ee.status))return;const{userSearchCache:e}=(0,j.xM)(Y);return X?l.Z.withListenerIgnored((()=>{const t=new c.Z({name:"CompletionPopup.PopupContent",isTemporaryData:!0}),o=k.createAndCommit({userAction:"CompletionPopup.temporarymarkdownToBlocks",environment:n,canUndo:!1,perform:o=>{const s=M.Mt({environment:n,text:X,inMemoryRecordCache:t,transaction:o,markdownOptions:(0,E.N9)(e),markdownLinkifyIt:Q.value,tinyMceMicrosoftWordPasteFilter:ee.value});if(s)return i.postProcessAICreatedStores(n,s),M.Lh({environment:n,stores:s,inMemoryRecordCache:t,transaction:o})}}).performResult;return t.addCacheFallback(n.defaultRecordCache.inMemoryRecordCache),o})):void 0}),[Y,X,n,Q,ee]),ne=(0,p.VK)((()=>{if(!te||!Y||"completionPopup"!==Y.type||"results"!==Y.stage||"textSelection"!==Y.context.type&&"blockSelection"!==Y.context.type)return;return Y.context.stores.every((e=>{const t=e.getType();return!!t&&("blockSelection"===Y.context.type?Boolean(L.d[t]):"textSelection"===Y.context.type&&Boolean(L.D[t]))}))}),[Y,te]);let oe=!0,ie=!1;switch(t.stage){case"initialPrompt":if(t.futureRevisions.length>0)break;case"initialPromptForAIBlock":oe=!1;break;case"results":t.loading||"cursor"!==t.context.type||""!==b||(ie=!0);break;default:(0,h.t1)(t)}const se=function(e){const{environment:t,sessionId:n}=e,{value:o}=(0,w.useDependency)(w.deps.markdownLinkifyIt),{value:s}=(0,w.useDependency)(w.deps.tinyMceMicrosoftWordPasteFilter),r=(0,a.useCallback)((e=>{let{exitType:r,selectInsertion:a}=e;const l=F.default.state;"completionPopup"!==l.type||"results"!==l.stage||l.loading||(S.HC(t,{session_id:n,inference_id:(0,j.xM)(l).inferenceId,exit_type:r}),k.createAndCommit({userAction:"CompletionPopup.handleAccept",environment:t,perform:e=>{i.acceptCursorCompletion({environment:t,transaction:e,selectInsertion:a,exitType:r,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:s})}}))}),[t,n,o,s]),l=(0,a.useCallback)((()=>{const e=F.default.state;"completionPopup"!==e.type||"results"!==e.stage||e.loading||((0,ce.Tq)(t),S.HC(t,{session_id:n,inference_id:(0,j.xM)(e).inferenceId,exit_type:"insert"}),"textSelection"===e.context.type?k.createAndCommit({userAction:"CompletionPopup.handleInsert",environment:t,perform:e=>{i.insertTextSelectionCompletion({environment:t,transaction:e,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:s})}}):"blockSelection"===e.context.type&&k.createAndCommit({userAction:"CompletionPopup.handleInsert",environment:t,perform:e=>{i.insertBlockSelectionCompletion({environment:t,transaction:e,replace:!1,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:s})}}))}),[t,n,o,s]),c=(0,a.useCallback)((()=>{const e=F.default.state;"completionPopup"!==e.type||"results"!==e.stage||e.loading||"textSelection"!==e.context.type&&"blockSelection"!==e.context.type||((0,ce.Tq)(t),S.HC(t,{session_id:n,inference_id:(0,j.xM)(e).inferenceId,exit_type:"replace"}),"textSelection"===e.context.type?k.createAndCommit({userAction:"CompletionPopup.handleReplace",environment:t,perform:e=>{i.replaceTextSelectionCompletion({environment:t,transaction:e,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:s})}}):"blockSelection"===e.context.type&&k.createAndCommit({userAction:"CompletionPopup.handleReplace",environment:t,perform:e=>{i.insertBlockSelectionCompletion({environment:t,transaction:e,replace:!0,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:s})}}))}),[t,n,o,s]);return(0,a.useMemo)((()=>({onAccept:r,onInsert:l,onReplace:c})),[r,l,c])}({environment:n,sessionId:t.sessionId});(0,a.useEffect)((()=>{I(r),W.current&&W.current.focusInput()}),[r,I]);const re="results"===t.stage&&t.hasErrored,ae=(0,g.D9)(re),de=re&&!ae,ue=(0,a.useCallback)((e=>{const{purgeFromHistory:t}=e,s=i.revertCurrentCompletionRevision({environment:n,purgeFromHistory:t});s&&"followup"===s.type&&(I((0,ct.Dp)(o,s.improvement)),W.current&&W.current.focusInput())}),[n,o,I]),fe=(0,a.useCallback)((()=>{"results"===t.stage&&(i.revertCurrentCompletionRevision({environment:n,purgeFromHistory:!1}),W.current&&W.current.focusInput())}),[t,n]),ge=(0,a.useCallback)((()=>{"results"===t.stage&&(i.redoCompletionRevision(n),W.current&&W.current.focusInput())}),[n,t]);(0,a.useEffect)((()=>{if(!de||"results"!==t.stage)return;const{sessionId:e}=t;if((0,j.sr)(t))return void ue({purgeFromHistory:!0});const o=(0,j.Iz)(t);i.doesPromptNeedAdditionalUserInput(o)?(I(V),(0,s.retryInitialPrompt)({environment:n})):i.cancelCompletion({environment:n,sessionId:e,inferenceId:o.inferenceId,exitType:"error_modal"})}),[n,de,t,V,ue,I]);const ve=(0,a.useCallback)((()=>{if("results"!==t.stage)return;const{sessionId:e}=t,o=(0,j.xM)(t);if((0,j.sr)(t))return S.Xw(n,{session_id:e,inference_id:o.inferenceId,is_reverting_follow_up_improvement:!0}),void ue({purgeFromHistory:!1});S.Xw(n,{session_id:e,inference_id:o.inferenceId,is_reverting_follow_up_improvement:!1});const r=(0,j.Iz)(t);i.doesPromptNeedAdditionalUserInput(r)?(I((0,j.gY)(r)),(0,s.retryInitialPrompt)({environment:n})):i.handleCompletionPopupRetry({environment:n})}),[n,t,ue,I]),he=(0,a.useCallback)((()=>{if("results"!==t.stage)return;if(!(0,j.xM)(t).completion)return(0,j.sr)(t)?void ue({purgeFromHistory:!0}):(I(V),void(0,s.retryInitialPrompt)({environment:n}));i.stopCompletion(n)}),[t,n,ue,V,I]),Ce=(0,a.useCallback)((()=>{D(!1),d.default.afterNextFlush((()=>{W.current&&W.current.focusInput()}))}),[]),Se=(0,a.useCallback)((()=>{switch(t.stage){case"initialPromptForAIBlock":S.HC(n,{session_id:t.sessionId,inference_id:void 0,exit_type:"accept"}),(0,s.closeInitialPromptAndEndSession)();break;case"initialPrompt":I(""),(0,s.closeInitialPromptButContinueSession)();break;case"results":break;default:(0,h.t1)(t)}}),[t,n,I]),Me=(0,a.useCallback)((e=>{switch((0,ce.Tq)(n),D(!1),t.stage){case"initialPrompt":case"initialPromptForAIBlock":S.HC(n,{session_id:t.sessionId,inference_id:void 0,exit_type:e}),(0,s.closeInitialPromptAndEndSession)();break;case"results":i.cancelCompletion({environment:n,sessionId:t.sessionId,inferenceId:(0,j.xM)(t).inferenceId,exitType:e});break;default:(0,h.t1)(t)}}),[t,n]),ke=(0,a.useCallback)((()=>Me("cancel")),[Me]),we=(0,a.useCallback)((()=>{"active"!==U.type?ie?se.onAccept({exitType:"click_outside_window_accept",selectInsertion:!0}):oe?D(!0):Me("click_outside_window_cancel"):(0,$.bi)({state:U})}),[U,ie,se,Me,oe]),be=(0,p.VK)((()=>(0,j.dU)()),[]);(0,a.useEffect)((()=>{function e(e){return!!(e instanceof Element&&(e.closest(`.${vt}`)||e.closest(`.${P.YPt}`)||e.closest(`.${P.p4m}`)||e.closest(`.${P.zov}`)))}function t(t){be||!e(t.target)&&e(t.relatedTarget)&&t.relatedTarget instanceof HTMLElement&&t.relatedTarget.focus()}function n(t){e(t.target)||("click"!==t.type&&"contextmenu"!==t.type||we(),be||(t.preventDefault(),t.stopPropagation()))}if(!B)return window.addEventListener("focus",t,!0),window.addEventListener("click",n,!0),window.addEventListener("contextmenu",n,!0),window.addEventListener("mousedown",n,!0),window.addEventListener("mouseup",n,!0),window.addEventListener("mouseover",n,!0),window.addEventListener("mouseout",n,!0),window.addEventListener("mouseenter",n,!0),window.addEventListener("mouseleave",n,!0),window.addEventListener("mousemove",n,!0),()=>{window.removeEventListener("focus",t,!0),window.removeEventListener("click",n,!0),window.removeEventListener("contextmenu",n,!0),window.removeEventListener("mousedown",n,!0),window.removeEventListener("mouseup",n,!0),window.removeEventListener("mouseover",n,!0),window.removeEventListener("mouseout",n,!0),window.removeEventListener("mouseenter",n,!0),window.removeEventListener("mouseleave",n,!0),window.removeEventListener("mousemove",n,!0)}}),[we,B,be]);const Ie=(0,a.useCallback)((e=>{O(b),I(""),i.improveCompletion(n,e)}),[n,b,I]),Ae=(0,a.useCallback)((()=>{switch(t.stage){case"initialPrompt":(0,s.closeInitialPromptButContinueSession)(),O(b),I(""),(0,C.Hh)({environment:n,inputValue:b,from:t.from,mode:z});break;case"initialPromptForAIBlock":S.HC(n,{session_id:t.sessionId,inference_id:void 0,exit_type:"accept"}),(0,s.closeInitialPromptAndEndSession)(),O(b),I(""),(0,C.F0)({environment:n,inputValue:b,store:t.store});break;case"results":Ie({type:"helpMeEdit",prompt:b});break;default:(0,h.t1)(t)}}),[b,z,t,n,Ie,I]);(0,a.useEffect)((()=>{_&&(N(!1),Ae())}),[_,Ae]);let Pe="insert";"results"===t.stage&&"cursor"===t.context.type?Pe="accept":ne&&(Pe="replace");const je=(0,p.VK)((()=>t?(0,ct.o_)({environment:n,intl:o,filter:b,state:t,from:t.from,favoriteEditingState:U,onUpdatePromptState:J,onImprove:Ie,context:G,completionResultInfo:{...se,onRetry:ve,onSubmit:Ae,onCancel:ke,defaultAction:Pe}}):[]),[U,G,n,J,Ae,Ie,b,o,t,se,ve,ke,Pe]),Ee=je.length>0,Le=(0,a.useMemo)((()=>new T.Z),[]);(0,a.useEffect)((()=>{Le.setState({focus:{section:0,indexLocal:0,indexGlobal:0}})}),[b,Le]);const Fe=(0,p.VK)((()=>n.device.isPhone),[n]),Te=(0,m.yK)((e=>({mainPopup:{borderRadius:6,background:e.popoverBackground,boxShadow:e.mediumBoxShadow,overflow:"hidden",isolation:"isolate"},menuPopup:{marginTop:4,marginBottom:4,borderRadius:6,background:e.popoverBackground,boxShadow:e.mediumBoxShadow,width:Fe?"100%":320,overflow:"hidden",isolation:"isolate"}})),[Fe]),Re=(0,a.useRef)(null);let Ze;"active"===U.type?Ze=(0,H.jsx)("div",{style:Te.menuPopup,ref:Re,className:vt,children:(0,H.jsx)(le,{sessionId:t.sessionId,state:U,context:G})}):Ee&&(Ze=(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)("div",{style:Te.menuPopup,ref:Re,className:vt,children:(0,H.jsx)(dt,{sections:je,onCloseParentMenu:Se,context:G,menuListStore:Le})}),(0,H.jsx)(Z.gl,{originRef:Re,openState:t,isInputEmpty:!b})]}));const _e=(0,a.useRef)(null),Ne=function(e){const{openState:t,undoRevision:n,redoRevision:o}=e,i=(0,u.O7)(),s=(0,y.useIntl)(),r=(0,p.VK)((()=>pe.default.checkGate("ai_multi_level_undo")),[]),l=(0,a.useCallback)((()=>{n(),xe(i,"undo")}),[i,n]),c=(0,a.useCallback)((()=>{o(),xe(i,"redo")}),[i,o]);if("results"!==t.stage||!r)return ye;const d=t.revisions.length,m=t.futureRevisions.length,f=d+m,g=d;return 1===f?ye:{onUndo:d>1?l:void 0,onRedo:m>0?c:void 0,historyLabel:s.formatMessage(me.historyLabel,{currentRevision:g.toString(),totalRevisions:f.toString()})}}({openState:t,undoRevision:fe,redoRevision:ge});return be?(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(A.Z,{debugName:"CompletionPopup",capture:!0,onEsc:we}),Ze]}):(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(A.Z,{debugName:"CompletionPopup",capture:!0,onEsc:we}),Fe&&Ze,(0,H.jsx)(Z.RD,{originRef:_e,openState:t}),(0,H.jsx)("div",{ref:_e,className:vt,style:Te.mainPopup,children:(0,H.jsx)(at,{state:t,onDismiss:we,onCompletionRetry:ve,onCompletionStop:he,query:b,setQuery:I,onSubmit:Ae,submitOnEnter:!Ee&&!B,inputRef:W,temporaryListStore:te,favoriteEditingState:U,...Ne})}),!Fe&&Ze,(0,H.jsx)(K,{open:B,onConfirmExit:ke,onCancelExit:Ce})]})}var ht=n(19584),Ct=n(56206),St=n(2551);function Mt(e){const t=(0,u.O7)(),n=(0,p.VK)((()=>"completionPopup"===F.default.state.type||Ct.d.state.open),[]),o=(0,p.VK)((()=>{var e;return null===(e=se.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),s=(0,a.useCallback)((async()=>{o&&await i.updateAiEligibility(t,o)}),[t,o]),r=n?30*ht.C0:30*ht.hM;return(0,St.W)(s,r,!1),null}},76095:(e,t,n)=>{n.d(t,{Mi:()=>E,YX:()=>w,bi:()=>T,m5:()=>L,mY:()=>A,ny:()=>F});n(57658);var o=n(67294),i=n(86628),s=n(66673),r=n(50780),a=n(9291),l=n(53965),c=n(1898),d=n(46564),u=n(62967),p=n(10910),m=n(47307),f=n(64964),g=n(13447),v=n(73063),y=n(72495),x=n(45010),h=n(80444),C=n(77080),S=n(30793),M=n(71184),k=n(85893);const w="favorite-actions",b=100,I=(0,a.defineMessages)({favoriteActions:{defaultMessage:"Favorites",id:"ai.favoriteActions.title"},editOrShareFavorite:{defaultMessage:"Edit or share favorite",id:"ai.favoriteActions.editOrShare"}});function A(){const[e,t]=(0,o.useState)(void 0),n=(0,i.VK)((()=>C.default.checkGate("ai_favorites")),[]);return function(e){const t=(0,s.D9)(e);(0,o.useEffect)((()=>{e!==t&&x.Z.MenuScroller&&x.Z.MenuScroller.scrollToTop()}),[e,t])}(Boolean(e)),(0,o.useMemo)((()=>n?e?{type:"active",current:e,set:t,clear:()=>t(void 0)}:{type:"inactive",set:t}:{type:"disabled"}),[e,n])}const P={maxWidth:400,whiteSpace:"pre-wrap"};function j(e){const{value:t}=e;return(0,k.jsx)("div",{style:P,children:(0,k.jsx)("div",{children:t.action.prompt})})}function E(e,t,n,o,i){const s=i.filterOut.toLocaleLowerCase().trim(),a=(0,M.JS)(o),l=[];for(const u of a){if(u.action.prompt.toLocaleLowerCase().trim()===s)continue;const o=o=>(0,k.jsxs)("div",{style:{display:"flex"},children:[(0,k.jsx)(v.Z,{style:{visibility:o.focused?"visible":"hidden",width:18,height:18},onClick:()=>{i.favoriteEditingState.set(u),p.Vo(e,{type:"edit",session_id:t.sessionId,gtm_favorite_id:u.gtmFavoriteId})},icon:r.E,ariaLabel:n.formatMessage(I.editOrShareFavorite)}),!u.executeImmediately&&(0,k.jsx)(d.xj,{type:"updatePrompt",focused:o.focused})]});let a=!1;switch(u.action.type){case"helpMeEdit":"initialPrompt"!==t.stage||"blockSelection"!==t.context.type&&"textSelection"!==t.context.type||(a=!0);break;case"helpMeWrite":"initialPromptForAIBlock"!==t.stage&&"cursor"!==t.context.type||(a=!0);break;default:(0,c.t1)(u.action)}if(a){const e=(0,d.cK)({key:u.id,name:u.name,textToInsert:u.action.prompt,analyticsName:"favoriteAction",gtmFavoriteId:u.gtmFavoriteId,onUpdatePromptState:i.onUpdatePromptState,right:o,renderTooltip:()=>(0,k.jsx)(j,{value:u}),userProvidedSearchName:`${u.name} ${u.action.prompt}`.slice(0,b),executeImmediately:u.executeImmediately});l.push(e)}}return[(0,u.$J)({key:w,title:I.favoriteActions,render:e=>(0,k.jsx)(y.Z,{...e}),actions:l})]}function L(e){const{state:t,environment:n,sessionId:o}=e,{currentUserSettingsStore:i}=h.default.state;i&&(t.current.name?(g.createAndCommit({userAction:"favoriteActions.saveFavoriteEditsAndClearState",environment:n,perform(e){(0,M.gC)(t.current,i,e)}}),t.clear(),p.Vo(n,{type:"save",session_id:o,gtm_favorite_id:t.current.gtmFavoriteId})):f.oV({label:(0,k.jsx)(a.FormattedMessage,{defaultMessage:"Please enter a name for the action.",id:"ai.favoriteActions.nameRequiredMessage"})}))}function F(e){const{state:t,environment:n}=e,{currentUserSettingsStore:o}=h.default.state;o&&(t.current.name||g.createAndCommit({userAction:"favoriteActions.cancelFavoriteEditsAndClearState",environment:n,perform(e){(0,M.QC)(t.current,o,e),(0,S.Nv)(t.current.action,o,e)}}),t.clear())}async function T(e){const{state:t}=e,{currentUserSettingsStore:n}=h.default.state;if(n){const e=(0,M.JS)(n).filter((e=>e.id===t.current.id));if(e.length>0&&l.Xy(t.current,e[0]))return void t.clear()}await m.confirmUserAction({message:(0,k.jsx)(a.FormattedMessage,{defaultMessage:"Are you sure you want to stop editing your favorite? Unsaved changes will be lost.",id:"ai.favoriteActions.cancelConfirmation"}),acceptLabel:(0,k.jsx)(a.FormattedMessage,{defaultMessage:"Discard changes",id:"ai.favoriteActions.cancelConfirmation.discardChanges"}),cancelLabel:(0,k.jsx)(a.FormattedMessage,{defaultMessage:"Go back",id:"ai.favoriteActions.cancelConfirmation.goBack"})})&&t.clear()}},88202:(e,t,n)=>{n.d(t,{o_:()=>U,Dp:()=>H,ow:()=>O});n(30541),n(57658),n(67294);var o=n(24405),i=n(7500),s=n(13148),r=n(1230),a=n(25651),l=n(91427),c=n(98519),d=n(37612),u=n(55863),p=n(9291),m=n(31701),f=n(1898),g=n(46564),v=n(62967),y=n(10910),x=n(72495),h=n(68204),C=n(99417),S=n(80444),M=n(84654),k=n(76095),w=n(71184),b=n(57819),I=(n(21703),n(36769)),A=n(480),P=n(64275),j=n(56666),E=n(13447),L=n(37181),F=n(73063),T=n(30793),R=n(85893);const Z=3,_="recent-actions",N=(0,p.defineMessages)({recentActions:{defaultMessage:"Recents",id:"commandPalette.recentActions.title"},more:{defaultMessage:"See more",id:"commandPalette.recentActions.more"},removeFromMenu:{defaultMessage:"Remove this action from the menu",id:"commandPalette.recentActions.removeFromMenu"},addToFavorites:{defaultMessage:"Add to favorites",id:"commandPalette.recentActions.addToFavorites"}});function B(e){const{focused:t,recentAction:n,state:o,intl:i,sessionId:s}=e,r=(0,A.O7)();return(0,R.jsx)(F.Z,{style:{visibility:t?"visible":"hidden",width:18,height:18},onClick:()=>{y.Vo(r,{type:"create_from_recent",session_id:s,gtm_favorite_id:void 0}),o.set((0,w.kg)(n))},icon:l.e,ariaLabel:i.formatMessage(N.addToFavorites)})}function D(){const e=(0,o.Fg)();return(0,j.o)({width:12,fill:e.mediumIconColor,marginLeft:2,marginRight:2})}(0,I.exposeDebugEnvironmentValue)("resetRecentAndFavoriteAIActions",(e=>()=>{const{currentUserSettingsStore:t}=S.default.state;if(!t)throw new Error("currentUserSettingsStore not found");E.createAndCommit({userAction:"recentActions.debugging.resetRecentAndFavoriteAIActions",environment:e,perform(e){L.d2({userSettingsStore:t,transaction:e,data:{recent_ai_actions:[],favorite_ai_actions:[]}})}})}));const V="This string should never show up in analytics",O=(0,p.defineMessages)({clickToEditAndRetry:{id:"completions.CompletionMenuActionBar.tryAgain.clickToEditAndRetry",defaultMessage:"Click to edit prompt and retry"},clickToRetry:{id:"completions.CompletionMenuActionBar.tryAgain.clickToRetry",defaultMessage:"Click to retry"},tryAgain:{id:"completions.CompletionMenuActionBar.tryAgain",defaultMessage:"Try again"},delete:{id:"completions.CompletionMenuActionBar.delete",defaultMessage:"Discard"},close:{id:"completions.CompletionMenuActionBar.close",defaultMessage:"Close"},keep:{id:"completions.CompletionMenuActionBar.done",defaultMessage:"Done"},accept:{id:"completions.CompletionMenuActionBar.accept",defaultMessage:"Accept changes"},replace:{id:"completions.CompletionMenuActionBar.replace",defaultMessage:"Replace selection"},insert:{id:"completions.CompletionMenuActionBar.insert",defaultMessage:"Insert below"},addToFavorites:{id:"completions.CompletionMenuActionBar.addToFavorites",defaultMessage:"Add to favorites"}});function U(e){const{filter:t,state:n,from:o,favoriteEditingState:p,onUpdatePromptState:m,onImprove:M,context:I,intl:A,environment:j,completionResultInfo:L}=e;let U;switch(n.stage){case"initialPrompt":case"initialPromptForAIBlock":U=function(e){const{state:t,environment:n,intl:o,filter:i,from:s,onUpdatePromptState:r,favoriteEditingState:a,type:l}=e,{currentUserSettingsStore:c}=S.default.state,d=c?function(e,t,n,o,i){const s=i.filterOut.toLocaleLowerCase().trim(),r=(0,T.pz)(n),a=[];let l=0;for(const u of r){const r="recentAction."+l++,c=s=>(0,R.jsxs)("div",{style:{display:"flex"},children:[(0,R.jsx)(F.Z,{style:{visibility:s.focused?"visible":"hidden",width:18,height:18},onClick:()=>E.createAndCommit({userAction:"ai.recentActions.renderRemoveButton",environment:o,perform(e){(0,T.lG)(u,n,e)}}),icon:P.D,ariaLabel:t.formatMessage(N.removeFromMenu)}),"inactive"===i.favoriteEditingState.type?(0,R.jsx)(B,{sessionId:e.sessionId,state:i.favoriteEditingState,focused:s.focused,recentAction:u,intl:t}):(0,R.jsx)(g.xj,{type:"updatePrompt",focused:s.focused})]});let d;if(u.prompt.toLocaleLowerCase().trim()!==s){switch(u.type){case"helpMeEdit":"initialPrompt"!==e.stage||"blockSelection"!==e.context.type&&"textSelection"!==e.context.type||(d=(0,g.cK)({key:r,name:u.prompt,analyticsName:"recentAction",right:c,onUpdatePromptState:i.onUpdatePromptState,renderTooltip:v.zz}));break;case"helpMeWrite":"initialPromptForAIBlock"!==e.stage&&"cursor"!==e.context.type||(d=(0,g.cK)({key:r,name:u.prompt,analyticsName:"recentAction",right:c,onUpdatePromptState:i.onUpdatePromptState,renderTooltip:v.zz}));break;default:(0,f.t1)(u)}d&&a.push(d)}}const c=a.slice(0,Z),d=a.slice(Z);if(d.length){const e=(0,v.$J)({key:"more recent actions",render:e=>(0,R.jsx)(x.Z,{...e}),actions:d}),t=(0,v.MV)({key:"more recent actions extension",displayName:N.more,analyticsName:"Completions - more",validators:[],svg:()=>(0,R.jsx)(D,{}),subActions:()=>[e],collapseSubActionsIntoParent:!0,width:400});c.push(t)}return[(0,v.$J)({key:_,title:N.recentActions,render:e=>(0,R.jsx)(x.Z,{...e}),actions:c})]}(t,o,c,n,{onUpdatePromptState:r,favoriteEditingState:a,filterOut:i}):[],u=c&&"disabled"!==a.type?(0,k.Mi)(n,t,o,c,{onUpdatePromptState:r,favoriteEditingState:a,filterOut:i}):[],p=[...u];"initialPromptForAIBlock"===t.stage?p.push((0,g.xI)({store:t.store,from:s})):"aiBlock"!==l&&p.push(...(0,g.LK)({from:s,type:l,onUpdatePromptState:r}));return p.push(...d),p}({state:n,environment:j,intl:A,filter:t,from:o,context:I,favoriteEditingState:p,onUpdatePromptState:m,type:(0,b.VZ)(n)});break;case"results":U=n.loading?[]:function(e){const{environment:t,state:n,defaultAction:o,closeOrDiscard:p,favoriteEditingState:m}=e,g={key:"insert",analyticsName:V,displayName:O.insert,validators:[],closeParentMenu:!0,svg:r.H,action(){e.onInsert()}},h={key:"delete",analyticsName:V,displayName:O.delete,validators:[],closeParentMenu:!0,svg:d.y,action(){e.onCancel()}},S=function(e){const{state:t,onRetry:n}=e;if("results"!==t.stage)return;const o={key:"tryAgain",analyticsName:V,displayName:O.tryAgain,validators:[],closeParentMenu:!0,svg:u.s,renderTooltip:()=>(0,R.jsx)(K,{state:t}),action(){n()}};return o}({...e}),M=[],k=c.k;"accept"===o?M.push((0,v.cN)({key:"keep",analyticsName:V,displayName:O.keep,validators:[],closeParentMenu:!0,svg:k,action(){e.onAccept({exitType:"accept"})}})):"replace"===o?M.push((0,v.cN)({key:"replace",analyticsName:V,displayName:O.replace,validators:[],closeParentMenu:!0,svg:k,action(){e.onReplace()}}),(0,v.cN)(g)):"insert"===o?M.push((0,v.cN)({...g,svg:k})):(0,f.t1)(o);M.push((0,v.cN)({key:"continueWriting",analyticsName:V,displayName:C.Dr.continueWriting,validators:[],closeParentMenu:!0,svg:W(a.R),action(){e.onImprove({type:"continueWriting"})}}),(0,v.cN)({key:"makeLonger",analyticsName:V,displayName:C.Dr.makeLonger,validators:[],closeParentMenu:!0,svg:W(i.H),action(){e.onImprove({type:"makeLonger"})}}));const b=[(0,v.cN)({key:"addToFavorites",analyticsName:V,displayName:O.addToFavorites,validators:[()=>Boolean($(n,m))],closeParentMenu:!0,svg:l.e,action(){const e=$(n,m);if(!e)return;const o=(0,w.kg)(e.recentAction);e.favoriteEditingState.set(o),y.Vo(t,{type:"create_from_completion",session_id:n.sessionId,gtm_favorite_id:void 0})}}),S?(0,v.cN)(S):void 0,"discard"===p?(0,v.cN)(h):(0,v.cs)({key:"close",analyticsName:V,displayName:O.close,validators:[],closeParentMenu:!0,svg:s.U,shortcuts:["esc"],action(){e.onAccept({exitType:"click_outside_window_accept",selectInsertion:!0})}})],I=(0,v.$J)({key:"main",render:e=>(0,R.jsx)(x.Z,{...e}),actions:M}),A=(0,v.$J)({key:"final",render:e=>(0,R.jsx)(x.Z,{...e}),actions:b.filter(f.$K)});return[I,A]}({environment:j,state:n,onImprove:M,closeOrDiscard:"cursor"===n.context.type?"close":"discard",favoriteEditingState:p,...L});break;default:(0,f.t1)(n)}let H=(0,h.sG)({sections:U,context:I,query:t});if(1===H.length&&H[0].key===_){const e=H[0].actions.slice();(0,C.LN)(t,A)||e.unshift((0,g.sH)({customPrompt:t,execute:L.onSubmit})),H=[(0,v.$J)({key:"actions",render:e=>(0,R.jsx)(x.Z,{...e}),actions:e})]}else(function(e){let t=!1;for(const n of e)if(n.key===k.YX)t=!0;else if(n.key!==_)return!1;return t})(H)&&H.push((0,v.$J)({key:"literal-actions",render:e=>(0,R.jsx)(x.Z,{...e}),actions:[(0,g.sH)({customPrompt:t,execute:L.onSubmit})]}));return H}function H(e,t){switch(t.type){case"continueWriting":return e.formatMessage(C.Dr.continueWriting);case"makeLonger":return e.formatMessage(C.Dr.makeLonger);case"helpMeEdit":return t.prompt}}function K(e){const{state:t}=e,n=(0,o.yK)((e=>({hint:{color:e.mediumInvertedTextColor}})),[]),i=(0,C.xM)(t),s=(0,p.useIntl)();let r,a=O.clickToEditAndRetry;if("initial"===i.type)if(M.doesPromptNeedAdditionalUserInput(i))r=(0,C.gY)(i);else{a=O.clickToRetry;const e=i.clientPrompt.name;r="string"==typeof e?e:s.formatMessage(e)}else"followup"===i.type?r=H(s,i.improvement):(0,f.t1)(i);return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)("div",{children:r}),(0,R.jsx)("div",{style:n.hint,children:s.formatMessage(a)})]})}function W(e){return()=>(0,R.jsx)(g.lA,{svg:e,svgFill:m.FN.light.purple[400]})}function $(e,t){if("disabled"===t.type)return;const n=function(e){if("completionPopup"!==e.type||"results"!==e.stage)return;const t=(0,C.xM)(e);return"initial"===t.type?t:void 0}(e);if(!n)return;const{currentUserSettingsStore:o}=S.default.state;if(!o)return;const i=(0,T.BG)({clientPrompt:n.clientPrompt,additionalContext:n.additionalContext,promptTitle:n.promptTitle});return i&&!(0,w.Gl)(o,i)?{currentInitialRevision:n,recentAction:i,favoriteEditingState:t,currentUserSettingsStore:o}:void 0}},56206:(e,t,n)=>{n.d(t,{d:()=>r});var o=n(49085),i=n(92595);class s extends o.default{getInitialState(){return{open:!1,currentView:"chat"}}}const r=new s;(0,i.exposeDebugValue)("AssistantMenuStore",r)},1548:(e,t,n)=>{n.d(t,{G:()=>s});n(67294);var o=n(45238),i=n(85893);const s=(0,o.IU)("backward",{viewBox:"0 0 24 24",svg:(0,i.jsx)("polygon",{points:"23,11 4.801,11 11.4,4.4 10,3 1,12 10,21 11.4,19.6 4.801,13 23,13 "})})},1230:(e,t,n)=>{n.d(t,{H:()=>s});n(67294);var o=n(45238),i=n(85893);const s=(0,o.IU)("insertDown",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M9.55548 13.0343H14.2085C14.5315 13.0343 14.7951 13.2913 14.7951 13.6142C14.7951 13.9372 14.5315 14.1942 14.2085 14.1942H9.55548C9.23254 14.1942 8.9755 13.9372 8.9755 13.6142C8.9755 13.2913 9.23254 13.0343 9.55548 13.0343ZM1.21167 9.67959C1.21167 9.09961 1.52802 8.74371 2.0421 8.74371C2.55617 8.74371 2.87911 9.11279 2.87911 9.65982V10.7868C2.87911 10.945 2.96479 11.0373 3.12956 11.0373H4.70473V10.365C4.70473 9.818 5.26494 9.60709 5.68675 9.94322L7.56509 11.4525C7.84849 11.6766 7.84849 12.0786 7.56509 12.2961L5.68675 13.812C5.25176 14.1679 4.70473 13.9569 4.70473 13.3836V12.7047H2.93184C1.89051 12.7047 1.21167 12.0984 1.21167 11.057V9.67959ZM9.55548 9.58073H14.2085C14.5315 9.58073 14.7951 9.83777 14.7951 10.1607C14.7951 10.4837 14.5315 10.7407 14.2085 10.7407H9.55548C9.23254 10.7407 8.9755 10.4837 8.9755 10.1607C8.9755 9.83777 9.23254 9.58073 9.55548 9.58073ZM1.78506 6.12721H14.2085C14.5315 6.12721 14.7951 6.38425 14.7951 6.70719C14.7951 7.03014 14.5315 7.28717 14.2085 7.28717H1.78506C1.46211 7.28717 1.20508 7.03014 1.20508 6.70719C1.20508 6.38425 1.46211 6.12721 1.78506 6.12721ZM1.78506 2.68028H14.2085C14.5315 2.68028 14.7951 2.93073 14.7951 3.25367C14.7951 3.5832 14.5315 3.83365 14.2085 3.83365H1.78506C1.46211 3.83365 1.20508 3.5832 1.20508 3.25367C1.20508 2.93073 1.46211 2.68028 1.78506 2.68028Z"})})}}]);