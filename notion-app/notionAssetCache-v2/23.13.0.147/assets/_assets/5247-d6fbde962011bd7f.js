"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[5247],{22974:(e,t,n)=>{n.d(t,{VZ:()=>v,Y7:()=>u,LH:()=>m});var a=n(31701);const o="theme";var r=n(1898),s=n(30021),i=n(4926),d=n(47839);const c=10;function l(e,t){const{device:n,ThemeStore:r}=e,{mode:s,usingSystemTheme:l}=t,u={mode:s};r.setState(u),e.mobileNative&&e.mobileNative.setTheme(s,l),d.setTheme(function(e,t){const n=(0,a.gh)({theme:e});return{mode:e,usingSystemTheme:t,colors:{white:a.ZP.white,blue:a.ZP.blue},borderRadius:4,textColor:n.regularTextColor,popoverBackgroundColor:n.popoverBackground,popoverBoxShadow:n.mediumBoxShadow,inputBoxShadow:n.inputBoxShadow,inputBackgroundColor:n.inputBackground,dividerColor:n.darkDividerColor,shadowOpacity:n.shadowOpacity}}(s,l)),localStorage.setItem(o,JSON.stringify(u)),function(e,t){if(0===e.nativeScrollbarWidth)return;const n=document.getElementById("scroll-properties");n&&(n.innerHTML=`\n\t\t\t::-webkit-scrollbar {\n\t\t\t\twidth: ${c}px;\n\t\t\t\theight: ${c}px;\n\t\t\t}\n\t\t\t::-webkit-scrollbar {\n\t\t\t\tbackground: transparent;\n\t\t\t}\n\t\t\t::-webkit-scrollbar-track {\n\t\t\t\tbackground: ${p.scrollbarTrack[t]};\n\t\t\t}\n\t\t\t::-webkit-scrollbar-thumb {\n\t\t\t\tbackground:${p.scrollbarThumb[t]};\n\t\t\t}\n\t\t\t::-webkit-scrollbar-thumb:hover {\n\t\t\t\tbackground:${p.scrollbarThumbHover[t]};\n\t\t\t}\n\t\t`,i.Z.setState(c))}(n,s),"dark"===s?document.body.classList.add("dark"):document.body.classList.remove("dark")}const p={scrollbarTrack:{light:"#EDECE9",dark:"rgba(202, 204, 206, 0.04)"},scrollbarThumb:{light:"#D3D1CB",dark:"#474c50"},scrollbarThumbHover:{light:"#AEACA6",dark:"rgba(202, 204, 206, 0.3)"}};function u(e){s.Z.setState(e)}function m(e){const t=v(e);switch(t){case"dark":case"light":l(e,{mode:t,usingSystemTheme:!1});break;case"system":!async function(e){const{mobileNative:t}=e;let n="light";n=t&&t.api.getTheme?await t.api.getTheme():e.device.prefersDarkInterface?"dark":"light",l(e,{mode:n,usingSystemTheme:!0})}(e);break;default:(0,r.t1)(t)}}function v(e){const t=s.Z.state||"system";return"dark"===(n=t)||"light"===n||"system"===n?n:"system";var n}},7802:(e,t,n)=>{n.d(t,{Z:()=>Kt});var a=n(67294),o=n(480),r=n(77907),s=n(7032),i=n(97978),d=n(80444);const c=6e4;async function l(e){var t,n;void 0!==d.default.state.currentUserStore&&void 0!==d.default.state.currentSpaceStore||await d.default.waitUntil((()=>void 0!==d.default.state.currentUserStore&&void 0!==d.default.state.currentSpaceStore));const a=null===(t=d.default.state.currentUserStore)||void 0===t?void 0:t.id,o=null===(n=d.default.state.currentSpaceStore)||void 0===n?void 0:n.id;if(!document.hasFocus())return;if(!a||!o)return;const r=i.Cd({userId:a,spaceId:o}),c=Date.now();r?i.ci({userId:a,spaceId:o,session:{...r,lastFocusedTime:c}}):i.ci({userId:a,spaceId:o,session:{id:(0,s.ZP)(),sessionStartTime:c,lastFocusedTime:c}})}var p=n(54064),u=n(54642),m=n(88632),v=n(29755),h=n(17963);const f=new p.Z;var b=n(22974),g=n(30021);var S=n(86628),w=n(12321),U=n(48779),y=n(81236);function E(){const e=(0,o.O7)(),{currentUserRootStore:t}=(0,S.VK)((()=>d.default.state),[]);(0,a.useEffect)((()=>{t&&async function(e,t){await w.w();const n=t.getSpaceViewStores();for(const a of n){const t=a.getBookmarkedPageStores();for(const e of t)k(e);const n=a.getSharedPageStores();for(const e of n)k(e);const o=a.getTeamsStores();for(const e of o){const t=e.getTeamPagesStores();for(const e of t)k(e)}const r=a.getSpaceStore();if(r){y.Z.getData(e,{spaceId:r.id});const t=(0,U.XD)(e,r);for(const e of t)k(e)}}}(e,t)}),[t,e])}function k(e){e.load();const t=e.getCollectionViewSourceOrLinkCollectionStores();for(const n of t)n.load()}var T=n(47839),A=n(95477),_=n(32223);async function L(e){if(e.device.isBrowser&&document.hidden)return;if(e.device.isElectron&&!(await T.isWindowVisible()))return;if(_.isConnected())return void C(!0);if(!1===navigator.onLine&&!A.default.isLocalhost)return void C(!1);"success"===(await u.ping(e,{})).type?C(!0):C(!1)}function C(e){m.Z.setState({...m.Z.state,online:e,lastOfflineTimestamp:e?m.Z.state.lastOfflineTimestamp:Date.now()})}const I=5e3;var Z=n(11342),M=n(74948),R=n(38676),N=n(24042);var P=n(84747),V=n(57400),x=n(64496);const B=6e5;function O(e){(0,x._3)(e)?V.Tm(e):V.Th({environment:e,force:!1})}var D=n(19584),q=n(79947);function F(e){(0,q.ZP)({url:`${A.default.secureFileConfig.rootPath}/refresh`,environment:e,method:"GET",format:"text"})}var $=n(53965),W=n(36610),H=n(88280);const j=$.P2(W.XW,5e3);var K=n(55632),z=n(58455);var G=n(62134),Y=n(45023);var J=n(24502),X=n(68626);var Q=n(1302),ee=n(14577),te=n(61045),ne=n(69454),ae=n(24666);const oe=new ee.Z((()=>{const e=ne.Z.state;return e.phase===ne.i.willShow?0:e.estimatedKeyboardWebViewOverlap}),{debugName:"estimatedKeyboardWebViewOverlapStore"});var re=n(4993),se=n(30583),ie=n(18245),de=n(77080);var ce=n(2449),le=n(85844);var pe=n(98104),ue=n(89224),me=n(59238);const ve=window.matchMedia("(prefers-color-scheme: dark)");var he=n(98794),fe=n(27534);const be="loadCachedPageChunk";var ge=n(13447);var Se=n(64964),we=n(85893);var Ue=n(83355),ye=n(54153),Ee=n(9291),ke=n(35253),Te=n(47307),Ae=n(91754),_e=n(10854),Le=n(46654),Ce=n(21051);class Ie extends Ue.Z{constructor(){super(...arguments),this.handleElectronUpdateChecking=()=>{const{AppUpdateStore:e}=this.environment;e.setState({appUpdate:e.state.appUpdate,electronUpdate:{state:"checking"}})},this.handleElectronUpdateError=(e,t)=>{const{AppUpdateStore:n}=this.environment;n.setState({appUpdate:n.state.appUpdate,electronUpdate:{state:"error",error:t}})},this.handleElectronUpdateNotAvailable=()=>{const{AppUpdateStore:e}=this.environment;e.setState({appUpdate:e.state.appUpdate,electronUpdate:{state:"no-update",timestamp:Date.now()}})},this.handleElectronUpdateAvailable=(e,t)=>{const{AppUpdateStore:n}=this.environment,a=(0,Z.parseVersion)(t.version),o=T.getDesktopVersion(),r=(0,Z.getUpdateType)({currentVersion:o,nextVersion:a,app:"desktop"});n.setState({appUpdate:n.state.appUpdate,electronUpdate:{state:"downloading",type:r,version:a,timestamp:Date.now(),progress:0}})},this.handleElectronUpdateProgress=(e,t)=>{const{AppUpdateStore:n}=this.environment,a=n.state;a.electronUpdate&&"downloading"===a.electronUpdate.state&&n.setState({appUpdate:a.appUpdate,electronUpdate:{...a.electronUpdate,progress:t.transferred/t.total}})},this.handleElectronUpdateReady=(e,t)=>{const{device:n}=this.environment,{AppUpdateStore:a}=this.environment,o=ye.Z.get(_e.Tm),r=t.version;if(o===r){if(n.isMac)return a.setState({appUpdate:a.state.appUpdate,electronUpdate:{state:"ready",type:Z.UpdateType.Major,version:void 0}}),void Te.showDialog({message:(0,we.jsx)(Ee.FormattedMessage,{id:"desktopAppUpdater.moveNotionToApplicationsFolderDialog.prompt",defaultMessage:"Please move the Notion app into the Applications folder for the auto-updater to work."}),showCancel:!1,keepFocus:!1,handleCancel:()=>(0,_e.mK)(this.environment),items:[{label:(0,we.jsx)(Ee.FormattedMessage,{id:"desktopAppUpdater.moveNotionToApplicationsFolderDialog.dismissButton.label",defaultMessage:"Okay"}),onAccept:()=>(0,_e.mK)(this.environment)}]});X.log({level:"error",from:"AppUpdateListener",type:"electronUpdateFailed",data:{miscDataToConvertToString:{previousUpdateReady:o,nextUpdateReady:r}}})}const s=T.getDesktopVersion(),i=(0,Z.parseVersion)(t.version),d=(0,Z.getUpdateType)({currentVersion:s,nextVersion:i,app:"desktop"});a.setState({appUpdate:a.state.appUpdate,electronUpdate:{state:"ready",type:d,version:i}})},this.handleAppUpdateChecking=()=>{const{AppUpdateStore:e}=this.environment;e.state.appUpdate&&"ready"===e.state.appUpdate.state||e.setState({electronUpdate:e.state.electronUpdate,appUpdate:{state:"checking"}})},this.handleElectronAppUpdateError=(e,t)=>{Ne(t,this.environment)},this.handleAppUpdateNotAvailable=()=>{const{AppUpdateStore:e}=this.environment;e.state.appUpdate&&"ready"===e.state.appUpdate.state||e.setState({electronUpdate:e.state.electronUpdate,appUpdate:{state:"no-update",timestamp:Date.now()}})},this.handleElectronAppUpdateAvailable=(e,t)=>{Pe(t,this.environment)},this.handleElectronAppUpdateProgress=(e,t)=>{Ve(t,this.environment)},this.handleElectronAppUpdateReady=(e,t)=>{xe(t,this.environment)},this.handleAppUpdateReload=e=>{ke.Js({bannerStore:Ce.Z}),ce.hC({environment:this.environment,url:window.location.href,version:e})},this.handleElectronAppUpdateInstall=()=>{const e=this.environment.AppUpdateStore;if(m.Z.getState().online&&e.isSilentUpdate()){const t=e.state.appUpdate;ce.hC({environment:this.environment,url:window.location.href,version:t.version})}},this.pollForAppJsUpdates=async()=>{let e="";for(await new Promise((e=>setTimeout(e,5e3)));this.componentIsMounted;){if(void 0===le.Z.state.isVisible||!0===le.Z.state.isVisible)try{const t=ce.ac(),n=await u.getAssetsJsonV2(this.environment,{hash:e});if("success"===n.type){const a=n.data;if("version"in a){const e=(0,Z.parseVersion)(a.version);e&&((0,Z.isEqualVersion)(e,t)||xe(a,this.environment))}"hash"in a&&(e=a.hash||"")}}catch(t){}await new Promise((e=>setTimeout(e,6e4)))}}}didMount(){const{device:e,mobileNative:t}=this.environment;if(e.isElectron?(T.electronUpdateReady.addListener(this.handleElectronUpdateReady),T.electronUpdateError.addListener(this.handleElectronUpdateError),T.electronUpdateChecking.addListener(this.handleElectronUpdateChecking),T.electronUpdateAvailable.addListener(this.handleElectronUpdateAvailable),T.electronUpdateProgress.addListener(this.handleElectronUpdateProgress),T.electronUpdateNotAvailable.addListener(this.handleElectronUpdateNotAvailable),T.appUpdateReady.addListener(this.handleElectronAppUpdateReady),T.appUpdateError.addListener(this.handleElectronAppUpdateError),T.appUpdateChecking.addListener(this.handleAppUpdateChecking),T.appUpdateAvailable.addListener(this.handleElectronAppUpdateAvailable),T.appUpdateInstall.addListener(this.handleElectronAppUpdateInstall),T.appUpdateProgress.addListener(this.handleElectronAppUpdateProgress),T.appUpdateNotAvailable.addListener(this.handleAppUpdateNotAvailable),T.appUpdateReload.addListener(this.handleAppUpdateReload)):t?t.updateReceiveApiHandlers({appUpdateReady:e=>xe(e,this.environment),appUpdateError:e=>Ne(e,this.environment),appUpdateChecking:this.handleAppUpdateChecking,appUpdateAvailable:e=>Pe(e,this.environment),appUpdateProgress:e=>Ve(e,this.environment),appUpdateNotAvailable:this.handleAppUpdateNotAvailable}):A.default.isAdminMode||A.default.isLocalhost&&!A.default.offline||this.pollForAppJsUpdates(),function(e){const t=ce.ac(),n=ce.uG();if(!(0,Z.isEqualVersion)(t,n)){0,Re((0,Z.getUpdateType)({currentVersion:t,nextVersion:n,app:"client"}),n,e)}}(this.environment),e.isMobileNative&&t&&t.api.openUpdateSettings){const t=e.osVersion,n=e.isAndroid&&(0,Z.isLessThanVersion)(t,[7,0]),a=e.isIOS&&(0,Z.isLessThanVersion)(t,[15,0]);(n||a)&&function(e){const{mobileNative:t}=e;if(!t)return;ke.Bw({bannerStore:Ce.Z,id:"PlatformUpdateWarning",contentKey:"mobile_platform_unsupported",styleKey:Ae.v.Red})}(this.environment)}}willUnmount(){const{device:e}=this.environment;e.isElectron&&(T.electronUpdateReady.removeListener(this.handleElectronUpdateReady),T.electronUpdateError.removeListener(this.handleElectronUpdateError),T.electronUpdateChecking.removeListener(this.handleElectronUpdateChecking),T.electronUpdateAvailable.removeListener(this.handleElectronUpdateAvailable),T.electronUpdateProgress.removeListener(this.handleElectronUpdateProgress),T.electronUpdateNotAvailable.removeListener(this.handleElectronUpdateNotAvailable),T.appUpdateReady.removeListener(this.handleElectronAppUpdateReady),T.appUpdateError.removeListener(this.handleElectronAppUpdateError),T.appUpdateChecking.removeListener(this.handleAppUpdateChecking),T.appUpdateAvailable.removeListener(this.handleElectronAppUpdateAvailable),T.appUpdateProgress.removeListener(this.handleElectronAppUpdateProgress),T.appUpdateNotAvailable.removeListener(this.handleAppUpdateNotAvailable),T.appUpdateReload.removeListener(this.handleAppUpdateReload))}}Ie.displayName="AppUpdateListener";const Ze=(0,Ee.injectIntl)(Ie);async function Me(e){const t=await async function(e){await d.default.waitUntilRendered();const{mainEditorCurrentBlockStore:t,currentUserStore:n}=d.default.state;return!(!n||!t||(0,Le.IJ)(e,t))}(e);t&&ke.Bw({bannerStore:Ce.Z,id:"AppUpdate",contentKey:"minor_app_update",styleKey:Ae.v.Blue})}function Re(e,t,n){e===Z.UpdateType.Major?t&&ce.M0(t)?(ce.D$(t),Me(n)):function(e){Te.showDialog({message:(0,we.jsx)(Ee.FormattedMessage,{defaultMessage:"We just launched new features!",id:"breakingUpdateDialog.title"}),showCancel:!1,keepFocus:!1,handleCancel:()=>(0,_e.mK)(e),items:[{label:(0,we.jsx)(Ee.FormattedMessage,{defaultMessage:"Update and see what's new",id:"breakingUpdateDialog.updateButtonTitle"}),color:"blue",onAccept:()=>(0,_e.mK)(e)}],innerStyle:{width:380}})}(n):e===Z.UpdateType.Minor?(t&&ce.M0(t)&&ce.D$(t),Me(n)):t&&ce.M0(t)&&ce.D$(t)}function Ne(e,t){const{AppUpdateStore:n}=t;n.state.appUpdate&&"ready"===n.state.appUpdate.state||n.setState({electronUpdate:n.state.electronUpdate,appUpdate:{state:"error",error:e}})}function Pe(e,t){const{AppUpdateStore:n}=t;if(n.state.appUpdate&&"ready"===n.state.appUpdate.state)return;const a=(0,Z.parseVersion)(e.version),o=ce.ac(),r=(0,Z.getUpdateType)({currentVersion:o,nextVersion:a,app:"client"});n.setState({electronUpdate:n.state.electronUpdate,appUpdate:{state:"downloading",type:r,version:a,timestamp:Date.now(),progress:0}})}function Ve(e,t){const{AppUpdateStore:n}=t,a=n.state;a.appUpdate&&"downloading"===a.appUpdate.state&&n.setState({electronUpdate:a.electronUpdate,appUpdate:{...a.appUpdate,progress:e.downloaded/e.total}})}function xe(e,t){const{AppUpdateStore:n}=t,a=(0,Z.parseVersion)(e.version),o=ce.ac(),r=(0,Z.getUpdateType)({currentVersion:o,nextVersion:a,app:"client"});if(!ce.M0(a)){const e={state:"ready",type:r,version:a};n.setState({electronUpdate:n.state.electronUpdate,appUpdate:e})}Re(r,a,t)}var Be=n(27328),Oe=n(15145),De=n(97213),qe=n(89101),Fe=n(21202),$e=n(92338);const We=["compact","regular","unknown"];var He=n(63811),je=n(12847),Ke=n(83249),ze=n(73990),Ge=n(97977),Ye=n(98958),Je=n(11302),Xe=n(52423),Qe=n(32953),et=n(21862),tt=n(8055),nt=n(1357),at=n(87531),ot=n(24677),rt=n(29974),st=n(70782),it=n(39634),dt=n(12955),ct=n(33929),lt=n(51783),pt=n(44499),ut=n(45162),mt=n(18514),vt=n(45010),ht=n(97638);function ft(e){const t=(0,Be.w_)(e);switch(t.type){case"native":return;case"web":const e=t.route;switch(e.name){case"page":return e.collectionViewId?"collection":"page";case"nativeTab":switch(e.tab){case"search":return"search";case"updates":return"updates";case"assistant":return"assistant"}break;default:return}}}var bt=n(55081),gt=n(75538),St=n(52432),wt=n(24646),Ut=n(97799),yt=n(91190),Et=n(36896),kt=n(44604),Tt=n(5162),At=n(34859),_t=n(12252),Lt=n(21273),Ct=n(30581),It=n(3418),Zt=n(69327),Mt=n(475),Rt=n(65686),Nt=n(53610),Pt=n(66881),Vt=n(6258),xt=n(62820),Bt=n(81023);const Ot=(0,Ee.defineMessages)({failedToMovePageGeneric:{id:"MobileNativeListener.failedToMovePage",defaultMessage:"Failed to move page"}});let Dt;class qt extends Ue.Z{constructor(){super(...arguments),this.bottomBarVisibility=this.createComputedStore((()=>{const{currentUserStore:e}=d.default.state,t=Boolean(null==e?void 0:e.id),n=gt.default.state.isOnboarding,a=(0,Tt.Y)("supportsNativeBottomBarOverlappingWebView")?It.Z.hasOpenMobileSlideUps():It.Z.hasOpenPopups(),o="web"!==(0,Be.w_)(this.environment.TabbedRouterStore.state).type,r=t&&!n&&!a;return(0,Tt.Y)("supportsWebManagedTabNavigation")&&!!o||r})),this.customAddCommentMenuItemEnabled=this.createComputedStore((()=>{var e;if(!(0,Tt.Y)("supportsCustomAddCommentMenuItem"))return!1;const{currentUserStore:t}=d.default.state;if(!Boolean(null==t?void 0:t.id))return!1;if((0,Tt.Y)("supportsNativeBottomBarOverlappingWebView")?It.Z.hasOpenMobileSlideUps():It.Z.hasOpenPopups())return!1;const{TabbedRouterStore:n}=this.environment,a=(0,Be.w_)(n.state),o="web"===a.type&&((null===(e=a.redirectedTo)||void 0===e?void 0:e.route)||a.route);if(!o||"page"!==o.name)return!1;const r=ae.default.state;if("empty"===r.mode)return!1;const s=(0,ut.tp)({multiSelection:r.multiSelection,filterCommonAncestors:!0,focus:void 0});if(!s||0===s.stores.length)return!1;let i=!0;return s.stores.forEach((e=>{i&&(i=i&&e.canComment())})),i})),this.isOnUpdatesPage=this.createComputedStore((()=>{const e=this.environment.TabbedRouterStore.state;return"updates"===e.activeTab&&0===e.tabs.updates.pages.length})),this.aiAssistantEnabledState=this.createComputedStore((()=>{const{currentUserStore:e,currentSpaceStore:t}=d.default.state;if(!e||!t)return;const n=Lt.Z.isShowingQNAOnMobile();return{userId:e.id,spaceId:t.id,enabled:n}})),this.sideBarExpandedStateChangeHandler=()=>{var e;null===(e=this.environment.mobileNative)||void 0===e||e.sidebarVisibility(R.sidebarExpandedStore.state&&!(0,wt.YR)(this.environment),(0,wt.qG)(this.environment))},this.bottomBarVisibilityChange=()=>{var e;const t=this.bottomBarVisibility.state;null===(e=this.environment.mobileNative)||void 0===e||e.toggleBottomBar(t)},this.aiAssistantEnabledStateChange=()=>{var e;const t=this.aiAssistantEnabledState.state;t&&(null===(e=this.environment.mobileNative)||void 0===e||e.updateAiAssistantEnabledState(t))},this.handleSwipeNavigation=()=>{const{mobileNative:e,RouterStore:t}=this.environment;if(e&&e.setWebViewAllowsNavigationGestures){const{route:n}=t.state;"onboarding"===n.name||R.sidebarOpenStore.state||Rt.Z.getPreventScrollType()!==At.Z.None?!1!==Dt&&(Dt=!1,e.setWebViewAllowsNavigationGestures(!1)):!0!==Dt&&(Dt=!0,e.setWebViewAllowsNavigationGestures(!0))}},this.handleKeyboardAutoScroll=()=>{ne.Z.state.phase===ne.i.willShow&&Q.default.afterNextFlush((()=>te.hQ(this.environment)))},this.handleTabbedRouterStoreChange=()=>{var e;const{mobileNative:t,TabbedRouterStore:n}=this.environment,a=null==t||null===(e=t.api)||void 0===e?void 0:e.handleTabbedRouterStateUpdate;if(a){const e=n.state;a({state:e,topPage:(0,Be.w_)(e),webTransitionType:ft(e),updateId:(0,s.ZP)()});const t=n.getPreviousState();if(!t)return;const o=(0,Be.F9)(t),r=(0,Be.F9)(e);$.Xy(o,r)||Ke.w3(this.environment,{origin:o,destination:r,from:e.navigationSource,action:e.navigationAction,logging_source:"mobile_native"})}},this.handleCustomAddMenuItemEnabledChanged=()=>{if(!(0,Tt.Y)("supportsCustomAddCommentMenuItem"))return;const e=this.customAddCommentMenuItemEnabled.state,{mobileNative:t}=this.environment;null==t||t.updateCustomAddCommentMenuItemEnabled(e)},this.getLocalSearchCache=$.HP((async(e,t)=>(await r.deps.searchActions.loader()).getLocalCacheFromAppState(e)),((e,t)=>{var n;return`${e.currentUser.id}-${(null===(n=d.default.state.currentSpaceViewStore)||void 0===n?void 0:n.id)??"none"}-${t??"none"}`}))}UNSAFE_willMount(){const{mobileNative:e,RouterStore:t,TabbedRouterStore:n,device:a}=this.environment;var o;a.isMobileNative&&e&&(R.sidebarOpenStore.addListener(this.handleSwipeNavigation),R.sidebarExpandedStore.addListener(this.sideBarExpandedStateChangeHandler),Ct.Z.addListener(this.handleSwipeNavigation),t.addListener(this.handleSwipeNavigation),ne.Z.addListener(this.handleKeyboardAutoScroll),this.bottomBarVisibility.addListener(this.bottomBarVisibilityChange),this.aiAssistantEnabledState.addListener(this.aiAssistantEnabledStateChange),this.environment.WindowSizeStore.addListener(this.sideBarExpandedStateChangeHandler),n.addListener(this.handleTabbedRouterStoreChange),this.customAddCommentMenuItemEnabled.addListener(this.handleCustomAddMenuItemEnabledChanged),e.updateReceiveApiHandlers({statusBarTap:jt,backButtonPress:()=>G.Zm(this.environment,{type:"backbutton"}),keyboardWillShow:e=>{ne.Z.updateKeyboardPhase(this.environment,ne.i.willShow,e??0)},keyboardDidShow:e=>ne.Z.updateKeyboardPhase(this.environment,ne.i.shown,e??0),keyboardWillHide:()=>{ne.Z.updateKeyboardPhase(this.environment,ne.i.willHide,0)},keyboardDidHide:()=>{var e;(ne.Z.updateKeyboardPhase(this.environment,ne.i.hidden,0),a.isIpad)&&(ot.ZH(this.environment),null===(e=this.environment.NativeMobileActionBarStore)||void 0===e||e.clear(!0))},keyboardShortcut:e=>G.Zm(this.environment,e),pushNotificationTokenRefresh:e=>Ye.handleTokenRefresh(this.environment,e,"refresh"),resume:_t.Z.resume,pause:_t.Z.pause,refreshSubscriptionData:async e=>{await u.invalidateSubscriptionData(this.environment,{spaceId:e,provider:"revenue_cat"}),await Bt.bi(this.environment)},refreshSubscriptionDataV2:async()=>{await Bt.bi(this.environment)},processMobileActionBarAction:t=>{const{componentId:n,action:a}=t;e.componentEvents.dispatch("MobileActionBar",n,"onAction",{action:a})},updateExperimentData:async e=>{if((0,x._3)(this.environment)){const t=await(0,dt.getExperimentDeviceId)(this.environment),n=this.environment.currentUser.id,a=(0,x.fP)(t,n,e);a&&de.default.updateState(a,this.environment)}},trackExperimentExposure:async e=>{await W.Bb({environment:this.environment,experiment_id:e.experimentId,experiment_version:e.experimentVersion,experiment_group:e.group||"ineligible",logging_source:"mobile_native"})},receiveRawMessageStoreMessage:e=>{_.onMobileNativeReceiveRawMessageStoreMessage(e,this.environment)},updateMessageStoreState:e=>{_.onMobileNativeUpdateMessageStoreState(e,this.environment)},logout:e=>{Ge.logoutSingleAccount({environment:this.environment,userId:e,logoutOrigin:De.F.MobileNativeListener})},logoutAll:()=>{Ge.logout(this.environment)},openDestinationV2:e=>{It.Z.closeAll();const t=this.environment,a=(0,Be.w_)(t.TabbedRouterStore.state),{activeTab:o,tabs:r}=t.TabbedRouterStore.state,s=a===r[o].rootPage,i="native"===a.type,d=s&&i;switch((0,mt.__)(this.environment)&&nt.S({environment:this.environment,tab:n.state.activeTab,nativeRootPageOverrideEnabled:!1}),e.type){case"moveTo":!function(e,t){const n=new Vt.G(t,{table:Fe.iU,id:e});Je.bA({environment:t,blocks:[n],moveToContext:"home_tab",onAccept:e=>{et.r({store:n,environment:t,pageVisitSource:Oe.tY.Move})}})}(e.blockId,this.environment);break;case"trash":Ht({query:e.query});break;case"AIAssistant":!function(e,t,n){Pt.g.update((e=>({query:n.query,searchSessionId:n.searchSessionId,from:n.from??"search",shouldReset:Boolean(n.query&&n.query.trim().length>0)}))),tt.c4({environment:e,url:`${qe.VP.nativeTab}/assistant`,redirect:t})}(this.environment,d,{query:e.query,searchSessionId:e.searchSessionId,from:e.from})}},openDestination:e=>{It.Z.closeAll();switch("closePopup"!==e&&(0,mt.__)(this.environment)&&nt.S({environment:this.environment,tab:n.state.activeTab,nativeRootPageOverrideEnabled:!1}),e){case"search":!function(e){(0,Tt.Y)("supportsNativeHome")&&e.device.isPhone?(Qe.Hu({RouterStore:e.RouterStore,currentUserId:e.currentUser.id}),at.UT({environment:e,analyticsFrom:"mobile-bottom-bar",renderAsPage:!0})):at.UT({environment:e,analyticsFrom:"mobile-bottom-bar"});Ke.nB(e,{itemName:"search",logging_source:"mobile_native"})}(this.environment);break;case"addPage":!function(e){(0,Tt.Y)("supportsNativeHome")&&e.device.isPhone?(Qe.Hu({RouterStore:e.RouterStore,currentUserId:e.currentUser.id}),M.quickAddPage({environment:e,from:"mobile_bottom_bar",redirect:!0,quickAddParentOverride:{type:"space-private-pages"}})):M.quickAddPage({environment:e,from:"mobile_bottom_bar"});Ke.nB(e,{itemName:"add_page"})}(this.environment);break;case"allUpdates":t=this.environment,(0,Tt.Y)("supportsNativeHome")&&t.device.isPhone?(Qe.Hu({RouterStore:t.RouterStore,currentUserId:t.currentUser.id}),tt.c4({environment:t,url:`${qe.VP.nativeTab}/updates`,redirect:!0})):xt.Z.setState({...xt.Z.state,open:!0});break;case"addAccount":yt.C.setState({...yt.C.state,open:!0});break;case"createOrJoinWorkspace":return async function(e){await bt.xN(e)}(this.environment);case"notificationAndSettings":Ut.Z.setState({open:!0,source:Ut.Y.Home});break;case"trash":Ht({});break;case"memberSettings":Nt.Z.setState({...Nt.Z.state,open:!0});break;case"help":Mt.Z.setState({...Mt.Z.state,open:!0});break;case"intercom_messages":!function(e){it.j({environment:e,from:"help_button"})}(this.environment)}var t},setCurrentUserId:async e=>{await async function(e,t){if(t.currentUser.id===e)return;await st.x({environment:t,newCurrentUserId:e})}(e,this.environment)},setCurrentSpace:async e=>{await async function(e,t,n){const a=await st.x({environment:n,newCurrentUserId:e}),{currentUserRootStore:o,currentUserSettingsStore:r}=d.default.state;if(!o)return;await o.load();const s=(0,U.w3)(t);s&&await rt.y3({environment:a,spaceViewStore:s,userSettingsStore:r,userRootStore:o,pageVisitSource:Oe.tY.SwitchSpace,navigationType:"switchingToOrLoadingSpace"})}(e.userId,e.spaceId,this.environment)},updateHorizontalSizeClass:t=>{const n=(0,He.Gu)(je.literals(...We),t)?"unknown":t;n!==e.horizontalSizeClass.state&&e.horizontalSizeClass.setState(n)},updateTabbedRouterState:e=>{var t;const{TabbedRouterStore:n}=this.environment,a=n.state;if(e.tab!==a.activeTab||null!==(t=e.pages)&&void 0!==t&&t.length||!$.Xy(e.modal,a.modal)||a.tabs[a.activeTab].pages.length){const t=e.navigationEffect;if(t&&"AIAssistant"===t.type)Pt.g.update((e=>({query:t.query,searchSessionId:t.searchSessionId,from:t.from??"search",shouldReset:Boolean(t.query&&t.query.trim().length>0)})));nt.S({environment:this.environment,tab:e.tab,queryParams:e.queryParams,pages:e.pages,modal:e.modal,nativeRootPageOverrideEnabled:e.nativeRootPageOverrideEnabled,navigationAction:e.navigationAction,navigationSource:e.navigationSource})}else Wt();const o=n.state;return[{state:o,topPage:(0,Be.w_)(o),webTransitionType:ft(o),updateId:e.updateId??(0,s.ZP)()}]},getLocalSearchResults:async e=>{const t=await this.getLocalSearchCache(this.environment,e.searchSessionId);if(!t)return[{error:"Local cache does not exist"}];const n=(0,He.Gu)($e.GA,e.sort);if(n)return[{error:`old sort type is unsupported! ${n}`}];const a=e.sort,o=(0,St.f)({query:{query:{text:e.query??"",filters:e.filters,sort:a},limit:e.limit},localCachedPages:t,includeRecordMap:!1,userId:this.environment.currentUser.id,environment:this.environment,canUseLtr:!1}),r=[{value:{total:0,results:[],recordMap:{},trackEventProperties:void 0}}];if(!o||0===o.results.length)return r;const s=m.Z.state.online?ht.g8(this.environment,o.results):o.results;return[{value:{results:s,total:s.length,recordMap:{},trackEventProperties:{}}}]},customAddCommentMenuItemTapped:()=>{(0,lt.ol)(this.environment,"custom_add_comment_menu_item")},filterValidMoveToBlocks:e=>{const t=e.targets.map((e=>new Vt.G(this.environment,{table:Fe.iU,id:e}))),n=e.blocks.filter((e=>{const n=new Vt.G(this.environment,{table:Fe.iU,id:e});return n.canEdit()&&(0,pt.Xk)(n,t)}));return[{value:{targets:e.targets,blocks:n}}]},completeMoveToTransaction:async e=>{const{targets:t,destination:n,moveToContext:a,timeToSelectMs:o,isSearchResult:r,flowId:s}=e,i=this.environment,d=t.map((e=>new Vt.G(this.environment,{table:Fe.iU,id:e}))),c=Je.QF(i,t,n);if(d&&d.length>0&&!c)try{return await ge.createAndCommitAsync({userAction:"MobileNativeListener.completeMoveTo",environment:i,waitForServerCommit:!1,perform:async e=>{await Je.RL({targets:d,value:n,transaction:e,environment:i,moveToContext:a,renderType:"native",timeToSelectMs:o,disableSuccessToast:!0,isSearchResult:r,flowId:s})}}),[{value:e}]}catch(l){}return ze.fW(i,{type:"moved_to_subpage"}),[{error:ct.default.formatMessage(Ot.failedToMovePageGeneric)}]},undoRevision:()=>{Xe.Yw(this.environment,!0)},searchTeams:async e=>{const{query:t}=e,n=d.default.state.currentSpaceStore,a=d.default.state.currentSpaceViewStore;if(!n||!a)return[{error:"SpaceStore or SpaceViewStore was undefined"}];const o=await r.deps.searchActions.loader();return[{value:{ids:(await o.searchTeams({spaceViewStore:a,query:t,teamStores:a.getTeamsStores()})).map((e=>e.id))}}]}}),null!==(o=this.environment.mobileNative)&&void 0!==o&&o.api.ready&&this.environment.mobileNative.api.ready(),this.sideBarExpandedStateChangeHandler(),this.handleCustomAddMenuItemEnabledChanged())}willUnmount(){const{mobileNative:e,RouterStore:t,TabbedRouterStore:n,device:a}=this.environment;a.isMobileNative&&e&&(R.sidebarOpenStore.removeListener(this.handleSwipeNavigation),R.sidebarExpandedStore.removeListener(this.sideBarExpandedStateChangeHandler),Ct.Z.removeListener(this.handleSwipeNavigation),t.removeListener(this.handleSwipeNavigation),ne.Z.removeListener(this.handleKeyboardAutoScroll),this.bottomBarVisibility.removeListener(this.bottomBarVisibilityChange),this.aiAssistantEnabledState.removeListener(this.aiAssistantEnabledStateChange),n.removeListener(this.handleTabbedRouterStoreChange),this.customAddCommentMenuItemEnabled.removeListener(this.handleCustomAddMenuItemEnabledChanged))}renderComponent(){return(0,we.jsx)($t,{getLocalSearchCache:this.getLocalSearchCache})}}qt.displayName="MobileNativeListener";const Ft=qt;function $t(e){let{getLocalSearchCache:t}=e;const n=(0,o.O7)(),{device:r}=n,i=(0,a.useRef)(),c=(0,a.useRef)(),l=(0,a.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object.keys(e.tabs).forEach((n=>{const a=n;t&&(e.tabs[a].nativeRootPageOverrideEnabled=void 0),e.tabs[a].pages="home"!==a?[]:e.tabs[a].pages.splice(0,1)}))}),[]),p=(0,a.useCallback)((e=>{var a;i.current=null==e?void 0:e.id;const{mobileNative:o,TabbedRouterStore:r,currentUser:c}=n,p=d.default.state.currentSpaceStore,u=null==p?void 0:p.id;if(null!=o&&null!==(a=o.api)&&void 0!==a&&a.setCurrentSpaceInfo&&(X.log({level:"info",from:"appActions",type:"SpaceSwitchingDebug",data:{message:"Web calling nativeAPI setCurrentSpaceInfo",spaceId:u}}),o.api.setCurrentSpaceInfo({spaceId:u,spaceViewId:null==e?void 0:e.id,userId:c.id,editable:(null==p?void 0:p.canEdit())??!0})),(0,mt.__)(n)){const e=e=>{if("web"!==e.type)return;const t={...e.queryParams},n=u&&(0,s.cj)(u);t.spaceId=n,e.queryParams=t,e.route.spaceId=n},t=$.Xh(r.state);e(t.tabs.search.rootPage),e(t.tabs.updates.rootPage),e(t.tabs.addPage.rootPage),l(t),r.setState(t)}t(n,void 0)}),[l,n,t]),u=(0,a.useCallback)((e=>{var t;c.current=null==e?void 0:e.id,null!==(t=n.mobileNative)&&void 0!==t&&null!==(t=t.api)&&void 0!==t&&t.setCurrentUserInfo&&n.mobileNative.api.setCurrentUserInfo({userId:null==e?void 0:e.id,loggedInUserIds:n.currentUser.loggedInUserIds});const a=!(0,mt.__)(n)||void 0===n.currentUser.id,{TabbedRouterStore:o}=n,r=$.Xh(o.state);l(r,a),o.setState(r)}),[l,n]),m=(0,a.useCallback)((()=>{const{currentUserStore:e,currentSpaceStore:t}=d.default.state;null!=e&&e.id&&null!=t&&t.id&&Zt.Z.reinitializeState(n,e.id,t.id);(void 0===(null==e?void 0:e.id)||c.current!==(null==e?void 0:e.id))&&u(e);const a=d.default.state.currentSpaceViewStore;i.current!==(null==a?void 0:a.id)&&p(a)}),[n,p,u]);return(0,a.useEffect)((()=>{if(r.isMobileNative&&n.mobileNative)return m(),d.default.addListener(m),()=>{d.default.removeListener(m)}}),[r.isMobileNative,n,t,m]),null}function Wt(){Rt.Z.getPreventScrollType()===At.Z.None&&(R.sidebarOpenStore.state?vt.Z.SidebarMobileScroller&&vt.Z.SidebarMobileScroller.scrollToTop({animate:!0,animationCallback:$.yR}):vt.Z.MenuScroller?vt.Z.MenuScroller.scrollToTop({animate:!0,animationCallback:$.yR}):vt.Z.MenuPageScroller?vt.Z.MenuPageScroller.scrollToTop({animate:!0,animationCallback:$.yR}):vt.Z.PageScroller&&vt.Z.PageScroller.scrollToTop({animate:!0,animationCallback:$.yR}))}function Ht(e){Et.Z.setState({open:!0});const{query:t}=e;t&&kt.Z.setState({...kt.Z.state,currentTab:"all_pages",filter:t,limit:kt.Z.startLimit})}function jt(){Wt()}function Kt(){const e=(0,o.Fy)();return function(){const e=(0,o.O7)(),t=(0,o.Fy)();(0,a.useEffect)((()=>{if(t.isMobileNative)return;let e;document.hasFocus()&&(e=setInterval((()=>{l()}),c),l());const n=()=>{e&&clearInterval(e),e=setInterval((()=>{l()}),c),l()},a=()=>{e&&clearInterval(e),e=void 0};return window.addEventListener("focus",n),window.addEventListener("blur",a),()=>{e&&clearInterval(e),window.removeEventListener("focus",n),window.removeEventListener("blur",a)}}),[t.isMobileNative,e])}(),function(){const e=(0,a.useRef)(!1),t=(0,o.O7)(),n=(0,a.useCallback)((async e=>{if(e.currentUser.id&&u.pendingTaskIds.size>0){const t=await u.getTasks(e,{taskIds:Array.from(u.pendingTaskIds.values())});if("success"===t.type){const{results:n}=t.data,a=new Set(u.pendingTaskIds);for(const t of n)a.delete(t.id),t.status&&u.handleRecordMapForResponse({environment:e,eventName:t.eventName,response:t.status,userId:e.currentUser.id}),u.pendingTaskEventsById.emit(t.id,t),f.emit(t.eventName,t),"failure"!==t.state&&"success"!==t.state||u.pendingTaskIds.delete(t.id);if(a.size>0)for(const e of a.values())u.pendingTaskIds.delete(e)}}}),[]),r=(0,a.useCallback)((async e=>{if(e.currentUser.id){const t=await u.getUserTasks(e,{});if("success"===t.type){for(const e of t.data.taskIds)u.pendingTaskIds.add(e);t.data.taskIds.length>0&&n(e)}}}),[n]),s=(0,a.useCallback)((()=>{const n=m.Z.state.online;n&&!e.current&&r(t),e.current=n}),[t,r]);function i(e){"success"===e.state?v.Z.setStatus(e.request.blockId,void 0):"in_progress"===e.state||"not_started"===e.state?v.Z.setStatus(e.request.blockId,e.status):v.Z.setStatus(e.request.blockId,void 0)}function d(e){"success"===e.state?h.Z.setStatus(e.request.blockId,!1):"in_progress"===e.state||"not_started"===e.state?h.Z.setStatus(e.request.blockId,!0):h.Z.setStatus(e.request.blockId,!1)}(0,a.useEffect)((()=>{e.current=m.Z.state.online;const a=setInterval((()=>n(t)),1e3);return r(t),m.Z.addListener(s),f.addListener("importEvernote",i),f.addListener("extractWebClipperContent",d),()=>{clearInterval(a),m.Z.removeListener(s),f.removeListener("importEvernote",i),f.removeListener("extractWebClipperContent",d)}}),[t,n,s,r])}(),function(){const e=(0,o.O7)(),t=(0,a.useCallback)((()=>{b.LH(e)}),[e]);(0,a.useEffect)((()=>(t(),g.Z.addListener(t),()=>{g.Z.removeListener(t)})),[t])}(),E(),function(){const e=(0,o.O7)();(0,a.useEffect)((()=>{L(e);const t=window.setInterval((()=>L(e)),I);return()=>window.clearInterval(t)}),[e])}(),function(){const e=(0,o.O7)();(0,P.Z)((()=>{O(e)})),(0,a.useEffect)((()=>{const t=window.setInterval((()=>O(e)),B);return()=>{window.clearInterval(t)}}),[e])}(),function(){const e=(0,o.O7)();(0,a.useEffect)((()=>{F(e);const t=window.setInterval((()=>F(e)),D.U6);return()=>window.clearInterval(t)}),[e])}(),function(){const e=(0,o.O7)(),t=(0,o.Fy)(),n=(0,S.VK)((()=>{const{currentUserStore:n,currentUserSettingsStore:a,currentUserRootStore:o}=d.default.state;if(!(e.currentUser.id&&n&&a&&o))return e.publicDomainUserId?{user_id:e.publicDomainUserId}:void 0;const r=o.getSpaceViewStores(),s=r.length>0&&r.every((e=>e.isReady()));if(!n.isDefined()||!a.isDefined()||!s)return;const c=$.oA(r.map((e=>e.getSpaceId()))).map((t=>y.Z.getData(e,{spaceId:t})));if(!c.every((e=>Boolean(e)||null===e)))return;const l=(0,i.ls)(c),p=a.getSettings();if(!p)return;if(void 0===H.subscriptionDataStoreInstance.state)return;const u={user_id:n.id,email:n.getEmail(),user_persona:p.persona,user_team_role:p.team_role,user_use_cases:p.use_cases,user_company_size:p.company_size,user_source:p.source,user_plan_type:l,user_subscription_tier:H.subscriptionDataStoreInstance.state.subscriptionTier,user_has_at_least_one_free_tier_space:(0,i.nZ)(c),time_zone:p.time_zone,locale:p.locale,preferred_locale:p.preferred_locale,signup_time:p.signup_time,app_version:t.version};return p.signup_time&&(u.created_at=Math.floor(p.signup_time/1e3)),t.desktopAppVersion&&(u.desktop_app_version=t.desktopAppVersion),t.mobileAppVersion&&(u.mobile_app_version=t.mobileAppVersion),p.used_desktop_web_app&&(u.used_desktop_web_app=p.used_desktop_web_app),p.used_mobile_web_app&&(u.used_mobile_web_app=p.used_mobile_web_app),p.used_mac_app&&(u.used_mac_app=p.used_mac_app),p.used_windows_app&&(u.used_windows_app=p.used_windows_app),p.used_ios_app&&(u.used_ios_app=p.used_ios_app),p.used_android_app&&(u.used_android_app=p.used_android_app),u}),[e,t],{useDeepEqual:!0});(0,a.useEffect)((()=>{n&&"none"!==n.user_plan_type&&j(e,n)}),[e,n]);const r=void 0!==n;(0,a.useEffect)((()=>{const t=window.setTimeout((()=>{!r&&e.currentUser.id&&j(e,{user_id:e.currentUser.id})}),5e3);return()=>{window.clearTimeout(t)}}),[e,r])}(),function(){const e=(0,o.O7)(),t=(0,S.VK)((()=>z.default.state.isLoaded),[]),n=(0,S.VK)((()=>z.default.state.isLoggingEnabled),[]);(0,a.useEffect)((()=>{t&&async function(){const t=await(0,i.cG)(e);await K.j2({config:A.default,isEnabled:n,deviceId:t,cookieService:e.cookieService})}()}),[e,t,n])}(),function(){const e=(0,o.O7)();(0,a.useEffect)((()=>{const t=t=>{G.Zm(e,t)},n=t=>{const{shortcutMap:n}=e.KeyboardShortcutStackStore,a=$.w_(n,((n,a)=>(0,Y.Z)(e,t,n)));a&&!{cut:!0,copy:!0,paste:!0}[a]&&G.dJ(e,t,a)};return window.addEventListener("keydown",n),window.addEventListener("cut",t),window.addEventListener("copy",t),window.addEventListener("paste",t),window.addEventListener("keypress",t),()=>{window.removeEventListener("keydown",n),window.removeEventListener("cut",t),window.removeEventListener("copy",t),window.removeEventListener("paste",t),window.removeEventListener("keypress",t)}}))}(),(0,J.Z)(),function(){const e=(0,o.O7)(),t=(0,o.Fy)();(0,a.useEffect)((()=>{t.isElectron&&T.setLogglyData(X.clientLogglyEnvironmentData),e.mobileNative&&e.mobileNative.setLogglyData(X.clientLogglyEnvironmentData)}),[t.isElectron,e.mobileNative])}(),function(){const e=(0,o.O7)();(0,a.useEffect)((()=>{if(e.device.isMobile){function t(){Q.default.afterNextFlush((()=>{te.hQ(e)}))}return ae.default.addListener(t),oe.addListener(t),()=>{ae.default.removeListener(t),oe.removeListener(t)}}}),[e])}(),(0,re.Z)(),(0,se.ZP)(),function(){const e=(0,o.O7)();(0,a.useEffect)((()=>{const{mobileNative:t}=e;t&&t.enableBridgeMetricsCollection(e,ie.default,de.default)}),[e])}(),function(){const e=(0,o.O7)();(0,a.useEffect)((()=>{function t(){le.Z.setState({...le.Z.state,isVisible:!document.hidden});const t=ce.W$(),n=t&&(Date.now()-t)/D.A0>=7;if(e.device.isBrowser&&!document.hidden&&(!t||n)&&m.Z.getState().online){const t=e.AppUpdateStore;if(t.isSilentUpdate()){const n=t.state.appUpdate;ce.hC({environment:e,url:window.location.href,version:n.version})}}}return document.addEventListener("visibilitychange",t),t(),()=>{document.removeEventListener("visibilitychange",t)}}),[e])}(),function(){const{deviceType:e}=(0,o.Fy)(),t=(0,o.O7)(),n=t.currentUser.isLoggedIn();(0,a.useEffect)((()=>{if(!n)return;if("windows-desktop"!==e&&"mac-desktop"!==e)return;const a=async()=>{await T.isMainTabOrWindow()&&u.registerDesktopApp(t,{deviceType:e})};a();const o=window.setInterval((()=>{a()}),5*D.hM);return()=>{window.clearInterval(o)}}),[n,e,t])}(),function(){const e=(0,o.O7)(),t=(0,a.useRef)(),n=(0,a.useRef)();(0,a.useEffect)((()=>{function a(){const a=ae.default.state,o="empty"===a.mode?void 0:a.multiSelection.start.store,r="empty"===a.mode?void 0:a.multiSelection.end.store;if(t.current===o&&n.current===r)return;if(t.current=o,n.current=r,t.current!==n.current)return;const s=fe.getSimpleTableCellFromTextSelection();if(!s)return;const{rowIndex:i,columnIndex:d,simpleTableStore:c}=s.getProps();he.selectCell({environment:e,rowIndex:i,columnIndex:d,simpleTableStore:c})}return ae.default.addListener(a),()=>{ae.default.removeListener(a),t.current=void 0,n.current=void 0}}))}(),function(){const e=(0,o.O7)(),t=(0,a.useCallback)((t=>{const n={compressed:t.decodedBodySize!==t.encodedBodySize,local_cache_hit:0===t.transferSize,next_hop_protocol:t.nextHopProtocol,did_prefetch:e.prefetchCache.isEnabled},a={dns_lookup:{startTime:t.domainLookupStart,endTime:t.domainLookupEnd},connection_establish:{startTime:t.connectStart,endTime:t.connectEnd},request_queued:{startTime:t.connectEnd,endTime:t.requestStart},response_wait:{startTime:t.requestStart,endTime:t.responseStart},response_download:{startTime:t.responseStart,endTime:t.responseEnd}};ie.default.measure({metricName:"load_cached_page_chunk.fetch",startTime:t.fetchStart,endTime:t.responseEnd},{environment:e,data:{...n,sub_metrics:{dns_lookup:a.dns_lookup.endTime-a.dns_lookup.startTime,connection_establish:a.connection_establish.endTime-a.connection_establish.startTime,request_queued:a.request_queued.endTime-a.request_queued.startTime,response_wait:a.response_wait.endTime-a.response_wait.startTime,response_download:a.response_download.endTime-a.response_download.startTime}}});for(const[o,{startTime:r,endTime:s}]of Object.entries(a))ie.default.measure({metricName:`load_cached_page_chunk.fetch.${o}`,startTime:r,endTime:s},{environment:e,data:n})}),[e]);(0,a.useEffect)((()=>{const e=new PerformanceObserver((n=>{const a=n.getEntries().find((e=>e.name.includes(`${A.default.api.http}/${be}`)&&!e.name.endsWith("s")));a&&("resource"===a.entryType&&t(a),null==e||e.disconnect())}));return e.observe({type:"resource",buffered:!0}),()=>{e.disconnect()}}),[t])}(),function(){const e=(0,o.O7)();(0,a.useEffect)((()=>{const t=()=>ge.updateConnectionState(e);return t(),m.Z.addListener(t),()=>{m.Z.removeListener(t)}}),[e])}(),function(){const e=(0,o.O7)(),t=(0,a.useRef)("none"),n=(0,a.useCallback)((e=>{const n=t.current;e!==n&&(t.current=e,"dragging"===e?me.Z.setState({isDragging:!0}):"dragging"===n&&me.Z.setState({isDragging:!1}))}),[]),r=(0,a.useCallback)((()=>{"none"===t.current&&n("touching")}),[n]),s=(0,a.useCallback)((()=>{n("none")}),[n]),i=(0,a.useCallback)((()=>{"touching"===t.current&&ue.isExpanded(ue.get())&&n("dragging")}),[n]);(0,a.useEffect)((()=>{if(e.device.isIOS)return window.addEventListener("touchstart",r),window.addEventListener("touchend",s),window.addEventListener("touchcancel",s),document.addEventListener("selectionchange",i),()=>{window.removeEventListener("touchstart",r),window.removeEventListener("touchend",s),window.removeEventListener("touchcancel",s),document.removeEventListener("selectionchange",i)}}),[e.device.isIOS,r,s,i]);const d=(0,a.useCallback)((()=>{Q.default.afterNextFlush((()=>{pe.ls()}))}),[]),c=(0,a.useCallback)((()=>{setTimeout((()=>{ue.get()||pe.ZH(e)}),0)}),[e]);(0,a.useEffect)((()=>(window.addEventListener("mousedown",d),e.device.isMobileBrowser&&document.addEventListener("focusout",c),()=>{window.removeEventListener("mousedown",d),document.removeEventListener("focusout",c)})),[e,d,c])}(),function(){const e=(0,o.O7)(),t=(0,o.Fy)(),n=(0,a.useRef)(!1),r=(0,a.useCallback)((()=>{"system"===b.VZ(e)&&g.Z.emit()}),[e]),s=(0,S.VK)((()=>{var e;return null===(e=d.default.state.mainEditorCurrentBlockStore)||void 0===e?void 0:e.isReady()}),[]);(0,a.useLayoutEffect)((()=>{!n.current&&s&&(r(),n.current=!0)}),[s,r]),(0,a.useEffect)((()=>{if(t.isAndroid&&e.mobileNative)e.mobileNative.updateReceiveApiHandlers({themeChanged:e=>r()});else{if(ve.addEventListener&&ve.removeEventListener)return ve.addEventListener("change",r),()=>{ve.removeEventListener("change",r)};if(ve.addListener&&ve.removeListener)return ve.addListener(r),()=>{ve.removeListener(r)}}}),[t.isAndroid,e,r])}(),function(){const e=A.default.isLocalhost||!1;(0,a.useEffect)((()=>{function t(t){if(!e)return;if(!t.data||"string"!=typeof t.data.type)return;const n=t.data.type;"webpackInvalid"===n?Se.oV({label:(0,we.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,we.jsx)("span",{style:{paddingRight:10},children:"Webpack Compiling"}),(0,we.jsx)("img",{src:"/images/favicon-local.ico",className:"loading-spinner",style:{display:"inline-block"}})]}),position:"top",durationMs:"keep"}):"webpackOk"!==n&&"webpackWarnings"!==n||Se.rN()}return window.addEventListener("message",t),()=>{window.removeEventListener("message",t)}}),[e])}(),(0,we.jsxs)(we.Fragment,{children:[(0,we.jsx)(Ze,{},"AppUpdateListener"),(0,we.jsx)(Ft,{}),e.isElectron&&(0,we.jsx)(zt,{}),(0,we.jsx)(r.LazyInjectThirdPartyScripts,{})]})}function zt(){return function(){const e=(0,o.O7)(),t=(0,S.VK)((()=>({observedWidth:R.sidebarSizeObserver.rect.state.width,targetWidth:R.sidebarWidthStore.state,isExpanded:R.sidebarExpandedStore.state,resizing:R.sidebarResizingStore.state})),[]),n=e.currentUser.isLoggedIn(),r=(0,Z.formatVersion)(T.getDesktopVersion()),[s,c]=(0,a.useState)(!1);(0,a.useEffect)((()=>{s&&T.windowSidebarState.set({isLoggedIn:n,...t})}),[t,n,s]),(0,a.useEffect)((()=>{let e;e=n?t.isExpanded?"expanded":"collapsed":"disabled",T.sidebarState.set(e)}),[t.isExpanded,n]);const l=(0,S.VK)((()=>{var e,t,n;return{currentUserId:null===(e=d.default.state.currentUserStore)||void 0===e?void 0:e.id,currentSpaceId:null===(t=d.default.state.currentSpaceStore)||void 0===t?void 0:t.getSpaceId(),currentPageId:null===(n=d.default.state.mainEditorCurrentBlockStore)||void 0===n?void 0:n.id}}),[]);(0,a.useEffect)((()=>{T.setAppStoreState(l)}),[l]);const p=(0,a.useCallback)(((t,n,a)=>{i.j(e,n,a)}),[e]);(0,a.useEffect)((()=>(T.track.addListener(p),()=>{T.track.removeListener(p)})),[p]);const m=(0,a.useCallback)(((e,t)=>{c(t)}),[]);(0,a.useEffect)((()=>(T.isActiveTab.get().then((e=>{c(e)})),T.isActiveTab.addListener(m),()=>{T.isActiveTab.removeListener(m)})),[m]);const v=(0,a.useCallback)(((e,t)=>{void 0===t.isShowingTabBar&&(t.isShowingTabBar=t.isTabsFeatureEnabled),N.Z.setState(t)}),[]);(0,a.useEffect)((()=>{var e;return null===(e=T.electronAppFeatures.get())||void 0===e||e.then((e=>{N.Z.setState(e)})),T.electronAppFeatures.addListener(v),()=>{T.electronAppFeatures.removeListener(v)}}),[v]);const h=(0,a.useCallback)((n=>{M.setExpand({environment:e,isExpanded:!t.isExpanded,from:"electron_listener"})}),[e,t.isExpanded]);(0,a.useEffect)((()=>(T.sidebarState.addToggleListener(h),()=>{T.sidebarState.removeToggleListener(h)})),[h]);const f=(0,a.useCallback)(((e,t)=>{t?M.open({fromElectron:!0}):M.close()}),[]);(0,a.useEffect)((()=>(T.sidebarState.addSetSidebarOpenListener(f),()=>{T.sidebarState.removeSetSidebarOpenListener(f)})),[f]);const b=(0,a.useCallback)(((e,t)=>{R.sidebarExpandedStore.setState(t.isExpanded),R.sidebarWidthStore.setState(t.targetWidth)}),[]);(0,a.useEffect)((()=>(T.windowSidebarState.addListener(b),()=>{T.windowSidebarState.removeListener(b)})),[b]),(0,a.useEffect)((()=>{!async function(){if(void 0===r)return;const t=await u.isDesktopVersionCompatible(e,{desktopVersion:r});"success"!==t.type||t.data.compatible||window.location.replace(A.default.domainBaseUrl+t.data.redirect)}()}),[r,e])}(),null}},98938:(e,t,n)=>{n.d(t,{Z:()=>B});var a=n(67294),o=n(480),r=n(86628),s=n(24405),i=n(41892),d=n(15095),c=n(43593),l=n(17755),p=n(42875),u=n(79362),m=n(22808),v=n(82883),h=n(9291),f=n(53965),b=n(18265),g=n(47839),S=n(8055),w=n(95477),U=n(60682),y=n(24990),E=n(19037),k=n(42129),T=n(77907);const A=32;const _=32;async function L(e){const t=document.createElement("canvas");t.width=_,t.height=_;const n=t.getContext("2d"),a=document.createElement("img");return a.src=e,new Promise((e=>{a.onload=()=>{n.drawImage(a,0,0,_,_),e(t.toDataURL("image/png"))},a.onerror=()=>{e("")}}))}var C=n(84210),I=n(83055),Z=n(33929),M=n(46654),R=n(94841),N=n(19034),P=n(80444),V=n(80641),x=n(53730);const B=function(){const e=(0,o.O7)(),t=(0,h.useIntl)(),n=(0,s.Fg)(),_=(0,a.useRef)(),B=(0,r.SI)((()=>{const{RouterStore:n,device:a}=e,o=n.state.route;if("chat"===o.name)return{title:"Ask AI"};if("settingsConsoleOrganization"===o.name)return{title:"Organization settings"};const r=P.default.state.mainEditorCurrentBlockStore;if(!r||!r.isReady())return;const s="page"===o.name&&o.blockId===r.id,i=r.getSpaceStore()??P.default.state.currentSpaceStore,c="space"===o.name&&o.requestedOnPublicDomain&&(null==i?void 0:i.getPublicHomePage())===r.id;if(!s&&!c)return;const l=N.Z.getTotalUnreadMentionsCount(),u=r.getTitleStore();let m;const h=r.getModel(),f=r.getCollectionViewIds(),b=null==u?void 0:u.getRecordModel(u.pointer);if(u&&b){if(m=(0,v.X)({intl:Z.default.getIntl(),textValue:u.getValue(),userTimeZone:(0,p.r)(),getRecordModel:r.getRecordModel})||b.getEmptyTitlePlaceholder({getRecordModel:u.getRecordModel,userTimeZone:(0,p.r)(),intl:t}),"block"===u.table&&(0,R.WE)(r)&&i){m=`${i.getName()} - ${t.formatMessage({id:"DocumentTitleListener.personalHomeLabel",defaultMessage:"Home"})}`}if("collection"===u.table&&h&&h.isCollectionView()&&f.length>1){const e=P.default.state.currentCollectionViewStore;e&&e.getName()&&(m=`${m} | ${e.getName()}`)}a.isElectron||(m=(0,d.db)(m.slice(0,100),y.Z.state)),M.IJ(e,r)||e.device.isElectron||e.device.isMobileNative||(l>9?m=`(9+) ${m}`:l>0&&(m=`(${l}) ${m}`))}let g;null!=i&&i.getPublicSpaceData()&&(g="page"===o.name?(0,C.ZP)({store:r,fullyQualified:!1,scrollToBlockId:null==o?void 0:o.scrollToBlockId,peekViewBlockId:o.peekViewBlockId,peekMode:o.peekMode,collectionViewId:o.collectionViewId,discussionId:o.discussionId,showMoveTo:o.showMoveTo,saveParent:o.saveParent,templateGalleryItem:o.templateGalleryItem,projectManagementLaunch:o.projectManagementLaunch,pageVisitSource:void 0}):(0,C.ZP)({store:r,fullyQualified:!1,pageVisitSource:void 0}));const S=r.getIcon(),w=null==h?void 0:h.isNonverifiedContentClassification();return{title:m,url:g,icon:S,isNonverified:w,hasBypassedContentClassification:w&&h&&V.Z.bypassedPage(r.id),isMemberOfSpace:(0,E.Iay)()}}),[e,t]);return(0,r.Kw)(B),(0,a.useEffect)((()=>{const a=f.Ds((function(){const{device:a}=e,o=B.state;if(!o)return;const{url:r,title:s,icon:p}=o;let v,h,f;p&&(0,u.V2)(p.icon)?f=p.icon:p&&(0,m.Z)(p.icon)?v=p.icon:p&&c.F8(p.icon)&&(h=p);const y=o.isNonverified&&!o.hasBypassedContentClassification&&!o.isMemberOfSpace;s&&document.title!==s&&(y?document.title=t.formatMessage({id:"pageTitle.flaggedContent",defaultMessage:"Flagged Content"}):a.isSafari&&v?document.title=`${v} ${s}`:document.title=s),r&&b.T1(r)!==b.T1(window.location.href)&&(window.history.replaceState(window.history.state,void 0,r),S.j7({environment:e,url:window.location.href}));const E=document.querySelector("link[rel='shortcut icon']");if(E){const t=i.Z.images.faviconIco;if(y)E.href=t,_.current=t;else if(v)v!==_.current&&(_.current=v,async function(e,t){const n=document.createElement("canvas");n.width=A,n.height=A;const a=n.getContext("2d");if(a.font="normal normal normal 32px/32px sans",a.textAlign="center",a.textBaseline="middle","raw"===t)return a.fillText(e,n.width/2,n.height/2+4),n;const o=await T.deps.emojiData.loader(),r=(0,k.y)(e,o);if(!r)return;const s=document.createElement("img");s.src=(0,d.bk)(t);const i=(0,d.G0)(r);return new Promise((e=>{s.onload=()=>{a.drawImage(s,i.x,i.y,i.size,i.size,0,0,A,A),e(n)},s.onerror=()=>{e(void 0)}}))}(v,(0,U.e_)(e)).then((async e=>{await I.aO(),E.href=(null==e?void 0:e.toDataURL("image/png"))||""})));else if(f){if(f!==_.current){_.current=f;const e=`${f}?mode=${n.mode}`;a.isFirefox?E.href=e:L(e).then((e=>{E.href=e}))}}else if(h){const{icon:t,...n}=h,a=l.EK({url:t,width:100,permissionRecord:n.pointer,baseUrl:w.default.domainBaseUrl,fullyQualified:!1,userId:e.currentUser.id});a!==_.current&&(_.current=a,x.transactionQueue.awaitRecordTransaction(n.pointer).then((()=>L(a))).then((e=>{E.href=e})))}else t!==_.current&&(E.href=t,_.current=t)}g.electronApi&&g.electronApi.setWindowTitle&&s&&g.electronApi.setWindowTitle(s)}),500,{leading:!0}),o=document.title;return B.state&&a(),B.addListener(a),()=>{B.removeListener(a),document.title=o}}),[e,t,B,n.mode]),null}},10854:(e,t,n)=>{n.d(t,{Tm:()=>f,mK:()=>b,p9:()=>h});var a=n(89101),o=n(54153),r=n(11342),s=n(36610),i=n(2449),d=n(35253),c=n(47307),l=n(47839),p=n(12714),u=n(95477),m=n(44819),v=n(21051);const h=!1,f="electronUpdateReady2";function b(e){const{AppUpdateStore:t,device:n}=e;if(s.By(e),h){const t=(0,m.Us)(a._j.releases);p.D({environment:e,url:t})}if(n.isElectron&&t.state.electronUpdate&&"ready"===t.state.electronUpdate.state){const e=l.getDesktopVersion();o.Z.set(f,(0,r.formatVersion)(e)),l.installElectronUpdate()}else t.state.appUpdate&&"ready"===t.state.appUpdate.state?(i.hC({environment:e,url:window.location.href,version:t.state.appUpdate.version}),c.dismissDialog(),d.Js({bannerStore:v.Z})):(i.D$((0,r.parseVersion)(u.default.version)),c.dismissDialog(),d.Js({bannerStore:v.Z}))}},44819:(e,t,n)=>{n.d(t,{Us:()=>r,XR:()=>s});var a=n(13991),o=n(13559);n(53965),n(95477);Boolean("en-US"===a.SP);function r(e){const t="https://www.notion.so";return"en-US"!==a.SP?`${t}/${a.SP.toLocaleLowerCase()}${e}`:`${t}${e}`}function s(e,t){if(e.device.isElectron||e.device.isMobileNative)return!1;const n=(0,o.XU)(t,e.currentUser.isLoggedIn());return!!n&&"devOnly"!==n}},91190:(e,t,n)=>{n.d(t,{C:()=>r,E:()=>o});var a=n(61766);const o=new a.Z,r=new a.Z},53610:(e,t,n)=>{n.d(t,{Z:()=>a});const a=new(n(61766).Z)},66881:(e,t,n)=>{n.d(t,{g:()=>a});const a=n(49085).default.createValue({shouldReset:!1})},56638:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(49085);class o extends a.default{getInitialState(){return{open:!1}}}const r=new o}}]);