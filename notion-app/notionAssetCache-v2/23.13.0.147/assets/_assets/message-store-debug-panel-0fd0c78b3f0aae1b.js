"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[1308],{83606:(e,t,n)=>{n.r(t),n.d(t,{MessageStoreDebugPanel:()=>w});n(57658);var s=n(32594),a=n(30817),i=n(57814),o=n(98649),r=n(93382),l=n(17455),d=n(67294),u=n(24405),c=n(53965),h=n(19584),p=n(4827),g=n(75233),x=n(79420),m=n(88536),b=n(85893);const v=300,f=500,k=1*h.C0,y={...r.j,fontSize:"10px",background:"black",border:"1px solid white",color:"white"},M={fontSize:"10px"};function S(e,t,n){const s=e.slice();return s.push(t),s.length>n&&s.splice(0,s.length-n),s}function w(){const[e,t]=(0,d.useState)({subscriptions:[],queueSize:[],pendingUnsubscribes:[],pendingEvictions:[]}),n=(0,d.useMemo)((()=>[{pluralName:"subscriptions",stroke:"white",fill:"black",data:e.subscriptions},{pluralName:"queued requests",stroke:"yellow",fill:"transparent",data:e.queueSize},{pluralName:"pending unsubscribes",stroke:"springgreen",fill:"transparent",data:e.pendingUnsubscribes},{pluralName:"pending evictions",stroke:"lightgray",fill:"transparent",data:e.pendingEvictions}]),[e]);(0,d.useEffect)((()=>{const n=window.setTimeout((()=>{const n=(0,m.Tm)(),s=(0,m.EM)(),a=x.Z.getPendingUnsubscribeCount(),i=g.Z.getPendingEvictionCount();t({subscriptions:S(e.subscriptions,n._total,v),queueSize:S(e.queueSize,s.queue,v),pendingUnsubscribes:S(e.pendingUnsubscribes,a,v),pendingEvictions:S(e.pendingEvictions,i,v)})}),k);return()=>window.clearTimeout(n)}),[e]);const s=(0,u.yK)((()=>({panelStyle:{position:"fixed",right:"calc(50% - 160px)",bottom:0,width:"320px",color:"white",background:"rgba(0, 0, 0, 0.75)",padding:"8px"},headingStyle:{fontWeight:600,fontSize:"14px"}})),[]);return(0,b.jsx)(p.Z,{open:!0,children:(0,b.jsxs)("div",{style:s.panelStyle,children:[(0,b.jsx)("div",{style:s.headingStyle,children:"MessageStore metrics"}),(0,b.jsx)(C,{width:304,height:64,dataStreams:n,maxDataLength:v,baseMaxDataValue:f,dataPointIntervalMs:k})]})})}function j(e){const t=Date.now()-e;return t<h.C0?"just now":t<h.hM?`${Math.round(t/h.C0)} seconds ago`:`${(t/h.hM).toFixed(1)} minutes ago`}function C(e){const{width:t,height:n,dataStreams:r,maxDataLength:u,baseMaxDataValue:h,dataPointIntervalMs:p}=e,[g,x]=(0,d.useState)(),m=(0,d.useMemo)((()=>Math.max(h,...c.xH(r.map((e=>e.data))))),[r,h]),v=(0,d.useMemo)((()=>(0,a.Z)({range:[n,0],domain:[0,m],nice:!0})),[n,m]),f=(0,d.useMemo)((()=>(0,a.Z)({range:[0,t],domain:[0,u-1],nice:!0})),[t,u]),k=(0,d.useCallback)((()=>x(void 0)),[]),S=(0,d.useCallback)((e=>{const{x:t}=(0,s.Z)(e)||{x:0},n=Math.round(f.invert(t)),a=r[0].data.length;if(n>=a)return void x(void 0);const i=r[0][n],o=v(i),l=Date.now()-(a-1-n)*p;x({x:t,y:o,dataStreamIndex:n,timestamp:l})}),[f,r,v,p]);return(0,b.jsxs)("div",{children:[(0,b.jsxs)("svg",{width:t,height:n,children:[r.map(((e,t)=>(0,b.jsx)(i.Z,{data:e.data,x:(e,t)=>f(t),y:e=>v(e),strokeWidth:1,stroke:e.stroke,fill:e.fill,yScale:v},t))),(0,b.jsx)(o.Z,{x:0,y:0,width:t,height:n,fill:"transparent",onMouseMove:S,onMouseLeave:k})]}),g&&(0,b.jsx)("div",{children:(0,b.jsxs)(l.Z,{top:g.y,left:g.x,style:y,children:[(0,b.jsx)("div",{style:{color:"darkgray"},children:j(g.timestamp)}),r.map(((e,t)=>(0,b.jsxs)("div",{style:{color:e.stroke},children:[e.data[g.dataStreamIndex]," ",e.pluralName]},t)))]},Math.random())}),(0,b.jsx)("div",{style:M,children:r.map(((e,t)=>(0,b.jsxs)("div",{style:{color:e.stroke},children:[0===e.data.length?"0":e.data[e.data.length-1]," ",e.pluralName]},t)))})]})}}}]);